"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7266],{6758:(e,t,r)=>{r.d(t,{Pq:()=>le,oe:()=>se,bU:()=>ne});r(57658);var i=r(67294),o=r(83355),n=r(76205),s=r(68965),l=r(42853),a=r(56666),p=r(88437),d=r(62208),c=r(47453),u=r(37612),h=r(72126),g=r(97880),m=r(68939),f=r(50906),x=r(97004),v=r(17335),y=r(87279),M=r(61766),j=r(13401),b=r(80951),F=r(43690),C=r(480),w=r(33929),S=r(98742),Z=r(52275),V=r(45959),T=r(26388),P=r(64369),I=r(62045),_=r(85893);function A(e){window.__c={n:"CollectionFilterMenuDateFilterMode"};const{filter:t}=e,{isMobile:r}=(0,C.Fy)(),i=w.default.getIntl(),o={width:190,menuTitle:i.formatMessage({defaultMessage:"Date Options",id:"database.filterMenu.mobileDateFilterModeMenu.title"}),items:n.T,selectedItem:(0,n.TX)(t),getKey:e=>e,onSelect:r=>{const i={...t,use_end:(0,n.UG)(r)};e.onChange(i)},renderItem:e=>(0,_.jsx)(T.Z,{renderTooltip:()=>(0,v._T)(e.value),render:t=>(0,_.jsx)(Z.Z,{title:(0,v.IF)(e.value),...(0,S.Z)(e,t)}),placement:T.Z.Placement.Right,textWrap:!0,style:{width:"260px"}}),renderOrigin:e=>(0,_.jsx)(I.Z,{...e,placeholder:i.formatMessage({defaultMessage:"Date Options",id:"database.filterMenu.dateFilterModeMenu.label"}),title:(0,_.jsx)(P.Z,{isMobile:r,children:(0,v.IF)((0,n.TX)(t))}),disableMargins:!0,desktopStyle:{width:"100px"}})};return(0,_.jsx)(V.Z,{...o,mobileActionSheet:!0},"date-filter-mode")}var k=r(86628),O=r(34299);const R=(0,m.injectIntl)((function(e){window.__c={n:"CollectionFilterMenuFilterOperator"};const t=(0,C.O7)(),{filterValueType:r,filter:i,intl:o}=e,s=(0,n.xm)(r),l={width:190,menuTitle:o.formatMessage({defaultMessage:"Comparator",id:"database.filterMenu.mobileComparatorValueMenu.title"}),items:s,selectedItem:i.operator,getKey:e=>e,onSelect:o=>{const n=(0,v.li)(r,i,o,"combinator");e.onChange(n),f.wds(t,{view_type:e.collectionViewType,action:"set_filter_comparator"})},renderItem:e=>(0,_.jsx)(Z.Z,{title:(0,v.WC)(e.value),...e}),renderOrigin:e=>(0,_.jsx)(I.Z,{...e,placeholder:o.formatMessage({defaultMessage:"Comparator",id:"database.filterMenu.comparatorMenuDropdownButton.label"}),title:(0,_.jsx)(P.Z,{isMobile:t.device.isMobile,children:(0,v.WC)(i.operator)}),disableMargins:!0})};return(0,_.jsx)(V.Z,{...l,mobileActionSheet:!0},"comparator")}));var B=r(49068),G=r(26909);const D=(0,m.defineMessages)({setFilter:{defaultMessage:"Set filter",id:"database.filterMenu.rollupPropertyValue.mobileMenu.title"}});const U=(0,m.injectIntl)((function(e){window.__c={n:"LocalizableCollectionFilterMenuFilter"};const t=(0,C.O7)();if((0,n.a_)(e.filter))return(0,_.jsx)(W,{intl:e.intl,onChange:e.onChange,collectionViewType:e.collectionViewType,property:e.property,schema:e.schema,parentStore:e.parentStore,collectionViewId:e.collectionViewId,filter:e.filter});const r=(0,n.fI)({schema:e.schema,property:e.property,getRecordModel:e.parentStore.getRecordModel});if(!(0,n.ZB)(r,e.filter)){const t=(0,v.rn)(r);return(0,_.jsxs)(i.Fragment,{children:[(0,_.jsx)(R,{filterValueType:r,filter:t,collectionViewType:e.collectionViewType,onChange:e.onChange}),(0,_.jsx)(B.Z,{filterValueType:r,filter:t,schema:e.schema,property:e.property,parentStore:e.parentStore,collectionViewType:e.collectionViewType,collectionViewId:e.collectionViewId,onChange:e.onChange})]})}const o=(0,_.jsx)(m.FormattedMessage,{...v.xe[r],values:{property:(0,_.jsx)(m.FormattedMessage,{id:"collectionFilterMenuFilter.property.name",defaultMessage:"Property"}),operator:(0,_.jsx)(R,{filterValueType:r,filter:e.filter,collectionViewType:e.collectionViewType,onChange:e.onChange}),operatorValue:(0,_.jsx)(B.Z,{filterValueType:r,filter:e.filter,schema:e.schema,property:e.property,parentStore:e.parentStore,collectionViewType:e.collectionViewType,collectionViewId:e.collectionViewId,onChange:e.onChange})}});return t.device.isMobile?o:(0,_.jsx)("div",{style:{alignItems:"center",display:"grid",gridAutoFlow:"column",gridAutoColumns:"1fr",gridColumnEnd:e.isArrayFilter?void 0:"span 2",gridColumnGap:`${G.l0}px`,gridTemplateRows:`${G.fg}px`,gridTemplateColumns:"[value-start] max-content auto [value-end operator-start] auto"},children:o})})),E=U;function W(e){let{filter:t,intl:r,onChange:o,collectionViewType:s,property:l,schema:a,parentStore:p,collectionViewId:d}=e;window.__c={n:"ArrayFilterComponent"};const c=(0,C.O7)(),u={menuTitle:r.formatMessage(D.setFilter),items:n.Rf,getKey:e=>e,selectedItem:t.operator,onSelect:e=>{const r={...t,operator:e};o(r),f.wds(c,{view_type:s,action:"set_rollup_set_filter"})},renderItem:e=>(0,_.jsx)(Z.Z,{title:(0,v.SW)(e.value,r),...e}),renderOrigin:e=>(0,_.jsx)(I.Z,{...e,placeholder:r.formatMessage(D.setFilter),title:(0,v.SW)(t.operator,r),disableMargins:!0,desktopStyle:{minWidth:70}})},h=(0,k.VK)((()=>(0,O.gT)({property:l,schema:a,getRecordModel:p.getRecordModel})),[l,a,p]);if(!h)return(0,_.jsx)("div",{style:{gridColumnEnd:"span 2"}});const g=(0,_.jsxs)(i.Fragment,{children:[(0,_.jsx)(V.Z,{...u,mobileActionSheet:!0},"set_filter"),(0,_.jsx)(U,{collectionViewId:d,filter:t.subfilter,schema:h.targetCollectionSchema,property:h.targetProperty,parentStore:p,collectionViewType:s,onChange:e=>{const r={...t,subfilter:e};o(r)},isArrayFilter:!0})]});return c.device.isMobile?g:(0,_.jsx)("div",{style:{display:"grid",gridAutoFlow:"column",gridAutoColumns:"1fr",gridColumnEnd:"span 2",gridColumnGap:`${G.l0}px`,gridTemplateColumns:"max-content",gridTemplateRows:`${G.fg}px`},children:g})}var $=r(31945),Q=r(77498),N=r(50542);class L extends o.Z{constructor(){super(...arguments),this.handleChangeProperty=e=>{var t,r;const{schema:i}=this.props,{property:o,filter:s}=this.props.propertyFilter,l=i[o],a=i[e],p={property:e,filter:s},d=a&&(0,n.J5)(i,e,s,this.props.parentStore.getRecordModel),c=a&&"relation"===a.type&&o!==e,u=l&&("created_by"===l.type||"last_edited_by"===l.type)&&a&&"person"===a.type,h=(0,n.Gb)(s)&&!(0,n.mv)(s)&&(0,n.R8)(s).some((e=>"exact"===e.type&&e.value&&"bot"===e.value.table));(!d||c||u&&h||!(0,F.dN)(p,i))&&(p.filter=(0,v.zZ)({schema:i,property:e,getRecordModel:this.props.parentStore.getRecordModel})),null===(t=(r=this.props).onChange)||void 0===t||t.call(r,this.props.index,p),f.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_property"})}}renderComponent(){const{device:e}=this.environment,{schema:t,propertyFilter:r}=this.props,o=(0,b.Qm)({schema:t,property:r.property});if(!o)return;if(!(0,n.J5)(t,r.property,r.filter,this.props.parentStore.getRecordModel))return;const s=(0,n.gE)(r.filter)&&(0,n.vR)(r.filter)&&(0,n.c3)(o),l=s?{width:"120px",marginRight:"4px"}:{},a=(0,_.jsxs)(i.Fragment,{children:[(0,_.jsx)($.ZP,{popupType:e.isMobile?$.Z4.SlideUp:$.Z4.Popup,renderOrigin:e=>(0,_.jsx)(N.Z,{...e,propertySchema:o,disableMargins:!0,textWrapperStyle:{width:"100%",...l}}),render:e=>(0,_.jsx)(Q.Z,{isRelationProperty:!1,schema:this.props.schema,onAccept:this.handleChangeProperty,onClose:e.close})}),s&&(0,_.jsx)(A,{filter:r.filter,onChange:e=>{var t,i;const o={...r,filter:e};null===(t=(i=this.props).onChange)||void 0===t||t.call(i,this.props.index,o)}})]});return(0,_.jsxs)(i.Fragment,{children:[this.props.filterOperator,e.isMobile?a:(0,_.jsx)("div",{style:{display:"flex"},children:a}),(0,_.jsx)(m.FormattedMessage,{id:"collectionFilterMenuRow.propertyConjunction.label",defaultMessage:" "}),(0,_.jsx)(E,{filter:r.filter,schema:t,property:r.property,parentStore:this.props.parentStore,collectionViewId:this.props.collectionViewId,collectionViewType:this.props.collectionViewType,onChange:e=>{var t,i;const o={...r,filter:e};null===(t=(i=this.props).onChange)||void 0===t||t.call(i,this.props.index,o)},isArrayFilter:!1})]})}}L.displayName="CollectionFilterMenuRow";const K=L;function z(){return(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Add filter rule",id:"database.filterMenu.addFilterRuleButtonTitle"})}const q=(0,m.defineMessages)({operatorPlaceholder:{defaultMessage:"Operator",id:"database.filterMenu.operatorPlaceholder"}});const J=(0,m.injectIntl)((function(e){const{intl:t,filterOperator:r,onChange:i,disableMargins:o}=e,s={width:"auto",menuTitle:t.formatMessage({defaultMessage:"Operator",id:"database.filterMenu.filterOperatorMenu.title"}),items:n.Uz,getKey:e=>e,selectedItem:r,onSelect:i,renderItem:e=>(0,_.jsx)(Z.Z,{title:(0,v.KV)(e.value,t),caption:(0,v.Qz)(e.value,t),...e}),renderOrigin:e=>(0,_.jsx)(I.Z,{...e,title:r&&(0,v.KV)(r,t),placeholder:t.formatMessage(q.operatorPlaceholder),disableMargins:o})};return(0,_.jsx)(V.Z,{...s,mobileActionSheet:!0},"operator")}));var X=r(31339),H=r(8982),Y=r(73063),ee=r(78140),te=r(32163),re=r(40721),ie=r(53437),oe=r(72495);const ne=170,se=400;class le extends o.Z{constructor(){super(...arguments),this.buttonPopupStores=[],this.renderChildFilter=(e,t)=>{const r=this.environment.device.isMobile;return(0,n.vA)(e)?r?this.renderMobileCombinatorFilter(e,t):this.renderDesktopCombinatorFilter(e,t):(0,n.aN)(e)?r?this.renderMobilePropertyFilter(e,t):this.renderDesktopPropertyFilter(e,t):void 0},this.renderCombinatorActions=()=>{const{device:e}=this.environment;if(e.isMobile)return(0,_.jsxs)(oe.Z,{topBorder:me(this.props.combinatorFilter,this.props.level),children:[(0,_.jsx)(fe,{props:{onClick:this.handleAddFilterClick}}),ue(this.props.level)&&(0,_.jsx)(xe,{props:{onClick:this.handleAddFilterGroupClick}})]});const t={height:32},r={padding:`${G.cn}px 0`};return ue(this.props.level)?(0,_.jsx)(oe.Z,{topBorder:me(this.props.combinatorFilter,this.props.level),desktopStyle:r,children:(0,_.jsx)($.ZP,{alignmentToOrigin:ie.ZP.Alignment.Start,popupType:ie.ZP.PopupType.Popup,renderOrigin:e=>(0,_.jsx)(H.i,{action:()=>e.onClick(),render:r=>{const{focused:i,...o}=r;return(0,_.jsx)(j.Z,{...e,...o,focused:i,isBlue:!1,style:t,title:(0,_.jsxs)("div",{children:[(0,_.jsx)(z,{}),(0,l.i)({width:10,marginLeft:6,display:"inline"})]})})}}),render:e=>(0,_.jsx)(te.Z,{type:te.i.Vertical,initialFocus:0,sections:[{key:"actions",render:e=>(0,_.jsx)(oe.Z,{...e}),items:[{key:"add_filter",render:e=>(0,_.jsx)(fe,{props:e}),action:t=>{e.close(),this.handleAddFilterClick()}},{key:"add_filter_group",render:e=>(0,_.jsx)(xe,{props:e}),action:t=>{e.close(),this.handleAddFilterGroupClick()}}]}]})})}):(0,_.jsx)(oe.Z,{topBorder:me(this.props.combinatorFilter,this.props.level),desktopStyle:r,children:(0,_.jsx)(H.i,{action:this.handleAddFilterClick,render:e=>{const{focused:r,...i}=e;return(0,_.jsx)(j.Z,{...i,focused:e.focused,isBlue:!1,style:t,onClick:this.handleAddFilterClick,title:(0,_.jsx)(z,{})})}})})},this.handleChildFilterChange=(e,t)=>{ge((r=>r.splice(e,1,t)),this.props.combinatorFilter,this.props.onChange,this.props.index)},this.handleAddFilterClick=()=>{const e=he(this.props.schema,this.props.combinatorFilter);ge((t=>t.push(e)),this.props.combinatorFilter,this.props.onChange,this.props.index),f.wds(this.environment,{view_type:this.props.collectionViewType,action:"add_filter"})},this.handleAddFilterGroupClick=()=>{const e=he(this.props.schema,this.props.combinatorFilter),t={operator:ce(this.props.combinatorFilter),filters:[e]},r=ge((e=>e.push(t)),this.props.combinatorFilter,this.props.onChange,this.props.index);this.openIndex(r-1),f.wds(this.environment,{view_type:this.props.collectionViewType,action:"add_filter_group"})},this.handleChangeFilterOperator=e=>{const t={...this.props.combinatorFilter,operator:e};this.props.onChange(this.props.index,t),f.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_operator"})}}willUnmount(){this.buttonPopupStores=[]}renderComponent(){const{combinatorFilter:e}=this.props,{device:t}=this.environment,r=(e.filters??[]).flatMap((e=>(0,n.Mm)(e)?[]:[e]));return(0,_.jsxs)(i.Fragment,{children:[me(this.props.combinatorFilter,this.props.level)?void 0:(0,_.jsx)("div",{style:t.isMobile?void 0:{display:"grid",gridTemplateColumns:`\n             [boolean-start] 60px\n             [boolean-end property-start] minmax(min-content, 120px)\n             [property-end operator-start] 110px\n             [operator-end value-start] auto\n             [value-end menu-start] ${G.fg}px\n             [menu-end]\n        `,gridAutoRows:`minmax(${G.fg}px, auto)`,gridColumnGap:G.l0,gridRowGap:G.cn,padding:`${G.cn}px ${G.l0}px 0 ${G.l0}px`,justifyItems:"stretch",alignItems:"start"},children:r.map(this.renderChildFilter)}),this.renderCombinatorActions()]})}renderDesktopPropertyFilter(e,t){return(0,_.jsxs)(i.Fragment,{children:[(0,_.jsx)(K,{index:t,propertyFilter:e,schema:this.props.schema,filterOperator:this.renderCombinatorOperator(t),parentStore:this.props.parentStore,onChange:this.handleChildFilterChange,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId},t),this.renderRowActions(e,t)]},t)}renderMobilePropertyFilter(e,t){return(0,_.jsxs)(i.Fragment,{children:[this.renderCombinatorOperator(t),(0,_.jsxs)(oe.Z,{title:(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Filter {index}",id:"database.filterMenu.filterIndex",values:{index:t+1}}),children:[(0,_.jsx)(K,{index:t,propertyFilter:e,schema:this.props.schema,filterOperator:null,parentStore:this.props.parentStore,onChange:this.handleChildFilterChange,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId},t),this.renderRowActions(e,t)]})]},t)}renderDesktopCombinatorFilter(e,t){const r={gridColumn:"property-start / value-end",...(o=this.theme,{background:o.filterGroupBackground,borderRadius:4,boxShadow:`0 0 0 1px ${o.filterGroupBorder}`,margin:1,alignSelf:"stretch"})};var o;return(0,_.jsxs)(i.Fragment,{children:[this.renderCombinatorOperator(t),(0,_.jsx)("div",{style:r,children:(0,_.jsx)(le,{index:t,level:this.props.level+1,combinatorFilter:e,onChange:this.handleChildFilterChange,parentStore:this.props.parentStore,schema:this.props.schema,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId})}),this.renderRowActions(e,t)]},t)}renderMobileCombinatorFilter(e,t){const r=(e.filters||[]).length,o=(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Filter Group {index}",id:"database.filterMenu.filterGroupIndex",values:{index:t+1}});return(0,_.jsxs)(i.Fragment,{children:[this.renderCombinatorOperator(t),(0,_.jsxs)(oe.Z,{title:o,children:[(0,_.jsx)($.ZP,{buttonPopupStore:this.getButtonPopupStore(t),popupType:$.Z4.SlideUp,renderOrigin:t=>(0,_.jsx)(Z.Z,{focused:!1,...t,showExtensionArrow:!0,right:r.toString(),title:(0,v.qh)({filter:e,schema:this.props.schema})}),render:r=>(0,_.jsx)(ee.Z,{menuType:y.og.Modal,title:o,left:(0,_.jsx)(re.BackMenuText,{}),onClickLeft:r.close,children:(0,_.jsx)(le,{index:t,level:this.props.level+1,combinatorFilter:e,onChange:this.handleChildFilterChange,parentStore:this.props.parentStore,schema:this.props.schema,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId})})}),this.renderRowActions(e,t)]})]},t)}renderCombinatorOperator(e){const t=this.props.combinatorFilter.operator,{device:r}=this.environment,i={justifySelf:"end"},o={...i,lineHeight:"32px",paddingRight:4};if(0===e){if(r.isMobile)return;return(0,_.jsx)(P.Z,{style:o,children:(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Where",id:"database.filterMenu.where"})})}if(1===e){const e=(0,_.jsx)(J,{disableMargins:!0,filterOperator:t,onChange:this.handleChangeFilterOperator});return this.environment.device.isMobile?(0,_.jsx)(oe.Z,{children:e}):(0,_.jsx)("div",{style:i,children:e})}if(!r.isMobile)return(0,_.jsx)(P.Z,{style:o,children:(0,_.jsx)(pe,{operator:t})})}renderRowActions(e,t){return this.environment.device.isMobile?this.renderRowActionMenuItems(e,t,void 0):(0,_.jsx)($.ZP,{popupType:ie.ZP.PopupType.Popup,renderOrigin:e=>(0,_.jsx)(H.i,{action:()=>e.onClick(),render:e=>(0,_.jsx)(Y.Z,{...e,hovered:e.focused,style:{width:"100%",height:32},icon:a.o})}),render:r=>this.renderRowActionMenuItems(e,t,r)})}renderRowActionMenuItems(e,t,r){const i=(0,n.vA)(e),o=i?(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Remove",id:"database.filterMenu.removeFilterGroupMenuTitle"}):(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Remove",id:"database.filterMenu.removeFilterMenuTitle"}),s=i?(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Duplicate",id:"database.filterMenu.duplicateFilterGroupMenuTitle"}):(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Duplicate",id:"database.filterMenu.duplicateFilterMenuTitle"}),l=[{key:"delete",action:()=>{r&&r.close(),this.handleDeleteFilter(t)},render:e=>(0,_.jsx)(Z.Z,{...e,icon:(0,_.jsx)(de,{icon:u.y}),title:o})},{key:"duplicate",action:()=>{r&&r.close(),function(e,t,r,i,o,n){ge((t=>{const r=t[e];if(r){const i={...r};t.splice(e,0,i)}}),t,r,i),f.wds(n,{view_type:o,action:"duplicate_filter"})}(t,this.props.combinatorFilter,this.props.onChange,this.props.index,this.props.collectionViewType,this.environment)},render:e=>(0,_.jsx)(Z.Z,{...e,icon:(0,_.jsx)(de,{icon:p.a}),title:s})}];if((0,n.aN)(e)&&ue(this.props.level)&&l.push({key:"turn_into_group",action:()=>{r&&r.close(),this.handleTurnIntoGroup(t,e)},render:e=>(0,_.jsx)(Z.Z,{...e,icon:(0,_.jsx)(de,{icon:d.z}),title:(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Turn into group",id:"database.filterMenu.turnIntoGroupMenuTitle"})})}),(0,n.vA)(e)&&e.filters&&1===e.filters.length){const i=(0,n.vA)(e.filters[0])?(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Unwrap group",id:"database.filterMenu.unwrapGroupMenuTitle"}):(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Turn into filter",id:"database.filterMenu.turnIntoFilterMenuTitle"});l.push({key:"turn_into_filter",action:()=>{r&&r.close(),this.handleTurnIntoFilter(t,e)},render:e=>(0,_.jsx)(Z.Z,{...e,icon:(0,_.jsx)(de,{icon:d.z}),title:i})})}const a=ae(e);return(0,n.vA)(e)&&this.props.level+a+1<3&&l.push({key:"wrap_in_group",action:()=>{r&&r.close(),this.handleTurnIntoGroup(t,e)},render:e=>(0,_.jsx)(Z.Z,{...e,icon:(0,_.jsx)(de,{icon:d.z}),title:(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Wrap in group",id:"database.filterMenu.wrapInGroupMenuTitle"}),caption:(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Create a filter group around this",id:"database.filterMenu.wrapInGroupMenuCaption"})})}),(0,_.jsx)(te.Z,{initialFocus:this.environment.device.isMobile?void 0:0,type:te.i.Vertical,sections:[{key:"actions",render:this.environment.device.isMobile?e=>(0,_.jsx)("div",{...e}):e=>(0,_.jsx)(oe.Z,{...e}),items:l}]})}handleTurnIntoGroup(e,t){const r={operator:ce(this.props.combinatorFilter),filters:[t]};this.handleChildFilterChange(e,r),this.openIndex(e),f.wds(this.environment,{view_type:this.props.collectionViewType,action:"turn_into_filter_group"})}handleTurnIntoFilter(e,t){const r=h.Ps(t.filters||[]);r&&!(0,n.Mm)(r)&&this.handleChildFilterChange(e,r),f.wds(this.environment,{view_type:this.props.collectionViewType,action:"turn_into_filter"})}handleDeleteFilter(e){ge((t=>t.splice(e,1)),this.props.combinatorFilter,this.props.onChange,this.props.index),this.getButtonPopupStore(e).reset(),this.buttonPopupStores.splice(e,1)}openIndex(e){this.getButtonPopupStore(e).setState({open:!0})}getButtonPopupStore(e){for(;this.buttonPopupStores.length<e+1;){const e=new M.Z;this.buttonPopupStores.push(e)}return this.buttonPopupStores[e]}}function ae(e){if((0,n.vA)(e)){const t=(e.filters||[]).filter(n.vA);return 1+(h.Fp(t.map(ae))||0)}return 0}function pe(e){const{operator:t,lowercase:r}=e;return"or"===t?r?(0,_.jsx)(m.FormattedMessage,{id:"collectionFilterCombinatorGrid.filterOperator.or.lowercase",defaultMessage:"or"}):(0,_.jsx)(m.FormattedMessage,{id:"collectionFilterCombinatorGrid.filterOperator.or",defaultMessage:"Or"}):"and"===t?r?(0,_.jsx)(m.FormattedMessage,{id:"collectionFilterCombinatorGrid.filterOperator.and.lowercase",defaultMessage:"and"}):(0,_.jsx)(m.FormattedMessage,{id:"collectionFilterCombinatorGrid.filterOperator.and",defaultMessage:"And"}):(0,g.t1)(t)}function de(e){let{icon:t,styles:r}=e;return(0,_.jsx)(X.Z,{icon:t,styles:r})}function ce(e){return"or"===e.operator?"and":"or"}function ue(e){return e<2}function he(e,t){const r=(t.filters||[]).filter(n.aN),i=r[r.length-1];return i?h.Xh(i):(0,x.Me)(e)}function ge(e,t,r,i){const o=[...t.filters||[]],n=e(o);return r(i,{...t,filters:o}),n}function me(e,t){return(0,n.$1)(e)&&0===t}function fe(e){let{props:t}=e;const r=(0,_.jsx)(de,{icon:c.R});return(0,_.jsx)(Z.Z,{focused:!1,...t,icon:r,title:(0,_.jsx)(z,{})})}function xe(e){let{props:t}=e;const r=(0,_.jsx)(de,{icon:s.t});return(0,_.jsx)(Z.Z,{focused:!1,...t,icon:r,title:(0,_.jsx)(m.FormattedMessage,{defaultMessage:"Add filter group",id:"database.filterMenu.addFilterGroup2ButtonTitle"}),caption:(0,_.jsx)(m.FormattedMessage,{defaultMessage:"A group to nest more filters",id:"database.filterMenu.addFilterGroupButtonCaption"})})}le.displayName="CollectionFilterCombinatorGrid"},49068:(e,t,r)=>{r.d(t,{Z:()=>q,$:()=>z});var i=r(67294),o=r(83355),n=r(480),s=r(86628),l=r(66897),a=r(76205),p=r(99036),d=r(80951),c=r(84619),u=r(40506),h=r(76725),g=r(32056),m=r(96367),f=r(97880),x=r(82990),v=r(68939),y=r(50906),M=r(17335),j=r(29376),b=r(51757),F=r(6758),C=r(56416),w=r(68834),S=r(49085),Z=r(8982),V=r(36488),T=r(74194),P=r(68894),I=r(85893);const _=(0,v.defineMessages)({value:{defaultMessage:"Value",id:"database.filterAndSort.propertyValueInput.placeholder"}});class A extends o.Z{constructor(){super(...arguments),this.storeTypes={isEditing:S.default.createClass(!1)},this.input=null,this.handleClick=()=>{this.stores.isEditing.setState(!0)},this.handleInputBlur=()=>{this.stores.isEditing.setState(!1)},this.handleInputCancel=()=>{this.input&&(this.input.handleBlur(),this.handleInputBlur())},this.handleInputChange=e=>{const t=e.target.value;this.props.onChange(t)}}renderComponent(){return(0,I.jsx)("div",{style:{display:"flex",margin:0,width:"100%",height:"100%",transition:"background 120ms ease-in"},onClick:this.handleClick,children:this.renderInput()})}renderInput(){const{device:e}=this.environment,t=this.stores.isEditing.state,r=this.props.value||"",{intl:i}=this.props;return e.isMobile?(0,I.jsx)(P.ZP,{value:r,onChange:this.handleInputChange,placeholder:i.formatMessage(_.value),onBlur:this.handleInputBlur,rightMobileEditLabel:(0,I.jsx)(v.FormattedMessage,{defaultMessage:"Edit",id:"database.filterAndSort.mobileEditButton.label"})}):(0,I.jsx)(Z.i,{action:()=>this.stores.isEditing.setState(!0),render:e=>(0,I.jsx)("div",{ref:e.ref,onMouseEnter:e.onMouseEnter,style:{background:e.focused&&!t?this.theme.buttonHoveredBackground:"transparent",margin:0,width:"100%",height:"100%",transition:"background 120ms ease-in"},children:(0,I.jsx)(V.Z,{capture:t,render:e=>(0,I.jsx)("div",{...e,style:{margin:0,width:"100%",height:"100%",transition:"background 120ms ease-in"},children:(0,I.jsx)(T.Z,{focus:t,ref:e=>this.input=e,value:r,onChange:this.handleInputChange,placeholder:i.formatMessage(_.value),onBlur:this.handleInputBlur,onCancel:this.handleInputCancel,style:{marginRight:8,paddingLeft:6,paddingRight:0,width:80,height:30,...{margin:0,width:"100%",height:"100%",transition:"background 120ms ease-in"},minWidth:F.bU}})})})})})}}A.displayName="CollectionOperatorValueInput";const k=(0,v.injectIntl)(A);var O=r(26909),R=r(52275),B=r(31945),G=r(60458),D=r(45959),U=r(92864),E=r(89845),W=r(62045),$=r(10009),Q=r(14390),N=r(22084);const L=(0,v.defineMessages)({dateTitle:{defaultMessage:"Date",id:"database.filterMenu.mobileDateSelectMenu.title"},emptyPlaceholder:{defaultMessage:"Empty",id:"database.filterMenu.dateSelectMenu.emptyPlaceholder"}});class K extends o.Z{constructor(){super(...arguments),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,property:t,parentStore:r}=this.props,i=e[t];if(i&&(0,p.p_)(i))return(0,j.ke)(i,r)}))}renderComponent(){const{filter:e,property:t,collectionViewId:r,schema:i,parentStore:o}=this.props,n=this.props.filterValueType,s=(0,I.jsx)("span",{});if("date"===n)return(0,a.gE)(e)?(0,a.mv)(e)?s:(0,a.TQ)(e)?(0,I.jsx)(oe,{intl:this.props.intl,parentStore:this.props.parentStore,schema:this.props.schema,collectionViewId:this.props.collectionViewId,property:this.props.property,onChange:this.props.onChange,collectionViewType:this.props.collectionViewType,filter:e}):(0,I.jsx)(ie,{intl:this.props.intl,collectionViewId:this.props.collectionViewId,property:this.props.property,schema:this.props.schema,parentStore:this.props.parentStore,onChange:this.props.onChange,collectionViewType:this.props.collectionViewType,filter:e}):s;if("text"===n){if(!(0,a.Ly)(e))return s;const t=e;if((0,a.mv)(t))return s;if("string_has_no_alphabet_prefix"===t.operator)return;const r=t.value;return(0,I.jsx)(k,{value:r.value,onChange:e=>{const r={type:"exact",value:e},i={...t,value:r};this.props.onChange(i)}})}if("number"===n){if(!(0,a.h6)(e))return s;const t=e;if((0,a.mv)(t))return s;const r=t.value;return(0,I.jsx)(k,{value:void 0===r.value?"":r.value.toString(),onChange:e=>{const r={type:"exact",value:(0,g.p3)(e)},i={...t,value:r};this.props.onChange(i)}})}if("checkbox"===n){if(!(0,a.XA)(e)||!r)return s;const n=e,l=n.value;return(0,I.jsx)(B.ZP,{popupType:this.environment.device.isMobile?B.Z4.SlideUp:B.Z4.Popup,renderOrigin:e=>(0,I.jsx)(H,{operatorValue:l,events:e}),render:e=>(0,I.jsx)(C.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:n},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:o,context:C.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("select"===n||"multi_select"===n||"status"===n){if(!((0,a.dx)(e)||(0,a.NU)(e)||(0,a.r2)(e))||!r)return s;const n=e;if((0,a.mv)(n))return s;const l=this.props.schema[this.props.property];if(!l)return s;const p=(0,a.dx)(n)?(0,a.mg)(n):(0,a.NU)(n)?(0,a.qC)(n):(0,a.Js)(l,(0,a.wB)(n));return(0,I.jsx)(B.ZP,{popupType:this.environment.device.isMobile?B.Z4.SlideUp:B.Z4.Popup,renderOrigin:e=>(0,I.jsx)(re,{schema:this.props.schema,property:this.props.property,operatorValues:p,events:e}),render:e=>(0,I.jsx)(C.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:n},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:o,context:C.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("location"===n){if(!(0,a.Mp)(e))return s;const n=e,l=(0,a.u0)(n);return(0,I.jsx)(B.ZP,{popupType:this.environment.device.isMobile?B.Z4.SlideUp:B.Z4.Popup,renderOrigin:e=>(0,I.jsx)(ee,{parentStore:this.props.parentStore,operatorValues:l,events:e}),render:e=>(0,I.jsx)(C.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:n},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:o,context:C.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("relation"===n){if(!(0,a.e)(e)||!r)return s;const n=e;if((0,a.mv)(n))return s;const l=(0,a.YO)(n);return(0,I.jsx)(B.ZP,{popupType:this.environment.device.isMobile?B.Z4.SlideUp:B.Z4.Popup,renderOrigin:e=>this.renderRelationOrigin(l,e),render:e=>(0,I.jsx)(C.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:n},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:o,context:C.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("person"===n){if(!(0,a.Gb)(e)||!r)return s;const n=e;if((0,a.mv)(n))return s;const l=(0,a.R8)(n);return(0,I.jsx)(B.ZP,{popupType:this.environment.device.isMobile?B.Z4.SlideUp:B.Z4.Popup,renderOrigin:e=>(0,I.jsx)(se,{parentStore:this.props.parentStore,operatorValues:l,events:e}),render:e=>(0,I.jsx)(C.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:n},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:o,context:C.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("file"===n){if(!(0,a.W6)(e))return s;const t=e;if((0,a.mv)(t))return s;(0,f.t1)(t)}if("verification"===n)return(0,a.Jw)(e)?(0,I.jsx)(B.ZP,{popupType:this.environment.device.isMobile?B.Z4.SlideUp:B.Z4.Popup,renderOrigin:t=>(0,I.jsx)(Y,{operatorValues:(0,a.fl)(e),events:t}),render:n=>(0,I.jsx)(C.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:e},schema:i,onChange:e=>{this.props.onChange(e)},onClose:n.close,parentStore:o,context:C.Qv.AdvancedFilter,allowRelativePersonFilter:!1})}):s;(0,f.t1)(n)}renderRelationOrigin(e,t){const{device:r}=this.environment;return(0,I.jsx)(W.Z,{...t,disableMargins:!0,desktopStyle:J(),innerStyle:X(e.length>0),placeholder:(0,I.jsx)(v.FormattedMessage,{defaultMessage:"Select a page",id:"databaseRelationOperators.selectPlaceholder"}),title:e.length>0&&e.map(((e,t)=>{if(!e.value)return;const i=e.type,o={isSingle:!1,shouldShrink:!1,format:r.isMobile?c.lo.Large:c.lo.Medium};if("exact"===i)return(0,I.jsx)($.Z,{blockId:e.value,parentStore:this.props.parentStore,...o},e.value);if("relative"===i){const r=this.getRelatedCollectionAppConfigUri.state;if(!r)return;return(0,I.jsx)(c.ZP,{value:(0,I.jsx)(v.FormattedMessage,{...m.qB[r][e.value.variable].messageDescriptor}),backgroundColor:"transparent",theme:this.theme,...o},t)}(0,f.t1)(i)}))})}}function z(e){return e?(0,I.jsx)(v.FormattedMessage,{defaultMessage:"Select one person",id:"database.personPropertyValue.selectPerson.searchPlaceholderWithLimit"}):(0,I.jsx)(v.FormattedMessage,{defaultMessage:"Select one or more people",id:"database.personPropertyValue.selectPerson.searchPlaceholder"})}K.displayName="CollectionFilterMenuFilterOperatorValue";const q=(0,v.injectIntl)(K);function J(){return{maxWidth:F.oe}}function X(e){return{paddingTop:e?6:void 0,overflow:"hidden"}}function H(e){let{operatorValue:t,events:r}=e;const i=null==t?void 0:t.value;return(0,I.jsx)(W.Z,{...r,disableMargins:!0,placeholder:(0,I.jsx)(v.FormattedMessage,{defaultMessage:"Select a value",id:"database.filterOperatorValue.checkboxPlaceholder.title"}),title:"boolean"==typeof i&&(0,I.jsx)(G.Z,{checked:i,size:16,disabled:!0})})}function Y(e){let{operatorValues:t,events:r}=e;const i=t.filter((e=>{let{value:t}=e;return Boolean(t)})).map(M.cq);return(0,I.jsx)(W.Z,{...r,disableMargins:!0,placeholder:(0,I.jsx)(v.FormattedMessage,{defaultMessage:"Select an option",id:"CollectionFilterMenuFilterOperatorValue.verificationFilterSelect.placeholder"}),title:i.length&&(0,I.jsx)("span",{children:(0,h.Z)(i,(e=>(0,I.jsx)("span",{style:{whiteSpace:"pre"},children:(0,I.jsx)(v.FormattedMessage,{defaultMessage:", ",id:"CollectionFilterMenuFilterOperatorValue.verificationFilterSelect.commaSeparator"})},e)))})})}function ee(e){let{operatorValues:t,events:r,parentStore:i}=e;return(0,I.jsx)(W.Z,{...r,disableMargins:!0,desktopStyle:J(),innerStyle:X(t.length>0),placeholder:(0,I.jsx)(v.FormattedMessage,{defaultMessage:"Select a location",id:"databaseLocationOperators.selectPlaceholder"}),title:t.length>0&&t.map((e=>e.value&&(0,I.jsx)("div",{style:{margin:"0 10px 6px 0"},children:(0,I.jsx)(w.Z,{collectionStore:b.NW.createChildStore(i,{table:"collection",id:e.value})})},e.value)))})}function te(e){let{operatorValue:t,events:r,isRange:i,schema:o,property:n}=e;const s=o[n],l=s&&"date"===s.type?s.date_format:void 0;let a;if("exact"===t.type&&t.value)if((0,u.J_)(t.value))a=t.value;else if((0,u.gR)(t.value)){const e=(0,u.Gc)(t.value);e&&(a=e.value)}return(0,I.jsx)(W.Z,{...r,placeholder:i?(0,I.jsx)(v.FormattedMessage,{defaultMessage:"Select a range",id:"database.filterAndSort.dateRangePropertyValue.placeholder"}):(0,I.jsx)(v.FormattedMessage,{defaultMessage:"Select a date",id:"database.filterAndSort.datePropertyValue.placeholder"}),desktopStyle:{minWidth:165},title:a&&(0,I.jsx)("span",{style:{...x.Z.textOverflowStyle},children:(0,I.jsx)(E.Z,{value:a,dateFormat:l||u.sF})}),disableMargins:!0})}function re(e){let{operatorValues:t,events:r,schema:i,property:o}=e;window.__c={n:"SelectOrigin"};const s=(0,n.O7)(),{device:l}=s,a=i[o],u=a&&((0,p.cu)(a)||"status"===a.type)&&a.options||[];return(0,I.jsx)(W.Z,{...r,disableMargins:!0,desktopStyle:J(),innerStyle:X(t.length>0),placeholder:(0,I.jsx)(v.FormattedMessage,{defaultMessage:"Select an option",id:"collections.operatorValueSelect.placeholder"}),title:t.length>0&&(0,I.jsx)(I.Fragment,{children:t.map((e=>{if(void 0===e.value)return null;const t=(0,d.i7)(u,e.value);return t?(0,I.jsx)(N.a,{format:l.isMobile?c.lo.Large:c.lo.Medium,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!1},e.value):null}))})})}function ie(e){let{filter:t,intl:r,collectionViewId:o,property:s,schema:l,parentStore:p,onChange:d,collectionViewType:c}=e;window.__c={n:"DateFilterOperatorValueComponent"};const u=(0,n.O7)();if(!o)return null;const h={menuTitle:r.formatMessage(L.dateTitle),items:a.tO,getKey:e=>"relative"===e.type?e.value:e.type,selectedItem:t.value,onSelect:e=>{const r={...t,value:e};d(r),y.wds(u,{view_type:c,action:"set_filter_value_type"})},renderItem:e=>(0,I.jsx)(R.Z,{title:(0,M.x)(e.value),...e}),renderOrigin:e=>(0,I.jsx)(W.Z,{...e,disableMargins:!0,placeholder:r.formatMessage(L.emptyPlaceholder),title:(0,M.x)(t.value)})},g=t.value;if("exact"===g.type){const e=(0,I.jsx)(i.Fragment,{children:(0,I.jsx)(v.FormattedMessage,{id:"collectionFilterMenuFilterOperatorValue.date.exact.order",defaultMessage:"{exact}{dateValue}",values:{exact:(0,I.jsx)(D.Z,{...h,mobileActionSheet:!0},"date-filter-value-type"),dateValue:(0,I.jsx)(B.ZP,{popupType:u.device.isMobile?B.Z4.SlideUp:B.Z4.Popup,renderOrigin:e=>(0,I.jsx)(te,{schema:l,property:s,operatorValue:g,events:e,isRange:!1}),render:e=>(0,I.jsx)(C.ZP,{collectionViewId:o,propertyFilter:{property:s,filter:t},schema:l,onChange:e=>{d(e)},onClose:e.close,parentStore:p,context:C.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}})}),r=u.device.isDesktop?{display:"grid",justifyContent:"stretch",gridTemplateColumns:"1fr 1fr",gridColumnGap:O.l0,width:"100%"}:void 0;return(0,I.jsx)("div",{style:r,children:e})}return(0,I.jsx)(D.Z,{...h,mobileActionSheet:!0},"date-filter-value-type")}function oe(e){let{filter:t,intl:r,parentStore:o,schema:s,collectionViewId:l,property:p,onChange:d,collectionViewType:c}=e;window.__c={n:"DateRangeFilterOperatorValueComponent"};const u=(0,n.O7)();if(!l)return null;const h={menuTitle:r.formatMessage(L.dateTitle),items:(0,a.bS)(),getKey:e=>(0,a.eX)(e),selectedItem:t.value,onSelect:e=>{const r={...t,value:e};d(r),y.wds(u,{view_type:c,action:"set_filter_value_type"})},renderItem:e=>(0,I.jsx)(R.Z,{title:(0,M.ip)(e.value),...e}),renderOrigin:e=>(0,I.jsx)(W.Z,{...e,disableMargins:!0,placeholder:r.formatMessage(L.emptyPlaceholder),title:(0,M.ip)(t.value)})},g=t.value;if("exact"===g.type){const e=(0,I.jsx)(i.Fragment,{children:(0,I.jsx)(v.FormattedMessage,{id:"collectionFilterMenuFilterOperatorValue.dateRange.exact.order",defaultMessage:"{dateValue}",values:{exact:(0,I.jsx)(D.Z,{...h,mobileActionSheet:!0},"date-filter-value-type"),dateValue:(0,I.jsx)(B.ZP,{popupType:u.device.isMobile?B.Z4.SlideUp:B.Z4.Popup,renderOrigin:e=>(0,I.jsx)(te,{schema:s,property:p,operatorValue:g,events:e,isRange:!0}),render:e=>(0,I.jsx)(C.ZP,{collectionViewId:l,propertyFilter:{property:p,filter:t},schema:s,onChange:e=>{d(e)},onClose:e.close,parentStore:o,context:C.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}})}),r=u.device.isDesktop?{display:"grid",justifyContent:"stretch",gridTemplateColumns:"1fr 1fr",gridColumnGap:O.l0,width:"100%"}:void 0;return(0,I.jsx)("div",{style:r,children:e})}return"relative"!==g.type||"custom"!==g.value&&"surrounding"!==g.value?(0,I.jsx)(D.Z,{...h,mobileActionSheet:!0},"date-filter-value-type"):(0,I.jsx)(Q.b,{renderAsQueryDropdown:u.device.isMobile,filter:g,onUpdate:e=>{const r={...t,value:e};d(r),y.wds(u,{view_type:c,action:"set_filter_value_type"})}})}function ne(e){var t;let{operatorValue:r,parentStore:i}=e;window.__c={n:"PersonInnerComponent"};const o=(0,n.O7)(),{device:a}=o,p=(0,s.VK)((()=>!r.value||"relative"===r.type&&"me"===r.value?void 0:(0,l.Hl)({pointer:r.value,getRecordValue:i.getRecordValue})),[r,i]);return r.value?"relative"===r.type&&"me"===r.value?(0,I.jsx)("span",{style:{marginTop:1,marginRight:10,marginBottom:6},children:(0,I.jsx)(v.FormattedMessage,{defaultMessage:"Me",id:"database.filterAndSort.firstPersonPropertyValue.title"},"relative")}):p?(0,I.jsx)(U.ZP,{actor:p,isSingle:!1,shouldShrink:!1,format:a.isMobile?U.vw.Format.Large:U.vw.Format.Medium,showRemoveButton:!1},null===(t=p.asActor)||void 0===t?void 0:t.id):null:null}function se(e){let{operatorValues:t,events:r,parentStore:i}=e;return(0,I.jsx)(W.Z,{...r,placeholder:z(void 0),disableMargins:!0,desktopStyle:J(),innerStyle:X(t.length>0),title:t.length>0&&t.map((e=>(0,I.jsx)(ne,{operatorValue:e,parentStore:i},`${e.type}__${e.value}`)))})}},50542:(e,t,r)=>{r.d(t,{Z:()=>d});r(67294);var i=r(480),o=r(68939),n=r(52275),s=r(97820),l=r(69872),a=r(62045),p=r(85893);const d=function(e){window.__c={n:"QueryMenuPropertyItem"};const t=(0,i.O7)(),{device:r}=t;if(r.isMobile)return e.propertySchema?(0,p.jsx)(l.Z,{propertySchema:e.propertySchema,onClick:e.onClick,focused:!1,format:l.Z.DisplayFormat.Name,showExtensionArrow:!e.disabled}):(0,p.jsx)(n.Z,{focused:!1,title:(0,p.jsx)(o.FormattedMessage,{defaultMessage:"Property",id:"database.mobileFilterAndSortMenu.property.buttonMenuItem.label"})});{const t=e.propertySchema&&(0,p.jsx)(s.Z,{propertySchema:e.propertySchema,showIcon:!0,style:{lineHeight:1.4}}),r=(0,p.jsx)(o.FormattedMessage,{defaultMessage:"Property",id:"database.filterAndSortMenu.propertyButton.label"});return(0,p.jsx)(a.Z,{title:t,placeholder:r,onClick:e.onClick,disabled:e.disabled,disableMargins:e.disableMargins,desktopStyle:e.textWrapperStyle})}}}}]);