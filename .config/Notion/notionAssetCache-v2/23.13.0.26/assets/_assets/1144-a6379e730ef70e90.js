"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[1144],{33932:(e,t,n)=>{n.r(t),n.d(t,{closeAssistantRightHandSideMenu:()=>u,navigateToView:()=>d,openAssistantRightHandSideMenu:()=>c});n(21703);var s=n(97880),i=n(21273),a=n(98180),o=n(56206),r=n(50929),l=n(28344);function d(e){o.d.setState({...o.d.state,currentView:e.view})}async function c(e){const{environment:t,from:n}=e,d=i.Z.isAssistantExperienceQna();let c=a.Z.getActiveSessionId();const u=d&&a.Z.wasActiveSessionLastOpenedOutsideOfHistorySavedWindow();if(!c||u){c=(await(0,r.resetAndInitializeAssistantSession)({environment:t})).sessionId}if(d&&(0,s.$K)(n)){const e=a.Z.getSessionContextOrThrow(c),s=e.assistantConfigurationStore.state;if(!s)throw new Error("No configuration state");l.trackQnAOpened(t,{configurationState:s,runtimeState:e.assistantRuntimeStore.state,hasQuery:!1,from:n,searchSessionId:void 0})}(0,r.updateAssistantTimestampsAfterSessionInitialization)({environment:t}),o.d.setState({open:!0,currentView:"chat"})}function u(){o.d.setState({...o.d.state,open:!1})}},70771:(e,t,n)=>{n.d(t,{Cc:()=>g,K7:()=>u,Nt:()=>m,OZ:()=>p});n(21703),n(41432);var s=n(4615),i=(n(71644),n(21202),n(6287),n(13493),n(91644),n(19889),n(70203),n(54642)),a=(n(94419),n(9953)),o=(n(80444),n(98180)),r=n(82375),l=n(89912),d=n(50929),c=n(33932);async function u(e){const{environment:t,spaceId:n}=e,s=await i.getSkillsInSpace(t,{spaceId:n});if("success"!==s.type)throw new Error("Failed to fetch skills in space.");const{skillIds:a}=s.data;l.L.setState({...l.L.state,serverSkillIds:new Set(a)})}async function p(e){var t;const{environment:n,clientSkill:i}=e,a=r.Pl.state,l=Boolean(a);if(!i.inAppSkillTrigger)return;(0,c.navigateToView)({view:"chat"});const{sessionId:u}=await(0,d.resetAndInitializeAssistantSession)({environment:n,isLabelerSlackMode:l,fakeSlackChannel:null==a?void 0:a.selectedFakeChannel,clientSkill:i,skillSettings:{}});if(!(null===(t=o.Z.getSessionContextOrThrow(u).assistantRuntimeStore.state)||void 0===t?void 0:t.evaluator))throw new Error("No evaluator.");i.inAppSkillTrigger.requiresInput||await(0,d.sampleNextAssistantSteps)({environment:n,inferenceId:(0,s.ZP)(),sessionId:u})}function g(e){const{store:t,update:n,transaction:s}=e;a.sW({store:t.getSettingsStore(),data:n,transaction:s})}function m(e){const{store:t,transaction:n}=e;a.sW({store:t,data:{alive:!1},transaction:n})}},26382:(e,t,n)=>{n.r(t),n.d(t,{AssistantFullPageChat:()=>Me,AssistantLabelerBar:()=>N,AssistantMenuPopup:()=>Fe,AssistantOriginElement:()=>be,AssistantWriterInProgressContent:()=>w,AssistantWriterPopupRenderer:()=>v,SearchAssistantPane:()=>qe,assistantActions:()=>s,assistantAnalyticsActions:()=>i,assistantMenuActions:()=>a,assistantMenuStore:()=>r.d,assistantOriginElementStore:()=>l.N,clientSkillHelpers:()=>o});var s=n(50929),i=n(28344),a=n(33932),o=n(27967),r=n(56206),l=n(40824),d=(n(67635),n(67294)),c=n(86628),u=n(24405),p=n(68939),g=n(80444),m=n(98180),h=n(67973),S=n(84969),f=n(85893);function v(e){window.__c={n:"AssistantWriterPopupRenderer"};const t=(0,p.useIntl)(),n=(0,c.VK)((()=>g.default.state.currentSpaceStore),[]),s=(0,c.VK)((()=>m.Z.getActiveAssistantConfigurationState()),[]),i=(0,c.VK)((()=>m.Z.getActiveAssistantRuntimeState()),[]),a=(0,c.VK)((()=>{if(i)return i.temporaryClientSteps.findLast((e=>"assistantChat"===e.type))}),[i],{useDeepEqual:!0}),r=(0,c.qz)(void 0,h.d),l=(0,u.yK)((e=>({defaultMessageWrap:{padding:"3px 2px"}})),[]);return n&&s&&i?(0,f.jsxs)(f.Fragment,{children:[i.selectedSkill&&0===i.clientSteps.length&&o.skillDefaultAssistantMessageMap[i.selectedSkill.skillType]&&(0,f.jsx)("div",{style:l.defaultMessageWrap,children:t.formatMessage(o.skillDefaultAssistantMessageMap[i.selectedSkill.skillType])}),a&&(0,f.jsx)(S.m,{clientStep:a,parentStore:n,configurationState:s,fakeSlackUser:void 0,isLatestStep:!0,isQuickSearchMode:!1,renderAsFullPage:!1,priorSearchResultsStep:void 0,citationHoverStore:r,disableWrap:!0})]}):null}var x=n(88709),y=n(94486),k=n(16540);function w(e){window.__c={n:"AssistantWriterInProgressContent"};const t=(0,c.VK)((()=>g.default.state.currentSpaceStore),[]),n=(0,c.VK)((()=>m.Z.getActiveAssistantConfigurationState()),[]),s=(0,c.VK)((()=>m.Z.getActiveAssistantRuntimeState()),[]),i=(0,x.f6)({assistantRuntimeState:s,assistantConfigurationState:n}),a=(0,c.qz)(void 0,h.d);return t&&n&&s?(0,f.jsx)("div",{style:{minHeight:36},children:"searchResults"===(null==i?void 0:i.type)?(0,f.jsx)(k.N,{clientStep:i.step,parentStore:t,configurationState:n,citationHoverStore:a,isQuickSearchMode:!1,renderAsFullPage:!1}):(0,f.jsx)(y.H,{clientStep:{type:"assistantLoading"},parentStore:t,parentSpaceId:t.id,configurationState:n,isQuickSearchMode:!1,renderAsFullPage:!1,latestStepCitationHoverStore:a})}):null}var b=n(480),C=n(94568),A=n(42875),j=n(59054),I=n(72126),M=n(21202),Z=n(70203),T=n(82990),F=n(54642),R=n(98104),B=n(52275),P=n(88359),_=n(1743),K=n(74194),L=n(84076),V=n(68785),E=n(63296),W=n(53437),O=n(45959),H=n(95477),Q=n(82375),D=n(51757),z=n(24666);function N(){window.__c={n:"AssistantLabelerBar"};const e=(0,b.O7)(),t=(0,u.yK)((e=>({wrap:{padding:8,backgroundColor:e.contentBackground,width:400},samplingPicker:{display:"flex",alignItems:"center",marginBottom:8,gap:4},error:{fontSize:14,color:e.accentColors.red[600],maxHeight:150,overflow:"scroll"},observation:{fontSize:14,maxHeight:150,overflow:"scroll"},tooltip:{width:500,whiteSpace:"pre-wrap",fontFamily:T.Z.baseFontFamily.mono},input:{marginTop:5,marginBottom:5,fontFamily:T.Z.baseFontFamily.githubMono,fontSize:12},inputInner:{height:100}})),[]),n=(0,c.VK)((()=>Q.Hl.state),[]),i=(0,c.VK)((()=>m.Z.getActiveAssistantRuntimeState()),[]),a=(0,c.VK)((()=>m.Z.getActiveAssistantConfigurationState()),[]),o=(0,c.VK)((()=>Boolean(i&&i.sampledSteps.length>0)),[i]),r=(0,c.VK)((()=>Boolean(a&&(a.sampling||a.evaluating))),[a]),l=(0,c.VK)((()=>null==i?void 0:i.previewingStepIndex),[i]),p=(0,c.VK)((()=>{const e=null==i?void 0:i.previewingStepIndex;var t;if("number"==typeof e)return null==i||null===(t=i.sampledSteps)||void 0===t?void 0:t[e]}),[i],{useDeepEqual:!0}),g=(0,c.VK)((()=>(null==i?void 0:i.previewingStepObservations)||[]),[i],{useDeepEqual:!0}),h=g.filter((e=>"error"===e.observationType)),S=g.filter((e=>"error"!==e.observationType)),v=(0,d.useCallback)((()=>{const e=m.Z.getActiveSessionId();e&&s.cancelPreviewStep({sessionId:e})}),[]),x=(0,d.useCallback)((async t=>{const n=m.Z.getActiveSessionId(),i=m.Z.getActiveAssistantRuntimeStore();if(!p||!i||!n)return;const a={...p,value:t.target.value};(0,Q.zZ)({store:i,step:a}),await s.simulateOrCommitStep({environment:e,step:a,commit:!1,isStreaming:!1,preventSelection:!0,sessionId:n})}),[e,p]),y=(0,d.useCallback)((async t=>{const n=m.Z.getActiveSessionId(),i=m.Z.getActiveAssistantRuntimeState();i&&n&&await s.simulateOrCommitStep({environment:e,step:i.sampledSteps[t],commit:!1,isStreaming:!1,sessionId:n})}),[e]),k=(0,d.useCallback)((async()=>{const t=m.Z.getActiveSessionId(),n=m.Z.getActiveAssistantRuntimeState();if(!n||!t)return;const i=n.previewingStepObservations.length>0;await s.commitPreviewAssistantStep({environment:e,sessionId:t}),i||await s.applyUncommittedOperations({environment:e,sessionId:t})}),[e]),w=(0,d.useCallback)((async()=>{const t=m.Z.getActiveSessionId();t&&await s.retryNextAssistantSteps({environment:e,sessionId:t})}),[e]),C=(0,c.VK)((()=>({top:20,left:0,right:0,bottom:0,width:e.WindowSizeStore.state.width,height:0})),[e],{useDeepEqual:!0}),[A,j]=(0,d.useState)(!1),I=(0,d.useCallback)((()=>{z.default.hasSelection()&&R.ZH(e),j(!0)}),[e,j]),M=(0,d.useCallback)((()=>{j(!1)}),[j]),Z=H.default.isLocalhost||!1;return(0,f.jsx)(W.ZP,{popupType:W.kQ.Popup,open:!0,originRect:C,originGap:6,disableMouseCapture:!0,render:()=>(0,f.jsx)(_.Z,{capture:A,children:(0,f.jsxs)("div",{style:t.wrap,children:[(0,f.jsx)(U,{}),o&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{style:t.samplingPicker,children:[(0,f.jsx)(E.Z,{hovered:void 0===l||void 0,onClick:v,children:"Original"}),(0,f.jsx)(E.Z,{hovered:0===l||void 0,onClick:()=>y(0),children:"A"}),(0,f.jsx)(E.Z,{hovered:1===l||void 0,onClick:()=>y(1),children:"B"}),(0,f.jsx)("div",{style:{flexGrow:1}}),r&&(0,f.jsx)(V.Z,{style:{marginRight:4}}),(0,f.jsx)(E.Z,{disabled:!Z&&(void 0===l||r||!n),disabledFeedback:!0,onClick:w,children:"Retry"}),(0,f.jsx)(E.Z,{disabled:!Z&&(void 0===l||r||!n),disabledFeedback:!0,onClick:k,isBlue:!0,children:"Accept"})]}),p&&(0,f.jsx)(K.Z,{style:t.input,inputStyle:t.inputInner,value:p.value,onChange:x,onFocus:I,onBlur:M,textarea:!0,spellCheck:!1}),h.length>0&&!r&&(0,f.jsx)("div",{style:t.error,children:h.map((e=>e.value)).join("\n")}),S.length>0&&!r&&(0,f.jsxs)("div",{style:t.observation,children:["Results: ",S.map((e=>e.value)).join("\n")]})]})]})})})}function U(e){var t;window.__c={n:"TaskPicker"};const n=(0,b.O7)(),s=(0,c.VK)((()=>Q.Hl.state),[]),[i]=(0,j.r5)((async()=>{const e="results",t={type:"reducer",filter:{operator:"and",filters:[{property:"ouFf",filter:{operator:"status_is",value:{type:"is_group",value:"In progress"}}}]},sort:[],userId:n.currentUser.id,userTimeZone:(0,A.r)(),searchQuery:void 0,reducers:{[e]:{type:"results",limit:100}}},s=await F.queryCollection(n,{source:{type:"collection",id:"f704a995-6417-457a-8038-ca9e1cb2c65f",spaceId:C.vj},collectionView:{id:"1dee420b-aa96-4e48-8eba-c2a0613e179e",spaceId:C.vj},loader:t},void 0,{src:"queryCollectionAction"});if("failed"===s.type)return;const i=s.data.result.reducerResults.results;if(!i||"results"!==i.type)return;const{blockIds:a}=i;let o=I.oA(a.map((e=>new D.G(n,{table:M.iU,id:e}).getValue()))).map((e=>{var t,n,s;return{id:e.id,name:(0,Z.QaF)(null==e||null===(t=e.properties)||void 0===t?void 0:t.title),url:(0,Z.QaF)(null==e||null===(n=e.properties)||void 0===n?void 0:n["}v_K"]),type:(0,Z.QaF)(null==e||null===(s=e.properties)||void 0===s?void 0:s.pdfW)}}));return o=I.MR(o,(e=>e.name.toLowerCase())),o}),[n]),a=(0,d.useCallback)((e=>{var t;const n=null===(t=i.value)||void 0===t?void 0:t.find((t=>t.id===e));n&&Q.Hl.setState(n)}),[i]),o={menuTitle:"",items:(null===(t=i.value)||void 0===t?void 0:t.map((e=>e.id)))??[],getKey:e=>e,selectedItem:null==s?void 0:s.id,onSelect:a,renderItem:e=>{var t;const n=null===(t=i.value)||void 0===t?void 0:t.find((t=>t.id===e.value));return(0,f.jsx)(B.Z,{...e,title:null==n?void 0:n.name})},renderOrigin:e=>(0,f.jsx)(P.Z,{focused:!1,title:"",right:(null==s?void 0:s.name)||(0,f.jsx)("span",{style:{color:"red"},children:"Please select a task"}),...e}),width:300},r=(0,u.yK)((e=>({wrap:{marginBottom:8},inner:{display:"flex",alignItems:"center",marginBottom:4,gap:4},label:{fontSize:14,flexShrink:0},link:{fontSize:14,textDecoration:"underline"}})),[]);return(0,f.jsxs)("div",{style:r.wrap,children:[(0,f.jsxs)("div",{style:r.inner,children:[(0,f.jsx)("div",{style:r.label,children:"Current task:"}),(0,f.jsx)(O.Z,{...o})]}),s&&(0,f.jsx)(L.Z,{style:r.link,href:s.url,external:!0,children:"Instructions for task"})]})}var q=n(22081),$=n(49628),G=n(5257),Y=n(11751),J=n(97880),X=n(63143),ee=n(51454),te=n(44458),ne=n(16091),se=n(55031),ie=n(64921),ae=n(91839),oe=n(31156),re=n(28020),le=n(79897),de=n(24646),ce=n(21273),ue=n(4926),pe=n(55320),ge=(n(52262),n(30120)),me=n(39699),he=n(37181),Se=n(2551),fe=n(85844);const ve=[3,4],xe=4*X.C0;function ye(){const e=(0,b.O7)(),[t,n]=(0,d.useState)(),[s,i]=(0,d.useState)((()=>ge.ou.utc())),[a,o]=(0,d.useState)(!1),r=(0,c.VK)((()=>ce.Z.showRemindersToUseQnA()),[]);return(0,d.useEffect)((()=>{const e=setTimeout((()=>{o(!0),i(ge.ou.utc())}),xe);return()=>clearTimeout(e)}),[]),(0,Se.W)((()=>{i(ge.ou.utc())}),5*X.hM,a&&r),(0,c.VK)((()=>{if(!r)return;if(!a)return;if((0,J.$K)(t))return;if(!fe.Z.state.isVisible)return;const i=function(e){const{environment:t,now:n}=e,{currentUserSettingsStore:s}=g.default.state;if(!s)return;const i=function(e){const{currentUserSettings:t,now:n}=e;if(!(0,J.$K)(t.last_exposed_to_ai_qna_at))return;const s=t.qna_reminders_shown_at??[],i=s.length,a=ve.at(i);if(!(0,J.$K)(a))return;const o=0===i?t.last_exposed_to_ai_qna_at:s[i-1];if(n.diff(ge.ou.fromMillis(o),"days").days<a)return;if(i>0){const e=s[i-1];if(t.last_exposed_to_ai_qna_at>=e)return}return{reminder:{number:i+1},update:{qna_reminders_shown_at:[...s,n.toMillis()]}}}({currentUserSettings:{last_exposed_to_ai_qna_at:s.getSettingsStore().getKeyStore("last_exposed_to_ai_qna_at").getValue(),qna_reminders_shown_at:s.getSettingsStore().getKeyStore("qna_reminders_shown_at").getValue()},now:n});if(!(0,J.$K)(i))return;return me.createAndCommit({environment:t,userAction:"useApplicableQnaReminder.setNumQnaRemindersShown",perform:e=>{he.d2({userSettingsStore:s,transaction:e,data:i.update})}}),i.reminder}({environment:e,now:s});(0,J.$K)(i)&&n(i)}),[r,a,t,e,s]),t}const ke=(0,p.defineMessages)({reminderToUseQnA:{id:"AssistantOriginElement.reminderToUseQnA",defaultMessage:"Find pages, get instant answers with Q&A"}}),we=2*X.hM;function be(){window.__c={n:"AssistantOriginElement"};const e=(0,b.O7)(),t=(0,u.Fg)();!function(){const e=(0,c.VK)((()=>{var e;return Boolean(null===(e=m.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.isCurrentlyCommittingHumanStep)}),[]),t=(0,c.VK)((()=>l.N.state.currentState),[]);(0,d.useEffect)((()=>{let e;return"answerWaitingForUserClick"===t&&(e=setTimeout((()=>{"answerWaitingForUserClick"===l.N.state.currentState&&l.N.setState({...l.N.state,currentState:"default"})}),we)),()=>clearTimeout(e)}),[t]);const{lastStepLoadingCompletionUnixEpochMs:n,aiWindowLastSeenUnixEpochMs:s}=(0,c.VK)((()=>l.N.state),[]),i=ye(),[a,o]=(0,d.useState)(!1);(0,d.useEffect)((()=>{const t=l.N.state.currentState,r=n===-1/0||s>n;(0,J.$K)(i)&&!a?(l.N.setState({...l.N.state,currentState:"qnaReminder",reminderNumber:i.number}),o(!0)):e||r||"answerLoading"!==t||n===-1/0?e||"qnaReminder"===t||"answerLoading"!==t&&!r?!e||"default"!==t&&"qnaReminder"!==t||l.N.setState({...l.N.state,currentState:"answerLoading"}):l.N.setState({...l.N.state,currentState:"default"}):l.N.setState({...l.N.state,currentState:"answerWaitingForUserClick"})}),[s,e,n,i,a])}();const n=(0,u.yK)((e=>({faceImg:{width:16,pointerEvents:"none"}})),[]),s=(0,d.useRef)(null),i=(0,c.VK)((()=>{const{currentUserSettingsStore:t,currentSpaceStore:n,mainEditorCurrentBlockStore:s}=g.default.state;return!re.tu.state&&(!!(n&&s&&s.canRead())&&ce.Z.isQnATooltipsVisible(e.device,t))}),[e.device]),o=(0,d.useCallback)((()=>{const{currentUserSettingsStore:t}=g.default.state;t&&(0,te.C)(e,{phase:"complete",transactionUserAction:"AiQnaIntroModal.debug.clickTooltipClose",userSettingsStore:t}),l.N.setState({...l.N.state,currentState:"default"}),a.openAssistantRightHandSideMenu({environment:e,from:"button"})}),[e]),p=(0,c.VK)((()=>(0,se.y)(e,{theme:t,rightEdgeDistance:16,isInPeekRenderer:!1,width:36})),[e,t]),h=(0,d.useMemo)((()=>(0,Y.t)({...n.faceImg})),[n.faceImg]),S=(0,c.VK)((()=>{var e,t;if(ce.Z.isAssistant2Enabled(void 0))return{currentState:"default"};const n=l.N.state;return null!==(e=r.d.state)&&void 0!==e&&e.open||null!==(t=pe.default.state)&&void 0!==t&&t.open?{currentState:"default"}:n}),[]);if((0,le.A3)())return null;switch(S.currentState){case"answerLoading":return(0,f.jsx)(je,{onClick:o,isAnswerReady:!1});case"answerWaitingForUserClick":return(0,f.jsx)(je,{onClick:o,isAnswerReady:!0});case"qnaReminder":return(0,f.jsx)(Ae,{onClick:o,reminderNumber:S.reminderNumber});case"default":return(0,f.jsxs)(f.Fragment,{children:[i&&(0,f.jsx)(ne.ND,{origin:s}),(0,f.jsx)(ie.Z,{ariaLabel:"ai",className:"notion-ai-button",style:{...p,...i?{border:"3px solid #b6cce7"}:{}},hoveredStyle:{background:t.whiteButtonHoveredBackground},pressedStyle:{background:t.whiteButtonPressedBackground},onClick:o,ref:s,children:h})]});default:(0,J.t1)(S)}}function Ce(e){const{rightEdgeDistance:t,theme:n,environment:s,isInPeekRenderer:i,width:a,height:o,background:r,alwaysVisible:l}=e,d=(0,de.ll)(s,i)-(0,de.vJ)(s);return{position:"absolute",bottom:(0,se.G)(s,16+ue.Z.state),right:t+ue.Z.state,width:a,height:o,borderRadius:100,fontSize:20,boxShadow:n.lightBoxShadow,zIndex:ee.hT,background:r,backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",backgroundBlendMode:"overlay, normal",opacity:re.tu.state&&!l?0:1,transform:`translateX(-${d}px) translateZ(0)`,transition:`\n\t\t\topacity ${oe.nk}ms,\n\t\t\tcolor ${oe.nk}ms,\n\t\t\ttransform 200ms\n\t\t`}}function Ae(e){window.__c={n:"QnaReminderElement"};const{onClick:t,reminderNumber:n}=e,s=(0,u.Fg)(),a=(0,b.O7)(),o=(0,c.VK)((()=>Ce({rightEdgeDistance:16,isInPeekRenderer:!1,width:void 0,height:36,environment:a,theme:s,background:s.whiteButtonBackground,alwaysVisible:!0})),[a,s]),[r,l]=(0,d.useState)(!1),[g,m]=(0,d.useState)(!1),h=(0,u.yK)((e=>({buttonStyle:{...o,cursor:"pointer",overflow:"hidden",display:"flex",userSelect:"none",...r?{background:e.whiteButtonHoveredBackground}:{},...g?{background:e.whiteButtonPressedBackground}:{}},sparklesIcon:{width:16,marginRight:10},inner:{display:"flex",alignItems:"center",flexWrap:"nowrap",padding:"0 10px"},chevronIcon:{height:19,width:15,opacity:.5,marginLeft:8},message:{fontSize:T.Z.fontSize.UIRegular.desktop,textWrap:"nowrap"}})),[o,r,g]);(0,d.useEffect)((()=>{i.trackQnaReminderShown(a,{number:n})}),[a,n]);const S=(0,d.useCallback)((()=>{l(!1),m(!1)}),[]),v=(0,d.useCallback)((()=>{S(),window.removeEventListener("mouseup",v)}),[S]),x=(0,d.useCallback)((()=>{l(!0)}),[]),y=(0,d.useCallback)((()=>{l(g),m(!1)}),[g]),k=(0,d.useCallback)((()=>{m(!0),window.addEventListener("mouseup",v)}),[v]),w=(0,d.useCallback)((()=>{m(!1)}),[]);return(0,f.jsx)(q.E.div,{style:h.buttonStyle,variants:{initial:{width:36},animate:{width:"auto",transition:{ease:[.87,0,.13,1],type:"spring",stiffness:90,damping:16,mass:1}}},initial:"initial",animate:"animate",onMouseMove:x,onMouseLeave:y,onMouseDown:k,onMouseUp:w,onClick:t,children:(0,f.jsxs)("div",{style:h.inner,children:[(0,Y.t)(h.sparklesIcon),(0,f.jsx)(q.E.div,{style:h.message,variants:{initial:{opacity:0},animate:{opacity:1,transition:{ease:[.16,1,.3,1],duration:.75}}},initial:"initial",animate:"animate",children:(0,f.jsx)(p.FormattedMessage,{...ke.reminderToUseQnA})}),(0,G.o)(h.chevronIcon)]})})}function je(e){let{onClick:t,isAnswerReady:n}=e;window.__c={n:"QnaBackgroundProcessingElement"};const s=(0,u.yK)((e=>({sparklesIcon:{height:18,width:18,fill:e.regularIconColor},aiProcessingButtonTopLevelStyle:{display:"flex",alignItems:"center",flexDirection:"row",marginLeft:12.5,marginRight:14,height:52},sparklesIconWrapperStyle:{borderRadius:"100%",background:e.whiteButtonBackground,height:30,width:30,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${e.outlineButtonBorder}`,fill:e.regularIconColor},messagesWrapperStyle:{display:"flex",flexDirection:"column",justifyContent:"center",marginLeft:8},notionAiTitleStyle:{fontSize:12,fontWeight:"500",color:e.lightTextColor},answerReadyStyle:{fontSize:13,fontWeight:"500",color:e.aiPurpleColor,display:"flex",alignItems:"center"},preparingYourAnswerStyle:{fontSize:14,fontWeight:"500",color:e.aiPurpleColor},chevronRightStyle:{height:19,width:15,opacity:.2,marginLeft:"auto"}})),[]),i=(0,u.Fg)(),a=(0,b.O7)(),o=(0,c.VK)((()=>Ce({rightEdgeDistance:16,isInPeekRenderer:!1,width:278,height:52,environment:a,theme:i,background:i.aiPurpleTranslucentRadialGradientBackground})),[a,i]),[r,l]=(0,$.H)(),[g,m]=(0,$.H)(),h=(0,d.useCallback)((async()=>{await l(r.current,{width:278}),await m(g.current,{display:"block",opacity:1})}),[l,m,r,g]);(0,d.useEffect)((()=>{h()}),[h]);return(0,f.jsx)(q.E.div,{"aria-label":"ai processing",className:"notion-ai-button",onClick:t,style:{...o,cursor:"pointer",overflow:"hidden",flexWrap:"wrap"},variants:{initial:{width:28},animate:{width:278,transition:{type:"spring",stiffness:20,damping:15}}},initial:"initial",animate:"animate",ref:r,children:(0,f.jsxs)("div",{style:s.aiProcessingButtonTopLevelStyle,children:[(0,f.jsx)("div",{style:s.sparklesIconWrapperStyle,children:(0,Y.t)(s.sparklesIcon)}),(0,f.jsx)("div",{style:{...s.messagesWrapperStyle,display:"none"},ref:g,children:n?(0,f.jsx)("div",{style:s.answerReadyStyle,children:(0,f.jsx)(p.FormattedMessage,{id:"AssistantOriginElement.answerReady",defaultMessage:"Your answer is ready"})}):(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,f.jsx)("div",{style:s.preparingYourAnswerStyle,children:(0,f.jsx)(p.FormattedMessage,{id:"AssistantOriginElement.notionAiLoadingText",defaultMessage:"Preparing your answer"})}),(0,f.jsx)("div",{style:{marginLeft:6,fontWeight:"500"},children:(0,f.jsx)(ae.Z,{})})]})}),(0,G.o)(s.chevronRightStyle)]})})}var Ie=n(85075);function Me(e){window.__c={n:"AssistantFullPageChat"};const{route:t}=e,n=Boolean(t.peekViewBlockId),s=(0,b.O7)(),i=(0,c.VK)((()=>(0,de.vJ)(s)+(0,de.Wk)(s)),[s]),a=(0,u.yK)((e=>({wrap:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",paddingLeft:12,paddingRight:12,zIndex:ee.Wi,background:e.contentBackground},peekViewWrap:{display:"flex",flexDirection:"column",alignItems:"center",width:`calc(100% - ${i}px)`,paddingLeft:12,paddingRight:12}})),[i]);return(0,f.jsx)("div",{style:n?a.peekViewWrap:a.wrap,children:(0,f.jsx)(Ie.Qn,{renderAsFullPage:!0})})}var Ze=n(31945),Te=n(4023);function Fe(){window.__c={n:"AssistantMenuPopup"};const e=(0,c.VK)((()=>r.d.state.open),[]),[t,n]=(0,d.useState)(),s=(0,b.O7)(),{isMobile:i,isPhone:o}=(0,b.Fy)(),l=(0,c.VK)((()=>{const e=(0,de.ll)(s,!1)-(0,de.vJ)(s);return{bottom:15+ue.Z.state,right:15+ue.Z.state,xPosition:e}}),[s]);(0,d.useEffect)((()=>{const e=()=>{n(new DOMRect(window.innerWidth-l.right-l.xPosition,window.innerHeight-l.bottom,0,0))};return e(),addEventListener("resize",e),()=>removeEventListener("resize",e)}),[l.right,l.xPosition,l.bottom]);const p=(0,u.yK)((e=>({wrap:{borderRadius:12,boxShadow:e.largeLightBoxShadow}})),[]),g=()=>{a.closeAssistantRightHandSideMenu()};return(0,f.jsx)(W.ZP,{popupType:i?Ze.Z4.SlideUp:Ze.Z4.Popup,forceFullScreenSlideUp:i&&o,alignmentToOrigin:Te.v.End,alignBoxStyle:{transition:"left 200ms, top 200ms"},originRect:t,disableMouseCapture:!0,preventScaleTransition:!1,preventSlideUpTransition:i,keepFocus:i,popupWrapStyle:p.wrap,isWaxPaper:!0,open:e,slideUpWrapStyle:{...i&&o?{height:"var(--full-viewport-height)"}:{}},render:()=>(0,f.jsx)(Ie.Qn,{showBackButton:i,renderAsFullPage:i,onClose:g}),onDismiss:g})}var Re=n(80721),Be=n(13148),Pe=n(23063),_e=n(73063),Ke=n(36488),Le=n(56940),Ve=n(78140),Ee=n(72495),We=n(33991),Oe=n(98670),He=n(43250),Qe=n(34700),De=n(87279),ze=n(85665),Ne=n(29026),Ue=n(49053);function qe(e){window.__c={n:"SearchAssistantPane"};const t=(0,b.Fy)();return(0,ze.Z)(),(0,f.jsx)(Le.Z,{capture:!0,ignoreBlockSelection:!0,focusOffscreenInput:!1,restoreSelection:!t.isMobile,render:()=>(0,f.jsx)(Ke.Z,{capture:!0,allowMenuList:!0,render:t=>(0,f.jsx)($e,{...e,ignoreAreaEvents:t})})})}function $e(e){window.__c={n:"SearchAssistantPaneInner"};const{ignoreAreaEvents:t,renderAsPage:n,quickSearchMode:a,searchContentPaneType:o,onClose:r}=e,{modalBodyMenuRef:l}=(0,d.useContext)(We.SearchStaticContext),p=(0,b.O7)(),g=(0,c.VK)((()=>null===m.Z||void 0===m.Z?void 0:m.Z.getActiveAssistantConfigurationState()),[]),h=(0,d.useCallback)((()=>{null!=g&&g.sessionId&&i.trackQnaBackToSearch(p,{sessionId:g.sessionId}),Ne.ZP.update((e=>({...e,mode:"search"})))}),[null==g?void 0:g.sessionId,p]),S=(0,d.useCallback)((()=>{r()}),[r]),v=(0,c.VK)((()=>(0,Oe.ip)({searchContentPaneType:o,renderAsPage:n,environment:p})),[n,o,p]),y=(0,u.yK)((e=>({header:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto",paddingTop:8,paddingLeft:12,paddingRight:16,paddingBottom:8},body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},scroller:{display:"flex",flexDirection:"column",maxHeight:v.maxHeight,minHeight:v.minHeight},clearButton:{...(0,Qe.X)({noDrag:Boolean(a)})},headerButton:{color:e.mediumIconColor,...(0,Qe.X)({noDrag:Boolean(a)})},closeButton:{borderRadius:"100%",marginLeft:6,...(0,Qe.X)({noDrag:Boolean(a)})},backButton:{marginRight:6,...(0,Qe.X)({noDrag:Boolean(a)})}})),[v,a]),k=(0,b.Fy)(),w=(0,d.useMemo)((()=>{if(k.isMobile){return{menuType:De.og.Modal,width:n?"100vw":void 0,disableHeaderShadow:!0,disableBottomPadding:!0,bodyScrollerClassName:He.GZn,hideMobileTopbar:!0,renderAsPage:!0,scrollerStyle:{display:"flex",flexDirection:"column",paddingBottom:0},...t}}const e={menuType:De.og.Popup,maxHeight:v.maxHeight,minHeight:v.minHeight,...a?{width:"100vw"}:{},disableScroller:!0,scrollerStyle:y.scroller,...t};return n&&k.isDesktop&&(e.maxWidth="100%"),e}),[k,y,t,v,n,a]),C=(0,d.useCallback)((()=>{i.trackQnaClear(p,g,null===m.Z||void 0===m.Z?void 0:m.Z.getActiveAssistantRuntimeState()),(0,s.clearActiveAssistantSession)({environment:p})}),[g,p]),A=(0,c.VK)((()=>{const e=m.Z.getActiveAssistantRuntimeState();return!e||!m.Z.getActiveAssistantConfigurationState()||0===e.clientSteps.length&&0===e.temporaryClientSteps.length}),[]);return(0,f.jsxs)(Ve.Z,{...w,className:He.Oau,ref:l,children:[(0,f.jsx)(Ee.Z,{children:(0,f.jsxs)("div",{style:y.header,children:[(0,f.jsx)(_e.Z,{icon:Re.W,onClick:h,ariaLabel:"back",style:y.backButton}),(0,f.jsx)(Ie.xu,{}),(0,f.jsx)("div",{style:{flexGrow:1}}),(0,f.jsx)(Pe.Z,{enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},animationStyle:{opacity:1},render:()=>(0,f.jsx)(Ue.v,{style:y.clearButton,onClick:C,disabled:A}),isVisible:!A}),(0,f.jsx)(_e.Z,{style:y.closeButton,hovered:!0,icon:Be.U,onClick:S,ariaLabel:"close"})]})}),(0,f.jsx)(x.R3,{renderAsFullPage:n,isQuickSearchMode:a,onBackspaceOnEmptyInput:h})]})}},2405:(e,t,n)=>{n.d(t,{Z:()=>o});n(67294);var s=n(24405),i=n(64921),a=n(85893);function o(e){window.__c={n:"AssistantActionButton"};const{style:t,icon:n,disabled:o,iconStyle:r,title:l,onClick:d,focused:c}=e,u=(0,s.yK)((e=>({AssistantActionButton:{display:"flex",alignItems:"center",boxShadow:e.inputBoxShadow,padding:"6px 10px 6px 12px",color:e.regularTextColor,fontSize:13,fontWeight:500,borderRadius:24,width:"max-content"},icon:{width:14,height:14,fill:e.regularIconColor,marginRight:6}})),[]);return(0,a.jsxs)(i.Z,{disabled:o,style:{...u.AssistantActionButton,...t},onClick:d,focused:c,children:[null==n?void 0:n({...u.icon,...r}),l]})}},88709:(e,t,n)=>{n.d(t,{R3:()=>ze,f6:()=>tt});n(52262),n(24506);var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(49085),l=n(27328),d=n(41892),c=n(92595),u=n(7057),p=n(53877),g=n(42875),m=n(84169),h=n(35840),S=n(72126),f=n(70203),v=n(97880),x=n(82990),y=n(68939),k=n(50906),w=n(47307),b=n(24677),C=n(80402),A=n(993),j=n(98104),I=n(39699),M=n(63594),Z=n(53336),T=n(72495),F=n(37712),R=(n(95477),n(75179)),B=n(57254),P=n(19124),_=n(17809),K=n(34859),L=n(80444),V=n(21273),E=n(98180),W=n(82375),O=n(69454),H=n(45589),Q=n(55320),D=n(50929),z=n(65147),N=n(33932),U=n(70771),q=n(91437),$=n(27967),G=n(67973),Y=n(2405),J=n(94486),X=n(42899),ee=n(26263),te=n(1302),ne=n(83176),se=n(88437),ie=n(47453),ae=n(18101),oe=n(98519),re=n(55863),le=n(4615),de=n(14871),ce=n(56518),ue=n(28344),pe=n(85893);function ge(e){window.__c={n:"AssistantFeedbackBar"};const{type:t,renderAsFullPage:n}=e,r=(0,i.O7)(),l=(0,o.yK)((e=>({wrap:{display:"flex",marginTop:8,marginBottom:0,gap:6}})),[]),[d,c]=(0,s.useState)((()=>(0,le.ZP)())),u=(0,a.VK)((()=>M.Z.state),[]),p=(0,a.VK)((()=>V.Z.isAssistant2Enabled(void 0)),[]),g=(0,s.useCallback)((async()=>{const e=E.Z.getActiveSessionId();e&&(D.saveFeedback({environment:r,inferenceId:d,type:"assistant_accept_edits",sessionId:e}),await D.commitPreviewAssistantStep({environment:r,sessionId:e}),await D.applyUncommittedOperations({environment:r,sessionId:e}))}),[r,d]),m=(0,s.useCallback)((async()=>{const e=E.Z.getActiveSessionId();e&&(D.saveFeedback({environment:r,inferenceId:d,type:"assistant_fix_errors",sessionId:e}),await D.commitPreviewAssistantStep({environment:r,sessionId:e}))}),[r,d]),h=(0,s.useCallback)((async()=>{const e=E.Z.getActiveSessionId();e&&(D.saveFeedback({environment:r,inferenceId:d,type:"assistant_undo",sessionId:e}),await D.commitPreviewAssistantStep({environment:r,sessionId:e}),D.resetUncommittedOperations({environment:r,sessionId:e}))}),[r,d]),S=(0,s.useCallback)((async()=>{const e=E.Z.getActiveSessionId();e&&(D.saveFeedback({environment:r,inferenceId:d,type:"assistant_retry",sessionId:e}),await D.retryNextAssistantSteps({environment:r,sessionId:e}))}),[r,d]),f=(0,s.useCallback)((()=>{const e=E.Z.getActiveAssistantRuntimeState(),t=E.Z.getActiveAssistantConfigurationState(),n=null==e?void 0:e.temporaryClientSteps.find((e=>"assistantChat"===e.type||"assistantChatText"===e.type));if(n){if("assistantChatText"===n.type)de.RD({environment:r,stringValue:n.text??"",copiedMessage:de.tq.copiedQnAMessageToClipboard});else if("assistantChat"===n.type){const e=(0,z.me)({environment:r,clientStep:n,citationOrdering:void 0,inMemoryRecordCache:new ee.Z({name:"assistantChat.clipboard"})}),t=(0,ce.X4)({rootBlock:{...e[0].pointer,spaceId:e[0].getSpaceId()},blockValues:e.map((e=>e.getValue())).filter(v.$K),getRecordValue:e[0].getRecordValue,isWindows:r.device.isWindows,markdownLinkifyIt:void 0});de.RD({environment:r,stringValue:t.markdown??"",copiedMessage:de.tq.copiedQnAMessageToClipboard})}else(0,v.t1)(n);t&&ue.trackQnACopyClick(r,{sessionId:t.sessionId})}}),[r]),x=(0,s.useCallback)((async()=>{const e=E.Z.getActiveSessionId();e&&(I.createAndCommit({userAction:"assistant.createPage",environment:r,perform:t=>{D.createPageFromAssistantChat({environment:r,sessionId:e,transaction:t})}}),await D.commitPreviewAssistantStep({environment:r,sessionId:e}),await te.default.afterNextFlush(),await te.default.afterNextFlush(),await D.updateContextForCurrentPageIfNecessary({environment:r,sessionId:e,autoLoadPage:!0}))}),[r]),k=(0,s.useCallback)((async()=>{const e=E.Z.getActiveSessionId();e&&(I.createAndCommit({userAction:"assistant.insertIntoPage",environment:r,perform:t=>{D.insertAssistanChatIntoCurrentPage({environment:r,sessionId:e,transaction:t})}}),await D.commitPreviewAssistantStep({environment:r,sessionId:e}))}),[r]);return(0,pe.jsxs)("div",{style:l.wrap,children:["accept_edits"===t&&(0,pe.jsxs)(pe.Fragment,{children:[(0,pe.jsx)(Y.Z,{icon:oe.k,onClick:g,title:(0,pe.jsx)(y.FormattedMessage,{defaultMessage:"Accept all",id:"assistant.acceptAllButton"})}),(0,pe.jsx)(Y.Z,{icon:re.s,onClick:h,title:(0,pe.jsx)(y.FormattedMessage,{defaultMessage:"Undo all",id:"assistant.undoAllButton"})})]}),"error"===t&&(0,pe.jsx)(Y.Z,{icon:ne.z,onClick:m,title:(0,pe.jsx)(y.FormattedMessage,{defaultMessage:"Fix errors",id:"assistant.fixErrorsButton"})}),"chat"===t&&(0,pe.jsxs)(pe.Fragment,{children:[(0,pe.jsx)(Y.Z,{icon:se.a,onClick:f,title:(0,pe.jsx)(y.FormattedMessage,{defaultMessage:"Copy",id:"assistant.copyButton"})}),p&&(n?(0,pe.jsx)(Y.Z,{icon:ie.R,onClick:x,title:(0,pe.jsx)(y.FormattedMessage,{defaultMessage:"Create page",id:"assistant.createPageButton"})}):(0,pe.jsx)(Y.Z,{icon:ie.R,onClick:k,title:(0,pe.jsx)(y.FormattedMessage,{defaultMessage:"Insert",id:"assistant.insertButton"})}))]}),u?(0,pe.jsx)(Y.Z,{icon:ae.b,onClick:S,title:(0,pe.jsx)(y.FormattedMessage,{defaultMessage:"Try again",id:"assistant.retryButton"})}):null]})}var me=n(72263),he=n(42922),Se=n(99622),fe=n(12205),ve=n(80671),xe=n(44041),ye=n(35057);function ke(e){window.__c={n:"AssistantBlueLink"};const t=(0,o.yK)((e=>({assistantBlueLink:{color:e.text.uiBluePrimary,cursor:"pointer",fontWeight:600}})),[]);return(0,pe.jsx)("span",{style:t.assistantBlueLink,onClick:e.onClick,children:e.children})}const we=(0,y.defineMessages)({requestAccessButton:{id:"AssistantLimitReached.requestAccess.button",defaultMessage:"Request access"},requestAccessMessage:{id:"AssistantLimitReached.requestAccess.message",defaultMessage:"You’ve run out of free AI responses. Request the <bold>Notion AI add-on</bold> from your workspace owner."},requestAccessReceived:{id:"AssistantLimitReached.requestAccess.received",defaultMessage:"Thank you! We received your request."},unavailableMessage:{id:"AssistantLimitReached.unavailable.message",defaultMessage:"You’ve run out of free AI responses. Reach out to your account representative to purchase the Notion AI add-on."},upsellButton:{id:"AssistantLimitReached.upsell.button",defaultMessage:"Get unlimited AI"},upsellMessage:{id:"AssistantLimitReached.upsell.message",defaultMessage:"You’ve run out of free AI responses. Get the <bold>Notion AI add-on</bold> so that I can answer an unlimited number of questions for you!"}});function be(e){window.__c={n:"AssistantLimitReached"};const t=(0,fe.J)(),n=(0,Se.Y)();return n&&t?(0,pe.jsx)(je,{...e}):n&&!t?(0,pe.jsx)(Ce,{...e}):!n&&t?(0,pe.jsx)(Ae,{...e}):n||t?null:(0,pe.jsx)(Ce,{...e})}function Ce(e){window.__c={n:"RequestAccess"};const t=(0,i.O7)(),[n,o]=(0,s.useState)(!1),r=(0,y.useIntl)(),l=Ie(),d=(0,a.VK)((()=>L.default.state.currentSpaceStore),[]),c=(0,s.useCallback)((()=>{d&&((0,ve.jw)({environment:t,spaceStore:d,from:"ai_limit_in_app"}),o(!0))}),[t,d]);if(n)return(0,pe.jsx)("div",{style:l.wrapper,children:(0,pe.jsx)(J.H,{...e,clientStep:{type:"assistantLimitReached",message:r.formatMessage(we.requestAccessReceived)}})});const u=r.formatMessage(we.requestAccessMessage,{bold:e=>(0,pe.jsx)(ke,{onClick:c,children:e})});return(0,pe.jsxs)("div",{style:l.wrapper,children:[(0,pe.jsx)(J.H,{...e,clientStep:{type:"assistantLimitReached",message:u}}),(0,pe.jsxs)(he.Z,{style:l.button,onClick:c,children:[(0,me._)(l.icon),r.formatMessage(we.requestAccessButton)]})]})}function Ae(e){window.__c={n:"Upsell"};const t=(0,i.O7)(),n=Ie(),a=(0,y.useIntl)(),o=(0,s.useCallback)((()=>{xe.y(t,{from:"ai_limit_in_app",for:(0,ye.zt)(),addOnFeature:"ai"})}),[t]),r=a.formatMessage(we.upsellMessage,{bold:e=>(0,pe.jsx)(ke,{onClick:o,children:e})});return(0,pe.jsxs)("div",{style:n.wrapper,children:[(0,pe.jsx)(J.H,{...e,clientStep:{type:"assistantLimitReached",message:r}}),(0,pe.jsxs)(he.Z,{style:n.button,onClick:o,children:[(0,me._)(n.icon),a.formatMessage(we.upsellButton)]})]})}function je(e){window.__c={n:"Unavailable"};const t=Ie(),n=(0,y.useIntl)();return(0,pe.jsx)("div",{style:t.wrapper,children:(0,pe.jsx)(J.H,{...e,clientStep:{type:"assistantLimitReached",message:n.formatMessage(we.unavailableMessage)}})})}function Ie(){return(0,o.yK)((()=>({button:{alignSelf:"flex-start",borderRadius:100,display:"flex",gap:6,marginTop:6,marginBottom:6,padding:"7px 12px"},icon:{width:16,height:16},wrapper:{marginTop:4,display:"flex",flexDirection:"column"}})),[])}var Me=n(85075),Ze=n(83065),Te=n(15336),Fe=n(73063),Re=n(65187),Be=n(43250),Pe=n(12534),_e=n(28685),Ke=n(29026);function Le(e){window.__c={n:"AssistantRichTextInput"};const{isQnA:t,store:n,placeholder:r,disabled:l,onSubmit:d,onFocus:c,onBackspaceOnEmptyInput:u}=e,p=(0,i.O7)(),{isMobile:g}=(0,i.Fy)(),m=(0,a.VK)((()=>""===(0,f.Jcv)(n.getValue()).trim()),[n]),[h,v]=s.useState(!1),x=(0,s.useCallback)((e=>{m||!d||l||h||(d(n.getValue()),I.createAndCommit({userAction:"AssistantRichTextInput.valueChanged",environment:p,perform:e=>{A.sO({environment:p,store:n,value:void 0,transaction:e})}}))}),[l,p,d,n,m,h]),y=(0,s.useCallback)((e=>{(0,Pe.ZP)({event:e,context:Pe.Af.ButtonMouseDown,callback:()=>{!async function(e){const{environment:t,textValueStore:n,setIsUndoing:s}=e;s(!0);const i=await(0,D.rewindActiveAssistantSession)({environment:t});i&&I.createAndCommit({userAction:"AssistantRichTextInput.undoLastHumanStep",environment:t,perform:e=>{A.sO({environment:t,store:n,value:i,transaction:e})}});await te.default.afterNextFlush((()=>{j.NX({store:n})})),s(!1)}({environment:p,textValueStore:n,setIsUndoing:v})}})}),[p,n]),k=(0,s.useCallback)((e=>{!d||m||h||(d(n.getValue()),I.createAndCommit({userAction:"AssistantRichTextInput.valueChanged",environment:p,perform:e=>{A.sO({environment:p,store:n,value:void 0,transaction:e})}}))}),[d,m,n,p,h]),w=(0,s.useRef)(),b=(0,s.useCallback)((e=>{e&&e instanceof KeyboardEvent&&"Backspace"===e.key&&!e.repeat&&0===(0,f.VrM)(w.current??[])&&(null==u||u()),w.current=n.getValue()}),[w,n,u]),C=(0,o.yK)((e=>({wrap:{display:"flex",alignItems:"center",flexGrow:1,flexShrink:1,boxShadow:e.inputBoxShadow,backgroundColor:"dark"===e.mode?e.accentColors.translucentGray[100]:"transparent",borderRadius:g?22:16,padding:g?"6px 8px 6px 14px":"4px 8px 4px 14px",minHeight:g?36:void 0,marginLeft:16,marginRight:16,overflow:"hidden",fontSize:g?15:14},placeholder:{opacity:l?.5:1,cursor:"text"}})),[l,g]);return(0,pe.jsxs)("div",{style:C.wrap,...g?{}:{className:Be.Wh_},onClick:e=>{if(e.target===e.currentTarget){const t=_e.E.findEditableWithStore(n);t&&t.handleClick(e)}},children:[(0,pe.jsx)(Re.Z,{onEsc:()=>Ke.ZP.switchToSearchPane(),placeholder:r,disabled:!1,store:n,placeholderStyle:C.placeholder,pasteBehavior:"inline",disableSlashCommands:!0,disableEmbedMenu:!0,disableEmojiCommands:!1,disableComment:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,onEnter:l?S.ZT:k,disableMobileActionBar:!0,disableDateReminderMentions:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMentions:t,onFocus:c,onChange:b}),(0,pe.jsx)(Ve,{disabled:l??!1,isUndoing:h,storeIsEmpty:m,handleClickEnter:x,handleClickStop:y})]})}function Ve(e){window.__c={n:"AssistantIconButton"};const{disabled:t,isUndoing:n,storeIsEmpty:s,handleClickStop:a,handleClickEnter:r}=e,l=(0,i.Fy)().isMobile,d=(0,o.yK)((e=>({icon:{height:l?24:20,width:l?24:20},stopIcon:{fill:e.icon.secondary},button:{pointerEvents:"auto",height:l?24:20,width:l?24:20}})),[l]);return n?(0,pe.jsx)(Fe.Z,{icon:Ze._,onClick:()=>{},isBlue:!1,disabled:!0,iconStyle:d.icon,style:d.button,ariaLabel:"submit-ai-message"}):t?(0,pe.jsx)(Fe.Z,{icon:Te.q,onClick:a,style:d.button,iconStyle:{...d.icon,...d.stopIcon},ariaLabel:"stop-ai-message"}):(0,pe.jsx)(Fe.Z,{icon:Ze._,onClick:r,isBlue:!s,disabled:s||t,iconStyle:d.icon,style:d.button,ariaLabel:"submit-ai-message"})}var Ee=n(16540),We=n(5175),Oe=n(14309);const He=(0,y.defineMessages)({qnaInputPlaceholder:{id:"assistantChat.qnaInputPlaceholder.text",defaultMessage:"Ask a question…"},assistantInputPlaceholder:{id:"assistantChat.assistantInputPlaceholder.text",defaultMessage:"Ask for anything, @mention pages or people…"},qnaAssistantChatText:{id:"assistantChat.qnaWelcomeMessage.text",defaultMessage:"Hi {firstName}! Ask me about anything in {workspaceName}. I’ll find an answer in the pages you have access to."},assistantBetaDisclaimerText:{id:"assistantChat.qnaWelcomeMessage.disclaimerText",defaultMessage:"I’m still in Beta, so please use the 👍 👎 buttons to help me improve."}});function Qe(e){window.__c={n:"AssistantChatSkillsToTryOutInlineSection"};const{skillsWrapStyle:t,skillIconStyle:n,clientSkills:a}=e,o=(0,i.O7)(),r=(0,s.useCallback)((async e=>{await(0,U.OZ)({environment:o,clientSkill:e})}),[o]),l=(0,s.useCallback)((()=>{(0,N.navigateToView)({view:"skillSwitcher"})}),[]);return(0,pe.jsx)(T.Z,{desktopTitleStyle:{paddingLeft:2},title:(0,pe.jsx)(y.FormattedMessage,{id:"assistantChat.thingsToTry",defaultMessage:"Things to try"}),children:(0,pe.jsxs)("div",{style:t,children:[S.xH($.pageChatSections.map((e=>e.skills[0]))).map((e=>{const t=a.find((t=>t.skillType===e));if(t)return(0,pe.jsx)(Y.Z,{icon:$.skillIconMap[t.skillType],iconStyle:n,onClick:async()=>{await r(t)},title:(0,pe.jsx)(We.Z,{clientSkill:t})},t.key)})),(0,pe.jsx)(Y.Z,{onClick:l,title:"More"})]})})}function De(e){window.__c={n:"AssistantChatSuggestedQuestionsInlineSection"};const{questionsWrapStyle:t,questionIconStyle:n,handleSubmitSuggestedQuestion:s}=e,i=Ue();return(0,pe.jsx)(T.Z,{desktopTitleStyle:{paddingLeft:2},title:(0,pe.jsx)(y.FormattedMessage,{id:"assistantChat.things to ask",defaultMessage:"Things to ask"}),children:(0,pe.jsx)("div",{style:t,children:i.map((e=>(0,pe.jsx)(Y.Z,{icon:h.R,iconStyle:n,onClick:()=>s(e),title:e},e)))})})}function ze(e){window.__c={n:"AssistantChat"};const{renderAsFullPage:t=!1,onBackspaceOnEmptyInput:n}=e,o=Boolean(e.isQuickSearchMode),r=(0,i.O7)(),{isMobile:d}=r.device,u=(0,s.useRef)(void 0),p=(0,y.useIntl)(),g=(0,a.VK)((()=>E.Z.getActiveAssistantRuntimeState()),[]),m=(0,a.VK)((()=>L.default.state.mainEditorCurrentBlockStore),[]),h=(0,a.VK)((()=>L.default.state.currentSpaceStore),[]),x=(0,a.VK)((()=>(0,l.w_)(r.TabbedRouterStore.state)),[r]),[k,T]=(0,s.useState)(!1),B=null==g?void 0:g.selectedSkill,Q=(0,a.VK)((()=>W.Pl.state),[]),z=Boolean(Q),{store:N}=(0,_.Cl)({initialValue:void 0,onChange:S.yR}),U=function(e){const{renderAsFullPage:t,isQuickSearchMode:n}=e,o=(0,a.VK)((()=>E.Z.getActiveAssistantRuntimeState()),[]),r=(0,a.VK)((()=>E.Z.getActiveAssistantConfigurationState()),[]),l=null==o?void 0:o.selectedSkill,d=(0,a.VK)((()=>V.Z.isAssistantExperienceQna()),[]),u=Ne({renderAsFullPage:t}),p=Ue(),g=(0,a.VK)((()=>V.Z.isAssistant2Enabled(l)),[l]),m=(0,a.VK)((()=>V.Z.shouldShowSuggestedQuestions()),[]),h=(0,a.VK)((()=>{var e;return Boolean(null===(e=E.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.clientSteps.find((e=>"human"===e.type)))}),[]),S=tt({assistantRuntimeState:o,assistantConfigurationState:r}),f=(0,a.VK)((()=>(0,P.Gw)()),[]),x=!o||o&&!o.selectedSkill&&0===o.clientSteps.length,y=Boolean((null==r?void 0:r.sampling)||(null==r?void 0:r.evaluating)),k=(0,a.VK)((()=>{var e;const t=null===(e=E.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.previewingStepObservations.filter((e=>"observation"===e.type&&"error"===e.observationType));return null==t?void 0:t.map((e=>e.value)).join("\n")}),[]),w=(0,a.VK)((()=>M.Z.state),[]),b=(0,i.O7)().device.isMobile;return(0,s.useEffect)((()=>{(0,c.exposeDebugValue)("shouldShowSuggestedQuestionsFlags",{isEmptyAssistantState:x,isSuggestedQuestionsEnabled:m,suggestedQuestions:p,renderAsFullPage:t})}),[x,m,p,t]),{shouldRenderFinetunedAssistantIntroMessage:g&&x,shouldShowFullPageSkillSwitcher:g&&x&&u.length>0&&t,shouldShowClientSkillsPageSection:g&&x&&u.length>0&&!t,shouldShowSuggestedQuestionsPageSection:x&&m&&p.length>0&&!t,shouldShowQnaWelcomeHeader:!h&&d,shouldShowCitationsAtBottom:!k||y,isAnswerLoading:S&&y,shouldShowCitationsLoadingDots:!(0,v.$K)(S)&&y,shouldShowNonQNAError:r&&k&&!y&&!d,shouldShowAssistantFeedbackButtons:!f&&o&&r&&(o.temporaryClientSteps.length>0||k)&&!r.sampling&&!r.evaluating,shouldShowHelpRedirectBar:!n&&d&&!b&&!f&&(!o||0===o.clientSteps.length&&0===o.temporaryClientSteps.length)&&(!r||!r.sampling&&!r.evaluating),isAiEligible:w,isLabelerMode:f,isQnA:d,hasLockAction:(null==r?void 0:r.evaluating)||(null==r?void 0:r.sampling)||(null==r?void 0:r.committing)||!w}}({renderAsFullPage:t,isQuickSearchMode:o}),q=(0,s.useCallback)((()=>{u.current&&(u.current.scrollToBottom(),T(!1))}),[T]),$=(0,s.useCallback)((async e=>{if(z&&(null==Q||!Q.selectedFakeUser))return void w.deprecatedShowErrorMessage("Please select a user to send the message as");if(!e)return;q();let t=E.Z.getActiveSessionId();if(!t){t=(await D.resetAndInitializeAssistantSession({environment:r,isLabelerSlackMode:z,fakeSlackChannel:null==Q?void 0:Q.selectedFakeChannel,clientSkill:B,skillSettings:{}})).sessionId}D.commitHumanStep({environment:r,text:e,fakeUser:null==Q?void 0:Q.selectedFakeUser,sessionId:t}),D.updateAssistantTimestampsAfterSessionInitialization({environment:r})}),[z,null==Q?void 0:Q.selectedFakeUser,null==Q?void 0:Q.selectedFakeChannel,q,r,B]),G=(0,s.useCallback)(((e,t)=>{const n=u.current;n&&(n.atScrollEnd()?T(!1):T(!0),r.device.isMobile&&"up"===t&&(n.distanceToBottom()??0)>0&&b.ZH({device:r.device}))}),[r]);(0,s.useEffect)((()=>{if(r.device.isMobileNative){var e,t;Boolean("web"===x.type&&("nativeTab"===x.route.name&&"assistant"===x.route.tab||"nativeTab"===(null===(e=x.redirectedTo)||void 0===e?void 0:e.route.name)&&"assistant"===(null===(t=x.redirectedTo)||void 0===t?void 0:t.route.tab)))?$e(r,N):b.ZH({device:r.device})}}),[r,x,N]),(0,s.useEffect)((()=>{$e(r,N)}),[r,N]),(0,s.useEffect)((()=>{const e=E.Z.getActiveAssistantRuntimeStore(),t=null==g?void 0:g.primeTextInput;e&&t&&(I.createAndCommit({userAction:"assistant.primeTextFromSearch",environment:r,perform:e=>{A.sO({environment:r,store:N,value:f.TPx(t),transaction:e})}}),j.Z5({store:N,selection:{startIndex:t.length,endIndex:t.length}}),D.clearPrimedText({assistantRuntimeStore:e}))}),[r,N,null==g?void 0:g.primeTextInput]),(0,s.useEffect)((()=>{u.current&&!k&&u.current.scrollToBottom()}),[null==g?void 0:g.clientSteps,null==g?void 0:g.temporaryClientSteps,k]);const Y=(0,a.qz)(void 0,H.Z),J=nt({renderAsFullPage:t});return h&&(t||m)?(0,pe.jsxs)(pe.Fragment,{children:[(0,pe.jsx)(F.A,{scrollerStore:Y}),(0,pe.jsx)(Z.T,{ref:u,type:K.Z.Y,style:J.scroller,onScroll:G,store:Y,children:(0,pe.jsx)(qe,{assistantChatSectionsState:U,renderAsFullPage:t,isQuickSearchMode:o,currentSpaceStore:h,handleTextSubmit:$})}),U.isAiEligible?(0,pe.jsx)("div",{style:J.inputWrap,children:(0,pe.jsx)(R.Z,{capture:d,render:()=>(0,pe.jsx)(Le,{isQnA:U.isQnA,store:N,placeholder:U.isQnA?p.formatMessage(He.qnaInputPlaceholder):p.formatMessage(He.assistantInputPlaceholder),onSubmit:$,onFocus:()=>{C.MO(),d&&O.Z.onShow(q)},disabled:U.hasLockAction,onBackspaceOnEmptyInput:n})})}):null]}):null}function Ne(e){const{renderAsFullPage:t}=e;return(0,a.VK)((()=>(0,$.getFilteredClientSkills)({showCustomSkills:V.Z.showCustomSkills(),hasCurrentPage:!t})),[t])}function Ue(){return(0,a.VK)((()=>{var e;return(null===(e=L.default.state.currentSpaceViewStore)||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.getQnaSuggestedQuestionList())??[]}),[])}function qe(e){window.__c={n:"AssistantChatScrollerContent"};const{assistantChatSectionsState:t,currentSpaceStore:n,renderAsFullPage:o,isQuickSearchMode:l,handleTextSubmit:c}=e,m=(0,y.useIntl)(),h=(0,i.O7)(),S=Ne({renderAsFullPage:o}),x=(0,a.VK)((()=>E.Z.getActiveAssistantConfigurationState()),[]),k=Boolean((null==x?void 0:x.sampling)||(null==x?void 0:x.evaluating)),w=(0,s.useMemo)((()=>r.default.createValue(!0)),[]);(0,s.useEffect)((()=>{if(!k){var e;const t=null===(e=E.Z.getActiveAssistantRuntimeStore())||void 0===e?void 0:e.getCombinedSteps().at(-1);if("assistantChat"===(null==t?void 0:t.type)){0===(0,q.M)({clientStep:t,citationOrdering:void 0}).length&&w.setState(!1)}}}),[w,h,k]);const b=(0,a.qz)(void 0,G.d),C=nt({renderAsFullPage:o}),A=(0,a.VK)((()=>E.Z.getActiveAssistantRuntimeState()),[]),j=null==A?void 0:A.selectedSkill,I=(0,s.useCallback)((e=>!!t.isLabelerMode||(t.isQnA?"human"===e.type||"assistantChat"===e.type||"assistantChatText"===e.type||"assistantShowSearchResults"===e.type||"assistantFriendlyError"===e.type:"human"===e.type||"assistantChat"===e.type||"assistantChatText"===e.type||"assistantShowSearchResults"===e.type||"assistantTransaction"===e.type)),[t.isLabelerMode,t.isQnA]),M=(0,a.VK)((()=>{var e;const t=null===(e=E.Z.getActiveAssistantRuntimeState())||void 0===e?void 0:e.previewingStepObservations.filter((e=>"observation"===e.type&&"error"===e.observationType));return null==t?void 0:t.map((e=>e.value)).join("\n")}),[]),Z=(0,s.useMemo)((()=>{if(null==x||!x.startTimestamp)return;const e=(0,p.kT)({date:x.startTimestamp,timezone:(0,g.r)()});return[(0,u.p6)({allowRelativeDates:!0,date:e,dateFormat:"relative",intl:m,shortenDate:!1}),e.toFormat("h:mm a")].join(" ")}),[null==x?void 0:x.startTimestamp,m]),T=(0,s.useMemo)((()=>r.default.createValue(!1)),[]),F=tt({assistantRuntimeState:A,assistantConfigurationState:x});return(0,s.useEffect)((()=>{F&&(T.setState(!1),w.setState(!0))}),[T,w,F]),(0,pe.jsxs)(pe.Fragment,{children:[(0,pe.jsx)("div",{style:{marginTop:"auto"}}),t.shouldRenderFinetunedAssistantIntroMessage&&(0,pe.jsx)(pe.Fragment,{children:(0,pe.jsxs)("div",{style:C.emptyStateWrap,children:[(0,pe.jsx)("div",{style:C.faceImgWrap,children:(0,pe.jsx)("img",{style:C.faceImg,src:d.Z.images.aiFaceLookleftPng})}),(0,pe.jsxs)("div",{style:C.emptyStateText,children:[(0,pe.jsx)("p",{children:(0,pe.jsx)(y.FormattedMessage,{id:"assistantChat.welcomeMessage.title",defaultMessage:"Hi, I'm Notion AI! I can chat with you about anything, find information from the workspace, and read and edit pages."})}),(0,pe.jsx)("p",{children:(0,pe.jsx)(y.FormattedMessage,{id:"assistantChat.welcomeMessage.helpText",defaultMessage:"I’m still in Beta, so please use the 👍 👎 buttons to help me improve."})})]})]})}),t.shouldShowFullPageSkillSwitcher&&(0,pe.jsx)(Oe.s,{clientSkills:S,renderAsFullPage:o,disableKeyboard:!0}),t.shouldShowClientSkillsPageSection&&(0,pe.jsx)(Qe,{clientSkills:S,skillIconStyle:C.skillIcon,skillsWrapStyle:C.skillsWrap}),t.shouldShowSuggestedQuestionsPageSection&&(0,pe.jsx)(De,{handleSubmitSuggestedQuestion:e=>c(f.TPx(e)),questionIconStyle:C.skillIcon,questionsWrapStyle:C.skillsWrap}),Z&&(0,v.$K)(A)&&A.clientSteps.length>0&&(0,pe.jsx)("div",{style:C.dateContainer,children:(0,pe.jsx)("div",{style:C.date,children:Z})}),t.shouldShowQnaWelcomeHeader&&(0,pe.jsx)(st,{isQuickSearchMode:l,renderAsFullPage:o}),j&&$.skillDefaultAssistantMessageMap[j.skillType]&&(0,pe.jsx)(J.H,{clientStep:{type:"assistantChatText",text:m.formatMessage($.skillDefaultAssistantMessageMap[j.skillType])},parentStore:n,parentSpaceId:n.id,configurationState:x,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:void 0}),(0,pe.jsx)(et,{clientSteps:[...(null==A?void 0:A.clientSteps)??[],...(null==A?void 0:A.temporaryClientSteps)??[]].filter(I),parentStore:n,parentSpaceId:n.id,configurationState:x,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:b}),F&&("default"===F.type?(0,pe.jsx)(J.H,{clientStep:{type:"assistantLoading"},parentStore:n,parentSpaceId:n.id,configurationState:x,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:b}):"searchResults"===F.type?(0,pe.jsx)(Ee.N,{clientStep:F.step,parentStore:n,configurationState:x,citationHoverStore:b,isQuickSearchMode:l,renderAsFullPage:o}):(0,v.t1)(F)),t.shouldShowCitationsAtBottom&&(0,pe.jsx)(Ge,{hoverStore:b,parentStore:n,expandedStore:T,toggledStore:w,isLoading:t.shouldShowCitationsLoadingDots}),t.shouldShowNonQNAError&&(0,pe.jsx)("div",{style:C.error,children:M}),t.shouldShowAssistantFeedbackButtons&&(0,pe.jsx)(ge,{type:M?t.isQnA?"error_retry_only":"error":Boolean(null==A?void 0:A.temporaryClientSteps.find((e=>"assistantTransaction"===e.type)))?"accept_edits":"chat",renderAsFullPage:o}),t.shouldShowHelpRedirectBar&&(0,pe.jsx)(Xe,{}),!t.isAiEligible&&(0,pe.jsx)(be,{parentStore:n,parentSpaceId:n.id,configurationState:x,isQuickSearchMode:l,renderAsFullPage:o,latestStepCitationHoverStore:b})]})}function $e(e,t){b.ZH({device:e.device}),j.N_({store:t})}function Ge(e){window.__c={n:"LatestStepCitations"};const{hoverStore:t,parentStore:n,expandedStore:s,toggledStore:i,isLoading:o}=e,{chatStep:r,searchResultsStep:l}=(0,a.VK)((()=>{var e;const t=(null===(e=E.Z.getActiveAssistantRuntimeStore())||void 0===e?void 0:e.getCombinedSteps())??[];if(0===t.length)return{chatStep:void 0,searchResultsStep:void 0};const n=t.slice(-2).reverse().find((0,v.AO)((e=>"assistantShowSearchResults"===e.type?{true:e}:{false:e}))),s=t[t.length-1];return{chatStep:"assistantChat"===s.type?s:void 0,searchResultsStep:n}}),[]),d={hoverStore:t,parentStore:n,expandedStore:s,canExpand:!0,toggledStore:i,isLoading:o};return(0,v.$K)(r)?(0,pe.jsx)(Ye,{...d,chatStep:r,searchResultsStep:l}):(0,v.$K)(l)?(0,pe.jsx)(Je,{...d,searchResultsStep:l}):null}function Ye(e){window.__c={n:"CitedPagesListWithNumbers"};const{chatStep:t,parentStore:n,searchResultsStep:i,...a}=e,o=(0,s.useMemo)((()=>{const e=(0,q.M)({clientStep:t,citationOrdering:i?(0,z.TT)(i):void 0});return(0,z.Zr)({pageCitationsFromChat:e,parentStore:n,searchResultsStep:i})}),[t,n,i]);return(0,pe.jsx)(X.d,{citations:o,...a})}function Je(e){window.__c={n:"CitedPagesListFromSearch"};const{parentStore:t,searchResultsStep:n,...i}=e,a=(0,s.useMemo)((()=>(0,z.Zr)({pageCitationsFromChat:[],parentStore:t,searchResultsStep:n})),[t,n]);return(0,pe.jsx)(X.d,{citations:a,...i})}function Xe(){window.__c={n:"AssistantHelpRedirectBar"};const e=(0,i.O7)(),t=(0,o.yK)((()=>({wrap:{display:"flex",marginTop:8,marginBottom:6,gap:6}})),[]);return(0,a.VK)((()=>Q.default.state.open),[])?null:(0,pe.jsx)("div",{style:t.wrap,children:(0,pe.jsx)(Y.Z,{icon:e=>(0,m.m)({...e,fontWeight:500}),onClick:()=>{Me.GA.update((e=>({...e,open:!0})));const t=E.Z.getActiveAssistantConfigurationState();t&&k.Ar6(e,{qnaSessionId:t.sessionId,from:"qna_modal_chat"})},title:(0,pe.jsx)(y.FormattedMessage,{defaultMessage:"Get Notion help",id:"AssistantChat.routeToNotionHelp"})})})}function et(e){const{clientSteps:t,parentStore:n,parentSpaceId:s,configurationState:i,isQuickSearchMode:a,renderAsFullPage:o,latestStepCitationHoverStore:r}=e;return(0,pe.jsx)(pe.Fragment,{children:t.map(((e,t)=>(0,pe.jsx)(J.H,{clientStep:e,parentStore:n,parentSpaceId:s,configurationState:i,isQuickSearchMode:a,renderAsFullPage:o,latestStepCitationHoverStore:r,fakeSlackUser:"human"===e.type?e.fakeUser:void 0},t)))})}function tt(e){const{assistantRuntimeState:t,assistantConfigurationState:n}=e;return(0,a.VK)((()=>{if(!t||!n)return;if(!n.sampling&&!n.evaluating)return;const e=t.temporaryClientSteps.find((0,v.AO)((e=>"assistantChat"===e.type||"assistantTransaction"===e.type||"assistantChatText"===e.type?{true:e}:{false:e})));if(e&&("assistantTransaction"===e.type||!(0,B.S)(e)))return;const s=t.clientSteps[t.clientSteps.length-1];return s&&"assistantShowSearchResults"===s.type?{type:"searchResults",step:s}:{type:"default"}}),[t,n])}function nt(e){const{renderAsFullPage:t}=e,{device:n}=(0,i.O7)(),{isMobile:s}=n;return(0,o.yK)((e=>({wrap:{display:"flex",flexDirection:"column",background:e.contentBackground,width:400,height:"max(calc(100vh - 78px), 300px)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",pointerEvents:"auto",paddingTop:8,paddingLeft:12,paddingRight:12},labeledInput:{display:"flex",gap:8,alignItems:"center"},reset:{color:e.mediumIconColor},toggleSlackMode:{color:e.mediumIconColor},closeButton:{borderRadius:"100%",marginLeft:4},input:{width:void 0,marginLeft:8,marginRight:8},scroller:{flexGrow:1,display:"flex",flexDirection:"column",paddingTop:8,paddingBottom:12,paddingLeft:16,paddingRight:16,WebkitMaskImage:"linear-gradient(black calc(100% - 12px), transparent)"},samplesLabel:{fontSize:s?14:12,marginTop:8,marginBottom:8},inputLabel:{fontSize:s?16:14,color:e.mediumTextColor},previewLabel:{fontSize:s?14:12},editLink:{fontSize:s?16:14,color:e.mediumTextColor,textDecoration:"underline",paddingLeft:8,paddingRight:8},error:{fontSize:s?16:14,color:e.errorText},addCustomInstructionsIcon:{fill:e.aiPurpleColor},suggestionsLabel:{fontSize:s?14:12,color:e.mediumTextColor,marginTop:18,marginBottom:12},faceImgWrap:{width:64,height:64,borderRadius:"100%",background:"white",boxShadow:e.largeLightBoxShadow,overflow:"hidden"},faceImg:{width:64,pointerEvents:"none"},emptyStateText:{marginTop:28,fontSize:16,color:e.regularTextColor,fontFamily:x.Z.baseFontFamily.serif,width:t?500:"calc(100% - 32px)"},emptyStateWrap:{marginLeft:8,marginRight:8},inputWrap:{paddingTop:0,paddingBottom:16},skillsCaption:{fontSize:s?14:12,color:e.mediumTextColor,marginBottom:8},skillIcon:{fill:e.aiPurpleColor},skillsWrap:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:8},date:{fontSize:12,color:e.lightTextColor},dateContainer:{display:"flex",justifyContent:"center",marginTop:4,marginBottom:4}})),[s,t])}function st(e){window.__c={n:"QnAWelcomeHeader"};const{isQuickSearchMode:t,renderAsFullPage:n}=e,s=(0,y.useIntl)(),i=(0,a.VK)((()=>E.Z.getActiveAssistantConfigurationState()),[]),o=(0,a.VK)((()=>L.default.state.mainEditorCurrentBlockStore),[]),r=(0,a.VK)((()=>L.default.state.currentSpaceStore),[]),l=(0,a.VK)((()=>{var e;return null===(e=L.default.state.currentUserStore)||void 0===e?void 0:e.getDisplayName(s)}),[s]),d=(0,a.VK)((()=>M.Z.state),[]),c=(0,a.VK)((()=>null==r?void 0:r.getName()),[r]);if(!r||!c||!n&&!o||!l)return null;if(!d)return null;const u={parentStore:r,parentSpaceId:r.id,configurationState:i,isQuickSearchMode:t,renderAsFullPage:n,latestStepCitationHoverStore:void 0};return(0,pe.jsxs)(pe.Fragment,{children:[(0,pe.jsx)(J.H,{clientStep:{type:"assistantChatText",text:s.formatMessage(He.qnaAssistantChatText,{firstName:l,workspaceName:c})},...u}),(0,pe.jsx)(J.H,{clientStep:{type:"assistantChatText",text:s.formatMessage(He.assistantBetaDisclaimerText)},...u}),!1]})}},84969:(e,t,n)=>{n.d(t,{m:()=>w});n(57658);var s=n(67294),i=n(26263),a=n(480),o=n(86628),r=n(49085),l=n(4615),d=n(70203),c=n(44805),u=n(97880),p=n(15201),g=n(55217),m=n(62619),h=n(48588),S=n(65147),f=n(91437),v=n(67973),x=n(61144),y=n(42899),k=n(85893);function w(e){window.__c={n:"AssistantChatMessageRenderer"};const{clientStep:t,parentStore:n,configurationState:w,fakeSlackUser:b,isLatestStep:C,isQuickSearchMode:A,renderAsFullPage:j,priorSearchResultsStep:I,disableWrap:M}=e,Z=(0,a.O7)(),T=(0,s.useMemo)((()=>new i.Z({name:"AssistantChatMessageListRenderer",isSyntheticAssistantData:!0})),[]),F=(0,s.useMemo)((()=>(0,l.ZP)()),[]),R=(0,o.qz)(void 0,v.d),B=e.citationHoverStore??R,P=(0,S.RS)({environment:Z,clientStep:t,citationOrdering:I?(0,S.TT)(I):void 0,inMemoryRecordCache:T,listId:F}),_=(0,s.useMemo)((()=>{const e=(0,f.M)({clientStep:t,citationOrdering:I?(0,S.TT)(I):void 0});return(0,S.Zr)({pageCitationsFromChat:e,parentStore:n,searchResultsStep:I})}),[t,n,I]),K=(0,s.useRef)(null),L=(0,s.useMemo)((()=>r.default.createValue(!1)),[]),V=(0,s.useMemo)((()=>r.default.createValue(!1)),[]);!function(e){const{containerRef:t,citationHoverStore:n}=e,i=(0,o.VK)((()=>{var e;const n=h.Z.state;if(!n||!t.current||!m.r3(t.current,n.token.node))return;const s=n.annotations.find(d.OU5),i=s?null===(e=d.Vv0(s))||void 0===e?void 0:e.blockId:void 0;return i?{pageId:i,tokenNode:n.token.node}:void 0}),[t]),a=(0,s.useRef)([]);(0,s.useEffect)((()=>{n.setState(i?{type:"token",pageId:i.pageId,node:i.tokenNode}:void 0)}),[n,i]),(0,o.VK)((()=>{var e;const s=null===(e=n.state)||void 0===e?void 0:e.pageId,o=(0,u.$K)(i)?void 0:s;for(const t of a.current)t.style.removeProperty("background-color");const r=[];if(o&&t.current){const e=t.current.querySelectorAll(`[${c.JQ}='${o}']`);for(const t of Array.from(e))t instanceof HTMLElement&&t&&(t.style.backgroundColor="#2383e2",r.push(t))}a.current=r}),[n,t,i]),(0,s.useEffect)((()=>()=>{for(const e of a.current)e.style.removeProperty("background-color")}),[])}({containerRef:K,citationHoverStore:B});const E=(0,k.jsx)(p.O,{displayName:"AssistantChatStepContent",disabled:!0,children:(0,k.jsx)(g.Z,{store:P,disabled:!1,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0})}),W=(0,k.jsxs)(k.Fragment,{children:[!C&&(0,k.jsx)(y.d,{citations:_,hoverStore:B,canExpand:!0,toggledStore:L,expandedStore:V}),(0,k.jsx)(y.P,{containerRef:K,hoverStore:B,parentStore:n,renderAsFullPage:j,isQuickSearchMode:A})]});return M?(0,k.jsxs)(k.Fragment,{children:[E,W]}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(x.J,{ref:K,clientStep:t,configurationState:w,fakeSlackUser:b,forceShowFeedback:C,children:E}),W]})}},94486:(e,t,n)=>{n.d(t,{H:()=>G});n(67635);var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(49019),l=n(35840),d=n(23867),c=n(97880),u=n(68939),p=n(91839),g=n(60682),m=n(57254),h=n(14976),S=n(98180),f=n(77080),v=n(84969),x=(n(21703),n(18466)),y=n(26263),k=n(46964),w=n(14871),b=n(39699),C=n(15201),A=n(55217),j=n(77907),I=n(85893);function M(e){window.__c={n:"AssistantChatMessageRendererMarkdown"};const{clientStep:t}=e,n=(0,i.O7)(),{value:a}=(0,j.useDependency)(j.deps.markdownLinkifyIt),o=(0,s.useMemo)((()=>a?x.Z.withListenerIgnored((()=>function(e){const{environment:t,clientStep:n,markdownLinkifyIt:s}=e,i=new y.Z({name:"AssistantChatMessageListRenderer"});return b.createAndCommit({userAction:"AssistantChatMessageRenderer.temporaryListStore",environment:t,canUndo:!1,perform:e=>{const a=function(e){const{environment:t,clientStep:n,transaction:s,markdownLinkifyIt:i}=e,a=new y.Z({name:"AssistantChatMessageRenderer",isSyntheticAssistantData:!0}),o=t.currentUser.id;if(!o)throw new Error("No current user.");const r=e=>{const s=w.Mt({environment:t,text:(0,k.rr)(n.text),transaction:e,inMemoryRecordCache:a,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:void 0});if(!s)return[];for(const t of s)a.setModelAndRole({pointer:t.pointer,userId:o},t.getModel(),"reader");return s};if(a.addCacheFallback(t.defaultRecordCache.inMemoryRecordCache),s)return r(s);return b.createAndCommit({userAction:"AssistantChatMessageRenderer.temporaryListStore",environment:t,perform:r,canUndo:!1}).performResult}({environment:t,clientStep:n,transaction:e,markdownLinkifyIt:s});return w.Lh({environment:t,stores:a,inMemoryRecordCache:i,transaction:e})}}).performResult}({environment:n,clientStep:t,markdownLinkifyIt:a}))):void 0),[t,n,a]);return(0,I.jsx)(C.O,{displayName:"AssistantChatStepContent",disabled:!0,children:o?(0,I.jsx)(A.Z,{store:o,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,disableDrag:!0}):null})}var Z=n(61144),T=n(15145),F=n(88891),R=n(37167),B=n(72126),P=n(21202),_=n(82990),K=n(2456),L=n(53827),V=n(61519),E=n(84076),W=n(76798),O=n(11335),H=n(84210),Q=n(80444),D=n(51757);function z(e){window.__c={n:"AssistantTransactionRenderer"};const{clientStep:t}=e,n=(0,F.rn)(t.operations),i=(0,o.yK)((e=>({divider:{marginTop:6,marginBottom:6},subheader:{color:e.mediumTextColor}})),[]);return(0,I.jsx)(I.Fragment,{children:n.map(((e,t)=>(0,I.jsxs)(s.Fragment,{children:[(0,I.jsx)(N,{group:e},t),n[t+1]&&(0,I.jsx)(V.Z,{style:i.divider,size:1})]},t)))})}function N(e){window.__c={n:"AssistantTransactionGroupRenderer"};const{group:t}=e,n=(0,i.O7)(),s=(0,o.yK)((e=>({header:{marginTop:4,marginBottom:6,color:e.mediumTextColor},pageTitle:{display:"inline",color:e.regularTextColor,fontWeight:_.Z.fontWeight.semibold,whiteSpace:void 0,overflow:void 0,textOverflow:void 0,textDecoration:"underline"},divider:{marginBottom:6},subheader:{color:e.mediumTextColor,marginBottom:4}})),[]),r=(0,a.VK)((()=>Q.default.state.mainEditorCurrentBlockStore),[]),l=(0,a.VK)((()=>Q.default.state.currentSpaceStore),[]),d=r||l;if(!l)throw new Error("No current space store");if(!d)throw new Error("No parent store");const p=(null==r?void 0:r.id)!==t.pageId,g=l.id,m=D.G.createChildStore(d,{table:P.iU,id:t.pageId,spaceId:g}),h=(0,a.VK)((()=>{const{route:e}=n.RouterStore.state;return"chat"===e.name?(0,R.t)({blockId:m.id,pageVisitSource:T.tY.AIChat}):r&&m.id===r.id?(0,H.ZP)({store:r,pageVisitSource:T.tY.AIChat,fullyQualified:!1}):r?(0,H.ZP)({store:r,pageVisitSource:T.tY.AIChat,fullyQualified:!1,peekViewBlockId:m.id}):(0,H.ZP)({store:m,pageVisitSource:T.tY.AIChat,fullyQualified:!1})}),[r,m,n]),S=(0,a.VK)((()=>{if("updatedPage"!==t.type)return[];const e=m.getParentCollectionStore(),n=null==e?void 0:e.getSchema();return B.oA(Array.from(t.updatedPropertyNames).map((e=>{const t=Object.entries(n||{}).find((t=>{let[,n]=t;return(null==n?void 0:n.name)===e}));if(t)return t[0]})))}),[m,t]);if("updatedPage"===t.type){const{insertedBlockIds:e,updatedBlockIds:n,removedBlockIds:i,updatedTitle:a,updatedPropertyNames:o}=t,r=e.size+n.size+i.size+(a?1:0)+o.size;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(E.Z,{style:s.header,href:h,children:(0,I.jsx)("span",{children:t.didCreatePage?(0,I.jsx)(u.FormattedMessage,{defaultMessage:"Created {page}",id:"assistant.transactionRenderer.createdPage.title",values:{page:(0,I.jsx)(W.Z,{store:m,style:s.pageTitle})}}):(0,I.jsx)(u.FormattedMessage,{defaultMessage:"{numEdits, plural, one {1 edit to {page}} other {{numEdits} edits to {page}}}",id:"assistant.transactionRenderer.editedPage.title",values:{numEdits:r,page:(0,I.jsx)(W.Z,{store:m,style:s.pageTitle})}})})}),a&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{style:s.subheader,children:"Updated title"}),p&&(0,I.jsx)(q,{spaceId:g,blockIds:[t.pageId],parentStore:d})]}),S.length>0&&(0,I.jsxs)(I.Fragment,{children:[`Updated ${S.length} ${S.length>1?"properties":"property"}`,p&&S.map(((e,t)=>(0,I.jsx)(U,{pageStore:m,property:e},t)))]}),e.size>0&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{style:s.subheader,children:`Inserted ${e.size} block${e.size>1?"s":""}`}),p&&(0,I.jsx)(q,{spaceId:g,blockIds:Array.from(e),parentStore:d})]}),n.size>0&&(0,I.jsx)(I.Fragment,{children:(0,I.jsxs)("div",{style:s.subheader,children:[`Updated ${n.size} block${n.size>1?"s":""}`,p&&(0,I.jsx)(q,{spaceId:g,blockIds:Array.from(n),parentStore:d})]})}),i.size>0&&(0,I.jsx)(I.Fragment,{children:(0,I.jsxs)("div",{style:s.subheader,children:[`Removed ${i.size} block${i.size>1?"s":""}`,p&&(0,I.jsx)(q,{spaceId:g,blockIds:Array.from(i),parentStore:d})]})})]})}if("removedPage"===t.type)return(0,I.jsx)(E.Z,{style:s.header,href:h,children:(0,I.jsx)("span",{children:(0,I.jsx)(u.FormattedMessage,{defaultMessage:"Deleted {page}",id:"assistant.transactionRenderer.removedPage.title",values:{page:(0,I.jsx)("span",{style:{fontWeight:_.Z.fontWeight.bold},children:(0,I.jsx)(W.Z,{store:m,style:s.pageTitle})})}})})});(0,c.t1)(t)}function U(e){window.__c={n:"BlockPropertyRenderer"};const{pageStore:t,property:n}=e,s=(0,a.VK)((()=>t.getParentCollectionStore()),[t]),i=(0,a.VK)((()=>{const e=null==s?void 0:s.getSchema(),t=Object.entries(e||{}).find((e=>{let[t]=e;return t===n}));return null==t?void 0:t[1]}),[s,n]),o=(0,a.VK)((()=>t.getPropertyValue(n)),[t,n]);return s&&i?(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(K.Hq,{labeled:!0,name:i.name,type:i.type,icon:i.icon,style:{marginBottom:6},children:(0,I.jsx)(O.Z,{propertySchema:i,beforeValue:{value:[],spaceId:s.getSpaceId()},afterValue:{value:o||[],spaceId:s.getSpaceId()},rootStore:t})})}):null}function q(e){window.__c={n:"BlockListRenderer"};const{blockIds:t,parentStore:n,spaceId:i}=e,a=B.d9(t).reverse(),o=(0,s.useMemo)((()=>x.Z.withListenerIgnored((()=>a.map((e=>D.G.createChildStore(n,{table:P.iU,id:e,spaceId:i})))))),[a,n,i]);return(0,I.jsx)(C.O,{displayName:"AssistantBlockRenderer",disabled:!0,children:o.map(((e,t)=>(0,I.jsx)($,{store:e},t)))})}function $(e){window.__c={n:"BlockRenderer"};const{store:t}=e,n=(0,a.VK)((()=>(0,L.h)(t)),[t]);return n?(0,I.jsx)(n,{store:t,disabled:!0,isFirstItem:!1,isLastItem:!1}):null}function G(e){window.__c={n:"AssistantChatStep"};const{clientStep:t,parentStore:n,parentSpaceId:s,fakeSlackUser:x,configurationState:y,isQuickSearchMode:k,renderAsFullPage:w,latestStepCitationHoverStore:b}=e,C=(0,i.O7)(),A=(0,o.Fg)(),j=(0,a.VK)((()=>{const e=S.Z.getActiveAssistantRuntimeStore(),t=(null==e?void 0:e.getCombinedSteps())??[],n=t.findLast((e=>"human"===e.type));if(!n)return;const s=t.indexOf(n);return t.slice(s-1).find((e=>"assistantSearch"===e.type||"assistantLoadPage"===e.type))}),[]),T=(0,a.VK)((()=>{var e;return(null===(e=S.Z.getActiveAssistantRuntimeStore())||void 0===e||null===(e=e.state)||void 0===e?void 0:e.isAiProviderDown)??!1}),[]),F=(0,a.VK)((()=>f.default.getConfigKey("assistant_error_message_override","message")),[]),{isCurrentClientStepLatestStep:R,priorSearchResultsStep:B}=(0,a.VK)((()=>{const e=S.Z.getActiveAssistantRuntimeState(),n=[...(null==e?void 0:e.clientSteps)??[],...(null==e?void 0:e.temporaryClientSteps)??[]],s=n.indexOf(t),i=s-1>=0?n[s-1]:void 0;return{isCurrentClientStepLatestStep:s>=0&&s===n.length-1,priorSearchResultsStep:"assistantShowSearchResults"===(null==i?void 0:i.type)?i:void 0}}),[t]),P=(0,a.VK)((()=>"human"===t.type?{element:(0,I.jsx)("div",{style:{wordBreak:"break-word"},children:(0,h.IY)({environment:C,textValue:{value:t.text,spaceId:(0,d.C)(s)},parentStore:n,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,theme:A,emojiType:(0,g.e_)(C),katex:C.KatexStore.getKatex(),formulaValueTypes:[]})})}:"assistantLoading"===t.type?{element:(0,I.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:["assistantSearch"===(null==j?void 0:j.type)?(0,I.jsx)(u.FormattedMessage,{id:"AssistantChatStep.searching",defaultMessage:"Searching {icon} {keywords}",description:"Placeholder text while the AI is searching. The icon is a magnifying glass.",values:{icon:(0,l.R)({width:12,height:12}),keywords:(0,I.jsx)("span",{style:{fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",maxWidth:"70%",textTransform:"lowercase",whiteSpace:"nowrap"},children:j.keywords})},children:function(e){return(0,I.jsx)(I.Fragment,{children:e.map(((e,t)=>"string"==typeof e?(0,I.jsx)("span",{children:e},t):e))})}}):"assistantLoadPage"===(null==j?void 0:j.type)?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(u.FormattedMessage,{id:"AssistantChatStep.loadingPage",defaultMessage:"Reading page"})," "]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(u.FormattedMessage,{id:"AssistantChatStep.thinking",defaultMessage:"Thinking"})," "]}),(0,I.jsx)("div",{style:{marginLeft:4},children:(0,I.jsx)(p.Z,{isTriColored:!0})})]})}:"assistantThink"===t.type?{element:(0,I.jsx)(I.Fragment,{children:`💡 ${t.thought}`})}:"assistantChatText"===t.type?(0,m.S)(t)?{element:null,doNotWrap:!0}:{element:(0,I.jsx)(M,{clientStep:t})}:"assistantChat"===t.type?(0,m.S)(t)?{element:null,doNotWrap:!0}:{element:(0,I.jsx)(v.m,{clientStep:t,parentStore:n,configurationState:y,fakeSlackUser:x,isLatestStep:R,isQuickSearchMode:k,renderAsFullPage:w,priorSearchResultsStep:B,citationHoverStore:R?b:void 0}),doNotWrap:!0}:"assistantTransaction"===t.type?{element:(0,I.jsx)(z,{clientStep:t})}:"assistantLoadPage"===t.type?{element:(0,I.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,I.jsx)(u.FormattedMessage,{id:"AssistantChatStep.loadPage",defaultMessage:"Reading pages"}),(0,I.jsx)("div",{style:{marginLeft:6},children:(0,I.jsx)(p.Z,{})})]})}:"assistantFriendlyError"===t.type?{element:(0,I.jsx)("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",padding:"8px 4px"},children:F||(T?"I'm sorry! We’re experiencing issues with our AI provider. Try again in a few minutes.":"I'm sorry! I wasn't able to complete this query. Please try asking me a different question.")})}:"assistantSearch"===t.type?{element:(0,I.jsxs)("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap"},children:[(0,r.e)({width:14,marginRight:4}),(0,I.jsx)(u.FormattedMessage,{id:"AssistantChatStep.search",defaultMessage:"Search {text}",values:{text:(0,I.jsx)("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.question})}})]})}:"assistantSearchPeople"===t.type?{element:(0,I.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,I.jsx)(u.FormattedMessage,{id:"AssistantChatStep.searchPeople",defaultMessage:"Looking up people"}),(0,I.jsx)("div",{style:{marginLeft:6},children:(0,I.jsx)(p.Z,{})})]})}:"queryDatabase"===t.type?{element:(0,I.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,I.jsx)(u.FormattedMessage,{id:"AssistantChatStep.queryDatabase",defaultMessage:"Querying databases"}),(0,I.jsx)("div",{style:{marginLeft:6},children:(0,I.jsx)(p.Z,{})})]})}:"assistantShowSearchResults"===t.type?{element:null,doNotWrap:!0}:"assistantLimitReached"===t.type?{element:(0,I.jsx)(I.Fragment,{children:t.message})}:void(0,c.t1)(t)),[t,C,s,n,A,y,x,R,k,w,B,b,j,T,F]);return P.doNotWrap?P.element:(0,I.jsx)(Z.J,{clientStep:t,configurationState:y,fakeSlackUser:x,forceShowFeedback:R,children:P.element})}},61144:(e,t,n)=>{n.d(t,{J:()=>g,O:()=>p});var s=n(67294),i=n(480),a=n(6740),o=n(24405),r=n(72126),l=n(26388),d=(n(95477),n(82375)),c=n(33871),u=n(85893);const p="min(calc(100% - 48px), 512px)",g=(0,s.forwardRef)((function(e,t){window.__c={n:"AssistantChatStepWrapper"};const{children:n,clientStep:g,configurationState:m,fakeSlackUser:h,forceShowFeedback:S}=e,f=(0,i.O7)(),v=f.device.isMobile,x=(0,o.yK)((e=>({wrap:{display:"flex",marginTop:6,marginBottom:6,gap:6},baseMessage:{maxWidth:p,borderRadius:16,padding:"4px 12px",fontSize:v?15:14,whiteSpace:"pre-wrap",overflowWrap:"break-word",position:"relative",lineHeight:1.45},userLabel:{fontSize:12,color:e.mediumTextColor},humanMessage:{backgroundColor:"light"===e.mode?e.cardHoveredBackground:e.accentColors.translucentGray[100],color:e.darkTextColor,padding:"6px 14px",border:"unset"},assistantThinkMessage:{backgroundColor:e.accentColors.gray[50],color:e.mediumTextColor},assistantLoadingMessage:{fontSize:12,color:e.lightTextColor,fontWeight:500,padding:"4px 0 0 6px"},assistantShowSearchResultsMessage:{color:e.mediumTextColor,border:`1px solid ${"light"===e.mode?e.accentColors.gray[75]:e.accentColors.translucentGray[200]}`},assistantMessage:{border:`1px solid ${"light"===e.mode?e.accentColors.gray[75]:e.accentColors.translucentGray[200]}`,backgroundColor:"light"===e.mode?e.contentBackground:e.accentColors.translucentGray[200],color:e.regularTextColor,padding:"2px 10px",boxShadow:"0px 2px 4px 0px rgba(0, 0, 0, 0.04), 0px 0px 6px 0px rgba(0, 0, 0, 0.02)"}})),[v]),[y,k]=(0,s.useState)(!1),w=(0,s.useMemo)((()=>(0,r.Ds)(k,100)),[k]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(l.Z,{placement:l.Z.Placement.Left,textWrap:!0,style:{maxWidth:240},disableTooltip:!("thought"in g&&g.thought,0),renderTooltip:()=>"thought"in g?`💡 ${g.thought}`:void 0,delayThreshold:500,render:e=>(0,u.jsxs)("div",{ref:t,style:x.wrap,...e,onFocus:t=>{var n;null===(n=e.onFocus)||void 0===n||n.call(e,t),(0,a.E)(t.target)&&w(!0)},onMouseEnter:t=>{var n;null===(n=e.onMouseEnter)||void 0===n||n.call(e,t),w(!0)},onBlur:t=>{var n;null===(n=e.onBlur)||void 0===n||n.call(e,t),w(!1)},onMouseLeave:t=>{var n;null===(n=e.onMouseLeave)||void 0===n||n.call(e,t),w(!1)},children:["human"===g.type&&(0,u.jsx)("div",{style:{flexGrow:1}}),(0,u.jsx)("div",{style:{...x.baseMessage,..."human"===g.type?x.humanMessage:"assistantThink"===g.type||"assistantLoading"===g.type?x.assistantLoadingMessage:"assistantShowSearchResults"===g.type?x.assistantShowSearchResultsMessage:x.assistantMessage},children:n}),"assistantChat"===g.type&&(0,d.Of)(g)&&(0,u.jsx)(c.x,{configurationState:m,environment:f,isVisible:y||S,clientAssistantChatStep:g})]})}),h&&"human"===g.type&&(0,u.jsxs)("div",{style:{display:"flex"},children:[(0,u.jsx)("div",{style:{flexGrow:1}}),(0,u.jsx)("div",{style:x.userLabel,children:h.name})]})]})}))},49053:(e,t,n)=>{n.d(t,{v:()=>l});n(67294);var s=n(480),i=n(24405),a=n(68939),o=n(89728),r=n(85893);function l(e){window.__c={n:"AssistantClearButton"};const{disabled:t,onClick:n,style:l}=e,{isMobile:d}=(0,s.Fy)(),c=(0,i.yK)((e=>({button:{color:t?e.lightTextColor:e.mediumIconColor,opacity:t?.5:1,height:24,paddingLeft:6,paddingRight:6,fontSize:d?15:13,...l}})),[t,l,d]);return(0,r.jsx)(o.Z,{style:c.button,onClick:n,disabled:t,isSmall:!0,children:(0,r.jsx)(a.FormattedMessage,{id:"searchAssistantPane.header.clear.label",defaultMessage:"Clear"})})}},33871:(e,t,n)=>{n.d(t,{x:()=>N});var s=n(67294),i=n(86628),a=n(24405),o=n(77058),r=n(33676),l=n(97022),d=n(39986),c=n(10498),u=n(24677),p=n(64964),g=n(23063),m=n(73063),h=n(21273),S=n(49085);class f extends S.default{getInitialState(){return{}}}const v=new f;var x=n(98180);class y extends S.default{getInitialState(){return{open:!1,inferenceId:void 0}}}const k=new y;var w=n(26382),b=n(480),C=n(39040),A=n(70203),j=n(82990),I=n(68939),M=n(54642),Z=n(42922),T=n(60458),F=n(36488),R=n(74194),B=n(63296),P=n(53336),_=n(64369),K=n(92660),L=(n(95477),n(60682)),V=n(14976),E=n(34859),W=n(80444),O=n(69454),H=n(85893);const Q=["Difficult to understand","Does not answer my question","Contains irrelevant details","Contains misleading or made-up information","Uses outdated information","I don't fully trust this answer"];function D(){window.__c={n:"ReportBadQnAForm"};const{isMobile:e}=(0,b.Fy)(),t=(0,a.yK)((t=>({wrap:{display:"flex",flexDirection:"column",width:e?"min(100%, 600px)":void 0,minHeight:128,maxHeight:e?void 0:"max(calc(100vh - 78px), 300px)"},reasonsArea:{width:"100%",background:t.popoverBackground,display:"block",marginBottom:16},title:{fontSize:13},checkboxArea:{display:"flex",alignItems:"center",gap:8},modalWrap:{width:"32rem",padding:24,fontSize:14,maxWidth:"100%"},modalTitle:{fontSize:16,fontWeight:j.Z.fontWeight.medium},modalWarning:{fontSize:13,color:t.lightTextColor},modalSubtitle:{fontSize:13},titleContainer:{marginBottom:12},buttonArea:{display:"flex",justifyContent:"flex-end",marginTop:18,gap:8},outlineButton:{marginRight:12},selectAll:{fontWeight:500,marginBottom:4},checkboxContainer:{display:"flex",flexDirection:"column",gap:4},linkTruncated:{maxWidth:"16rem",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",fontSize:13},scroller:{flexGrow:1,display:"flex",flexDirection:"column",WebkitMaskImage:"linear-gradient(black calc(100% - 12px), transparent)"}})),[e]),n=(0,I.useIntl)(),[o,r]=(0,s.useState)([]),l=(0,s.useCallback)((e=>()=>{o.includes(e)?r((t=>t.filter((t=>t!==e)))):r((t=>[...t,e]))}),[o]),d=e=>o.includes(e),[c,u]=(0,s.useState)(),[p,g]=(0,s.useState)([]),m=(0,i.VK)((()=>W.default.state.currentSpaceStore),[]),h=(0,b.O7)(),S=(0,a.Fg)(),f=(0,s.useCallback)((()=>{const{inferenceId:e}=k.state,t=null==m?void 0:m.id;e&&t&&(M.saveAssistantFeedback(h,{type:"slackbot_followup_feedback",id:e,notes:c||"",reasons:o,correctAnswerPageIds:p}),k.reset())}),[null==m?void 0:m.id,h,c,o,p]),v=(0,s.useCallback)((e=>{p.includes(e)?g((t=>t.filter((t=>t!==e)))):g((t=>[...t,e]))}),[p]),y=(0,s.useCallback)((e=>p.includes(e)),[p]),w=(0,i.VK)((()=>{var e,t,n;const s=x.Z.getActiveAssistantRuntimeState(),i=null==s||null===(e=s.evaluator)||void 0===e||null===(e=e.codeEvaluator)||void 0===e?void 0:e.state,a=W.default.state.currentSpaceStore,o=null==s||null===(t=s.evaluator)||void 0===t?void 0:t.getTranscript().filter((e=>"observation"===e.type&&"search"===e.observationType)),r=null==o||null===(n=o[o.length-1])||void 0===n?void 0:n.value;if(!r||!a)return[];const l=(0,C.P)(r)[0];if("element"===(d=l).type&&"search-results"===d.tagName&&(null===(c=d.children)||void 0===c?void 0:c.every((e=>"element"===e.type&&"page-result"===e.tagName)))){return l.children.map((e=>{var t;return((null==e||null===(t=e.attributes)||void 0===t?void 0:t.id)&&(null==i?void 0:i.getIdMapper().mapCounterToKey(e.attributes.id).key))??void 0})).filter((e=>!!e)).map((e=>({pageId:e,component:(0,V.IY)({environment:h,parentStore:a,textValue:{value:[(0,A.YCD)(["p",e])],spaceId:a.id},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disabled:!0,theme:S,emojiType:(0,L.e_)(h),katex:h.KatexStore.getKatex(),formulaValueTypes:[]})})))}var d,c;return[]}),[h,S]),D=(0,s.useRef)(void 0);return(0,H.jsx)(K.Z,{onDismiss:z,style:e?{maxHeight:"100%",display:"flex"}:{},render:()=>(0,H.jsx)(F.Z,{allowMobileAutoScroll:!0,capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,render:s=>(0,H.jsx)("div",{style:t.wrap,children:(0,H.jsx)(P.Z,{ref:D,type:E.Z.Y,style:t.scroller,...s,children:(0,H.jsxs)("div",{style:t.modalWrap,...s,children:[(0,H.jsxs)("div",{style:t.titleContainer,children:[(0,H.jsx)("div",{style:t.modalTitle,children:(0,H.jsx)(I.FormattedMessage,{id:"BadQnAFeedbackForm.title",defaultMessage:"Give feedback on this answer"})}),(0,H.jsx)("div",{style:t.modalWarning,children:(0,H.jsx)(I.FormattedMessage,{id:"BadQnAFeedbackForm.warning",defaultMessage:"Chat and search results will be sent to Notion for quality improvement"})})]}),(0,H.jsxs)("div",{style:t.reasonsArea,children:[(0,H.jsx)("div",{style:t.selectAll,children:(0,H.jsx)(I.FormattedMessage,{id:"BadQnAFeedbackForm.whatWentWrong",defaultMessage:"What should we know about this answer?"})}),(0,H.jsx)("div",{style:t.checkboxContainer,children:Q.map((e=>(0,H.jsxs)("div",{style:t.checkboxArea,children:[(0,H.jsx)(T.Z,{checked:d(e),onClick:l(e),size:14,checkSize:10}),(0,H.jsx)(_.Z,{style:t.title,children:e})]},e)))})]}),(0,H.jsxs)("div",{style:t.reasonsArea,children:[(0,H.jsx)("div",{style:t.selectAll,children:(0,H.jsx)(I.FormattedMessage,{id:"BadQnAFeedbackForm.chooseBestPage",defaultMessage:"Do any of these pages have the correct answer?"})}),(0,H.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:w.map(((e,n)=>(0,H.jsxs)("div",{style:t.checkboxArea,children:[(0,H.jsx)(T.Z,{checked:y(e.pageId),onClick:()=>v(e.pageId),size:14,checkSize:10}),(0,H.jsx)("div",{style:t.linkTruncated,onClick:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.firstElementChild instanceof HTMLAnchorElement&&window.open(e.currentTarget.firstElementChild.href,"_blank")},children:e.component})]},e.pageId)))})]}),(0,H.jsx)(R.Z,{placeholder:n.formatMessage({id:"BadQnAFeedbackForm.additionalCommentsPlaceholder",defaultMessage:"Additional comments..."}),value:c,onChange:e=>u(e.target.value),focusInitial:!e,onFocus:()=>{e&&O.Z.onShow((()=>{var e;null===(e=D.current)||void 0===e||e.scrollToBottom()}))},inputStyle:{padding:8}}),(0,H.jsxs)("div",{style:t.buttonArea,children:[(0,H.jsx)(B.Z,{onClick:z,children:(0,H.jsx)(I.FormattedMessage,{id:"BadQnAFeedbackForm.cancelButton.label",defaultMessage:"Cancel"})}),(0,H.jsx)(Z.Z,{isLarge:!0,onClick:f,children:(0,H.jsx)(I.FormattedMessage,{id:"BadQnAFeedbackForm.reportButton.label",defaultMessage:"Send"})})]})]})})})}),requireOnline:!0,modalStore:k})}function z(){k.update((()=>({open:!1,inferenceId:void 0})))}function N(e){let{configurationState:t,environment:n,isVisible:m,clientAssistantChatStep:S}=e;window.__c={n:"AssistantFeedbackButtons"};const{inferenceId:f}=S,y=(0,i.VK)((()=>v.state[f]??void 0),[f]),b=(0,a.yK)((e=>({thumbsUpFeedbackButton:{width:14,height:14,fill:"thumbs_up"===y?e.blueButtonBackground:e.grayButtonHoveredBackground},thumbsDownFeedbackButton:{width:14,height:14,fill:"thumbs_down"===y?e.blueButtonBackground:e.grayButtonHoveredBackground}})),[y]),C=(0,i.VK)((()=>h.Z.isAssistantExperienceQna()),[]),A=(0,s.useCallback)((()=>{const e=x.Z.getActiveSessionId();e&&(w.assistantActions.saveFeedback({environment:n,inferenceId:f,type:"assistant_thumbs_up",sessionId:e}),v.update((e=>({...e,[f]:"thumbs_up"}))),p.oV({label:(0,H.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,o.$)({width:16,height:16}),"Thanks for your feedback!"]})}))}),[n,f]),j=(0,s.useCallback)((()=>{u.ZH({device:n.device});const e=x.Z.getActiveSessionId();e&&(w.assistantActions.saveFeedback({environment:n,inferenceId:f,type:"assistant_thumbs_down",sessionId:e}),v.update((e=>({...e,[f]:"thumbs_down"}))),k.update((()=>({open:!0,inferenceId:f}))))}),[n,f]);return(0,H.jsx)(g.Z,{isVisible:!0,animationStyle:{opacity:m||Boolean(y)?1:0},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:1},render:()=>(0,H.jsxs)("div",{style:{marginTop:"auto",display:"flex"},children:[(0,H.jsx)(U,{type:"up",iconHollow:d.P,iconFilled:c.w,onClick:A,style:b.thumbsUpFeedbackButton,feedbackReceived:y}),(0,H.jsx)(U,{type:"down",iconHollow:r.A,iconFilled:l.E,onClick:j,style:b.thumbsDownFeedbackButton,feedbackReceived:y}),C?(0,H.jsx)(D,{}):null]})})}function U(e){let{type:t,iconHollow:n,iconFilled:s,feedbackReceived:i,style:a,onClick:o}=e;const r=i===`thumbs_${t}`;return(0,H.jsx)(m.Z,{icon:r?s:n,onClick:r?()=>{}:o,disableBackground:r,iconStyle:{cursor:r?"initial":"pointer",...a},ariaLabel:`Thumbs ${t} feedback on assistant message`})}},85075:(e,t,n)=>{n.d(t,{Qn:()=>ue,xu:()=>pe,GA:()=>ce});n(21703);var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(12174),l=n(59054),d=n(37652),c=n(36591),u=n(1464),p=n(64275),g=n(56666),m=n(88437),h=n(11751),S=n(82990),f=n(68939),v=n(50906),x=n(4653),y=n(19471),k=(n(82801),n(57658),n(13991)),w=n(7057),b=n(80721),C=n(5257),A=n(97880),j=n(87279),I=n(98180),M=n(52275),Z=n(73063),T=n(78140),F=n(32163),R=n(72495),B=n(85893);function P(e){window.__c={n:"AssistantDebugPopupMenu"};const{buttonPopupParent:t}=e,n=(0,f.useIntl)(),[i,o]=(0,s.useState)(void 0),r=(0,a.VK)((()=>function(e){const t=[];for(const[i,a]of(0,A.qP)(I.Z.state.sessions)){var n,s;const o=null==a||null===(n=a.assistantConfigurationStore.state)||void 0===n?void 0:n.startTimestamp;t.push({sessionId:i.toString(),skillType:(null==a||null===(s=a.assistantRuntimeStore.state)||void 0===s||null===(s=s.selectedSkill)||void 0===s?void 0:s.skillType)??"general_assistant",timestamp:void 0!==o?(0,w.$b)(o,k.SP,e):void 0})}return t}(n)),[n]),l=(0,s.useCallback)((()=>{const e=_(null==i?void 0:i.sessionId),t=(null==e?void 0:e.getTranscript())??[],n=JSON.stringify(t);navigator.clipboard.writeText(n)}),[i]),d=(0,s.useCallback)((()=>{const e=_(null==i?void 0:i.sessionId),t=null==e?void 0:e.getInferenceInputForEval({skipLastAssistantStep:!0}),n=JSON.stringify(t);navigator.clipboard.writeText(n)}),[i]),c=(0,s.useCallback)((()=>{const e=_(null==i?void 0:i.sessionId),t=null==e?void 0:e.getInferenceInputForEval({skipLastAssistantStep:!0}),n=JSON.stringify(t),s=btoa(encodeURIComponent(n));window.open(`/design/aiJsonRenderer#jsonl=${s}`,"_blank")}),[i]),u={key:"debug-data",render:e=>(0,B.jsx)(R.Z,{...e,desktopTitleStyle:{alignItems:"center",paddingLeft:2,marginTop:0},title:(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(Z.Z,{icon:b.W,ariaLabel:"debug-menu-back-button",onClick:()=>o(void 0),iconStyle:{width:12,height:12}}),null==i?void 0:i.skillType]}),right:null==i?void 0:i.timestamp}),items:[{key:"copy-transcript",render:e=>(0,B.jsx)(M.Z,{...e,title:"Copy transcript"}),action:()=>{l(),t.close()}},{key:"copy-eval",render:e=>(0,B.jsx)(M.Z,{...e,title:"Copy as AssistantInferenceInput"}),action:()=>{d(),t.close()}},{key:"open-in-jsonl-viewer",render:e=>(0,B.jsx)(M.Z,{...e,title:"Open in JSONL viewer"}),action:()=>{c(),t.close()}}]},p=r.map((e=>{let{sessionId:t,skillType:n,timestamp:s}=e;return{key:t,action:()=>{o({sessionId:t,skillType:n,timestamp:s})},render:e=>(0,B.jsx)(M.Z,{...e,title:n,right:(0,B.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[s,(0,C.o)({marginLeft:4,width:12})]})})}})),g={key:"sessions",render:e=>(0,B.jsx)(R.Z,{...e}),items:p},m={key:"empty",render:e=>(0,B.jsx)(R.Z,{...e}),items:[{key:"empty-item",action:()=>{},render:e=>(0,B.jsx)(M.Z,{...e,title:"No sessions found"})}]},h=i?u:p.length>0?g:m;return(0,B.jsx)(T.Z,{menuType:j.og.Popup,width:300,children:(0,B.jsx)(F.Z,{type:F.i.Vertical,initialFocus:0,sections:[h]})})}function _(e){var t;if(e)return null===(t=I.Z.getSessionContext(e))||void 0===t||null===(t=t.assistantRuntimeStore)||void 0===t||null===(t=t.state)||void 0===t?void 0:t.evaluator}var K=n(23063),L=n(64921),V=n(31945),E=n(88359),W=n(89728),O=n(45959),H=n(26388),Q=(n(95477),n(19124)),D=n(77907),z=n(80444),N=n(21273),U=n(82375),q=n(61766),$=n(7339),G=n(50929),Y=n(28344),J=n(33932),X=n(70771),ee=n(56206),te=n(40824),ne=n(88709),se=n(49053),ie=n(80594),ae=n(14309),oe=n(42853),re=n(27967),le=n(5175);function de(e){window.__c={n:"AssistantSkillSwitcherButton"};const{store:t}=e,n=(0,a.VK)((()=>t.state),[t]),i=(0,o.yK)((e=>({skillIcon:{fill:e.aiPurpleColor},chevronDown:{fill:e.mediumIconColor,width:12,marginLeft:4}})),[]),r=(0,s.useCallback)((()=>{(0,J.navigateToView)({view:"skillSwitcher"})}),[]);if(null==n||!n.selectedSkill)return null;const{selectedSkill:l}=n;return(0,B.jsxs)(W.Z,{onClick:r,icon:re.skillIconMap[l.skillType],iconStyle:i.skillIcon,children:[(0,B.jsx)(le.Z,{clientSkill:l}),(0,oe.i)(i.chevronDown)]})}const ce=new q.Z;function ue(e){var t;window.__c={n:"AssistantMenu"};const{renderAsFullPage:n,showBackButton:r,onClose:c}=e,h=(0,i.O7)(),k=(0,a.VK)((()=>N.Z.isAssistantExperienceQna()),[]),w=(0,a.VK)((()=>{var e;return null===(e=I.Z.getActiveAssistantConfigurationStore())||void 0===e?void 0:e.hasLockAction()}),[]),b=(0,a.VK)((()=>I.Z.getActiveAssistantRuntimeStore()),[]),C=(0,a.VK)((()=>I.Z.getActiveAssistantRuntimeState()),[]),A=(0,a.VK)((()=>N.Z.isAssistant2Enabled(null==C?void 0:C.selectedSkill)),[C]),j=(0,s.useCallback)((()=>{N.Z.isAssistantExperienceQna()&&Y.trackQnaClear(h,I.Z.getActiveAssistantConfigurationState(),I.Z.getActiveAssistantRuntimeState()),(0,G.clearActiveAssistantSession)({environment:h})}),[h]),T=(0,a.VK)((()=>{const e=I.Z.getActiveAssistantRuntimeState();return!e||!I.Z.getActiveAssistantConfigurationState()||!e.selectedSkill&&0===e.clientSteps.length&&0===e.temporaryClientSteps.length}),[]),F=(0,a.VK)((()=>{var e;return null===(e=z.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),R=(0,a.VK)((()=>(0,Q.Gw)()),[]),_=(0,a.VK)((()=>ee.d.state.currentView),[]),L=(0,a.VK)((()=>U.Pl.state),[]),q=Boolean(L),$=(0,a.VK)((()=>N.Z.isMode("ai_team")),[]);(0,l.r5)((async()=>{F&&await(0,X.K7)({environment:h,spaceId:F})}),[h,F]);const[oe,re]=(0,s.useState)([]),le=(0,D.useDependency)(D.deps.searchActions);(0,s.useEffect)((()=>{if(!q)return;if("resolved"!==le.status)return;le.value.searchVisibleSpaceUsers({environment:h,query:"",membersOnly:!1}).then((e=>re(e))).catch((e=>{throw new Error(e)}))}),[h,q,le]);const ue=(0,s.useCallback)((()=>{J.navigateToView({view:"chat"})}),[]),ge=(0,s.useCallback)((()=>{te.N.setAssistantLastViewedTime(),null==c||c();const e=N.Z.isAssistantExperienceQna(),t=I.Z.getActiveAssistantConfigurationState();t&&e&&Y.trackQnaClosed(h,{configurationState:t,runtimeState:I.Z.getActiveAssistantRuntimeState(),from:"button"})}),[h,c]),me=(0,s.useCallback)((()=>{I.Z.endCurrentSession(),q?U.Pl.setState(void 0):U.Pl.setState({enabled:!0,selectedFakeUser:void 0,selectedFakeChannel:"#"})}),[q]),Se=(0,s.useCallback)((()=>{const e=I.Z.getActiveAssistantConfigurationState();e&&v.Ar6(h,{qnaSessionId:e.sessionId,from:"qna_modal_menu"}),x.i(h)}),[h]),fe=(0,s.useCallback)((()=>{J.closeAssistantRightHandSideMenu()}),[]),ve=function(e){const{hasLockAction:t,renderAsFullPage:n}=e,{device:s}=(0,i.O7)(),{isMobile:a}=s;return(0,o.yK)((e=>({wrap:{display:"flex",flexDirection:"column",width:n?"min(100%, 640px)":375,transition:"height 200ms ease",minHeight:128,height:n?"100%":void 0,maxHeight:n?void 0:"max(calc(100vh - 78px), 300px)"},header:{display:"flex",alignItems:"center",pointerEvents:"auto",paddingTop:12,paddingLeft:16,paddingRight:16,paddingBottom:12},labeledInput:{display:"flex",gap:8,alignItems:"center"},clearButton:{color:t?e.lightTextColor:e.mediumIconColor,opacity:t?.5:1},headerButton:{color:e.mediumIconColor},closeButton:{borderRadius:"100%",marginLeft:4,width:22,height:22},backwardButton:{borderRadius:"100%",marginRight:6},input:{width:void 0,marginLeft:8,marginRight:8},inputLabel:{fontSize:a?16:14,color:e.mediumTextColor},faceImgWrap:{width:64,height:64,borderRadius:"100%",background:"white",boxShadow:e.largeLightBoxShadow,overflow:"hidden"},faceImg:{width:64,pointerEvents:"none"},emptyStateText:{marginTop:28,fontSize:16,color:e.regularTextColor,fontFamily:S.Z.baseFontFamily.serif},inputWrap:{paddingTop:8,paddingBottom:8},skillsCaption:{fontSize:a?14:12,color:e.mediumTextColor,marginBottom:8},skillIcon:{fill:e.aiPurpleColor},skillsWrap:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:8},rightButtons:{display:"flex",alignItems:"center",gap:6},headerContentLeftOfClose:{display:"flex",marginRight:"8px",flexGrow:1,alignItems:"center"}})),[t,n,a])}({hasLockAction:w,renderAsFullPage:n});return(0,B.jsxs)("div",{style:ve.wrap,children:[(0,B.jsxs)("div",{style:ve.header,children:[(0,B.jsxs)("div",{style:ve.headerContentLeftOfClose,children:[r&&(0,B.jsx)(Z.Z,{iconStyle:{width:32,height:32},style:ve.backwardButton,icon:u.k,onClick:ge,disableBackground:!0,isDarkIconColor:!0,ariaLabel:"close"}),"chat"===_&&(0,B.jsxs)(B.Fragment,{children:[C&&b&&A&&(0,B.jsx)(de,{store:b}),A&&"persisted"===(null==C||null===(t=C.selectedSkill)||void 0===t?void 0:t.type)&&(0,B.jsx)(ie.Z,{clientSkill:C.selectedSkill,renderOrigin:e=>(0,B.jsx)(W.Z,{...e,style:ve.headerButton,children:(0,B.jsx)(f.FormattedMessage,{id:"assistantMenu.skillEdit.label",defaultMessage:"Edit"})})}),k&&(0,B.jsx)(pe,{}),A&&!(null!=C&&C.selectedSkill)&&(0,B.jsx)(he,{}),(0,B.jsx)("div",{style:{flexGrow:1}}),R&&(0,B.jsx)(W.Z,{style:ve.headerButton,onClick:me,children:q?"Disable Slack mode":"Enable Slack mode"})]}),"skillSwitcher"===_&&(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(Z.Z,{icon:d.V,onClick:ue,ariaLabel:"back"}),(0,B.jsx)("div",{style:{marginLeft:4,fontSize:14},children:"All skills"}),(0,B.jsx)("div",{style:{flexGrow:1}})]}),(0,B.jsxs)("div",{style:ve.rightButtons,children:[(0,B.jsx)(K.Z,{enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},animationStyle:{opacity:1},render:()=>(0,B.jsx)(se.v,{onClick:j,disabled:T}),isVisible:!T}),$&&(0,B.jsx)(V.ZP,{popupType:h.device.isMobile?V.Z4.SlideUp:V.Z4.Popup,renderOrigin:e=>(0,B.jsx)(H.Z,{render:t=>(0,B.jsx)(Z.Z,{iconStyle:{width:18,height:18},icon:m.a,ariaLabel:"See debug data",...t,...e}),renderTooltip:()=>(0,B.jsx)(f.FormattedMessage,{id:"assistant.copyTranscript",defaultMessage:"Debug data [dev]"})}),render:e=>(0,B.jsx)(P,{buttonPopupParent:e})}),"chat"===_&&!h.device.isMobileNative&&(0,B.jsx)(V.ZP,{buttonPopupStore:ce,popupType:h.device.isMobile?V.Z4.SlideUp:V.Z4.Popup,onClick:Se,renderOrigin:e=>(0,B.jsx)(H.Z,{render:t=>(0,B.jsx)(Z.Z,{iconStyle:{width:16,height:16},icon:g.o,ariaLabel:"more",...t,...e}),renderTooltip:()=>(0,B.jsx)(f.FormattedMessage,{id:"assistant.help",defaultMessage:"Help, contact, more..."})}),render:()=>(0,B.jsx)(D.LazyHelpButtonContent,{shouldRenderAsStaticModal:!1,fromForAnalytics:"ai_qna",onAcceptMessageSupport:fe})})]})]}),!n&&(0,B.jsx)(Z.Z,{style:ve.closeButton,hovered:!0,icon:p.D,onClick:ge,ariaLabel:"close"})]}),q&&(0,B.jsxs)("div",{style:{...ve.header,flexDirection:"column",gap:6},children:[(0,B.jsxs)("div",{style:ve.labeledInput,children:[(0,B.jsx)("div",{style:ve.inputLabel,children:"Channel"}),(0,B.jsx)(y.b,{value:(null==L?void 0:L.selectedFakeChannel)||"",onChange:e=>{if(!L)throw new Error("slackModeState is undefined");U.Pl.setState({...L,selectedFakeChannel:e})},disabled:Boolean(C),placeholder:"Channel name",style:ve.input})]}),(0,B.jsxs)("div",{style:ve.labeledInput,children:[(0,B.jsx)("div",{style:ve.inputLabel,children:"User"}),(0,B.jsx)(O.Z,{items:oe,selectedItem:null==L?void 0:L.selectedFakeUser,getKey:e=>e.name||e.id,renderItem:e=>(0,B.jsx)(M.Z,{...e,title:e.key}),onSelect:e=>{if(!L)throw new Error("slackModeState is undefined");U.Pl.setState({...L,selectedFakeUser:e})},renderOrigin:e=>(0,B.jsx)(E.Z,{focused:!1,title:null!=L&&L.selectedFakeUser?null==L?void 0:L.selectedFakeUser.name:"Select a user",...e})})]})]}),"chat"===_&&(0,B.jsx)(ne.R3,{renderAsFullPage:Boolean(n)}),"skillSwitcher"===_&&(0,B.jsx)(ae.Z,{renderAsFullPage:Boolean(n)})]})}function pe(){window.__c={n:"QnaBadge"};const{device:e}=(0,i.O7)(),{isMobile:t}=e,n=(0,o.yK)((e=>({headerSparkles:{width:t?18:16,height:t?18:16,marginRight:6,color:e.regularIconColor},headerLabel:{fontSize:t?16:14,color:e.regularTextColor,fontWeight:S.Z.fontWeight.medium,display:"flex",alignItems:"center"}})),[t]);return(0,B.jsxs)(B.Fragment,{children:[(0,h.t)(n.headerSparkles),(0,B.jsx)("div",{style:n.headerLabel,children:(0,B.jsx)(f.FormattedMessage,{id:"assistantMenu.header.askNotionAI.label",defaultMessage:"Ask AI"})}),(0,B.jsx)(he,{})]})}const ge=(0,f.defineMessages)({betaLabel:{id:"assistantMenu.header.Beta.label",defaultMessage:"Q&A Beta"},developmentLabel:{id:"assistantMenu.header.Development.label",defaultMessage:"Development"},aiTeamLabel:{id:"assistantMenu.header.AiTeam.label",defaultMessage:"AI Team"}}),me={beta:ge.betaLabel,alpha:ge.betaLabel,canary:ge.betaLabel,development:ge.developmentLabel,ai_team:ge.aiTeamLabel,control:ge.betaLabel};function he(){window.__c={n:"AssistantFeatureGateBadge"};const{isMobile:e}=(0,i.Fy)(),t=(0,f.useIntl)(),n=(0,a.VK)((()=>N.Z.getMode()),[]),s=(0,o.yK)((t=>({buttonContainer:{marginLeft:8},badge:{fontSize:e?14:11,fontWeight:500,padding:"1px 4px",backgroundColor:t.cardHoveredBackground,color:t.lightTextColor,borderRadius:4}})),[e]);return(0,B.jsx)(V.ZP,{popupType:e?V.Z4.SlideUp:V.Z4.Popup,disabled:true,placementToOrigin:V.pO.Bottom,alignmentToOrigin:V.vR.Start,renderOrigin:e=>(0,B.jsx)(L.Z,{...e,disabled:true,ignoreLocalHoverState:!0,style:s.buttonContainer,children:(0,B.jsx)("div",{style:s.badge,children:t.formatMessage(me[n])})}),render:e=>(0,B.jsx)(T.Z,{menuType:j.og.Popup,width:300,children:(0,B.jsx)(F.Z,{type:F.i.Vertical,initialFocus:0,sections:[{key:"assistant_modes",render:e=>(0,B.jsx)(R.Z,{...e,title:"Mode for Dev",shouldShowBottomDivider:!0}),items:r.KM.map((t=>({key:t,render:e=>(0,B.jsx)(M.Z,{...e,title:t,right:t===n?(0,c.e)({width:12,height:"auto"}):void 0}),action:()=>{$.C.updateLocalOverrideConfig("assistant_variant",t),e.close()}})))}]})})})}},16540:(e,t,n)=>{n.d(t,{N:()=>S});var s=n(67294),i=n(86628),a=n(24405),o=n(21202),r=n(82990),l=n(68939),d=n(91839),c=n(31278),u=n(76798),p=n(51757),g=n(61144),m=n(42899),h=n(85893);function S(e){window.__c={n:"AssistantSearchResultsThinkingMessage"};const{clientStep:t,parentStore:n,configurationState:i,citationHoverStore:a,renderAsFullPage:r,isQuickSearchMode:l}=e,{searchResults:d}=t,c=(0,s.useMemo)((()=>d.map((e=>p.G.createChildStore(n,{table:o.iU,id:e})))),[n,d]),u=(0,s.useRef)(null);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(g.J,{clientStep:t,configurationState:i,fakeSlackUser:void 0,forceShowFeedback:!1,ref:u,children:(0,h.jsx)(f,{searchResultStores:c})}),(0,h.jsx)(m.P,{containerRef:u,hoverStore:a,parentStore:n,isQuickSearchMode:l,renderAsFullPage:r})]})}function f(e){window.__c={n:"ThinkingMessageBody"};const{searchResultStores:t}=e,[n,o]=(0,s.useState)(0),p=(0,a.yK)((e=>({messageWrapper:{display:"flex",marginTop:6,marginBottom:6},currentElementStyle:{marginRight:6,display:"flex",height:21}})),[]);(0,s.useEffect)((()=>{const e=setInterval((()=>{o((e=>e+1))}),800);return()=>clearInterval(e)}),[]);const g=(0,i.VK)((()=>t.map(((e,t)=>(0,h.jsx)("div",{style:p.currentElementStyle,children:(0,h.jsx)(l.FormattedMessage,{id:"AssistantChatStep.searchingText",defaultMessage:"Reading {link}",values:{link:(0,h.jsx)("div",{style:r.Z.textOverflowStyle,children:(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,h.jsx)(c.Z,{disabled:!0,isEmptyPage:e.isEmptyPage(),icon:e.getIcon(),size:20,emojiSize:20,disableShrinking:!0,largeIcon:!0,style:{margin:"0px 4px"}}),(0,h.jsx)(u.Z,{store:e})]})})}})},t)))),[t,p.currentElementStyle]),m=n>=t.length?(0,h.jsx)("div",{style:{...p.currentElementStyle},children:(0,h.jsx)(l.FormattedMessage,{id:"AssistantChatStep.summarize",defaultMessage:"Summarizing"})}):g[n];return(0,h.jsxs)("div",{style:{display:"flex"},children:[(0,h.jsx)("div",{style:{minWidth:50},children:m}),(0,h.jsx)("div",{style:{display:"flex",alignItems:"center",marginLeft:2},children:(0,h.jsx)(d.Z,{isTriColored:!0})})]})}},5175:(e,t,n)=>{n.d(t,{Z:()=>r});n(67294);var s=n(86628),i=n(68939),a=n(27967),o=n(85893);function r(e){window.__c={n:"AssistantSkillName"};const{clientSkill:t}=e,n=(0,i.useIntl)(),r=(0,s.VK)((()=>{if("persisted"===t.type){const e=t.skillStore.getName();if(e)return e}return n.formatMessage(a.skillNameMap[t.skillType])}),[t,n]);return(0,o.jsx)(o.Fragment,{children:r})}},80594:(e,t,n)=>{n.d(t,{Z:()=>F});var s=n(67294),i=n(480),a=n(24405),o=n(31945),r=n(86628),l=n(68939),d=n(54642),c=n(47307),u=n(39699),p=n(19471),g=n(89728),m=n(53336),h=n(72495),S=n(34859),f=n(70771),v=n(27967),x=n(5175),y=n(2553),k=n(15201),w=n(68709),b=n(55217),C=n(3553),A=n(43250),j=n(12534),I=n(85893);const M=(0,l.defineMessages)({instructionSectionTitle:{id:"CustomSkillMenu.instructionSection.title",defaultMessage:"Instructions"}});function Z(e){window.__c={n:"CustomSkillMenu"};const{clientSkill:t}=e,{skillStore:n}=t,o=(0,i.O7)(),d=(0,l.useIntl)(),c=(0,a.yK)((e=>({listWrap:{background:e.contentBackground,boxShadow:e.inputBoxShadow,padding:"3px 9px",margin:"0 8px",borderRadius:5,minHeight:64,..."dark"===e.mode?{backgroundColor:e.inputBackground}:{},fontSize:14},emptyPlaceholder:{caretColor:e.mediumTextColor,color:e.lightTextColor,fontSize:14,padding:"5px 0",display:"inline-block"},sectionTitle:{color:e.lightTextColor,fontSize:12}})),[]),p=(0,r.VK)((()=>!n.canEdit()),[n]),g=(0,r.VK)((()=>{if(n.isType("custom"))return n.getInstructionParentStore()}),[n]),m=(0,r.VK)((()=>{if(g)return g.getContentStore()}),[g]),S=(0,s.useCallback)((e=>{(0,j.ZP)({event:e,context:j.Af.EditorClick,callback:()=>{if(!m)return;(m.getValue()||[]).length>0||u.createAndCommit({userAction:"CustomSkillMenu.handleListClick",environment:o,perform:e=>{y.Nj({environment:o,parentStore:m,transaction:e})}})}})}),[o,m]);return(0,I.jsx)(I.Fragment,{children:m&&g&&(0,I.jsx)(h.Z,{title:d.formatMessage(M.instructionSectionTitle),children:(0,I.jsx)(C.Z,{store:g,isDefaultContainer:!0,droppable:!1,render:()=>(0,I.jsx)(w.p,{allowSelectionWithin:!0,children:(0,I.jsx)("div",{style:c.listWrap,onClick:S,className:A.Wh_,children:(0,I.jsx)(k.O,{displayName:"CustomSkillMenuContent",disabled:p,children:(0,I.jsx)(b.Z,{disabled:p,store:m,emptyPlaceholder:(0,I.jsx)("div",{style:c.emptyPlaceholder,children:(0,I.jsx)(l.FormattedMessage,{id:"automations.CustomSkillMenu.emptyPlaceholder",defaultMessage:"Click to edit instructions…"})}),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})})})})},g.id)})})}function T(e){window.__c={n:"EditSkillMenu"};const{clientSkill:t,onClose:n,onDelete:o}=e,{skillStore:y}=t,k=(0,i.O7)(),w=(0,r.VK)((()=>y.getType()),[y]),b=(0,r.VK)((()=>y.isRenameable()),[y]),C=(0,r.VK)((()=>y.getName()),[y]),[A,j]=s.useState(C),M=s.useCallback((e=>{j(e),u.createAndCommit({userAction:"EditSkillMenu.handleNameChange",environment:k,perform:t=>{(0,f.Cc)({store:y,update:{name:e},transaction:t})}})}),[y,k]),T=(0,s.useCallback)((async()=>{if(!(await c.confirmUserAction({message:(0,I.jsx)(l.FormattedMessage,{defaultMessage:"Are you sure you want to delete this skill?",id:"EditSkillMenu.delete.cancelConfirmation"}),acceptLabel:(0,I.jsx)(l.FormattedMessage,{defaultMessage:"Delete",id:"EditSkillMenu.delete.cancelConfirmation.delete"})})))return;const e=y.getSpaceId();e&&await d.setPageAssistantPreferences(k,{type:"skill",spaceId:e,skillId:y.id,operation:{type:"clear_channel"}}),u.createAndCommit({userAction:"EditSkillMenu.handleDelete",environment:k,perform:e=>{(0,f.Nt)({store:y,transaction:e})}}),null==o||o(),n()}),[k,y,n,o]),F=(0,a.yK)((e=>({scroller:{maxHeight:"50vh"},skillIcon:{width:16,fill:e.aiPurpleColor,marginRight:4},fromRowWrap:{display:"flex",alignItems:"center",margin:"4px 8px",gap:4,fontSize:14},rowWrap:{display:"flex",alignItems:"center",margin:"0 8px",gap:8,fontSize:14},headerNameWrap:{flexGrow:1},sectionTitle:{color:e.lightTextColor,fontSize:12}})),[]);return(0,I.jsxs)(m.Z,{type:S.Z.Y,style:F.scroller,children:[(0,I.jsx)(h.Z,{children:(0,I.jsxs)("div",{style:F.rowWrap,children:[v.skillIconMap[t.skillType](F.skillIcon),w&&b?(0,I.jsx)(p.b,{value:A,onChange:M,placeholder:"custom"===w?"Custom skill name":"Skill name"}):(0,I.jsx)("div",{style:F.headerNameWrap,children:(0,I.jsx)(x.Z,{clientSkill:t})}),(0,I.jsx)(g.Z,{onClick:n,isBlue:!0,children:"Done"})]})}),"custom"===w&&(0,I.jsx)(Z,{clientSkill:t}),(0,I.jsx)(h.Z,{children:(0,I.jsx)("div",{style:F.rowWrap,children:(0,I.jsx)(g.Z,{onClick:T,isRed:!0,children:"Delete"})})})]})}function F(e){window.__c={n:"AssistantSkillPopup"};const{clientSkill:t,renderOrigin:n,buttonPopupStore:s,onDelete:r}=e,l=(0,i.O7)(),d=(0,a.yK)((e=>({headerWrap:{display:"flex",alignItems:"center",margin:"0 4px"},editPopupWrap:{borderRadius:12,boxShadow:e.largeLightBoxShadow,width:392}})),[]);return(0,I.jsx)(o.ZP,{popupType:l.device.isMobile?o.Z4.SlideUp:o.Z4.Popup,preventScaleTransition:!0,preventOpacityTransition:!0,popupWrapStyle:d.editPopupWrap,renderOrigin:n,render:e=>t&&(0,I.jsx)(T,{clientSkill:t,onClose:e.close,onDelete:r}),buttonPopupStore:s})}},14309:(e,t,n)=>{n.d(t,{Z:()=>b,s:()=>C});n(67294);var s=n(480),i=n(86628),a=n(24405),o=n(18442),r=n(72126),l=n(68939),d=n(73063),c=n(32163),u=n(53336),p=n(72495),g=n(98165),m=n(34859),h=n(80444),S=n(21273),f=n(70771),v=n(27967),x=n(2405),y=n(5175),k=n(80594),w=n(85893);function b(e){window.__c={n:"AssistantSkillSwitcher"};const{renderAsFullPage:t}=e,n=(0,i.VK)((()=>(0,v.getFilteredClientSkills)({showCustomSkills:S.Z.showCustomSkills(),hasCurrentPage:!t})),[t]);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(u.Z,{type:m.Z.Y,children:(0,w.jsx)(C,{clientSkills:n,renderAsFullPage:t,disableKeyboard:!1})})})}function C(e){window.__c={n:"SkillSwitcherMenuList"};const{clientSkills:t,renderAsFullPage:n,disableKeyboard:o}=e,d=(0,s.O7)(),u=(0,l.useIntl)(),m=(0,a.yK)((e=>({skillIcon:{width:16,fill:e.aiPurpleColor,marginRight:4},skillMenuItemWrap:{display:"flex",alignItems:"center",margin:n?"8px 0px":8},settingsButton:{marginLeft:8},sectionTitle:n?{paddingLeft:0}:{}})),[n]),S=(0,i.VK)((()=>{const{mainEditorCurrentBlockStore:e}=h.default.state;if(!e)return[];return(0,g.uJ)(e).map((e=>e.id))}),[]),f=(0,i.VK)((()=>{const e=t.filter((e=>e.inAppSkillTrigger&&"persisted"!==e.type)),n=t.filter((t=>!e.includes(t)&&"persisted"===t.type&&Boolean(t.inAppSkillTrigger)&&S.includes(t.skillStore.getParentId()))),s=t.filter((t=>Boolean(t.inAppSkillTrigger)&&!e.includes(t)&&!n.includes(t)));return{globalSkills:e,pageSkills:n,workspaceSkills:s}}),[S,t]),x=(n?v.globalChatSections:v.pageChatSections).map((e=>{const t=r.oA(e.skills.map((e=>f.globalSkills.find((t=>t.skillType===e)))));return{key:e.key,render:t=>(0,w.jsx)(p.Z,{topBorder:!1,disableMobileBorders:!0,title:u.formatMessage(e.title),desktopTitleStyle:m.sectionTitle,...t}),items:t.map((e=>A({environment:d,clientSkill:e,styles:m})))}})),y=f.pageSkills.map((e=>A({environment:d,clientSkill:e,styles:m}))),k=f.workspaceSkills.map((e=>A({environment:d,clientSkill:e,styles:m})));return(0,w.jsx)(c.Z,{type:c.i.Vertical,initialFocus:void 0,resetFocusOnMouseOut:!0,disableKeyboard:o,sections:r.oA([...x,y.length>0&&{key:"page",render:e=>(0,w.jsx)(p.Z,{topBorder:!1,disableMobileBorders:!0,title:"From this page",desktopTitleStyle:m.sectionTitle,...e}),items:y},k.length>0&&{key:"workspace",render:e=>(0,w.jsx)(p.Z,{topBorder:!1,disableMobileBorders:!0,title:"Other skills",desktopTitleStyle:m.sectionTitle,...e}),items:k}])})}function A(e){const{environment:t,clientSkill:n,styles:s}=e;return{key:n.key,render:e=>"persisted"===n.type?(0,w.jsx)(k.Z,{clientSkill:n,renderOrigin:t=>(0,w.jsxs)("div",{style:s.skillMenuItemWrap,onMouseEnter:e.onMouseEnter,ref:e.ref,children:[(0,w.jsx)(x.Z,{iconStyle:s.skillIcon,title:(0,w.jsx)(y.Z,{clientSkill:n}),icon:v.skillIconMap[n.skillType],onClick:e.onClick,focused:e.focused}),"persisted"===n.type&&e.focused&&(0,w.jsx)(d.Z,{icon:o.H,ariaLabel:"edit",style:s.settingsButton,...t})]},e.key)}):(0,w.jsx)("div",{style:s.skillMenuItemWrap,onMouseEnter:e.onMouseEnter,ref:e.ref,children:(0,w.jsx)(x.Z,{iconStyle:s.skillIcon,title:(0,w.jsx)(y.Z,{clientSkill:n}),icon:v.skillIconMap[n.skillType],focused:e.focused,onClick:e.onClick})},e.key),action:async()=>{await(0,f.OZ)({environment:t,clientSkill:n})}}}},42899:(e,t,n)=>{n.d(t,{P:()=>R,d:()=>M});var s=n(67294),i=n(480),a=n(86628),o=n(24405),r=n(15145),l=n(37167),d=n(40745),c=n(17693),u=n(21202),p=n(97880),g=n(82990),m=n(68939),h=n(84076),S=n(91839),f=n(53437),v=n(31278),x=n(76798),y=n(98567),k=n(84210),w=n(98180),b=n(51757),C=n(28344),A=n(33932),j=n(61144),I=n(85893);function M(e){window.__c={n:"CitedPagesList"};const{citations:t,hoverStore:n,toggledStore:r,isLoading:l}=e,d=(0,i.O7)(),c=(0,i.Fy)(),u=e.canExpand&&t.length>4,h=e.canExpand?e.expandedStore:void 0,S=(0,a.VK)((()=>r.state),[r]),f=(0,s.useCallback)((e=>{const t=w.Z.getActiveAssistantConfigurationState();t&&C.trackQnaCitationsToggle(d,{sessionId:t.sessionId,shown:e}),r.setState(e),!e&&(0,p.$K)(h)&&h.setState(!1)}),[d,h,r]),v=(0,a.VK)((()=>!(0,p.$K)(h)||h.state),[h]),x=(0,s.useCallback)((e=>{(0,p.$K)(h)&&h.setState(e)}),[h]);(0,a.VK)((()=>{t.forEach((e=>e.store.getTitleValue()))}),[t]);const y=v?t:t.slice(0,4),k=(0,o.yK)((e=>({wrap:{position:"relative",marginLeft:6,marginBottom:6,display:"flex",fontSize:c.isMobile?g.Z.fontSize.UISmall.mobile:g.Z.fontSize.UISmall.desktop},listWrap:{display:"flex",flexDirection:"column",flexGrow:1,gap:2,maxWidth:j.O,marginLeft:-6,paddingLeft:6,...u&&!v?{WebkitMaskImage:"linear-gradient(180deg, black, rgba(0,0,0,0.99) 80%, transparent)"}:{}}})),[u,c,v]);return 0===y.length?null:(0,I.jsxs)("div",{style:k.wrap,children:[(0,I.jsxs)("div",{style:k.listWrap,children:[(0,I.jsx)(Z,{enabled:!l,isLoading:Boolean(l),onClick:()=>{f(!S)},open:S,children:(0,I.jsx)(m.FormattedMessage,{id:"assistantCitationHelpers.numPagesFound",defaultMessage:"{count, plural, one {{count} page found} other {{count} pages found}}",values:{count:t.length}})}),S&&y.map((e=>(0,I.jsx)(F,{citation:e,hoverStore:n},e.store.id)))]}),u&&!v&&S&&(0,I.jsx)(T,{onClick:()=>{const e=w.Z.getActiveAssistantConfigurationState();e&&C.trackQnaCitationsSeeMoreClick(d,{sessionId:e.sessionId}),x(!0)}})]})}function Z(e){window.__c={n:"PageListHeader"};const{enabled:t,onClick:n,children:a,open:r,isLoading:l}=e,{isMobile:d}=(0,i.Fy)(),[u,p]=(0,s.useState)(!1),g=(0,o.yK)((e=>({wrap:{color:e.lightTextColor,fontWeight:500,fontSize:12,padding:"4px 0 2px",display:"flex",alignItems:"center"},content:{padding:"1px 2px",margin:"-1px -2px",cursor:t?"pointer":"default"},icon:{width:11,height:11,marginLeft:4,fill:e.lightIconColor,transform:`rotateZ(${r?0:-90}deg)`,opacity:d||u?1:0,transition:"opacity 0.2s ease, transform 200ms ease-out"},loadingDots:{marginLeft:8}})),[t,r,u,d]);return(0,I.jsxs)("div",{style:g.wrap,children:[(0,I.jsx)("div",{style:g.content,onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),onClick:()=>{t&&n()},children:a}),t&&(0,c.A)(g.icon),l&&(0,I.jsx)(S.Z,{isTriColored:!0,styleParentContainer:g.loadingDots})]})}function T(e){window.__c={n:"ExpandOverlay"};const{onClick:t}=e,n=(0,i.Fy)(),[r,l]=(0,s.useState)(!1),c=(0,a.VK)((()=>r||n.isMobile),[n,r]),u=(0,o.yK)((e=>({wrap:{position:"absolute",left:0,right:0,bottom:0,cursor:"pointer",height:24,display:"flex",justifyContent:"center",alignItems:"flex-end",fontSize:n.isMobile?g.Z.fontSize.UISmall.mobile:g.Z.fontSize.UISmall.desktop,opacity:c?1:0,transition:"opacity 0.2s ease"},label:{display:"flex",gap:2,alignItems:"center",color:e.mediumTextColor,fontWeight:500,fontSize:11,borderRadius:6,padding:"2px 6px",boxShadow:"0px 0px 1px 0px rgba(0, 0, 0, 0.04), 0px 0px 2px 0px rgba(0, 0, 0, 0.06), 0px 4px 8px 0px rgba(0, 0, 0, 0.04)",background:e.whiteButtonBackground},icon:{width:12,height:12,fill:e.mediumIconColor}})),[n,c]);return(0,I.jsx)("div",{style:u.wrap,onClick:t,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:(0,I.jsxs)("div",{style:u.label,children:[(0,I.jsx)("div",{children:(0,I.jsx)(m.FormattedMessage,{id:"assistantCitationHelpers.seeMore",defaultMessage:"See more"})}),(0,d.M)(u.icon)]})})}function F(e){window.__c={n:"CitedPageRow"};const{citation:{number:t,store:n},hoverStore:d}=e,c=(0,i.O7)(),u=(0,a.VK)((()=>{var e;return(null===(e=d.state)||void 0===e?void 0:e.pageId)===n.id}),[d,n]),g=(0,s.useRef)(null),m=(0,o.yK)((e=>({wrap:{display:"flex",position:"relative"},linkBox:{display:"flex",alignItems:"center",gap:4,padding:"0 4px",borderRadius:6,fontWeight:500,fontSize:13,transition:"background 0.2s ease",maxWidth:"95%",marginLeft:-4},linkBoxHoveredStyle:{background:e.accentColors.uiBlue[100]},iconWrap:{position:"relative",marginRight:4,width:14,height:14,flexShrink:0},icon:{position:"absolute",left:0,top:0,transition:"opacity 0.2s ease",opacity:(0,p.$K)(t)&&u?0:1},number:{position:"absolute",left:0,top:0,opacity:u?1:0,transition:"opacity 0.2s ease",zIndex:10},titleWrap:{display:"flex",alignItems:"center",padding:2,minWidth:50}})),[u,t]),S=(0,s.useCallback)((e=>{if(e){if(!g.current)return;d.setState({type:"list",pageId:n.id,node:g.current})}else d.setState(void 0)}),[d,n]),f=(0,a.VK)((()=>n.getIcon()),[n]),y=(0,a.VK)((()=>n.isEmptyPage()),[n]),b=(0,a.VK)((()=>c.RouterStore.state.route),[c]),{metaHref:j,href:M}=(0,a.VK)((()=>{const e=(0,k.ZP)({store:n,fullyQualified:!1,pageVisitSource:r.tY.AIQna});return"page"===b.name||"nativeTab"===b.name&&"assistant"===b.tab||"quickSearch"===b.name?{metaHref:e,href:e}:"chat"===b.name?{metaHref:e,href:(0,l.t)({blockId:n.id,pageVisitSource:r.tY.AIQna})}:{metaHref:void 0,href:void 0}}),[b,n]);return(0,I.jsx)("div",{style:m.wrap,ref:g,children:(0,I.jsx)(h.Z,{href:j,metaHref:M,style:m.linkBox,hovered:u,hoveredStyle:m.linkBoxHoveredStyle,onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),onClick:()=>{c.device.isMobileBrowser&&A.closeAssistantRightHandSideMenu(),C.trackQnaResultClicked(c,{clickedPageId:n.id,configurationState:w.Z.getActiveAssistantConfigurationState(),source:"citation_list"})},children:(0,I.jsxs)("div",{style:m.titleWrap,children:[(0,I.jsxs)("div",{style:m.iconWrap,children:[(0,p.$K)(t)&&(0,I.jsx)(P,{number:t,hovered:u,style:m.number}),(0,I.jsx)(v.Z,{disabled:!0,icon:f,isEmptyPage:y,size:14,style:m.icon,useInvertedColors:!1})]}),(0,I.jsx)(x.Z,{store:n})]})})})}function R(e){window.__c={n:"CitationPreviewPopup"};const{containerRef:t,hoverStore:n,parentStore:s,isQuickSearchMode:o}=e,r=(0,i.Fy)(),l=(0,a.VK)((()=>{if(!n.state||!t.current||r.isMobile||o)return;const e=t.current.getBoundingClientRect(),i=e.left>=y.Tq+24;let a;const l=n.state.node.getBoundingClientRect();if(i)a=new DOMRect(e.x,l.y,e.width,l.height);else{if("token"!==n.state.type)return;a=l}return{store:b.G.createChildStore(s,{id:n.state.pageId,table:u.iU}),originRect:a,isFullTooltip:i}}),[t,s,r,o,n]);if((0,p.$K)(l)){const{originRect:e,isFullTooltip:t,store:n}=l;return(0,I.jsx)(f.ZP,{disableMouseCapture:!0,preventCaptureEsc:!0,preventScaleTransition:!0,preventOpacityTransition:!0,popupType:f.ZP.PopupType.Popup,originGap:t?24:8,alignmentToOrigin:f.ZP.Alignment.Start,open:!0,placementToOrigin:t?f.ZP.Placement.Left:f.ZP.Placement.Bottom,originRect:e,useLightBoxShadow:!t,render:()=>t?(0,I.jsx)(y.E5,{store:n}):(0,I.jsx)(B,{store:n})})}return null}function B(e){window.__c={n:"MinimalCitationTooltip"};const{store:t}=e,n=(0,o.yK)((e=>({wrap:{fontSize:g.Z.fontSize.UISmall.desktop,color:e.mediumTextColor,fontWeight:g.Z.fontWeight.regular,fill:e.mediumIconColor,padding:"4px 6px 4px 6px",display:"flex",alignItems:"center",gap:2}})),[]),s=(0,a.VK)((()=>t.getIcon()),[t]),i=(0,a.VK)((()=>t.isEmptyPage()),[t]);return(0,I.jsxs)("div",{style:n.wrap,children:[(0,I.jsx)(v.Z,{disabled:!0,icon:s,isEmptyPage:i,size:14,useInvertedColors:!1}),(0,I.jsx)(x.Z,{store:t})]})}function P(e){window.__c={n:"CitationNumber"};const{number:t,hovered:n,style:s}=e,i=(0,o.yK)((e=>({wrap:{verticalAlign:"middle",cursor:"pointer",transition:"all 100ms ease-in",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:90,padding:"0 4px",fontSize:10,minWidth:14,height:14,fontWeight:g.Z.fontWeight.semibold,color:"dark"===e.mode?"#2f2f2f":"white",backgroundColor:n?"#2383e2":"dark"===e.mode?"#787774":"#acaba9",...s}})),[n,s]),a=(0,m.useIntl)();return(0,I.jsx)("div",{style:i.wrap,children:t.toLocaleString(a.locale)})}},67973:(e,t,n)=>{n.d(t,{d:()=>i});var s=n(49085);class i extends s.default{getInitialState(){}}},19471:(e,t,n)=>{n.d(t,{Y:()=>m,b:()=>g});var s=n(67294),i=n(480),a=n(86628),o=n(9953),r=n(98104),l=n(39699),d=n(1743),c=n(74194),u=n(53971),p=n(85893);function g(e){window.__c={n:"AutomationPlainTextInput"};const{value:t,onChange:n,wrapStyle:i,...a}=e,[o,l]=(0,s.useState)(!1);return(0,p.jsx)(d.Z,{capture:o,children:(0,p.jsx)(u.Z,{capture:!0,render:e=>(0,p.jsx)("div",{...e,style:i,children:(0,p.jsx)(c.Z,{value:t,onChange:e=>n(e.currentTarget.value),onBlur:()=>{l(!1)},onFocus:()=>{r.o9(),l(!0)},...a})})})})}function m(e){window.__c={n:"ConnectedAutomationPlainTextInput"};const{store:t,...n}=e,r=(0,i.O7)(),d=(0,a.VK)((()=>t.getValue()??""),[t]),c=(0,s.useCallback)((e=>{l.createAndCommit({userAction:"AutomationPlainTextInput.setValue",environment:r,perform:n=>{o.sO({store:t,transaction:n,value:e})}})}),[r,t]);return(0,p.jsx)(g,{value:d,onChange:c,...n})}},37712:(e,t,n)=>{n.d(t,{A:()=>o});n(67294);var s=n(86628),i=n(24405),a=n(85893);function o(e){let{scrollerStore:t}=e;window.__c={n:"SidebarScrollToTopBorder"};const n=(0,s.VK)((()=>0===t.state.scrollTop),[t]),o=(0,i.yK)((e=>({border:{width:"100%",boxShadow:n?"0 0 0 transparent":`0 1px 0 ${e.regularDividerColor}`,transition:"box-shadow 300ms",height:2,marginTop:-2,zIndex:99}})),[n]);return(0,a.jsx)("div",{style:o.border})}},99622:(e,t,n)=>{n.d(t,{Y:()=>o});var s=n(86628),i=n(78291),a=n(88893);function o(){return(0,s.VK)((()=>a.Q6(i.default.state.data)),[])}}}]);