"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7304],{84437:(e,t,n)=>{n.d(t,{f:()=>f,s:()=>d});var r=n(72126),o=n(4615),i=n(64002),a=n(54642),c=n(47839),s=n(75018),l=n(95477),u=n(71574);function d(e){if(!(0,u.tE)())return void async function(e){const{environment:t,spaceStore:n,collectionViewStore:r}=e,a=p({spaceStore:n,collectionViewStore:r}),c=(0,o.ZP)(),d=i.bf({url:l.default.cron.notionAuthUrl,query:{...a,csrf:c}});await(0,u.PQ)({environment:t,csrf:c}),s.navigateToExternalURL({environment:t,url:d})}(e);const{environment:t,spaceStore:n,collectionViewStore:r}=e,a=r?l.default.cron.openNotionDatabaseUrl:l.default.cron.domainBaseUrl,d=p({collectionViewStore:r,spaceStore:n});!async function(e){const{environment:t,url:n,targetSelf:r}=e;if(!t.device.isElectron)return s.navigateToExternalURL({environment:t,url:n,targetSelf:r});const{desktopProtocol:o}=l.default.cron;if(!(await c.isProtocolRegistered(o)))return s.navigateToExternalURL({environment:t,url:n,targetSelf:r});const i=n.replace(/^https?:/,`${o}:`);c.openExternalUrl(i)}({environment:t,url:i.bf({url:a,query:d})})}async function f(e){const{environment:t,csrf:n,calendarCsrf:o,spaceId:i,integration:c,redirectUri:s,state:l}=e;if(!(await(0,u.Bs)({environment:t,csrf:n})))return void v({environment:t,redirectUri:s,query:r.GM({state:l},r.o8)});const d=await a.createOauthAuthorizationCode(t,{integrationId:c.id,spaceId:i,redirectUri:s,acceptedIntegrationCapabilities:c.capabilities});if("failed"===d.type)return void v({environment:t,redirectUri:s,query:r.GM({state:l},r.o8)});const f={code:d.data.code,calendarCsrf:o,state:l};v({environment:t,redirectUri:s,query:r.GM(f,r.o8)})}function v(e){const{environment:t,redirectUri:n,query:r}=e,o=i.bf({url:n,query:r});s.navigateToExternalURL({environment:t,url:o,targetSelf:!0})}function p(e){const{spaceStore:t,collectionViewStore:n}=e,o={env:"production",collection_view_id:null==n?void 0:n.id,workspace_id:null==t?void 0:t.id};return r.GM(o,r.o8)}},67943:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var r=n(67294),o=n(480),i=n(86628),a=n(77657),c=n(9844),s=n(80444),l=n(51757),u=n(84437);function d(e){window.__c={n:"NotionCalendarAuthorization"};const{csrf:t,calendarCsrf:n,redirectUri:d,spaceId:f,state:v}=e,p=(0,o.O7)(),m=function(){const e=(0,i.VK)((()=>s.default.state.currentUserRootStore),[]);return(0,i.VK)((()=>{if(!e)return;const t=(0,l.Kv)(e,{id:a.Dv,table:c.K2}).getKeyStore("capabilities").getValue();return t?{id:a.Dv,capabilities:t}:void 0}),[e])}(),g=(0,r.useRef)(!1);return(0,r.useEffect)((()=>{g.current||m&&f&&(g.current=!0,(0,u.f)({environment:p,csrf:t,calendarCsrf:n,redirectUri:d,spaceId:f,integration:m,state:v}))}),[m,p,t,n,d,f,v]),null}},71574:(e,t,n)=>{n.d(t,{Bs:()=>p,PQ:()=>v,ZH:()=>u,tE:()=>d});var r=n(77657),o=n(4615),i=n(95477),a=n(12955),c=n(53410),s=n(77080),l=n(30874);async function u(e){const{environment:t}=e;return!!s.default.checkGate("notion_calendar")&&(!t.device.isMobile&&(!t.device.isElectron||async function(){if(!d())return!1;if(null===c.C||void 0===c.C||!c.C.isProtocolRegistered)return!1;return await c.C.isProtocolRegistered(i.default.cron.desktopProtocol)}()))}function d(){const{bots:e,externalAuthentications:t}=l.Z,n=e.state.find((e=>e.integration_id===r.Dv));if(!n)return!1;const o=t.state.find((e=>e.parent_id===n.id));return Boolean(o)}const f="notion_calendar_csrf";async function v(e){const{environment:t,csrf:n}=e;await(0,a.setCookie)(t,{name:f,value:n})}async function p(e){const{environment:t,csrf:n}=e,r=await(0,a.getCookie)(t,f),i=!!r&&(0,o.t)(r)&&r===n;return(0,a.removeCookie)(f),i}}}]);