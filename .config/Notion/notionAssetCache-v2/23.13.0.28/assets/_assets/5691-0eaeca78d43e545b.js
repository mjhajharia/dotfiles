"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5691],{22508:(e,t,i)=>{i.d(t,{Co:()=>j,E6:()=>w,GZ:()=>x,TW:()=>O,Uw:()=>C,YQ:()=>T,rw:()=>b});i(57658),i(67294);var n=i(33728),r=i(7406),s=i(68626),o=i(91155),a=i(72141),l=i(4615),c=i(68939),u=i(50906),d=i(54642),v=i(76464),g=i(95209),m=i(64964),p=i(19306),f=i(26907),I=i(67669),S=i(95697),h=i(88893),_=i(35057),y=i(73466),k=i(85893);async function w(e){const{environment:t,onInviteComplete:i,flowId:n,intl:a,spaceStore:l,invitedUsers:c,inviteTargetsStore:d,inviteOrigin:v,disable_invite_email:g}=e;let m={success:!1};try{m=await T({environment:t,spaceStore:l,invitedUsers:c,from:v,flowId:n,intl:a,inviteTargetsStore:d,disable_invite_email:g})}catch(p){const e=(0,r.tg)(p);u.S4I(t,{invite_stage:"invite_member",invite_flow_id:n,error:e}),s.log({level:"error",from:"personPropertyInviteAction",type:"handleMemberInvite",error:(0,o.Ui)(p)})}finally{m.success&&u.pRQ(t,{invited_user_count:Object.keys(m.invitedUsers).length,invite_flow_id:n,origin:v}),null==i||i(m)}}async function x(e){const{environment:t,blockStore:i,inviteTargetsStore:c,sudoModeStore:d,onInviteComplete:g,inviteOrigin:m,role:p,emailMessage:S,flowId:h}=e;let _={success:!1};try{if(_=await async function(e){const{environment:t,blockStore:i,sudoModeStore:r,inviteTargetsStore:s,role:o,inviteOrigin:c,emailMessage:u,onInviteStart:d}=e,g=e.flowId||(0,l.ZP)();if(!(0,a.iC)(o))return{success:!1};const{tokenQuery:m,inviteTargets:p}=s.state;if((0,n.oH)(m.trim())&&0===p.length){const e={type:"newUser",value:{email:m.trim()},source:"email"};f.H({target:e,inviteTargetsStore:s})||s.setState({inviteTargets:[...s.state.inviteTargets,e],tokenQuery:""})}const S=I.mU(i,f.B({inviteTargetsStore:s}));null==d||d();return await v.n_({environment:t,store:i,sudoModeStore:r,inviteTargets:S,inviteRole:o,isOnboarding:!1,invite:{inviteFlowId:g,inviteMessage:u,inviteOrigin:c}})}({environment:t,blockStore:i,sudoModeStore:d,inviteTargetsStore:c,role:p,emailMessage:S,inviteOrigin:m,flowId:h}),!_.success)return}catch(y){const e=(0,r.tg)(y);u.S4I(t,{invite_stage:"invite_guest",invite_flow_id:h,error:e}),s.log({level:"error",from:"personPropertyInviteAction",type:"handleGuestInvite",error:(0,o.Ui)(y)})}finally{_.success&&u.ViF(t,{invited_user_count:Object.keys(_.invitedUsers).length,origin:m,invite_flow_id:h}),null==g||g(_)}return _}async function b(e){const{environment:t,spaceStore:i,originId:n,originType:o,reasonMessage:a,intl:l,flowId:c,onInviteComplete:v,invitedUsers:g,inviteOrigin:m}=e,p=[];let f={success:!1};try{const e=Object.entries(g).map((e=>{let[r,s]=e;return d.requestAccess(t,{type:"actor-to-space",forActorId:s,spaceId:i.id,message:a,attributes:{origin_id:n,origin_type:o,origin_table:"block",add_permissions_on_approval:!1}}).catch((()=>p.push([r,s])))}));await Promise.all(e),f={success:!0,invitedUsers:g,requestedUsers:{}}}catch(I){const e=(0,r.tg)(I);return u.S4I(t,{invite_stage:"request_member",invite_flow_id:c,error:e}),M(l,g),s.log({level:"error",from:"personPropertyInviteAction",type:"handleMemberRequest",data:{miscDataToConvertToString:{inviteTargetEmailsWithErrors:p}}}),f}finally{f.success&&u.TJ1(t,{invited_user_count:Object.keys(f.invitedUsers).length,origin:m,invite_flow_id:c}),null==v||v(f)}return f}async function T(e){const{environment:t,spaceStore:i,from:n,invitedUsers:r,intl:o,flowId:a,onInviteStart:l,inviteTargetsStore:c,disable_invite_email:u}=e,d=function(e){const t=[];if(!e)return t;for(const[i,n]of Object.entries(e))t.push({type:"existingUser",value:{id:n,email:i,version:1}});return t}(r),g=function(e){return e.state.inviteTargets.filter((e=>"newUser"===e.type))}(c),f=[...d];for(const s of g){d.some((e=>e.value.email===s.value.email))||f.push(s)}const I=(0,_.zt)(),k=I&&(0,h.o9)(I)?"editor":e.inviteRole??"read_and_write";let w={success:!1};if((0,S.$)(t)){if(!(await y.HD({environment:t,flowId:a,trackCreateTeamComplete:!1})))return w}try{null==l||l(),w=await v.n_({environment:t,store:i,inviteTargets:f,inviteRole:k,isOnboarding:!1,invite:{inviteOrigin:n,inviteFlowId:a,disable_invite_email:u}})}catch(x){return((e,t)=>{0!==t.length&&m.oV({label:e.formatMessage({id:"contextual_invite.contextual_invite_failure",defaultMessage:"Failed to invite to {users} as members"},{users:(0,p.W)(t.flatMap((e=>e.value.email||[])))})})})(o,f),s.log({level:"error",from:"contextualInviteHelpers",type:"inviteMembers.inviteTargets",data:{miscDataToConvertToString:{usersToInviteAsMembers:f}}}),w}return w}async function C(e){const{environment:t,inviteTargetsStore:i,allowShowEmptyError:r,personPropertyInviteStore:s}=e,o=i.state.tokenQuery;if(""===o)return void(0===i.state.inviteTargets.length&&r&&s.setState({...s.state,showEmptyError:!0}));const a=(0,n.CU)(o),l=await g.M5(t,a);let c=[];0===l.length&&(c=[{type:"invalidUser",value:{text:o}}]);const u=l.filter((e=>!f.H({inviteTargetsStore:i,target:e}))),d=[...i.state.inviteTargets,...u,...c];i.setState({...i.state,inviteTargets:d,tokenQuery:""})}function j(e){const{email:t,inviteTargetsStore:i}=e,n={type:"newUser",value:{email:t},source:"email"},r=[...i.state.inviteTargets];f.H({inviteTargetsStore:i,target:n})||r.push(n),i.setState({...i.state,inviteTargets:r})}const M=(e,t)=>{const i=Object.keys(t);0!==i.length&&m.oV({label:e.formatMessage({id:"contextual_invite.request_members_failure",defaultMessage:"Failed to request {users} to become members"},{users:(0,p.W)(i)})})};function O(e){const{success:t,invitedUserEmails:i,isRequestMember:n}=e;t?0!==i.length&&(n?m.oV({label:(0,k.jsx)(c.FormattedMessage,{id:"shareMenu.inviteSuccess.snackbarMessage.sendMemberRequest",defaultMessage:"Successfully sent request to admin to invite {users}",values:{users:(0,p.W)(i)}})}):m.oV({label:(0,k.jsx)(c.FormattedMessage,{id:"shareMenu.inviteSuccess.snackbarMessage",defaultMessage:"Successfully invited {users}",values:{users:(0,p.W)(i)}})})):m.oV({label:(0,k.jsx)(c.FormattedMessage,{id:"shareMenu.inviteFailure.snackbarMessage",defaultMessage:"Failed to invite {users}",values:{users:(0,p.W)(i)}})})}},35691:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ce,shouldEnableSlackImportsInvite:()=>ue});var n=i(67294),r=i(480),s=i(86628),o=i(24405),a=i(41892),l=i(72126),c=i(68939),u=i(50906),d=i(51077),v=i(9019),g=i(56678),m=i(77080),p=i(55899),f=i(35057),I=i(49085),S=i(4615);let h=function(e){return e.SearchInput="search_input",e.NoFocus="no_focus",e}({});class _ extends I.default{getInitialState(){return{flowId:(0,S.ZP)(),modalOpen:!1,focus:h.NoFocus}}}const y=_;var k=i(7406),w=i(77657),x=i(68626),b=i(91155),T=i(54642),C=i(78140),j=i(43250),M=i(87279),O=i(80444),Z=i(30874),U=i(29798),F=i(42922),K=i(22508);var L=i(85893);function V(e){window.__c={n:"SlackImportsInviteButton"};const{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:a,onInviteComplete:l,onInviteClick:d}=e,v=(0,r.O7)(),g=(0,c.useIntl)(),m=(0,o.yK)((e=>({footerStyle:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:60,padding:"12px 16px 16px 16px",borderTop:`1px solid ${e.stroke.deemphasized}`}})),[]),p=(0,s.VK)((()=>O.default.state.currentSpaceStore),[]),f=(0,s.VK)((()=>t.state.flowId),[t]),I=(0,s.VK)((()=>i.state.inviteTargets.length),[i]),S=(0,s.VK)((()=>function(e){return 0===e?(0,L.jsx)(c.FormattedMessage,{id:"invite.slack_imports.button.title.no_selected",defaultMessage:"Add members",values:{totalInviteCount:e}}):(0,L.jsx)(c.FormattedMessage,{id:"invite.slack_imports.button.title.selected",defaultMessage:"Add {totalInviteCount} {totalInviteCount, plural, one {member} other {members}}",values:{totalInviteCount:e}})}(I)),[I]),_=(0,n.useCallback)((e=>{const{response:i,invitedUserEmails:n}=e;u.u00(v,{invite_stage:"invite_complete",invite_flow_id:f,origin:a,is_success:i.success,invited_user_count:n.length}),i.success&&t.setState({...t.state,modalOpen:!1}),null==l||l(i),K.TW({success:i.success,invitedUserEmails:n})}),[a,v,f,l,t]),y=(0,n.useCallback)((async()=>{const e=i.state.inviteTargets.filter((e=>"newUser"===e.type||"existingUser"===e.type)).map((e=>e.value.email));if(!p)return null;await async function(e){const{environment:t,onInviteComplete:i,onInviteClick:n,flowId:r,intl:s,spaceStore:o,inviteTargetsStore:a,inviteOrigin:l}=e;let c={success:!1};const d=a.state.inviteTargets.length;try{c=await K.YQ({environment:t,spaceStore:o,from:l,flowId:r,intl:s,inviteTargetsStore:a,onInviteStart:()=>{null==n||n()}})}catch(v){const e=(0,k.tg)(v);u.u00(t,{invite_stage:"invite_member",invited_user_count:d,invite_flow_id:r,error:e,origin:l,is_success:!1}),x.log({level:"error",from:"slackImportsInviteActions",type:"handleMemberInvite",error:(0,b.Ui)(v)})}finally{null==i||i(c)}}({environment:v,spaceStore:p,flowId:f,intl:g,inviteTargetsStore:i,inviteOrigin:a,onInviteComplete:t=>_({response:t,invitedUserEmails:e}),onInviteClick:d}),i.reset()}),[p,v,f,i,g,a,d,_]),w=(0,n.useCallback)((async()=>{t.setState({...t.state,focus:h.NoFocus});const e=i.state.inviteTargets.length;u.AK8(v,{invited_user_count:e,origin:a,inviteTargets:i.state.inviteTargets.map((e=>e.type.toString())),inviteTokenQuery:i.state.tokenQuery,invite_flow_id:f}),await y()}),[y,v,f,a,t,i]);return(0,L.jsx)("div",{style:m.footerStyle,children:(0,L.jsx)(F.Z,{isLarge:!0,style:{borderRadius:6},onClick:w,disabled:0===I,children:S})})}var A=i(82990),B=i(68785),R=i(64369);function z(e){window.__c={n:"SlackImportsInviteHeader"};const{isLoading:t}=e,i=(0,o.yK)((e=>({topContainer:{display:"flex",alignItems:"center",width:"100%",height:40,padding:"0 16px",borderBottom:`1px solid ${e.stroke.deemphasized}`},sendInviteLabel:{color:e.text.primary,fontSize:14,fontWeight:A.Z.fontWeight.medium,textAlign:"left",verticalAlign:"top"}})),[]),n=t?(0,L.jsx)(B.Z,{style:{marginLeft:6}}):null;return(0,L.jsxs)("div",{style:i.topContainer,children:[(0,L.jsx)(R.Z,{style:i.sendInviteLabel,children:(0,L.jsx)(c.FormattedMessage,{id:"invite.slack_imports.header_title",defaultMessage:"Import from Slack"})}),n]})}var Q=i(47082);function P(e){window.__c={n:"SlackImportsInviteInput"};const{inviteTargetsStore:t,slackImportsInviteStore:i,inviteOrigin:a}=e,l=(0,c.useIntl)(),u=(0,r.O7)(),{tokenQuery:d}=(0,s.VK)((()=>{const{tokenQuery:e}=t.state;return{tokenQuery:e}}),[t]),{focus:v,flowId:g}=(0,s.VK)((()=>({focus:i.state.focus===h.SearchInput,flowId:i.state.flowId})),[i]),m=function(e){const{focus:t}=e;return(0,o.yK)((e=>({searchBar:{padding:16},inputStyle:{minWidth:60,width:"auto",borderTopLeftRadius:4,borderTopRightRadius:4,fontSize:14,fontWeight:A.Z.fontWeight.regular},tokenInputMenuItem:{padding:6,borderRadius:6,height:20,alignItems:"center",minHeight:32,background:e.accentColors.gray[30],...t&&{background:"none"}}})),[t])}({focus:v}),p=l.formatMessage({id:"invite.slack_imports.search.placeholder",defaultMessage:"Search people, emails..."}),I=(0,n.useCallback)((e=>{t.setState({...t.state,tokenQuery:e.target.value}),q({environment:u,flowId:g,subscriptionTier:(0,f.zt)(),origin:a})}),[t,g,a,u]);return(0,L.jsx)("div",{style:m.searchBar,children:(0,L.jsx)(Q.Z,{focus:v,onClick:()=>{i.setState({...i.state,focus:h.SearchInput})},format:Q.Z.Format.Share,value:d,onChange:I,type:"email",tokens:[],autoComplete:"off",placeholder:p,onRemoveLastToken:()=>{},showBorder:!0,style:m.tokenInputMenuItem,inputFullWidth:!0})})}const q=l.Ds((e=>{let{environment:t,flowId:i,subscriptionTier:n,origin:r}=e;u.UWw(t,{invite_flow_id:i,subscription_tier:n,invite_origin:r})}),1e3);i(57658);var E=i(8848),W=i(59054),H=i(36591),D=i(95209),$=i(21752),N=i(52275),G=i(61519),J=i(32163),Y=i(43765),X=i(72495),ee=i(69507),te=i(26907);function ie(e){window.__c={n:"SlackImportsInviteSearchRequest"};const{inviteTargetsStore:t,slackImportsInviteStore:i}=e,n=(0,r.O7)(),o=(0,c.useIntl)(),a=(0,s.VK)((()=>t.state.tokenQuery),[t]),l=(0,s.VK)((()=>i.state.flowId),[i]),[{value:u,status:d}]=(0,W.r5)((async()=>D.jL({query:a,sectionLimit:{userLimit:0,botLimit:0,groupLimit:0,importContactLimit:1e3},environment:n,intl:o,membersOnly:!1})),[n,o,a],{debounce:40});return(0,L.jsx)(ne,{...e,tokenQuery:a,ready:"pending"!==d,error:"rejected"===d,result:u,flowId:l,environment:n})}function ne(e){window.__c={n:"SlackImportsInviteSearchRequestImpl"};const{inviteTargetsStore:t,slackImportsInviteStore:i,tokenQuery:n,error:r,ready:a,result:l,inviteOrigin:d,flowId:v,environment:g}=e,m=(0,o.yK)((e=>({selectAllSectionStyle:{display:"flex",flexDirection:"column",gap:2,padding:"8px 0px 16px 0px"},sectionMenuItem:{padding:"12px 0px 0px 2px",display:"flex",flexDirection:"column",gap:2},dividerStyle:{margin:"0px 16px"},dividerInnerStyle:{borderBottom:`1px solid ${e.stroke.deemphasized}`},selectAllStyle:{display:"flex",fontSize:14,color:e.text.primary},totalCountsStyle:{paddingLeft:3,fontSize:14,color:e.text.tertiary}})),[]),p=(0,s.VK)((()=>(null==l?void 0:l.importedContacts)??[]),[l]),I=(0,s.qz)(e.menuListStore,U.Z),S={key:"select all",render:e=>(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(X.Z,{...e,style:m.selectAllSectionStyle}),(0,L.jsx)(G.Z,{size:1,innerStyle:m.dividerInnerStyle,style:m.dividerStyle})]}),items:[{key:"select all item",render:e=>(0,L.jsx)(N.Z,{...e,title:(0,L.jsxs)("div",{style:m.selectAllStyle,children:[(0,L.jsx)(c.FormattedMessage,{id:"invite.slack_imports.select_all.title",defaultMessage:"Select all"}),(0,L.jsx)(R.Z,{style:m.totalCountsStyle,isSmall:!0,children:`(${p.length})`})]}),right:(0,L.jsx)(oe,{checked:ae({filteredImportedContacts:p,inviteTargetsStore:t})})}),action:()=>{!function(e){const{filteredImportedContacts:t,inviteTargetsStore:i,environment:n,origin:r,flowId:s,tokenQuery:o}=e;if(i.state.inviteTargets.length===t.length)return i.setState({...i.state,inviteTargets:[]}),void u.hcu(n,{origin:r,invite_flow_id:s,invited_user_count:0,is_unselect:!0,invite_token_query:o});u.hcu(n,{origin:r,invite_flow_id:s,invited_user_count:t.length,is_unselect:!1,invite_token_query:o}),i.setState({...i.state,inviteTargets:t})}({filteredImportedContacts:p,inviteTargetsStore:t,origin:d,flowId:v,environment:g,tokenQuery:n}),i.setState({...i.state,focus:h.NoFocus})}}]},_=function(e){const{filteredImportedContacts:t}=e,i={};return t.forEach(((e,t)=>{const n=e.value.email[0].toUpperCase(),r=/^[A-Za-z]$/.test(n)?n:"#";i[r]||(i[r]=[]),i[r].push(e)})),i}({filteredImportedContacts:p}),y=Object.keys(_).sort(((e,t)=>"#"===e?1:"#"===t?-1:e.localeCompare(t))).map((e=>function(e){const{charKey:t,importedContacts:i,inviteTargetsStore:n,slackImportsInviteStore:r,menuListStore:s,style:o,tokenQuery:a,environment:l}=e;return{key:`imported contacts with ${t}`,render:e=>(0,L.jsx)(X.Z,{...e,style:o,title:(0,L.jsx)(c.FormattedMessage,{id:"invite.slack_imports.grouped_section.title",defaultMessage:"{charKey}",values:{charKey:t}})}),items:i.sort(((e,t)=>(e.value.name||"").localeCompare(t.value.name||""))).map(((e,t)=>({key:e.value.email,render:t=>(0,L.jsx)(re,{...t,invited:!1,inviteTarget:e,isInInviteTargets:te.H({target:e,inviteTargetsStore:n})}),action:()=>{te.H({target:e,inviteTargetsStore:n})?n.setState({...n.state,inviteTargets:n.state.inviteTargets.filter((t=>"newUser"!==t.type||e.value.email!==t.value.email))}):(u.hEo(l,{invite_token_query:a,selected_user_token:e,selected_user_token_rank:t,from:"slack_imports_space_setting",subscription_tier:(0,f.zt)(),type:"slack"}),r.setState({...r.state,focus:h.NoFocus}),n.setState({...n.state,inviteTargets:[...n.state.inviteTargets,e]}),s.unsetFocus())}})))}}({charKey:e,importedContacts:_[e],inviteTargetsStore:t,slackImportsInviteStore:i,menuListStore:I,style:m.sectionMenuItem,tokenQuery:n,environment:g})));return r?(0,L.jsx)(ee.l,{loading:!a,children:(0,L.jsx)(Y.Z,{title:(0,L.jsx)(c.FormattedMessage,{id:"inviteUserModal.searchInput.errorMessage",defaultMessage:"Something went wrong"})})}):(0,L.jsx)(J.Z,{type:J.i.Vertical,initialFocus:n.length>0?0:void 0,sections:[S,...y],store:I})}const re=n.forwardRef(((e,t)=>{const{inviteTarget:i}=e;return(0,L.jsx)(se,{...e,ref:t,inviteTarget:i})})),se=n.forwardRef(((e,t)=>{window.__c={n:"SlackSearchUserResultItem"};const{inviteTarget:i,isInInviteTargets:r,...s}=e,l=(0,o.yK)((()=>({cellMemberAvatarContainer:{paddingTop:8,paddingBottom:8},iconBox:{position:"absolute",bottom:-3,right:-3},iconBoxImage:{background:"white",padding:2,borderRadius:"100%"}})),[]),c=(0,n.useMemo)((()=>({actorStore:void 0,avatar:{email:i.value.email,name:"slack"===i.source?i.value.name:void 0,avatarUrl:"slack"===i.source?i.value.avatar_url:void 0}})),[i]);return(0,L.jsx)(N.Z,{...s,ref:t,title:(0,L.jsx)($.Z,{isLarge:!0,...c,containerStyle:l.cellMemberAvatarContainer,avatarBadge:(0,L.jsx)(d.Z,{type:"image_url",imageURL:a.Z.images.externalIntegrations.slackIconPng,size:18,style:l.iconBox,imageStyle:l.iconBoxImage})}),right:(0,L.jsx)(oe,{checked:r})})}));function oe(e){window.__c={n:"CircleCheckmark"};const{checked:t}=e,i=(0,o.yK)((e=>({circleCheckmark:{display:"flex",justifyContent:"center",alignItems:"center",width:18,height:18,borderRadius:"50%",borderStyle:"solid",borderWidth:1.75,borderColor:t?E.ZP.blue:e.buttonPressedBackground,backgroundColor:t?E.ZP.blue:"transparent"},checkIcon:{height:12,width:12,color:"white"}})),[t]);return(0,L.jsx)("div",{style:i.circleCheckmark,children:t&&(0,H.e)(i.checkIcon)})}function ae(e){const{filteredImportedContacts:t,inviteTargetsStore:i}=e,n=i.state.inviteTargets.length;return 0!==n&&n===t.length}function le(e){window.__c={n:"SlackImportsInvite"};const{inviteTargetsStore:t,slackImportsInviteStore:i,inviteOrigin:o,onInviteComplete:a,onInviteClick:l}=e,c=(0,r.O7)(),[d,v]=(0,n.useState)(!1),g=(0,s.VK)((()=>Z.Z.completeSlackAuthentications.state),[]),m=(0,s.VK)((()=>O.default.state.currentSpaceStore),[]),p=(0,s.VK)((()=>i.state.flowId),[i]),f=(0,s.qz)(void 0,U.Z);(0,n.useEffect)((()=>{u.e8x(c,{invite_flow_id:i.state.flowId,origin:o}),async function(){if(m&&!d){for(const e of g)await T.loadContacts(c,{botId:e.id,spaceId:m.id,integrationId:w.nO}).catch((e=>{const t=(0,k.tg)(e);u.u00(c,{invite_stage:"load_slack_contacts",invited_user_count:0,invite_flow_id:p,error:t,origin:o,is_success:!1}),x.log({level:"error",from:"SlackImportsInvite",type:"loadSlackContacts",error:(0,b.Ui)(e)})}));v(!0)}}()}),[m,g,c,d,o,i,p]);const I=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,isLoading:r}=e;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(z,{isLoading:r}),(0,L.jsx)(P,{inviteTargetsStore:i,slackImportsInviteStore:t,inviteOrigin:n})]})}({inviteTargetsStore:t,slackImportsInviteStore:i,inviteOrigin:o,isLoading:!d}),S=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:r,onInviteClick:s}=e;return(0,L.jsx)(V,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:r,onInviteClick:s})}({slackImportsInviteStore:i,inviteTargetsStore:t,inviteOrigin:o,onInviteComplete:a,onInviteClick:l}),h=function(e){let{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,menuListStore:r,isLoading:s}=e;if(s)return null;return(0,L.jsx)(ie,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,menuListStore:r})}({slackImportsInviteStore:i,inviteTargetsStore:t,inviteOrigin:o,menuListStore:f,isLoading:!d}),_={menuType:M.og.Popup,width:480,height:"60vh",header:I,footer:S,tokenInputHeader:!1,disableScroller:!1};return(0,L.jsx)(C.Z,{..._,className:j.FJA,children:(0,L.jsx)("div",{children:h})})}function ce(e){window.__c={n:"SlackImportsInviteWithModal"};const t=(0,r.O7)(),{inviteOrigin:i,canEditPermission:l,onInviteComplete:m,onInviteClick:I,slackButtonLabel:S,slackButtonStyle:h,slackButtonContainerStyle:_}=e,{isMobile:k}=(0,r.Fy)(),w=function(e,t){return(0,o.yK)((i=>({slackTitle:{display:"flex",fontSize:14,color:i.text.primary},integrationIcon:{marginRight:4},slackButtonContainer:{padding:"0 8px",...t},slackButton:{height:32,borderRadius:4,border:`1px solid ${i.stroke.regular}`,...e}})),[e,t])}(h,_),x=(0,s.qz)(void 0,y),b=(0,s.qz)(void 0,p.ZP),T=(0,s.VK)((()=>x.state.modalOpen),[x]),C=(0,s.VK)((()=>x.state.flowId),[x]),j=(0,n.useCallback)((()=>{!function(e){e.reset()}(x),u.Tdz(t,{origin:i,invite_flow_id:C})}),[x,i,t,C]),M=(0,n.useMemo)((()=>(0,L.jsxs)("div",{style:w.slackTitle,children:[(0,L.jsx)(d.Z,{type:"image_url",imageURL:a.Z.images.externalIntegrations.slackIconPng,size:16,imageStyle:w.integrationIcon}),(0,L.jsx)(c.FormattedMessage,{defaultMessage:"Import from Slack",id:"invite.slack_imports.button.label"})]})),[w]),O=(0,n.useCallback)((()=>function(e){const{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:r,onInviteClick:s}=e;return(0,L.jsx)(le,{slackImportsInviteStore:t,inviteTargetsStore:i,inviteOrigin:n,onInviteComplete:r,onInviteClick:s})}({inviteTargetsStore:b,slackImportsInviteStore:x,inviteOrigin:i,onInviteComplete:m,onInviteClick:I})),[b,x,i,I,m]);return(0,s.VK)((()=>{const e=ue({canEditPermission:l,isMobile:k,subscriptionTier:(0,f.zt)()});return e&&de({environment:t,flowId:C,origin:i}),e}),[l,k,t,C,i])?(0,L.jsx)(v.Z,{open:T,onDismiss:j,renderContent:O,origin:(0,L.jsx)(g.Z,{onClickAuthenticated:()=>{!function(e){e.setState({...e.state,modalOpen:!0})}(x)},title:S??M,hideChevronIcon:!0,containerStyle:w.slackButtonContainer,buttonStyle:w.slackButton,from:"space_settings",inviteOrigin:i,flowId:C,loadContacts:!1})}):null}function ue(e){const{canEditPermission:t,isMobile:i}=e,n="enterprise"===e.subscriptionTier;return!(i||n||!t)&&"on"===m.default.getEligibleGroup({experimentId:"acq_slack_imports_invite_v1",defaultGroup:"control"})}const de=l.Ds((e=>{let{environment:t,flowId:i,origin:n}=e;u.gVc(t,{origin:n,invite_flow_id:i})}),2e3)},56678:(e,t,i)=>{i.d(t,{Z:()=>y});var n=i(67294),r=i(480),s=i(86628),o=i(24405),a=i(8848),l=i(77657),c=i(5257),u=i(91315),d=i(29477),v=i(149),g=i(50906),m=i(54642),p=i(42631),f=i(68785),I=i(89728),S=i(80444),h=i(30874),_=i(85893);function y(e){window.__c={n:"ImportContactsButton"};const{onClickAuthenticated:t,title:i,hideChevronIcon:y,containerStyle:k,buttonStyle:w,from:x,inviteOrigin:b,flowId:T,loadContacts:C}=e,j=(0,r.O7)(),[M,O]=n.useState(!1),Z=(0,s.VK)((()=>S.default.state.currentSpaceStore),[]),U=(0,s.VK)((()=>{const e=null==Z?void 0:Z.getBotSettingsStore().getValue();return"approved_only"!==(null==e?void 0:e.integration_restrictions)||Boolean((null==e?void 0:e.integration_approval_statuses)&&e.integration_approval_statuses[l.nO])}),[Z]),F=(0,s.VK)((()=>h.Z.integrations.state.find((e=>e.id===l.nO))),[]),K=(0,s.VK)((()=>h.Z.completeSlackAuthentications.state),[]),L=(0,o.yK)((e=>({circleCheck:{height:14,width:14,color:a.ZP.blue},chevron:{height:12,width:12},title:{display:"flex",alignItems:"center",color:a.ZP.uiLightBlack,size:14,gap:6},loadingSpinner:{width:14,height:14,marginLeft:6}})),[]);if(!Z)return(0,_.jsx)(_.Fragment,{});if(!U)return(0,_.jsx)(_.Fragment,{});const V=M?(0,_.jsx)(f.Z,{style:L.loadingSpinner}):(0,_.jsxs)(_.Fragment,{children:[K.length>0&&(0,u.r)(L.circleCheck),!y&&(0,c.o)(L.chevron)]});return(0,_.jsx)("div",{style:k,children:(0,_.jsx)(I.Z,{style:w,onClick:async()=>{0===K.length?await async function(e){const{from:i,inviteOrigin:n,flowId:r}=e,s=j.currentUser.id;if(!F||!Z||!s)return;try{var o;O(!0),g.n0P(j,{origin:n,from:i,invite_flow_id:r});const e=await p.hM({environment:j,integration:F,spaceId:Z.id,from:i});if(v.x.isFail(e))return void g.ZKQ(j,{origin:n,from:i,invite_flow_id:r,is_success:!1});const s=null===(o=e.value.externalAuthentication)||void 0===o?void 0:o.parent_id;if(!s)return;g.ZKQ(j,{origin:n,from:i,invite_flow_id:r,is_success:!0}),C&&await Promise.race([m.loadContacts(j,{botId:s,spaceId:Z.id,integrationId:F.id}),(0,d.Vs)(2e3)]),null==t||t()}finally{O(!1)}}({from:x,inviteOrigin:b,flowId:T,loadContacts:C}):K.length>0&&(null==t||t())},children:(0,_.jsxs)("div",{style:L.title,children:[i,V]})})})}}}]);