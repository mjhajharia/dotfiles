"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[2346],{83919:(e,t,o)=>{o.r(t),o.d(t,{COMPLETION_THROTTLE:()=>se,acceptCursorCompletion:()=>Ae,acceptCursorCompletionAssistant:()=>Fe,cancelCompletion:()=>Ue,cancelCursorCompletionAssistant:()=>Te,doesPromptNeedAdditionalUserInput:()=>fe,handleCompletionPopupRetry:()=>ge,improveCompletion:()=>Pe,insertBlockSelectionCompletion:()=>Ee,insertTextSelectionCompletion:()=>_e,maybeSetPromptForCurrentAiBlock:()=>Ge,openCompletionPopupForBlockSelectionContext:()=>de,openCompletionPopupForCursorContext:()=>le,openCompletionPopupForPrefilledContext:()=>ue,openCompletionPopupForSavedContext:()=>pe,postProcessAICreatedStores:()=>Re,redoCompletionRevision:()=>Ze,replaceTextSelectionCompletion:()=>We,revertCurrentCompletionRevision:()=>Oe,selectPageAndOpenCompletionPopupForBlockSelectionContext:()=>ce,showCompletionErrorWithCode:()=>ke,stopCompletion:()=>Ne,submitFeedbackForRevision:()=>Ye,triggerAssistantSkillCompletion:()=>he,triggerCompletionForAiBlock:()=>Ie,updateAiEligibility:()=>Ke});o(21703),o(57658),o(30541);var n=o(26263),i=o(1302),r=o(41432),a=o(68626),s=o(42875),l=o(74229),c=o(72126),d=o(482),p=(o(72141),o(21202));o(6287),o(70279),o(15047),o(29369);function u(e){return{pointer:{table:p.iU,id:e.blockParentId},path:["content"],command:"removeChild",args:{id:e.recordId}}}var m=o(4615),f=o(82883),g=o(3791),y=o(70203),h=o(95371),v=o(97880),C=o(50906),k=o(54642),x=o(14871),w=o(47307),S=o(94419),P=o(9953),M=o(24677),I=o(64964),b=o(993),A=o(98104),F=o(29373),T=o(39699),L=o(56518),_=o(78663),W=o(99417),R=o(96318),E=o(43455),N=o(33929),B=o(45162),Z=o(67669),O=o(65598),U=o(77546),D=o(69645),z=o(73959),H=o(89224),j=o(89086),V=o(77907),$=o(95802),K=o(80444),Y=o(21273),G=o(98180),X=o(16772),q=o(77080),Q=o(26136),J=o(27724),ee=o(44041),te=o(35057),oe=o(28956),ne=o(92022),ie=o(71184),re=o(63594),ae=o(30793);const se=300;async function le(e){const{environment:t,prompt:o=W.NX,additionalContext:n,from:i}=e,r=(0,_.FD)();r&&await me({environment:t,prompt:o,context:r,additionalContext:n,from:i})}async function ce(e){const t=M.aw(M.KX()),o=(0,B.W9)(t);if(!o)return;A.NA({multiSelection:o});const n=(0,_.Fu)();if(!n)return;const i={type:"closedWithContext",context:n,futureRevisions:[]};X.default.setState(i),await pe(e)}async function de(e){const{environment:t,prompt:o=W.NX,additionalContext:n,from:i}=e,r=(0,_.Xc)();r&&await me({environment:t,prompt:o,context:r,additionalContext:n,from:i})}async function pe(e){"closedWithContext"===X.default.state.type&&X.default.state.context&&await me({...e,context:X.default.state.context})}async function ue(e){await me(e)}async function me(e){const{environment:t,prompt:o,context:r,additionalContext:a,skipInitialForm:s,from:l}=e,c=X.default.getExistingSessionId(),d=c??(0,m.ZP)();if(fe({clientPrompt:o,additionalContext:a})&&!s)return void(await(0,ne.toggleInitialPrompt)({environment:t,from:l,prefilledValue:(0,_.$W)(o),promptForAnalytics:o,sessionId:d,context:r}));Boolean(c)||C.Tlp(t,{session_id:d,prompt_key:o.key,from:l}),A.ZH(t),await async function(e){const{environment:t,context:o,prompt:r,additionalContext:a,updater:s,sessionId:l,from:c}=e;"textSelection"===o.type&&s((()=>{A.ZH(t),M.ZH(t)}));const d=await V.deps.markdownLinkifyIt.loader(),{serverPrompt:p}=ye({...e,markdownLinkifyIt:d}),u=new n.Z({name:"completionActions.triggerCompletion",isTemporaryData:!0});s((()=>{t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(u)}));const m=X.default.state,f="completionPopup"===m.type&&"initialPrompt"===m.stage||"closedWithContext"===m.type?m.futureRevisions:[],g={type:"completionPopup",stage:"results",loading:!0,sessionId:l,revisions:[...f,{type:"initial",clientPrompt:r,serverPrompt:p,additionalContext:a,userSearchCache:new Map,completion:void 0,hasFeedback:!1}],futureRevisions:[],context:o,inMemoryRecordCache:u,from:c,hasErrored:!1};s((()=>{X.default.setState(g)})),await i.default.afterNextFlush(),await s((()=>be({environment:t}))),await ve({...e,updater:s,isRetry:!1})}({environment:t,context:r,prompt:o,intl:N.default.getIntl(),updater:X.default.createUpdater(),additionalContext:a,sessionId:d,from:l})}function fe(e){const{clientPrompt:t,additionalContext:o}=e,n="translate"===t.key&&o&&o.language,i="changeTone"===t.key&&o&&o.tone;return Boolean(!n&&!i&&t.steps)}async function ge(e){const{environment:t}=e,o=X.default.state;if("completionPopup"===o.type&&"results"===o.stage)if(A.ZH(t),fe((0,W.Iz)(o)));else{const e=(0,W.Iz)(o);X.default.setState({...o,revisions:[...o.revisions,{type:"initial",clientPrompt:e.clientPrompt,serverPrompt:e.serverPrompt,additionalContext:e.additionalContext,userSearchCache:new Map,completion:void 0,hasFeedback:!1}]}),await ve({environment:t,updater:X.default.createUpdater(),isRetry:!0})}}function ye(e){const{environment:t,context:o,prompt:n,additionalContext:i,intl:r,markdownLinkifyIt:a}=e,l=(0,f.X)({intl:r,textValue:o.currentPage.getBlockTitleStore().getValue(),getRecordModel:o.currentPage.getRecordModel,userTimeZone:(0,s.r)()}),{previousContent:d,restContent:p,pageContent:u}=function(e){var t,o;const{environment:n,context:i,markdownLinkifyIt:r}=e,a=i.currentPage.getContentStores()[0];let s,l;if("cursor"===i.type||"textSelection"===i.type)s=i.textSelection.start,l=i.textSelection.end;else{var c;s={store:i.stores[0].getBlockTitleStore(),index:0};const e=i.stores[i.stores.length-1].getBlockTitleStore();l={store:e,index:(null===(c=(0,j.x0)(e))||void 0===c?void 0:c.endIndex)||0}}const d=ze(i.currentPage),p=x.wc({environment:n,textSelection:{start:{store:a.getBlockTitleStore(),index:0},end:l},markdownSerializationOptions:(0,E.KF)(),markdownLinkifyIt:r}),u=[d,p].filter(v.$K).join("\n\n"),m=(0,D.Bj)({includeNonSelectableListContainer:!1}),f=null===(t=(0,h.CY)(m).value)||void 0===t?void 0:t.store,g=null==f?void 0:f.getBlockTitleStore(),y=g&&x.wc({environment:n,textSelection:{start:s,end:{store:g,index:(null===(o=(0,j.x0)(g))||void 0===o?void 0:o.endIndex)||0}},markdownSerializationOptions:(0,E.KF)(),markdownLinkifyIt:r})||"",C=He({environment:n,page:i.currentPage,markdownLinkifyIt:r})||"";return{previousContent:u,restContent:y,pageContent:C}}({environment:t,context:o,markdownLinkifyIt:a});let m,g;if("textSelection"===o.type||"blockSelection"===o.type){if("textSelection"===o.type)g=x.wc({environment:t,textSelection:o.textSelection,markdownSerializationOptions:(0,E.KF)(),markdownLinkifyIt:a})??"";else if("blockSelection"===o.type){const e=c.oA(J.default.state.stores.map((e=>e.getValue())));g=(0,L.X4)({rootBlock:{...o.currentPage.pointer,spaceId:o.currentPage.getSpaceId()},blockValues:e,isWindows:t.device.isWindows,getRecordValue:o.currentPage.getRecordValue,markdownSerializationOptions:(0,E.KF)(),markdownLinkifyIt:a}).markdown||""}else(0,v.t1)(o);m=je({prompt:n,selectedText:g,pageTitle:l,pageContent:u,additionalContext:i}),m||(m=$e({prompt:n,pageTitle:l,previousContent:d,restContent:p,pageContent:u,additionalContext:i}))}else"cursor"===o.type?(m=$e({prompt:n,pageTitle:l,previousContent:d,restContent:p,pageContent:u,additionalContext:i}),m||(m=je({prompt:n,selectedText:u,pageTitle:l,additionalContext:i,pageContent:u}))):(0,v.t1)(o);if(!m)throw new Error(`Unable to find server prompt for "${n.key}" client prompt`);const y={type:"initial",pageTitle:l,selectedText:g,pageContent:u};return{serverPrompt:m.serverPrompt,initialStep:y,humanStep:m.humanStep}}async function he(e){const{environment:t,context:o,clientSkill:r,skillSettings:a,updater:s,sessionId:l,from:c}=e;"textSelection"===o.type&&s((()=>{A.ZH(t),M.ZH(t)}));const d=new n.Z({name:"completionActions.triggerCompletion",isTemporaryData:!0}),p={type:"completionPopup",stage:"results",loading:!0,sessionId:l,revisions:[{type:"initial",clientPrompt:{},serverPrompt:{},userSearchCache:new Map,completion:void 0,hasFeedback:!1}],futureRevisions:[],context:o,inMemoryRecordCache:d,from:c,hasErrored:!1,clientSkill:r,skillSettings:a};s((()=>{X.default.setState(p)})),await i.default.afterNextFlush(),await s((()=>be({environment:t}))),await ve({...e,updater:s,isRetry:!1})}async function ve(e){const{environment:t,updater:o,isRetry:n}=e,i=X.default.state;if("completionPopup"!==i.type||"results"!==i.stage)return;const{sessionId:r,clientSkill:a,skillSettings:s}=i,d=Date.now(),p=(0,m.ZP)(),u=(0,W.Iz)(i);if(i.revisions[i.revisions.length-1]!==u)throw new Error("Assertion failure, expected current revision to be initial revision");const f={...u,inferenceId:p},g=i.revisions.slice(0,i.revisions.length-1),{serverPrompt:h}=f;C.g_f(t,{session_id:r,inference_id:p,from:i.from,prompt_key:f.clientPrompt.key,type:"completion"}),o((()=>{X.default.setState({...i,loading:!0,revisions:[...g,f]})}));let v=!1;if(Y.Z.isAssistant2Enabled(void 0)){t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(i.inMemoryRecordCache);const{assistantActions:e}=await V.deps.assistant.loader();if(n){const o=G.Z.getActiveSessionId();if(!o)throw new Error("No assistantSessionId.");await e.sampleNextAssistantSteps({environment:t,sessionId:o,inferenceId:(0,m.ZP)()})}else{var x;const o=await e.resetAndInitializeAssistantSession({environment:t,completionContext:i.context,clientSkill:a,skillSettings:s});"helpMeWrite"===h.type||"helpMeDraft"===h.type||"helpMeEdit"===h.type?await e.commitHumanStep({environment:t,text:(0,y.TPx)(h.prompt),sessionId:o.sessionId}):null!==(x=i.clientSkill)&&void 0!==x&&null!==(x=x.inAppSkillTrigger)&&void 0!==x&&x.requiresInput||await e.sampleNextAssistantSteps({environment:t,sessionId:o.sessionId,inferenceId:(0,m.ZP)()})}v=!0,await o((()=>{const e=X.default.state;if("completionPopup"!==e.type||"results"!==e.stage)return;const t=new Map,o=c.Z$(J.default.state.stores);X.default.setState({...e,revisions:[...g,{...f,completion:"",userSearchCache:t}],context:{...e.context,origin:o||e.context.origin},loading:!1})}))}else{const e=c.P2((async()=>{v||await o((()=>be({environment:t,setSelection:!1})))}),se),n=async function(e,t,o){if(!q.default.checkGate("ai_favorites"))return;const{currentSpaceStore:n}=K.default.getState();if(!n)return;if(!t.trim())return;const i=await k.getCompletion(e,{id:(0,m.ZP)(),aiSessionId:o,context:{type:"promptTitle",selectedText:t},model:(0,W.PD)(),metadata:{},spaceId:n.id,isSpacePermission:!1});if("success"!==i.type)return;const r=[];if(l.H1.is(i.data))for await(const s of i.data){if("success"!==s.type)return;r.push(s.completion)}const a=r.join("").trim();return a||void 0}(t,(0,W.gY)(u),r),a=xe({environment:t,inferenceId:p,aiSessionId:r,serverPrompt:h,targetStore:i.context.currentPage,inferenceReason:"writer",attribution:{blockId:i.context.currentPage.id},metadata:{blockId:i.context.currentPage.id},onUpdate(t){let{completion:n,userSearchCache:i}=t;o((()=>{const t=X.default.state;"completionPopup"===t.type&&"results"===t.stage&&(X.default.setState({...t,revisions:[...g,{...f,completion:n,userSearchCache:i}]}),e())}))}}),[s,y]=await Promise.all([n,a]);if("error_modal_shown"===y.type||"upsell_modal_shown"===y.type)return void o((()=>Be()));v=!0;const{completion:x,userSearchCache:w}=y;await o((()=>{C.WP(t,{session_id:r,inference_id:p,preview_time:Date.now()-d,type:"completion"});const e=X.default.state;if("completionPopup"===e.type&&"results"===e.stage)return X.default.setState({...e,revisions:[...g,{...f,completion:x,userSearchCache:w,promptTitle:s}],loading:!1}),be({environment:t,setSelection:!0})}))}}function Ce(e){const{environment:t,inMemoryRecordCache:o,completion:n,userSearchCache:i,store:r,prompt:a,additionalContext:s,isComplete:l,markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:p}=e;T.createAndCommit({userAction:"completionActions.updateAiBlockForCompletion",environment:t,perform:e=>{const m=r.clone(o);m.getContentIds().forEach((t=>{T.applyOperation({store:m,operation:u({blockParentId:m.id,recordId:t}),transaction:e})}));const f=x.Mt({environment:t,text:n,inMemoryRecordCache:o,transaction:e,markdownOptions:(0,E.N9)(i),markdownLinkifyIt:c,tinyMceMicrosoftWordPasteFilter:p,useCrdt:m.useCrdt()});if(!f)return;const g=m.getContentStore();f.reverse().forEach((t=>{S.Ce({parent:g,prepend:t,transaction:e}),P.sW({store:t,data:{parent_id:m.id,parent_table:m.table,alive:!0},transaction:e})})),T.applyOperation({store:m,operation:d.op.update({pointer:m.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:a.key}}),transaction:e});const h=s?(0,y.TPx)(s.prompt):[];b.sO({environment:t,store:m.getBlockTitleStore(),value:h,transaction:e}),l&&Ve({transaction:e,completionState:{clientPrompt:a,additionalContext:s}})}})}function ke(e){const t=N.default.getIntl();return 451===e?I.oV({label:t.formatMessage({id:"completionActions.moderationError",defaultMessage:"AI does not allow content that is harmful or illegal. Please revise your input and try again. (451)"})}):502===e||503===e||504===e?I.oV({label:t.formatMessage({id:"completionActions.providerError",defaultMessage:"Weâ€™re experiencing issues with our AI provider. Try again in a few minutes. ({errorCode})"},{errorCode:e})}):void I.oV({label:t.formatMessage({id:"completionActions.genericError",defaultMessage:"AI is temporarily unavailable. Try again in a few minutes. ({errorCode})"},{errorCode:e})})}async function xe(e){var t;const{environment:o,inferenceId:n,serverPrompt:i,targetStore:r,onUpdate:s,aiSessionId:c,metadata:d,attribution:p,inferenceReason:u}=e,m=R.mw()?R.SA:k.getCompletion,f=null===(t=K.default.state.currentSpaceStore)||void 0===t?void 0:t.id,y=(0,Z.UK)(r);if(!f)return ke(1001),{type:"error_modal_shown"};const h="summarizeMeetingTranscript"===i.type?"anthropic-2":(0,W.PD)(),v=await m(o,{id:n,context:i,model:h,spaceId:f,isSpacePermission:y,aiSessionId:c,metadata:d,attributionForLogging:p,inferenceReason:u});if("success"!==v.type)return w.showError(v),{type:"error_modal_shown"};let x="",S="";const P=new Map,M=await V.deps.searchActions.loader(),I=e=>M.searchVisibleSpaceUsers({environment:o,query:e,membersOnly:!0});if(l.H1.is(v.data))for await(const a of v.data)if("success"===a.type)x+=a.completion,(0,E.Ie)(x)||(S=we(x),await(0,E.$A)(x,I,P)),s({completion:S,userSearchCache:new Map(P)});else if("error"===a.type)return(0,g.lX)(a.errorCode)?(ee.y(o,{from:"ai_limit_in_app",for:(0,te.zt)(),addOnFeature:"ai"}),{type:"upsell_modal_shown"}):(ke(a.errorCode),{type:"error_modal_shown"});const b=we(x);return b?(await(0,E.$A)(b,I,P),{type:"success",completion:b,userSearchCache:new Map(P)}):(ke(600),a.log({level:"error",from:"completionActions.getCompletionWithPostProcessing",type:"emptyResponse",data:{inferenceId:n}}),C.UD4(o,{promptKey:i.type}),{type:"error_modal_shown"})}function we(e){return e.replace(/<br>/g,"\n")}function Se(e){const{improvement:t}=e;return"continueWriting"===t.type?{type:"human",prompt:"Continue writing"}:"makeLonger"===t.type?{type:"human",prompt:"Make longer"}:"helpMeEdit"===t.type?{type:"human",prompt:t.prompt}:void(0,v.t1)(t.type)}async function Pe(e,t){const o=X.default.state;if("completionPopup"!==o.type||"results"!==o.stage)return;let n=!1;const i=X.default.createUpdater();if(Y.Z.isAssistant2Enabled(void 0)){if("helpMeEdit"!==t.type)throw new Error("Improvements other than helpMeEdit are not supported");const{assistantActions:o}=await V.deps.assistant.loader(),r=G.Z.getActiveSessionId();if(!r)throw new Error("No active assistant session");await o.commitHumanStep({environment:e,text:(0,y.TPx)(t.prompt),sessionId:r}),n=!0,await i((()=>{const e=X.default.state;if("completionPopup"!==e.type||"results"!==e.stage)return;const t=c.Z$(J.default.state.stores);X.default.setState({...e,context:{...e.context,origin:t||e.context.origin},loading:!1})}))}else{const r=(0,W.xM)(o);if(!r.completion)return;const a=o.context,s=r.completion,l="continueWriting"===t.type?s:"",d=Date.now(),p=(0,m.ZP)();C.g_f(e,{session_id:o.sessionId,inference_id:p,from:o.from,prompt_key:(0,W.Iz)(o).clientPrompt.key,improvement_prompt_type:t.type,type:"follow_up_improvement"});const u=[...o.revisions,...o.futureRevisions],f={type:"followup",improvement:t,completion:l,userSearchCache:new Map,inferenceId:p,hasFeedback:!1,previousRevision:(0,W.HS)(o)},g={...o,loading:!0,revisions:[...u,f],futureRevisions:[]},y=await V.deps.markdownLinkifyIt.loader(),h=function(e){const{environment:t,completionState:o,markdownLinkifyIt:n}=e,{context:i}=o,r=[];for(const a of(0,W.zU)(o))if("initial"===a.type){const{initialStep:e,humanStep:o}=ye({environment:t,context:i,prompt:a.clientPrompt,additionalContext:a.additionalContext,intl:N.default.getIntl(),markdownLinkifyIt:n});if(void 0===a.completion)throw new Error("Assertion failure, followup without initial completion");r.unshift(e,o,{type:"assistant",result:a.completion})}else if("followup"===a.type){const e=[Se({improvement:a.improvement})];a.completion&&e.push({type:"assistant",result:a.completion}),r.unshift(...e)}else(0,v.t1)(a);R.mw()&&console.log("Transcript",JSON.stringify(r,null,2));return{type:"writerFollowup",transcript:r}}({environment:e,completionState:g,markdownLinkifyIt:y});i((()=>{X.default.setState(g)}));const k=c.P2((async()=>{n||await i((()=>be({environment:e,setSelection:!1})))}),se),x=await xe({environment:e,inferenceId:p,serverPrompt:h,targetStore:a.currentPage,aiSessionId:o.sessionId,inferenceReason:"writer",attribution:{blockId:o.context.currentPage.id},metadata:{blockId:a.currentPage.id},onUpdate(e){let{completion:t,userSearchCache:o}=e;i((()=>{const e=X.default.state;"completionPopup"===e.type&&"results"===e.stage&&(X.default.setState({...e,revisions:[...u,{...f,completion:l+t,userSearchCache:o}]}),k())}))}});if("error_modal_shown"===x.type||"upsell_modal_shown"===x.type)return void i((()=>Be()));n=!0;const{completion:w,userSearchCache:S}=x;i((()=>{C.WP(e,{session_id:g.sessionId,inference_id:p,preview_time:Date.now()-d,type:"follow_up_improvement"}),X.default.setState({...g,loading:!1,revisions:[...u,{...f,completion:l+w,userSearchCache:S}]}),be({environment:e,setSelection:!0})}))}}const Me=(0,v.AO)((e=>e instanceof Q.G?{true:e}:{false:e}));async function Ie(e){const{environment:t,store:o,prompt:i,additionalContext:r}=e,a=o.getRecordStoreUIRoot();if(!Me(a))return;const l=await V.deps.markdownLinkifyIt.loader(),d=function(e){const{environment:t,rootStore:o,store:n,prompt:i,additionalContext:r,markdownLinkifyIt:a}=e,l=N.default.getIntl(),c=(0,f.X)({intl:l,textValue:o.getBlockTitleStore().getValue(),getRecordModel:o.getRecordModel,userTimeZone:(0,s.r)()}),d=He({environment:t,page:o,markdownLinkifyIt:a})||"";if("summarizeMeetingTranscript"===i.key)return{type:"summarizeMeetingTranscript",pageTitle:c,pageContent:d};if("helpMeWrite"===i.key){var p,u,m,g,y;const e={type:"helpMeWrite",pageTitle:c,pageContent:d,prompt:(null==r?void 0:r.prompt)??""},i=(0,D.dq)({includeNonSelectableListContainer:!1,root:n.getHighestContentBlockUIAncestor()});if(!i)return e;const s=(0,D.v5)(n,i.children);if(!s)return e;const l=o.getContentStores()[0],f=(0,h.YL)(i,s),C=f.prev?f.prev.value.store.getBlockTitleStore():null===(p=f.parent)||void 0===p?void 0:p.value.store.getBlockTitleStore(),k=l&&C&&x.wc({environment:t,textSelection:{start:{store:l.getBlockTitleStore(),index:0},end:{store:C,index:(null===(u=(0,j.x0)(C))||void 0===u?void 0:u.endIndex)??0}},markdownSerializationOptions:(0,E.KF)(),markdownLinkifyIt:a})||"",w=[ze(o),k].filter(v.$K).join("\n\n"),S=null===(m=(0,h.Xf)(i,s).next)||void 0===m?void 0:m.value.store.getBlockTitleStore(),P=null===(g=(0,h.CY)(i).value)||void 0===g?void 0:g.store,M=null==P?void 0:P.getBlockTitleStore();return{type:"helpMeWrite",pageTitle:c,previousContent:w,restContent:S&&M&&x.wc({environment:t,textSelection:{start:{store:S,index:0},end:{store:M,index:(null===(y=(0,j.x0)(M))||void 0===y?void 0:y.endIndex)||0}},markdownSerializationOptions:(0,E.KF)(),markdownLinkifyIt:a})||"",prompt:(null==r?void 0:r.prompt)??""}}return"summarize"===i.key||"findActionItems"===i.key?{type:i.key,pageTitle:c,selectedText:d}:void 0}({environment:t,rootStore:a,store:o,prompt:i,additionalContext:r,markdownLinkifyIt:l});if(!d)return;const p=c.P2(Ce,se),u=new n.Z({name:"completionActions.triggerCompletionForAiBlock",isTemporaryData:!0});t.defaultRecordCache.inMemoryRecordCache.addCacheOverride(u);const g=await V.deps.tinyMceMicrosoftWordPasteFilter.loader(),y=await xe({environment:t,inferenceId:(0,m.ZP)(),serverPrompt:d,targetStore:a,aiSessionId:(0,m.ZP)(),metadata:{blockId:a.id},inferenceReason:"writer",attribution:{blockId:a.id},onUpdate(e){let{completion:n,userSearchCache:a}=e;p({inMemoryRecordCache:u,environment:t,store:o,completion:n,userSearchCache:a,prompt:i,additionalContext:r,isComplete:!1,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:g})}});if(t.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(u),"error_modal_shown"===y.type||"upsell_modal_shown"===y.type)return;const{completion:C,userSearchCache:k}=y;Ce({environment:t,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,store:o,completion:C,userSearchCache:k,prompt:i,additionalContext:r,isComplete:!0,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:g})}async function be(e){const{environment:t,setSelection:o}=e,n=X.default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const r=(0,W.xM)(n),{completion:a,userSearchCache:s}=r,{context:l,inMemoryRecordCache:d}=n;if("cursor"!==l.type)return;d.clearCache();const{currentBlock:p,currentParent:u,currentPage:m}=l,f=u||m.getContentStore(),{insertTitle:g,insertCompletion:h}=Le({completion:a||"",currentPage:m});g&&T.createAndCommit({userAction:"completionActions.temporaryInsertion.insertTitle",environment:t,canUndo:!1,perform:e=>{var t;const o=null===(t=m.getTitleStore())||void 0===t?void 0:t.clone(d);o&&P.sO({store:o,value:(0,y.TPx)(g),transaction:e})}});const[v,C]=await Promise.all([V.deps.markdownLinkifyIt.loader(),V.deps.tinyMceMicrosoftWordPasteFilter.loader()]);if(h){const e=T.createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletion",environment:t,canUndo:!1,perform:e=>{if(!h)return;const o=x.Mt({environment:t,text:h,inMemoryRecordCache:d,transaction:e,markdownOptions:(0,E.N9)(s),markdownLinkifyIt:v,tinyMceMicrosoftWordPasteFilter:C,useCrdt:!1});if(!o)return;Re(t,o);De({parentStore:f.clone(d),insertAfter:null==p?void 0:p.clone(d),insertStores:o,transaction:e});return o.map((e=>e.clone(t.defaultRecordCache.inMemoryRecordCache))).map((e=>e.cloneWithNewUIParent(f)))}}).performResult;if(!e||!e.length)return;o&&M.Z5({environment:t,stores:e}),await i.default.afterNextFlush();const n=X.default.state;if("completionPopup"!==n.type||"results"!==n.stage)return;const r=c.oA(e.map((e=>$.C.findNodeFromStore(e))));if(!(r[0]?(0,U.VW)(r[0]):void 0))return;X.default.setState({...n,context:{...n.context,origin:c.Z$(e)}})}else if(p){const e=(0,W.Ah)(p),i=new DOMRect(null==e?void 0:e.x,null==e?void 0:e.y,null==e?void 0:e.width,0);T.createAndCommit({userAction:"completionActions.temporaryInsertion.insertCompletionStores",environment:t,canUndo:!1,perform:e=>{De({parentStore:f.clone(d),insertAfter:p.clone(d),insertStores:[],transaction:e})}}),o&&M.ZH(t),p.getAlive()?X.default.setState({...n,context:{...l,origin:p}}):X.default.setState({...n,context:{...l,origin:i}})}}function Ae(e){var t;const{environment:o,transaction:n,selectInsertion:a,exitType:s,markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:c}=e,p=X.default.state;if(X.default.invalidateLastUpdater(),"completionPopup"!==p.type||"results"!==p.stage||"cursor"!==p.context.type)return;const{completion:u,userSearchCache:m,inferenceId:f}=(0,W.xM)(p);if(!u)return;const{currentBlock:g,currentParent:h,currentPage:v}=p.context,k=h||v.getContentStore();X.default.resetStore(e);const{insertTitle:w,insertCompletion:I}=Le({completion:u,currentPage:v});w&&"convert_to_ai_block"!==s&&P.sO({store:v.getBlockTitleStore(),value:(0,y.TPx)(w),transaction:n});const b=(null===(t=(0,z.sQ)(k))||void 0===t?void 0:t.useCrdt())??!1,F=x.Mt({environment:o,text:I,inMemoryRecordCache:o.defaultRecordCache.inMemoryRecordCache,transaction:n,markdownOptions:(0,E.N9)(m),markdownLinkifyIt:l,tinyMceMicrosoftWordPasteFilter:c,useCrdt:b});if(F){if(g&&"convert_to_ai_block"===s){var L;const e=P.j4({environment:o,type:r.Ti.aiBlock,inMemoryRecordCache:g.inMemoryRecordCache,transaction:n,spaceId:g.pointer.spaceId,useCrdt:b});S.BE({parent:k,after:g,insert:e,transaction:n}),(0,O.PF)(g)&&S.Od({parent:k,childToRemove:g,transaction:n});const t=(0,W.xM)(p);if("initial"!==t.type)throw new Error("Assertion failure, currentRevision.type is not initial");const i=null===(L=t.additionalContext)||void 0===L?void 0:L.prompt;i&&T.applyOperation({store:e,operation:d.op.set({pointer:e.pointer,path:["properties","title"],args:[[i]]}),transaction:n}),T.applyOperation({store:e,operation:d.op.update({pointer:e.pointer,path:["format"],args:{ai_last_edited:Date.now(),ai_prompt_key:t.clientPrompt.key}}),transaction:n}),De({parentStore:e.getContentStore(),insertAfter:void 0,insertStores:F,transaction:n})}else De({parentStore:k,insertAfter:g,insertStores:F,transaction:n}),function(e){const{environment:t,parentStore:o,insertStores:n,selectInsertion:r}=e,a=n.map((e=>e.cloneWithNewUIParent(o)));i.default.afterNextFlush((()=>{M.yu({environment:t,stores:a}),r&&function(e){const{environment:t,insertedStores:o}=e;H.clear(t),i.default.afterNextFlush((()=>{const e=(0,B.W9)(o);e&&A.NA({multiSelection:e})}))}({environment:t,insertedStores:a})}))}({environment:o,parentStore:k,insertStores:F,selectInsertion:a});Ve({transaction:n,completionState:(0,W.Iz)(p)}),f&&C.NF$(o,{type:"cursor_completion",inference_id:f,feedback_type:"accept",timestamp:(new Date).toUTCString()})}}async function Fe(e){const{environment:t}=e;X.default.invalidateLastUpdater(),X.default.resetStore(e);const{assistantActions:o}=await V.deps.assistant.loader(),n=G.Z.getActiveSessionId();n&&(await o.commitPreviewAssistantStep({environment:t,sessionId:n}),await o.applyUncommittedOperations({environment:t,sessionId:n}),o.clearActiveAssistantSession({environment:t,sessionId:n}))}async function Te(e){const{environment:t}=e;X.default.invalidateLastUpdater(),X.default.resetStore(e);const{assistantActions:o}=await V.deps.assistant.loader(),n=G.Z.getActiveSessionId();n&&o.clearActiveAssistantSession({environment:t,sessionId:n})}function Le(e){const{completion:t,currentPage:o}=e;let n,i;const r=Boolean(o.getBlockTitleStore().getValue()),a=o.getContentStores().every((e=>{var t;return!(null!==(t=e.getTitleStore())&&void 0!==t&&t.getValue())}));if(!r&&a){const{title:e,content:o}=function(e){const t=e.trim().split("\n"),o=t[0];return o.startsWith("# ")?{title:o.substring(2),content:t.slice(1).join("\n")}:{title:"",content:e}}(t||"");n=e,i=o}else i=t;return{insertTitle:n,insertCompletion:i}}function _e(e){var t,o;const{environment:n,transaction:i,markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a}=e,s=X.default.state;if(X.default.invalidateLastUpdater(),"completionPopup"!==s.type||"results"!==s.stage||"textSelection"!==s.context.type)return;const{completion:l,userSearchCache:d}=(0,W.xM)(s);if(!l)return;const{endBlock:p,endBlockParent:u,currentPage:m}=s.context,f=u||m.getContentStore();X.default.resetStore(e);const g=x.Mt({environment:n,text:l,inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache,transaction:i,markdownOptions:(0,E.N9)(d),markdownLinkifyIt:r,tinyMceMicrosoftWordPasteFilter:a,useCrdt:p.useCrdt()});if(!g)return;De({parentStore:f,insertAfter:p,insertStores:g,transaction:i}),Ve({transaction:i,completionState:(0,W.Iz)(s)});const h=g.map((e=>e.cloneWithNewUIParent(f))),v=null===(t=c.Ps(h))||void 0===t?void 0:t.getBlockTitleStore(),C=null===(o=c.Z$(h))||void 0===o?void 0:o.getBlockTitleStore();v&&C&&A.NA({multiSelection:{start:{index:0,store:v},end:{index:C.getValue()?y.QaF(C.getValue()).length:0,store:C}}})}function We(e){const{environment:t,transaction:o,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i}=e,r=X.default.state;if(X.default.invalidateLastUpdater(),"completionPopup"!==r.type||"results"!==r.stage||"textSelection"!==r.context.type)return;const a=(0,W.xM)(r);a.completion&&(A.NA({multiSelection:r.context.textSelection}),x.R$({environment:t,text:a.completion,transaction:o,disableEmbedMenu:!0,overwrite:!0,selectAll:!0,markdownOptions:(0,E.N9)(a.userSearchCache),markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i}),Ve({transaction:o,completionState:(0,W.Iz)(r)}),X.default.resetStore(e))}function Re(e,t){for(const o of t)F.X_(e,o)}function Ee(e){const{environment:t,transaction:o,replace:n,markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r}=e,a=X.default.state;if(X.default.invalidateLastUpdater(),"completionPopup"!==a.type||"results"!==a.stage||"blockSelection"!==a.context.type)return;const{completion:s,userSearchCache:l}=(0,W.xM)(a);if(!s)return;const{stores:d}=a.context,p=c.Z$(d);if(!p)return;const u=p.getRecordStoreUIParent();if(!u)return;X.default.resetStore(e);const m=x.Mt({environment:t,text:s,inMemoryRecordCache:t.defaultRecordCache.inMemoryRecordCache,transaction:o,markdownOptions:(0,E.N9)(l),markdownLinkifyIt:i,tinyMceMicrosoftWordPasteFilter:r,useCrdt:p.useCrdt()});if(!m)return;if(De({parentStore:u,insertAfter:p,insertStores:m,transaction:o}),n)for(const c of d){const e=c.getRecordStoreUIParent();e&&S.Od({parent:e,childToRemove:c,transaction:o})}Ve({transaction:o,completionState:(0,W.Iz)(a)});const f=m.map((e=>e.cloneWithNewUIParent(u)));M.Z5({environment:t,stores:f})}function Ne(e){const t=X.default.state;if("completionPopup"!==t.type||"results"!==t.stage||!t.loading)return;const o=(0,W.xM)(t);o.completion&&(C.zim(e,{session_id:t.sessionId,inference_id:o.inferenceId}),X.default.invalidateLastUpdater(),X.default.setState({...t,loading:!1}),be({environment:e,setSelection:!0}))}function Be(){const e=X.default.state;"completionPopup"===e.type&&"results"===e.stage&&X.default.setState({...e,hasErrored:!0})}function Ze(e){const t=X.default.state;"completionPopup"===t.type&&"results"===t.stage&&0!==t.futureRevisions.length&&(X.default.invalidateLastUpdater(),X.default.setState({...t,hasErrored:!1,loading:!1,revisions:[...t.revisions,t.futureRevisions[0]],futureRevisions:t.futureRevisions.slice(1)}),be({environment:e,setSelection:!0}))}function Oe(e){const{environment:t,purgeFromHistory:o}=e,n=X.default.state;if("completionPopup"!==n.type||"results"!==n.stage||0===n.revisions.length)return;const i=n.revisions[n.revisions.length-1];return X.default.invalidateLastUpdater(),X.default.setState({...n,hasErrored:!1,loading:!1,revisions:n.revisions.slice(0,-1),futureRevisions:o?n.futureRevisions:[i,...n.futureRevisions]}),be({environment:t,setSelection:!0}),i}async function Ue(e){X.default.invalidateLastUpdater();const{environment:t,sessionId:o,inferenceId:n,exitType:i}=e,r=X.default.state;if("completionPopup"!==r.type||"initialPromptForAIBlock"===r.stage)return;if((!t.device.isMobileNative||"error_modal"!==i&&"upsell_modal"!==i)&&("cursor"===r.context.type||"textSelection"===r.context.type?A.NA({multiSelection:r.context.textSelection}):"blockSelection"===r.context.type?M.Z5({environment:t,stores:r.context.stores}):(0,v.t1)(r.context)),X.default.resetStore(e),C.HCf(t,{session_id:o,inference_id:n,exit_type:i}),"results"!==r.stage)return;const a=(0,W.xM)(r);if(a.inferenceId&&C.NF$(t,{type:"cursor_completion",inference_id:a.inferenceId,feedback_type:"cancel",timestamp:(new Date).toUTCString()}),Y.Z.isAssistant2Enabled(void 0)){const{assistantActions:e}=await V.deps.assistant.loader();e.clearActiveAssistantSession({environment:t})}}function De(e){const{parentStore:t,insertAfter:o,insertStores:n,transaction:i}=e,r=c.d9(n).reverse();for(const a of r)o?S.BE({parent:t,insert:a,after:o,transaction:i}):S.Ce({parent:t,prepend:a,transaction:i}),P.sW({store:a,data:{parent_id:t.id,parent_table:t.table,alive:!0},transaction:i});o&&(0,O.PF)(o)&&S.Od({parent:t,childToRemove:o,transaction:i})}function ze(e){return x.jm({rootBlock:{...e.pointer,spaceId:e.getSpaceId()},getRecordValue:e.getRecordValue})}function He(e){const{environment:t,page:o,markdownLinkifyIt:n}=e,i=c.oA(o.getContentStores().map((e=>e.getValue())));return[ze(o),(0,L.X4)({rootBlock:{...o.pointer,spaceId:o.getSpaceId()},getRecordValue:o.getRecordValue,blockValues:i,isWindows:t.device.isWindows,markdownSerializationOptions:(0,E.KF)(),markdownLinkifyIt:n}).markdown].filter(v.$K).join("\n\n")}function je(e){const{prompt:t,pageTitle:o,pageContent:n,selectedText:i,additionalContext:r}=e;R.mw()&&console.log("textSelectionPromptToServerContext",e);const a="string"==typeof t.name?t.name:N.default.formatMessage(t.name);if("fixSpellingGrammar"===t.key||"explainThis"===t.key||"makeLonger"===t.key||"makeShorter"===t.key||"findActionItems"===t.key||"improveWriting"===t.key||"simplifyLanguage"===t.key||"cleanUpFormatting"===t.key||"summarize"===t.key)return{serverPrompt:{type:t.key,pageTitle:o,selectedText:i},humanStep:{type:"human",prompt:a}};if("translate"===t.key){const e=(null==r?void 0:r.language)??"english";return{serverPrompt:{type:t.key,text:i,language:e},humanStep:{type:"human",prompt:`Translate to ${e}`}}}if("changeTone"===t.key){const e=(null==r?void 0:r.tone)??"professional";return{serverPrompt:{type:t.key,text:i,tone:e},humanStep:{type:"human",prompt:`Change tone to ${e}`}}}if("helpMeEdit"===t.key){const e=(null==r?void 0:r.prompt)||"";return{serverPrompt:{type:t.key,prompt:e,selectedText:i,pageTitle:o,pageContent:n},humanStep:{type:"human",prompt:e}}}}function Ve(e){const{transaction:t,completionState:{clientPrompt:o,additionalContext:n,promptTitle:i}}=e,r=(0,ae.BG)({clientPrompt:o,additionalContext:n,promptTitle:i});if(!r)return;const{currentUserSettingsStore:a}=K.default.state;if(!a)return;(0,ie.Gl)(a,r)||(0,ae.Nv)(r,a,t)}function $e(e){const{prompt:t,pageTitle:o,previousContent:n,restContent:i,additionalContext:r,pageContent:a}=e;R.mw()&&console.log("cursorPromptToServerContext",e);const s="string"==typeof t.name?t.name:N.default.formatMessage(t.name);if("continueWriting"===t.key)return{serverPrompt:{type:"continueWriting",pageTitle:o,previousContent:n,restContent:i},humanStep:{type:"human",prompt:s}};if("helpMeWrite"===t.key){const e=(null==r?void 0:r.prompt)??"";return{serverPrompt:{type:"helpMeWrite",pageTitle:o,previousContent:n,restContent:i,prompt:e},humanStep:{type:"human",prompt:e}}}if("helpMeDraft"===t.key){const e=(null==r?void 0:r.prompt)??"";return{serverPrompt:{type:"helpMeDraft",prompt:e,previousContent:n,pageTitle:o},humanStep:{type:"human",prompt:e}}}if("todoList"===t.key||"outline"===t.key||"meetingAgenda"===t.key||"brainstormIdeas"===t.key||"prosConsList"===t.key||"socialMediaPost"===t.key||"pressRelease"===t.key||"creativeStory"===t.key||"poem"===t.key||"essay"===t.key||"blogPost"===t.key||"jobDescription"===t.key||"salesEmail"===t.key||"recruitingEmail"===t.key){const e=(null==r?void 0:r.topic)??"";return{serverPrompt:{type:t.key,topic:e,pageContent:a},humanStep:{type:"human",prompt:e}}}return"summarize"===t.key||"findActionItems"===t.key?{serverPrompt:{type:t.key,pageTitle:o,selectedText:a},humanStep:{type:"human",prompt:s}}:void 0}async function Ke(e,t){let o;const n=R.ZE();if(n.debug)o=402!==n.showErrorCode;else{const n=await k.getAIUsageEligibility(e,{spaceId:t});"success"===n.type&&(o=n.data.isEligible,oe.Z.setState(n.data))}return void 0!==o&&re.Z.setState(o),o}async function Ye(e){const{environment:t,revision:o,type:n,userContent:i,shareWithNotion:r,userOptIn:a}=e;if(Y.Z.isAssistant2Enabled(void 0)){const{assistantActions:e}=await V.deps.assistant.loader(),o=G.Z.getActiveSessionId();if(!o)throw new Error("No assistantSessionId.");e.saveFeedback({environment:t,inferenceId:"",type:"thumbsup"===n?"assistant_thumbs_up":"assistant_thumbs_down",sessionId:o,userComment:i,shareWithNotion:r,userOptIn:a})}else{const e=X.default.state;if(!o.inferenceId||"completionPopup"!==e.type||"results"!==e.stage)return;C.NF$(t,{type:"cursor_completion",inference_id:o.inferenceId,feedback_type:n,timestamp:(new Date).toUTCString(),user_comment:i,share_with_notion:r,user_opt_in:a}),X.default.setState({...e,revisions:e.revisions.map((e=>e.inferenceId===o.inferenceId?{...e,hasFeedback:!0}:e))})}}function Ge(e,t){const o=X.default.state;"completionPopup"===o.type&&"initialPromptForAIBlock"===o.stage&&T.createAndCommit({userAction:"completionActions.updatePromptForCurrentAiBlock",environment:e,perform:e=>{T.applyOperation({store:o.store,operation:d.op.set({pointer:o.store.pointer,path:["properties","title"],args:(0,y.TPx)(t)}),transaction:e})}})}},99417:(e,t,o)=>{o.d(t,{Ah:()=>Q,Dr:()=>Z,HS:()=>re,Iz:()=>te,L3:()=>W,LN:()=>V,Mh:()=>K,NX:()=>q,OE:()=>O,PD:()=>_,dU:()=>se,gY:()=>ie,pv:()=>Y,sB:()=>X,sr:()=>ne,t8:()=>z,up:()=>$,wA:()=>J,wq:()=>H,xM:()=>oe,zU:()=>ae});o(57658),o(21703);var n=o(14577),i=o(87205),r=(o(99036),o(8848)),a=o(30579),s=o(41886),l=o(27245),c=o(52897),d=o(7500),p=o(31157),u=o(88607),m=o(25879),f=o(12970),g=o(91856),y=o(20669),h=o(25651),v=o(11751),C=o(72050),k=o(72126),x=o(97880),w=o(68939),S=(o(95477),o(43250)),P=o(95802),M=o(21273),I=o(16772),b=o(77080),A=o(26136),F=o(78663),T=o(19124),L=o(33929);function _(){return R()?"openai-2":N()?"anthropic-3":"default"}function W(){return R()||N()}function R(){return(0,T.GD)(void 0)&&E.state}const E=new n.Z((()=>b.default.checkGate("model-2")||b.default.checkGate("model-2-space")),{debugName:"inModel2Group"});function N(){return(0,T.GD)(void 0)&&B.state}const B=new n.Z((()=>b.default.checkGate("model-3")||b.default.checkGate("model-3-space")),{debugName:"inModel3Group"});const Z=(0,w.defineMessages)({writeWithAI:{defaultMessage:"Write with AI",id:"id.completions.writeWithAI"},draftWithAI:{defaultMessage:"Draft with AI",id:"id.completions.draftWithAI"},extractFromSelection:{defaultMessage:"Generate from selection",id:"id.completions.extractFromSelection"},extractFromPage:{defaultMessage:"Generate from page",id:"id.completions.extractFromPage"},editSelection:{defaultMessage:"Edit or review selection",id:"id.completions.editSelection"},editPage:{defaultMessage:"Edit or review page",id:"id.completions.editPage"},aiBlocks:{defaultMessage:"Insert AI blocks",id:"id.completions.aiBlocks"},helpMeEdit:{defaultMessage:"Ask AI to edit...",id:"id.completions.helpMeEdit"},askAI:{defaultMessage:"Ask AI",id:"id.completions.askAI"},genericHelpMeEdit:{defaultMessage:"{filter}",id:"id.completions.genericHelpMeEdit"},genericHelpMeWrite:{defaultMessage:"{filter}",id:"id.completions.genericHelpMeWrite"},continueWriting:{defaultMessage:"Continue writing",id:"id.completions.continueWriting"},brainstormIdeas:{defaultMessage:"Brainstorm ideas",id:"id.completions.brainstormIdeas"},brainstormIdeasTopic:{defaultMessage:'What do you want to brainstorm ideas about?\nFor example, "creative name ideas for a pirate themed party game"',id:"id.completions.Topic"},summarize:{defaultMessage:"Summarize",id:"id.completions.summarize"},translate:{defaultMessage:"Translate",id:"id.completions.translate"},translateLanguage:{defaultMessage:"Select language",id:"id.completions.translateLanguage"},blogPost:{defaultMessage:"Blog post",id:"id.completions.blogPost"},blogPostTopicPlaceholder:{defaultMessage:'What should the blog post be about?\nFor example, "the benefits of practicing mindfulness and meditation"',id:"id.completions.blogPost.blogPostTopic.placeholder"},blogPostGenerate:{defaultMessage:"Generate post",id:"id.completions.blogPost.generate"},prosConsList:{defaultMessage:"Pros and cons list",id:"id.completions.prosConsList"},prosConsListPlaceholder:{defaultMessage:'What do you want to make a pros and cons list about?\nFor example, "learning a new language for the first time"',id:"id.completions.prosConsListPlaceholder"},socialMediaPostPlaceholder:{defaultMessage:'What do you want to make a social media post about?\nFor example, "tips and tricks for changing careers"',id:"id.completions.socialMediaPostPlaceholder"},outlinePlaceholder:{defaultMessage:'What do you want to make an outline for?\nFor example, "a detailed step-by-step process for getting into university"',id:"id.completions.outlinePlaceholder"},creativeStoryPlaceholder:{defaultMessage:'What do you want to write a story about?\nFor example, "suzy discovers a magical secret room only she can see"',id:"id.completions.creativeStoryPlaceholder"},poemPlaceholder:{defaultMessage:'What do you want to write a poem about?\nFor example, "a whimsical poem about finding meaning in ordinary things"',id:"id.completions.poemPlaceholder"},essayPlaceholder:{defaultMessage:'What do you want to write an essay about?\nFor example, "how a chaotic environment can actually improve focus"',id:"id.completions.essayPlaceholder"},todoListPlaceholder:{defaultMessage:'What do you want to make a to-do list about?\nFor example, "creating a new board game"',id:"id.completions.todoListPlaceholder"},meetingAgendaPlaceholder:{defaultMessage:'What is the purpose of the meeting?\nFor example, "alignment on pricing for new product"',id:"id.completions.meetingAgendaPlaceholder"},pressReleasePlaceholder:{defaultMessage:'What should the press release be about?\nFor example, "product launch for new mind-reading app for pets"',id:"id.completions.pressReleasePlaceholder"},jobDescriptionPlaceholder:{defaultMessage:'What job do you want to write a description about?\nFor example, "data engineer at Notion, needs Postgres experience"',id:"id.completions.jobDescriptionPlaceholder"},salesEmailPlaceholder:{defaultMessage:'What product are you selling?\nFor example, "email for a head of operations about a new brain boosting supplement"',id:"id.completions.salesEmailPlaceholder"},recruitingEmailPlaceholder:{defaultMessage:'Who are you trying to recruit?\nFor example, "experienced frontend engineer for our new social mindfulness app"',id:"id.completions.recruitingEmailPlaceholder"},helpMeEditPlaceholder:{defaultMessage:'How would you like to edit this text?\nFor example, "Summarize in one sentence"',id:"id.completions.helpMeEditPlaceholder"},improveWriting:{defaultMessage:"Improve writing",id:"id.completions.improveWriting"},fixSpellingGrammar:{defaultMessage:"Fix spelling & grammar",id:"id.completions.fixSpellingGrammar"},explainThis:{defaultMessage:"Explain this",id:"id.completions.explainThis"},makeLonger:{defaultMessage:"Make longer",id:"id.completions.makeLonger"},findActionItems:{defaultMessage:"Find action items",id:"id.completions.findActionItems"},makeShorter:{defaultMessage:"Make shorter",id:"id.completions.makeShorter"},simplifyLanguage:{defaultMessage:"Simplify language",id:"id.completions.simplifyLanguage"},changeTone:{defaultMessage:"Change tone",id:"id.completions.changeTone"},changeToneType:{defaultMessage:"Select tone",id:"id.completions.changeToneType"},socialMediaPost:{defaultMessage:"Social media post",id:"id.completions.socialMediaPost"},cleanUpFormatting:{defaultMessage:"Clean up formatting",id:"id.completions.cleanUpFormatting"},outline:{defaultMessage:"Outline",id:"id.completions.outline"},creativeStory:{defaultMessage:"Creative story",id:"id.completions.creativeStory"},poem:{defaultMessage:"Poem",id:"id.completions.poem"},essay:{defaultMessage:"Essay",id:"id.completions.essay"},todoList:{defaultMessage:"To-do list",id:"id.completions.todoList"},toDoListKeywords:{id:"id.completions.todoListKeywords",defaultMessage:"Todo To-Do List"},meetingAgenda:{defaultMessage:"Meeting agenda",id:"id.completions.meetingAgenda"},pressRelease:{defaultMessage:"Press release",id:"id.completions.pressRelease"},jobDescription:{defaultMessage:"Job description",id:"id.completions.jobDescription"},salesEmail:{defaultMessage:"Sales email",id:"id.completions.salesEmail"},recruitingEmail:{defaultMessage:"Recruiting email",id:"id.completions.recruitingEmail"},conclusion:{defaultMessage:"Conclusion",id:"id.completions.conclusion"},autofillSummary:{defaultMessage:"Summary",id:"id.completions.autofillSummary"},autofillTranslate:{defaultMessage:"Translate",id:"id.completions.autofillTranslate"},autofillExtract:{defaultMessage:"Key info",id:"id.completions.autofillExtract"},autofillCustom:{defaultMessage:"Custom autofill",id:"id.completions.autofillCustom"},insertAIBlock:{defaultMessage:"Insert as AI block",id:"id.completions.insertAIBlock"}}),O={text:{summarize:{name:Z.autofillSummary,svg:g.Y},translate:{name:Z.autofillTranslate,svg:u.Q},extract:{name:Z.autofillExtract,svg:C.A},custom:{name:Z.autofillCustom,svg:y.y}},select:{select:{name:Z.autofillCustom,svg:y.y}},multi_select:{select:{name:Z.autofillCustom,svg:y.y}}};const U=[T.eL,{key:"brainstormIdeas",category:"draftWithAI",name:Z.brainstormIdeas,svg:m.b,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.brainstormIdeasTopic,placeholder:Z.brainstormIdeasTopic,type:"text"}]},{key:"blogPost",category:"draftWithAI",name:Z.blogPost,generateName:Z.blogPostGenerate,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.blogPostTopicPlaceholder,placeholder:Z.blogPostTopicPlaceholder,type:"text"}]},{key:"outline",category:"draftWithAI",name:Z.outline,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.outlinePlaceholder,placeholder:Z.outlinePlaceholder,type:"text"}]},{key:"socialMediaPost",category:"draftWithAI",name:Z.socialMediaPost,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.socialMediaPostPlaceholder,placeholder:Z.socialMediaPostPlaceholder,type:"text"}]},{key:"pressRelease",category:"draftWithAI",name:Z.pressRelease,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.pressReleasePlaceholder,placeholder:Z.pressReleasePlaceholder,type:"text"}]},{key:"creativeStory",category:"draftWithAI",name:Z.creativeStory,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.creativeStoryPlaceholder,placeholder:Z.creativeStoryPlaceholder,type:"text"}]},{key:"essay",category:"draftWithAI",name:Z.essay,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.essayPlaceholder,placeholder:Z.essayPlaceholder,type:"text"}]},{key:"poem",category:"draftWithAI",name:Z.poem,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.poemPlaceholder,placeholder:Z.poemPlaceholder,type:"text"}]},{key:"todoList",category:"draftWithAI",name:Z.todoList,fuzzySearchKeywords:Z.toDoListKeywords,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.todoListPlaceholder,placeholder:Z.todoListPlaceholder,type:"text"}]},{key:"meetingAgenda",category:"draftWithAI",name:Z.meetingAgenda,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.meetingAgendaPlaceholder,placeholder:Z.meetingAgendaPlaceholder,type:"text"}]},{key:"prosConsList",category:"draftWithAI",name:Z.prosConsList,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.prosConsListPlaceholder,placeholder:Z.prosConsListPlaceholder,type:"text"}]},{key:"jobDescription",category:"draftWithAI",name:Z.jobDescription,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.jobDescriptionPlaceholder,placeholder:Z.jobDescriptionPlaceholder,type:"text"}]},{key:"salesEmail",category:"draftWithAI",name:Z.salesEmail,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.salesEmailPlaceholder,placeholder:Z.salesEmailPlaceholder,type:"text"}]},{key:"recruitingEmail",category:"draftWithAI",name:Z.recruitingEmail,svg:h.R,svgFill:r.FN.light.purple[400],steps:[{key:"topic",name:Z.recruitingEmailPlaceholder,placeholder:Z.recruitingEmailPlaceholder,type:"text"}]}],D=[T.It,{key:"continueWriting",category:"writeWithAI",name:Z.continueWriting,svg:h.R,svgFill:r.FN.light.purple[400],requiresContent:!0},{key:"summarize",category:"extractFromContent",name:Z.summarize,svg:g.Y,svgFill:r.FN.light.purple[400],requiresContent:!0},{key:"findActionItems",category:"extractFromContent",name:Z.findActionItems,svg:f.O,svgFill:r.FN.light.purple[400],requiresContent:!0}];function z(e){if("string"==typeof e.name)return e.name;return L.default.getIntl().formatMessage(e.name)}function H(e){for(const t of j()){const o=(0,F.$W)(t);if(o&&e.startsWith(o))return{prompt:t,additionalContext:{topic:e}}}}function*j(){for(const t of U){var e;1===(null===(e=t.steps)||void 0===e?void 0:e.length)&&"topic"===t.steps[0].key&&(yield t)}}function V(e,t){const o=e.trim().toLocaleLowerCase();for(const n of j()){if((0,F.$W)(n,t).trim().toLocaleLowerCase()===o)return!0}return!1}function $(e){if(M.Z.isAssistant2Enabled(void 0))return[];const t=[];return"cursor"===e.selectionType?e.isPageEmpty?t.push(...U):t.push(...D,...G,...U):t.push(...G,...D,...U),k.mN(t,(e=>e.key))}function K(e,t){switch(e){case"writeWithAI":return Z.writeWithAI;case"draftWithAI":return Z.draftWithAI;case"editContent":switch(t){case"page":return Z.editPage;case"selection":return Z.editSelection}break;case"extractFromContent":switch(t){case"page":return Z.extractFromPage;case"selection":return Z.extractFromSelection}}}function Y(e,t){const o={editContent:[],writeWithAI:[],draftWithAI:[],extractFromContent:[]};function n(e){return[e,o[e]]}for(const i of e)o[i.category].push(i);return"cursor"===t.selectionType?t.isPageEmpty?[n("draftWithAI"),n("writeWithAI")]:[n("writeWithAI"),n("extractFromContent"),n("editContent"),n("draftWithAI")]:[n("editContent"),n("extractFromContent"),n("writeWithAI"),n("draftWithAI")]}const G=[{key:"improveWriting",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:Z.improveWriting,svg:c.d,svgFill:r.FN.light.purple[400]},{key:"fixSpellingGrammar",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:Z.fixSpellingGrammar,svg:l.U,svgFill:r.FN.light.purple[400]},{key:"summarize",category:"extractFromContent",name:Z.summarize,svg:g.Y,svgFill:r.FN.light.purple[400]},{key:"translate",category:"extractFromContent",name:Z.translate,svg:u.Q,svgFill:r.FN.light.purple[400],generateName:Z.translate,regenerateName:Z.translate,steps:[{key:"language",name:Z.translateLanguage,type:"dropdown",dropdownOptions:i.nI}]},{key:"explainThis",category:"extractFromContent",name:Z.explainThis,svg:s.y,svgFill:r.FN.light.purple[400]},{key:"makeShorter",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:Z.makeShorter,svg:p.f,svgFill:r.FN.light.purple[400]},{key:"makeLonger",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:Z.makeLonger,svg:d.H,svgFill:r.FN.light.purple[400]},{key:"findActionItems",category:"extractFromContent",name:Z.findActionItems,svg:f.O,svgFill:r.FN.light.purple[400]},{key:"changeTone",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:Z.changeTone,svg:a.p,svgFill:r.FN.light.purple[400],generateName:Z.changeTone,regenerateName:Z.changeTone,steps:[{key:"tone",name:Z.changeToneType,type:"dropdown",dropdownOptions:i.vK}]},{key:"simplifyLanguage",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:Z.simplifyLanguage,svg:v.t,svgFill:r.FN.light.purple[400]},{key:"helpMeEdit",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:Z.helpMeEdit,svg:c.d,svgFill:r.FN.light.purple[400],steps:[{key:"prompt",name:Z.helpMeEditPlaceholder,placeholder:Z.helpMeEditPlaceholder,type:"text"}]}];function X(e){return{key:"helpMeEdit",category:"editContent",preferToNeverInsertTextAtCursor:!0,name:Z.helpMeEdit,svg:c.d,svgFill:r.FN.light.purple[400],steps:[{key:"prompt",name:Z.helpMeEditPlaceholder,placeholder:Z.helpMeEditPlaceholder,type:"text",prefilledValue:e}]}}const q={key:"continueWriting",name:Z.continueWriting};function Q(e){let t=P.C.findNodeFromStore(e);if(t){if("table"===e.getType()){const e=t.querySelector(`.${S.euV}.notion-table-block`);t=e??t}return t.getBoundingClientRect()}}function J(e){const{origin:t}=e;return t instanceof A.G?Q(t):t instanceof HTMLElement?t.getBoundingClientRect():t}function ee(e){if(0===e.revisions.length)throw new Error("Assertion failure: no revisions exist")}function te(e){ee(e);for(const t of ae(e))if("initial"===t.type)return t;throw new Error("Assertion failure, initial revision does not exist")}function oe(e){return ee(e),e.revisions[e.revisions.length-1]}function ne(e){return"followup"===oe(e).type}function ie(e){return e.additionalContext&&(e.additionalContext.prompt||e.additionalContext.topic)||""}function re(e){if(0===e.revisions.length)throw new Error("Assertion failure, expected revisions to be non-empty");return e.revisions.length-1}function*ae(e){let t=re(e),o=0;for(;;){if(o+=1,o>1e4)throw new Error("Maximum iteration limit reached");const n=e.revisions[t];if(!n)throw new Error("Assertion failure, invalid revision index");if(yield n,"initial"===n.type)break;"followup"===n.type?t=n.previousRevision:(0,x.t1)(n)}}function se(){const e=I.default.state;return"completionPopup"===e.type&&"initialPromptForAIBlock"===e.stage&&!e.store.hasContent()}},96318:(e,t,o)=>{o.d(t,{SA:()=>g,ZE:()=>p,mw:()=>d});o(57658);var n=o(92595),i=o(29477),r=o(95477);let a=0;const s="clipboard",l={debug:Boolean(r.default.isDevelopingInAirplaneMode),responseText:s,showErrorCode:!1,delayBetweenChunks:20,chunkSize:5,numLoremIpsums:3},c="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec porta auctor sem vel efficitur. Vivamus efficitur eros sed erat efficitur efficitur. Vivamus et augue vel est efficitur efficitur.";function d(){return l.debug}function p(){return l}function u(e){return{async*[Symbol.asyncIterator](){for(const t of e)await(0,i.Vs)(l.delayBetweenChunks),yield t}}}function m(e,t){const o=Math.ceil(e.length/t),n=new Array(o);for(let i=0,r=0;i<o;++i,r+=t)n[i]=e.substr(r,t);return n}function f(e){return e.map((e=>({type:"success",completion:e,inferenceId:"mock"})))}const g=async(e,t)=>{console.log("Retrieving fake completion for data",t);const{context:o}=t,n=o.selectedText,i=[];let{responseText:d}=l;if(d===s&&(d=await async function(){try{return await navigator.clipboard.readText()}catch(e){return}}()??"Unable to retrieve clipboard text."),void 0===d&&(i.push({type:"success",completion:"\n",inferenceId:"mock"},{type:"success",completion:"this is ",inferenceId:"mock"},{type:"success",completion:"fake ",inferenceId:"mock"},{type:"success",completion:`streaming response ${a++}.`,inferenceId:"mock"}),r.default.isDevelopingInAirplaneMode&&i.push({type:"success",completion:"\n\nTo see a real AI response, run the server with `--airplaneMode=false`.",inferenceId:"mock"}),"string"==typeof n)){i.push({type:"success",completion:"\n\nHere is the text you selected:\n\n",inferenceId:"mock"});for(const e of m(n,l.chunkSize))i.push({type:"success",completion:e,inferenceId:"mock"})}if(l.showErrorCode)i.push({type:"error",message:"alas",errorCode:l.showErrorCode});else if(void 0===d)for(let r=0;r<l.numLoremIpsums;r++)i.push(...f([`\n\n${r+1}. `,...m(c,0===l.delayBetweenChunks?c.length:l.chunkSize)]));else if(d.length>0){const e=m(d,l.chunkSize);i.push(...f(e))}return Promise.resolve({type:"success",data:u(i),status:200,headers:{}})};(0,n.exposeDebugValue)("completionDebugSettings",l)},43455:(e,t,o)=>{o.d(t,{$A:()=>v,Ie:()=>S,KF:()=>y,N9:()=>w});o(57658);var n=o(40591),i=o.n(n),r=o(41432),a=o(19531),s=o(22808),l=o(25718),c=o(19889),d=o(70203),p=o(7928),u=o(33929),m=o(83089);function f(e,t){return(0,p.Nz)(e,t).replace(/ /g,"")}const g=(e,t)=>{const{getRecordValue:o,intl:n}=t;let i;if(d.IWo(e)){const t=d.zEN(e);i=`@${f(n,o({table:c.KJ,id:t}))}`}else if(d.fpG(e)){i=d.zyO(e).start_date}return i};function y(){let e=0,t=0;function o(o){e+=1,e>t&&(t=e);try{return l.Lk(o)}finally{e-=1}}function n(){return":".repeat(t-e+2)}return{transformAnnotation:g,transformBlockMapping:{callout(e){var t;const{block:i,exportArgs:r}=e,a=l.WB({block:i,exportArgs:r}),c=null===(t=i.format)||void 0===t?void 0:t.page_icon,d=(0,s.Z)(c)?c:"",p=o(e),u=n();return{text:`${u} aside ${d}\n\n${a}`.trim(),breakLines:!0,children:p,suffix:u}},toggle(e){const{block:t,exportArgs:i}=e,r=l.WB({block:t,exportArgs:i}),a=o(e),s=n();return{text:`${s} â–¶ ${r}\n\n`.trim(),breakLines:!0,children:a,suffix:s}}}}}const h=(0,m.V9)({unicode:()=>/@\p{Letter}+/gu,fallback:/@[A-Za-z]+/g});async function v(e,t,o){const n=e.matchAll(h),i=[];for(const r of n){const e=r[0].slice(1);if(void 0===o.get(e)){const n=async()=>{const n=await C(t,e);n?(n.email,o.set(e,n)):o.set(e,null)};i.push(n())}}await Promise.all(i)}async function C(e,t){const o=await e(t),n=u.default.getIntl();let i;for(const r of o){if(f(n,r)===t){if(i)return;i=r}}return i}function k(e){const{md:t,name:o,regex:n,createTokens:i}=e,{arrayReplaceAt:r}=t.utils;function a(e,t,r){let a=0;const s=[];if(e.replace(n,(function(n){const l=Array.from(arguments);let c=l.length-1;"string"!=typeof l[c]&&(c-=1);const d=l[c],p=l[c-1];if(p>0&&(0,m.D_)(d[p-1]))return"";if(p+n.length<d.length&&(0,m.D_)(d[p+n.length]))return"";const u=i(n,t);if(!u)return"";if(p>a){const t=new r("text","",0);t.content=e.slice(a,p),s.push(t)}for(const{type:e,attrs:t,tag:i,level:a,content:m}of u){const n=new r(e,"",0);if(t)for(const[e,o]of Object.entries(t))n.attrPush([e,o]);i&&(n.tag=i,n.markup=o),void 0!==a&&(n.level=a),m&&(n.content=m),s.push(n)}return a=p+n.length,""})),a<e.length){const t=new r("text","",0);t.content=e.slice(a),s.push(t)}return s}t.core.ruler.after("linkify",o,(e=>{let t=0;const o=e.tokens;for(let i=0;i<o.length;i++){const s=o[i].children;if("inline"===o[i].type&&s)for(let l=s.length-1;l>=0;l--){const c=s[l];"link_open"!==c.type&&"link_close"!==c.type||"auto"===c.info&&(t-=c.nesting),"text"===c.type&&0===t&&n.test(c.content)&&(o[i].children=r(s,l,a(c.content,c.level,e.Token)))}}return!0}))}function x(e){return t=>{!function(e){k({md:e,name:"date_mentions",regex:/20\d\d-\d\d-\d\d/g,createTokens:(e,t)=>[{type:"date_mention_open",tag:"time",attrs:{datetime:e,[a.KD.dateFormat]:"relative"},level:t+1},{type:"text",content:e},{type:"date_mention_close",tag:"/time",level:t}]})}(t),function(e,t){k({md:e,name:"user_mentions",regex:h,createTokens(e,o){const n=e.slice(1),i=t.get(n);if(i)return[{type:"user_mention_open",tag:"a",level:o+1,attrs:{[a.KD[d.GKr.User]]:i.id}},{type:"text",content:e},{type:"user_mention_close",tag:"/a",level:o}]}})}(t,e),function(e){const t=/^aside\s+(.*)$/,o={validate:e=>Boolean(e.trim().match(t)),render(o,n){if(1===o[n].nesting){const i=o[n].info.trim().match(t);let l=(null==i?void 0:i[1])??"";(0,s.Z)(l)||(l="");const c="gray_background";return`<div ${function(e,t){const o=[];for(const[n,i]of t)o.push(`${n}="${e.utils.escapeHtml(i)}"`);return o.join(" ")}(e,[[a.KD[r.Ti.callout],""],[a.KD.calloutBackground,c],[a.KD.calloutIcon,l]])}>`}return"</div>"}};e.use(i(),"callout_block",o)}(t),function(e){const t=/^â–¶\s+(.*)$/,o={validate:e=>Boolean(e.trim().match(t)),render(o,n){if(1===o[n].nesting){const i=o[n].info.trim().match(t),r=(null==i?void 0:i[1])??"";return`<details><summary>${e.utils.escapeHtml(r)}</summary>`}return"</details>"}};e.use(i(),"toggle_block",o)}(t)}}function w(e){return{plugin:x(e)}}function S(e){return/\[.+\]\([^)]*$/.test(e)}},83089:(e,t,o)=>{function n(e){const{unicode:t,fallback:o}=e;try{return t()}catch(n){return o}}o.d(t,{D_:()=>r,Ff:()=>i,V9:()=>n});const i=n({unicode:()=>/\p{L}/u,fallback:/[a-zA-Z]/});function r(e){return i.test(e)}},44041:(e,t,o)=>{o.d(t,{y:()=>S});o(67294);var n=o(94919),i=o(47425),r=o(97880),a=o(68939),s=o(50906),l=o(47307),c=o(33929),d=o(52533),p=o(80444),u=o(92083),m=o(78291),f=o(39343),g=o(70060),y=o(88893),h=o(35057),v=o(33493),C=o(22616),k=o(34583),x=o(64891),w=o(85893);const S=async function(e,t){var o;s.sA6(e,{from:t.from,for_subscription_tier:t.for,addOnFeature:t.addOnFeature});if((0,h.QM)()&&["block_limit_sidebar","block_limit_settings","block_limit_banner"].includes(t.from)&&!t.addOnFeature&&(0,g.XA)(e))return void u.Z.setState({open:!0,openedFrom:"upsell",currentTab:"plans",defaultSubtab:void 0,highlightedSetting:void 0});function S(){t.dontOpenPlansOnCancel||u.Z.setState({open:!0,openedFrom:"upsell",currentTab:"plans",defaultSubtab:void 0,highlightedSetting:void 0})}if(!t.addOnFeature&&(0,i.QM)(t.for))return;const P=(0,d.S$)({environment:e})&&"personal"===t.for;if(e.device.isMobileNative){if("ai"===t.addOnFeature){const t=(0,d.Y2)({environment:e})?(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.noIAPForAIWithExternalPurchaseOption",defaultMessage:"This workspace has used all of its free AI responses. Visit on desktop to purchase Notion AI and go unlimited."}):(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.noIAPForAIWithoutExternalPurchaseOption",defaultMessage:"This workspace has used all of its free AI responses. Unfortunately, additional AI responses cannot be purchased on this platform."});return void l.showErrorMessage(t)}if(!P)return}const M=p.default.state.currentSpaceStore;if(!M)return;if(!M.canAdmin())return;await k.bi(e);const I=m.default.state.data;if(!I)return;if("unsubscribed_admin"!==I.type&&"subscribed_admin"!==I.type)return void S();if(y.Q6(I)){const e=(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.referToSalesRep",defaultMessage:"This workspace is part of a managed account. Please contact your account representative to discuss any changes to your subscription."});return void l.showErrorMessage(e)}if(P)return void(e.mobileNative&&M.id&&e.mobileNative.openUpgradeModal(M.id));if("revenueCat"===(null===(o=I.customerData)||void 0===o?void 0:o.activeSubscriptionPlatform)){const e=(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.switchPlanFromInAppPurchase",defaultMessage:"You're currently subscribed through an in-app purchase with Apple. To switch plans, cancel your subscription with Apple first."});return void l.showErrorMessage(e)}const b=y.XX(I);if(t.addOnFeature&&(0,f.Fk)(b)){const e=(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.noAddOnPurchaseDuringFreeTrial",defaultMessage:"Unfortunately, additional {addOn, select, ai {AI responses} other {features}} cannot be purchased while a workspace is on a free trial.",values:{addOn:t.addOnFeature}});l.showErrorMessage(e)}else if(b&&y.MM(I)){if(t.addOnFeature)return void x.af({environment:e,from:t.from,view:"add_ons",addOnFeature:t.addOnFeature,billingInterval:b.interval,pageSection:t.pageSection});C.Zz({environment:e,spaceId:M.id});const{status:o,prices:s}=v.Z.state;if("ready"!==o)return;const{interval:d}=b,p=s.find((e=>e.product===t.for&&e.billingInterval===d&&e.currencyCode===b.currencyCode));if(void 0===p)return;const u=function(e){let{price:t,isSubscribed:o}=e;if(t.isAddOn())return null;const s=t.product;if((0,i.QM)(s)||(0,i.iJ)(s))return null;const l={tier:s,price:(0,w.jsx)(n.W,{cost:t.getMonthlyUnitCost(),trailingZeroDisplay:"stripIfInteger",intl:c.default.intl}),br:(0,w.jsx)("br",{}),isSubscribed:o};if((0,h.Aw)())switch(s){case"personal":return(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.confirmProration.personalMessage.fromSinglePlayerPlus",defaultMessage:"You are about to subscribe to Notionâ€™s Personal Plan for {price} per member per month.{br}You will lose your current discounted price, and will be charged a prorated amount, minus any account balance.",values:l});case"plus":return(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.confirmProration.plusMessage.fromSinglePlayerPlus",defaultMessage:"You are about to subscribe to Notionâ€™s Plus Plan with no member limit for {price} per member per month.{br}You will lose your current discounted price, and will be charged a prorated amount, minus any account balance.",values:l});case"business":return(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.confirmProration.businessMessage.fromSinglePlayerPlus",defaultMessage:"You are about to subscribe to Notionâ€™s Business Plan for {price} per member per month.{br}You will lose your current discounted price, and will be charged a prorated amount, minus any account balance.",values:l});case"enterprise":return(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.confirmProration.enterpriseMessage.fromSinglePlayerPlus",defaultMessage:"You are about to subscribe to Notionâ€™s Enterprise Plan for {price} per member per month.{br}You will lose your current discounted price, and will be charged a prorated amount, minus any account balance.",values:l});default:return(0,r.t1)(s)}switch(s){case"personal":return(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.confirmProration.personalMessage",defaultMessage:"You are about to subscribe to Notionâ€™s Personal Plan for {price} per member per month.{br}{isSubscribed, select, true {You will be charged a prorated amount, minus any account balance.} other {}}",values:l});case"plus":return(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.confirmProration.plusMessage",defaultMessage:"You are about to subscribe to Notionâ€™s Plus Plan for {price} per member per month.{br}{isSubscribed, select, true {You will be charged a prorated amount, minus any account balance.} other {}}",values:l});case"business":return(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.confirmProration.businessMessage",defaultMessage:"You are about to subscribe to Notionâ€™s Business Plan for {price} per member per month.{br}{isSubscribed, select, true {You will be charged a prorated amount, minus any account balance.} other {}}",values:l});case"enterprise":return(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.confirmProration.enterpriseMessage",defaultMessage:"You are about to subscribe to Notionâ€™s Enterprise Plan for {price} per member per month.{br}{isSubscribed, select, true {You will be charged a prorated amount, minus any account balance.} other {}}",values:l});default:return(0,r.t1)(s)}}({price:p,isSubscribed:void 0===b.canceledAt});if(!(await l.confirmUserAction({message:u,acceptLabel:(0,w.jsx)(a.FormattedMessage,{id:"upsellActions.confirmProration.acceptLabel",defaultMessage:"Upgrade to {plan, select, personal {Personal} team {Plus} plus {Plus} business {Business} other {Enterprise}}",values:{plan:t.for}})})))return void S();const m=null==p?void 0:p.externalId;await k.Mg({environment:e,spaceStore:M,plan:m,from:"upsell_modal"})}else{const o=(0,g.px)(e,t.for)?"ai_fifty_percent":void 0;k.I0(e,{subscriptionTier:t.for,from:t.from,addOnFeature:t.addOnFeature,coupon:o,isTrial:t.isTrial})}}},28956:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(49085);class i extends n.default{getInitialState(){}}const r=new i},39343:(e,t,o)=>{o.d(t,{Fk:()=>a,nx:()=>s});var n=o(30120),i=o(13991),r=o(7057);function a(e){return!(null==e||!e.trialEnd)&&e.trialEnd>=n.ou.now().toSeconds()}function s(e){const t=function(e){if(!a(e))return;const t=1e3*(null==e?void 0:e.trialEnd);return null!=e&&e.periodEnd&&e.periodEnd>=n.ou.now().toSeconds()&&e.periodEnd<t?e.periodEnd:t}(e);return t?(0,r.Yx)(t,"long",i.SP):void 0}},94919:(e,t,o)=>{o.d(t,{W:()=>r});o(67294);var n=o(31919),i=o(85893);function r(e){const{cost:t,intl:o}=e,r=e.trailingZeroDisplay??"auto",a=e.currencySign??"accounting",s=n.n.fromValue(t);let l=o.formatNumber(s.amount/Math.pow(10,s.currencyValue.minorUnitDigits),{style:"currency",currency:s.currencyCode,currencyDisplay:"symbol",currencySign:a});return"stripIfInteger"===r&&(l=l.replace(new RegExp(`[.,]0{${s.currencyValue.minorUnitDigits}}(\\s+.*)?$`),"$1")),(0,i.jsx)(i.Fragment,{children:l})}},30579:(e,t,o)=>{o.d(t,{p:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("aiChangeTone",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M10.0371 1.67969L14.0293 5.67188C15.2529 4.46875 15.3486 2.82812 14.1113 1.59766C12.8809 0.374023 11.2471 0.456055 10.0371 1.67969ZM8.16406 14.9482C8.58105 14.9482 8.90918 14.627 8.90918 14.21L8.92285 9.26758L10.9189 7.41504C11.7256 7.49023 12.5527 7.15527 13.25 6.44434L9.26465 2.45215C8.55371 3.15625 8.23242 3.96973 8.31445 4.7832L1.97754 11.5918C1.69043 11.8994 1.66992 12.2822 2.00488 12.6719L1.08203 13.8408C0.958984 13.998 0.972656 14.2236 1.12988 14.3809L1.32812 14.5859C1.48535 14.7432 1.7041 14.7568 1.88184 14.6201L3.04395 13.6973C3.42676 14.0391 3.81641 14.0117 4.11719 13.7314L7.42578 10.6621V14.21C7.42578 14.627 7.75391 14.9482 8.16406 14.9482ZM2.90723 12.1934L8.7793 6.03418C8.88867 6.21191 9.01855 6.37598 9.16895 6.5332C9.32617 6.69727 9.49023 6.83398 9.6543 6.94336L3.51562 12.8086L2.90723 12.1934Z"})})},41886:(e,t,o)=>{o.d(t,{y:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("aiExplainThis",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M7.61035 10.7373C8.19824 10.7373 8.55371 10.4229 8.64941 9.89648C8.64941 9.84863 8.66309 9.78027 8.66309 9.73242C8.74512 9.01465 9.0459 8.69336 10.1807 7.98926C11.4248 7.20312 12.0947 6.31445 12.0947 5.01562C12.0947 2.89648 10.3652 1.61816 7.95898 1.61816C6.1748 1.61816 4.73926 2.35645 4.14453 3.55957C3.98047 3.88086 3.90527 4.21582 3.90527 4.53027C3.89844 5.15234 4.30176 5.56934 4.96484 5.56934C5.46387 5.56934 5.86719 5.30957 6.05176 4.8584C6.36621 3.92188 7.00195 3.55273 7.84961 3.55273C8.85449 3.55273 9.64062 4.14746 9.64062 5.0498C9.64062 5.9043 9.17578 6.3418 8.13672 6.99805C7.15918 7.63379 6.49609 8.33105 6.49609 9.39062V9.64355C6.49609 10.293 6.93359 10.7373 7.61035 10.7373ZM7.6377 14.6611C8.39648 14.6611 9.01855 14.0732 9.01855 13.3281C9.01855 12.5898 8.39648 12.002 7.6377 12.002C6.87207 12.002 6.25684 12.5898 6.25684 13.3281C6.25684 14.0732 6.87207 14.6611 7.6377 14.6611Z"})})},27245:(e,t,o)=>{o.d(t,{U:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("aiFixSpellingGrammar",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M6.6123 14.2646C7.07715 14.2646 7.43945 14.0869 7.68555 13.7109L14.0566 3.96973C14.2344 3.69629 14.3096 3.44336 14.3096 3.2041C14.3096 2.56152 13.8311 2.09668 13.1748 2.09668C12.7236 2.09668 12.4434 2.26074 12.1699 2.69141L6.57812 11.5098L3.74121 7.98926C3.48828 7.68848 3.21484 7.55176 2.83203 7.55176C2.16895 7.55176 1.69043 8.02344 1.69043 8.66602C1.69043 8.95312 1.7793 9.20605 2.02539 9.48633L5.55273 13.7588C5.84668 14.1074 6.1748 14.2646 6.6123 14.2646Z"})})},7500:(e,t,o)=>{o.d(t,{H:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("aiMakeLonger",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M1.45117 3.38184H14.542C14.9795 3.38184 15.3281 3.00586 15.3281 2.5752C15.3281 2.13086 14.9863 1.77539 14.542 1.77539H1.45117C1.00684 1.77539 0.665039 2.14453 0.665039 2.5752C0.665039 2.99902 1.01367 3.38184 1.45117 3.38184ZM1.45117 6.96387H14.542C14.9795 6.96387 15.3281 6.58789 15.3281 6.15723C15.3281 5.71973 14.9863 5.35742 14.542 5.35742H1.45117C1.00684 5.35742 0.665039 5.72656 0.665039 6.15723C0.665039 6.58105 1.01367 6.96387 1.45117 6.96387ZM1.45117 10.5527H14.542C14.9795 10.5527 15.3281 10.1768 15.3281 9.74609C15.3281 9.30176 14.9863 8.94629 14.542 8.94629H1.45117C1.00684 8.94629 0.665039 9.31543 0.665039 9.74609C0.665039 10.1699 1.01367 10.5527 1.45117 10.5527ZM1.45117 14.1348H8.44434C8.88184 14.1348 9.23047 13.7588 9.23047 13.3281C9.23047 12.8906 8.88867 12.5283 8.44434 12.5283H1.45117C1.00684 12.5283 0.665039 12.8975 0.665039 13.3281C0.665039 13.752 1.01367 14.1348 1.45117 14.1348Z"})})},31157:(e,t,o)=>{o.d(t,{f:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("aiMakeShorter",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M1.4502 7.01221H14.541C14.9785 7.01221 15.3271 6.63623 15.3271 6.20557C15.3271 5.76123 14.9854 5.40576 14.541 5.40576H1.4502C1.00586 5.40576 0.664062 5.7749 0.664062 6.20557C0.664062 6.62939 1.0127 7.01221 1.4502 7.01221ZM1.4502 10.5942H8.44336C8.88086 10.5942 9.22949 10.2183 9.22949 9.7876C9.22949 9.3501 8.8877 8.98779 8.44336 8.98779H1.4502C1.00586 8.98779 0.664062 9.35693 0.664062 9.7876C0.664062 10.2114 1.0127 10.5942 1.4502 10.5942Z"})})},25879:(e,t,o)=>{o.d(t,{b:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("assistBrainstormIdeas",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M3.37915 4.3186C3.37915 6.77734 4.81616 7.63428 5.17212 11.7607C5.20508 12.2024 5.48853 12.4661 5.93018 12.4661H10.0632C10.5049 12.4661 10.7883 12.2024 10.8213 11.7607C11.1772 7.63428 12.6208 6.78394 12.6208 4.3186C12.6208 1.88623 10.5444 0.0471191 7.99341 0.0471191C5.44897 0.0471191 3.37915 1.87964 3.37915 4.3186ZM4.80957 4.3186C4.80957 2.64429 6.27295 1.47754 7.99341 1.47754C9.72046 1.47754 11.1904 2.64429 11.1904 4.3186C11.1904 5.95337 10.0369 6.46753 9.50952 11.0356H6.48389C5.95654 6.46753 4.80957 5.95337 4.80957 4.3186ZM5.8313 14.1799H10.1621C10.439 14.1799 10.6565 13.9492 10.6565 13.6921C10.6565 13.4285 10.439 13.2043 10.1621 13.2043H5.8313C5.55444 13.2043 5.33691 13.4285 5.33691 13.6921C5.33691 13.9492 5.55444 14.1799 5.8313 14.1799ZM7.99341 16.2168C9.08105 16.2168 9.90503 15.7026 9.97754 14.9182H5.99609C6.06201 15.7026 6.91235 16.2168 7.99341 16.2168Z"})})},83065:(e,t,o)=>{o.d(t,{_:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("sendArrow",{viewBox:"0 0 20 20",svg:(0,i.jsx)("path",{d:"M9.79883 18.5894C14.6216 18.5894 18.5894 14.6216 18.5894 9.79883C18.5894 4.96777 14.6216 1 9.79053 1C4.95947 1 1 4.96777 1 9.79883C1 14.6216 4.96777 18.5894 9.79883 18.5894ZM9.79883 14.3062C9.20947 14.3062 8.76953 13.9077 8.76953 13.3433V9.69922L8.86914 8.00586L8.25488 8.84424L7.3916 9.81543C7.23389 10.0063 6.98486 10.1143 6.72754 10.1143C6.21289 10.1143 5.84766 9.75732 5.84766 9.25928C5.84766 8.99365 5.92236 8.79443 6.12158 8.58691L8.96045 5.61523C9.19287 5.35791 9.4585 5.2417 9.79883 5.2417C10.1309 5.2417 10.4048 5.36621 10.6372 5.61523L13.4761 8.58691C13.667 8.79443 13.75 8.99365 13.75 9.25928C13.75 9.75732 13.3848 10.1143 12.8618 10.1143C12.6128 10.1143 12.3638 10.0063 12.2061 9.81543L11.3428 8.86914L10.7202 7.99756L10.8281 9.69922V13.3433C10.8281 13.9077 10.3799 14.3062 9.79883 14.3062Z"})})}}]);