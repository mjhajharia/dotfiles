"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[4063],{83692:(e,t,o)=>{o.d(t,{b:()=>h});var r=o(15145),i=o(50906),n=o(49865),s=o(14900),l=o(75018),a=o(24677),c=o(98104),d=o(75079),p=o(78316);function h(e){var t;const{transaction:o,environment:h,collectionContextStore:u,isFullScreen:m,groupsPointer:g,insertAtIndex:S,from:v,transient:y}=e,C=null===(t=u.groupsStore.getGroupState(g))||void 0===t?void 0:t.resultsStore;if(!C)return;u.searchQuery.state&&s.Ug({searchQuery:"",collectionContextStore:u,isFullScreen:m});const f=n.IW({environment:h,collectionContextStore:u,groupsPointer:g,insertAtIndex:S,coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:v});if(!f)return;const x=f.coercionSucceeded,b=f.newStore;if(h.device.isMobile)l.navigateToBlock({environment:h,store:b,pageVisitSource:r.tY.Create});else if(x){const e=b.getBlockTitleStore();a.eP({environment:h,store:b}),c.NX({store:e}),s.Z5({store:b,transient:y})}else l.peekBlock({environment:h,store:b,peekMode:(0,p.kr)(u.collectionViewStore()),resultsStore:C,collectionContextStore:u,pageVisitSource:r.tY.Create});i.W2j(h,{from:v,type:"page",new_page_id:b.id,...(0,d.Pn)(u)})}},8695:(e,t,o)=>{o.d(t,{H7:()=>s,Ut:()=>g,iN:()=>m,pT:()=>l,rd:()=>d,so:()=>c,ui:()=>a});o(21703),o(57658);var r=o(55010),i=o(6027),n=o(4926);function s(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.has(t)||r.state.containerMap.set(t,new Set),r.emit()}function l(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.delete(t),r.emit()}function a(e){const{element:t,container:o}=e,r=function(e){for(;;){const t=m(e);if(!t)return e;e=t}}(o),{store:i}=r.stores,{containerMap:n}=i.state,s=n.get(o);s?s.add(t):n.set(o,new Set([t])),i.emit()}function c(e){const{element:t,container:o}=e,{store:r}=o.stores,{containerMap:i}=r.state,n=i.get(o);n&&n.delete(t),r.emit()}function d(e){const{environment:t,container:o}=e,{device:s}=t,{store:l}=o.stores,{containerMap:a}=l.state,c=Array.from(a.keys()).sort(((e,t)=>{if(e.element&&t.element)return(0,r.Z)(e.element,t.element);throw new Error("Element not found")})),d=new Map;for(const m of c){const{element:e,scrollableAncestor:t}=m,o=a.get(m);if(!e||!t||!o)continue;const l=u(m).reduce(((e,t)=>e+(d.get(t)||0)),0),c=t.getBoundingClientRect(),S=e.getBoundingClientRect(),v=c.height,y=Math.floor(c.top-S.top),C=Math.floor(c.top+v-S.top),f=Math.floor(S.height)+(m.props.isFullScreen&&!s.isSafari?n.Z.state:0),x=Array.from(o.values()).sort(((e,t)=>{if(e.element&&t.element)return(0,r.Z)(e.element,t.element);throw new Error("Element not found")}));let b=l,w=0;for(const r of x){if(!r.element)continue;const e=r.element.getBoundingClientRect(),t=b+e.height;r.props.position===i.Z.Top&&(w+=e.height);const o=p(y,f,t,l),n=h(C,f,t,w);if(r.props.position===i.Z.Top){const e=0!==o,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;e?(r.element.style.transform=`translate3d(0, ${o}px, 0)`,r.element.style.bottom=""):(r.element.style.transform="",r.element.style.bottom=""),t&&g(r.element,t)}else{const e=0!==n,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;if(e?(r.element.style.transform=`translate3d(0, ${n}px, 0)`,r.element.style.top=""):(r.element.style.transform="",r.element.style.top=""),t)for(const o in t)r.element.style[o]=t[o]||""}b=t}d.set(m,b)}}function p(e,t,o,r){return e<-r||e>t?0:e>=t-o-1?t-o+r-1:e+r}function h(e,t,o,r){return e-r<0||e>t?0:e<o?o-t:e-t}function u(e){const t=[];for(;;){const o=m(e);if(!o)break;e=o,t.push(e)}return t}function m(e){if(e.context.computedStickyContainer&&!e.props.ignoreAncestorContainer)return e.context.computedStickyContainer}function g(e,t){for(const o in t)e.style[o]=t[o]||""}},984:(e,t,o)=>{o.d(t,{nA:()=>D,YJ:()=>Z,g1:()=>V,ay:()=>R,ZP:()=>H,v2:()=>E});o(67294);var r=o(83355),i=o(72126),n=o(70203),s=o(68939),l=o(50906),a=o(83692),c=o(49865),d=o(52989),p=o(24677),h=o(39699),u=o(43250),m=o(75079),g=o(92918),S=o(52821),v=o(30206),y=o(78316),C=o(12534),f=o(886),x=o(34583),b=o(47453),w=o(68785),k=o(89728),P=o(85893);class j extends r.Z{constructor(){super(...arguments),this.handleClick=()=>{const{collectionContextStore:e,isFullScreen:t,groupsPointer:o}=this.props;"collectionTypedView"!==e.contextType&&x.M_(this.environment)&&e.collectionStore()&&h.createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:this.environment,perform:r=>{a.b({transaction:r,environment:this.environment,collectionContextStore:e,isFullScreen:t,groupsPointer:o,from:"board_group_add_item_bottom",transient:!1})}})}}renderComponent(){const{shouldShowSpinner:e}=this.props,t=this.theme.lightTextColor;return(0,P.jsxs)(k.Z,{icon:e=>(0,b.R)({...e,fill:this.props.color||t}),isLightGray:!0,isLarge:!0,style:{width:"100%",color:this.props.color||t},onClick:this.handleClick,onMouseDown:C.$0,children:[(0,P.jsx)(s.FormattedMessage,{defaultMessage:"New",id:"database.boardView.addItemButtonTitle"}),e&&(0,P.jsx)("div",{style:{margin:"0 0 0 auto"},children:(0,P.jsx)(w.Z,{style:{width:12,height:12}})})]})}}j.displayName="BoardGroupAddItemButton";const T=j;var M=o(88046),F=o(34232),A=o(34575);function I(){window.__c={n:"BoardShimmer"};return(0,F.Z)(!0,0,100)?(0,P.jsx)(A.F,{}):null}var G=o(61838),B=o(25348),_=o(43145);const Z=34,R=5,D=5,V=5;function E(e){return e?8:12}class L extends r.Z{constructor(){super(...arguments),this.isReady=this.createComputedStore((()=>{const{groupsPointer:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);return Boolean(null==o?void 0:o.reducerResultStore.state)})),this.handleGroupMouseDown=e=>{const{device:t}=this.environment;t.isMobile||(0,C.ZP)({event:e,context:C.Af.EditorMouseDown,callback:()=>{e.preventDefault(),d.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleItemEnter=e=>{const{blocks:t,transaction:o}=e,{groupsPointer:r,collectionContextStore:i,isFullScreen:n}=this.props;if(0===t.length)return;const s=t[0];if(!x.M_(this.environment)||!i.collectionStore()||!i.shouldAllowNewItemCreation())return;const l=K(this.props.groupsPointer,this.props.collectionContextStore);if(!l)return;const c=l.state.findIndex((e=>e===s))+1;a.b({transaction:o,environment:this.environment,collectionContextStore:i,isFullScreen:n,groupsPointer:r,insertAtIndex:c,from:"board_group_enter_add_item",transient:!0})},this.handleItemTextEnter=e=>{const{groupsPointer:t,collectionContextStore:o,isFullScreen:r}=this.props;if(!x.M_(this.environment)||!o.collectionStore())return this.handleItemTextEsc(e);const i=K(this.props.groupsPointer,this.props.collectionContextStore);if(!i)return;const n=i.state.findIndex((t=>t===e))+1;h.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:this.environment,perform:e=>{a.b({transaction:e,environment:this.environment,collectionContextStore:o,isFullScreen:r,groupsPointer:t,insertAtIndex:n,from:"board_group_enter_add_item",transient:!0})}})},this.handleItemTextEsc=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore(),r=e.getTitleStore();if(!r)return;if(n.QaF(r.getValue()))p.Ys({environment:this.environment,store:e});else if(o){const{store:t,collectionContextStore:o}=this.props,r=K(this.props.groupsPointer,this.props.collectionContextStore);if(!r)return;const i=r.state.findIndex((t=>t===e))-1,n=o.collectionViewStore(),s=o.collectionViewBlockStore();if(n&&s&&l.sGw(this.environment,{...(0,m.Pn)(o),block_id:t.id}),h.createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:this.environment,perform:t=>{c.Od({store:e,transaction:t})}}),i>=0){const e=r.state[i];p.Ys({environment:this.environment,store:e})}}},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o,groupsPointer:r}=this.props,i=t.isLoading.state,n=t.groupsStore.getGroupState(r),s=null==n?void 0:n.reducerResultStore.state;e<f.Z.incrementScrollOffset&&!i&&s&&s.hasMore&&(c.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:r,incrementLimitsInRelatedGroups:!1}}),t.loadingDetails.setState({type:"load_general"}))},this.handleMouseMove=()=>{const e=i.Z$(this.props.groupsPointer);e&&this.props.hoveredGroupStore.state!==e&&this.props.hoveredGroupStore.setState(e)},this.colorStore=this.createComputedStore((()=>{const{groupsPointer:e,schema:t,format:o,collectionContextStore:r}=this.props,n=i.Z$(e);return(0,g.II)({environment:this.environment,groupFormat:n,schema:t,format:o,collectionContextStore:r,theme:this.theme})}),!0)}renderComponent(){var e;const{store:t,groupsPointer:o,collectionContextStore:r,disabled:i,format:n,schema:s,blockPropertyValueOverlayStore:l,isFullScreen:a,anyGroupHasResults:c}=this.props,d=r.groupsStore.getGroupState(o);if(!d)return;const p=this.isReady.state,h=function(e){return e?e.board_cover:void 0}(this.props.format),m=(0,y.az)(r,a),g=d.reducerResultStore.state,C=r.permissionScopes.state,f=!i&&p&&r.shouldAllowNewItemCreation(),x=!i&&!C.isSyncedCollection,b=(0,y.VM)({reducerResult:g,collectionContextStore:r,isFullScreen:a}),w=Boolean(n.collection_group_by),k=!c&&w&&(0,v.H0)({collectionContextStore:r,groupsPointer:o,hasPartialResults:c}),j=c&&r.shouldShowSpinner.state&&"load_general"===r.loadingDetails.state.type;return(0,P.jsxs)("div",{style:this.getStyle(),onMouseDown:this.handleGroupMouseDown,onClick:W,className:u.GfL,onMouseMove:this.handleMouseMove,children:[(0,P.jsx)(B.Z,{collectionContextStore:r,groupsPointer:o,format:n,canDrag:x,onSelectableEnter:this.handleItemEnter,resultProps:{format:n,schema:s,onTextEnter:this.handleItemTextEnter,onShiftEnter:this.handleItemEnter,coverFormat:h,coverAspectFormat:O(this.props.format),coverSizeFormat:z(this.props.format),shouldShowTitle:S.K8(this.props.format,"board"),colorStyle:this.colorStore.state,onTextEsc:this.handleItemTextEsc,disabled:i,blockPropertyValueOverlayStore:l,collectionContextStore:r},canDrop:!0,resultComponent:M.Z,disabled:i,direction:B.R.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:w?R:3,analyticsName:"board",loadContentCover:h&&"page_content"===h.type}),k&&(0,P.jsx)(I,{}),b&&(0,P.jsx)(G.ZP,{groupsPointer:o,store:t,collectionContextStore:r,format:n,isFullScreen:a,incrementLimitsInRelatedGroups:!0}),f&&(0,P.jsxs)(P.Fragment,{children:[b&&(0,P.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,P.jsx)(T,{groupsPointer:o,collectionContextStore:r,isFullScreen:a,color:null===(e=this.colorStore.state)||void 0===e?void 0:e.textColor,shouldShowSpinner:j})]}),!m&&(0,P.jsx)(_.Z,{onChange:this.handleScrollOffsetChange})]})}getStyle(){const{format:e}=this.props,t=this.isReady.state,o=this.colorStore.state,r=Boolean(e.collection_group_by);return{flex:"none",paddingLeft:R,paddingRight:R,paddingBottom:R,marginRight:2*V,boxSizing:"content-box",width:N(this.props.format),height:r?void 0:"max-content",...o&&t&&{backgroundColor:this.props.isInPeekRenderer?o.peekBackgroundColor:o.backgroundColor,...r?{borderRadius:D}:{borderBottomLeftRadius:D,borderBottomRightRadius:D}}}}}L.displayName="BoardGroupResults";const H=(0,s.injectIntl)(L);function O(e){return e?e.board_cover_aspect:void 0}function z(e){return e?e.board_cover_size:void 0}function N(e){const t=e.board_cover_size;return(0,y.rD)(t)}function K(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function W(e){(0,C.ZP)({event:e,context:C.Af.EditorClick,callback:()=>{}})}},88046:(e,t,o)=>{o.d(t,{Z:()=>n});o(67294);var r=o(5023),i=o(85893);const n=function(e){let{store:t,disabled:o,isFirstItem:n,isLastItem:s,hideContent:l,blockResizerStore:a,isQuickFind:c,style:d,disableCommentMenu:p,disableHoverMenu:h,disableDrag:u,numberedListCounterStore:m,bulletedListFormatStore:g,format:S,schema:v,coverFormat:y,coverAspectFormat:C,coverSizeFormat:f,shouldShowTitle:x,colorStyle:b,onTextEnter:w,onTextEsc:k,onShiftEnter:P,blockPropertyValueOverlayStore:j,isLast:T,handleOpenPeekPage:M,collectionContextStore:F}=e;return(0,i.jsx)(r.Z,{store:t,disabled:o,isFirstItem:n,isLastItem:s,hideContent:l,blockResizerStore:a,isQuickFind:c,style:d,disableCommentMenu:p,disableHoverMenu:h,disableDrag:u,numberedListCounterStore:m,bulletedListFormatStore:g,format:S,schema:v,coverFormat:y,coverAspectFormat:C,coverSizeFormat:f,coverHeight:void 0,coverWidth:void 0,shouldShowTitle:x,colorStyle:b,onTextEnter:w,onTextEsc:k,onShiftEnter:P,blockPropertyValueOverlayStore:j,isLast:T,handleOpenPeekPage:M,collectionContextStore:F})}},34575:(e,t,o)=>{o.d(t,{F:()=>l});o(67294);var r=o(24405),i=o(356),n=o(36596),s=o(85893);function l(e){window.__c={n:"BoardItemShimmer"};const t=e.minHeight||i.Ju,o=(0,r.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,s.jsx)(n.Z,{style:o.card})}},48936:(e,t,o)=>{o.d(t,{$U:()=>f,GA:()=>x,KK:()=>C,ZP:()=>w});o(67294);var r=o(83355),i=o(14714),n=o(99036),s=o(47453),l=o(4615),a=o(97880),c=o(68939),d=o(8406),p=o(92918),h=o(61766),u=o(984),m=o(68500),g=o(31945),S=o(73063),v=o(89728),y=o(85893);const C=28,f=4,x=35;class b extends r.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:h.Z},this.renderPopup=()=>{const{schema:e,currentGroups:t,groupBy:o}=this.props;return(0,y.jsx)(m.Z,{groupFormat:void 0,groupBy:o,currentGroups:t,schema:e,onChange:this.handleEditMenuChange,onClose:this.handleEditMenuClose,parentStore:this.props.parentStore})},this.handleEditMenuChange=e=>{const{collectionContextStore:t,groupBy:o,schema:r,currentGroups:s,onAccept:c,groupsLimitStore:h}=this.props,{newGroupValue:u}=e,m=r[o.property],g=h.state;if(m&&(0,i.LG)(m))if(d.wd({environment:this.environment,collectionContextStore:t,action:"board_add_group"}),this.stores.buttonPopupStore.reset(),n.cu(m)){if(m.type!==u.type)return;if(void 0===u.value)return;const e=m.options||[],t={id:(0,l.ZP)(),value:u.value,color:(0,n.TL)(e)},i=[...e,t],a={...m,options:i},d={...r,[o.property]:a},h={property:o.property,value:u,hidden:!1};c({newGroups:(0,p.nr)(s,h,g),newSchema:d})}else if("person"===m.type||"relation"===m.type||(0,i.HB)(m.type)){const t={property:o.property,value:u,hidden:!1};c({newGroups:(0,p.nr)(s,t,g),newPage:e.newPage})}else(0,i.A1)(m.type)||"status"===m.type||"number"===m.type||"created_by"===m.type||"last_edited_by"===m.type||"formula"===m.type||"checkbox"===m.type||"location"===m.type||(0,a.t1)(m.type)},this.handleEditMenuClose=()=>{this.stores.buttonPopupStore.reset()},this.boardColorStore=this.createComputedStore((()=>{const{schema:e,collectionContextStore:t}=this.props;return(0,p.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t.normalizedFormatStore.state,collectionContextStore:t,theme:this.theme})}),!0)}renderComponent(){const{groupBy:e,schema:t,type:o}=this.props,{buttonPopupStore:r}=this.stores,n=t[e.property];if(n&&(0,i.LG)(n))return(0,y.jsx)(g.ZP,{render:this.renderPopup,buttonPopupStore:r,popupType:this.environment.device.isMobile?g.Z4.SlideUp:g.Z4.Popup,renderOrigin:e=>{return"default"===o?(0,y.jsx)(v.Z,{isLightGray:!0,icon:s.R,style:{display:"flex",height:C,marginTop:12,marginBottom:f,width:"max-content",position:this.props.stickyLeft?"sticky":void 0,left:this.props.stickyLeft&&this.props.paddingLeft?this.props.paddingLeft:0,...this.props.style},...e,children:(0,y.jsx)(c.FormattedMessage,{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"})}):(0,y.jsx)(S.Z,{icon:e=>(0,s.R)({...e,fill:this.theme.mediumTextColor}),style:{width:x,background:null===(t=this.boardColorStore.state)||void 0===t?void 0:t.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:u.ay,paddingBottom:u.ay,marginRight:u.g1,borderRadius:u.nA,height:33,...this.props.style},...e});var t}})}}b.displayName="CollectionAddGroupButton";const w=b},356:(e,t,o)=>{o.d(t,{ZP:()=>oe,Ju:()=>ee,AY:()=>J});var r=o(67294),i=o(83355),n=o(24405),s=o(15145),l=o(14714),a=o(47453),c=o(72126),d=o(68939),p=o(50906),h=o(49865),u=o(99553),m=o(75018),g=o(39699),S=o(66213),v=o(43250),y=o(75079),C=o(30206),f=o(78316),x=o(73744),b=o(84210),w=o(12534),k=o(17504),P=o(80444),j=o(886),T=o(49085);class M extends T.default{getInitialState(){return{}}}const F=M;var A=o(34583),I=o(480),G=o(86628),B=o(70203),_=o(14900),Z=o(24677),R=o(98104),D=o(52821),V=o(5023),E=o(85893);const L=function(e){let{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:p,numberedListCounterStore:h,bulletedListFormatStore:u,format:m,schema:g,coverFormat:S,coverAspectFormat:v,coverSizeFormat:y,coverHeight:C,coverWidth:f,shouldShowTitle:x,onTextEnter:b,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:P,isLast:j,handleOpenPeekPage:T,collectionContextStore:M}=e;return(0,E.jsx)(V.Z,{store:t,disabled:o,isFirstItem:r,isLastItem:i,hideContent:n,blockResizerStore:s,isQuickFind:l,style:a,disableCommentMenu:c,disableHoverMenu:d,disableDrag:p,numberedListCounterStore:h,bulletedListFormatStore:u,format:m,schema:g,coverFormat:S,coverAspectFormat:v,coverSizeFormat:y,coverHeight:C,coverWidth:f,shouldShowTitle:x,colorStyle:void 0,onTextEnter:b,onTextEsc:w,onShiftEnter:k,blockPropertyValueOverlayStore:P,isLast:j,handleOpenPeekPage:T,collectionContextStore:M})};var H=o(25348);const O=r.memo((function(e){let{collectionContextStore:t,groupFormat:o,format:i,schema:n,disabled:s,store:l,blockPropertyValueOverlayStore:a,collectionGalleryViewStore:c,isSingleColumn:d}=e;const p=(0,I.O7)(),u=(0,r.useMemo)((()=>o?[o]:[]),[o]),m=(0,G.VK)((()=>t.permissionScopes.state),[t.permissionScopes]),S=(0,G.VK)((()=>l.canEdit()&&("collectionTypedView"===t.contextType||m.canEditContent)),[t,m.canEditContent,l]),v=(0,r.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();Z.eP({environment:p,store:e}),R.NX({store:o}),_.Z5({store:e})}}),[p]),y=(0,r.useCallback)((e=>{const o=t.collectionStore(),r=e.getTitleStore();if(!r)return;B.QaF(r.getValue())?Z.Ys({environment:p,store:e}):o&&g.createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:p,perform:t=>{h.Od({store:e,transaction:t})}})}),[t,p]),C=(0,r.useMemo)((()=>d?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[d]),{gallery_cover:f,gallery_cover_aspect:x,gallery_cover_size:b}=i,w=!s&&S&&!m.isSyncedCollection,{coverHeight:k,coverWidth:P}=(0,G.VK)((()=>c.state),[c]),j=(0,r.useMemo)((()=>({format:i,schema:n,onTextEnter:y,onTextEsc:y,onShiftEnter:v,disabled:s,coverFormat:f,coverAspectFormat:x,coverSizeFormat:b,coverHeight:k,coverWidth:P,shouldShowTitle:D.K8(i,"gallery"),blockPropertyValueOverlayStore:a,collectionContextStore:t})),[a,t,k,P,x,f,b,s,i,v,y,n]);return(0,E.jsx)(H.Z,{collectionContextStore:t,groupsPointer:u,format:i,canDrag:w,onSelectableEnter:v,resultProps:j,resultComponent:L,canDrop:!0,disabled:s,shouldShowHoverMenu:!1,direction:d?H.R.Vertical:H.R.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:C,loadContentCover:f&&"page_content"===f.type})}));var z=o(3687),N=o(61838),K=o(64347),W=o(64921),U=o(43145),$=o(17311),Q=o(34232),Y=o(62010);function X(e){window.__c={n:"GalleryShimmer"};const{hasPartialResults:t}=e;if(!(0,Q.Z)(!0,0,100))return null;const o=e.coverHeight??$.Z.card.desktop.medium.height,r=t?void 0:o+40,i=t?1:3,n=c.DZ(i,(e=>(0,E.jsx)(Y.I,{minHeight:r},e)));return(0,E.jsx)(E.Fragment,{children:n})}var q=o(79954);const J=480,ee=40;class te extends i.Z{constructor(){super(...arguments),this.storeTypes={collectionGalleryViewStore:F},this.selectableContainer=null,this.renderGroup=e=>{const{store:t,format:o,disabled:r,collectionContextStore:i,schema:n,blockPropertyValueOverlayStore:s,isFullScreen:l}=this.props,{collectionGalleryViewStore:a}=this.stores,c=this.isSingleColumnStore.state,d=this.isReady.state,p=e?[e]:[],h=i.groupsStore.getGroupState(p);if(!h)return;const u=h.reducerResultStore.state,m=void 0!==e,g=void 0!==u&&(null==u?void 0:u.blockIds.length)>0,S=(0,C.H0)({collectionContextStore:i,groupsPointer:p,hasPartialResults:g}),v=f.VM({collectionContextStore:i,reducerResult:u,isFullScreen:l}),y=i.permissionScopes.state,x=y.isSyncedCollection,b=t.canEdit()&&("collectionTypedView"===i.contextType||y.canEditContent),w=d&&!r&&b&&!x&&(g||!S);return(0,E.jsxs)("div",{style:{paddingBottom:e?16:void 0},children:[(0,E.jsxs)("div",{style:this.getGroupWrapStyle(),children:[(0,E.jsx)(O,{collectionContextStore:i,groupFormat:e,format:o,schema:n,disabled:r,store:t,blockPropertyValueOverlayStore:s,collectionGalleryViewStore:a,isSingleColumn:c}),S&&(0,E.jsx)(X,{hasGroups:m,hasPartialResults:g,coverHeight:a.state.coverHeight}),w&&this.renderAddItemButton(p)]}),v&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,E.jsx)(N.ZP,{groupsPointer:p,store:t,collectionContextStore:i,format:o,isFullScreen:l,incrementLimitsInRelatedGroups:!1})]})]})},this.handleResize=()=>{const{collectionGalleryViewStore:e}=this.stores,t=this.getGalleryCardCoverHeight(),o=this.getGalleryCardActualWidth();e.state.coverHeight!==t&&this.setCardCoverHeight(t),e.state.coverWidth!==o&&this.setCardCoverWidth(o)},this.handleResizeDebounced=(0,c.Ds)(this.handleResize,1e3),this.handleResizeThrottled=(0,c.P2)(this.handleResize,100),this.handleScrollOffsetChange=e=>{var t;const{collectionContextStore:o,isFullScreen:r}=this.props,i=o.isLoading.state,n=null===(t=function(e){var t;return null===(t=e.groupsStore.getGroupState([]))||void 0===t?void 0:t.reducerResultStore}(this.props.collectionContextStore))||void 0===t?void 0:t.state;e<j.Z.incrementScrollOffset&&n&&!i&&null!=n&&n.hasMore&&h.ID({collectionContextStore:o,environment:this.environment,incrementLimitArgs:{isFullScreen:r,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})},this.handleAddItemClick=e=>{if(!A.M_(this.environment))return;const{collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);o&&g.createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:this.environment,perform:r=>{const{mainEditorCurrentBlockStore:i}=P.default.state,n=h.IW({environment:this.environment,collectionContextStore:t,groupsPointer:e,coerce:!0,initializeDefaultTemplate:!0,transaction:r,from:"gallery"});if(!n)return;const l=f.mb({store:n.newStore,mainEditorCurrentBlockStore:i,collectionContextStore:t})??(0,b.ZP)({store:n.newStore,pageVisitSource:s.tY.Create});this.navigate(l),u.Xd({collectionContextStore:t,resultsStore:o.resultsStore}),p.W2j(this.environment,{from:"list_view_add_item_bottom",type:"page",new_page_id:n.newStore.id,...(0,y.Pn)(t)})}})},this.handleGroupHeaderAddItem=e=>{if(this.environment.device.isMobile)m.navigateToBlock({environment:this.environment,store:e,pageVisitSource:s.tY.Create});else{const{collectionContextStore:t}=this.props;m.peekBlock({environment:this.environment,store:e,peekMode:f.kr(t.collectionViewStore()),resultsStore:void 0,collectionContextStore:t,pageVisitSource:s.tY.Create})}},this.isSingleColumnStore=this.createComputedStore((()=>this.environment.WindowSizeStore.state.width<=J)),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):m.navigate({environment:this.environment,url:e})}didUpdate(e){(e.format||{}).gallery_cover_size!==(this.props.format||{}).gallery_cover_size&&(this.setCardCoverHeight(),this.setCardCoverWidth())}didMount(){this.setCardCoverWidth(),this.setCardCoverHeight(),(0,x.lj)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,x.lj)(window,"orientationchange",this.handleResizeDebounced)}willUnmount(){(0,x.ZV)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,x.ZV)(window,"orientationchange",this.handleResizeDebounced)}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:r,paddingRight:i,isFullScreen:n,collectionContextStore:s}=this.props,l=f.az(s,n),a=t.collection_group_by;return(0,k.Z)((t=>(0,E.jsxs)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth},className:v.sbt,children:[(0,E.jsx)(q.Z,{store:e,shouldShowHalo:!n,canSelect:!n,analyticsName:"gallery",...t,ref:e=>this.selectableContainer=e,children:a?this.renderGroups(a):this.renderGroup(void 0)}),!l&&(0,E.jsx)(U.Z,{onChange:this.handleScrollOffsetChange})]})))}renderGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:a,isRootChild:c,isInPeekRenderer:d}=this.props;return(0,E.jsx)(K.Z,{store:t,id:"gallery_groups",groupBy:e,groupsFormatKey:l.Uh,groupAggregationKey:l.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderGroup,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,renderHeader:e=>(0,E.jsx)(ie,{args:e}),getGroupStyle:e=>function(e,t){if(0===e.index)return{};return{borderTop:`1px solid ${t.tableDividerColor}`}}(e,this.theme),paddingLeft:a,isRootChild:c,isInPeekRenderer:d})}renderAddItemButton(e){return(0,E.jsx)(W.Z,{onClick:()=>this.handleAddItemClick(e),onMouseDown:w.$0,style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,borderRadius:4,boxShadow:"dark"===this.theme.mode?`${this.theme.darkDividerColor} 0px 0px 0px 1px inset`:`${this.theme.regularDividerColor} 0px 0px 0px 1px inset`,minHeight:ee},children:(0,E.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:-6},children:[(0,a.R)((t=this.theme,{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor})),(0,E.jsx)("div",{style:{color:this.theme.lightIconColor},children:(0,E.jsx)(d.FormattedMessage,{defaultMessage:"New",id:"database.galleryView.addItemButtonTitle"})})]})});var t}setCardCoverHeight(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverHeight:e||this.getGalleryCardCoverHeight()})}setCardCoverWidth(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverWidth:e||re(this.props.format)})}getGalleryCardActualWidth(){if(this.selectableContainer){const e=this.selectableContainer.getNode();if(e){const t=e.querySelector(`.${v.K4T}`);if(t)return t.offsetWidth}}return re(this.props.format)}getGalleryCardCoverHeight(){return this.getGalleryCardActualWidth()*(9/16)}getGroupWrapStyle(){const e=this.props.format.collection_group_by;return{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${this.isSingleColumnStore.state?"100%":`${re(this.props.format)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:e?1:16,paddingBottom:4}}}te.displayName="CollectionGalleryView",te.contextTypes={...S.wK,...i.w};const oe=te;function re(e){const t=e.gallery_cover_size;return f.rD(t)}function ie(e){let{args:t}=e;window.__c={n:"GroupHeaderComponent"};const o=(0,n.Fg)();return(0,E.jsx)(z.Z,{...t,height:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,o)})}},24854:(e,t,o)=>{o.d(t,{Z:()=>A});o(57658),o(21703),o(67294);var r=o(83355),i=o(14714),n=o(99036),s=o(8848),l=o(45453),a=o(9056),c=o(37612),d=o(72126),p=o(21202),h=o(68939),u=o(50906),m=o(49865),g=o(14900),S=o(47307),v=o(39699),y=o(92658),C=o(92918),f=o(87279),x=o(26136),b=o(93405),w=o(78140),k=o(32163),P=o(40721),j=o(72495),T=o(9050),M=o(85893);class F extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:y.Z},this.handleSelectPropertyColorPickerChange=e=>{const{groupFormat:t,schema:o,collectionContextStore:r}=this.props,i=o[t.property];if(!i)return;if(!n.cu(i))return;const s=r.collectionStore();if(!s)return;const l=t.value;if(l.type!==i.type)return;const a=(i.options||[]).map((t=>t.value===l.value?{...t,color:e}:t)),c={...i,options:a},d={...o,[t.property]:c};v.createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:this.environment,perform:e=>{g.Rm({environment:this.environment,collectionStore:s,update:{schema:d},transaction:e})}}),u.wds(this.environment,{view_type:I(this.props.collectionContextStore),action:"group_change_color"})},this.handleHide=()=>{const{groupFormat:e,collectionContextStore:t,groupsFormatKey:o,currentGroups:r}=this.props,i={...e,hidden:!0},n=(0,C.ar)(r,i);v.createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:this.environment,perform:e=>{m.A6({collectionContextStore:t,newGroups:n,groupsFormatKey:o,transaction:e})}}),u.wds(this.environment,{view_type:I(this.props.collectionContextStore),action:"hide_group"})},this.handleShow=()=>{const{groupFormat:e,collectionContextStore:t,groupsFormatKey:o,currentGroups:r,groupsLimitStore:i}=this.props,n={...e,hidden:!1},s=(0,C.nr)(r,n,i.state);v.createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:this.environment,perform:e=>{m.A6({collectionContextStore:t,newGroups:s,groupsFormatKey:o,transaction:e})}}),u.wds(this.environment,{view_type:I(this.props.collectionContextStore),action:"show_group"})},this.handleDelete=()=>{S.showDialog({message:(0,M.jsx)(h.FormattedMessage,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:this.handleDeleteAccept}]})},this.handleDeleteAccept=async()=>{const{collectionContextStore:e,currentGroups:t,groupFormat:o,groupsFormatKey:r,intl:n}=this.props,s=e.collectionStore();if(!s)return;const l=o.value;if("relation"===l.type&&(0,i.RA)(l.value)){const e=x.G.createChildStore(s,{id:l.value.id,table:p.iU});await e.load();const t=e.getParentCollectionStore();await(null==t?void 0:t.load())}v.createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:this.environment,perform:i=>{m.iE({environment:this.environment,collectionStore:s,property:o.property,groupFormat:o,currentGroups:t,groupsFormatKey:r,collectionContextStore:e,transaction:i,intl:n})}}),u.wds(this.environment,{view_type:I(this.props.collectionContextStore),action:"delete_group"})}}renderComponent(){const{device:e}=this.environment,{parent:t}=this.props,o=d.oA([this.getGroupActionsSection(),this.getSelectColorSection()]);let r;return r=e.isMobile?{menuType:f.og.Modal,title:(0,M.jsx)(h.FormattedMessage,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,M.jsx)(P.DoneMenuText,{}),onClickRight:t.close}:{menuType:f.og.Popup},(0,M.jsx)(w.Z,{...r,children:(0,M.jsx)(k.Z,{type:k.i.Vertical,initialFocus:0,sections:o,onAccept:e=>{"string"==typeof e.key&&e.key.includes(F.colorActionKeyPrefix)||t.close()}})})}getGroupActionsSection(){const{groupFormat:e,collectionContextStore:t}=this.props,o=[],r=e.value,n=t.permissionScopes.state;(0,i.eF)(e)?o.push({key:"show",render:e=>(0,M.jsx)(b.Z,{...e,title:(0,M.jsx)(h.FormattedMessage,{defaultMessage:"Show",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:a.g}),action:this.handleShow}):o.push({key:"hide",render:e=>(0,M.jsx)(b.Z,{...e,title:(0,M.jsx)(h.FormattedMessage,{defaultMessage:"Hide",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:l.p}),action:this.handleHide}),void 0!==r.value&&n.canEditContent&&!n.isSyncedCollection&&"collectionTypedView"!==t.contextType&&o.push({key:"delete",render:e=>(0,M.jsx)(b.Z,{...e,title:(0,M.jsx)(h.FormattedMessage,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:c.y}),action:this.handleDelete});return{key:"collection group",render:e=>(0,M.jsx)(j.Z,{...e}),items:o}}getSelectColorSection(){const{schema:e,groupFormat:t}=this.props,o=t.value;if(void 0===o.value)return;const r=e[t.property];if(!r)return;if("select"!==r.type&&"multi_select"!==r.type)return;if(o.type!==r.type)return;const i=(r.options||[]).find((e=>e.value===o.value));if(!i)return;return{key:"collection color section",render:e=>(0,M.jsx)(j.Z,{...e,title:(0,M.jsx)(h.FormattedMessage,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:s.AP.map((e=>({key:`${F.colorActionKeyPrefix}_${e}`,render:t=>(0,M.jsx)(T.Z,{...t,color:e,checkState:i.color===e}),action:()=>{this.handleSelectPropertyColorPickerChange(e)}})))}}}F.displayName="CollectionGroupActionMenu",F.colorActionKeyPrefix="color";const A=(0,h.injectIntl)(F);function I(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}},3687:(e,t,o)=>{o.d(t,{Z:()=>se});o(21703),o(67294);var r=o(73935),i=o(83355),n=o(1302),s=o(480),l=o(86628),a=o(49085),c=o(56666),d=o(47453),p=o(21202),h=o(51454),u=o(68939),m=o(50906),g=o(49865),S=o(14900),v=o(24677),y=o(39699),C=o(75079),f=o(12534),x=o(77546),b=o(6027),w=o(26136),k=o(34583),P=o(24854),j=(o(57658),o(2032)),T=o(14248),M=o(14714),F=o(42875),A=o(72126),I=o(82990),G=o(47853),B=o(16187),_=o(33929),Z=o(87279),R=o(98742),D=o(75498),V=o(10732),E=o(57042),L=o(52275),H=o(31945),O=o(78140),z=o(32163),N=o(40721),K=o(89728),W=o(53437),U=o(72495),$=o(26388),Q=o(42782),Y=o(85893);class X extends i.Z{constructor(){super(...arguments),this.renderMenu=e=>{const{device:t}=this.environment;let o;return o=t.isMobile?{menuType:Z.og.Modal,title:(0,Y.jsx)(u.FormattedMessage,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,Y.jsx)(N.DoneMenuText,{}),onClickRight:e.close}:{menuType:Z.og.Popup,width:200},(0,Y.jsx)(O.Z,{...o,children:(0,Y.jsx)(z.Z,{type:z.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>(0,Y.jsx)(U.Z,{...e}),items:this.getAggregationActions()}],onAccept:e.close})})},this.handleChangeAggregation=e=>{const{collectionContextStore:t,format:o,groupAggregationKey:r}=this.props,i=t.collectionViewStore();i&&(t.isLoading.state||t.loadingDetails.setState({type:"load_aggregation"}),t.isClientModeEnabled.state||t.asyncAggregationStatus.setState({calculating:!0,aggregation:e,changingType:!0}),y.createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:this.environment,perform:t=>{S.iG({collectionViewStore:i,update:{format:{...o,[r]:e}},transaction:t})}})),m.wds(this.environment,{view_type:q(this.props.collectionContextStore),action:"change_aggregation"})},this.aggregationStore=this.createComputedStore((()=>{const{format:e,groupAggregationKey:t}=this.props;return e[t]||{aggregator:"count"}}),!0),this.reducerStore=this.createComputedStore((()=>{const{schema:e,groupFormat:t}=this.props,o=this.aggregationStore.state;return{type:"aggregation",filter:(0,T.zk)({schema:e,group:t,timeZone:(0,F.r)()}),aggregation:o}}))}renderComponent(){const{device:e}=this.environment;return(0,Y.jsx)($.Z,{renderTooltip:()=>this.renderTooltipText(),render:t=>(0,Y.jsx)(H.ZP,{popupType:e.isMobile?H.Z4.SlideUp:H.Z4.Popup,renderOrigin:e=>(0,Y.jsx)(K.Z,{disabled:this.props.disabled,style:{fontWeight:I.Z.fontWeight.medium,color:this.theme.lightTextColor,height:24},...(0,R.Z)((0,R.Z)(t,e),{onClick:f.Wi}),children:this.renderValue()}),disabled:this.props.disabled,render:this.renderMenu})})}renderValue(){const{schema:e,collectionContextStore:t,groupFormat:o}=this.props,r=this.aggregationStore.state,i=this.reducerStore.state;if(i)return(0,Y.jsx)(D.Z,{id:`group_aggregation:${(0,M.mD)(o)}`,collectionContextStore:t,reducer:i,groupsPointer:[o],render:o=>{const i=o.state;let n;if((0,j.pK)(r)){const t=e[r.property];!t||"formula"!==t.type&&"number"!==t.type||(n=t.number_format)}return(0,Y.jsx)(V.Z,{aggregation:r,collectionContextStore:t,children:i?(0,B.Ol)({numberFormat:n,dateFormat:void 0,aggregationType:r.aggregator,userTimeZone:(0,F.r)(),value:i.aggregationResult,roundDecimal:5}):"-"})}})}renderTooltipText(){const{schema:e,collectionContextStore:t}=this.props,o=this.aggregationStore.state,r=B.VN[(0,j.OV)(o)],i=(0,V.u)(t,o);if((0,j.pK)(o)){const t=e[o.property];if(t){const e=t.name;return _.default.formatMessage(E.Z.propertyAggregation,{aggregationType:r,propertyName:e,calculating:i})}}return _.default.formatMessage(E.Z.aggregationType,{aggregationType:r,calculating:i})}getAggregationActions(){const e=[];for(const s of j.o5)e.push(this.createCountAggregationAction(s));const t=(o=this.props.schema,Object.keys(o).filter((e=>{const t=o[e];return t&&(0,j.iV)(t)&&!("rollup"===t.type&&"status"===t.target_property_type)})));var o;if(t.length>0)for(const s of j.Sy)"show_unique"!==s&&e.push(this.getAggregationGroupAction(s,t));const r=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,j.O4)(o)}))}(this.props.schema);if(r.length>0)for(const s of j.k$)e.push(this.getAggregationGroupAction(s,r));const i=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,j.dN)(o)}))}(this.props.schema);if(i.length>0)for(const s of j.f8)e.push(this.getAggregationGroupAction(s,i));const n=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,j.Mv)(o)}))}(this.props.schema);if(n.length>0)for(const s of j.gC)e.push(this.getAggregationGroupAction(s,n));return e}getAggregationGroupAction(e,t){const{device:o}=this.environment,r=B.VN[e],i=A.oA(t.map((t=>this.createPropertyAggregationAction(t,e))));return{key:e+r,render:(e,t)=>(0,Y.jsx)(Q.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,Y.jsx)(L.Z,{...e,ref:t,title:r}),renderExtension:(e,n)=>{let s;return s=o.isMobile?{menuType:Z.og.Modal,title:r,right:o.isPhone?(0,Y.jsx)(N.DoneMenuText,{}):void 0,onClickRight:n.close,...e}:{menuType:Z.og.Popup,width:200,...e},(0,Y.jsx)(O.Z,{...s,children:(0,Y.jsx)(z.Z,{type:z.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,Y.jsx)(U.Z,{...e}),items:i}],onAccept:t.onAccept})})}}),action:()=>null}}createCountAggregationAction(e){const t=B.VN[e];return{key:e,render:o=>(0,Y.jsx)(J,{aggregationType:e,label:t,props:o}),action:()=>{this.handleChangeAggregation({aggregator:e})}}}createPropertyAggregationAction(e,t){const o=this.props.schema[e];if(!o)return;const r=o.name;return{key:`${e} ${t}`,render:e=>(0,Y.jsx)(J,{aggregationType:t,label:r,props:e}),action:()=>{this.handleChangeAggregation({aggregator:t,property:e})}}}}function q(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function J(e){let{aggregationType:t,label:o,props:r}=e;const i=B.Sn[t];return(0,Y.jsx)($.Z,{placement:W.GI.Placement.Right,delayThreshold:0,render:e=>(0,Y.jsx)(L.Z,{title:o,...(0,R.Z)(e,r)}),renderTooltip:()=>(0,Y.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[i&&(0,Y.jsx)("img",{src:(0,G.D)(i),style:{borderRadius:4,width:140,marginTop:4}}),B.BG[t]]})},r.key)}X.displayName="CollectionGroupAggregation";var ee=o(26055),te=o(26964),oe=o(73063),re=o(79954),ie=o(5210);class ne extends i.Z{constructor(){super(...arguments),this.storeTypes={hovered:a.default.createClass(!1)},this.handleAddItemClick=()=>{const{groupFormat:e,collectionContextStore:t,isFullScreen:o,onGroupHeaderAddItem:r}=this.props;t.groupsStore.getGroupState(e)&&k.M_(this.environment)&&(t.searchQuery.state&&S.Ug({searchQuery:"",collectionContextStore:t,isFullScreen:o}),y.createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:this.environment,perform:o=>{const i=g.IW({environment:this.environment,collectionContextStore:t,groupsPointer:[e],insertAtIndex:0,coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:"group_header"});i&&(r(i.newStore,i.coercionSucceeded,this.props),m.W2j(this.environment,{from:"group_add_item_top",type:"page",new_page_id:i.newStore.id,...(0,C.Pn)(t)}))}}))},this.handleCollectionGroupValueChange=e=>{const t=this.props.collectionContextStore.collectionStore();t&&(g.w$({...e,environment:this.environment,collectionStore:t,...this.props}),m.wds(this.environment,{view_type:le(this.props.collectionContextStore),action:"rename_group"}))},this.handleToggleButtonClick=()=>{const{groupFormat:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);if(!o)return;v.ZH(this.environment);const i=!o.toggleStateStore.state;if(g.uo({environment:this.environment,groupFormat:e,toggleStateStore:o.toggleStateStore,newValue:i,collectionContextStore:t}),!i){const e=r.findDOMNode(this),o=null==e?void 0:e.parentElement;o&&n.default.afterNextFlush((()=>{(0,x.Oc)({el:o,windowHeight:this.environment.WindowSizeStore.state.height,minEdgeDist:50}),t.renderEmitter.emit()}))}},this.handleMouseMove=()=>{this.stores.hovered.setState(!0)},this.handleMouseLeave=()=>{this.stores.hovered.setState(!1)},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:i,groupFormat:n}=this.props,s=r.findDOMNode(this);s&&s instanceof Element&&y.createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:this.environment,perform:e=>g.BO({environment:this.environment,collectionContextStore:i,groupsPointer:[n],droppedStores:t,duplicate:o,transaction:e})})}}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new w.G(this.environment,{table:p.iU,id:t.id}))}didMount(){var e,t;null===(e=(t=this.props).onMount)||void 0===e||e.call(t)}renderComponent(){var e;const{disabled:t,getComputedStickyStyle:o,groupFormat:r,collectionContextStore:i}=this.props,n=i.groupsStore.getGroupState(r);if(!n)return;const s=n.toggleStateStore.state,l=i.permissionScopes.state,a=i.shouldAllowNewItemCreation(),c=(null===(e=i.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||void 0;return(0,Y.jsx)(te.Z,{position:b.Z.Top,getComputedStyle:o,children:(0,Y.jsxs)("div",{style:he(this.props.isInPeekRenderer,this.theme,c,this.props.style),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,children:[(0,Y.jsx)("div",{style:ce(s,this.props.isFullScreen,this.props.isRootChild,this.props.paddingLeft,this.props.paddingTop,this.props.toggleClosedMarginBottom,this.props.height,this.props.stickyLeft),children:(0,Y.jsx)("div",{style:{display:"flex",alignItems:"center",position:this.props.stickyLeft?"sticky":void 0,left:this.props.paddingLeft},children:(0,Y.jsxs)(re.Z,{store:this.selectableBlockStore,canDropOnto:!t&&!s,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[r],style:{display:"flex",alignItems:"center",height:"100%"},children:[this.renderToggleButton(n.toggleStateStore),this.renderValue(),(0,Y.jsx)(de,{disabled:this.props.disabled,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupFormat:this.props.groupFormat,groupAggregationKey:this.props.groupAggregationKey}),!t&&l.canConfigureBlock&&(0,Y.jsx)(pe,{groupFormat:this.props.groupFormat,currentGroups:this.props.currentGroups,format:this.props.format,schema:this.props.schema,collectionContextStore:this.props.collectionContextStore,groupsFormatKey:this.props.groupsFormatKey}),a&&this.renderAddButton()]})})}),this.props.children]})})}renderToggleButton(e){const t=e.state;return(0,Y.jsx)(ie.Z,{isSidebar:!1,open:t,fill:!0,onClick:this.handleToggleButtonClick,onMouseDown:f.$0,style:{flexShrink:0}})}renderValue(){const{groupFormat:e,schema:t,disabled:o,currentGroups:r,groupBy:i,collectionContextStore:n}=this.props,s=n.permissionScopes.state;return(0,Y.jsx)(ee.Z,{groupBy:i,groupFormat:e,currentGroups:r,schema:t,disabled:o||!s.canConfigureCollection||s.isSyncedCollection,isHiddenGroup:!1,onChange:this.handleCollectionGroupValueChange,style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:n})}renderAddButton(){return(0,Y.jsx)($.Z,{renderTooltip:()=>(0,Y.jsx)(u.FormattedMessage,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,Y.jsx)(oe.Z,{icon:d.R,onClick:this.handleAddItemClick,...e})})}}ne.displayName="CollectionGroupHeader";const se=ne;function le(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function ae(e){return e||33}function ce(e,t,o,r,i,n,s,l){return{display:"flex",alignItems:"center",height:ae(s),paddingTop:i,...l&&{position:"sticky",left:t||o?r:0},...!e&&{marginBottom:n}}}function de(e){let{disabled:t,format:o,schema:r,collectionContextStore:i,groupFormat:n,groupAggregationKey:s}=e;window.__c={n:"Aggregation"};const a=(0,l.VK)((()=>i.permissionScopes.state.canConfigureBlock),[i]);return(0,Y.jsx)(X,{groupFormat:n,disabled:t||!a,groupAggregationKey:s,format:o,schema:r,collectionContextStore:i})}function pe(e){let{groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:a}=e;window.__c={n:"ActionButtonComponent"};const d=(0,s.Fy)(),p=(0,l.VK)((()=>n.groupsLimit),[n]);return(0,Y.jsx)(H.ZP,{popupType:d.isMobile?H.Z4.SlideUp:H.Z4.Popup,renderOrigin:e=>(0,Y.jsx)(oe.Z,{icon:c.o,...e}),onClick:f.Wi,render:e=>(0,Y.jsx)(P.Z,{parent:e,groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:a,groupsLimitStore:p})})}function he(e,t,o,r){const i=e?t.cardContentBackground:t.contentBackground;return{position:"relative",zIndex:h.sL+2,width:"100%",background:void 0===o?i:o,fontSize:14,...r}}},61838:(e,t,o)=>{o.d(t,{K0:()=>y,ZP:()=>f});o(67294);var r=o(83355),i=o(15145),n=o(40745),s=o(49902),l=o(68939),a=o(50906),c=o(49865),d=o(75018),p=o(24677),h=o(30206),u=o(12534),m=o(64921),g=o(68785),S=o(44043),v=o(85893);const y=33;class C extends r.Z{constructor(){super(...arguments),this.handleLoadMoreClick=e=>{const{collectionContextStore:t,groupsPointer:o,incrementLimitsInRelatedGroups:r}=this.props,i=t.groupsStore.getGroupState(o);if(!i)return;const n=i.reducerResultStore.state;(0,u.Wi)(e),p.ZH(this.environment),n&&c.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:this.props.isFullScreen,currentResultCount:n.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:r}}),s.j({name:"collection_load_more"}),a.uDZ(this.environment)},this.handleViewAllClick=e=>{e.metaKey||e.ctrlKey?d.navigateToBlock({environment:this.environment,store:this.props.store,pageVisitSource:i.tY.PersonalHomeTileTasks,openInNew:"tab"}):d.navigateToBlock({environment:this.environment,store:this.props.store,pageVisitSource:i.tY.PersonalHomeTileTasks})}}renderComponent(){const{style:e,store:t,format:o,collectionContextStore:r,groupsPointer:i}=this.props;if(!r.groupsStore.getGroupState(i))return;const s=(0,h.$t)({collectionContextStore:r,groupsPointer:i});return r.isCompactView.state?(0,v.jsx)(m.Z,{onClick:this.handleViewAllClick,onMouseDown:u.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,paddingLeft:8,marginBottom:8,...e},children:(0,v.jsx)("div",{style:{color:this.theme.lightTextColor},children:(0,v.jsx)(l.FormattedMessage,{id:"database.viewAllButtonTitle",defaultMessage:"View all"})})}):(0,v.jsxs)(m.Z,{onClick:this.handleLoadMoreClick,onMouseDown:u.$0,disabled:s,hoveredStyle:s?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:30,borderRadius:4,whiteSpace:"break-spaces",fontSize:14,...e},children:[(0,n.M)((a=this.theme,{width:14,height:14,marginLeft:4,marginRight:6,fill:a.lightIconColor})),(0,v.jsx)("div",{style:{color:this.theme.lightTextColor},children:(0,v.jsx)(l.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),s?(0,v.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,v.jsx)(g.Z,{style:{width:12,height:12}})}):t.canEdit()&&(0,v.jsx)(S.Z,{collectionContextStore:r,format:o})]});var a}}C.displayName="CollectionGroupLoadMoreButton";const f=C},25348:(e,t,o)=>{o.d(t,{R:()=>X,Z:()=>J});var r=o(67294),i=o(83355),n=o(86628),s=o(14248),l=o(14714),a=o(42875),c=o(72126),d=o(49865),p=o(39699),h=o(75079),u=o(78316),m=o(18245),g=o(26136),S=o(480),v=o(24405),y=o(76205),C=o(99036),f=o(59054),x=o(40745),b=o(95371),w=o(82990),k=o(68939),P=o(50906),j=o(40663),T=o(97004),M=o(77181),F=o(12534),A=o(40150),I=o(73807),G=o(20144),B=o(1302),_=o(51365),Z=o(99553),R=o(28020),D=o(43250),V=o(48543),E=o(19511),L=o(78030),H=o(79954),O=o(85893);class z extends i.Z{constructor(){super(...arguments),this.handleInsertBelow=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;return s?d.$T({environment:this.environment,collectionStore:s,collectionContextStore:i,groupsPointer:n,insertStores:t,store:r,before:!1,transaction:o}):[]},this.handleInsertAbove=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;return s?d.$T({environment:this.environment,collectionStore:s,collectionContextStore:i,groupsPointer:n,insertStores:t,store:r,before:!0,transaction:o}):[]},this.handleRemove=e=>{const{store:t,collectionContextStore:o,groupsPointer:r}=this.props,{transaction:i}=e;r.length>0&&d.BN({store:t,transaction:i,groupsPointer:r,collectionContextStore:o,environment:this.environment}),d.Od({store:t,transaction:i})},this.handleDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{store:i,collectionContextStore:n,groupsPointer:s,subitemPath:l}=this.props,a=this.associatedCollectionStore.state;if(!a)return[];const c=m.default.mark("collections.drop_item_lag");m.default.measureAfterNextFlush(c,{environment:this.environment,getData:()=>h.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})}),p.createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:this.environment,perform:e=>{d.by({environment:this.environment,collectionStore:a,targetStore:i,droppedDirection:t,collectionContextStore:n,groupsPointer:s,droppedStores:o,duplicate:r,transaction:e,subitemPath:l})}})},this.handleNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;if(!s)return[];const l=m.default.mark("collections.drop_item_lag");m.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>h.yr({collectionContextStore:i,is_native_drop:!0,is_empty:!1})}),p.createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:this.environment,perform:e=>{d.tQ({environment:this.environment,collectionStore:s,targetStore:r,droppedDirection:o,collectionContextStore:i,groupsPointer:n,files:t,transaction:e})}})},this.handleInsertRow=e=>t=>{let{transaction:o}=t;const{store:r,collectionContextStore:i,groupsPointer:n,subitemPath:s,blockPropertyValueOverlayStore:l,onSelectableInsertRow:a}=this.props,c=this.associatedCollectionStore.state;if(!c)return[];const p=d.yk({environment:this.environment,collectionContextStore:i,groupsPointer:n,store:r,before:"above"===e,collectionStore:c,transaction:o,subitemPath:s,subitemInsertDirection:"below"});P.W2j(this.environment,{...h.Pn(i),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==p?void 0:p.id}),p&&a&&a(r,p),p&&l&&B.default.afterNextFlush((()=>{B.default.afterNextFlush((()=>{_.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:l,store:p,property:"title",format:L.C.Table,collectionContextStore:i})}))}))},this.handleOpenPeekPage=()=>{const{collectionContextStore:e,handleOpenPeekPage:t}=this.props,o=e.collectionViewStore();m.default.mark("collections.open_item_page_lag"),t&&t(),Z.Xd({collectionContextStore:e,resultsStore:this.resultsStore.state});const r=null==o?void 0:o.getType();if(r){const e=null==o?void 0:o.getFormat().collection_peek_mode,t=e||V.Ls[r];P.hym(this.environment,{is_peek:!0,from:r,peek_mode:t})}},this.canEditStore=this.createComputedStore((()=>this.props.store.canEdit())),this.associatedCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore())),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore})),this.shouldShowHighlightHalo=this.createComputedStore((()=>u.Sc(this.props.store))),this.normalizedCollectionViewSelectionStore=this.createComputedStore((()=>{const e=E.Z.state;return e.isActive&&e.store===this.props.store}))}didMount(){this.props.collectionContextStore.onItemMount()}renderComponent(){const{store:e,resultProps:t,resultComponent:o,collectionContextStore:i,canDrag:n,canDrop:s,getItemSelectableStyle:l,belowDropZoneMargin:a,analyticsName:c,disabled:d,direction:p,onSelectableEnter:h,disableScrollToRevealHorizontal:m,touchDragOnly:g,isLast:S,groupsPointer:v,toggleButton:y,subitemPath:C,disableSelectable:f,itemSelectableHaloStyle:x,passesFilter:b}=this.props,w=!d&&this.canEditStore.state&&!(0,R.aT)(e.id,i.isInPeekRenderer.state),k=this.props.shouldShowHoverMenu&&w,P=p!==X.Vertical&&s,j=p!==X.Vertical&&s,T=p===X.Vertical&&s,M=r.createElement(o,{handleOpenPeekPage:this.handleOpenPeekPage,collectionContextStore:i,...t,store:e,key:e.id,isLast:S,toggleButton:y,subitemPath:C,passesFilter:b});return f?M:(0,O.jsx)(H.Z,{style:l?l(S):void 0,store:e,analyticsFromOverride:i.getAnalyticsFromOverride(),canSelect:w,shouldShowHalo:!this.normalizedCollectionViewSelectionStore.state&&!i.isCompactView.state,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,haloStyle:{...u.pB(this.shouldShowHighlightHalo.state,this.theme),...x},canDrag:n,canDropBelow:T,canDropLeft:P,canDropRight:j,canNativeDropBelow:T,canNativeDropLeft:P,canNativeDropRight:j,canDropOnto:s,canTriggerContextMenu:w,showBlockMenuInput:!0,shouldShowHoverMenu:k,shouldShowCommentMenu:!1,onSelectableDrop:this.handleDrop,onNativeDrop:this.handleNativeDrop,onInsertBelow:this.handleInsertBelow,onInsertAbove:this.handleInsertAbove,onRemove:this.handleRemove,canInsertAbove:s,canInsertBelow:s,onInsertRowBelow:this.handleInsertRow("below"),onInsertRowAbove:this.handleInsertRow("above"),belowDropZoneMargin:a,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:c,shouldShowDropZone:s,dropzoneGap:this.props.dropzoneGap,onEnter:h,className:D.K4T,disableScrollToRevealHorizontal:m,touchDragOnly:g,groupsPointer:v,children:M})}}z.displayName="CollectionGroupResultsItem";const N=z;var K=o(64921),W=o(5210);const U=function e(t){window.__c={n:"CollectionGroupResultsNestedItem"};const{store:o,collectionContextStore:i,subitemPath:s,titleColumnIndex:l,nestedCreateSubitemButton:a,getItemSelectableStyle:c}=t,{currentSubitemFormatStore:d,subitemExpandedStore:p,subitemTreeStore:m}=i,g=(0,n.VK)((()=>u.Bm({store:o,collectionContextStore:i})),[i,o]),x=(0,n.VK)((()=>s&&s.length>0?s:(0,b.DY)(m.state.children,(e=>e.value.store===o))),[s,m,o],{useDeepEqual:!0}),w=x?(0,M.Af)(x.map((e=>e.value.store))):"",k=(0,n.VK)((()=>p.state.get(w)),[p,w]),j=Boolean(null==k?void 0:k.isExpanded),F=(0,S.O7)(),A=(0,n.VK)((()=>{const e=d.state;if(!e||!g)return;const t=g.getSchema()[e.property];return void 0!==t&&(0,C.p_)(t)?t:void 0}),[d,g]),B=(0,n.VK)((()=>{var e;return A&&"relation"===A.type&&(0,C.F0)(A)===(null===(e=i.collectionStore())||void 0===e?void 0:e.id)&&A.property}),[i,A]),_=(0,n.VK)((()=>{var e;return null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType()}),[i]),Z=(0,n.VK)((()=>{const e=!B||_&&(0,M.Av)(_)?void 0:{property:B,filter:{operator:"is_empty"}};return!(!d.state||!g)&&(0,M.kC)({store:o,collectionStore:g,subitemFormat:d.state,subitemPathKey:w,collectionContextStore:i,propertyFilters:[...e&&B?[{id:B,filter:e}]:[],...i.currentPropertyFiltersStore.state],combinatorFilter:i.currentCombinatorFilterStore.state,currentUserId:F.currentUser.id}).length>0}),[i,_,d,F.currentUser.id,B,g,w,o]),R=(0,n.VK)((()=>{var e;if(!d.state||!g)return!1;const t=null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType();return Z||j||F.device.isMobile||"timeline"===t}),[d,F.device.isMobile,g,Z,j,i]),D=(0,n.VK)((()=>G.Z.getState().hoveredStore===o),[o]),V=(0,n.VK)((()=>{const e=(0,T.m1)({collectionContextStore:i,collectionStore:g,environment:F});if(e)return(0,y.q)(e)}),[i,g,F]),E=(0,r.useCallback)((()=>{const e=p.state;if(j)e.delete(w),P.a_g(F,{...(0,h.Pn)(i),depth:(null==x?void 0:x.length)||0}),p.emit();else{e.set(w,{isExpanded:!0,limit:20}),P._kX(F,{...(0,h.Pn)(i),depth:(null==x?void 0:x.length)||0});const t=d.state;V&&e&&A&&t?(0,M.fd)({blockStore:o,subitemExpandedStore:p,subitemFormat:t,propertySchema:A,compiledFilter:V,pathKey:w,forceStoresToLoad:!1,visitedIds:new Set}).then((()=>{p.emit()})):p.emit()}}),[V,p,j,w,i,d,F,x,o,A]),L=(0,n.VK)((()=>{const e=m.state;return e&&x?(0,M.Ns)(e).value.store===o:t.isLast}),[m,t.isLast,o,x]),H=(0,I._)(),z=(0,n.VK)((()=>{var e;const t=o.getModel(),r=o.getRecordModel;if(!V||!t)return!0;const i=null===(e=o.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return V({block:t,getRecordModel:r,propertyMapping:i,formulaTimeoutTimestampMs:Date.now()+H,resultCache:new Map})}),[o,V,H]),K=(0,n.VK)((()=>c&&!z?()=>({...c?c(L):{},...z?{}:{opacity:.5}}):c),[c,z,L]);(0,f.r5)((async()=>{const e=o.getModel();await o.load();const t=o.getRecordModel,r=d.state;if(!R||!e||!V||!A||!t||!r||z)return;(0,M.xb)({store:o,subitemFormat:r,propertySchema:A}).length>0||(await(0,M.fd)({blockStore:o,subitemExpandedStore:p,subitemFormat:r,propertySchema:A,compiledFilter:V,pathKey:w,forceStoresToLoad:!0,visitedIds:new Set}),p.emit())}),[R,V,d,z,w,o,p,A]);const U=(0,v.Fg)(),Q=(0,O.jsx)(N,{...t,passesFilter:z,isLast:L,getItemSelectableStyle:K,subitemPath:x,toggleButton:(R||D)&&(0,O.jsx)(W.Z,{isSidebar:!1,open:j,fill:!0,onClick:E,color:Z||j?U.regularIconColor:U.mediumIconColor,disabled:x&&x.length>=M.F0})});if(!j||!x||0===x.length||x.length>=M.F0)return Q;const Y=x[x.length-1].children;return(0,O.jsxs)(O.Fragment,{children:[Q,Y.map((o=>{const i=o.value.store;return(0,r.createElement)(e,{...t,key:i.id,store:i,subitemPath:[...x,o]})})),g&&a&&a({store:o,parentStore:g,subitemPath:x,indentLevel:x.length,titleColumnIndex:l}),k&&Y.length>0&&Y.length===k.limit&&(0,O.jsx)($,{collectionContextStore:t.collectionContextStore,pathKey:w,titleColumnIndex:l,limit:k.limit,indentLevel:x.length})]})},$=r.memo((function(e){window.__c={n:"NestedTableLoadMoreButton"};const{collectionContextStore:t,pathKey:o,titleColumnIndex:i,limit:s,indentLevel:l}=e,a=(0,r.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:s+20}),e.emit()}),[t,s,o]),c=(0,S.O7)(),d=(0,n.VK)((()=>u.fk({environment:c,collectionContextStore:t})),[t,c]),p=(0,n.VK)((()=>{var e;return(0,j.$4)()&&"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),h=(0,v.yK)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:8+(0,A.f2)({columnIndex:0,titleColumnIndex:i,shouldShowBulkActionsToolbar:d,indentLevel:l+1,isSubitemToggleOnTitleColumn:p}),fontSize:14,lineHeight:w.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[l,d,i,p]);return(0,O.jsxs)(K.Z,{onClick:a,onMouseDown:F.$0,style:h.button,children:[(0,x.M)(h.icon),(0,O.jsx)("span",{style:h.label,children:(0,O.jsx)(k.FormattedMessage,{defaultMessage:"Load more",id:"database.loadMoreButtonTitle"})})]})})),Q=r.memo(U);var Y=o(75498);let X=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});class q extends i.Z{constructor(){super(...arguments),this.instanceCollectionViewBlockStore=void 0,this.handleEmptyDroppableDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{collectionContextStore:i,groupsPointer:n}=this.props,s=this.emptyDroppableIntoStore.state;if(!s)return;const l=i.collectionViewBlockStore();if(!l)return;const a=m.default.mark("collections.drop_item_lag");m.default.measureAfterNextFlush(a,{environment:this.environment,getData:()=>h.yr({collectionContextStore:i,is_native_drop:!1,is_empty:!0})}),p.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:this.environment,perform:e=>{d.by({environment:this.environment,collectionStore:s,targetStore:l,droppedDirection:t,collectionContextStore:i,groupsPointer:n,droppedStores:o,duplicate:r,transaction:e})}})},this.handleEmptyDroppableNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:r,groupsPointer:i}=this.props,n=this.emptyDroppableIntoStore.state;if(!n)return;const s=r.collectionViewBlockStore();if(!s)return;const l=m.default.mark("collections.drop_item_lag");m.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>h.yr({collectionContextStore:r,is_native_drop:!0,is_empty:!0})}),p.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:this.environment,perform:e=>{d.tQ({environment:this.environment,collectionStore:n,targetStore:s,droppedDirection:o,collectionContextStore:r,groupsPointer:i,files:t,transaction:e})}})},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t,loadContentCover:o}=this.props,r=e.groupsStore.getGroupState(t);if(!r)return;const i=r.currentLimit.state,n=e.normalizedSchemaStore.state,l=c.oA(t.map((e=>(0,s.Ko)({schema:n,group:e,timeZone:(0,a.r)()}))));return{type:"results",filter:l.length>0?{operator:"and",filters:l}:void 0,limit:i,loadContentCover:o}})),this.resultStores=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return(null==o?void 0:o.resultsStore.state)??[]})),this.emptyDroppableIntoStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props;var o;return"collectionTypedView"===e.contextType?null===(o=e.groupsStore.getGroupState(t))||void 0===o||null===(o=o.resultsStore.state)||void 0===o?void 0:o[0].getAssociatedCollectionStore():e.collectionStore()}))}getNode(){return super.getNode()}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.instanceCollectionViewBlockStore=new g.G(this.environment,t.pointer))}didMountOrUpdate(){this.props.collectionContextStore.renderEmitter.emit()}renderComponent(){const{emptyDroppableStyle:e,direction:t}=this.props,o=this.props.emptyDroppableSize||"none",r=t===X.Vertical;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{style:{...r?{height:o}:{width:o},...e},children:this.renderEmptyDroppable()}),this.resultStores.state.map(((e,t,o)=>(0,O.jsx)(ee,{store:e,index:t,allResults:o,...this.props},e.id))),this.renderReducerRequest()]})}renderReducerRequest(){const{collectionContextStore:e,groupsPointer:t,disableRequest:o}=this.props;if(o)return;const r=this.resultsReducerStore.state;if(!r)return;const i=e.groupsStore.getGroupState(t);return i?(0,O.jsx)(Y.Z,{id:t.length>0?`results:${(0,l.KW)(t)}`:"collection_group_results",reducer:r,groupsPointer:t,collectionContextStore:e,resultStore:i.reducerResultStore}):void 0}renderEmptyDroppable(){const{disabled:e,analyticsName:t,direction:o,onSelectableEnter:r,canDrop:i,groupsPointer:n}=this.props;if(this.instanceCollectionViewBlockStore){const s=o!==X.Vertical&&(!e&&0===this.resultStores.state.length),l=o===X.Vertical&&!e;return(0,O.jsx)(H.Z,{store:this.instanceCollectionViewBlockStore,canSelect:!1,canEditText:!1,shouldShowHalo:!0,canDrag:!1,canDropLeft:i&&s,canNativeDropLeft:i&&s,canDropBelow:i&&l,canNativeDropBelow:i&&l,canTriggerContextMenu:!1,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.handleEmptyDroppableDrop,onNativeDrop:this.handleEmptyDroppableNativeDrop,analyticsName:t,shouldShowDropZone:i,onEnter:r,groupsPointer:n,style:o===X.Vertical?void 0:{width:"100%",height:"100%"}})}}}q.displayName="CollectionGroupResults";const J=q;function ee(e){window.__c={n:"ResultComponent"};const t=e.index===e.allResults.length-1,{collectionContextStore:o,dropzoneGap:r,resultProps:i,resultComponent:s,groupsPointer:l,shouldShowHoverMenu:a,canDrag:c,disabled:d,format:p,getItemSelectableStyle:h,handleOpenPeekPage:m,belowDropZoneMargin:g,analyticsName:S,direction:v,onSelectableEnter:y,canDrop:C,disableScrollToRevealHorizontal:f,touchDragOnly:x,blockPropertyValueOverlayStore:b,onSelectableInsertRow:w,disableSelectable:k,titleColumnIndex:P,nestedCreateSubitemButton:j,itemSelectableHaloStyle:T}=e;return(0,n.VK)((()=>u.Bm({store:e.store,collectionContextStore:o})),[o,e.store])?(0,O.jsx)(Q,{getItemSelectableStyle:h,itemSelectableHaloStyle:T,store:e.store,canDrag:c,resultProps:i,resultComponent:s,collectionContextStore:o,groupsPointer:l,shouldShowHoverMenu:a,canDrop:C&&!d,format:p,handleOpenPeekPage:m,belowDropZoneMargin:g,analyticsName:S,disabled:d,direction:v,dropzoneGap:r,onSelectableEnter:y,disableScrollToRevealHorizontal:f,touchDragOnly:x,isLast:t,subitemPath:[],titleColumnIndex:P,blockPropertyValueOverlayStore:b,onSelectableInsertRow:w,disableSelectable:k,nestedCreateSubitemButton:j}):null}},64347:(e,t,o)=>{o.d(t,{Z:()=>E});o(67294);var r=o(83355),i=o(49085),n=o(14714),s=o(80951),l=o(72126),a=o(49865),c=o(92918),d=o(30206),p=o(48936),h=o(3687),u=o(96851),m=o(85893);class g extends r.Z{UNSAFE_willMount(e){super.UNSAFE_willMount(e);const{groupFormat:t,collectionContextStore:o}=this.props;a.V$({environment:this.environment,collectionContextStore:o,groupFormat:t})}renderComponent(){const{renderGroup:e,groupFormat:t,groupsDisplayState:o,disabled:r,groupsFormatKey:i,groupAggregationKey:n,format:s,schema:l,collectionContextStore:a,onGroupHeaderAddItem:c,renderHeader:d,getGroupStyle:p,stickyLeft:g,ignoreAncestorStickyContainer:S,paddingLeft:v,isFullScreen:y,index:C,isRootChild:f,isInPeekRenderer:x,groupBy:b,isLast:w}=this.props,k=a.groupsStore.getGroupState(t);if(!k)return;const{toggleStateStore:P}=k,j=P.state,T={groupFormat:t,currentGroups:o.currentGroups,disabled:r,groupsFormatKey:i,groupAggregationKey:n,format:s,schema:l,collectionContextStore:a,isFullScreen:y,isInPeekRenderer:x,onGroupHeaderAddItem:c,stickyLeft:g,index:C,paddingLeft:v,isRootChild:f,groupBy:b};return(0,m.jsx)(u.Z,{ignoreAncestorContainer:S,renderEmitter:a.renderEmitter,isFullScreen:y,children:(0,m.jsxs)("div",{style:{width:"100%",position:"relative",...p?p({groupFormat:t,...o,index:C,isLast:w,toggleStateStore:P}):void 0},children:[d?d(T):(0,m.jsx)(h.Z,{...T}),j&&e(t)]})})}}g.displayName="CollectionGroup";const S=g;var v=o(32949),y=o(25458),C=o(75498),f=o(34232),x=o(78316),b=o(480),w=o(86628),k=o(24405),P=o(39192),j=o(356),T=o(36596),M=o(62010);function F(e){window.__c={n:"GalleryGroupShimmer"};const{width:t}=e,o=(0,b.O7)(),r=(0,w.VK)((()=>o.WindowSizeStore.state.width<=j.AY),[o]),i=(0,k.yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${r?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,r]);return(0,m.jsxs)("div",{style:i.container,children:[(0,m.jsxs)("div",{style:i.groupContainer,children:[(0,m.jsx)("div",{style:i.iconContainer,children:(0,P.P)(i.icon)}),(0,m.jsx)(T.Z,{style:i.groupShimmer})]}),(0,m.jsxs)("div",{style:i.itemsContainer,children:[(0,m.jsx)(M.I,{}),(0,m.jsx)(M.I,{}),(0,m.jsx)(M.I,{})]})]})}function A(e){const{isFullScreen:t,galleryCoverSize:o}=e,r=t?2:1,i=(0,x.rD)(o),n=l.DZ(r,(e=>(0,m.jsx)(F,{width:i},e)));return(0,m.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:n})}var I=o(95550);function G(){window.__c={n:"ListGroupShimmer"};const e=(0,k.yK)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=["50%","30%","40%"].map(((e,t)=>(0,m.jsx)(I.G,{widthPercentage:e},t)));return(0,m.jsxs)("div",{style:e.container,children:[(0,m.jsxs)("div",{style:e.groupContainer,children:[(0,m.jsx)("div",{style:e.iconContainer,children:(0,P.P)(e.icon)}),(0,m.jsx)(T.Z,{style:e.groupShimmer})]}),(0,m.jsx)("div",{style:e.rowsContainer,children:t})]})}function B(e){const{isFullScreen:t}=e,o=t?2:1,r=l.DZ(o,(e=>(0,m.jsx)(G,{},e)));return(0,m.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:r})}function _(){window.__c={n:"TableGroupShimmer"};const e=(0,k.yK)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,m.jsxs)("div",{style:e.container,children:[(0,m.jsxs)("div",{style:e.groupContainer,children:[(0,m.jsx)("div",{style:e.iconContainer,children:(0,P.P)(e.icon)}),(0,m.jsx)(T.Z,{style:e.groupShimmer})]}),(0,m.jsxs)("div",{style:e.rowsContainer,children:[(0,m.jsxs)("div",{style:e.rowContainer,children:[(0,m.jsxs)("div",{style:e.firstColumn,children:[(0,m.jsx)(T.Z,{style:e.circleShimmer}),(0,m.jsx)(T.Z,{style:e.rowShimmerShort})]}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(T.Z,{style:e.rowShimmerShort})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(T.Z,{style:e.rowShimmerShort})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(T.Z,{style:e.rowShimmerShort})})]}),(0,m.jsxs)("div",{style:e.rowContainer,children:[(0,m.jsxs)("div",{style:e.firstColumn,children:[(0,m.jsx)(T.Z,{style:e.circleShimmer}),(0,m.jsx)(T.Z,{style:e.rowShimmerLong})]}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(T.Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(T.Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(T.Z,{style:e.rowShimmer})})]}),(0,m.jsxs)("div",{style:e.lastRowContainer,children:[(0,m.jsxs)("div",{style:e.firstColumn,children:[(0,m.jsx)(T.Z,{style:e.circleShimmer}),(0,m.jsx)(T.Z,{style:e.rowShimmerLong})]}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(T.Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(T.Z,{style:e.rowShimmer})}),(0,m.jsx)("div",{style:e.column,children:(0,m.jsx)(T.Z,{style:e.rowShimmer})})]})]})]})}function Z(e){const{isFullScreen:t}=e,o=t?2:1,r=l.DZ(o,(e=>(0,m.jsx)(_,{},e)));return(0,m.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:r})}function R(){window.__c={n:"TimelineTableGroupsShimmer"};const e=(0,k.yK)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,m.jsxs)("div",{style:e.rowsContainer,children:[(0,m.jsx)("div",{style:e.rowContainer,children:(0,m.jsx)(T.Z,{style:e.rowShimmerShort})}),(0,m.jsx)("div",{style:e.rowContainer,children:(0,m.jsx)(T.Z,{style:e.rowShimmer})})]})}function D(e){window.__c={n:"GroupsShimmer"};const{viewType:t,isFullScreen:o,galleryCoverSize:r}=e;if(!(0,f.Z)(!0,0,100))return null;switch(t){case"table":return(0,m.jsx)(Z,{isFullScreen:o});case"list":return(0,m.jsx)(B,{isFullScreen:o});case"gallery":return(0,m.jsx)(A,{isFullScreen:o,galleryCoverSize:r});case"timeline":return(0,m.jsx)(R,{});case"calendar":case"board":default:return null}}class V extends r.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:i.default.createClass(void 0),hiddenGroupsVisible:i.default.createClass(!1)},this.renderResult=e=>{var t;const{disabled:o,collectionContextStore:r,groupBy:i,isFullScreen:l,shouldSurpressShimmer:a,format:p}=this.props,h=r.groupsLimit.state,u=e.hiddenGroups.slice(0,c.ew),g=r.permissionScopes.state,S=!a&&(0,d.vq)({collectionContextStore:r,displayState:e}),v=null===(t=r.collectionViewStore())||void 0===t?void 0:t.getType(),{visibleGroups:y,hiddenGroups:C,total:f}=e,x=0===y.length&&!r.shouldShowSpinner.state||y.length>0,b=h<f-C.length&&x||(0,d.gf)({collectionContextStore:r,isForColumnGroups:!1}),w=!o&&!g.isLocked&&g.canConfigureBlock&&!S&&(0,n.Wz)(i,g.canConfigureCollection)&&"collectionTypedView"!==r.contextType&&!(0,s.wl)(i.property)&&x;return(0,m.jsxs)("div",{style:{position:"relative"},children:[this.renderGroups(e.visibleGroups),S&&(0,m.jsx)(D,{viewType:v,isFullScreen:l,galleryCoverSize:p.gallery_cover_size}),b&&(0,m.jsx)(L,{renderGroupsLoadMoreButton:this.props.renderGroupsLoadMoreButton,collectionContextStore:this.props.collectionContextStore,schema:this.props.schema,displayState:e}),u.length>0&&(0,m.jsxs)(m.Fragment,{children:[this.renderHiddenGroupsButton(u),this.stores.hiddenGroupsVisible.state&&this.renderGroups(u)]}),w&&this.renderAddGroupButton()]})},this.renderGroup=(e,t,o)=>{const{renderGroup:r,disabled:i,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:c,collectionContextStore:d,isFullScreen:p,onGroupHeaderAddItem:h,renderHeader:u,getGroupStyle:g,stickyLeft:v,stickyTopHeaderOffset:y,ignoreAncestorStickyContainer:C,paddingLeft:f,isRootChild:x,groupBy:b,isInPeekRenderer:w}=this.props,k=t===o.length-1;if(d.groupsStore.getGroupState(e))return(0,m.jsx)(S,{groupBy:b,groupFormat:e,groupsDisplayState:this.groupsDisplayStateStore.state,disabled:i,groupsFormatKey:s,groupAggregationKey:l,format:a,schema:c,collectionContextStore:d,isFullScreen:p,isRootChild:x,renderGroup:r,onGroupHeaderAddItem:h,renderHeader:u,getGroupStyle:g,stickyLeft:v,stickyTopHeaderOffset:y,ignoreAncestorStickyContainer:C,paddingLeft:f,index:t,isLast:k,isInPeekRenderer:w},(0,n.mD)(e))},this.handleGroupsChange=()=>{const{format:e,groupsFormatKey:t,collectionContextStore:o}=this.props,r=this.groupsDisplayStateStore.state.currentGroups;a.$D({environment:this.environment,format:e,groupsFormatKey:t,collectionContextStore:o,currentGroups:r})},this.handleGroupsChangeDebounced=l.Ds(this.handleGroupsChange,5e3),this.handleCollectionAddGroupButtonAccept=e=>{const{collectionContextStore:t,groupsFormatKey:o,groupBy:r,schema:i}=this.props,n=t.collectionStore();n&&a.tH({update:e,collectionContextStore:t,groupsFormatKey:o,collectionStore:n,environment:this.environment,groupBy:r,schema:i})},this.reducerStore=this.createComputedStore((()=>{const{groupBy:e,disableReducerRequest:t,schema:o,format:r,groupsFormatKey:i,collectionContextStore:n}=this.props,s=n.remoteRequestStore.state;if(!t)return(0,c.ej)({groupBy:e,schema:o,format:r,filter:null==s?void 0:s.loader.filter,groupsFormatKey:i,limit:n.groupsLimit.state})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{schema:e,groupBy:t}=this.props;return(0,n.Qq)({schema:e,groupBy:t})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupBy:t,groupsFormatKey:o,format:r,schema:i,collectionContextStore:s}=this.props,l=s.groupsLimit.state,a=s.collectionViewBlockStore();if(!a)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const d=this.schemaGroupsStore.state,p=this.stores.reducerResultStore.state,h=p?p.results:void 0,u=p?p.total:0,m=(0,c.Cz)({groupBy:t,schema:i,formatGroups:r[o]||[],schemaGroups:d,reducerResults:h,getRecordModel:a.getRecordModel,relativeVariableResult:s.relativeVariableStore.state,viewAppConfigUri:null===(e=s.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}),g=m.filter((e=>!(0,n.eF)(e))).slice(0,l),S=m.filter((e=>(0,n.eF)(e)));return{currentGroups:[...g,...S],visibleGroups:g,hiddenGroups:S,total:u}}),!0)}UNSAFE_willMount(e){const{disableReducerRequest:t}=this.props;t||this.groupsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}willUnmount(){this.groupsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}renderComponent(){const e=this.reducerStore.state,t=this.groupsDisplayStateStore.state;return e?(0,m.jsx)(C.Z,{id:this.props.id,reducer:e,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>this.renderResult(t)}):this.renderResult(t)}renderGroups(e){return e.map(this.renderGroup)}renderHiddenGroupsButton(e){const{renderHiddenGroupsButton:t}=this.props;return t?t({hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e}):(0,m.jsx)("div",{style:{display:"flex"},children:(0,m.jsx)(y.ZP,{style:{marginTop:10},hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e})})}renderAddGroupButton(){const{schema:e,groupBy:t,renderAddGroupButton:o,collectionContextStore:r,paddingLeft:i}=this.props,n=this.groupsDisplayStateStore.state.currentGroups;return o?o({groupBy:t,schema:e,currentGroups:n,onAccept:this.handleCollectionAddGroupButtonAccept,groupsLimitStore:r.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:r}):(0,m.jsx)(p.ZP,{groupBy:t,schema:e,currentGroups:n,onAccept:this.handleCollectionAddGroupButtonAccept,groupsLimitStore:r.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:r,paddingLeft:i,stickyLeft:!0})}}V.displayName="CollectionGroups";const E=V;function L(e){let{displayState:t,renderGroupsLoadMoreButton:o,collectionContextStore:r,schema:i}=e;const{groupsLimit:n}=r;return o?(0,m.jsx)(m.Fragment,{children:o({visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:n,type:"default",schema:i,collectionContextStore:r})}):(0,m.jsx)("div",{style:{display:"flex"},children:(0,m.jsx)(v.ZP,{visibleGroups:t.visibleGroups,hiddenGroups:t.hiddenGroups,total:t.total,groupsLimitStore:n,type:"default",schema:i,collectionContextStore:r})})}},32949:(e,t,o)=>{o.d(t,{VJ:()=>S,ZP:()=>C,bk:()=>g,cG:()=>v});o(67294);var r=o(83355),i=o(56666),n=o(82990),s=o(68939),l=o(8406),a=o(92918),c=o(30206),d=o(12534),p=o(984),h=o(68785),u=o(89728),m=o(85893);const g=30,S=4,v=90;class y extends r.Z{constructor(){super(...arguments),this.handleClickLoadMoreGroups=()=>{const{collectionContextStore:e,groupsLimitStore:t}=this.props;t.setState(t.state+a.kW),e.loadingDetails.setState({type:"load_more_groups"}),l.tf(this.environment)},this.handleClickLoadMoreColumnGroups=()=>{const{collectionContextStore:e,groupsLimitStore:t}=this.props;t.setState(t.state+a.kW),e.loadingDetails.setState({type:"load_more_columns"}),l.tf(this.environment)},this.boardColorStore=this.createComputedStore((()=>{const{schema:e,collectionContextStore:t}=this.props;return(0,a.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t.normalizedFormatStore.state,collectionContextStore:t,theme:this.theme})}),!0)}renderComponent(){const{collectionContextStore:e,visibleGroups:t,total:o,hiddenGroups:r,type:l}=this.props,y=Math.min(a.kW,o-r.length-t.length),C=(0,c.gf)({collectionContextStore:e,isForColumnGroups:"board"===l});return"default"===l?(0,m.jsxs)(u.Z,{onClick:this.handleClickLoadMoreGroups,onMouseDown:d.$0,disabled:C,hoveredStyle:C?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",fontSize:14,borderRadius:4,height:g,marginTop:S,marginBottom:S,paddingLeft:2,paddingTop:2,paddingBottom:2,paddingRight:8,...this.props.style},children:[(0,i.o)({width:14,fill:this.theme.mediumTextColor,marginLeft:4,marginTop:1,marginRight:8}),(0,m.jsx)(s.FormattedMessage,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:y}}),C&&(0,m.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,m.jsx)(h.Z,{style:{width:12,height:12}})})]}):(0,m.jsxs)(u.Z,{onClick:this.handleClickLoadMoreColumnGroups,onMouseDown:d.$0,disabled:C,hoveredStyle:C?{background:this.theme.whiteButtonBackground}:{},style:{background:null===(f=this.boardColorStore.state)||void 0===f?void 0:f.backgroundColor,color:this.theme.mediumTextColor,fontWeight:n.Z.fontWeight.medium,paddingLeft:8,paddingRight:8,height:33,marginRight:2*p.g1,borderRadius:p.nA,width:v,...this.props.style},children:[(0,m.jsx)("span",{style:{flexGrow:1},children:(0,m.jsx)(s.FormattedMessage,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:y}})}),C?(0,m.jsx)("div",{style:{marginLeft:4},children:(0,m.jsx)(h.Z,{style:{width:12,height:12}})}):(0,i.o)({width:14,fill:this.theme.mediumTextColor,marginLeft:4,marginTop:1})]});var f}}y.displayName="CollectionGroupsLoadMoreButton";const C=y},25458:(e,t,o)=>{o.d(t,{BG:()=>d,GQ:()=>c,ZP:()=>p});o(67294);var r=o(86628),i=o(42853),n=o(68939),s=o(12534),l=o(89728),a=o(85893);const c=30,d=4;function p(e){window.__c={n:"CollectionHiddenGroupsButton"};const t=(0,r.VK)((()=>e.hiddenGroupsVisible.state),[e.hiddenGroupsVisible]);return(0,a.jsx)(l.Z,{onClick:function(){e.hiddenGroupsVisible.setState(!e.hiddenGroupsVisible.state)},onMouseDown:s.$0,style:{height:c,marginBottom:d,...e.style},icon:e=>(0,i.i)({...e,...t&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,a.jsx)(n.FormattedMessage,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}},10912:(e,t,o)=>{o.d(t,{Z:()=>P});o(57658),o(67294);var r=o(83355),i=o(27531),n=o(86628),s=o(24405),l=o(41432),a=o(80951),c=o(95538),d=o(21202),p=o(97880),h=o(12457),u=o(78316),m=o(17311),g=o(35328),S=o(26136),v=o(53827),y=o(12981),C=o(43568),f=o(81865),x=o(35541),b=o(85893);function w(e){return"number"==typeof e}class k extends r.Z{constructor(){super(...arguments),this.renderContentBlock=e=>{const{store:t,renderAdditionalBlocks:o,rendererBlockStyle:r}=this.props,n=S.G.createChildStore(t,{table:d.iU,id:e}),s=n.getType(),l=o&&void 0!==s?(0,x.u)(n):(0,v.h)(n);if(l)return(0,b.jsx)(i.D,{value:this.restrictedContentStore,children:(0,b.jsx)(l,{store:n,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,hideContent:(0,g.BX)(n),style:{fontSize:12,opacity:.8,pointerEvents:"none",...r},isQuickFind:!0,numberedListCounterStore:this.createComputedStore((()=>({depth:0,numberedListBlockIdsWithFormat:this.createNumberedListCounterStore(e)})))})},e)},this.coverStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,{ThemeStore:o}=this.environment,r=(0,u.NU)({rootStore:e,renderAdditionalBlocks:t,theme:o.state.mode});return r.image?r.image:!(this.props.showLoadingShimmer&&0===r.blockIds.length&&!r.isDefined)&&r.blockIds})),this.restrictedContentStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,o=(0,u.wK)(e,t);return o.image?void 0:o.blockIds})),this.numberedLists=this.createComputedStore((()=>{const{store:e}=this.props,t=this.coverStore.state,o=[];if(Array.isArray(t)){let r=0;for(;r<t.length;){let i=t[r],n=S.G.createChildStore(e,{table:d.iU,id:i});if(n.getType()===l.Ti.numberedList){const s=[{blockId:i,idx:1}],a=[{id:i,format:void 0,depth:s.length-1,index:s[0].idx}];for(r+=1;r<t.length&&(i=t[r],n=S.G.createChildStore(e,{table:d.iU,id:i}),n.getType()===l.Ti.numberedList);){{const e=n.getParentId();if(n.getParentId()===s[s.length-1].blockId)s.push({blockId:i,idx:1});else{let t=s[s.length-1].idx;for(;s.length>0&&s[s.length-1].blockId!==e;)t=s[s.length-1].idx,s.pop();s.push({blockId:i,idx:t+1})}a.push({id:i,format:void 0,depth:s.length-1,index:s[s.length-1].idx})}r+=1}o.push(a)}else r+=1}}return o}))}didUpdate(e){this.props.coverFormat.type!==e.coverFormat.type&&this.props.onLoadProxiedImage()}renderComponent(){const{coverFormat:e}=this.props;return"page_cover"===e.type?(0,b.jsx)(L,{store:this.props.store,coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,imageCoverWrapStyle:this.props.imageCoverWrapStyle,coverWidth:this.props.coverWidth,onLoadProxiedImage:this.props.onLoadProxiedImage,style:this.props.style,variant:this.props.variant,coverAspectFormat:this.props.coverAspectFormat,coverPosition:this.props.coverPosition,showEmptyGalleryCover:this.props.showEmptyGalleryCover,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle}):"page_content"===e.type?this.renderPageContent():"property"===e.type?(0,b.jsx)(H,{store:this.props.store,coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,imageCoverWrapStyle:this.props.imageCoverWrapStyle,onLoadProxiedImage:this.props.onLoadProxiedImage,coverWidth:this.props.coverWidth,style:this.props.style,variant:this.props.variant,coverAspectFormat:this.props.coverAspectFormat,coverPosition:this.props.coverPosition,showEmptyGalleryCover:this.props.showEmptyGalleryCover,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle,property:e.property}):void 0}renderPageContent(){const e=this.coverStore.state,t=this.restrictedContentStore.state,o=this.props.renderAdditionalBlocks&&this.props.store.isCollectionView();if(!1===e)return(0,b.jsx)(B,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,loadingShimmerStyle:this.props.loadingShimmerStyle});if(e){if(!Array.isArray(e))return o?(0,b.jsxs)("div",{style:V(this.props.variant,this.environment,this.theme,this.props.coverHeight,this.props.coverSizeFormat,this.props.coverContentFadedOverlay,this.props.contentWrapStyle),children:[(0,b.jsx)(f.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:F(),render:(e,t)=>{if(t)return(0,b.jsx)(y.Z,{style:{...T(),...O({renderCollectionImage:!0},this.props.variant,this.theme,this.props.coverHeight,this.props.coverSizeFormat),...A(),objectPosition:`center ${100*(1-j(this.props.store,this.props.coverPosition))}%`},placeholderLoadedStyle:{display:"flex",justifyContent:"center",alignItems:"end"},src:t})}}),(0,b.jsx)(D,{variant:this.props.variant}),(0,b.jsx)("div",{style:Z(this.theme,this.props.coverContentFadedOverlayStyle)})]}):(0,b.jsxs)("div",{style:I(this.props.coverHeight,this.props.coverSizeFormat,this.props.imageCoverWrapStyle),children:[(0,b.jsx)(f.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:F(this.props.coverWidth,this.props.coverSizeFormat),render:(e,t)=>{if(t)return(0,b.jsx)(y.Z,{style:{...T(this.props.style),...O({renderCollectionImage:!1},this.props.variant,this.theme,this.props.coverHeight,this.props.coverSizeFormat),...A(this.props.coverAspectFormat),objectPosition:`center ${100*(1-j(this.props.store,this.props.coverPosition))}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(D,{variant:this.props.variant})]});if(e.length>0)return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{style:V(this.props.variant,this.environment,this.theme,this.props.coverHeight,this.props.coverSizeFormat,this.props.coverContentFadedOverlay,this.props.contentWrapStyle),children:[t?e.filter((e=>t.indexOf(e)>=0)).map(this.renderContentBlock):e.map(this.renderContentBlock),this.props.coverContentFadedOverlay&&(0,b.jsx)("div",{style:Z(this.theme,this.props.coverContentFadedOverlayStyle)})]})});if(this.props.showEmptyGalleryCover)return(0,b.jsx)(G,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle})}else if(this.props.showEmptyGalleryCover)return(0,b.jsx)(G,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle})}createNumberedListCounterStore(e){const t=this.numberedLists.state;for(const o of t)if(o.find((t=>t.id===e)))return o;return[]}}k.displayName="CollectionItemCover";const P=k;function j(e,t){if(w(t))return t;if(e.getFormatStore().isDefined()){const{page_cover_position:t,card_cover_position:o}=e.getFormat();if(w(o))return o;if(w(t))return t}return.5}function T(e){return e||{}}function M(e,t){if(e)return e;switch(t){case"large":return m.Z.card.desktop.large.height;case"small":return m.Z.card.desktop.small.height;case"medium":default:return m.Z.card.desktop.medium.height}}function F(e,t){return e||(0,u.rD)(t)}function A(e){return{objectFit:void 0===e?"cover":e}}function I(e,t,o){return{height:M(e,t),position:"relative",pointerEvents:"none",overflow:"hidden",...o}}function G(e){let{coverHeight:t,coverSizeFormat:o,emptyGalleryCoverStyle:r}=e;return(0,b.jsx)("div",{style:{height:M(t,o),...r}})}function B(e){let{coverHeight:t,coverSizeFormat:o,loadingShimmerStyle:r}=e;return(0,b.jsx)("div",{style:{height:M(t,o),...r},children:(0,b.jsx)(h.Z,{show:!0,showDelay:100,showHold:0,render:e=>e?(0,b.jsx)(C.Z,{paragraphs:[{lineHeight:12,lineMargin:6,sectionWidths:[100,100,50],repeat:1,sectionMargin:0}]}):void 0})})}function _(e,t,o,r){const{ThemeStore:i}=t,n="dark"===i.state.mode;switch(e){case"default":return{};case"gallery":return{background:o.collectionGalleryPreviewCardCover,padding:"8px 8px 0",boxShadow:n?"transparent":`inset 0 -1px 0 0 ${o.regularDividerColor}`,...r};default:(0,p.t1)(e)}}function Z(e,t){return{width:"100%",height:40,position:"absolute",bottom:0,left:0,background:`linear-gradient(to bottom, transparent, ${e.accentColors.gray[30]} 100%)`,...t}}function R(e,t){switch(e){case"default":return{border:`1px solid ${t.stroke.regular}`,borderTopLeftRadius:4,borderTopRightRadius:4,borderBottomRightRadius:4,borderBottomLeftRadius:4};case"gallery":return{borderRadius:0,borderTopLeftRadius:1,borderTopRightRadius:1};default:(0,p.t1)(e)}}function D(e){let{variant:t}=e;window.__c={n:"ImageBorderComponent"};const o=(0,s.Fg)();switch(t){case"default":return null;case"gallery":return(0,b.jsx)("div",{style:{position:"absolute",left:0,right:0,bottom:0,borderBottom:`1px solid ${o.regularDividerColor}`}});default:(0,p.t1)(t)}return null}function V(e,t,o,r,i,n,s){return{height:M(r,i),pointerEvents:"none",overflow:"hidden",position:n?"relative":"static",..._(e,t,o,s),...s}}function E(e,t,o,r){return{width:"100%",height:M(o,r),...R(e,t),objectPosition:"center"}}function L(e){let{store:t,coverHeight:o,coverSizeFormat:r,imageCoverWrapStyle:i,coverWidth:l,onLoadProxiedImage:a,style:c,variant:d,coverAspectFormat:p,coverPosition:h,showEmptyGalleryCover:u,emptyGalleryCoverStyle:m}=e;window.__c={n:"PageCoverComponent"};const g=(0,s.Fg)(),S=(0,n.VK)((()=>{var e;return null===(e=t.getCover())||void 0===e?void 0:e.cover}),[t]),v=(0,n.VK)((()=>t.pointer),[t]),C=(0,n.VK)((()=>j(t,h)),[h,t]);return S?(0,b.jsxs)("div",{style:I(o,r,i),children:[(0,b.jsx)(f.Z,{url:S,isAuthenticated:!0,permissionRecord:v,width:F(l,r),onFinishedLoadingProxyUrl:e=>a(e),render:(e,t)=>{if(t)return(0,b.jsx)(y.Z,{style:{...T(c),...E(d,g,o,r),...A(p),objectPosition:`center ${100*(1-C)}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(D,{variant:d})]}):u?(0,b.jsx)(G,{coverHeight:o,coverSizeFormat:r,emptyGalleryCoverStyle:m}):null}function H(e){let{property:t,store:o,coverHeight:r,coverSizeFormat:i,imageCoverWrapStyle:l,onLoadProxiedImage:d,coverWidth:p,style:h,variant:u,coverAspectFormat:m,coverPosition:g,showEmptyGalleryCover:S,emptyGalleryCoverStyle:v}=e;window.__c={n:"PropertyComponent"};const C=(0,s.Fg)(),x=(0,n.VK)((()=>(0,a.g)(o.getPropertyValue(t)).find((e=>(0,c.SR)({url:e.url})))),[t,o]),w=(0,n.VK)((()=>o.pointer),[o]),k=(0,n.VK)((()=>j(o,g)),[g,o]);return x?(0,b.jsxs)("div",{style:I(r,i,l),children:[(0,b.jsx)(f.Z,{onFinishedLoadingProxyUrl:e=>d(e),url:x.url,isAuthenticated:!0,permissionRecord:w,width:F(p,i),render:(e,t)=>{if(t)return(0,b.jsx)(y.Z,{style:{...T(h),...E(u,C,r,i),...A(m),objectPosition:`center ${100*(1-k)}%`},src:t,loading:"lazy"})}}),(0,b.jsx)(D,{variant:u})]}):S?(0,b.jsx)(G,{coverHeight:r,coverSizeFormat:i,emptyGalleryCoverStyle:v}):null}function O(e,t,o,r,i){const{renderCollectionImage:n}=e;return{...E(t,o,r,i),objectPosition:"center center",...n&&{height:void 0,border:`1px solid ${o.lightDividerColor}`,borderBottom:"none",borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},14063:(e,t,o)=>{o.d(t,{vt:()=>be,ZP:()=>ke});var r=o(67294),i=o(83355),n=o(24405),s=o(15145),l=o(14714),a=o(47453),c=o(68939),d=o(49865),p=o(50906),h=o(14900),u=o(75018),m=o(24677),g=o(75079),S=o(78316),v=o(6776);function y(e){const{environment:t,newStore:o,previousStore:r}=e;m.eP({environment:t,store:o}),h.Z5({store:o}),v.Z.setState({store:o,editMode:"new",previousStore:r})}var C=o(39699),f=o(43250),x=o(30206),b=o(12534),w=o(17504),k=o(886),P=o(34583),j=o(3687),T=o(61838),M=o(64347),F=o(480),A=o(86628),I=o(95371),G=o(77181),B=o(27724),_=o(25348),Z=o(99036),R=o(80951),D=o(42875),V=o(72126),E=o(51365),L=o(9953),H=o(98104),O=o(95645),z=o(28651),N=o(28020),K=o(84210),W=o(33929),U=o(95697),$=o(80444),Q=o(19511),Y=o(96049),X=o(97039),q=o(78030),J=o(3386),ee=o(84076),te=o(85893);class oe extends O.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:z.Z},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:r,collectionContextStore:i}=this.props,n=S.Bm({store:t,collectionContextStore:i});if(n)return(0,te.jsx)(X.Z,{store:t,property:e,disabled:o||!t.canEdit(),locked:i.permissionScopes.state.isLocked,format:q.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:r,collectionStore:n,collectionViewStore:i.collectionViewStore(),showIfEmpty:this.isEditing.state||i.isCompactView.state,onBgClick:this.handleBlockPropertyExit,onEnter:this.handleBlockPropertyExit,onEsc:this.handleBlockPropertyExit,onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,onClick:()=>de(this.props.store)},e)},this.handleOpenPeekPage=()=>{de(this.props.store),this.props.handleOpenPeekPage()},this.handleRecordIconChange=e=>{const{store:t}=this.props,o=t.getIconStore();o&&C.createAndCommit({userAction:"CollectionListViewItem.handleRecordIconChange",environment:this.environment,perform:t=>{L.sO({store:o,value:e,transaction:t})}})},this.handleMouseMove=()=>{if(!Y.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=V.P2(this.handleMouseMove,100),this.handleMouseLeaveDebounced=V.Ds(this.handleMouseLeave,100),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered)),this.isEditing=this.createComputedStore((()=>{const e=Q.Z.state;return Boolean(e.isActive&&e.store.id===this.props.store.id)})),this.newItemEditMode=this.createComputedStore((()=>{const e=v.Z.state;return e.store&&e.store.id===this.props.store.id?e.editMode:void 0})),this.newItemPreviousStore=this.createComputedStore((()=>{const e=v.Z.state;return e.store&&e.store.id===this.props.store.id?e.previousStore:void 0})),this.handleBlockPropertyExit=()=>{E.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),m.Ys({environment:this.environment,store:this.props.store}),de(this.props.store)},this.handleTitleTab=()=>{he(ae(this.getNonEmptyProperties(),this.props.schema),this.props.blockPropertyValueOverlayStore,this.props.store,this.props.collectionContextStore,this.environment)},this.handleTitleUntab=()=>{he(le(this.getNonEmptyProperties(),this.props.schema),this.props.blockPropertyValueOverlayStore,this.props.store,this.props.collectionContextStore,this.environment)},this.handleBlockPropertyTab=()=>{pe(this.findNextOpenableProperty(),this.props.store,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.environment)},this.handleBlockPropertyUntab=()=>{pe(this.findPreviousOpenableProperty(),this.props.store,this.props.blockPropertyValueOverlayStore,this.props.collectionContextStore,this.environment)},this.shouldCaptureKeyboard=this.createComputedStore((()=>B.default.state.stores.length>0&&B.default.state.stores[0].id===this.props.store.id))}activate(){const e=ne(this.props.store,this.props.collectionContextStore);e&&(this.props.handleOpenPeekPage(),u.navigate({environment:this.environment,url:e}))}didMount(){super.didMount(),this.isEditing.state&&"new"===this.newItemEditMode.state&&H.NX({store:this.props.store.getBlockTitleStore()})}willUnmount(){super.willUnmount(),v.Z.reset(),Q.Z.reset()}renderComponent(){const{device:e}=this.environment,{showProperties:t}=this.props,o=e.isPhone&&this.props.showProperties.length>0,r=(0,te.jsx)(ce,{collectionContextStore:this.props.collectionContextStore,toggleButton:this.props.toggleButton,subitemPath:this.props.subitemPath});return o?(0,te.jsxs)("div",{style:{display:"flex"},children:[r,(0,te.jsxs)(ee.Z,{href:se(this.props.store),metaHref:ne(this.props.store,this.props.collectionContextStore),external:!1,style:(n=this.theme,{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${n.tableDividerColor}`}),innerStyle:{paddingRight:4,marginTop:10,marginBottom:10},children:[(0,te.jsx)("div",{style:{display:"flex",alignItems:"center"},children:this.renderTitle()}),(0,te.jsx)("div",{style:{display:"flex",alignItems:"center",paddingLeft:6,marginTop:4},children:t.map(this.renderProperty)})]})]}):(0,te.jsx)(J.Z,{capture:this.shouldCaptureKeyboard.state,onShiftEnter:this.props.onShiftEnter,children:(0,te.jsxs)("div",{style:{display:"flex"},children:[r,(0,te.jsxs)(ee.Z,{href:se(this.props.store),metaHref:ne(this.props.store,this.props.collectionContextStore),onClick:this.handleOpenPeekPage,external:!1,style:(i=this.isEditing.state?"multi":"single",{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:4,..."single"===i?{height:30}:{minHeight:30}}),innerStyle:{display:"flex",alignItems:"center",paddingRight:4,userSelect:this.isEditing.state?void 0:"none",WebkitUserSelect:this.isEditing.state?void 0:"none",...this.props.collectionContextStore.isCompactView.state&&!(0,U.QI)("dev_only")?{display:"inline-grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gridColumnGap:16}:{}},hoveredStyle:{background:this.isEditing.state?"transparent":this.theme.buttonHoveredBackground},pressedStyle:{background:this.isEditing.state?"transparent":this.theme.buttonPressedBackground},onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,children:[this.renderTitle(),t.map(this.renderProperty)]})]})});var i,n}renderTitle(){const{store:e,disabled:t,collectionContextStore:o,blockPropertyValueOverlayStore:r}=this.props,i=S.Bm({store:e,collectionContextStore:o});if(!i)return;const{isSyncedCollection:n}=o.permissionScopes.state;return(0,te.jsx)(X.Z,{store:e,property:n?" title":"title",disabled:t||!e.canEdit(),locked:o.permissionScopes.state.isLocked,format:q.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:r,collectionStore:i,collectionViewStore:o.collectionViewStore(),forceMouseEntered:this.mouseIsEntered.state&&!(0,N.aT)(this.props.collectionViewBlockStore.id,o.isInPeekRenderer.state),handleOpenPeekPage:this.handleOpenPeekPage,onTab:this.handleTitleTab,onUntab:this.handleTitleUntab})}findPreviousOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),r=t.isOpen?o.findIndex((e=>e===t.property)):-1,i=V.dF(o,((e,t)=>t<r&&ie(e,this.props.schema)));return i||(this.isEditing.state?"title":le(o,this.props.schema))}findNextOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),r=t.isOpen?o.findIndex((e=>e===t.property)):-1,i=o.find(((e,t)=>t>r&&ie(e,this.props.schema)));return i||(this.isEditing.state?"title":ae(o,this.props.schema))}getNonEmptyProperties(){const{store:e,schema:t,showProperties:o}=this.props;return e.isDefined()?o.filter((o=>{const r="title"!==o&&this.isEditing.state;return!R.wV({property:o,schema:t,block:e.getModel(),getRecordModel:e.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,D.r)(),intl:W.default.getIntl()})||r})):[]}}oe.displayName="CollectionListViewItem",oe.iconStyle={marginLeft:2,marginRight:6};const re=oe;function ie(e,t){const o=t[e];return Boolean(o&&!Z.uk.includes(o.type))}function ne(e,t){const{mainEditorCurrentBlockStore:o}=$.default.state;return S.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}function se(e){return(0,K.ZP)({store:e,fullyQualified:!1,pageVisitSource:s.tY.LinkInPage})}function le(e,t){return V.dF(e,(e=>ie(e,t)))}function ae(e,t){return e.find((e=>ie(e,t)))}function ce(e){let{collectionContextStore:t,toggleButton:o,subitemPath:r}=e;window.__c={n:"ToggleButton"};const i=(0,A.VK)((()=>t.currentSubitemFormatStore.state),[t]),n=(null==r?void 0:r.length)??0;if(!i)return null;const s=Math.max((n-1)*G.Hw,0)+G.gY;return o?(0,te.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,te.jsx)("div",{style:{width:s}}),o]}):(0,te.jsx)("div",{style:{minWidth:s+G.Hw}})}function de(e){h.IH({store:e})}function pe(e,t,o,r,i){if(o.state.isOpen){if("title"===e){E.xv({environment:i,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();m.eP({environment:i,store:t}),H.NX({store:e})}else e?(E.xv({environment:i,blockPropertyValueOverlayStore:o}),E.bA({environment:i,blockPropertyValueOverlayStore:o,store:t,property:e,format:q.C.ListView,collectionContextStore:r})):E.xv({environment:i,blockPropertyValueOverlayStore:o});de(t)}}function he(e,t,o,r,i){e&&E.bA({environment:i,blockPropertyValueOverlayStore:t,store:o,property:e,format:q.C.ListView,collectionContextStore:r}),de(o)}var ue=o(60503);function me(){return{marginTop:1,marginBottom:1,borderRadius:4}}const ge=r.memo((function(e){let{groupFormat:t,store:o,format:i,disabled:n,collectionContextStore:s,schema:l,blockPropertyValueOverlayStore:a}=e;const c=(0,F.O7)(),u=(0,r.useMemo)((()=>t?[t]:[]),[t]),m=(0,r.useMemo)((()=>(i.list_properties?i.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[i]),{permissionScopes:S}=(0,A.VK)((()=>({permissionScopes:s.permissionScopes.state})),[s]),f=(0,A.VK)((()=>s.groupsStore.getGroupState(u)),[u,s]),x=(0,A.VK)((()=>!n&&o.canEdit()&&S.canEditContent&&!S.isSyncedCollection),[n,o,S]),b=(0,r.useCallback)((()=>{if(!f)return;const e=s.collectionStore();if(!e||!s.shouldAllowNewItemCreation())return;const t=B.default.state.stores[0];if(!t)return;const o=s.subitemTreeStore.state,r=(0,I.DY)(o.children,(e=>e.value.store===t));if(!r)return;const i=r?(0,G.Af)(r.map((e=>e.value.store))):"",n=s.subitemExpandedStore.state.get(i),l=Boolean(null==n?void 0:n.isExpanded);C.createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:c,perform:o=>{const i=d.yk({environment:c,collectionContextStore:s,groupsPointer:f.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:r,subitemInsertDirection:l?"into":"below"});i&&y({environment:c,newStore:i,previousStore:t})}}),p.sdb(c,"list_item_edit_mode_enter",{...(0,g.Pn)(s),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[s,c,f]),w=(0,r.useCallback)(((e,t)=>{y({environment:c,newStore:t,previousStore:e})}),[c]),k=(0,r.useMemo)((()=>({schema:l,collectionViewBlockStore:o,showProperties:m,disabled:n,blockPropertyValueOverlayStore:a,collectionContextStore:s,onShiftEnter:b})),[a,s,n,b,l,m,o]),P=(0,r.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:r,indentLevel:i}=e;if(o)return(0,te.jsx)(ue.x,{store:t,collectionStore:o,subitemPath:r,indentLevel:i,collectionContextStore:s,disabled:n,groupsPointer:u,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{h.Z5({store:e,transient:!1}),v.Z.setState({store:e,editMode:"new",previousStore:void 0})}})}),[s,n,u]);return f?(0,te.jsx)(_.Z,{collectionContextStore:s,groupsPointer:u,format:i,canDrag:x,resultProps:k,canDrop:!0,resultComponent:re,disabled:n,shouldShowHoverMenu:!0,direction:_.R.Vertical,analyticsName:"list",getItemSelectableStyle:me,emptyDroppableSize:0,onSelectableInsertRow:w,nestedCreateSubitemButton:P}):null}));var Se=o(64921),ve=o(43145),ye=o(34232),Ce=o(95550);function fe(e){window.__c={n:"ListShimmer"};const{isFullScreen:t,hasGroups:o,hasPartialResults:r,hasSearchQuery:i,overrideNumShimmerRows:n}=e;if(!(0,ye.Z)(!0,0,100))return null;let s=1;void 0!==n?s=n:o||r||i||(s=t?10:3);const l=s>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],a=V.DZ(s).map((e=>(0,te.jsx)(Ce.G,{widthPercentage:e<l.length?l[e]:void 0},e)));return(0,te.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:3},children:a})}var xe=o(79954);const be=8;class we extends i.Z{constructor(){super(...arguments),this.renderGroup=e=>{const{store:t,format:o,isFullScreen:r,disabled:i,collectionContextStore:n,schema:s,blockPropertyValueOverlayStore:l}=this.props,a=e?[e]:[],c=this.isReady.state,d=n.groupsStore.getGroupState(a);if(!d)return;const p=n.permissionScopes.state,h=d.reducerResultStore.state,u=p.isSyncedCollection,m=S.VM({collectionContextStore:n,reducerResult:h,isFullScreen:r}),g=c&&!i&&t.canEdit()&&p.canEditContent&&!u,v=void 0!==h&&(null==h?void 0:h.blockIds.length)>0,y=""!==n.searchQuery.state,C=void 0!==e,f=(0,x.H0)({collectionContextStore:n,groupsPointer:a,hasPartialResults:v});return(0,te.jsxs)("div",{style:{paddingBottom:e?16:void 0},children:[(0,te.jsx)(ge,{groupFormat:e,store:t,format:o,disabled:i,collectionContextStore:n,schema:s,blockPropertyValueOverlayStore:l}),f&&(0,te.jsx)(fe,{isFullScreen:r,hasGroups:C,hasPartialResults:v,hasSearchQuery:y,overrideNumShimmerRows:n.isCompactView.state?6:void 0}),m&&(0,te.jsx)(T.ZP,{groupsPointer:a,store:t,collectionContextStore:n,format:o,isFullScreen:r,incrementLimitsInRelatedGroups:!1}),g&&(0,te.jsxs)(te.Fragment,{children:[m&&(0,te.jsx)("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),this.renderAddItemButton(d)]})]})},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o}=this.props,r=t.isLoading.state,i=t.groupsStore.getGroupState([]);if(!i)return;if("collectionVirtualView"===t.contextType)return;const n=i.reducerResultStore.state;e<k.Z.incrementScrollOffset&&n&&!r&&n.hasMore&&d.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:o,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})},this.handleAddItemClick=e=>{if(!P.M_(this.environment))return;const{collectionContextStore:t}=this.props;t.collectionStore()&&C.createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:this.environment,perform:o=>{t.collectionStore()&&function(e){var t;const{transaction:o,environment:r,results:i,collectionContextStore:n,isFullScreen:l,groupsPointer:a,insertAtIndex:c,from:m}=e;n.searchQuery.state&&h.Ug({searchQuery:"",collectionContextStore:n,isFullScreen:l});const v=null===(t=n.groupsStore.getGroupState(a))||void 0===t?void 0:t.resultsStore;if(!v)return;let C;c>0&&(C=i[c]);const f=d.IW({environment:r,collectionContextStore:n,groupsPointer:a,insertAtIndex:c,coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:m});if(!f)return;const x=f.coercionSucceeded,b=f.newStore;r.device.isMobile?u.navigateToBlock({environment:r,store:b,pageVisitSource:s.tY.Create}):x?y({environment:r,newStore:b,previousStore:C}):u.peekBlock({environment:r,store:b,peekMode:(0,S.kr)(n.collectionViewStore()),resultsStore:v,collectionContextStore:n,pageVisitSource:s.tY.Create}),p.W2j(r,{from:m,type:"page",new_page_id:b.id,...(0,g.Pn)(n)})}({transaction:o,environment:this.environment,results:e.resultsStore.state,collectionContextStore:t,isFullScreen:this.props.isFullScreen,groupsPointer:e.groupsPointer,insertAtIndex:e.resultsStore.state.length,from:"list_view_add_item_bottom"})}})},this.handleGroupHeaderAddItem=(e,t,o)=>{if(this.environment.device.isMobile)u.navigateToBlock({environment:this.environment,store:e,pageVisitSource:s.tY.Create});else if(t)y({environment:this.environment,newStore:e,previousStore:void 0});else{const{collectionContextStore:t}=this.props,{groupFormat:r}=o,i=r?[r]:[],n=t.groupsStore.getGroupState(i);u.peekBlock({environment:this.environment,store:e,peekMode:S.kr(t.collectionViewStore()),resultsStore:null==n?void 0:n.resultsStore,collectionContextStore:t,pageVisitSource:s.tY.Create})}},this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()}))}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:r,paddingRight:i,isFullScreen:n,collectionContextStore:s}=this.props,l=S.az(s,n),a=t.collection_group_by,c=s.isCompactView.state;return(0,w.Z)((t=>(0,te.jsxs)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth},className:f.nM$,children:[(0,te.jsx)(xe.Z,{store:e,shouldShowHalo:!n,canSelect:!n&&!c,analyticsName:"list",style:{...Pe(this.props.format),...c?{paddingTop:0}:{}},...t,children:a?this.renderGroups(a):this.renderGroup(void 0)}),!l&&(0,te.jsx)(ve.Z,{onChange:this.handleScrollOffsetChange})]})))}renderGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:a,isRootChild:c,isInPeekRenderer:d}=this.props;return(0,te.jsx)(M.Z,{store:t,id:"list_groups",groupBy:e,groupsFormatKey:l.Uh,groupAggregationKey:l.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderGroup,renderHeader:e=>(0,te.jsx)(je,{args:e}),getGroupStyle:e=>function(e,t){if(0===e.index)return{};return{borderTop:`1px solid ${t.tableDividerColor}`}}(e,this.theme),onGroupHeaderAddItem:this.handleGroupHeaderAddItem,paddingLeft:a,isRootChild:c,isInPeekRenderer:d,onSelectableInsertRow:(e,t)=>function(e,t,o){y({environment:o,newStore:t,previousStore:e})}(e,t,this.environment)})}renderAddItemButton(e){return(0,te.jsxs)(Se.Z,{onClick:()=>this.handleAddItemClick(e),onMouseDown:b.$0,style:{display:"flex",alignItems:"center",height:30,borderRadius:4,fontSize:14},children:[(0,a.R)((t=this.theme,{width:14,height:14,marginLeft:4,marginRight:6,fill:t.lightIconColor})),(0,te.jsx)("div",{style:{color:this.theme.lightTextColor},children:(0,te.jsx)(c.FormattedMessage,{defaultMessage:"New",id:"database.listView.addItemButtonTitle"})})]});var t}}we.displayName="CollectionListView";const ke=we;function Pe(e){return{display:"flex",flexDirection:"column",paddingTop:e.collection_group_by?void 0:be,paddingBottom:4}}function je(e){let{args:t}=e;window.__c={n:"GroupHeaderComponent"};const o=(0,n.Fg)();return(0,te.jsx)(j.Z,{...t,height:48,getComputedStickyStyle:e=>function(e,t){return{boxShadow:e?`0 -1px 0 ${t.contentBackground}`:void 0}}(e,o)})}},60503:(e,t,o)=>{o.d(t,{x:()=>f});var r=o(67294),i=o(480),n=o(86628),s=o(24405),l=o(47453),a=o(82990),c=o(68939),d=o(50906),p=o(49865),h=o(39699),u=o(40663),m=o(75079),g=o(78316),S=o(12534),v=o(40150),y=o(64921),C=o(85893);function f(e){window.__c={n:"CollectionNestedCreateSubitemButton"};const t=(0,i.O7)(),{store:o,collectionContextStore:f,disabled:x,groupsPointer:b,collectionStore:w,subitemPath:k,indentLevel:P,onSubitemCreate:j}=e,T=(0,n.VK)((()=>(0,g.fk)({environment:t,collectionContextStore:f})),[f,t]),M=(0,n.VK)((()=>{var e;return"timeline"===(null===(e=f.collectionViewStore())||void 0===e?void 0:e.getType())}),[f]),F=(0,n.VK)((()=>{var e;return(0,u.$4)()&&"title"===(null===(e=f.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[f]),A=(0,n.VK)((()=>(0,v.f2)({columnIndex:0,titleColumnIndex:0,shouldShowBulkActionsToolbar:T,indentLevel:P+1,isSubitemToggleOnTitleColumn:F})),[P,F,T]),I=(0,s.yK)((t=>({newRowButton:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:A+8,fontSize:14,lineHeight:a.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${t.tableDividerColor}`,background:t.contentBackground,left:0,right:0,...M&&{background:"none",borderTop:"none"},...e.styles},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:A+8,color:t.lightTextColor},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[A,M,e.styles]),G=(0,n.VK)((()=>{const e=f.permissionScopes.state,t=w.isSyncedCollection();return!x&&e.canEditContent&&!t}),[f,x,w]),B=(0,r.useCallback)((()=>{h.createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,perform:e=>{const r=p.yk({environment:t,collectionContextStore:f,groupsPointer:b,store:o,before:!1,collectionStore:w,transaction:e,subitemPath:k,subitemInsertDirection:"into"});r&&j(r)}}),d.JEO(t,{...(0,m.Pn)(f)})}),[f,t,b,w,o,k,j]);return G?(0,C.jsx)(y.Z,{onClick:B,onMouseDown:S.$0,style:I.newRowButton,children:(0,C.jsxs)("span",{style:I.newRowContainer,children:[(0,l.R)(I.newIcon),(0,C.jsx)("span",{style:I.newText,children:(0,C.jsx)(c.FormattedMessage,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})}):null}},5023:(e,t,o)=>{o.d(t,{Z:()=>ce});var r=o(67294),i=o(1302),n=o(49085),s=o(15145),l=o(92996),a=o(99036),c=o(6695),d=o(42875),p=o(56666),h=o(25651),u=o(95855),m=o(54497),g=o(72126),S=o(82990),v=o(68939),y=o(50906),C=o(8406),f=o(6404),x=o(51365),b=o(14900),w=o(96802),k=o(9953),P=o(75018),j=o(24677),T=o(98104),M=o(39699),F=o(95645),A=o(28651),I=o(49616),G=o(75079),B=o(52821),_=o(78316),Z=o(84210),R=o(33929),D=o(68056),V=o(65598),E=o(80444),L=o(19511),H=o(96049),O=o(22294),z=o(88923),N=o(27724),K=o(24666),W=o(87636),U=o(984),$=o(10912),Q=o(97039),Y=o(78030),X=o(65089),q=o(64921),J=o(3386),ee=o(84076),te=o(31278),oe=o(26388),re=o(97496),ie=o(65187),ne=o(56282),se=o(85893);const le=(0,v.defineMessages)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder"}});class ae extends F.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={mouseStore:A.Z,editModeStore:n.default},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:r,handleRepositionClick:i,handleSavePositionClick:n}=e;const{store:s,coverFormat:l,coverAspectFormat:a,collectionContextStore:c}=this.props,{device:d}=this.environment,{isMobile:u}=d,m=this.lastProxiedUrl&&l&&"contain"!==a,g=c.permissionScopes.state,S=s.canEdit()&&("collectionTypedView"===c.contextType||g.canEditContent);if(t&&!this.shouldShowActionButton.state)return;const y=z.default.state.open&&z.default.state.target.id===s.id,C=_.kr(null==c?void 0:c.collectionViewStore()),f=(0,I.X9)(C,!1);return(0,se.jsxs)(W.Z,{isVisible:t,position:"top",children:[m&&!o&&!u&&(0,se.jsx)(q.Z,{style:re.ar,onClick:e=>i(e,this.lastProxiedUrl),children:(0,se.jsx)(v.FormattedMessage,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),m&&o&&!u&&(0,se.jsx)(q.Z,{style:re.ar,onClick:n,children:(0,se.jsx)(v.FormattedMessage,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),m&&o&&!u&&(0,se.jsx)(q.Z,{style:re.ar,onClick:r,children:(0,se.jsx)(v.FormattedMessage,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),this.shouldShowEditButton.state&&S&&!this.normalizedCardSelectionStore.state&&!g.isSyncedCollection&&(0,se.jsx)(oe.Z,{renderTooltip:()=>(0,se.jsx)(v.FormattedMessage,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:e=>(0,se.jsx)(q.Z,{style:re.ar,onClick:()=>{this.handleEditButtonClick("click")},...e,children:(0,h.R)({width:16,height:16})})}),this.normalizedCardSelectionStore.state&&!y&&(0,se.jsx)(oe.Z,{renderTooltip:()=>f.tooltip,render:e=>(0,se.jsx)(q.Z,{style:re.ar,onClick:()=>{this.peekUrl.state&&(P.navigate({environment:this.environment,url:this.peekUrl.state}),this.disallowEmptyDelete())},...e,children:f.icon({width:14,height:14})})}),!o&&(0,se.jsx)(oe.Z,{renderTooltip:()=>(0,se.jsx)(v.FormattedMessage,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip"}),render:e=>(0,se.jsx)(q.Z,{style:re.ar,onClick:this.handleActionButtonClick,...e,children:(0,p.o)({width:14,height:14})})})]})},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:r,collectionContextStore:i}=this.props,n=t.getAssociatedCollectionStore();if(!n)return;const s=this.normalizedCardSelectionStore.state,l="gallery"===he(this.props.collectionContextStore)?Y.C.GalleryView:Y.C.Board,a=Boolean(i.normalizedFormatStore.state.table_wrap);return(0,se.jsx)(Q.Z,{store:t,property:e.property,disabled:o||!t.canEdit(),locked:i.permissionScopes.state.isLocked,format:l,tableWrap:a||Boolean(e.wrap),blockPropertyValueOverlayStore:r,collectionStore:n,showIfEmpty:s,onEnter:this.handleBlockPropertyEsc,onEsc:this.handleBlockPropertyEsc,onBgClick:this.handleBlockPropertyEsc,onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e.property)},this.renderDiscussionIndicator=()=>{const{store:e}=this.props,t=V.Xp(e,{recursivelyLoadAllDiscussions:!1});if(t>0)return(0,se.jsxs)("div",{style:this.getDiscussionIndicatorWrapStyle(),children:[(0,u.z)({width:14,height:14,marginRight:4,fill:this.theme.mediumIconColor}),t]})},this.handleFlushTemporaryPosition=e=>{let{imagePosition:t,reset:o}=e;M.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{w.bf({store:this.props.store,coverPosition:t,transaction:e}),o()}})},this.handleBlockEnter=()=>{const{store:e,onTextEnter:t}=this.props;t&&t(e)},this.handleBlockSpace=()=>{this.handleEditButtonClick("space")},this.handleEditButtonClick=e=>{const{store:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores,i=(0,B.JI)(t);j.eP({environment:this.environment,store:t}),T.NX({store:i}),b.Z5({store:t}),e&&y.sdb(this.environment,"board_item_edit_mode_enter",{...(0,G.Pn)(o),block_id:t.id,from:e,view_type:he(this.props.collectionContextStore)}),r.setState("existing")},this.handleClick=e=>{this.normalizedCardSelectionStore.state?e.preventDefault():(this.props.handleOpenPeekPage(),this.disallowEmptyDelete())},this.handleActionButtonClick=e=>{const{collectionContextStore:t}=this.props;j.Ys({environment:this.environment,store:this.props.store}),f.Qn({environment:this.environment,stores:N.default.state.stores,left:e.clientX,top:e.clientY,showInput:!0,actionSectionGroupKey:"default",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:t}})},this.handleTextEnter=()=>{const{store:e,onTextEnter:t,onTextEsc:o,collectionContextStore:r}=this.props,{editModeStore:i}=this.stores;b.MO(),T.ZH(this.environment);e.canEdit()&&r.permissionScopes.state.canEditContent&&("new_empty"===i.state?o(e):"new"===i.state?t(e):j.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextEsc=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores;b.MO();e.canEdit()&&o.permissionScopes.state.canEditContent&&("new_empty"===r.state?t(e):j.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=this.getShowProperties().map((e=>e.property));o.length>0&&x.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:o[0],format:Y.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleTrackTitlePropertyEdit=()=>{const e=he(this.props.collectionContextStore);if(!e)return;const{store:t,collectionContextStore:o}=this.props;C.rv({environment:this.environment,collectionContextStore:o,block_id:t.id,property:"title",property_type:"text",from:e}),this.disallowEmptyDelete()},this.handleTextUntab=()=>{const e=this.getShowProperties().map((e=>e.property)),t=g.dF(e,((e,t)=>de(e,this.props.schema)));t&&x.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,property:t,format:Y.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleBlockPropertyEsc=()=>{x.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),j.Ys({environment:this.environment,store:this.props.store}),this.disallowEmptyDelete()},this.handleBlockPropertyTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state,r=this.getShowProperties().map((e=>e.property)),n=o.isOpen?r.findIndex((e=>e===o.property)):-1,s=r.find(((e,t)=>t>n&&de(e,this.props.schema)))||r.find(((e,t)=>!this.normalizedCardSelectionStore.state&&de(e,this.props.schema)));s?i.default.afterNextFlush((()=>{x.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:s,format:Y.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&i.default.afterNextFlush((()=>{this.handleEditButtonClick()})),x.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleBlockPropertyUntab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state;if(!o.isOpen)return;const r=this.getShowProperties().map((e=>e.property)),n=r.findIndex((e=>e===o.property)),s=g.dF(r,((e,t)=>t<n&&de(e,this.props.schema)))||g.dF(r,((e,t)=>!this.normalizedCardSelectionStore.state&&de(e,this.props.schema)));s?i.default.afterNextFlush((()=>{x.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:s,format:Y.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&i.default.afterNextFlush((()=>{this.handleEditButtonClick()})),x.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleMouseMove=()=>{if(!H.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=g.P2(this.handleMouseMove,100),this.handleMouseLeaveDebounced=g.Ds(this.handleMouseLeave,100),this.handleRecordIconChange=async e=>{const{store:t}=this.props,o=t.getIconStore();if(o){const{serverCommitResult:t}=M.createAndCommit({userAction:"PageViewBlock.handleRecordIconChange",environment:this.environment,perform:t=>{k.sO({store:o,value:e,transaction:t})}});await t}this.disallowEmptyDelete()},this.tryDeleteEmptyOnBlur=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores;"new_empty"!==r.state||this.normalizedCardSelectionStore.state||o.defaultPageTemplateStore.state||(t(e),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur))},this.normalizedCardSelectionStore=this.createComputedStore((()=>{const e=L.Z.state;return e.isActive&&e.store===this.props.store})),this.isItemSelectedStore=this.createComputedStore((()=>N.default.state.stores.includes(this.props.store))),this.shouldShowEditButton=this.createComputedStore((()=>{const e=this.isEditingTitle.state,t=ue(this.props.format,this.props.collectionContextStore),o=this.getShowProperties();return!e&&(this.props.shouldShowTitle||t.length>0&&t.length!==o.length)})),this.isEditingTitle=this.createComputedStore((()=>{var e;const{blockPropertyValueOverlayStore:t}=this.props,o=K.default.state;return"editing"===o.mode&&(null===(e=(0,D.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,B.JI)(this.props.store)&&!t.state.isOpen})),this.peekUrl=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=E.default.state;return _.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.pageUrl=this.createComputedStore((()=>{const{store:e}=this.props;return(0,Z.ZP)({store:e,fullyQualified:!1,pageVisitSource:s.tY.LinkInPage})})),this.shouldShowActionButton=this.createComputedStore((()=>{const{device:e}=this.environment,{isKeyboardMode:t}=O.Z.state;return!e.isMobile&&this.canEdit()&&!t})),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered&&!H.Z.state)),this.disallowEmptyDelete=()=>{const{editModeStore:e}=this.stores;"new_empty"===e.state&&(e.setState("new"),L.Z.state.isActive&&L.Z.setState({...L.Z.state,transient:!1}))}}activate(){const e=this.peekUrl.state;e&&(this.props.handleOpenPeekPage(),P.navigate({environment:this.environment,url:e}))}UNSAFE_willMount(){var e;const{editModeStore:t}=this.stores,o=K.default.state,r="editing"===o.mode&&(null===(e=(0,D.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,B.JI)(this.props.store),i=L.Z.state,n=i.isActive&&i.transient;r&&n?t.setState("new_empty"):r?t.setState("new"):t.setState("existing")}didMount(){const{editModeStore:e}=this.stores;super.didMount(),this.normalizedCardSelectionStore.state&&"new_empty"===e.state&&this.normalizedCardSelectionStore.addListener(this.tryDeleteEmptyOnBlur)}willUnmount(){super.willUnmount(),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur)}renderComponent(){const{device:e}=this.environment,{store:t,coverFormat:o,coverAspectFormat:i,coverWidth:n,coverHeight:s,coverSizeFormat:l,shouldShowTitle:a,colorStyle:c,onShiftEnter:d}=this.props,p=this.pageUrl.state,h=this.peekUrl.state,u=this.mouseIsEntered.state,m=this.normalizedCardSelectionStore.state,g=he(this.props.collectionContextStore),S=(0,r.createRef)(),v=(0,se.jsxs)(ee.Z,{ref:S,style:{...me(this.props.colorStyle,this.props.collectionContextStore,this.theme),position:u?"relative":"static",..."gallery"===g&&{height:"100%"}},innerStyle:{userSelect:m?void 0:"none",WebkitUserSelect:m?void 0:"none",height:"100%",..."board"===g&&{minHeight:40},..."gallery"===g&&{display:"flex",flexDirection:"column"}},hoveredStyle:{background:m?"transparent":(null==c?void 0:c.cardHoveredBackgroundColor)||this.theme.cardHoveredBackground},pressedStyle:{background:m?"transparent":(null==c?void 0:c.cardPressedBackgroundColor)||this.theme.cardPressedBackground},href:p,metaHref:e.isMobile?p:h,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,onClick:this.handleClick,children:[(0,se.jsx)(ne.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:this.handleFlushTemporaryPosition,source:g,small:"small"===l,store:this.props.store,renderControl:this.renderControl,render:e=>{let{imagePosition:r}=e;return o&&(0,se.jsx)($.Z,{variant:"gallery",store:t,coverWidth:n,coverHeight:s,coverFormat:o,coverAspectFormat:i,coverSizeFormat:l,coverPosition:r,showEmptyGalleryCover:"gallery"===g,onLoadProxiedImage:e=>{this.lastProxiedUrl=e}})}}),a&&this.renderTitle(),this.renderProperties(),this.renderDiscussionIndicator()]}),y=this.isItemSelectedStore.state;return(0,se.jsx)(J.Z,{capture:m,onEsc:()=>{b.MO(),this.disallowEmptyDelete()},onEnter:this.handleBlockEnter,onSpace:this.handleBlockSpace,onTab:this.handleBlockPropertyTab,onUntab:this.handleEditButtonClick,children:(0,se.jsxs)(J.Z,{capture:y,onShiftEnter:()=>{M.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{d({blocks:N.default.state.stores,transaction:e})}})},children:[v,pe(this.props.store,this.props.collectionContextStore)&&(0,se.jsx)(X.bZ,{origin:S})]})})}renderTitle(){const{device:e}=this.environment,{store:t,collectionContextStore:o}=this.props,r=(0,B.JI)(t),i=t.hasIcon()||!t.isEmptyPage(),n=t.hasError(),s=t.canEdit()&&o.permissionScopes.state.canEditContent,l=this.normalizedCardSelectionStore.state,a=he(this.props.collectionContextStore),c=s?(0,se.jsx)(te.Z,{disabled:!1,bucket:"secure",style:{...ge(this.props.collectionContextStore),...e.isMobile?ae.mobileTitleIconStyle:ae.desktopTitleIconStyle,..."board"===a&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:t.getIcon(),store:t,onChange:this.handleRecordIconChange,size:e.isMobile?24:20,isEmptyPage:t.isEmptyPage()}):(0,se.jsx)(te.Z,{disabled:!0,bucket:"secure",style:{...ge(this.props.collectionContextStore),...e.isMobile?ae.mobileTitleIconStyle:ae.desktopTitleIconStyle},progressContainerStyle:{top:14,bottom:"unset",right:"unset",fontSize:12},icon:t.getIcon(),store:t,size:e.isMobile?24:s?20:18,isEmptyPage:t.isEmptyPage()}),d=(0,se.jsx)(ie.Z,{store:r,disabled:!l,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:this.handleTextEnter,onEsc:this.handleTextEsc,onTab:this.handleTextTab,onUntab:this.handleTextUntab,onChange:this.handleTrackTitlePropertyEdit,placeholder:l?R.default.formatMessage(le.typeAName):R.default.formatMessage(le.untitledBlock),style:{...e.isMobile?ae.mobileTitleTextStyle:ae.desktopTitleTextStyle,..."board"===a&&{flexGrow:1,padding:2},pointerEvents:l?void 0:"none",cursor:l?"text":void 0,..."gallery"===a&&{whiteSpace:"pre-wrap"}},disableSelectAllBlocks:!0,pasteBehavior:"inline"});return(0,se.jsxs)("div",{style:this.getTitleWrapStyle(),children:[(i||l)&&!n&&c,n&&(0,m.t)({fill:this.theme.accentColors.orange[500],width:e.isMobile?20:16,marginLeft:e.isMobile?2:4,marginRight:e.isMobile?4:6,paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom"}),d]})}renderProperties(){const e=this.getShowProperties();if(0!==e.length)return(0,se.jsx)("div",{style:Se(this.props.shouldShowTitle,this.props.collectionContextStore),children:e.map(this.renderProperty)})}getShowProperties(){const{store:e,schema:t}=this.props,o=ue(this.props.format,this.props.collectionContextStore);if(!e.isDefined())return[];return o.filter((o=>{const r=this.normalizedCardSelectionStore.state&&"title"!==o.property;return c.XU({block:e.getModel(),property:o.property,schema:t,getRecordModel:this.props.store.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,d.r)(),intl:R.default.getIntl()})||r}))}hasNoProperties(){return 0===this.getShowProperties().length}getTitleWrapStyle(){const e=he(this.props.collectionContextStore);return{..."gallery"===e&&{width:"100%"},display:"flex",paddingTop:8,paddingLeft:"board"===e?6:10,paddingRight:10,paddingBottom:"gallery"===e&&this.hasNoProperties()?10:6,position:"relative"}}getDiscussionIndicatorWrapStyle(){const e=he(this.props.collectionContextStore);return{display:"flex",alignItems:"center",color:this.theme.lightTextColor,fill:this.theme.lightTextColor,fontWeight:S.Z.fontWeight.semibold,fontSize:12,paddingLeft:10,paddingRight:10,paddingBottom:8,..."gallery"===e&&{paddingTop:this.hasNoProperties()&&!this.props.shouldShowTitle?8:0}}}}ae.displayName="CollectionViewCardItem",ae.desktopTitleIconStyle={float:"left",marginTop:2,marginRight:4,marginLeft:-2},ae.mobileTitleIconStyle={float:"left",marginTop:0,marginRight:4,marginLeft:-2},ae.desktopTitleTextStyle={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:S.Z.fontWeight.medium,width:"auto"},ae.mobileTitleTextStyle={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:S.Z.fontWeight.medium,width:"auto"};const ce=ae;function de(e,t){const o=t[e];return Boolean(o&&!a.uk.includes(o.type))}function pe(e,t){var o,r,i;return!(e.getSpaceId()!==(null===(o=E.default.state.currentSpaceStore)||void 0===o?void 0:o.id))&&((null===(r=t.collectionViewStore())||void 0===r?void 0:r.getFormat().app_config_uri)===l.g3&&e.getFormat().app_config_uri===l.z3&&"sprint_board"===(null===(i=E.default.state.mainEditorCurrentBlockStore)||void 0===i?void 0:i.getFormat().special_page_for_pm_launch))}function he(e){const t=e.collectionViewStore();return null==t?void 0:t.getType()}function ue(e,t){return(("board"===he(t)?e.board_properties:e.gallery_properties)||[]).filter((e=>e.visible))}function me(e,t,o){const r=he(t);return{boxShadow:e?o.selectTypeBoardBoxShadow:o.lightBoxShadow,borderRadius:"board"===r?4:3,background:"board"===r?(null==e?void 0:e.cardBackgroundColor)||o.boardItemDefaultBackground:o.collectionGalleryPreviewCardBackground,overflow:"hidden",transition:"background 100ms ease-out",..."board"===r&&{marginBottom:U.ay}}}function ge(e){return{..."board"===he(e)&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}}}function Se(e,t){return{paddingTop:e?0:8,paddingBottom:10,..."board"===he(t)&&{lineHeight:1.5,paddingBottom:4,display:"flex",flexDirection:"column"}}}},96851:(e,t,o)=>{o.d(t,{Z:()=>g});var r=o(45697),i=o.n(r),n=o(73935),s=o(83355),l=o(72126),a=o(8695),c=o(73744),d=o(77546),p=o(49085);class h extends p.default{getInitialState(){return{containerMap:new Map}}}const u=h;class m extends s.Z{constructor(){super(...arguments),this.element=void 0,this.scrollableAncestor=void 0,this.resizingAncestor=void 0,this.callbackQueued=!1,this.resizeObserver=new ResizeObserver((()=>{this.handleScroll()})),this.storeTypes={store:u},this.handleScroll=()=>{this.callbackQueued||(this.callbackQueued=!0,window.requestAnimationFrame((()=>{this.callbackQueued=!1,this.mutateDOM((()=>{a.rd({environment:this.environment,container:this})}))})))},this.handleResizeThrottled=l.P2(this.handleScroll,100)}didMount(){const e=a.iN(this);a.H7({container:this,parentContainer:e}),(0,d.Gf)(this.environment)&&this.attachEvents()}willUnmount(){const e=a.iN(this);a.pT({container:this,parentContainer:e}),(0,d.Gf)(this.environment)&&this.removeEvents(),this.element=void 0,this.scrollableAncestor=void 0}getChildContext(){return{...this.context,computedStickyContainer:this}}renderComponent(){if(this.props.children)return this.props.children}attachEvents(){const e=a.iN(this),t=n.findDOMNode(this);if(t){this.element=t;const o=(0,d.VW)(t);o&&(this.scrollableAncestor=o,e||((0,c.lj)(o,"scroll",this.handleScroll),(0,c.lj)(window,"resize",this.handleResizeThrottled),this.resizeObserver.observe(this.element)));const r=(0,d.Ez)(this.element);r&&(this.resizingAncestor=r,this.resizeObserver.observe(this.resizingAncestor))}this.props.renderEmitter&&this.props.renderEmitter.addListener(this.handleScroll)}removeEvents(){this.scrollableAncestor&&((0,c.ZV)(this.scrollableAncestor,"scroll",this.handleScroll),(0,c.ZV)(window,"resize",this.handleResizeThrottled),this.element&&this.resizeObserver.unobserve(this.element)),this.resizingAncestor&&this.resizeObserver.unobserve(this.resizingAncestor),this.props.renderEmitter&&this.props.renderEmitter.removeListener(this.handleScroll)}}m.displayName="ComputedStickyContainer",m.contextTypes={computedStickyContainer:i().any,...s.w},m.childContextTypes={computedStickyContainer:i().any,...s.w};const g=m},26964:(e,t,o)=>{o.d(t,{Z:()=>d});o(21703);var r=o(45697),i=o.n(r),n=o(67294),s=o(73935),l=o(83355),a=o(8695);o(95477);class c extends l.Z{constructor(){super(...arguments),this.element=void 0}didMount(){const{computedStickyContainer:e}=this.context;e&&a.ui({element:this,container:e});const t=s.findDOMNode(this);if(t){this.element=t;const e=this.props.getComputedStyle?this.props.getComputedStyle(!1):void 0;e&&a.Ut(t,e)}}willUnmount(){const{computedStickyContainer:e}=this.context;e&&a.so({element:this,container:e}),this.element=void 0}renderComponent(){if(this.props.children)return n.Children.only(this.props.children)}}c.displayName="ComputedStickyElement",c.contextTypes={computedStickyContainer:i().any,...l.w};const d=c},44043:(e,t,o)=>{o.d(t,{Z:()=>k});o(67294);var r=o(83355),i=o(6695),n=o(56666),s=o(50906),l=o(96802),a=o(39699),c=o(31945),d=o(73063),p=o(53437),h=o(480),u=o(72126),m=o(68939),g=o(87279),S=o(52275),v=o(78140),y=o(32163),C=o(72495),f=o(85893);const x=(0,m.injectIntl)((function(e){const{limit:t}=e;return(0,f.jsx)(m.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:t.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}));const b=(0,m.injectIntl)((function(e){window.__c={n:"FirstLoadLimitSelectMenu"};const t=(0,h.O7)(),{device:o}=t,{currentLimit:r,onAccept:n,onClose:s,showTitle:l}=e,a=[{key:0,render:e=>(0,f.jsx)(C.Z,{enableActionSheetTitle:!0,title:l&&(0,f.jsx)(m.FormattedMessage,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:u.oA(i.jk.map(((e,t)=>({key:t,render:t=>(0,f.jsx)(S.Z,{...t,disabled:!1,title:(0,f.jsx)(x,{limit:e}),checkState:u.Xy(r,e)}),action:()=>n(e)}))))}];let c;return c=o.isMobile?{menuType:g.og.ActionSheet}:{menuType:g.og.Popup,width:200},(0,f.jsx)(v.Z,{...c,children:(0,f.jsx)(y.Z,{type:y.i.Vertical,sections:a,onAccept:s,initialFocus:void 0})})}));class w extends r.Z{constructor(){super(...arguments),this.renderPopup=e=>{return(0,f.jsx)(b,{currentLimit:(t=this.props.format,(0,i.rx)(t.inline_collection_first_load_limit,Boolean(t.collection_group_by))),onAccept:this.handleFirstLoadLimitAccept,onClose:e.close,showTitle:!0});var t},this.handleFirstLoadLimitAccept=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();if(!o)return;const r=o.getType();r&&(a.createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:this.environment,perform:t=>{l.FH({stores:[o],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),s.wds(this.environment,{view_type:r,action:"set_first_load_limit"}))}}renderComponent(){const{device:e}=this.environment;return(0,f.jsx)(c.ZP,{popupType:e.isMobile?p.kQ.SlideUp:p.kQ.Popup,renderOrigin:e=>(0,f.jsx)(d.Z,{icon:n.o,style:{marginLeft:4,marginRight:4},...e}),alignmentToOrigin:c.vR.End,placementToOrigin:c.pO.Bottom,originGap:8,render:this.renderPopup})}}w.displayName="FirstLoadLimitActionButton";const k=w},62010:(e,t,o)=>{o.d(t,{I:()=>l});o(67294);var r=o(24405),i=o(356),n=o(36596),s=o(85893);function l(e){window.__c={n:"GalleryItemShimmer"};const t=e.minHeight||i.Ju,o=(0,r.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,s.jsx)(n.Z,{style:o.card})}},95550:(e,t,o)=>{o.d(t,{G:()=>s});o(67294);var r=o(24405),i=o(36596),n=o(85893);function s(e){window.__c={n:"ListItemShimmer"};const{widthPercentage:t}=e,o=(0,r.yK)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t]);return(0,n.jsx)("div",{style:o.rowContainer,children:(0,n.jsxs)("div",{style:o.column,children:[(0,n.jsx)(i.Z,{style:o.circleShimmer}),(0,n.jsx)(i.Z,{style:o.rowShimmer})]})})}},10732:(e,t,o)=>{o.d(t,{Z:()=>c,u:()=>a});var r=o(67294),i=o(86628),n=o(72126),s=o(68785),l=o(85893);function a(e,t){const{calculating:o,aggregation:r}=e.asyncAggregationStatus.state;return r?o&&(0,n.Xy)(t,r):o}function c(e){let{collectionContextStore:t,aggregation:o,children:n}=e;window.__c={n:"AggregationCalculatingIndicator"};const{isCalculating:c,changingType:d}=(0,i.VK)((()=>({isCalculating:a(t,o),changingType:t.asyncAggregationStatus.state.changingType})),[t,o]),p=function(e,t){const o=(0,r.useRef)(e);return(0,r.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(n,c);return c?d?(0,l.jsx)(s.Z,{}):(0,l.jsx)("span",{style:{opacity:.5},children:p??n}):(0,l.jsx)(l.Fragment,{children:n})}},57042:(e,t,o)=>{o.d(t,{Z:()=>r});const r=(0,o(68939).defineMessages)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating…)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating…)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating…"}})},30206:(e,t,o)=>{o.d(t,{$t:()=>l,H0:()=>i,gf:()=>s,vq:()=>n});var r=o(72126);function i(e){const{collectionContextStore:t,groupsPointer:o,hasPartialResults:i}=e,n=t.shouldShowSpinner.state,s="load_general"===t.loadingDetails.state.type&&!i||"load_more_blocks"===t.loadingDetails.state.type&&r.Xy(t.loadingDetails.state.group,o);return n&&s}function n(e){const{collectionContextStore:t,displayState:o}=e;return t.shouldShowSpinner.state&&0===o.visibleGroups.length}function s(e){const{collectionContextStore:t,isForColumnGroups:o}=e,r=o?"load_more_columns":"load_more_groups";return t.isLoading.state&&t.loadingDetails.state.type===r}function l(e){const{collectionContextStore:t,groupsPointer:o}=e;return t.shouldShowSpinner.state&&"load_more_blocks"===t.loadingDetails.state.type&&r.Xy(t.loadingDetails.state.group,o)}},34232:(e,t,o)=>{o.d(t,{Z:()=>i});var r=o(67294);function i(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const[n,s]=(0,r.useState)(i),l=(0,r.useRef)(null),a=(0,r.useRef)(null);return(0,r.useLayoutEffect)((()=>{null!==a.current&&window.clearTimeout(a.current),null!==l.current&&window.clearTimeout(l.current),a.current=null,l.current=null,e?0===t?s(!0):l.current=window.setTimeout((()=>{l.current=null,s(!0)}),t):0===o?s(!1):a.current=window.setTimeout((()=>{a.current=null,s(!1)}),o)}),[e,t,o]),n}},6027:(e,t,o)=>{o.d(t,{Z:()=>i});var r=function(e){return e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e}(r||{});const i=r}}]);