"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7417,71],{49670:(e,t,o)=>{o.d(t,{V:()=>_,Z:()=>M});o(67294);var n=o(83355),i=o(49085),r=o(92996),s=o(34296),l=o(47453),a=o(4615),c=o(82990),p=o(68939),d=o(8406),u=o(5149),m=o(14900),h=o(94419),g=o(39699),S=o(40663),y=o(89014),f=o(83319),x=o(13005),v=o(42917),C=o(71846),b=o(72495),w=o(85893);class j extends n.Z{constructor(){super(...arguments),this.storeTypes={inputStore:i.default.createClass("")},this.searchSessionId="",this.handleNewCollectionClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t}=this.props;d.wd({environment:this.environment,collectionContextStore:e,action:"select_new_collection"});const o=this.stores.inputStore.state;u.E3({collectionSettingsStore:t});const n=e.collectionViewStore(),i=e.collectionViewBlockStore();n&&i&&u.nr({environment:this.environment,selectedDBType:r.br,collectionName:o,collectionContextStore:e,collectionViewBlockStore:i,collectionViewStore:n,useTemporaryRecordCache:!1,baseViewType:"table"})},this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o}=this.props;g.createAndCommit({userAction:"CollectionSettingsCreateViewSource.handleSourcePickerAccept",environment:this.environment,perform:o=>{m.yc({environment:this.environment,collectionContextStore:t,collectionStore:e,transaction:o});const n=t.collectionViewStore(),i=t.collectionViewBlockStore(),r=e.getParentBlockStore();n&&r&&null!=i&&i.isDefined()&&(0,S.h7)(i)&&h.BE({parent:r.getCollectionViewsStore(),insert:n,transaction:o})}}),_({collectionStore:e,collectionContextStore:t,collectionSettingsStore:o})}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,{inputStore:o}=this.stores,n=e.collectionViewBlockStore(),i=e.collectionStore();if(!n)return;const r=e.getCollectionViewBlockSourceState(),a=o.state;return(0,w.jsx)(x.ZP,{...this.props,title:(0,w.jsx)(p.FormattedMessage,{defaultMessage:"Select data source",id:"database.viewSettings.createViewSourceTab.title"}),handleClose:()=>{d.tW({environment:this.environment,eventName:"abandoned_search",queryLength:a.length,sessionId:this.searchSessionId,source:s.S.Source}),u.E3({collectionSettingsStore:t})},footer:"uninitialized"===r&&(0,w.jsx)(b.Z,{topBorder:!0,children:(0,w.jsx)(v.Z,{icon:l.R,isGray:!0,title:a?(0,w.jsx)(p.FormattedMessage,{defaultMessage:"New database “{filterText}”",id:"database.viewSettings.createViewSourceTab.newCollectionWithNameButton.title",values:{filterText:(0,w.jsx)("span",{style:{...c.Z.textOverflowStyle,fontWeight:c.Z.fontWeight.medium,maxWidth:160,display:"inline-block",verticalAlign:"bottom"},children:a})}}):(0,w.jsx)(p.FormattedMessage,{defaultMessage:"New database",id:"database.viewSettings.createViewSourceTab.newCollectionButton.title"}),onClick:this.handleNewCollectionClick})}),children:(0,w.jsx)(C.Z,{collectionContextStore:e,selectedCollectionStore:i,parentStore:n,onAccept:this.handleSourcePickerAccept,context:s.S.Source,inputStore:o,searchSessionId:this.searchSessionId})})}UNSAFE_willMount(){this.searchSessionId=(0,a.ZP)()}}async function _(e){const{collectionStore:t,collectionContextStore:o,collectionSettingsStore:n}=e,i=o.collectionViewBlockStore(),r=o.collectionViewStore(),s=t.getParentBlockStore();if(!i||!s||!r)return;await Promise.all([...s.getCollectionViewStores().map((e=>e.load())),...i.getCollectionViewStores().map((e=>e.load()))]);(0,f.g)({collectionStore:t,sourceCollectionViewBlockStore:s,currentCollectionViewBlockStore:i,currentCollectionViewStore:r,constraints:(0,y.x)(r.id)}).length>0?u.H4({collectionSettingsStore:n,item:{type:"duplicateExistingView"}}):u.H4({collectionSettingsStore:n,item:{type:"createView"}})}j.displayName="CollectionSettingsCreateViewSource";const M=(0,p.injectIntl)(j)},83319:(e,t,o)=>{o.d(t,{Z:()=>R,g:()=>A});o(57658),o(67294);var n=o(83355),i=o(26263),r=o(49085),s=o(56666),l=o(47453),a=o(72126),c=o(68939),p=o(8406),d=o(5149),u=o(14900),m=o(9953),h=o(39699),g=o(78316),S=o(33929),y=o(89014),f=o(29798),x=o(26136),v=o(73657),C=o(13005),b=o(42917),w=o(1136),j=o(45669),_=o(52275),M=o(68894),I=o(32163),P=o(72495),k=o(85893);const T=(0,c.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a view…",id:"database.viewSettings.duplicateExistingViewTab.inputPlaceholder"}});class F extends n.Z{constructor(){super(...arguments),this.temporaryRecordCache=new i.Z({name:"CollectionSettingsDuplicateExistingView"}),this.lastDuplicatedViewId=void 0,this.originalCollectionPointer=void 0,this.didAccept=!1,this.preselectedViewPointer=void 0,this.storeTypes={inputStore:r.default.createClass(""),menuListStore:f.Z,limitStore:r.default.createClass(!0)},this.handlePreviewCollectionView=e=>{this.duplicateViewSettings(e,!0)},this.handlePreviewCollectionViewDebounced=a.Ds(this.handlePreviewCollectionView,500),this.handleMenuListStoreChange=()=>{const e=this.stores.menuListStore.state,{device:t}=this.environment;if(void 0===e.focus.indexGlobal||t.isMobile)return;const o=this.getCurrentResult().viewStores[e.focus.indexGlobal];o&&this.handlePreviewCollectionViewDebounced(o)},this.handleDuplicateViewAccept=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(this.temporaryRecordCache),p.wd({environment:this.environment,collectionContextStore:o,action:"click_duplicate_view"}),this.duplicateViewSettings(e,!1),d.wl({collectionSettingsStore:t,item:{type:"main",selectViewNameInitial:!0}}),this.didAccept=!0},this.handleNewEmptyViewClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props;p.wd({environment:this.environment,collectionContextStore:t,action:"click_new_empty_view"}),d.E3({collectionSettingsStore:e}),d.H4({collectionSettingsStore:e,item:{type:"createView"}}),this.didAccept=!0}}UNSAFE_willMount(e){const{collectionContextStore:t}=e,{device:o}=this.environment,n=t.collectionStore(),i=t.collectionViewStore();if(!i)return;const r=(0,y.x)(i.id);this.preselectedViewPointer=null==r?void 0:r.viewPointer,this.originalCollectionPointer=null==n?void 0:n.pointer,this.environment.defaultRecordCache.inMemoryRecordCache.addCacheOverride(this.temporaryRecordCache),this.stores.menuListStore.addListener(this.handleMenuListStoreChange);const{viewStores:s}=this.getCurrentResult(),[l]=s;!o.isMobile&&l&&this.duplicateViewSettings(l,!0)}willUnmount(){if(this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(this.temporaryRecordCache),this.stores.menuListStore.removeListener(this.handleMenuListStoreChange),!this.didAccept){const{viewStores:e}=this.getCurrentResult(),t=this.lastDuplicatedViewId?e.find((e=>e.id===this.lastDuplicatedViewId)):e[0];if(!t)return;this.duplicateViewSettings(t,!1)}}renderComponent(){const{inputStore:e,menuListStore:t,limitStore:o}=this.stores,{device:n}=this.environment,i=e.state,{viewStores:r,showMore:p}=this.getCurrentResult(),d=a.oA(r.map((e=>{const t=e.getType(),o=e.getFormat().collection_view_icon;if(!t||"page"===t)return;const n=e.getName(),i=e.id;return{key:i,render:e=>{var r;return(0,k.jsx)(_.Z,{...e,title:(0,k.jsx)(j.Z,{collectionViewType:t,collectionViewName:n}),icon:(0,k.jsx)(w.F,{color:"regular",viewIcon:o,viewType:t,style:{marginRight:6}}),checkState:(null===(r=this.preselectedViewPointer)||void 0===r?void 0:r.id)===i})},action:()=>{this.handleDuplicateViewAccept(e)}}})));if(p>0){const e={key:"showMore",render:e=>(0,k.jsx)(_.Z,{...e,icon:(0,s.o)({width:16,height:16,color:this.theme.mediumTextColor}),style:{color:this.theme.mediumTextColor},title:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.duplicateExistingViewTab.showMore.title",values:{showMore:p}})}),action:()=>{o.setState(!1)}};d.push(e)}return(0,k.jsxs)(C.ZP,{...this.props,title:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"Copy an existing view",id:"database.viewSettings.duplicateExistingViewTab.title"}),footer:(0,k.jsx)(P.Z,{topBorder:!0,children:(0,k.jsx)(b.Z,{icon:l.R,isGray:!0,title:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"New empty view",id:"database.viewSettings.duplicateExistingViewTab.newEmptyViewButton.title"}),onClick:this.handleNewEmptyViewClick})}),children:[(p>0||i)&&(0,k.jsx)(P.Z,{children:(0,k.jsx)(M.ZP,{focusInitial:!n.isMobile||void 0,value:i,onChange:n=>{e.setState(n.target.value),t.setState({focus:{section:0,indexLocal:0,indexGlobal:0}}),o.setState(!0)},placeholder:S.default.formatMessage(T.inputPlaceholder),showClearButton:!0})}),d.length>0&&(0,k.jsx)(I.Z,{type:I.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,k.jsx)(P.Z,{...e}),items:d}],store:t}),0===d.length&&(0,k.jsx)(v.Z,{caption:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.duplicateExistingViewTab.noResultsTitle"})})]})}getCurrentResult(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore(),o=e.collectionStore(),n=e.collectionViewStore();if(!t||!o||!n)return{viewStores:[],showMore:0};const{inputStore:i,limitStore:r}=this.stores,s=i.state,l=o.getParentBlockStore();if(!t||!l)return{viewStores:[],showMore:0};let a=A({collectionStore:o,sourceCollectionViewBlockStore:l,currentCollectionViewBlockStore:t,currentCollectionViewStore:n,constraints:(0,y.x)(n.id)}),c=0;return s?a=a.filter((e=>(0,g.D)(e,s))):r.state&&(c=a.length-7,a=a.slice(0,7)),{viewStores:a,showMore:c}}duplicateViewSettings(e,t){if(e.id===this.lastDuplicatedViewId&&t)return;this.lastDuplicatedViewId=e.id;const{collectionContextStore:o}=this.props,n=o.collectionViewStore(),i=e.getType();if(!n||!i)return;const r=e.getName(),s=e.getPageSort(),l=e.getFormat(),a=e.getKeyStore("query2").getValue();let c=n;t&&(c=n.clone(this.temporaryRecordCache)),h.createAndCommit({userAction:"CollectionSettingsDuplicateExistingView.duplicateViewSettings",environment:this.environment,perform:e=>{m.sW({store:c,data:{name:r,type:i,page_sort:s,format:{...l,collection_pointer:this.originalCollectionPointer},query2:a},transaction:e})}}),u.Ip({collectionContextStore:o})}}function A(e){const{collectionStore:t,sourceCollectionViewBlockStore:o,currentCollectionViewBlockStore:n,currentCollectionViewStore:i,constraints:r}=e;let s=a.mN([...n.getCollectionViewStores(),...o.getCollectionViewStores()],(e=>e.id)).filter((e=>{var o;return(null===(o=e.getCollectionStore())||void 0===o?void 0:o.id)===t.id&&e.id!==i.id&&"page"!==e.getType()}));if(null!=r&&r.viewType&&(s=[...s.filter((e=>e.getType()===r.viewType)),...s.filter((e=>e.getType()!==r.viewType))]),null!=r&&r.viewPointer){const{id:e}=r.viewPointer,t=s.find((t=>t.pointer.id===e))||x.Xr.createChildStore(o,r.viewPointer);s=[t,...s.filter((t=>t.pointer.id!==e))]}return s}F.displayName="CollectionSettingsDuplicateExistingView";const R=(0,c.injectIntl)(F)},53787:(e,t,o)=>{o.d(t,{Z:()=>R});var n=o(67294),i=o(480),r=o(86628),s=o(24405),l=o(84169),a=o(72126),c=o(72141),p=o(68939),d=o(8406),u=o(12534),m=o(29376),h=o(4023),g=o(86825),S=o(26388),y=o(85893);function f(e){window.__c={n:"CollectionSettingsAutoRelateSwitch"};const{temporaryAutoRelateState:t,handleAutoRelateToggle:o,collectionContextStore:n,targetCollectionStore:i,autoRelate:a,hasInverseRelation:c}=e,d=(0,r.VK)((()=>n.collectionStore()),[n]),u=(0,r.VK)((()=>Boolean(null==d?void 0:d.isSyncedCollection())),[d]),m=(0,r.VK)((()=>(null==d?void 0:d.getFormat().bot_id)||i.getFormat().bot_id),[d,i]),f=(0,r.VK)((()=>!!m&&(u||!u&&c)),[m,u,c]),x=(0,s.yK)((e=>({errorLabel:{margin:"0px 14px",color:e.errorText},helpIcon:{width:16,fill:e.lightIconColor,marginLeft:6}})),[]),v=(0,y.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:[(0,y.jsx)(p.FormattedMessage,{defaultMessage:"Automatically Relate",id:"database.viewSettings.setupRelationTab.autoRelate.title"}),(0,y.jsx)(S.Z,{render:e=>(0,y.jsx)("div",{...e,children:(0,l.m)(x.helpIcon)}),style:{width:200},placement:h.u.Bottom,textWrap:!0,renderTooltip:()=>(0,y.jsx)(p.FormattedMessage,{defaultMessage:"Relations will automatically populate based on links found in page properties.",id:"database.viewSettings.setupRelationTab.autoRelateTooltip"})})]});return f?(0,y.jsx)(g.Z,{title:v,on:t?t.enabled:!!a&&(null==a?void 0:a.enabled),focused:!1,onClick:()=>o(m),textWrapperStyle:{opacity:1}}):null}var x=o(40113),v=o(95474),C=o(19871),b=o(42696),w=o(82990),j=o(31278),_=o(76798),M=o(72495),I=o(64369);function P(e){window.__c={n:"CollectionSettingsRelationVisualizer"};const{collectionContextStore:t,targetCollectionStore:o,propertySchema:n,propertyName:i,temporaryInverseState:l,hasInverseRelation:a,inverseRelationName:c,isInitialPropertyName:d}=e,u=(0,p.useIntl)(),h=(0,r.VK)((()=>t.collectionStore()),[t]),g=l?l.hasInverseRelation:a,S=(0,r.VK)((()=>Boolean(h&&o.id===h.id)),[h,o]),f=(0,r.VK)((()=>{const e=l?l.inverseName:c;return e||(null!=h&&h.isDefined()?m.aI(u,{sourceCollection:h.getModel(),isSelfRelation:S,targetCollectionStore:o,createUnique:!0}):"")}),[h,u,c,S,l,o]),x=(0,r.VK)((()=>null!=h&&h.isDefined()?f===m.aI(u,{sourceCollection:h.getModel(),isSelfRelation:S,targetCollectionStore:o,createUnique:!1}):void 0),[h,u,f,S,o]),v=Boolean(!S&&d&&(!g||g&&x)),C=(0,s.yK)((e=>({preview:{background:e.inputBackground,marginLeft:14,marginRight:14,padding:v?"42px 12px":12,boxShadow:e.inputBoxShadow,borderRadius:4,display:"flex",flexDirection:"column",justifyContent:"center"},condensedView:{height:22,display:"flex",justifyContent:"center",alignItems:"center"},condensedProperties:{width:33,height:g?20:10,margin:"0px 12px",display:"flex",flexDirection:"column",justifyContent:"center"},databasesRow:{height:22}})),[v,g]);return h?(0,y.jsx)(M.Z,{title:(0,y.jsx)(I.Z,{isSmall:!0,isSecondaryColor:!0,children:(0,y.jsx)(p.FormattedMessage,{defaultMessage:"Preview",id:"database.viewSettings.setupRelationTab.relationVisualizer.title"})}),disableMobileBorders:!0,children:(0,y.jsx)("div",{style:C.preview,children:v?(0,y.jsxs)("div",{style:C.condensedView,children:[(0,y.jsx)(T,{collectionStore:h,condensedView:!0}),(0,y.jsxs)("div",{style:C.condensedProperties,children:[(0,y.jsx)(k,{propertyName:i||(null==n?void 0:n.name),condensedView:!0}),g&&(0,y.jsx)(k,{propertyName:f,condensedView:!0,isInverse:!0})]}),(0,y.jsx)(T,{collectionStore:o,condensedView:!0,isTarget:!0})]}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(k,{propertyName:i||(null==n?void 0:n.name),bidirectional:S&&!g}),(0,y.jsxs)("div",{style:C.databasesRow,children:[(0,y.jsx)(T,{collectionStore:h}),(0,y.jsx)(T,{collectionStore:o,isTarget:!0})]}),g&&(0,y.jsx)(k,{propertyName:f,isInverse:!0})]})})}):null}function k(e){window.__c={n:"RelationVisualizerProperty"};const{propertyName:t,bidirectional:o,isInverse:n,condensedView:i}=e,r=(0,s.yK)((e=>({propertyLabel:{fontSize:12,wordBreak:"break-word",...w.Z.textOverflowStyle,maxWidth:200,alignSelf:"center",color:e.mediumTextColor,fill:e.mediumIconColor},arrow:{width:136,height:25,alignSelf:"center",transform:n?"rotate(180deg)":void 0,margin:n?"6px 12px 0px 6px":"0px 6px 6px 6px",opacity:.3,fill:e.regularIconColor},smallArrow:{height:8,paddingLeft:1,marginTop:n?2:void 0,display:"inherit",transform:n?"rotate(180deg)":void 0,opacity:.3,fill:e.regularIconColor}})),[n]),l=(0,y.jsx)("div",{style:r.propertyLabel,children:t||""});return(0,y.jsxs)(y.Fragment,{children:[!n&&!i&&l,i?(0,v.p)(r.smallArrow):o?(0,C.G)(r.arrow):(0,x.h)(r.arrow),n&&!i&&l]})}function T(e){window.__c={n:"RelationVisualizerDatabase"};const{collectionStore:t,condensedView:o,isTarget:n}=e,i=(0,r.VK)((()=>t.getIcon()),[t]),l=(0,s.yK)((e=>({wrapper:{display:"flex",alignItems:"center",padding:2,color:e.mediumTextColor,fill:e.mediumIconColor,position:o?void 0:"absolute",left:o?void 0:n?"72%":"28%",transform:o?void 0:"translate(-50%, 0)",width:"fit-content"},icon:{marginRight:4,width:12,height:12},title:{fontSize:12,wordBreak:"break-word",...w.Z.textOverflowStyle,maxWidth:100}})),[o,n]);return(0,y.jsxs)("div",{style:l.wrapper,children:[i?(0,y.jsx)(j.Z,{icon:i,isEmptyPage:!1,size:12,disabled:!0,style:l.icon}):(0,b.t)(l.icon),(0,y.jsx)(_.Z,{store:t,style:l.title})]})}var F=o(42922),A=o(68894);function R(e){window.__c={n:"CollectionSettingsInverseRelationConfig"};const{collectionContextStore:t,property:o,propertyName:a,targetCollectionStore:x,onSubmit:v,buttonContents:C,isInitialPropertyName:b,temporaryInverseState:w,setTemporaryInverseState:j,from:I}=e,k=(0,i.O7)(),T=(0,r.VK)((()=>o?m.KV(t,o):void 0),[t,o]),A=(0,r.VK)((()=>t.collectionStore()),[t]),R=(0,r.VK)((()=>Boolean(A&&A.id===x.id)),[A,x]),V=(0,r.VK)((()=>Boolean(o?m.OP(t,o,x):void 0)),[t,o,x]),B=(0,r.VK)((()=>{if("relation"!==(null==T?void 0:T.type))return"";const e=T.property;if(!e||e===o)return"";const t=x.getRole();if(!t||!c.YX(t))return"";const n=x.getSchema()[e];return(null==n?void 0:n.name)||""}),[x,o,T]),O=(0,r.VK)((()=>"relation"===(null==T?void 0:T.type)&&T.autoRelate?T.autoRelate:{enabled:!1}),[T]),D=(0,r.VK)((()=>Boolean(m.gZ(x))),[x]),N=(0,r.VK)((()=>Boolean((null==A?void 0:A.getDatabaseType())&&o&&(null==A?void 0:A.isTypedProperty(o)))),[A,o]),K=(0,r.VK)((()=>t.contextType),[t]),L=(0,s.yK)((e=>({errorLabel:{margin:"0px 14px",color:e.errorText},helpIcon:{width:16,fill:e.lightIconColor,marginLeft:6}})),[]),q=(0,n.useMemo)((()=>w?w.hasInverseRelation:V),[w,V]),E=(0,n.useMemo)((()=>w?w.inverseName:B),[w,B]),U=(0,n.useMemo)((()=>w?w.autoRelate:O),[w,O]),W=(0,n.useCallback)((()=>{const e=null!=A&&A.isSyncedCollection()?U:q?{enabled:!1}:U;j({hasInverseRelation:!q,inverseName:q?void 0:E,autoRelate:e}),o&&d.$q({environment:k,collectionContextStore:t,property:o,from:"collectionPage"===K?"page_properties":"view_settings",action:q?"relation_toggle_inverse_off":"relation_toggle_inverse_on",is_self_relation:R})}),[j,q,E,U,t,A,o,K,R,k]),z=(0,n.useCallback)((e=>{j({hasInverseRelation:!0,inverseName:e.target.value,autoRelate:U})}),[j,U]),$=(0,n.useCallback)((e=>{const n=null!=U&&U.enabled?{enabled:!1}:{enabled:!0,bot_id:e};j({hasInverseRelation:q,inverseName:E,autoRelate:n}),o&&d.$q({environment:k,collectionContextStore:t,property:o,from:"collectionPage"===K?"page_properties":"view_settings",action:n.enabled?"auto_relation_toggle_on":"auto_relation_toggle_off"})}),[o,j,t,K,E,q,U,k]),H=(0,n.useCallback)((e=>{(0,u.ZP)({event:e,context:u.Af.CollectionSettingsClick,callback:v})}),[v]),G=(0,y.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:[R?(0,y.jsx)(p.FormattedMessage,{id:"database.viewSettings.setupRelationTab.selfRelation.reverse",defaultMessage:"Separate directions"}):(0,y.jsx)(p.FormattedMessage,{id:"database.viewSettings.setupRelationTab.relation.reverse",defaultMessage:"Show on {databaseName}",values:{databaseName:(0,y.jsx)(_.Z,{style:{display:"inline"},store:x})}}),(0,y.jsx)(S.Z,{render:e=>(0,y.jsx)("div",{...e,children:(0,l.m)(L.helpIcon)}),style:{width:200},placement:h.u.Bottom,textWrap:!0,renderTooltip:()=>!D||N?(0,y.jsx)(p.FormattedMessage,{defaultMessage:"Cannot edit target database.",id:"database.viewSettings.setupRelationTab.inverseDisabledWarning.title"}):R?(0,y.jsx)(p.FormattedMessage,{defaultMessage:"Create separate properties for each direction of a two-way relation. Useful for modeling Parent task/Sub-tasks, Blocked by/Blocking, and more.",id:"database.viewSettings.setupRelationTab.inverseRelationTooltip.selfRelation"}):(0,y.jsx)(p.FormattedMessage,{defaultMessage:"Create a property on {databaseName} showing backlinks to the current database",id:"database.viewSettings.setupRelationTab.inverseRelationTooltip",values:{databaseName:(0,y.jsx)(_.Z,{style:{display:"inline"},store:x})}})})]});return(0,y.jsxs)(y.Fragment,{children:[!(R&&V)&&!I&&(0,y.jsx)(g.Z,{title:G,on:q,focused:!1,onClick:W,disabled:!D||R&&V||N,textWrapperStyle:{opacity:1}}),(0,y.jsx)(Z,{collectionContextStore:t,targetCollectionStore:x,isSelfRelation:R,temporaryInverseState:w,hasInverseRelation:V,inverseRelationName:B,disabled:!D||N,onChange:z,from:I}),(0,y.jsx)(f,{handleAutoRelateToggle:$,temporaryAutoRelateState:null==w?void 0:w.autoRelate,collectionContextStore:t,autoRelate:O,targetCollectionStore:x,hasInverseRelation:q}),(()=>{if("relation"!==(null==T?void 0:T.type))return!0;if(w){if(w.hasInverseRelation!==V)return!0;if(w.inverseName&&w.inverseName!==B)return!0;if(w.autoRelate&&w.autoRelate.enabled!==O.enabled)return!0}return!1})()&&(0,y.jsx)(M.Z,{children:(0,y.jsx)(F.Z,{style:{display:"flex",margin:"6px 12px 0px 12px"},onClick:H,children:C})}),"subitem"!==I&&"timeline_arrows_by"!==I&&(0,y.jsx)(P,{propertySchema:T,propertyName:a,collectionContextStore:t,targetCollectionStore:x,temporaryInverseState:w,hasInverseRelation:V,inverseRelationName:B,isInitialPropertyName:b})]})}function Z(e){window.__c={n:"CollectionSettingsInverseRelationName"};const{collectionContextStore:t,targetCollectionStore:o,isSelfRelation:n,temporaryInverseState:i,hasInverseRelation:s,inverseRelationName:l,disabled:c,onChange:d,from:u}=e,h=(0,p.useIntl)(),g=(0,r.VK)((()=>{const e=t.collectionStore();return null!=e&&e.isDefined()?m.aI(h,{sourceCollection:e.getModel(),isSelfRelation:n,targetCollectionStore:o,createUnique:!0,from:u}):h.formatMessage({id:"database.viewSettings.setupRelationTab.inverseRelationName.placeholder",defaultMessage:"Related to target"})}),[t,h,n,o,u]);return(i?i.hasInverseRelation:s)?(0,y.jsx)(M.Z,{title:!u&&(0,y.jsx)(I.Z,{isSmall:!0,isSecondaryColor:!0,children:(0,y.jsx)(p.FormattedMessage,{defaultMessage:"Related property on {databaseName}",id:"database.viewSettings.setupRelationTab.inverseRelationNameInput.title",values:{databaseName:(0,y.jsx)(_.Z,{style:{display:"inline"},store:o})}})}),children:(0,y.jsx)(A.ZP,{value:"subitem"!==u&&"timeline_arrows_by"!==u?(null==i?void 0:i.inverseName)||l:g,placeholder:g,onChange:d,onBlur:a.yR,onSubmit:a.yR,focusInitial:!1,selectAll:!1,disabled:c})}):null}},16257:(e,t,o)=>{o.d(t,{C:()=>g,U:()=>S});var n=o(67294),i=o(480),r=o(99036),s=o(68939),l=o(8406),a=o(14900),c=o(39699),p=o(52821),d=o(85893);function u(e,t,o){return"1"===e?"relation"===t?o&&!0===o?(0,d.jsx)(s.FormattedMessage,{defaultMessage:"1 item",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne.connectedRelation"}):(0,d.jsx)(s.FormattedMessage,{defaultMessage:"1 page",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne.relation"}):(0,d.jsx)(s.FormattedMessage,{defaultMessage:"1 {type}",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne",values:{type:p.SO[t]}}):"no_limit"===e?(0,d.jsx)(s.FormattedMessage,{defaultMessage:"No limit",id:"database.viewSettings.collectionPropertyLimitHelpers.noLimit"}):void 0}function m(e,t,o){return{key:e,title:u(e,t,o)}}var h=o(13709);function g(e){window.__c={n:"CollectionSettingsLimitOptions"};const{property:t,propertySchema:o,collectionContextStore:s}=e,p=(0,i.O7)(),u=(0,n.useCallback)((e=>{const n=s.collectionStore();if(!n||!(0,r.en)(o))return;const i={...o,limit:Number(e)?1:void 0};c.createAndCommit({userAction:"CollectionSettingsLimitOptions.handleLimitChange",environment:p,perform:e=>{a.xO({environment:p,collectionStore:n,update:{[t]:i},transaction:e})}});const d=Number(e)?`${o.type}_toggle_limit_on`:`${o.type}_toggle_limit_off`;l.$q({environment:p,collectionContextStore:s,property:t,from:"view_settings",action:d})}),[s,p,t,o]);return(0,r.en)(o)?"relation"===o.type&&o.connectedRelation?(0,d.jsx)(S,{propertyType:o.type,connectedRelation:!0,selectedKey:o.limit?"1":"no_limit",onChange:u}):(0,d.jsx)(S,{propertyType:o.type,selectedKey:o.limit?"1":"no_limit",onChange:u}):null}function S(e){const{propertyType:t,selectedKey:o,connectedRelation:n,onChange:i}=e;return(0,d.jsx)(h.Z,{title:(0,d.jsx)(s.FormattedMessage,{defaultMessage:"Limit",id:"database.viewSettings.collectionPropertyLimitHelpers.limit"}),selectedKey:o,popupStyle:{minWidth:190},options:[m("1",t,n),m("no_limit",t)],onChange:i})}},26122:(e,t,o)=>{o.d(t,{Z:()=>d});o(67294);var n=o(83355),i=o(49085),r=o(27153),s=o(33929),l=o(68894),a=o(23321),c=o(85893);class p extends n.Z{constructor(){super(...arguments),this.storeTypes={inputStore:i.default.createClass("")},this.handleBlur=()=>{this.props.onBlur(this.stores.inputStore.state)},this.handleSubmit=()=>{this.props.onSubmit(this.stores.inputStore.state)}}UNSAFE_willMount(e){super.UNSAFE_willMount(e),this.stores.inputStore.setState(e.initialValue)}willUnmount(){const{initialValue:e,onBlur:t}=this.props,o=this.stores.inputStore.state;e!==o&&t(o)}renderComponent(){const{placeholder:e,focusInitial:t,selectAll:o,disabled:n,inputOuterStyle:i,iconButton:p}=this.props,{inputStore:d}=this.stores,u=d.state;return(0,c.jsx)(l.ZP,{focusInitial:t,selectAll:o,value:u,onChange:e=>{d.setState(e.target.value)},onBlur:this.handleBlur,onSubmit:this.handleSubmit,placeholder:e,disabled:n,textWrapperStyle:{opacity:n?.7:void 0},inputOuterStyle:i,left:p&&(0,c.jsx)(l.DO,{icon:p.icon,iconStyle:p.iconStyle,onClick:e=>function(e,t,o){if(!o)return;const n=s.default.getIntl(),{onSubmit:i,enforceIconColor:l,includeEmojiTab:c}=o;r.$(t,{originRect:e.target.getBoundingClientRect(),originGap:3,popupHeight:a.DQ,popupWidth:a.rw,showArrow:!0,title:n.formatMessage({defaultMessage:"Icon",id:"mediaPicker.tabs.icon"}),currentTab:"icon",tabs:c?[{type:"emoji",onChange:(e,t)=>{i(e),t&&t.keepVisible||r.Z()}},{type:"icon",enforceIconColor:l,onChange:(e,t)=>{i(e),t&&t.keepVisible||r.Z()}}]:[{type:"icon",enforceIconColor:l,onChange:(e,t)=>{i(e),t&&t.keepVisible||r.Z()}}],onDelete:()=>{i(),r.Z()}})}(e,this.environment,p),disabled:n})})}}p.displayName="CollectionSettingsNameInput";const d=p},89211:(e,t,o)=>{o.d(t,{mJ:()=>io,ZP:()=>ro,sY:()=>eo});o(21703),o(57658);var n=o(67294),i=o(73935),r=o(83355),s=o(1302),l=o(480),a=o(86628),c=o(24405),p=o(49085),d=o(99036),u=o(80951),m=o(8848),h=o(39068),g=o(79362),S=o(5257),y=o(88437),f=o(44643),x=o(55964),v=o(84169),C=o(44495),b=o(16184),w=o(37612),j=o(72050),_=o(108),M=o(3791),I=o(97880),P=o(82990),k=o(68939),T=o(50906),F=o(8406),A=o(16956),R=o(5149),Z=o(87085),V=o(14900),B=o(96802),O=o(80402),D=o(39699),N=o(76235),K=o(40663),L=o(66890),q=o(52821),E=o(43224),U=o(78316),W=o(99417),z=o(19124),$=o(75081),H=o(33929),G=o(18514),Y=o(77546),Q=o(85644),X=o(67695),J=o(61766),ee=o(77080),te=o(83212),oe=o(26136),ne=o(78291),ie=o(30905),re=o(91965),se=o(13162),le=o(59187),ae=o(98963),ce=o(9953),pe=o(93174),de=o(77463),ue=o(5971),me=o(68910),he=o(68894),ge=o(72495),Se=o(85893);function ye(e){window.__c={n:"CollectionSettingsButtonOptions"};const{collectionContextStore:t,propertySchema:o,propertyId:i}=e,r=(0,l.O7)(),s=r.currentUser.id,c=(0,ue.E)("automation_ui_unify"),p=(0,a.Kw)(t.permissionScopes),d=(0,a.VK)((()=>t.collectionStore()),[t]),u=(0,a.VK)((()=>o.automation_id&&d?oe.Mz.createChildStore(d,{table:ae.cv,id:o.automation_id,spaceId:d.getSpaceId()}):void 0),[d,o]),m=(0,a.VK)((()=>null==u?void 0:u.getTrigger()),[u]),h=(0,n.useMemo)((()=>{if(u)return new me.L({type:"button_property",persisted:!0,automationStore:u,collectionContextStore:t,propertyId:i,propertySchema:o,intl:H.default.getIntl(),parentRecordStore:u,currentUserId:s})}),[i,o,u,t,s]),g=(0,a.VK)((()=>(null==u?void 0:u.getNameStore().getValue())??""),[u]),S=(0,n.useCallback)((e=>{if(!u)return;const t=e.currentTarget.value;D.createAndCommit({userAction:"CollectionSettingsButtonOptions.setName",environment:r,perform:e=>{ce.sO({store:u.getNameStore(),transaction:e,value:t})}})}),[u,r]);return d&&u&&m&&"button"===m.type&&h?(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(ge.Z,{topBorder:!0,title:(0,Se.jsx)(k.FormattedMessage,{id:"database.buttonProperty.label",defaultMessage:"Label"}),children:(0,Se.jsx)(he.ZP,{disabled:!p.canConfigureCollection,placeholder:H.default.formatMessage(fe.inputPlaceholder),value:g,onChange:S})}),c?(0,Se.jsx)("section",{children:(0,Se.jsx)(de.nT,{})}):(0,Se.jsxs)(ge.Z,{title:(0,Se.jsx)(k.FormattedMessage,{id:"database.buttonProperty.actions",defaultMessage:"Actions"}),children:[(0,Se.jsx)(pe.C,{contextStore:h,disabled:!p.canConfigureCollection,suppressErrors:!0,onActionAdded:()=>{},buttonPlacement:void 0}),(0,Se.jsx)("div",{})]})]}):null}const fe=(0,k.defineMessages)({inputPlaceholder:{defaultMessage:"Type a name for this button...",id:"database.buttonProperty.label.inputPlaceholder"}});var xe=o(13991),ve=o(40506),Ce=o(11843),be=o(13709);class we extends r.Z{constructor(){super(...arguments),this.handleDateFormatChange=e=>{const{collectionContextStore:t,property:o}=this.props,n=t.collectionStore(),i=_e(this.props.collectionContextStore,this.props.property);if(!n||!i)return;const r={...i,date_format:e};D.createAndCommit({userAction:"CollectionSettingsDateOptions.handleDateFormatChange",environment:this.environment,perform:e=>{V.xO({environment:this.environment,collectionStore:n,update:{[o]:r},transaction:e})}}),F.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"date_change_format"})},this.handleClockFormatChange=e=>{const{collectionContextStore:t,property:o}=this.props,n=t.collectionStore(),i=_e(this.props.collectionContextStore,this.props.property);if(!n||!i)return;const r=Me()[e],s={...i,time_format:r};D.createAndCommit({userAction:"CollectionSettingsDateOptions.handleClockFormatChange",environment:this.environment,perform:e=>{V.xO({environment:this.environment,collectionStore:n,update:{[o]:s},transaction:e})}}),F.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"date_change_time_format"})}}renderComponent(){const{intl:e}=this.props,t=_e(this.props.collectionContextStore,this.props.property);if(!t)return;const o=t.date_format||ve.sF,n=function(e){const t=Me();for(const o in t)if(t[o]===e)return o;return"12h"}(t.time_format||ve.c_);return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(be.Z,{title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Date format",id:"database.viewSettings.dateOptions.dateFormat"}),selectedKey:o,popupStyle:{minWidth:190},options:ve.Zy.map((t=>({key:t,title:e.formatMessage(ve.fy[t])}))),onChange:this.handleDateFormatChange}),(0,Se.jsx)(be.Z,{title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Time format",id:"database.viewSettings.dateOptions.timeFormat"}),selectedKey:n,popupStyle:{minWidth:190},options:ve.L7.map((t=>({key:t,title:e.formatMessage(ve.Fi[t])}))),onChange:this.handleClockFormatChange})]})}}we.displayName="CollectionSettingsDateOptions";const je=(0,k.injectIntl)(we);function _e(e,t){const o=e.normalizedSchemaStore.state[t];if(o)return"date"===o.type||"created_time"===o.type||"last_edited_time"===o.type||"last_visited_time"===o.type?o:void 0}function Me(){return(0,Ce.E)(xe.SP).time}var Ie=o(22686);function Pe(e){window.__c={n:"CollectionSettingsDefaultPersonPicker"};const{collectionContextStore:t,property:o,propertySchema:i}=e,r=(0,l.O7)(),s=(0,n.useCallback)((e=>{const n={...i,default:"created_by"===e?"created_by":void 0},s=t.collectionStore();if(!s)return;const l=[],a={pointer:s.pointer,command:"update",path:["schema",o],args:{default:e}};l.push(a),V.HW({environment:r,collectionStore:s,performTransaction:e=>{for(const t of l)D.applyOperation({store:(0,oe.Kv)(s,t.pointer),operation:t,transaction:e})}}),D.createAndCommit({userAction:"CollectionSettingsDefaultPersonPicker.handleChange",environment:r,perform:e=>{V.xO({environment:r,collectionStore:s,update:{[o]:n},transaction:e})}})}),[t,r,o,i]);return(0,Se.jsx)(be.Z,{title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Default",id:"CollectionSettingsDefaultPersonPicker.default.title"}),selectedKey:i.default?"created_by":"no_default",popupStyle:{minWidth:190},options:[{key:"no_default",title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"No default",id:"CollectionSettingsDefaultPersonPicker.options.noDefault"})},{key:"created_by",title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Created by",id:"CollectionSettingsDefaultPersonPicker.options.creator"}),icon:(0,Ie.f)({width:16})}],onChange:s})}var ke=o(21202),Te=o(17809),Fe=o(77907),Ae=o(42917),Re=o(31945),Ze=o(53437),Ve=o(41389),Be=o(72589);class Oe extends r.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:J.Z},this.renderPopup=e=>{const{collectionContextStore:t,collectionSettingsStore:o,property:n}=this.props,i=t.collectionStore();if(!i)return;const r=t.normalizedSchemaStore.state,s=r[n];if("formula"!==(null==s?void 0:s.type))return;const l=i.pointer.spaceId,a=Array.from(t.resultSet.state.blockIds.values())[0],c=a?oe.G.createChildStore(i,{table:ke.iU,id:a,spaceId:l}):void 0,p=Boolean(i.getDatabaseType()&&i.isTypedProperty(n));if((0,Te.V1)()){const t=null==o?void 0:o.getState().fromBlock;return(0,Se.jsx)(Fe.DependencyConsumer,{dependency:Fe.deps.formulas,children:o=>(0,Se.jsx)(Be.Z,{handleClose:e.close,property:n,getRecordModel:i.getRecordModel,propertySchema:s,collectionStore:i,handleSave:this.handleFormula2CodeChange,formulas:o,disabled:p,blockStore:t,analyticsFrom:"view_settings"})})}return(0,Se.jsx)(Ve.default,{property:n,schema:r,analyticsFrom:"view_settings",exampleBlock:null==c?void 0:c.getModel(),disabled:p,onChange:this.handleFormulaChange,onClickCancel:e.close})},this.handleFormula2CodeChange=e=>{const{newValue:t,newType:o,propertySchema:n,property:i,collectionStore:r}=e,s=t?{...n,formula2:{code:t,result_type:o},version:"v2"}:{...n,formula2:void 0,version:"v2"};D.createAndCommit({userAction:"CollectionSettingsFormulaOptions.handleFormulaChange",environment:this.environment,perform:e=>{V.xO({environment:this.environment,collectionStore:r,update:{[i]:s},transaction:e})}})},this.handleFormulaChange=e=>{let{propertySchema:t,close:o}=e;const{collectionContextStore:n,property:i}=this.props,r=n.collectionStore();r&&(D.createAndCommit({userAction:"CollectionSettingsFormulaOptions.handleFormulaChange",environment:this.environment,perform:e=>{V.xO({environment:this.environment,collectionStore:r,update:{[i]:t},transaction:e})}}),o&&this.stores.buttonPopupStore.reset(),F.$q({environment:this.environment,collectionContextStore:n,property:i,from:"view_settings",action:"formula_edit"}))}}renderComponent(){const{device:e}=this.environment,{buttonPopupStore:t}=this.stores;return(0,Se.jsx)(Re.ZP,{popupType:e.isMobile?Ze.kQ.SlideUp:Ze.kQ.Popup,alignmentToOrigin:Re.vR.End,renderOrigin:e=>(0,Se.jsx)(Ae.Z,{title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Formula",id:"database.viewSettings.formulaOptions.title"}),right:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Edit",id:"database.viewSettings.formulaOptions.edit"}),showChevron:!0,rotateChevron:t.state.open,...e}),render:this.renderPopup,buttonPopupStore:t})}}Oe.displayName="CollectionSettingsFormulaOptions";const De=(0,k.injectIntl)(Oe);var Ne=o(21269),Ke=o(16257),Le=o(13005),qe=o(26122),Ee=o(35011),Ue=o(34299),We=o(78106),ze=o(42853),$e=o(32056),He=o(16187),Ge=o(64921),Ye=o(74194),Qe=o(85248),Xe=o(78942),Je=o(24006),et=o(58573),tt=o(15157),ot=o(87279),nt=o(29798),it=o(52275),rt=o(78140),st=o(32163);const lt="LastUsedCurrency";class at extends r.Z{constructor(){super(...arguments),this.storeTypes={numberFormatFilterStore:p.default.createClass(""),menuListStore:nt.Z},this.handleNumberFormatFilterChange=e=>{this.stores.numberFormatFilterStore.setState(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.handleNumberFormatChange=e=>{const{collectionStore:t,property:o,schema:n,onClose:i}=this.props,r=n[o];if(!r)return;if("number"!==r.type&&"formula"!==r.type)return;const s={...r,number_format:e,..."percent"===e&&void 0!==(null==r?void 0:r.show_as)?{show_as:{...null==r?void 0:r.show_as,maxValue:1}}:{}};"number"===r.type&&(0,$e.b3)(e)&&tt.Z.set({userId:this.environment.currentUser.id,key:lt,value:e}),D.createAndCommit({userAction:"NumberFormatMenu.handleNumberFormatChange",environment:this.environment,perform:e=>{V.xO({environment:this.environment,collectionStore:t,update:{[o]:s},transaction:e})}}),null==i||i()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:ot.og.ActionSheet}:{menuType:ot.og.Popup};const o=!e.isMobile&&(0,Se.jsx)(ge.Z,{isInput:!0,children:(0,Se.jsx)(he.ZP,{value:this.stores.numberFormatFilterStore.state,onChange:this.handleNumberFormatFilterChange,focus:!0,focusAfterAnimation:!0,placeholder:H.default.getIntl().formatMessage({defaultMessage:"Filter formats…",id:"blockPropertyValue.filterForNumberFormats.placeholder"}),preventCaptureDeleteWhenEmpty:!0})});return(0,Se.jsx)(rt.Z,{...t,header:o,children:(0,Se.jsx)(st.Z,{type:st.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,Se.jsx)(ge.Z,{...e}),items:this.getMenuItems()}],store:this.stores.menuListStore})})}getMenuItems(){const e=tt.Z.get({userId:this.environment.currentUser.id,key:lt});return(0,et.ZP)(this.stores.numberFormatFilterStore.state,(0,$e.jD)(e),(e=>e)).map((e=>({key:e,render:t=>(0,Se.jsx)(pt,{name:e,props:t}),action:()=>this.handleNumberFormatChange(e)})))}}at.displayName="NumberFormatMenu";const ct=at;function pt(e){let{name:t,props:o}=e;return(0,Se.jsx)(it.Z,{...o,title:(0,$e.Bo)(H.default.getIntl(),t)})}var dt=o(9050);function ut(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"CollectionSettingsNumberOptions"};const{propertySchema:n,numberFormat:i}=(0,a.VK)((()=>{const e=t.collectionStore(),n=t.normalizedSchemaStore.state[o];if(!n||!e)return{};if("number"===n.type)return{propertySchema:n,numberFormat:n.number_format??$e.dk};if("formula"===n.type)return"number"===(0,Ee.mm)(n)||n.formula2&&(0,Te.V1)()&&"number"===(0,We.aL)(n.formula2.result_type).type?{propertySchema:n,numberFormat:n.number_format??$e.dk}:{};if("rollup"===n.type){var i;if(n.aggregation&&"show_unique"!==n.aggregation){var r;const i=null===(r=(0,Ue.gT)({property:o,schema:t.normalizedSchemaStore.state,getRecordModel:e.getRecordModel}))||void 0===r?void 0:r.targetPropertySchema;if(void 0===(null==i?void 0:i.type))return{};const s=(0,He.SD)(n.aggregation,(0,He.SD)(n.aggregation,"number_format"in i?i.number_format:void 0));return s?{propertySchema:n,numberFormat:s}:{}}const s=null===(i=(0,Ue.gT)({property:o,schema:t.normalizedSchemaStore.state,getRecordModel:e.getRecordModel}))||void 0===i?void 0:i.targetPropertySchema;if("number"===(null==s?void 0:s.type)||"formula"===(null==s?void 0:s.type)&&"number"===(0,Ee.r9)(s))return{propertySchema:n,numberFormat:s.number_format??$e.dk}}return{}}),[t,o]);if(!n)return null;const r="rollup"!==n.type;return(0,Se.jsxs)(Se.Fragment,{children:[r?(0,Se.jsx)(mt,{numberFormat:i,property:o}):null,(0,Se.jsx)(ht,{property:o,propertySchema:n,numberFormat:i})]})}function mt(e){let{numberFormat:t,property:o}=e;window.__c={n:"NumberFormatSection"};const n=(0,L.Y$)(),i=(0,a.qz)(void 0,J.Z),r=(0,k.useIntl)(),s=(0,l.O7)();return(0,Se.jsx)(Re.ZP,{popupType:s.device.isMobile?Ze.kQ.SlideUp:Ze.kQ.Popup,alignmentToOrigin:Re.vR.End,renderOrigin:e=>(0,Se.jsx)(Ae.Z,{title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Number format",id:"database.viewSettings.numberOptions.numberFormat"}),right:(0,Se.jsx)("span",{style:{...P.Z.textOverflowStyle},children:(0,$e.Bo)(r,$e.dX.find((e=>e===t))??$e.dk)}),showChevron:!0,rotateChevron:i.state.open,...e}),render:e=>{const t=n.collectionStore(),i=n.normalizedSchemaStore.state;if(t)return(0,Se.jsx)(ct,{collectionStore:t,property:o,schema:i,onClose:e.close})},buttonPopupStore:i})}function ht(e){let{property:t,propertySchema:o,numberFormat:i}=e;window.__c={n:"NumberShowAsSection"};const{show_as:r}=o,s=(0,L.Y$)(),a=(0,l.O7)(),p=(0,c.Fg)(),d=n.useRef({color:(null==r?void 0:r.color)??"green",maxValue:(null==r?void 0:r.maxValue)??100,showValue:(null==r?void 0:r.showValue)??!0}),u={type:(null==r?void 0:r.type)??"number",color:(null==r?void 0:r.color)??d.current.color,maxValue:(null==r?void 0:r.maxValue)??d.current.maxValue,showValue:(null==r?void 0:r.showValue)??d.current.showValue},h=(0,c.yK)((e=>({card:{boxSizing:"content-box",height:36,flex:1,margin:1,boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.mediumTextColor,borderRadius:4,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",paddingLeft:12,paddingRight:12,paddingTop:6,paddingBottom:6,cursor:"pointer"},selectedCard:{boxShadow:`0 0 0 2px ${e.blueColor}`,color:e.blueColor},cardVisual:{height:20,marginBottom:4,width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},cardText:{lineHeight:1,fontSize:12},progressBar:{width:"100%"},showAsTypeOption:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginLeft:16,marginRight:16,marginTop:6,gap:12},extraOptionStyle:{display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:16,paddingRight:16,gap:16,height:28,width:"100%"}})),[]),g=(0,n.useCallback)((e=>{const n=s.collectionStore();o&&n&&(D.createAndCommit({userAction:"CollectionSettingsProperty.handleNumberShowAsChange",environment:a,perform:i=>{V.xO({environment:a,collectionStore:n,update:{[t]:{...o,show_as:e}},transaction:i})}}),F.$q({environment:a,collectionContextStore:s,property:t,from:"view_settings",action:"number_change_show_as",number_show_as:(null==e?void 0:e.type)??"number"}))}),[s,a,t,o]),S=[{key:"number",visual:(0,Se.jsx)("div",{style:{fontSize:16,fontWeight:P.Z.fontWeight.medium},children:"42"}),text:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Number",id:"database.viewSettings.numberOptions.showAsNumber"})},{key:"bar",visual:(0,Se.jsx)(Qe.k,{percentage:50,filledColor:"bar"===u.type?p.blueColor:p.regularDividerColor,unfilledColor:"bar"===u.type?p.accentColors.blue[50]:p.regularDividerColor,style:{width:"100%"}}),text:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Bar",id:"database.viewSettings.numberOptions.showAsBar"})},{key:"ring",visual:(0,Se.jsx)(Xe.e,{size:20,percentage:40,filledColor:"ring"===u.type?p.blueColor:p.regularDividerColor,unfilledColor:"ring"===u.type?p.accentColors.blue[50]:p.accentColors.gray[100],style:{width:"100%"}}),text:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Ring",id:"database.viewSettings.numberOptions.showAsRing"})}],y=(0,Se.jsx)("div",{style:h.showAsTypeOption,children:S.map((e=>{const t=u.type===e.key;return(0,Se.jsxs)(Ge.Z,{onClick:()=>{const t="number"===e.key?void 0:{type:e.key,color:u.color,maxValue:"percent"===i?1:u.maxValue,showValue:u.showValue};void 0!==t&&(d.current=t),g(t)},style:{...h.card,...t?h.selectedCard:{}},children:[(0,Se.jsx)("div",{style:h.cardVisual,children:e.visual}),(0,Se.jsx)("div",{style:h.cardText,children:e.text})]},e.key)}))}),f=e=>{const t="number"!==u.type?{...u,type:u.type,...e}:void 0;void 0!==t&&(d.current=t),g(t)},x="number"!==u.type?(0,Se.jsxs)("div",{style:h.extraOptionStyle,children:[(0,Se.jsx)("div",{style:{flex:6,fontSize:14},children:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Color",id:"database.viewSettings.numberOptions.color"})}),(0,Se.jsx)("div",{style:{display:"flex",flexWrap:"wrap",flex:6,gap:7},children:(0,Se.jsx)(Re.ZP,{popupType:a.device.isMobile?Re.Z4.SlideUp:Re.Z4.Popup,renderOrigin:e=>(0,Se.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"end"},...e,children:(0,Se.jsx)(dt.Z,{color:u.color,focused:!1,buttonStyle:{width:"auto",marginLeft:0,marginRight:0,borderRadius:4,color:p.lightTextColor},style:{minHeight:36},right:(0,ze.i)({width:12,height:12})})}),render:e=>{const t=m.AP.map((t=>(0,Se.jsx)(dt.Z,{color:t,checkState:t===u.color,focused:!1,style:{width:"100%"},onClick:()=>{f({color:t}),e.close()}},t)));return(0,Se.jsx)("div",{style:{minWidth:150,paddingTop:8,paddingBottom:8},children:t})}})})]}):null,v="number"!==u.type?"percent"!==i&&(0,Se.jsxs)("div",{style:h.extraOptionStyle,children:[(0,Se.jsx)("div",{style:{flex:6,fontSize:14},children:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Divide by",id:"database.viewSettings.numberOptions.divideBy"})}),(0,Se.jsx)("div",{style:{flex:6},children:(0,Se.jsx)(Ye.Z,{value:u.maxValue.toString(),onChange:e=>{const t=e.target.value.replace(/[^0-9]/g,""),o=parseFloat(t);!isNaN(o)&&o>0&&f({maxValue:o})},inputStyle:{textAlign:"right"}})})]}):null,C="number"!==u.type?(0,Se.jsxs)("div",{style:h.extraOptionStyle,children:[(0,Se.jsx)("div",{style:{flex:6,fontSize:14},children:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Show number",id:"database.viewSettings.numberOptions.showValue"})}),(0,Se.jsx)("div",{style:{flex:6,display:"flex",justifyContent:"flex-end"},children:(0,Se.jsx)(Je.Z,{on:u.showValue,onClick:()=>{f({showValue:!u.showValue})},disabled:!1})})]}):null,b=Boolean(x||v||C),w=(0,Se.jsxs)("div",{style:{backgroundColor:p.accentColors.gray[30],borderRadius:5,marginTop:b?12:0,marginLeft:b?14:0,marginRight:b?14:0,paddingTop:b?12:0,paddingBottom:b?12:0,maxHeight:b?1e3:0,transition:"max-height 0.5s ease-in-out",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[x,v,C]});return(0,Se.jsxs)(ge.Z,{title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Show as",id:"database.viewSettings.numberPercentOptions.showAs"}),topBorder:!0,disableMobileBorders:!0,children:[y,w,(0,Se.jsx)("div",{style:{marginTop:12,marginLeft:18,marginRight:18,fontSize:12,color:p.lightTextColor},children:(0,Se.jsx)(k.FormattedMessage,{id:"database.CollectionSettings.NumberOptions.applyAllViews",defaultMessage:"Changes apply to all views showing this property."})})]})}var gt=o(31869),St=o(29376),yt=o(53787),ft=o(79892);function xt(e){window.__c={n:"CollectionSettingsRelationOptions"};const{collectionContextStore:t,property:o}=e,i=(0,l.O7)(),r=(0,k.useIntl)(),[s,c]=(0,n.useState)(void 0),p=(0,a.VK)((()=>t.collectionStore()),[t]),m=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t]),h=(0,a.VK)((()=>St.KV(t,o)),[t,o]),g=h&&(0,d.NK)(h)?h.connectedRelation:void 0,S=(0,a.VK)((()=>vt(t.collectionViewBlockStore(),h)),[t,h]),y=Boolean(S&&(null==p?void 0:p.id)===S.id),f=(0,a.VK)((()=>Boolean(S&&(null==h?void 0:h.name)===St.m8(r,{targetCollectionStore:S,isSelfRelation:y,sourceSchema:m,createUnique:!1}))),[h,r,S,y,m]),x=(0,a.VK)((()=>t.contextType),[t]),v=(0,n.useCallback)((()=>{if(!s)return;const{hasInverseRelation:e,inverseName:n,autoRelate:l}=s;D.createAndCommit({userAction:"CollectionSettingsRelationOptions.handleEditRelation",environment:i,perform:s=>{gt.gy({environment:i,collectionContextStore:t,property:o,hasInverseRelation:e,inverseName:n,autoRelate:l,intl:r,transaction:s})}}),F.$q({environment:i,collectionContextStore:t,property:o,from:"collectionPage"===x?"page_properties":"view_settings",action:"relation_edit",is_self_relation:y,has_inverse:e,auto_relate:null==l?void 0:l.enabled}),c(void 0)}),[s,i,t,o,x,y,r]);if(!S)return null;const C=h&&!(0,u.gg)(h)&&!(0,u.ic)(h);return(0,Se.jsxs)(Se.Fragment,{children:[C&&(0,Se.jsx)(ft.Z,{isSelfRelation:y,collectionStore:S,showAs:"link",disabled:!0}),C&&(0,Se.jsx)(Ke.C,{collectionContextStore:t,propertySchema:h,property:o}),!Boolean(g)&&(0,Se.jsx)(yt.Z,{collectionContextStore:t,targetCollectionStore:S,property:o,buttonContents:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Update relation",id:"database.viewSettings.editRelation.updateButton.title"}),temporaryInverseState:s,setTemporaryInverseState:c,isInitialPropertyName:f,onSubmit:v})]})}function vt(e,t){if("relation"!==(null==t?void 0:t.type))return;const o=null==t?void 0:t.collection_pointer;return o&&e?oe.NW.createChildStore(e,o):void 0}var Ct=o(47453),bt=o(71644),wt=o(47307),jt=o(92658),_t=o(84619),Mt=o(4023),It=o(26388),Pt=o(73456),kt=o(22084);function Tt(e){var t;window.__c={n:"CollectionSettingsSelectOptionRow"};const o=(0,l.O7)(),i=(0,c.Fg)(),{isMobile:r}=(0,l.Fy)(),{property:s,option:p,statusGroup:d,propertySchema:u,isDefault:m,disabled:h}=e,g=(0,L.Y$)(),S=(0,a.VK)((()=>{var e;return null===(e=g.collectionStore())||void 0===e?void 0:e.id}),[g]),y=(0,a.qz)(void 0,J.Z),f=(0,a.VK)((()=>y.state.open),[y]),x=(0,n.useCallback)((()=>{y.setState({open:!0})}),[y]),v=(0,n.useCallback)((()=>{y.setState({open:!1})}),[y]),C=(0,n.useCallback)((e=>{const t=g.collectionStore();t&&V.HW({environment:o,collectionStore:t,performTransaction:o=>{for(const n of e)D.applyOperation({store:(0,oe.Kv)(t,n.pointer),operation:n,transaction:o})}})}),[g,o]),b=(0,c.yK)((()=>({defaultText:{fontSize:12,fontWeight:500,textTransform:"uppercase"}})),[]);return S?(0,Se.jsx)(Pt.Z,{open:f,origin:(0,Se.jsx)(It.Z,{renderTooltip:e=>(0,Se.jsxs)("div",{...e,style:E.F6,children:[(0,Se.jsx)("div",{children:p.value}),(0,Se.jsx)("div",{style:{color:i.mediumInvertedTextColor},children:p.description})]}),placement:Mt.u.Left,disableTooltip:!(null!==(t=p.description)&&void 0!==t&&t.length),render:e=>{var t,o;return(0,Se.jsx)(Ae.Z,{...e,showDragHandle:!0,showChevron:!0,disabled:h,rotateChevron:f,title:"status"===u.type?(0,Se.jsx)(kt.F,{format:r?_t.lo.Large:_t.lo.Medium,value:p.value,color:p.color,hideTooltip:!(null===(t=p.description)||void 0===t||!t.length),tooltipPlacement:Mt.u.Left,showRemoveButton:!1,isSingle:!0,groupColor:null==d?void 0:d.color}):(0,Se.jsx)(kt.a,{format:r?_t.lo.Large:_t.lo.Medium,value:p.value,color:p.color,hideTooltip:!(null===(o=p.description)||void 0===o||!o.length),tooltipPlacement:Mt.u.Left,showRemoveButton:!1,isSingle:!0}),right:m?(0,Se.jsx)("span",{style:b.defaultText,children:(0,Se.jsx)(k.FormattedMessage,{id:"database.statusProperty.default",defaultMessage:"Default"})}):void 0,onClick:x})}}),option:p,property:s,propertySchema:u,statusGroup:d,collectionId:S,analyticsFrom:"view_settings",alignmentToOrigin:Mt.v.End,onChange:C,onClose:v}):null}var Ft=o(97180),At=o(79131),Rt=o(73063),Zt=o(3386);class Vt extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:jt.Z,inputGroupIndexState:p.default.createClass(void 0)},this.handleAutoSortChange=e=>{const{collectionContextStore:t,property:o}=this.props,n=t.collectionStore(),i=t.normalizedSchemaStore.state,r=Nt(this.props.collectionContextStore,this.props.property);if(!n||!r)return;if(!(0,d.cu)(r))return;const s=[{pointer:n.pointer,command:"update",path:["schema",o],args:{auto_sort_options:e}}];"alphabetical"!==e&&"reverse_alphabetical"!==e||s.push(...(0,U.L5)({collectionId:n.id,property:o,propertySchema:r,schema:i,isAscending:"alphabetical"===e})||[]),V.HW({environment:this.environment,collectionStore:n,performTransaction:e=>{for(const t of s)D.applyOperation({store:(0,oe.Kv)(n,t.pointer),operation:t,transaction:e})}}),F.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"select_change_auto_sort_options"})},this.handleNewOptionClick=e=>{this.stores.inputStore.setState({focus:!0,inputValue:""}),void 0!==e&&this.stores.inputGroupIndexState.setState(e)},this.handleInputChange=e=>{const t=e.target.value.replace(/,/g,"");this.stores.inputStore.setState({focus:!0,inputValue:t})},this.handleInputBlur=()=>{const e=this.environment.device.isPhone?this.stores.inputStore.state.inputValue:"";this.stores.inputStore.setState({focus:!1,inputValue:e})},this.handleInputSubmit=()=>{const{collectionContextStore:e,property:t}=this.props,o=e.collectionStore(),n=Nt(this.props.collectionContextStore,this.props.property);if(!n||!o)return;const i=n.options||[],r=this.stores.inputStore.state.inputValue;if(r){let e=(0,d.TL)(i);if("status"===n.type){var s;const t=null===(s=this.stores.inputGroupIndexState)||void 0===s?void 0:s.state;if(void 0!==t){var l;const o=null===(l=n.groups)||void 0===l||null===(l=l[t])||void 0===l?void 0:l.color;o&&(e=o)}}if(i.find((e=>e.value===r)))return wt.showErrorMessage((0,Se.jsx)(Dt,{})),void this.handleInputBlur();const c={id:(0,bt.ZP)(),value:r,color:e};let p,u;if(p=(0,d.cu)(n)&&("alphabetical"===n.auto_sort_options||"reverse_alphabetical"===n.auto_sort_options)&&ee.default.checkGate("collection_properties_select_auto_sort_options")?(0,d.Ch)({collectionId:o.id,property:t,propertySchema:n,newOption:c,isAscending:"alphabetical"===n.auto_sort_options}):{pointer:o.pointer,command:"keyedObjectListBefore",path:["schema",t,"options"],args:{value:c}},"status"===n.type){var a;const e=null===(a=this.stores.inputGroupIndexState)||void 0===a?void 0:a.state;void 0!==e&&(u={pointer:o.pointer,command:"listBefore",path:["schema",t,"groups",e,"optionIds"],args:{id:c.id}})}V.HW({environment:this.environment,collectionStore:o,performTransaction:e=>{D.applyOperation({store:(0,oe.Kv)(o,p.pointer),operation:p,transaction:e}),u&&D.applyOperation({store:(0,oe.Kv)(o,u.pointer),operation:u,transaction:e})}})}this.stores.inputStore.setState({focus:!0,inputValue:""}),F.$q({environment:this.environment,collectionContextStore:e,property:t,from:"view_settings",action:"select_add_option"})},this.handleSelectDraggableListDrop=e=>{const{property:t,collectionContextStore:o}=this.props,n=o.normalizedSchemaStore.state,i=o.collectionStore();if(!i)return;const r=n[t];let s;if("status"===(null==r?void 0:r.type)){s=[[]];for(const t of e)t.startsWith("group-header-")?s.push([]):s[s.length-1].push(t)}else s=e;const l=(0,U.YL)({newOptions:s,collectionId:i.id,property:t,schema:n});if(l){if(r&&(0,d.cu)(r)){"manual"!==(r.auto_sort_options||"manual")&&l.push({pointer:i.pointer,command:"update",path:["schema",t],args:{auto_sort_options:"manual"}})}V.HW({environment:this.environment,collectionStore:i,performTransaction:e=>{for(const t of l)D.applyOperation({store:(0,oe.Kv)(i,t.pointer),operation:t,transaction:e})}})}F.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"select_options_reorder"})}}renderComponent(){var e,t;const{collectionContextStore:o,property:n,disabled:i,aIAutofillOption:r}=this.props,s=null===(e=o.collectionStore())||void 0===e?void 0:e.getSchema(),l=null===(t=o.collectionStore())||void 0===t?void 0:t.getFormat().app_config_uri,a=Nt(this.props.collectionContextStore,this.props.property);if(!s||!a)return;const{inputStore:c,inputGroupIndexState:p}=this.stores,d=c.state,u=p.state;if("status"===a.type){const e=a.groups??[];if(0===e.length)return;const t=a.options??[],o=e.map((e=>{const o=t.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return{group:e,groupOptions:o}})),r=a.defaultOption,c=[...o[0].groupOptions.map((e=>e.value))];for(const{group:n,groupOptions:i}of o.slice(1))c.push({key:`group-header-${n.name}`,draggable:!1}),c.push(...i.map((e=>e.value)));const p=(0,K.Hw)(l,s,n)?{tooltipCaption:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"These options are core to the property and cannot be changed.",id:"database.viewSettings.selectOptions.disabledGroupMessage"})}:void 0,m=(s,l)=>{if(s.startsWith("group-header-")){const e=s.substring("group-header-".length),t=o.findIndex((t=>{let{group:o}=t;return o.name===e})),{group:n,groupOptions:r}=o[t];return(0,Se.jsxs)(Ot,{title:(0,Se.jsx)(Ft.r_,{disableGroup:p,group:n,showIcon:!1}),right:!d.focus&&(0,Se.jsx)(Kt,{collectionContextStore:this.props.collectionContextStore,property:this.props.property,intl:this.props.intl,onClick:()=>this.handleNewOptionClick(t)}),disabled:i,children:[u===t&&this.renderNewOptionInput(),!d.focus&&0===r.length&&this.renderNewOptionItem(t)]})}{const o=t.find((e=>e.value===s));if(!o)return;const l=e.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(o.id)}));return(0,Se.jsx)(Tt,{option:o,statusGroup:l,propertySchema:a,property:n,isDefault:o.value===r,disabled:i},o.value)}};return(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsxs)(Ot,{title:(0,Se.jsx)(Ft.r_,{disableGroup:p,group:o[0].group}),right:!d.focus&&(0,Se.jsx)(Kt,{collectionContextStore:this.props.collectionContextStore,property:this.props.property,intl:this.props.intl,onClick:()=>this.handleNewOptionClick(0)}),disabled:i,children:[0===u&&this.renderNewOptionInput(),!d.focus&&0===o[0].groupOptions.length&&this.renderNewOptionItem(0)]}),(0,Se.jsx)(At.ZP,{direction:"vertical",keys:c,renderKey:m,onDrop:this.handleSelectDraggableListDrop,disabled:i})]})}{const e=a.options??[],t=e.map((e=>e.value)),o=a.auto_sort_options||"manual";return[ee.default.checkGate("collection_properties_select_auto_sort_options")&&(0,Se.jsx)(be.Z,{title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.selectOptions.autoSort"}),selectedKey:o,options:[{key:"manual",title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Manual",id:"database.viewSettings.selectOptions.autoSort.none"})},{key:"alphabetical",title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.viewSettings.selectOptions.autoSort.alphabetical"})},{key:"reverse_alphabetical",title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Reverse alphabetical",id:"database.viewSettings.selectOptions.autoSort.reverseAlphabetical"})}],onChange:this.handleAutoSortChange,popupStyle:{minWidth:190}},"autoSortMenuItem"),r,(0,Se.jsx)(Ot,{title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Options",id:"database.viewSettings.selectOptions.title"}),right:!d.focus&&t.length>0&&(0,Se.jsx)(Kt,{collectionContextStore:this.props.collectionContextStore,property:this.props.property,intl:this.props.intl,onClick:()=>this.handleNewOptionClick()}),disabled:i,children:this.renderNewOptionInput()},"sectionHeader"),t.length>0&&(0,Se.jsx)(At.ZP,{direction:"vertical",keys:t,renderKey:t=>{const o=e.find((e=>e.value===t));if(o)return(0,Se.jsx)(Tt,{option:o,property:n,propertySchema:a,isDefault:!1,statusGroup:void 0,disabled:i},o.value)},onDrop:this.handleSelectDraggableListDrop}),!d.focus&&0===t.length&&this.renderNewOptionItem()]}}renderNewOptionInput(){const{inputStore:e}=this.stores,t=e.state;if(t.focus)return(0,Se.jsx)(Zt.Z,{capture:!0,onEsc:this.handleInputBlur,children:(0,Se.jsx)(he.ZP,{value:t.inputValue,focus:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Type a new option…",id:"database.viewSettings.selectOptions.newSelectOption.inputPlaceholder"}),style:{marginTop:2,marginBottom:8},onChange:this.handleInputChange,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,mobileKeyboardOnDismiss:this.handleInputSubmit})})}renderNewOptionItem(e){return(0,Se.jsx)(it.Z,{icon:(0,Ct.R)({width:14}),focused:!1,title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.noOptions"}),style:{width:"100%"},onClick:()=>this.handleNewOptionClick(e)})}}Vt.displayName="CollectionSettingsSelectOptions";const Bt=(0,k.injectIntl)(Vt);function Ot(e){let{title:t,right:o,children:n,disabled:i}=e;return(0,Se.jsx)(ge.Z,{topBorder:!0,title:t,desktopTitleStyle:{height:20},right:!i&&o,style:{width:"100%",paddingBottom:0},children:!i&&n})}function Dt(){return(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Option already exists.",id:"database.optionExistsAlreadyError.message"})}function Nt(e,t){const o=e.normalizedSchemaStore.state[t];if(o&&((0,d.cu)(o)||"status"===o.type))return o}function Kt(e){let{onClick:t,collectionContextStore:o,property:n,intl:i}=e;window.__c={n:"NewOptionButton"};return(0,a.VK)((()=>Nt(o,n)),[o,n])?(0,Se.jsx)(Rt.Z,{icon:Ct.R,onClick:t,style:{width:20,height:20},ariaLabel:i.formatMessage({defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.addOption"})}):null}var Lt=o(42283),qt=o(53866);const Et=(0,k.defineMessages)({statusShowAsLabel:{id:"database.viewSettings.statusOptions.showAs",defaultMessage:"Show as"},statusCheckboxLabel:{id:"database.viewSettings.statusOptions.showAs.checkbox",defaultMessage:"Checkbox"},statusSelectLabel:{id:"database.viewSettings.statusOptions.showAs.select",defaultMessage:"Select"}});class Ut extends r.Z{constructor(){super(...arguments),this.handleShowAsChange=e=>{const{collectionContextStore:t,property:o}=this.props,n=t.formatStore();if(!n)return;const i=t.getPropertyFormatKey();i&&(D.createAndCommit({userAction:"CollectionSettingsStatusOptions.handleShowAsChange",environment:this.environment,perform:t=>{A.er({formatStore:n,formatKey:i,property:o,update:{statusShowAs:e,visible:!0},transaction:t})}}),F.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"status_change_format"}))},this.iconStyle={width:16,height:16,fill:this.theme.mediumIconColor}}renderComponent(){var e;const{collectionContextStore:t,property:o,disabled:n}=this.props;if(!function(e,t){const o=e.normalizedSchemaStore.state[t];if(!o||"status"!==o.type)return;return o}(this.props.collectionContextStore,this.props.property))return;const i=[{key:"checkbox",title:H.default.formatMessage(Et.statusCheckboxLabel),icon:(0,Lt.r)(this.iconStyle)},{key:"select",title:H.default.formatMessage(Et.statusSelectLabel),icon:(0,qt.w)(this.iconStyle)}],r=(null===(e=t.getPropertyFormat(o))||void 0===e?void 0:e.statusShowAs)??"select";return(0,Se.jsx)(be.Z,{title:H.default.formatMessage(Et.statusShowAsLabel),selectedKey:r,popupStyle:{minWidth:190},options:i,onChange:e=>this.handleShowAsChange(e),disabled:n})}}Ut.displayName="CollectionSettingsStatusOptions";const Wt=(0,k.injectIntl)(Ut);function zt(e){let{collectionContextStore:t,property:o,propertySchema:n}=e;window.__c={n:"CollectionSettingsUrlOptions"};const i=(0,l.O7)();return(0,Se.jsx)(Ae.Z,{title:(0,Se.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Only show domain",id:"database.viewSettings.propertyTab.toggleShortenUrl"})}),showChevron:!1,right:(0,Se.jsx)(Je.Z,{on:Boolean(n.shorten_url),onClick:()=>$t(i,t,o,n),disabled:!1,noColor:!1}),onClick:()=>$t(i,t,o,n)})}function $t(e,t,o,n){const i=t.collectionStore();if(!n||!i||"url"!==n.type)return;const r=!Boolean(n.shorten_url);D.createAndCommit({userAction:"CollectionSettingsProperty.handleNumberShowAsChange",environment:e,perform:t=>{V.xO({environment:e,collectionStore:i,update:{[o]:{...n,shorten_url:r}},transaction:t})}}),F.$q({environment:e,collectionContextStore:t,property:o,from:"view_settings",action:r?"url_toggle_shorten_on":"url_toggle_shorten_off"})}var Ht=o(74420),Gt=o(31278),Yt=o(76798),Qt=o(32662),Xt=o(64369),Jt=o(18145);const eo=(0,k.defineMessages)({inputPlaceholder:{defaultMessage:"Property name",id:"database.viewSettings.propertyTab.propertyName"},autofillOffLabel:{defaultMessage:"Off",id:"database.viewSettings.propertyTab.autofillOffLabel"},autofillOnLabel:{defaultMessage:"On",id:"database.viewSettings.propertyTab.autofillOnLabel"},keptUpToDateWithNotionAITooltip:{defaultMessage:"Auto-updated by AI",id:"database.tableHeaderCell.tooltipAiAutofillDescription"}});class to extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:p.default.createClass(""),propertyTypeButtonPopupStore:J.Z,addedPropertyDescriptionStore:p.default.createClass(!1)},this.handlePropertyTypeClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props,o=yo(this.props.collectionContextStore,this.props.property),n=t.collectionStore();n&&R.H4({collectionSettingsStore:e,item:{type:"propertyType",propertySchema:o,propertyTypes:(0,q.TP)({isSyncedCollection:n.isSyncedCollection(),collectionContextStore:t,environment:this.environment}),onAccept:this.handlePropertyTypeAccept}})},this.handleAiAutofillClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t,property:o}=this.props,n=yo(this.props.collectionContextStore,o);t.collectionStore()&&n&&R.H4({collectionSettingsStore:e,item:{type:"propertyAiAutofill",propertySchema:n,property:o}})},this.handlePropertyNameSubmit=e=>{if(this.shouldShowDuplicateError())return;const{property:t,collectionContextStore:o}=this.props,n=so(this.props.collectionContextStore);if(!n)return;const i=n.getSchema()[t];i&&i.name!==e&&(D.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyNameSubmit",environment:this.environment,perform:o=>{A.Bv({collectionStore:n,property:t,name:e,transaction:o})}}),F.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"rename"}))},this.handlePropertyIconSubmit=e=>{const{property:t,collectionContextStore:o}=this.props,n=so(this.props.collectionContextStore);n&&(D.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyIconSubmit",environment:this.environment,perform:o=>{A.OK({collectionStore:n,property:t,icon:e,transaction:o})}}),F.$q({environment:this.environment,collectionContextStore:o,property:t,icon:e,from:"view_settings",action:"change_icon"}))},this.handleToggleVisibilityClick=()=>{const{collectionContextStore:e,formatKey:t}=this.props,o=po(this.props.property,this.props.formatKey,this.props.collectionContextStore),n=e.collectionViewStore(),i=e.normalizedFormatStore.state,r=yo(this.props.collectionContextStore,this.props.property);if(!r)return;if(!(o&&n&&t&&r))return;const s={...i,[t]:lo(this.props.formatKey,this.props.collectionContextStore).map((e=>e.property===o.property?{...o,visible:!o.visible}:e))};D.createAndCommit({userAction:"CollectionSettingsProperty.handleToggleVisibilityClick",environment:this.environment,perform:t=>{V.iG({collectionViewStore:n,update:{format:s},transaction:t});const i=uo(this.props.property,this.props.formatKey,this.props.collectionContextStore);O.oz({environment:this.environment,collectionContextStore:e,currentIndex:i,entrypoint:"CollectionSettingsProperty",transaction:t,propertyAction:o.visible?"hide":"show"})}}),F.wd({environment:this.environment,collectionContextStore:e,action:"toggle_property_visibility",original_view_type:n.getType(),property_type:r.type})},this.handleTogglePropertyWrapClick=()=>{const{collectionContextStore:e,formatKey:t}=this.props,o=po(this.props.property,this.props.formatKey,this.props.collectionContextStore),n=e.collectionViewStore(),i=e.normalizedFormatStore.state,r=yo(this.props.collectionContextStore,this.props.property);r&&o&&n&&t&&r&&(O.K4({currentValue:this.wrapProperty.state,environment:this.environment,property:this.props.property,collectionViewStore:n,format:i,formatKey:t}),F.wd({environment:this.environment,collectionContextStore:e,action:"toggle_property_wrap",original_view_type:n.getType(),property_type:r.type}))},this.handleDuplicateClick=async()=>{const{property:e,collectionContextStore:t,collectionSettingsStore:o,formatKey:n}=this.props,i=lo(this.props.formatKey,this.props.collectionContextStore),r=co(this.props.collectionContextStore),s=so(this.props.collectionContextStore),l=t.collectionViewStore(),a=null==s?void 0:s.getSpaceId();if(!s||!l||!a)return;const c=yo(this.props.collectionContextStore,this.props.property);if(!c)return;const p=await(0,U.xy)({environment:this.environment,schema:r,property:e,properties:i,parentStore:s,spaceId:a});p&&(D.createAndCommit({userAction:"CollectionSettingsProperty.handleDuplicateClick",environment:this.environment,perform:e=>{V.xO({environment:this.environment,collectionStore:s,update:{[p.newProperty]:p.newPropertySchema},transaction:e});const o=uo(this.props.property,this.props.formatKey,this.props.collectionContextStore);O.oz({environment:this.environment,collectionContextStore:t,currentIndex:o,entrypoint:"CollectionSettingsProperty",transaction:e,propertyAction:"duplicate"}),p.automationUpdate&&V.Ki({environment:this.environment,collectionStore:s,update:p.automationUpdate,transaction:e}),n&&B.FH({stores:[l],update:{[n]:p.newProperties},transaction:e})}}),R.FK({collectionSettingsStore:o,item:{type:"property",property:p.newProperty,formatKey:n}}),F.wd({environment:this.environment,collectionContextStore:t,action:"duplicate_property",original_view_type:null==l?void 0:l.getType(),property_type:c.type}))},this.handleDeleteClick=async()=>{const{collectionContextStore:e,property:t}=this.props;await A.TI({environment:this.environment,collectionContextStore:e,property:t,handleDeleteAccept:this.handleDeleteAccept,theme:this.theme,from:"view_settings"})},this.handleDeleteAccept=()=>{const{property:e,collectionContextStore:t,collectionSettingsStore:o}=this.props,n=yo(this.props.collectionContextStore,this.props.property),i=co(this.props.collectionContextStore),r=so(this.props.collectionContextStore);n&&(r&&D.createAndCommitAsync({environment:this.environment,userAction:"CollectionSettingsProperty.handleDeleteAccept",waitForServerCommit:!1,perform:async o=>{await A.yV({environment:this.environment,collectionStore:r,schema:i,property:e,transaction:o});const n=uo(this.props.property,this.props.formatKey,this.props.collectionContextStore);O.oz({environment:this.environment,collectionContextStore:t,currentIndex:n,entrypoint:"CollectionSettingsProperty",transaction:o,propertyAction:"delete"})}}),R.z$({collectionSettingsStore:o}),F.wd({environment:this.environment,collectionContextStore:t,action:"delete_property",property_type:null==n?void 0:n.type}),F.y9({environment:this.environment,collectionContextStore:t,property_type:n.type,from:"view_settings",property:e}))},this.handleRollupPropertyMenuChange=e=>{const{property:t}=this.props,o=so(this.props.collectionContextStore);o&&D.createAndCommit({userAction:"CollectionSettingsProperty.handleRollupPropertyMenuChange",environment:this.environment,perform:n=>{V.xO({environment:this.environment,collectionStore:o,update:{[t]:e.propertySchema},transaction:n})}})},this.handlePropertyTypeAccept=e=>{const{property:t,collectionContextStore:o,collectionSettingsStore:n,formatKey:i}=this.props,r=so(this.props.collectionContextStore);r&&(F.$q({environment:this.environment,collectionContextStore:o,property:t,new_property_type:(0,d.TN)(e),from:"view_settings",action:"change_type"}),"relation"===e?R.H4({collectionSettingsStore:n,item:{type:"selectRelationSource",property:t,formatKey:i}}):(D.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyTypeAccept",environment:this.environment,perform:o=>{A.LC({environment:this.environment,collectionStore:r,property:t,type:e,transaction:o})}}),R.z$({collectionSettingsStore:n}),(0,d.XU)(e)&&Z.K7({propertyType:e,propertyId:t,collectionContextStore:o})),this.stores.propertyTypeButtonPopupStore.reset())},this.wrapProperty=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=t.collectionViewStore();return!!o&&(Boolean((null===(e=po(this.props.property,this.props.formatKey,this.props.collectionContextStore))||void 0===e?void 0:e.wrap)||o.getFormat().table_wrap)&&"timeline"!==o.getType())}))}didMount(){s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{!function(e,t,o){const n=t.collectionViewStore();if(!n||"table"!==n.getType())return;const r=X.Z.findTableHeaderCell(t,e);if(!r)return;const s=i.findDOMNode(r),l=i.findDOMNode(o);if(!s||!l)return;const a=(0,Y.xH)(s);if(!a)return;const c=l.getBoundingClientRect(),p=s.getBoundingClientRect().right+20-c.left;a.scrollLeft=a.scrollLeft+p}(this.props.property,this.props.collectionContextStore,this)}))}))}renderComponent(){const{theme:e}=this,{property:t,collectionContextStore:o,selectNameInitial:n,formatKey:i}=this.props,r=yo(o,t),s=po(t,i,o);if(!r)return;const l=o.collectionStore(),a="collectionTypedView"===o.contextType,c=ee.default.checkGate("property_descriptions")&&l,p=l&&l.getDatabaseType(),m=Boolean(p&&l&&l.isTypedProperty(t)),S=this.createComputedStore((()=>Boolean(l&&p&&K.cR((0,N.appConfigs)(),p,t,l)))),y=!(0,u.Kp)(r),f=a,x=a||(0,u.sh)({propertySchema:r,isTypedProperty:m}),v="collectionViewBlock"===o.contextType,C=this.stores.addedPropertyDescriptionStore.state;return(0,Se.jsxs)(Le.ZP,{...this.props,title:l?(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Edit property",id:"database.viewSettings.propertyTab.title"}):(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"View property",id:"database.viewSettings.propertyTab.title.viewProperty"}),footer:this.renderFooterActions(r,s,S.state,p),unconstrainedWidth:v,children:[(0,Se.jsxs)(ge.Z,{children:[(0,Se.jsx)(qe.Z,{disabled:f,initialValue:r.name||"",placeholder:H.default.formatMessage(eo.inputPlaceholder),onBlur:this.handlePropertyNameSubmit,onSubmit:this.handlePropertyNameSubmit,focusInitial:n,selectAll:n,inputStore:this.stores.inputStore,inputOuterStyle:v?{background:e.contentBackground}:void 0,iconButton:{icon:t=>(0,Se.jsx)(h.ZP,{type:r.type,icon:r.icon,size:16,theme:e,style:t}),iconStyle:{fill:g.Lr[e.mode].gray},enforceIconColor:"gray",onSubmit:this.handlePropertyIconSubmit}}),this.shouldShowDuplicateError()&&(0,Se.jsx)(io,{propertyName:this.stores.inputStore.state})]}),(0,Se.jsxs)(ge.Z,{children:[y&&this.renderPropertyTypeMenuItem(x,m,p),a?(0,Se.jsx)(Se.Fragment,{children:"status"===r.type&&(0,Se.jsx)(mo,{collectionSettingsStore:this.props.collectionSettingsStore,collectionContextStore:this.props.collectionContextStore,property:this.props.property})}):(0,Se.jsxs)(Se.Fragment,{children:[(0,z.Zt)(this.environment)&&"text"===r.type&&this.renderAiAutofillMenuItem(),(0,d.cu)(r)&&(0,Se.jsx)(Io,{collectionSettingsStore:this.props.collectionSettingsStore,collectionContextStore:this.props.collectionContextStore,property:this.props.property,propertySchema:r}),"status"===r.type&&(0,Se.jsx)(mo,{collectionSettingsStore:this.props.collectionSettingsStore,collectionContextStore:this.props.collectionContextStore,property:this.props.property}),"formula"===r.type&&(0,Se.jsx)(ho,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore,property:this.props.property}),"rollup"===r.type&&this.renderRollupOptions(),("date"===r.type||"created_time"===r.type||"last_edited_time"===r.type)&&(0,Se.jsx)(go,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),"relation"===r.type&&(0,Se.jsx)(So,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),"person"===r.type&&(0,Se.jsx)(jo,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),(0,Se.jsx)(fo,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),(0,Se.jsx)(xo,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),"auto_increment_id"===r.type&&(0,Se.jsx)(wo,{collectionContextStore:this.props.collectionContextStore,property:this.props.property})]})]}),c&&(0,Se.jsx)(oo,{propertySchema:r,property:t,collectionStore:l,addedPropertyDescription:C}),"button"===r.type&&(0,Se.jsx)(Co,{collectionContextStore:this.props.collectionContextStore,property:this.props.property})]})}renderFooterActions(e,t,o,n){const{property:i,formatKey:r,collectionContextStore:s}=this.props,l=s.collectionStore(),a=r&&("title"!==i||(0,U.XO)({viewType:ao(this.props.collectionContextStore),format:s.normalizedFormatStore.state})),c=r&&"title"!==i&&(0,U.w0)({viewType:ao(this.props.collectionContextStore)}),p=q.Tr.includes(e.type)&&!(0,d.dx)(e)&&l,u=q.Tr.includes(e.type)&&l,m=ee.default.checkGate("property_descriptions")&&l,h=a||p||u||m;return(0,Se.jsxs)(Se.Fragment,{children:[h&&(0,Se.jsxs)(ge.Z,{topBorder:!0,children:[l&&(0,Se.jsx)(Mo,{environment:this.environment,collectionStore:l,collectionContextStore:s,property:i,propertySchema:e}),m&&!this.stores.addedPropertyDescriptionStore.state&&(0,Se.jsx)(no,{propertySchema:e,property:i,collectionStore:l,setAddedPropertyDescription:()=>this.stores.addedPropertyDescriptionStore.setState(!0)}),a&&t&&(null!=t&&t.visible?(0,Se.jsx)(Ae.Z,{icon:f.L,isPadded:!0,title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Hide in view",id:"database.viewSettings.propertyTab.hideInViewButton.title"}),onClick:this.handleToggleVisibilityClick}):(0,Se.jsx)(Ae.Z,{icon:x.N,isPadded:!0,title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Show in view",id:"database.viewSettings.propertyTab.showInViewButton.title"}),onClick:this.handleToggleVisibilityClick})),c&&t&&(this.wrapProperty.state?(0,Se.jsx)(Ae.Z,{icon:j.A,iconStyle:{transform:"scale(.8)"},isPadded:!0,title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Don't wrap in view",id:"database.viewSettings.propertyTab.dontWrapInViewButton.title"}),onClick:this.handleTogglePropertyWrapClick}):(0,Se.jsx)(Ae.Z,{icon:_.p,iconStyle:{transform:"scale(.7)"},isPadded:!0,title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Wrap in view",id:"database.viewSettings.propertyTab.wrapInViewButton.title"}),onClick:this.handleTogglePropertyWrapClick})),p&&(0,Se.jsx)(Ae.Z,{icon:y.a,title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.viewSettings.propertyTab.duplicateButton.title"}),onClick:this.handleDuplicateClick}),u&&this.renderDeletePropertyMenuItem(o,n)]}),"formula"===e.type&&(0,Se.jsx)(ge.Z,{topBorder:!0,children:(0,Se.jsx)(Ne.Z,{href:(0,G.UY)("guides.formulas"),title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Learn about formulas",id:"database.viewSettings.propertyTab.formulas.learnMoreButton.title"}),analyticsFrom:"view_settings_property_formula"})}),"relation"===e.type&&(0,Se.jsx)(Po,{collectionContextStore:this.props.collectionContextStore,property:this.props.property}),"rollup"===e.type&&(0,Se.jsx)(ge.Z,{topBorder:!0,children:(0,Se.jsx)(Ne.Z,{href:(0,G.UY)("guides.relations"),title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Learn about rollups",id:"database.viewSettings.propertyTab.rollups.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})})]})}renderPropertyTypeMenuItem(e,t,o){const{propertyTypeButtonPopupStore:n}=this.stores,i=this.props.collectionContextStore.collectionViewBlockStore(),r=yo(this.props.collectionContextStore,this.props.property),s=vt(i,r);if(!r)return;const l=null==s?void 0:s.getIcon(),{theme:a}=this,c=(0,u.gg)(r)||(0,u.ic)(r);return(0,Se.jsx)(It.Z,{placement:It.Z.Placement.Left,disableTooltip:!e,renderTooltip:e=>t?(0,Se.jsx)(k.FormattedMessage,{...e,defaultMessage:"{type} type is required for this property in {databaseType}.",id:"database.viewSettings.propertyTab.restrictedProperty",description:"A tooltip to educate the users on why they can't change the type of this property.",values:{type:q.SO[r.type],databaseType:(0,$.Mn)(o)}}):(0,Se.jsx)(k.FormattedMessage,{...e,defaultMessage:"{type}'s type cannot be changed.",id:"database.viewSettings.propertyTab.untypedRestrictedProperty",description:"A tooltip to educate the users on why they can't change the type of this property.",values:{type:q.SO[r.type]}}),render:t=>(0,Se.jsx)(Ae.Z,{...t,disabled:e,rotateChevron:n.state.open,title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Type",id:"database.viewSettings.propertyTab.propertyType"}),showChevron:!0,right:(0,Se.jsxs)(Se.Fragment,{children:[e?(0,Se.jsx)("div",{...t,children:(0,b.Q)({width:14,fill:a.regularIconColor})}):(0,Se.jsx)(h.ZP,{type:r.type,icon:void 0,size:16,theme:a}),(0,Se.jsx)(Qt.Z,{size:4}),c?(0,Se.jsxs)("div",{style:{color:e?a.darkTextColor:void 0,display:"flex",alignItems:"center"},children:[(0,Se.jsx)(Gt.Z,{icon:l,isEmptyPage:!1,size:20,disabled:!0}),(0,Se.jsx)(Yt.Z,{store:s,style:{display:"inline",wordBreak:"break-word",...P.Z.textOverflowStyle}})]}):(0,Se.jsx)("span",{style:{color:e?a.darkTextColor:void 0},children:q.SO[r.type]})]}),onClick:this.handlePropertyTypeClick})})}renderAiAutofillMenuItem(){const e=yo(this.props.collectionContextStore,this.props.property);if(!e||"text"!==e.type)return;const t=(0,d.q3)(e);let o;return t&&(0,d.MD)(t.type)?"summarize"===t.type?o=W.Dr.autofillSummary:"extract"===t.type?o=W.Dr.autofillExtract:"custom"===t.type?o=W.Dr.autofillCustom:"translate"===t.type?o=W.Dr.autofillTranslate:(0,I.t1)(t):o=eo.autofillOffLabel,(0,Se.jsx)(Ae.Z,{title:(0,Se.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"AI Autofill",id:"database.viewSettings.propertyTab.aiAutofill.open"}),(0,Se.jsx)(Ht.Z,{style:{display:"inline-block"}})]}),showChevron:!0,right:H.default.formatMessage(o),onClick:this.handleAiAutofillClick})}renderRollupOptions(){const{property:e}=this.props,t=so(this.props.collectionContextStore),o=co(this.props.collectionContextStore);if(!t)return;const n=Boolean(t.getDatabaseType()&&t.isTypedProperty(e));return(0,Se.jsx)(Jt.Z,{disabled:n,context:Jt.t.ViewSettings,property:e,schema:o,analyticsFrom:"view_settings",parentStore:t,onChange:this.handleRollupPropertyMenuChange})}renderDeletePropertyMenuItem(e,t){return(0,Se.jsx)(It.Z,{disableTooltip:!e,placement:It.Z.Placement.Left,renderTooltip:e=>(0,$.A7)(t,e),render:o=>(0,Se.jsx)(Ae.Z,{...o,isRed:!0,disabled:e,onClick:this.handleDeleteClick,icon:()=>e?(0,Se.jsx)("div",{...o,style:{display:"inline-flex"},children:(0,b.Q)({width:14,marginLeft:4,marginRight:4})}):(0,w.y)({width:14,marginLeft:4,marginRight:4}),title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Delete property",id:"database.viewSettings.propertyTab.deleteButton.title"}),caption:this.environment.device.isMobile&&e?(0,$.A7)(t):null})})}shouldShowDuplicateError(){const{property:e}=this.props,{inputStore:t}=this.stores,o=co(this.props.collectionContextStore),n=t.state,i=Object.keys(o).find((t=>{var i;return t!==e&&(null===(i=o[t])||void 0===i?void 0:i.name)===n}));return Boolean(i)}}function oo(e){window.__c={n:"CollectionSettingsPropertyDescriptionSection"};const{propertySchema:t,property:o,collectionStore:i,addedPropertyDescription:r}=e,s=(0,L.Y$)(),a=(0,l.O7)(),p=t.description,[d,u]=(0,n.useState)(t.description??""),m=(0,n.useRef)(d),h=(0,l.MO)(),g=(0,c.yK)((()=>({title:{display:"flex",alignItems:"center",gap:4,cursor:"default"},infoTooltip:{width:300,whiteSpace:"normal"},descriptionInput:{marginBottom:h?void 0:6,padding:h?"8px 0":void 0,lineHeight:"20px"}})),[h]),S=(0,n.useCallback)((()=>{var e;const t=null==i||null===(e=i.getSchema())||void 0===e?void 0:e[o];void 0!==t&&t.description!==m.current&&(D.createAndCommit({userAction:"CollectionSettingsProperty.handleDescriptionChange",environment:a,perform:e=>{V.xO({environment:a,collectionStore:i,update:{[o]:{...t,description:m.current.length>0?m.current:void 0}},transaction:e})}}),F.$q({environment:a,collectionContextStore:s,property:o,from:"view_settings",action:"set_description"}))}),[i,o,a,s]),y=(0,n.useRef)(S);return y.current=S,(0,n.useEffect)((()=>()=>y.current()),[y]),void 0!==p||r?(0,Se.jsx)(ge.Z,{topBorder:!0,title:(0,Se.jsxs)("span",{style:g.title,children:[(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Description",id:"database.viewSettings.propertyTab.description.title"}),(0,Se.jsx)(It.Z,{placement:It.Z.Placement.Bottom,render:e=>(0,Se.jsx)("div",{...e,children:(0,v.m)({width:12})}),renderTooltip:e=>(0,Se.jsx)("div",{...e,style:g.infoTooltip,children:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Descriptions provide extra context when hovering over property names.",id:"database.viewSettings.propertyTab.description.tooltip"})})})]}),children:(0,Se.jsx)(he.ZP,{value:d,onChange:e=>{u(e.target.value),m.current=e.target.value},onBlur:S,onSubmit:S,placeholder:"",focusInitial:r,disabled:!1,style:g.descriptionInput,textarea:!0,textareaSubmitOnEnter:!0,maxlength:E.pT,autosize:!0,autosizeMaxHeight:E.e3})}):(0,Se.jsx)(Se.Fragment,{})}function no(e){window.__c={n:"CollectionSettingsAddPropertyDescription"};const{propertySchema:t,property:o,collectionStore:i,setAddedPropertyDescription:r}=e,s=(0,l.O7)(),a=t.description,c=(0,n.useCallback)((()=>{D.createAndCommit({userAction:"CollectionSettingsProperty.handleAddDescriptionClick",environment:s,perform:e=>{V.xO({environment:s,collectionStore:i,update:{[o]:{...t,description:""}},transaction:e})}}),r()}),[i,s,o,t,r]);return void 0!==a?(0,Se.jsx)(Se.Fragment,{}):(0,Se.jsx)(Ae.Z,{icon:C.D,isPadded:!1,title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Add description",id:"database.viewSettings.propertyTab.addDescription.title"}),onClick:c})}function io(e){return(0,Se.jsx)(Xt.Z,{isMultiline:!0,style:{paddingTop:8,marginLeft:16,marginRight:16,color:m.ZP.red,...e.styles},children:(0,Se.jsx)(k.FormattedMessage,{id:"database.viewSettings.propertyTab.duplicatePropertyNameError",defaultMessage:"A property named {propertyName} already exists in this database.",values:{propertyName:e.propertyName}})})}to.displayName="CollectionSettingsProperty";const ro=(0,k.injectIntl)(to);function so(e){if(e.collectionViewBlockStore())return e.collectionStore()}function lo(e,t){if(!e)return[];return t.normalizedFormatStore.state[e]||[]}function ao(e){const t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}function co(e){const t=so(e);return t?t.getSchema():e.normalizedSchemaStore.state||{}}function po(e,t,o){const n=lo(t,o);return null==n?void 0:n.find((t=>t.property===e))}function uo(e,t,o){const n=lo(t,o);if(0===n.length)return-1;return n.filter((e=>e.visible)).findIndex((t=>t.property===e))}function mo(e){let{collectionSettingsStore:t,collectionContextStore:o,property:n}=e;window.__c={n:"StatusOptions"};const i=(0,a.VK)((()=>{var e;return K.Hw(null===(e=o.collectionStore())||void 0===e?void 0:e.getDatabaseType(),o.normalizedSchemaStore.state,n)}),[o,n]);return(0,Se.jsxs)(Se.Fragment,{children:[i?null:(0,Se.jsx)(Wt,{collectionContextStore:o,property:n,disabled:i}),(0,Se.jsx)(Bt,{collectionSettingsStore:t,collectionContextStore:o,property:n,disabled:i,aIAutofillOption:null})]})}function ho(e){let{collectionContextStore:t,collectionSettingsStore:o,property:n}=e;return(0,Se.jsx)(De,{collectionContextStore:t,collectionSettingsStore:o,property:n})}function go(e){let{collectionContextStore:t,property:o}=e;return(0,Se.jsx)(je,{collectionContextStore:t,property:o})}function So(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"RelationOptions"};return(0,a.VK)((()=>{const e=t.normalizedSchemaStore.state[o];return(0,u.Kp)(e)}),[t,o])?(0,Se.jsx)(le.Z,{collectionContextStore:t,property:o}):(0,Se.jsx)(xt,{collectionContextStore:t,property:o})}function yo(e,t){return co(e)[t]}function fo(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"NumberOptions"};const n=(0,a.VK)((()=>yo(t,o)),[t,o]);return n&&("number"===n.type||"formula"===n.type||"rollup"===n.type)?(0,Se.jsx)(ut,{collectionContextStore:t,property:o}):null}function xo(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"URLOptions"};const n=(0,a.VK)((()=>ee.default.checkGate("collections_shorten_url")),[]),i=(0,a.VK)((()=>yo(t,o)),[t,o]),r=(0,a.VK)((()=>so(t)),[t]);return n&&i&&"url"===i.type&&r?(0,Se.jsx)(zt,{collectionContextStore:t,property:o,propertySchema:i}):null}function vo(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"DefaultPersonPicker"};const n=(0,a.VK)((()=>yo(t,o)),[t,o]);return n&&"person"===n.type?(0,Se.jsx)(Pe,{collectionContextStore:t,propertySchema:n,property:o}):null}function Co(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"ButtonOptions"};const n=(0,a.VK)((()=>yo(t,o)),[t,o]);return n&&"button"===n.type?(0,Se.jsx)(ye,{collectionContextStore:t,propertySchema:n,propertyId:o}):null}function bo(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"LimitOptions"};const n=(0,a.VK)((()=>yo(t,o)),[t,o]);return n?(0,Se.jsx)(Ke.C,{collectionContextStore:t,propertySchema:n,property:o}):null}function wo(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"AutoIncrementId"};const n=(0,a.VK)((()=>yo(t,o)),[t,o]),i=(0,a.VK)((()=>{var e;const o=null===(e=t.collectionStore())||void 0===e?void 0:e.getRecordKeyStore();return null==o?void 0:o.getRecordKey()}),[t]);return n&&"auto_increment_id"===n.type?(0,Se.jsx)(se.Z,{uniqueIdProperty:{propertyId:o,propertySchema:n},prefixValue:i,collectionContextStore:t}):null}function jo(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"PersonOptions"};const n=(0,Se.jsx)(bo,{collectionContextStore:t,property:o}),i=(0,a.VK)((()=>ee.default.checkGate("default_person_property")||(0,Q.iL)()),[])&&(0,Se.jsx)(vo,{collectionContextStore:t,property:o});return(0,Se.jsxs)(Se.Fragment,{children:[n,i]})}function _o(e){window.__c={n:"AutofillOptionSection"};const{environment:t,property:o,propertySchema:i,collectionSettingsStore:r,collectionStore:s}=e,l=(0,a.VK)((()=>(0,d.q3)(i)),[i]),c=(0,n.useCallback)((()=>{if(!s||!i||!(0,d.cu)(i))return;const e=(0,d.xo)(i);if(!e)return;const n=[];if(l)T._eA(t,{type:"remove_ai_inference",ai_inference_type:l.type,collection_id:s.id}),n.push({pointer:s.pointer,command:"set",path:["schema",o,e],args:void 0});else{const r={type:i.type,auto_update_on_edit:!1,add_options:!1};T._eA(t,{type:"set_ai_inference",ai_inference_type:r.type,collection_id:s.id}),n.push({pointer:s.pointer,command:"set",path:["schema",o,e],args:r})}V.HW({environment:t,collectionStore:s,performTransaction:e=>{for(const t of n)D.applyOperation({store:(0,oe.Kv)(s,t.pointer),operation:t,transaction:e})}})}),[l,s,t,o,i]),p=(0,n.useCallback)((e=>{if(!i||!s||!(0,d.qQ)(i))return;const n=(0,d.xo)(i);if(!n)return;const r={pointer:s.pointer,command:"set",path:["schema",o,n],args:e};V.HW({environment:t,collectionStore:s,performTransaction:e=>{D.applyOperation({store:(0,oe.Kv)(s,r.pointer),operation:r,transaction:e})}})}),[s,t,o,i]);return(0,a.VK)((()=>(0,z.KZ)()),[])?(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(Ot,{title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Autofill settings",id:"database.viewSettings.aiAutofill.section.title"}),disabled:!0},"aiSectionHeader"),(0,Se.jsx)(Ae.Z,{title:(0,Se.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"AI Autofill",id:"database.viewSettings.propertyTab.aiAutofill.open"}),(0,Se.jsx)(Ht.Z,{style:{display:"inline-block"}})]}),showChevron:!1,right:(0,Se.jsx)(Je.Z,{on:Boolean(l),onClick:c,disabled:!1,noColor:!1}),onClick:c}),l&&("select"===l.type||"multi_select"===l.type)&&(0,Se.jsxs)(Se.Fragment,{children:[(0,Se.jsx)(re.Z,{setAiInference:p,aiInference:l}),(0,Se.jsx)(Ae.Z,{title:(0,Se.jsxs)("div",{style:{display:"flex",alignItems:"center",lineHeight:1.2},children:[(0,Se.jsx)(k.FormattedMessage,{id:"database.collectionsettings.aiAutofillOptions.more",defaultMessage:"More"}),(0,S.o)({fill:m.ZP.uiGray,width:12,height:12,marginLeft:4})]}),disabled:!1,onClick:()=>{R.H4({collectionSettingsStore:r,item:{type:"propertyAiAutofill",propertySchema:i,property:o}})}})]})]}):null}function Mo(e){window.__c={n:"AutofillAllPagesButton"};const{environment:t,property:o,propertySchema:n,collectionContextStore:i,collectionStore:r}=e,s=(0,a.VK)((()=>{var e;const t=(null===(e=ne.default.state.data)||void 0===e?void 0:e.addOns)??[];return(0,M.de)(t)}),[]),l=(0,a.VK)((()=>{const e=i.collectionStore();return e&&(0,z.mX)(t,te.Z.getMode(t,e),e)}),[t,i]);return(0,a.VK)((()=>(0,d.cu)(n)&&(0,z.KZ)()&&n.select_ai_inference),[n])?(0,Se.jsx)(ie.TB,{environment:t,collectionContextStore:i,collectionStore:r,property:o,propertySchema:n,doesUserHaveAIAddOn:s,isAutofillSetupEnabled:Boolean(l)}):null}function Io(e){let{propertySchema:t,collectionSettingsStore:o,collectionContextStore:n,property:i}=e;window.__c={n:"SelectOptionsComponent"};const r=(0,l.O7)(),s=(0,a.VK)((()=>n.collectionStore()),[n]);return s?(0,Se.jsx)(Bt,{collectionSettingsStore:o,collectionContextStore:n,property:i,disabled:!1,aIAutofillOption:(0,Se.jsx)(_o,{environment:r,collectionStore:s,collectionSettingsStore:o,property:i,propertySchema:t})}):null}function Po(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"LearnAboutRelationsMenuItemComponent"};const n=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t])[o];let i;return i=(0,u.Kp)(n)?(0,Se.jsx)(Ne.Z,{href:(0,G.UY)("guides.githubRelation"),title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Learn about GitHub Pull Requests",id:"database.viewSettings.propertyTab.githubPrRelation.learnMoreButton.title"}),analyticsFrom:"view_settings_property_github_pr_relation"}):(0,Se.jsx)(Ne.Z,{href:(0,G.UY)("guides.relations"),title:(0,Se.jsx)(k.FormattedMessage,{defaultMessage:"Learn about relations",id:"database.viewSettings.propertyTab.relations.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"}),(0,Se.jsx)(ge.Z,{topBorder:!0,children:i})}},79892:(e,t,o)=>{o.d(t,{Z:()=>g});o(67294);var n=o(480),i=o(86628),r=o(24405),s=o(15145),l=o(82990),a=o(68939),c=o(84210),p=o(42917),d=o(84076),u=o(31278),m=o(76798),h=o(85893);function g(e){window.__c={n:"CollectionSettingsRelationTarget"};const{isSelfRelation:t,collectionStore:o,showAs:g,disabled:S,onClick:y}=e,f=(0,i.VK)((()=>Boolean(o)),[o]),x=(0,i.VK)((()=>null==o?void 0:o.getIcon()),[o]),v=(0,i.VK)((()=>{if(t)return;const e=null==o?void 0:o.getParentBlockStore();return e&&(0,c.ZP)({store:e,pageVisitSource:s.tY.LinkInPage})}),[o,t]),C=(0,n.Fy)(),b=(0,r.yK)((e=>({linkBox:{display:"flex",alignItems:"center"},linkTitle:{color:e.regularTextColor,fontWeight:l.Z.fontWeight.semibold,fontSize:14,marginLeft:4*(C.isRetina?.5:1),wordBreak:"break-word",...l.Z.textOverflowStyle},chevronTitle:{display:"inline",wordBreak:"break-word",...l.Z.textOverflowStyle}})),[C]),w=(0,h.jsx)(u.Z,{icon:x,isEmptyPage:!1,size:20,disabled:!0});return(0,h.jsx)(p.Z,{title:(0,h.jsx)(a.FormattedMessage,{defaultMessage:"Related to",id:"database.viewSettings.editRelation.targetLink.title"}),showChevron:"chevron"===g,onClick:y,disabled:S,right:t?(0,h.jsx)(a.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettings.editRelation.selfRelationTarget.title"}):"link"===g&&v?(0,h.jsxs)(d.Z,{href:v,innerStyle:b.linkBox,children:[w,(0,h.jsx)(m.Z,{store:o,underline:!0,style:b.linkTitle,maxLength:15})]}):f?(0,h.jsxs)(h.Fragment,{children:[w,(0,h.jsx)(m.Z,{store:o,style:b.chevronTitle})]}):(0,h.jsx)(a.FormattedMessage,{defaultMessage:"No target",id:"database.viewSettings.editRelation.noTarget.title"}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0}})}},40121:(e,t,o)=>{o.d(t,{P:()=>$,Z:()=>G});o(67294);var n=o(83355),i=o(86628),r=o(24405),s=o(49085),l=o(49019),a=o(47453),c=o(72126),p=o(51454),d=o(68939),u=o(8406),m=o(40778),h=o(5149),g=o(14900),S=o(24677),y=o(98104),f=o(53971),x=o(97004),v=o(68641),C=o(13273),b=o(34859),w=o(61766),j=o(77080),_=o(51774),M=o(28398),I=o(58814),P=o(19699),k=o(8298),T=o(22109),F=o(29651),A=o(82990),R=o(33338),Z=o(53437),V=o(85893);class B extends n.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:s.default.createClass({open:!1,stack:[]})},this.renderPopup=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;return(0,V.jsx)(_.P,{context:v.HV.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleClick=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;u.wd({environment:this.environment,collectionContextStore:e,action:"click_sort"}),h.wl({collectionSettingsStore:t,item:{type:"sort"}})},this.handlePopupDismiss=e=>{if(e&&(0,C.yT)(e.target))return;const{collectionSettingsStore:t}=this.stores;h.E3({collectionSettingsStore:t})}}willUnmount(){h.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores;return(0,V.jsx)(Z.ZP,{popupType:e.isMobile?Z.ZP.PopupType.SlideUp:Z.ZP.PopupType.Popup,open:t.state.open,origin:this.renderOrigin(),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderOrigin(){const{collectionContextStore:e}=this.props,t=e.currentSortsStore.state,o=e.localStateDiffStore.state,n=t[0],i=e.permissionScopes.state,r=e.normalizedSchemaStore.state,s=n?r[n.property]:void 0;let l;return l=1===t.length?n&&"descending"===n.direction?(0,k.N)({width:12,marginRight:4,fill:this.theme.blueColor}):(0,F.w)({width:12,marginRight:4,fill:this.theme.blueColor}):(0,T.T)({width:16,marginRight:4,fill:this.theme.blueColor}),(0,V.jsx)(R.Z,{on:!0,hasDiff:Boolean(i.canConfigureBlock&&o.sorts),icon:l,title:(0,V.jsx)("span",{style:{marginTop:-1,maxWidth:220,...A.Z.textOverflowStyle},children:1===t.length&&s?s.name:(0,V.jsx)(d.FormattedMessage,{defaultMessage:"{sortCount} sorts",id:"database.filterBar.sorts.label",values:{sortCount:t.length}})}),onClick:this.handleClick})}}B.displayName="CollectionViewFilterBarSort";const O=(0,d.injectIntl)(B);var D=o(55297),N=o(23063),K=o(37601),L=o(79131),q=o(1743),E=o(74194),U=o(89728),W=o(53336),z=o(58902);let $=function(e){return e[e.FilterBar=0]="FilterBar",e[e.SettingsFilters=1]="SettingsFilters",e}({});class H extends n.Z{constructor(){super(...arguments),this.storeTypes={createFilterSettingsStore:s.default.createClass({open:!1,stack:[]}),saveControlMoreActionsButtonPopupStore:w.Z},this.renderViewSettingsPopup=()=>{const{collectionContextStore:e}=this.props,{createFilterSettingsStore:t}=this.stores;return(0,V.jsx)(_.P,{context:v.HV.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleNewFilterPopupClick=()=>{const{collectionContextStore:e}=this.props,{createFilterSettingsStore:t}=this.stores;u.wd({environment:this.environment,collectionContextStore:e,action:"click_new_filter"}),h.wl({collectionSettingsStore:t,item:{type:"createFilter"}})},this.handlePopupDismiss=e=>{const{createFilterSettingsStore:t}=this.stores;e&&(0,C.yT)(e.target)||h.E3({collectionSettingsStore:t})},this.handleSearchClick=()=>{const{collectionContextStore:e}=this.props;y.ZH(this.environment),S.ZH(this.environment),g.wG(),e.searchOpen.setState(!0),e.searchQuery.setState(""),u.wd({environment:this.environment,collectionContextStore:e,action:"click_mobile_search"})},this.handleSearchQueryChange=e=>{const{collectionContextStore:t}=this.props;t.searchQuery.setState(e.target.value)},this.handleSearchBlur=()=>{const{collectionContextStore:e}=this.props;e.searchQuery.state||this.handleSearchClearButtonClick()},this.handleSearchClearButtonClick=()=>{const{collectionContextStore:e}=this.props;e.searchOpen.setState(!1),e.searchQuery.setState("")},this.handleFiltersDrop=e=>{const{collectionContextStore:t}=this.props;if(!t.collectionViewBlockStore())return;const o=t.currentPropertyFiltersStore.state,n=c.oA(e.map((e=>o.find((t=>t.id===e)))));m.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:n}}}),u.wd({environment:this.environment,collectionContextStore:t,action:"reorder_filters"})},this.handleClick=e=>{const{collectionContextStore:t}=this.props;t.filtersBarOpen.setState(!0)},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,x.Nq)(e)}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.context.environment,{isPhone:o}=t,n=o&&e.searchOpen.state,i=e.currentPropertyFiltersStore.state,r=e.currentSortsStore.state,s=this.localStateHasChangesStore.state,l=this.props.collectionContextStore.shouldShowSource.state?8:12,a=e.filterBarSortSettingsStore.state.open,c=r.length>0||a,d=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0;return(0,V.jsxs)("div",{style:{width:"100%",zIndex:p._Y},onClick:this.handleClick,children:[(0,V.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[n&&this.renderMobileSearchInput(),!n&&(0,V.jsx)("div",{style:{position:"relative",flexGrow:0,overflow:"hidden"},children:(0,V.jsx)(W.Z,{type:b.Z.X,style:{display:"flex",alignItems:"center",paddingTop:l,paddingBottom:t.isPhone?12:8},showLeftRightOverlay:!t.isPhone,children:o?(0,V.jsxs)(V.Fragment,{children:[this.renderMobileSearchButton(),c&&(0,V.jsx)(Q,{collectionContextStore:this.props.collectionContextStore}),c&&!t.isPhone&&(0,V.jsx)(ee,{}),d&&(0,V.jsx)(Y,{collectionContextStore:this.props.collectionContextStore}),this.renderPropertyFilters(i),this.renderAddFilterButton()]}):(0,V.jsxs)(V.Fragment,{children:[c&&(0,V.jsx)(Q,{collectionContextStore:this.props.collectionContextStore}),c&&!t.isPhone&&(0,V.jsx)(ee,{}),d&&(0,V.jsx)(Y,{collectionContextStore:this.props.collectionContextStore}),this.renderPropertyFilters(i),this.renderAddFilterButton()]})})}),(0,V.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingTop:4,marginLeft:"auto"},children:[!o&&s&&this.renderSaveControl(),!o&&(0,V.jsx)(X,{collectionContextStore:this.props.collectionContextStore})]})]}),o&&!n&&(0,V.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:4},children:[s&&this.renderSaveControl(),(0,V.jsx)(X,{collectionContextStore:this.props.collectionContextStore})]})]})}renderSaveControl(){const{collectionContextStore:e,showHoverActionsStore:t}=this.props;return(0,V.jsx)(M.ZP,{context:M.R1.FilterBar,collectionContextStore:e,showHoverActionsStore:t,moreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}renderPropertyFilters(e){const{collectionContextStore:t}=this.props;if(t.permissionScopes.state.canConfigureBlock){const t=e.map((e=>e.id));return(0,V.jsx)(L.ZP,{direction:"horizontal",keys:t,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:t=>{const o=e.find((e=>e.id===t));if(o)return(0,V.jsx)(J,{collectionContextStore:this.props.collectionContextStore,filter:o})},style:{display:"flex",flexShrink:0},onDrop:this.handleFiltersDrop})}return e.map((e=>(0,V.jsx)(J,{filter:e,collectionContextStore:t},e.id)))}renderAddFilterButton(){const{showHoverActionsStore:e}=this.props,t=this.stores.createFilterSettingsStore.state.open,o=e.state||t;return(0,V.jsx)(Z.ZP,{open:t,popupType:this.environment.device.isMobile?Z.kQ.SlideUp:Z.kQ.Popup,origin:(0,V.jsx)(N.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>(0,V.jsx)(U.Z,{icon:a.R,isSmall:!0,isLightGray:!0,hovered:t,onClick:this.handleNewFilterPopupClick,style:{fontSize:14},children:(0,V.jsx)(d.FormattedMessage,{defaultMessage:"Add filter",id:"database.filterBar.addButton.title"})})}),render:this.renderViewSettingsPopup,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,onDismiss:this.handlePopupDismiss})}renderMobileSearchInput(){const{collectionContextStore:e,intl:t}=this.props,o=e.searchQuery.state;return(0,V.jsx)(q.Z,{capture:!0,children:(0,V.jsx)(f.Z,{capture:!0,render:e=>(0,V.jsx)("div",{...e,style:{width:"100%",paddingTop:this.environment.device.isMobile?8:12,paddingBottom:6},children:(0,V.jsx)(R.Z,{wrapStyle:{width:"100%"},innerStyle:{width:"100%"},icon:(0,l.e)({width:14,fill:this.theme.mediumIconColor,marginRight:6}),hideChevron:!0,title:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(E.Z,{format:E.B.Transparent,value:o,placeholder:t.formatMessage({defaultMessage:"Type to search…",id:"database.filterBar.mobileSearch.placeholder"}),onChange:this.handleSearchQueryChange,autoComplete:"on",autoCorrect:"on",onBlur:this.handleSearchBlur,onClearButtonClick:this.handleSearchClearButtonClick,showClearButton:!0,focus:!this.environment.device.isIOS||void 0,focusInitial:!0,inputStyle:{height:"100%"}}),(0,V.jsx)(K.Z,{show:!0})]})})})})})}renderMobileSearchButton(){return(0,V.jsx)(R.Z,{wrapStyle:{display:"flex",alignItems:"center"},icon:(0,l.e)({width:14,fill:this.theme.mediumIconColor,marginRight:6}),hideChevron:!0,title:(0,V.jsx)("span",{style:{marginTop:-1,color:this.theme.mediumTextColor},children:(0,V.jsx)(d.FormattedMessage,{defaultMessage:"Search",id:"database.filterBar.search.title"})}),onClick:this.handleSearchClick},"search")}}H.displayName="CollectionViewFilterBar";const G=(0,d.injectIntl)(H);function Y(e){let{collectionContextStore:t}=e;return(0,V.jsx)(I.Z,{context:$.FilterBar,collectionSettingsStore:t.filterBarCombinatorFilterSettingsState,collectionContextStore:t})}function Q(e){let{collectionContextStore:t}=e;return(0,V.jsx)(O,{collectionContextStore:t,collectionSettingsStore:t.filterBarSortSettingsStore},"sort")}function X(e){var t;let{collectionContextStore:o}=e;window.__c={n:"SprintDetailsOrCompleteSprintButton"};const n=(0,i.VK)((()=>j.default.checkGate("recurring_sprints")),[]),r=(0,i.VK)((()=>o.getCompleteSprintButtonContext.state),[o]),s=(0,i.VK)((()=>{var e;return null==r||null===(e=r.automationContext)||void 0===e?void 0:e.automationStore.getStatus()}),[null==r||null===(t=r.automationContext)||void 0===t?void 0:t.automationStore]);return r?n&&"active"===s?(0,V.jsx)(z.t,{collectionContextStore:o,sprintAutomationContext:r}):(0,V.jsx)(D.v,{collectionContextStore:o,completeSprintAutomationContext:r}):null}function J(e){let{filter:t,collectionContextStore:o}=e;window.__c={n:"PropertyFilterComponent"};const n=(0,i.VK)((()=>o.getFilterBarItemSettingsStore(t)),[o,t]);return(0,V.jsx)(P.Z,{id:t.id,context:$.FilterBar,collectionContextStore:o,collectionSettingsStore:n},t.id)}function ee(){window.__c={n:"DividerComponent"};const e=(0,r.Fg)();return(0,V.jsx)("div",{style:{borderRight:`1px solid ${e.regularDividerColor}`,height:24,marginRight:12,marginLeft:8}})}},58814:(e,t,o)=>{o.d(t,{Z:()=>f});o(67294);var n=o(83355),i=o(49085),r=o(21197),s=o(82990),l=o(68939),a=o(8406),c=o(40778),p=o(5149),d=o(68641),u=o(13273),m=o(51774),h=o(33338),g=o(53437),S=o(85893);class y extends n.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:i.default.createClass({open:!1,stack:[]})},this.renderPopup=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;return(0,S.jsx)(m.P,{context:d.HV.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleClick=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;x(this.props.collectionContextStore)&&(p.wl({collectionSettingsStore:t,item:{type:"filter"}}),a.wd({environment:this.environment,collectionContextStore:e,action:"click_combinator_filter"}))},this.handlePopupDismiss=e=>{var t;if(e&&(0,u.yT)(e.target))return;const{collectionContextStore:o}=this.props,{collectionSettingsStore:n}=this.stores;p.E3({collectionSettingsStore:n});const i=x(this.props.collectionContextStore);i&&0===(null===(t=i.filters)||void 0===t?void 0:t.length)&&c.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.state,combinatorFilter:{value:void 0}}})},this.hasFilterDiff=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.localStateDiffStore.state;return Boolean(t.combinatorFilter)}))}willUnmount(){p.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores;return(0,S.jsx)(g.ZP,{popupType:e.isMobile?g.ZP.PopupType.SlideUp:g.ZP.PopupType.Popup,open:t.state.open,origin:this.renderOrigin(),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderOrigin(){var e;const{environment:t}=this,o=x(this.props.collectionContextStore);if(o)return(0,S.jsx)(h.Z,{icon:(0,r.Q)({width:void 0,height:t.device.isMobile?14:12,fill:this.theme.blueColor,marginRight:6}),title:(0,S.jsx)("span",{style:{maxWidth:180,...s.Z.textOverflowStyle},children:(0,S.jsx)(l.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.filterBar.advancedFilterRulesCount.title",values:{ruleCount:(null===(e=o.filters)||void 0===e?void 0:e.length)||0}})}),on:!0,hasDiff:this.hasFilterDiff.state,onClick:this.handleClick},"combinator")}}y.displayName="CollectionViewFilterBarCombinatorFilter";const f=(0,l.injectIntl)(y);function x(e){return e.currentCombinatorFilterStore.state}},19699:(e,t,o)=>{o.d(t,{Z:()=>$});o(67294);var n=o(83355),i=o(49085),r=o(76205),s=o(39068),l=o(82990),a=o(68939),c=o(8406),p=o(40778),d=o(5149),u=o(40663),m=o(97004),h=o(75079),g=o(13273),S=o(18245),y=o(56416),f=o(40121),x=o(33338),v=o(15070),C=o(99036),b=o(40506),w=o(76725),j=o(72126),_=o(96367),M=o(21202),I=o(77420),P=o(6287),k=o(19889),T=o(97880),F=o(7928),A=o(17335),R=o(29376),Z=o(26136),V=o(76798),B=o(89845),O=o(85893);class D extends n.Z{constructor(){super(...arguments),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,propertyFilter:t,parentStore:o}=this.props,n=e[t.property];if(n&&(0,C.p_)(n))return(0,R.ke)(n,o)}))}renderComponent(){const{valueOnly:e,propertyFilter:t,style:o}=this.props,{filter:n}=t,i=(0,r.a_)(n)?n.subfilter:n,s=(0,r.h6)(i)&&!(0,r.mv)(n),l={...o,maxWidth:void 0};return(0,O.jsx)("span",{style:(0,r.gE)(i)?l:o,children:(0,O.jsx)(a.FormattedMessage,{defaultMessage:"{propertyName}{colonSeparator} {filterOperator} {propertyValue}",id:"database.filterBarFilterValue.title",values:{propertyName:e?void 0:(0,O.jsx)(L,{propertyFilter:this.props.propertyFilter,schema:this.props.schema}),colonSeparator:e||s?void 0:":",filterOperator:(0,O.jsx)(q,{propertyFilter:this.props.propertyFilter}),propertyValue:this.renderValue()}})})}renderValue(){const{propertyFilter:e,schema:t,intl:o,parentStore:n}=this.props,{filter:i}=e,s=(0,r.a_)(i)?i.subfilter:i;if((0,r.vR)(s))if((0,r.Ly)(s)||(0,r.h6)(s)){const e=s.value.value;if(void 0!==e)return(0,O.jsx)("span",{children:e})}else if((0,r.XA)(s)){const e=s.value.value;if(!0===e)return(0,O.jsx)("span",{children:(0,O.jsx)(a.FormattedMessage,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"})});if(!1===e)return(0,O.jsx)("span",{children:(0,O.jsx)(a.FormattedMessage,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"})})}else{if((0,r.dx)(s)||(0,r.NU)(s)){const e=(0,r.dx)(s)?(0,r.mg)(s):(0,r.qC)(s),t=j.oA(e.map((e=>{let{value:t}=e;return t})));if(0===t.length)return;return(0,O.jsx)("span",{children:(0,w.Z)(t,(e=>(0,O.jsx)(E,{index:e})))})}if((0,r.r2)(s)){const e=(0,r.wB)(s),t=j.oA(e.map((e=>{let{value:t}=e;return t})));if(0===t.length)return;return(0,O.jsx)("span",{children:(0,w.Z)(t,(e=>(0,O.jsx)(E,{index:e})))})}if((0,r.e)(s)){const e=(0,r.YO)(s),t=j.oA(e.map(((e,t)=>{if(!e.value)return;const o=e.type;if("exact"===o){const t=Z.G.createChildStore(n,{table:M.iU,id:e.value});return(0,O.jsx)(V.Z,{style:{display:"inline"},store:t},e.value)}if("relative"===o){var i;const o=this.getRelatedCollectionAppConfigUri.state;if(!o)return;return(0,O.jsx)("span",{children:(0,O.jsx)(a.FormattedMessage,{...null===(i=_.qB[o])||void 0===i||null===(i=i[e.value.variable])||void 0===i?void 0:i.messageDescriptor})},t)}(0,T.t1)(o)})));return(0,w.Z)(t,(e=>(0,O.jsx)(E,{index:e})))}if((0,r.Gb)(s)){const e=(0,r.R8)(s),t=j.oA(e.map(((e,t)=>{if("relative"===e.type)return(0,O.jsx)("span",{children:(0,O.jsx)(a.FormattedMessage,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"})},t);if(e.value){const i=e.value;if(i.table===k.KJ){const e=Z.t1.createChildStore(n,{table:i.table,id:i.id});return(0,O.jsx)("span",{children:(0,F.Nz)(o,e.getModel())},t)}if(i.table===I.cZ){const e=Z.t1.createChildStore(n,{table:i.table,id:i.id});return(0,O.jsx)("span",{children:(0,v.Mh)(e.getModel())},t)}}})));return(0,w.Z)(t,(e=>(0,O.jsx)(E,{index:e})))}if((0,r.Mp)(s)){const e=(0,r.u0)(s),t=j.oA(e.map((e=>{if(e.value){const t=e.value,o=Z.t1.createChildStore(n,{table:P.v,id:t});return(0,O.jsx)(V.Z,{style:{display:"inline"},store:o},t)}})));return(0,w.Z)(t,(e=>(0,O.jsx)(E,{index:e})))}if((0,r.gE)(s)){const o=t[e.property],n=(o&&"date"===o.type?o.date_format:void 0)||b.sF;let i;if("exact"===s.value.type){const e=s.value;if(e.value)if((0,b.J_)(e.value))i=e.value;else if((0,b.gR)(e.value)){const t=(0,b.Gc)(e.value);t&&(i=t.value)}}else if(!(0,r.TQ)(s))return(0,A.x)(s.value);if(i)return(0,O.jsx)(B.Z,{style:{display:"inline"},value:i,dateFormat:n,shortenDateAndRange:!0})}else{if((0,r.Jw)(s)){const e=(0,r.fl)(s).filter((e=>{let{value:t}=e;return Boolean(t)})).map(A.cq);if(0===e.length)return;return(0,O.jsx)("span",{children:(0,w.Z)(e,(e=>(0,O.jsx)(E,{index:e})))})}(0,T.t1)(s)}}}}D.displayName="CollectionViewFilterValue";const N=(0,a.injectIntl)(D);function K(){return(0,O.jsx)(a.FormattedMessage,{defaultMessage:"Not",id:"database.filterBarFilterValue.notOperator"})}function L(e){let{propertyFilter:t,schema:o}=e;const n=o[t.property];return n?(0,O.jsx)("span",{style:{fontWeight:l.Z.fontWeight.medium},children:n.name}):null}function q(e){let{propertyFilter:t}=e;const{filter:o}=t,n=(0,r.a_)(o)?o.subfilter:o;if((0,r.Ly)(n))return"string_contains"===n.operator||"string_is"===n.operator?null:"string_does_not_contain"===n.operator||"string_is_not"===n.operator?(0,O.jsx)(K,{}):(0,O.jsx)(O.Fragment,{children:(0,A.WC)(n.operator)});if((0,r.h6)(n))return(0,O.jsx)(O.Fragment,{children:(0,A.WC)(n.operator)});if((0,r.XA)(n)){if("checkbox_is_not"===n.operator)return(0,O.jsx)(K,{})}else{if((0,r.dx)(n))return"enum_is"===n.operator?null:"enum_is_not"===n.operator?(0,O.jsx)(K,{}):(0,O.jsx)(O.Fragment,{children:(0,A.WC)(n.operator)});if((0,r.NU)(n))return"enum_contains"===n.operator?null:"enum_does_not_contain"===n.operator?(0,O.jsx)(K,{}):(0,O.jsx)(O.Fragment,{children:(0,A.WC)(n.operator)});if((0,r.r2)(n))return"status_is"===n.operator?null:"status_is_not"===n.operator?(0,O.jsx)(K,{}):(0,O.jsx)(O.Fragment,{children:(0,A.WC)(n.operator)});if((0,r.e)(n))return"relation_contains"===n.operator?null:"relation_does_not_contain"===n.operator?(0,O.jsx)(K,{}):(0,O.jsx)(O.Fragment,{children:(0,A.WC)(n.operator)});if((0,r.Gb)(n))return"person_contains"===n.operator?null:"person_does_not_contain"===n.operator?(0,O.jsx)(K,{}):(0,O.jsx)(O.Fragment,{children:(0,A.WC)(n.operator)});if((0,r.Mp)(n)){if("location_is"===n.operator)return null;if("location_is_not"===n.operator)return(0,O.jsx)(K,{})}else if((0,r.gE)(n)){if("date_is"===n.operator)return null;if("date_is_after"===n.operator)return(0,O.jsx)(a.FormattedMessage,{defaultMessage:"After",id:"database.filterValue.dateType.dateIsAfter.title"});if("date_is_before"===n.operator)return(0,O.jsx)(a.FormattedMessage,{defaultMessage:"Before",id:"database.filterValue.dateType.dateIsBefore.title"});if("date_is_on_or_after"===n.operator)return(0,O.jsx)(a.FormattedMessage,{defaultMessage:"On or after",id:"database.filterValue.dateType.dateIsOnOrAfter.title"});if("date_is_on_or_before"===n.operator)return(0,O.jsx)(a.FormattedMessage,{defaultMessage:"On or before",id:"database.filterValue.dateType.dateIsOnOrBefore.title"});if(!(0,r.TQ)(n))return(0,O.jsx)(O.Fragment,{children:(0,A.WC)(n.operator)});{const e=n.value;if(!e.value||"exact"!==e.type||!(0,b.gR)(e.value))return(0,O.jsx)(O.Fragment,{children:(0,A.ip)(e)});if(e.value.start_date&&e.value.end_date)return null;if(e.value.start_date)return(0,O.jsx)(a.FormattedMessage,{defaultMessage:"Starting",id:"database.filterValue.dateType.starting.title"});if(e.value.end_date)return(0,O.jsx)(a.FormattedMessage,{defaultMessage:"Ending",id:"database.filterValue.dateType.ending.title"})}}else{if((0,r.Jw)(n))return"verification_is"===n.operator?null:"verification_is_not"===n.operator?(0,O.jsx)(K,{}):(0,O.jsx)(O.Fragment,{children:(0,A.WC)(n.operator)});(0,T.t1)(n)}}return null}function E(e){let{index:t}=e;return(0,O.jsx)("span",{style:{whiteSpace:"pre"},children:(0,O.jsx)(a.FormattedMessage,{defaultMessage:", ",id:"database.filterValue.commaSeparator"})},t)}var U=o(53437),W=o(26388);class z extends n.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:i.default.createClass({open:!1,stack:[]})},this.renderPopup=()=>{var e;const{collectionContextStore:t}=this.props,o=G(this.props.id,this.props.collectionContextStore);if(!o)return;const n=o.filter,i=t.normalizedSchemaStore.state,r=t.collectionViewStore(),s=t.permissionScopes.state;if(!r)return;const l=null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[o.filter.property])||void 0===e?void 0:e.type;return(0,O.jsx)(y.ZP,{collectionViewId:r.id,propertyFilter:n,schema:i,parentStore:r,onChange:e=>this.handleValueChange(e,l),onClose:this.handleFilterValueMenuClose,onDelete:this.handleDeleteFilter,onAddToCombinatorFilter:this.handleAddToCombinatorFilter,context:y.Qv.PropertyFilter,allowAddingToCombinatorFilter:s.canConfigureBlock,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0,collectionContextStore:t})},this.handleClick=()=>{var e;const{collectionContextStore:t}=this.props,{collectionSettingsStore:o}=this.stores,n=G(this.props.id,this.props.collectionContextStore);n&&(d.wl({collectionSettingsStore:o,item:{type:"filter"}}),c.wd({environment:this.environment,collectionContextStore:t,action:"click_property_filter",original_view_type:void 0,property_type:null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[n.filter.property])||void 0===e?void 0:e.type}))},this.handleValueChange=(e,t)=>{var o;const{collectionContextStore:n}=this.props,i=G(this.props.id,this.props.collectionContextStore);if(!i)return;const r=null===(o=n.remoteResult.state)||void 0===o?void 0:o.sizeHint,s=S.default.mark("collections.update_filter_lag");S.default.measureAfterNextFlush(s,{environment:this.environment,getData:()=>h.Y5({from:"property_filter",property_type:t,collectionContextStore:n,sizeHintAtStart:r})});const l=i.filter,a=n.currentPropertyFiltersStore.state.map((t=>{if(t.id===i.id){return{...i,filter:{...l,filter:e}}}return t}));p.iU({environment:this.environment,collectionContextStore:n,temporaryState:{...n.temporaryState.state,propertyFilters:{value:a}}}),c.wd({environment:this.environment,collectionContextStore:n,action:"update_property_filter",original_view_type:void 0,property_type:t})},this.handlePopupDismiss=e=>{if(e&&(0,g.yT)(e.target))return;const{collectionSettingsStore:t}=this.stores;d.E3({collectionSettingsStore:t})},this.handleFilterValueMenuClose=()=>{const{collectionSettingsStore:e}=this.stores;d.E3({collectionSettingsStore:e})},this.handleDeleteFilter=()=>{var e;const{collectionContextStore:t}=this.props,o=G(this.props.id,this.props.collectionContextStore);if(!o)return;const n=t.currentPropertyFiltersStore.state.filter((e=>e.id!==o.id));p.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:n}}}),c.wd({environment:this.environment,collectionContextStore:t,action:"delete_property_filter",original_view_type:void 0,property_type:null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[o.filter.property])||void 0===e?void 0:e.type})},this.handleAddToCombinatorFilter=()=>{var e;const{collectionContextStore:t,context:o}=this.props,n=G(this.props.id,this.props.collectionContextStore);if(!n)return;const{combinatorFilter:i,propertyFilters:r}=(0,m.Gz)(t,n);p.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:r},combinatorFilter:{value:i}}});const s=o===f.P.FilterBar?t.filterBarCombinatorFilterSettingsState:t.filterOptionsCombinatorFilterSettingsState;d.wl({collectionSettingsStore:s,item:{type:"filter"}}),c.wd({environment:this.environment,collectionContextStore:t,action:"merge_filter_into_combinator",property_type:null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[n.filter.property])||void 0===e?void 0:e.type})},this.hasFilterDiff=this.createComputedStore((()=>{const{id:e,collectionContextStore:t}=this.props,o=t.localStateDiffStore.state;return o.filters.updated.includes(e)||o.filters.added.includes(e)}))}willUnmount(){d.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores,o=G(this.props.id,this.props.collectionContextStore),n=Boolean(o&&(0,u.EE)(o.id));return(0,O.jsx)(U.ZP,{popupType:e.isMobile?U.ZP.PopupType.SlideUp:U.ZP.PopupType.Popup,open:t.state.open,origin:n?this.renderReadOnlyOrigin():this.renderOrigin(void 0,!1),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderReadOnlyOrigin(){return(0,O.jsx)(W.Z,{placement:W.Z.Placement.Bottom,render:e=>this.renderOrigin(e,!0),renderTooltip:()=>(0,O.jsx)(a.FormattedMessage,{id:"database.filterBarPropertyFilter.cannotConfigure",defaultMessage:"This filter cannot be modified on this view."})})}renderOrigin(e,t){const{collectionContextStore:o}=this.props,{device:n}=this.environment,i=G(this.props.id,this.props.collectionContextStore),l=o.normalizedSchemaStore.state,a=o.collectionViewStore();if(!a||!i)return;const c=i.filter,p=!(0,r.Oo)(c),d=l[c.property],{theme:u}=this;return(0,O.jsx)(x.Z,{icon:d&&(0,O.jsx)(s.ZP,{type:d.type,icon:d.icon,size:n.isMobile?18:16,theme:u,style:{fill:p?u.blueColor:u.mediumIconColor,marginRight:6}}),title:p?(0,O.jsx)(N,{propertyFilter:c,schema:l,style:H(),parentStore:a}):(0,O.jsx)("span",{style:H(),children:null==d?void 0:d.name}),on:p,hasDiff:this.hasFilterDiff.state,onClick:this.handleClick,disabled:t,hideChevron:t,...e},i.id)}}z.displayName="CollectionViewFilterBarPropertyFilter";const $=(0,a.injectIntl)(z);function H(){return{maxWidth:180,...l.Z.textOverflowStyle}}function G(e,t){return t.currentPropertyFiltersStore.state.find((t=>t.id===e))}},33338:(e,t,o)=>{o.d(t,{Z:()=>a});o(67294);var n=o(480),i=o(24405),r=o(42853),s=o(64921),l=o(85893);function a(e){window.__c={n:"CollectionViewFilterPill"};const{icon:t,title:o,on:a,hasDiff:p,wrapStyle:d,innerStyle:u,hideChevron:m}=e,h=(0,i.Fg)(),g=(0,n.O7)();return(0,l.jsxs)("div",{style:{borderRadius:14,marginRight:6,display:"inline-flex",...p&&{position:"relative"},...d},children:[(0,l.jsxs)(s.Z,{disabled:e.disabled,style:c(Boolean(a),h,u,g.device.isMobile),hoveredStyle:a?{background:h.outlineBlueButtonHoveredBackground}:void 0,pressedStyle:a?{background:h.outlineBlueButtonPressedBackground}:void 0,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,onDoubleClick:e.onDoubleClick,children:[t,o,!m&&(0,r.i)({width:10,marginLeft:4,marginTop:1,fill:a?h.blueColor:h.lightIconColor})]}),p&&(0,l.jsx)("div",{style:{position:"absolute",top:-2,right:-2,background:"dark"===h.mode?h.accentColors.orange[500]:h.accentColors.orange[300],border:`1px solid ${h.contentBackground}`,width:9,height:9,borderRadius:9}})]})}function c(e,t,o,n){return{fontSize:14,display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderRadius:32,height:n?28:24,lineHeight:n?"28px":"24px",padding:"0 8px",border:`1px solid ${t.outlineButtonBorder}`,color:t.mediumTextColor,...e&&{color:t.blueColor,border:`1px solid ${t.filterPillBorder}`,background:t.filterPillBackground},...o}}},55297:(e,t,o)=>{o.d(t,{v:()=>Qe});var n=o(67294),i=o(480),r=o(86628),s=o(24405),l=o(82990),a=o(68939),c=o(50906),p=o(27370),d=o(75079),u=o(64856),m=o(80444),h=o(65089),g=(o(21703),o(63123)),S=o(49085),y=o(15145),f=o(92996),x=o(99036),v=o(2607),C=o(78106),b=o(4615),w=o(96367),j=o(6287),_=o(70203),M=o(97880);const I=(0,a.defineMessages)({nextSprintName:{id:"structuredAutomations.createNextSprint.nextSprintName",defaultMessage:"Sprint"}});function P(e){const{createNextSprintActionId:t,sprintCollectionPointer:o,sprintStatusNextOptionName:n,intl:i,spaceId:r,getCurrentSprintActionId:s,sprintStatusPropertyId:l,sprintUniqueIdPropertyId:a}=e;return{id:t,type:"create_page",config:{values:{title:{value:{type:"formula",value:O({actionId:s,sprintCollectionPointer:o,sprintUniqueIdPropertyId:a,incrementBy:1,intl:i})},action:"replace"},[l]:{value:{type:"simple",value:[[`"${n}"`]]},action:"replace"}},properties:["title",l],collection:o},space_id:r}}function k(e){const{getCurrentSprintActionId:t,sprintCollectionPointer:o,sprintCollectionSchema:n,spaceId:i}=e;return{id:t,type:"query_collection",config:{filter:w.qB[f.p$].current.reducer.getCombinatorFilter(n),collection:o},space_id:i}}function T(e){const{getLargestUniqueIdSprintActionId:t,sprintCollectionPointer:o,sprintUniqueIdPropertyId:n,spaceId:i}=e;return{id:t,type:"query_collection",config:{filter:void 0,collection:o,sort:[{property:n,direction:"descending"}],limit:1},space_id:i}}function F(e){const{createFutureSprintActionId:t,sprintCollectionPointer:o,sprintStatusFutureOptionName:n,intl:i,spaceId:r,getLargestUniqueIdSprintActionId:s,sprintStatusPropertyId:l,sprintUniqueIdPropertyId:a,incrementBy:c}=e;return{id:t,type:"create_page",config:{values:{title:{value:{type:"formula",value:O({actionId:s,sprintCollectionPointer:o,sprintUniqueIdPropertyId:a,intl:i,incrementBy:c})},action:"replace"},[l]:{value:{type:"simple",value:[[`"${n}"`]]},action:"replace"}},properties:["title",l],collection:o},space_id:r}}function A(e){const{updateFutureSprintToNextActionId:t,sprintCollectionPointer:o,sprintStatusNextOptionName:n,sprintStatusFutureOptionName:i,spaceId:r,sprintStatusPropertyId:s,sprintUniqueIdPropertyId:l}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:o,filter:{operator:"and",filters:[{property:s,filter:{operator:"status_is",value:{type:"is_option",value:i}}}]},sort:[{property:l,direction:"ascending"}],limit:1},values:{[s]:{value:{type:"simple",value:[[`"${n}"`]]},action:"replace"}},properties:[s]},space_id:r}}function R(e){const{moveIncompleteTasksActionId:t,createNextSprintActionId:o,taskCollectionPointer:n,taskStatusCompleteGroupName:i,spaceId:r,nextSprintInput:s,taskStatusPropertyId:l,taskSprintRelationPropertyId:a}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:n,filter:{operator:"and",filters:[{property:l,filter:{operator:"status_is_not",value:{type:"is_group",value:i}}},{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:"current"}}},property:a}]}},properties:[a],values:{[a]:{value:{type:"simple",value:"pointer"===s.type?v.b.mentionPage(s.pointer).build():v.b.mentionFormulaContextVariable({id:(0,C.Kd)({source:"action",action_id:o,action_output_type:"page"})}).build()},action:"replace"}}},space_id:r}}function Z(e){const{moveIncompleteTasksToBacklogActionId:t,taskCollectionPointer:o,taskStatusCompleteGroupName:n,spaceId:i,taskStatusPropertyId:r,taskSprintRelationPropertyId:s}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:o,filter:{operator:"and",filters:[{property:r,filter:{operator:"status_is_not",value:{type:"is_group",value:n}}},{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:"current"}}},property:s}]}},properties:[s],values:{[s]:{value:void 0,action:"remove"}}},space_id:i}}function V(e){const{updateCurrentSprintToPastActionId:t,getCurrentSprintActionId:o,sprintStatusPastOptionName:n,spaceId:i,sprintStatusPropertyId:r}=e;return{id:t,type:"update_pages",config:{target:{id:(0,C.Kd)({source:"action",action_id:o,action_output_type:"pages"}),type:"variable"},values:{[r]:{value:{type:"simple",value:[[`"${n}"`]]},action:"replace"}},properties:[r]},space_id:i}}function B(e){const{updateNextSprintToCurrentActionId:t,createNextSprintActionId:o,sprintStatusCurrentOptionName:n,spaceId:i,nextSprintInput:r,nextSprintDateRange:s,sprintStatusPropertyId:l,sprintDatePropertyId:a}=e;return{id:t,type:"update_pages",config:{target:"pointer"===r.type?{type:"page",page:r.pointer}:{id:(0,C.Kd)({source:"action",action_id:o,action_output_type:"page"}),type:"variable"},values:{[l]:{value:{type:"simple",value:[[`"${n}"`]]},action:"replace"},[a]:{value:{type:"simple",value:[(0,_.YCD)(["d",s])]},action:"replace"}},properties:[l,a]},space_id:i}}function O(e){const{actionId:t,sprintCollectionPointer:o,sprintUniqueIdPropertyId:n,incrementBy:i,intl:r}=e;return v.b.concat([v.b.text(`"${r.formatMessage(I.nextSprintName)}" + " " + format(`),v.b.mentionFormulaContextVariable({id:(0,C.Kd)({source:"action",action_id:t,action_output_type:"pages"})}),v.b.text(".first()."),v.b.mentionFormulaPagePropertyVariable({collection:o,property:n}),v.b.text('.split("-").at(-1).toNumber()'),v.b.text(`+${i})`)]).build()}var D=o(8848),N=o(84619),K=o(40506),L=o(7057),q=o(36591),E=o(42853),U=o(47453),W=o(606),z=o(149),$=o(21202),H=o(63143),G=o(75018),Y=o(2553),Q=o(87279),X=o(37034),J=o(29376),ee=o(58484),te=o(77080),oe=o(26136),ne=o(97039),ie=o(78030),re=o(42922),se=o(52275),le=o(31945),ae=o(36596),ce=o(78140),pe=o(32163),de=o(40721),ue=o(89728),me=o(31278),he=o(76798),ge=o(72495),Se=o(83264),ye=o(50506),fe=o(53437),xe=o(85893);function ve(e){window.__c={n:"DefaultPopupOrModalFunctional"};const{isOpen:t,onDismiss:o,render:n,origin:r,style:s,innerStyle:l,ariaLabel:a,ariaLabelledBy:c}=e,{isMobile:p}=(0,i.Fy)();return p?(0,xe.jsx)(fe.ZP,{ariaLabel:a,ariaLabelledBy:c,open:t,popupType:fe.ZP.PopupType.SlideUp,origin:r,onDismiss:o,render:n,style:s}):(0,xe.jsx)(ye.Z,{ariaLabel:a,ariaLabelledBy:c,open:t,preventHideChildrenWhileOpening:!0,render:n,onDismiss:o,style:s,innerStyle:l})}var Ce=o(85567);const be=(0,a.defineMessages)({completedPercentSummary:{id:"completeAutomationSprintModal.sprintSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} total tasks"},selectNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectNextSprintLabel",defaultMessage:"Next sprint"},selectDatesForNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectDatesForNextSprintLabel",defaultMessage:"Start and end dates"},nextSprintDatesLabel:{id:"completeAutomationSprintModal.sprintSummary.nextSprintDatesLabel",defaultMessage:"Next sprint dates"},cancelButton:{id:"completeAutomationSprintModal.sprintSummary.cancel",defaultMessage:"Cancel"},fallbackSprintName:{id:"completeAutomationSprintModal.sprintName.placeholder",defaultMessage:"Sprint"}});function we(e){let{onDismiss:t,...o}=e;window.__c={n:"CompleteSprintAutomationModal"};const{isOpen:r}=o,s=(0,i.O7)(),l=(0,n.useId)(),a=e=>{t();let n=!1;(0,M.Kn)(e)&&(0,M.$K)(e.clickedCancel)&&(n=!0===e.clickedCancel),c.$Xl(s,{...(0,d.Pn)(o.taskCollectionContextStore),action:n?"cancel_modal":"dismiss_modal"})};return(0,xe.jsx)(ve,{ariaLabelledBy:l,isOpen:r,onDismiss:()=>a(),render:()=>(0,xe.jsx)(je,{...o,onDismiss:a,titleAriaId:l})})}function je(e){window.__c={n:"SprintSummaryModal"};const{completeSprintAutomationContext:t,setIsLoading:o,taskCollectionContextStore:s,onDismiss:l,completeSprintAutomationState:p,onAutomationComplete:u,titleAriaId:m}=e,{currentSprintId:h,querySprintsResult:y,currentSprintTaskSummary:v}=p,C=(0,a.useIntl)(),w=(0,i.O7)(),{isMobile:_}=(0,i.Fy)(),I=(0,r.VK)((()=>te.default.checkGate("recurring_sprints")),[]),O=(0,r.VK)((()=>t.sprintCollectionStore),[t]),D=(0,r.VK)((()=>O.getSpaceId()),[O]),N=(0,r.VK)((()=>{if(h)return oe.G.createChildStore(O,{id:h,table:$.iU,spaceId:O.getSpaceId()})}),[h,O]),L=(0,r.VK)((()=>N?(0,X.vU)({intl:C,environment:w,store:N,untitledFallback:be.fallbackSprintName}):C.formatMessage(be.fallbackSprintName)),[N,C,w]),q=(0,r.VK)((()=>Te({sprintDateRange:ke({sprintBlockStore:N,sprintCollectionStore:O}),intl:C})),[N,O,C]),[E,U]=n.useState(),W=(0,r.VK)((()=>S.default.createValue("complete_sprint_and_move_incomplete_tasks_to_next_sprint")),[]),G=(0,r.VK)((()=>{if("pointer"!==(null==E?void 0:E.type))return;return ke({sprintBlockStore:oe.G.createChildStore(O,E.pointer),sprintCollectionStore:O})}),[E,O]),[Q,J]=n.useState(void 0),ee=n.useMemo((()=>{if(Q&&(0,K.h)(Q))return Q}),[Q]),ne=n.useMemo((()=>{if(!y)return;const{nextSprintIds:e,futureSprintIds:t}=y;return e.length>0?e:t}),[y]),ie=(0,r.VK)((()=>{if(void 0===ne)return;const e=ne[0];return e?{type:"pointer",pointer:{id:e,table:$.iU,spaceId:D}}:{type:"actionId"}}),[ne,D]);n.useEffect((()=>{ie&&U(ie)}),[ie,U]),n.useEffect((()=>{J(G)}),[G,J]);const se=n.useCallback((async()=>{if(l(),!E||!ee)return;o(!0);const e=0===(null==v?void 0:v.incompleteTaskCount)?"complete_sprint":W.state,n=function(e){var t,o,n,i,r,s,l;const{sprintCollectionValue:a,nextSprintInput:c,intl:p,nextSprintDateRange:d}=e,u=a.space_id,m={id:a.id,table:j.v,spaceId:u},h=(0,b.ZP)(),g=(0,b.ZP)(),S=(0,b.ZP)(),y=(0,b.ZP)(),v=(0,b.ZP)(),C=(0,b.ZP)(),w=(0,b.ZP)(),_=(0,x.oC)(a),I=null===(t=a.format)||void 0===t||null===(t=t.app_uri_map)||void 0===t?void 0:t[f.b0.StatusV2];if(!I)return{error:{message:`${f.b0.StatusV2} not found.`}};const O=null===(o=a.format)||void 0===o||null===(o=o.app_uri_map)||void 0===o?void 0:o[f.b0.UniqueId];if(!O)return{error:{message:`${f.b0.UniqueId} not found.`}};const D=null===(n=a.format)||void 0===n||null===(n=n.app_uri_map)||void 0===n?void 0:n[f.b0.Dates];if(!D)return{error:{message:`${f.b0.Dates} not found.`}};const N=_[I];if(!N||"status"!==N.type)return{error:{message:`${f.b0.StatusV2} not found.`}};const K=null===(i=N.options)||void 0===i||null===(i=i.find((e=>e.id===f.J1)))||void 0===i?void 0:i.value,L=null===(r=N.options)||void 0===r||null===(r=r.find((e=>e.id===f.SF)))||void 0===r?void 0:r.value,q=null===(s=N.options)||void 0===s||null===(s=s.find((e=>e.id===f.YE)))||void 0===s?void 0:s.value,E=null===(l=N.options)||void 0===l||null===(l=l.find((e=>e.id===f.eH)))||void 0===l?void 0:l.value;if(!(K&&L&&q&&E))return{error:{message:`Could not find required options for ${f.b0.StatusV2}.`}};const U="pointer"===c.type?1:2;if("complete_sprint"===e.type)return{value:[T({getLargestUniqueIdSprintActionId:C,sprintCollectionPointer:m,sprintUniqueIdPropertyId:O,spaceId:u}),k({getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintCollectionSchema:_,spaceId:u}),..."pointer"===c.type?[]:[P({createNextSprintActionId:w,getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintStatusNextOptionName:q,intl:p,spaceId:u,sprintStatusPropertyId:I,sprintUniqueIdPropertyId:O})],V({updateCurrentSprintToPastActionId:g,getCurrentSprintActionId:h,sprintStatusPastOptionName:K,sprintStatusPropertyId:I,spaceId:u}),B({updateNextSprintToCurrentActionId:S,createNextSprintActionId:w,nextSprintInput:c,sprintStatusCurrentOptionName:L,sprintStatusPropertyId:I,spaceId:u,nextSprintDateRange:d,sprintDatePropertyId:D}),F({createFutureSprintActionId:v,sprintCollectionPointer:m,sprintStatusFutureOptionName:E,getLargestUniqueIdSprintActionId:C,intl:p,spaceId:u,sprintStatusPropertyId:I,sprintUniqueIdPropertyId:O,incrementBy:U}),A({updateFutureSprintToNextActionId:y,sprintCollectionPointer:m,sprintStatusNextOptionName:q,sprintStatusFutureOptionName:E,spaceId:u,sprintStatusPropertyId:I,sprintUniqueIdPropertyId:O})]};if("complete_sprint_and_move_incomplete_tasks_to_next_sprint"===e.type){var W,z,$;const{taskCollectionValue:t}=e,o={id:t.id,table:j.v,spaceId:t.space_id},n=(0,b.ZP)(),i=null===(W=t.format)||void 0===W||null===(W=W.app_uri_map)||void 0===W?void 0:W[f.Es.Status];if(!i)return{error:{message:`${f.Es.Status} not found.`}};const r=null===(z=t.format)||void 0===z||null===(z=z.app_uri_map)||void 0===z?void 0:z[f.Es.TaskToSprintRelation];if(!r)return{error:{message:`${f.Es.TaskToSprintRelation} not found.`}};const s=(0,x.oC)(t)[i];if(!s||"status"!==s.type)return{error:{message:`${f.Es.Status} not found.`}};const l=null===($=s.groups)||void 0===$||null===($=$.find((e=>e.id===f.uS)))||void 0===$?void 0:$.name;return l?{value:[T({getLargestUniqueIdSprintActionId:C,sprintCollectionPointer:m,sprintUniqueIdPropertyId:O,spaceId:u}),k({getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintCollectionSchema:_,spaceId:u}),..."pointer"===c.type?[]:[P({createNextSprintActionId:w,getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintStatusNextOptionName:q,intl:p,spaceId:u,sprintStatusPropertyId:I,sprintUniqueIdPropertyId:O})],R({moveIncompleteTasksActionId:n,createNextSprintActionId:w,nextSprintInput:c,taskCollectionPointer:o,taskStatusCompleteGroupName:l,spaceId:u,taskStatusPropertyId:i,taskSprintRelationPropertyId:r}),V({updateCurrentSprintToPastActionId:g,getCurrentSprintActionId:h,sprintStatusPastOptionName:K,spaceId:u,sprintStatusPropertyId:I}),B({updateNextSprintToCurrentActionId:S,createNextSprintActionId:w,nextSprintInput:c,sprintStatusCurrentOptionName:L,spaceId:u,sprintStatusPropertyId:I,nextSprintDateRange:d,sprintDatePropertyId:D}),F({createFutureSprintActionId:v,sprintCollectionPointer:m,sprintStatusFutureOptionName:E,getLargestUniqueIdSprintActionId:C,intl:p,spaceId:u,sprintStatusPropertyId:I,sprintUniqueIdPropertyId:O,incrementBy:U}),A({updateFutureSprintToNextActionId:y,sprintCollectionPointer:m,sprintStatusNextOptionName:q,sprintStatusFutureOptionName:E,spaceId:u,sprintStatusPropertyId:I,sprintUniqueIdPropertyId:O})]}:{error:{message:`Could not find required group for ${f.Es.Status}.`}}}if("complete_sprint_and_move_incomplete_tasks_to_backlog"===e.type){var H,G,Y;const{taskCollectionValue:t}=e,o={id:t.id,table:j.v,spaceId:t.space_id},n=(0,b.ZP)(),i=null===(H=t.format)||void 0===H||null===(H=H.app_uri_map)||void 0===H?void 0:H[f.Es.Status];if(!i)return{error:{message:`${f.Es.Status} not found.`}};const r=null===(G=t.format)||void 0===G||null===(G=G.app_uri_map)||void 0===G?void 0:G[f.Es.TaskToSprintRelation];if(!r)return{error:{message:`${f.Es.TaskToSprintRelation} not found.`}};const s=(0,x.oC)(t)[i];if(!s||"status"!==s.type)return{error:{message:`${f.Es.Status} not found.`}};const l=null===(Y=s.groups)||void 0===Y||null===(Y=Y.find((e=>e.id===f.uS)))||void 0===Y?void 0:Y.name;return l?{value:[T({getLargestUniqueIdSprintActionId:C,sprintCollectionPointer:m,sprintUniqueIdPropertyId:O,spaceId:u}),k({getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintCollectionSchema:_,spaceId:u}),..."pointer"===c.type?[]:[P({createNextSprintActionId:w,getCurrentSprintActionId:h,sprintCollectionPointer:m,sprintStatusNextOptionName:q,intl:p,spaceId:u,sprintStatusPropertyId:I,sprintUniqueIdPropertyId:O})],Z({moveIncompleteTasksToBacklogActionId:n,taskCollectionPointer:o,taskStatusCompleteGroupName:l,spaceId:u,taskStatusPropertyId:i,taskSprintRelationPropertyId:r}),V({updateCurrentSprintToPastActionId:g,getCurrentSprintActionId:h,sprintStatusPastOptionName:K,spaceId:u,sprintStatusPropertyId:I}),B({updateNextSprintToCurrentActionId:S,createNextSprintActionId:w,nextSprintInput:c,sprintStatusCurrentOptionName:L,spaceId:u,sprintStatusPropertyId:I,nextSprintDateRange:d,sprintDatePropertyId:D}),F({createFutureSprintActionId:v,sprintCollectionPointer:m,sprintStatusFutureOptionName:E,getLargestUniqueIdSprintActionId:C,intl:p,spaceId:u,sprintStatusPropertyId:I,sprintUniqueIdPropertyId:O,incrementBy:U}),A({updateFutureSprintToNextActionId:y,sprintCollectionPointer:m,sprintStatusNextOptionName:q,sprintStatusFutureOptionName:E,spaceId:u,sprintStatusPropertyId:I,sprintUniqueIdPropertyId:O})]}:{error:{message:`Could not find required group for ${f.Es.Status}.`}}}return(0,M.t1)(e.type)}({type:e,sprintCollectionValue:t.sprintCollectionValue,taskCollectionValue:t.taskCollectionValue,nextSprintInput:E,nextSprintDateRange:ee,intl:C});if(c.$Xl(w,{...(0,d.Pn)(s),action:"complete_sprint",currentSprintTaskSummary:p.currentSprintTaskSummary,completeSprintActionType:e,nextSprintDateRange:ee,nextSprintInput:E}),z.x.isFail(n))throw new Error(n.error.message);let i;i=I&&t.automationContext?{type:"recurrence",recurrence:{type:"completeSprint",completeSprintActionType:e,nextSprintDateRange:ee},persisted:!0,automationStore:t.automationContext.automationStore,intl:C,parentRecordStore:t.currentCollectionViewBlockStore}:{type:"structured_automation",persisted:!1,intl:C,parentRecordStore:t.currentCollectionViewBlockStore,actions:n.value,parentPointer:t.currentCollectionViewBlockStore.getSpaceShardedPointer(),shouldBatch:!0};const r=()=>{u()};await Y.oS({environment:w,store:t.currentCollectionViewBlockStore,clientContext:i,onUndo:()=>{o(!0),r(),o(!1)}}),r(),o(!1)}),[l,E,ee,o,null==v?void 0:v.incompleteTaskCount,W,t.sprintCollectionValue,t.taskCollectionValue,t.automationContext,t.currentCollectionViewBlockStore,C,w,s,p.currentSprintTaskSummary,I,u]),le=Ie({isMobile:_}),{status:ae}=(0,g.V)({value:p,validateLoaded:e=>!1===e.isLoading,waitTimeInMs:1*H.hM});if("pending"!==ae&&p.isLoading)return(0,xe.jsx)(_e,{titleAriaId:m,onDismiss:l,sprintCollectionStore:O});if(p.isLoading)return(0,xe.jsx)(Me,{titleAriaId:m,onDismiss:l});const{incompleteTaskCount:ce}=p.currentSprintTaskSummary,pe=Boolean(E)&&Boolean(ee),de=void 0!==ne&&ne.length>0;return(0,xe.jsxs)("div",{style:le.modalContainer,children:[(0,xe.jsx)("div",{style:le.header,id:m,children:(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.title",defaultMessage:"{sprintName} summary",values:{sprintName:L}})}),(0,xe.jsx)(Pe,{currentSprintFormattedDateRange:q,currentSprintTaskSummary:v}),de&&(0,xe.jsxs)("div",{style:le.flexRow,children:[C.formatMessage(be.selectNextSprintLabel),(0,xe.jsx)(Ve,{nextSprintInput:E,setNextSprintInput:U,completeSprintAutomationContext:t,sprintPageIds:ne})]}),(0,xe.jsxs)("div",{style:le.flexRow,children:[de?C.formatMessage(be.selectDatesForNextSprintLabel):C.formatMessage(be.nextSprintDatesLabel),(0,xe.jsx)(Oe,{sprintDateRange:Q,setSprintDateRange:J})]}),ce>0&&(0,xe.jsxs)("div",{style:le.flexRow,children:[(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksLabel",defaultMessage:"{incompleteTaskCount, plural, one {{incompleteTaskCount} incomplete task} other {{incompleteTaskCount} incomplete tasks}}",values:{incompleteTaskCount:ce}}),(0,xe.jsx)(Ae,{actionTypeStore:W})]}),(0,xe.jsx)(re.Z,{disabled:!pe,onClick:()=>{se()},style:le.button,children:(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButton",defaultMessage:"Complete {sprintName}",values:{sprintName:L}})}),(0,xe.jsx)(ue.Z,{onClick:()=>l({clickedCancel:!0}),style:le.button,children:C.formatMessage(be.cancelButton)})]})}function _e(e){window.__c={n:"MissingCurrentSprintError"};const{onDismiss:t,sprintCollectionStore:o,titleAriaId:n}=e,s=(0,i.O7)(),l=(0,a.useIntl)(),{isMobile:c}=(0,i.Fy)(),p=(0,r.VK)((()=>o.getParentBlockStore()),[o]),d=Ie({isMobile:c});return(0,xe.jsxs)("div",{style:d.modalContainer,children:[(0,xe.jsx)("div",{style:d.header,id:n,children:(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.missingCurrentSprint.title",defaultMessage:"No current sprint found"})}),(0,xe.jsx)(re.Z,{onClick:()=>{p&&G.navigateToBlock({environment:s,store:p,pageVisitSource:y.tY.LinkInPage})},style:{...d.button,marginTop:24},children:(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.missingCurrentSprint.navigateToSprintsDatabase",defaultMessage:"Fix in Sprints database"})}),(0,xe.jsx)(ue.Z,{onClick:t,style:d.button,children:l.formatMessage(be.cancelButton)})]})}function Me(e){window.__c={n:"LoadingStatePlaceholder"};const{onDismiss:t,titleAriaId:o}=e,n=(0,a.useIntl)(),{isMobile:r}=(0,i.Fy)(),s=Ie({isMobile:r});return(0,xe.jsxs)("div",{style:s.modalContainer,children:[(0,xe.jsx)("div",{style:s.header,id:o,children:(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.titlePlaceholder",defaultMessage:"Sprint summary"})}),(0,xe.jsx)("div",{style:s.subheader,children:(0,xe.jsx)(ae.Z,{style:s.subheaderShimmer})}),(0,xe.jsxs)("div",{style:s.flexRow,children:[n.formatMessage(be.selectNextSprintLabel),(0,xe.jsx)(ae.Z,{style:s.flexRowShimmerBox1})]}),(0,xe.jsxs)("div",{style:s.flexRow,children:[n.formatMessage(be.selectDatesForNextSprintLabel),(0,xe.jsx)(ae.Z,{style:s.flexRowShimmerBox2})]}),(0,xe.jsxs)("div",{style:s.flexRow,children:[(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksPlaceholder",defaultMessage:"Incomplete tasks"}),(0,xe.jsx)(ae.Z,{style:s.flexRowShimmerBox3})]}),(0,xe.jsx)(re.Z,{disabled:!0,onClick:()=>{},style:s.button,children:(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButtonPlaceholder",defaultMessage:"Complete sprint"})}),(0,xe.jsx)(ue.Z,{onClick:t,style:s.button,children:n.formatMessage(be.cancelButton)})]})}function Ie(e){let{isMobile:t}=e;return(0,s.yK)((e=>{const o={height:44,borderRadius:8,display:"flex",alignItems:"center",width:void 0},n={...o,marginTop:12,marginBottom:18};return{modalContainer:{width:400,display:"flex",fontSize:t?l.Z.fontSize.UIRegular.mobile:l.Z.fontSize.UIRegular.desktop,flexDirection:"column",justifyContent:"center",padding:20},header:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:t?18:16,fontWeight:l.Z.fontWeight.semibold},subheader:{display:"flex",alignItems:"center",justifyContent:"center",color:e.lightTextColor,marginBottom:16,gap:8},separator:{height:2,width:2,borderRadius:2,backgroundColor:e.lightIconColor},flexRow:{display:"flex",...t?{flexDirection:"column",fontSize:14,color:e.mediumTextColor}:{justifyContent:"space-between",alignItems:"center",height:24,marginBottom:16}},completedTaskGroup:{display:"flex",gap:4},button:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:8,...t&&o},subheaderShimmer:{borderRadius:4,marginTop:6,width:200,height:16,...t&&{height:22}},flexRowShimmerBox1:{borderRadius:4,width:60,height:16,...t&&n},flexRowShimmerBox2:{borderRadius:4,width:80,height:16,...t&&n},flexRowShimmerBox3:{borderRadius:4,width:140,height:16,...t&&n},dropdownButton:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:4,...t&&{...n,border:`1px solid ${e.accentColors.gray[50]}`,justifyContent:"space-between"}},dropdownChevronIcon:{color:e.lightIconColor,width:12,height:"auto"}}}),[t])}function Pe(e){window.__c={n:"SprintSummarySubheader"};const{currentSprintFormattedDateRange:t,currentSprintTaskSummary:o}=e,{isMobile:n}=(0,i.Fy)(),r=(0,a.useIntl)(),s=Ie({isMobile:n}),l=o?r.formatMessage(be.completedPercentSummary,{completedTaskCount:o.completedTaskCount,totalTaskCount:o.totalTaskCount}):void 0,c=t&&o?(0,xe.jsxs)(xe.Fragment,{children:[t,(0,xe.jsx)("div",{style:s.separator}),l]}):t||l;return void 0===c?null:(0,xe.jsx)("div",{style:s.subheader,children:c})}function ke(e){const{sprintBlockStore:t,sprintCollectionStore:o}=e;if(!t)return;const n=o.getPropertyMapping(),i=null==n?void 0:n[f.b0.Dates];if(!i)return;const r=t.getPropertyValue(i);if(!r)return;const s=(0,_.nai)(r)[0];return s?(0,K.Ls)(s):void 0}function Te(e){const{sprintDateRange:t,intl:o}=e;if(t&&(0,K.h)(t))return(0,L.ZV)({value:t,allowRelativeDates:!1,shortenDateAndRange:!0,displayInUserTimezone:!0,intl:o})}const Fe={complete_sprint_and_move_incomplete_tasks_to_next_sprint:(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.moveToNextSprintOption",defaultMessage:"Move to next sprint"}),complete_sprint_and_move_incomplete_tasks_to_backlog:(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.moveToBacklogOption",defaultMessage:"Move to backlog"}),complete_sprint:(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.keepInThisSprintOption",defaultMessage:"Keep in current sprint"})};function Ae(e){window.__c={n:"SelectIncompleteTaskAutomationPopupButton"};const{actionTypeStore:t}=e,{isMobile:o}=(0,i.Fy)(),n=(0,r.VK)((()=>t.state),[t]),s=Ie({isMobile:o});return(0,xe.jsx)(le.ZP,{popupType:o?le.Z4.SlideUp:le.Z4.Popup,alignmentToOrigin:le.vR.Start,placementToOrigin:le.pO.Bottom,render:e=>(0,xe.jsx)(Ze,{actionTypeStore:t,buttonPopupParent:e}),renderOrigin:e=>(0,xe.jsxs)(ue.Z,{...e,style:s.dropdownButton,children:[Fe[n],(0,E.i)(s.dropdownChevronIcon)]})})}const Re=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];function Ze(e){window.__c={n:"AutomationActionOptionsMenu"};const{actionTypeStore:t,buttonPopupParent:o}=e,{isMobile:n}=(0,i.Fy)(),l=(0,s.yK)((e=>({checkIcon:{color:e.lightIconColor,width:12,height:"auto",marginLeft:4}})),[]),a=(0,r.VK)((()=>Re.map((e=>{const n=e===t.state;return{key:e,action:()=>{t.setState(e),o.close()},render:t=>(0,xe.jsx)(se.Z,{...t,title:Fe[e],right:n&&(0,q.e)(l.checkIcon)})}}))),[t,l.checkIcon,o]);let c;return c=n?{menuType:Q.og.ActionSheet}:{menuType:Q.og.Popup,maxHeight:"50vh",minWidth:230},(0,xe.jsx)(ce.Z,{...c,children:(0,xe.jsx)(pe.Z,{type:pe.i.Vertical,initialFocus:0,sections:[{key:"sprint_automations",items:a,render:e=>(0,xe.jsx)(ge.Z,{...e})}]})})}function Ve(e){window.__c={n:"SelectSprintPopupButton"};const{nextSprintInput:t,completeSprintAutomationContext:o,setNextSprintInput:n,sprintPageIds:l}=e,{sprintCollectionStore:c}=o,{isMobile:p}=(0,i.Fy)(),d=(0,i.O7)(),u=(0,a.useIntl)(),m=(0,r.VK)((()=>{if(void 0===t)return(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSelect.empty",defaultMessage:"Select sprint"});if("actionId"===t.type)return(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSelect.newSprint",defaultMessage:"New sprint"});if("pointer"===t.type){const e=oe.G.createChildStore(c,t.pointer);return(0,X.vU)({intl:u,environment:d,store:e,untitledFallback:be.fallbackSprintName})}(0,M.t1)(t)}),[t,u,c,d]),h=Ie({isMobile:p}),g=(0,s.yK)((e=>({button:{...void 0===t&&{color:e.lightTextColor}}})),[t]),S={...h.dropdownButton,...g.button};return 0===l.length||1===l.length?(0,xe.jsx)(ue.Z,{style:S,disabled:!0,children:m}):(0,xe.jsx)(le.ZP,{popupType:p?le.Z4.SlideUp:le.Z4.Popup,alignmentToOrigin:le.vR.Start,placementToOrigin:le.pO.Bottom,render:e=>(0,xe.jsx)(Be,{buttonPopupParent:e,completeSprintAutomationContext:o,sprintPageIds:l,nextSprintInput:t,setNextSprintInput:n}),renderOrigin:e=>(0,xe.jsxs)(ue.Z,{...e,style:S,children:[m,(0,E.i)(h.dropdownChevronIcon)]})})}function Be(e){window.__c={n:"SelectSprintDropdown"};const{sprintPageIds:t,completeSprintAutomationContext:o,buttonPopupParent:l,nextSprintInput:c,setNextSprintInput:p}=e,{sprintCollectionStore:d}=o,{isMobile:u}=(0,i.Fy)(),m=(0,r.VK)((()=>d.getSpaceId()),[d]),h=(0,r.VK)((()=>(0,J.U1)({collectionStore:o.taskCollectionStore,property:f.Es.TaskToSprintRelation}).filter((e=>e.visible&&("title"===e.property||o.sprintCollectionSchema[e.property])))),[o]),g=(0,r.VK)((()=>new ee.Z),[]),S=(0,s.yK)((e=>({checkIcon:{color:e.lightIconColor,width:12,height:"auto",marginLeft:4},plusIcon:{color:e.lightIconColor,width:12,height:"auto"},createSprintRow:{display:"flex",gap:4},sprintRow:{display:"flex",maxHeight:22,alignItems:"center"},recordTitle:{...u&&{marginRight:12}}})),[u]),y="purple",x=(0,s.Fg)(),v=(0,D.KR)(x,y),C=n.useMemo((()=>{const e="actionId"===(null==c?void 0:c.type);return{key:"new_sprint",action:()=>{p({type:"actionId"}),l.close()},render:t=>(0,xe.jsx)(se.Z,{...t,icon:(0,U.R)(S.plusIcon),title:(0,xe.jsxs)("div",{style:S.createSprintRow,children:[(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.selectSprintDropdown.createNew",defaultMessage:"New sprint"}),(0,xe.jsx)(Ce.Z,{isRound:!0,showRemoveButton:!1,value:(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.selectSprintDropdown.createNewToken",defaultMessage:"Next"}),format:N.lo.Medium,isSingle:!0,color:v.textColor,backgroundColor:v.backgroundColor,showColoredDot:y})]}),right:e&&(0,q.e)(S.checkIcon)})}}),[c,l,p,S,v]),b=(0,r.VK)((()=>t.map((e=>{const t={id:e,table:$.iU,spaceId:m},o=oe.G.createChildStore(d,t),n=o.getIcon(),i="pointer"===(null==c?void 0:c.type)&&W.dr.isEqual(c.pointer,t);return{key:e,action:()=>{p({type:"pointer",pointer:t}),l.close()},render:e=>(0,xe.jsx)(se.Z,{...e,icon:n&&(0,xe.jsx)(me.Z,{disabled:!0,icon:n,isEmptyPage:!1,size:20}),title:(0,xe.jsx)("div",{style:S.sprintRow,children:h.map((e=>"title"===e.property?(0,xe.jsx)(he.Z,{store:o,style:S.recordTitle},"title"):(0,xe.jsx)(ne.Z,{store:o,property:e.property,disabled:!1,locked:!1,format:ie.C.Relation,tableWrap:!1,blockPropertyValueOverlayStore:g,collectionStore:d},e.property))).filter(M.$K)}),right:i&&(0,q.e)(S.checkIcon)})}}))),[d,g,l,c,h,m,p,S,t]),w=[{key:"sprints",items:n.useMemo((()=>b.length>0?b:[C]),[b,C]),render:e=>(0,xe.jsx)(ge.Z,{...e})}];let j;return j=u?{menuType:Q.og.ActionSheet}:{menuType:Q.og.Popup,maxHeight:"50vh",minWidth:230},(0,xe.jsx)(ce.Z,{...j,children:(0,xe.jsx)(pe.Z,{type:pe.i.Vertical,initialFocus:0,sections:w})})}function Oe(e){window.__c={n:"SelectNextSprintDate"};const{sprintDateRange:t,setSprintDateRange:o}=e,l=(0,a.useIntl)(),{isMobile:c}=(0,i.Fy)(),p=n.useMemo((()=>Te({sprintDateRange:t,intl:l})),[t,l]),d=Ie({isMobile:c}),u=(0,s.yK)((e=>({button:{...!p&&{color:e.lightTextColor}}})),[p]),m=(0,r.VK)((()=>p||(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.nextSprintDate.placeholder",defaultMessage:"Select dates"})),[p]);return(0,xe.jsx)(le.ZP,{popupType:c?le.Z4.SlideUp:le.Z4.Popup,alignmentToOrigin:le.vR.Start,placementToOrigin:le.pO.Bottom,render:e=>(0,xe.jsx)(De,{sprintDateRange:t,setSprintDateRange:o,onDismiss:()=>{e.close()}}),renderOrigin:e=>(0,xe.jsxs)(ue.Z,{...e,style:{...d.dropdownButton,...u.button},children:[m,(0,E.i)(d.dropdownChevronIcon)]})})}function De(e){window.__c={n:"SprintDateRangePicker"};const{sprintDateRange:t,setSprintDateRange:o,onDismiss:r}=e,{isMobile:s}=(0,i.Fy)(),l=n.useMemo((()=>({starting:null!=t&&t.start_date?{type:"date",start_date:t.start_date}:void 0,ending:null!=t&&t.end_date?{type:"date",start_date:t.end_date}:void 0})),[t]);let c;return c=s?{menuType:Q.og.Modal,right:(0,xe.jsx)(de.DoneMenuText,{}),onClickRight:r}:{menuType:Q.og.Popup,maxHeight:"50vh",paddingTop:6},(0,xe.jsxs)(ce.Z,{...c,children:[(0,xe.jsx)(ge.Z,{children:(0,xe.jsx)(Se.Z,{title:void 0,disableMenuWrap:!0,allowRelativeRangeFilter:!0,value:l,onUpdate:e=>{var t,n;if(e.error)return;const i={...l,...e.value},r=null===(t=i.starting)||void 0===t?void 0:t.start_date,s=null===(n=i.ending)||void 0===n?void 0:n.start_date;o({type:"daterange",start_date:r,end_date:s})},onDismiss:r})}),(0,xe.jsx)(ge.Z,{topBorder:!0,children:(0,xe.jsx)(se.Z,{focused:!1,onClick:()=>{o(void 0)},title:(0,xe.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.datePicker.clear",defaultMessage:"Clear"})})})]})}var Ne=o(42875),Ke=o(59054),Le=o(54642),qe=o(65569);class Ee extends S.default{getInitialState(){return{isLoading:!0,currentSprintId:void 0,querySprintsResult:void 0,currentSprintTaskSummary:void 0}}updateCurrentSprint(e){const{querySprintsResult:t,currentSprintTaskSummary:o}=this.state;void 0!==e&&void 0!==t&&void 0!==o?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:t,currentSprintTaskSummary:o}):e?this.setState({...this.state,currentSprintId:e}):this.setState({...this.state,isLoading:!0,currentSprintId:e})}updateNextAndFutureSprints(e){const{currentSprintId:t,currentSprintTaskSummary:o}=this.state;void 0!==t&&void 0!==e&&void 0!==o?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:e,currentSprintTaskSummary:o}):e?this.setState({...this.state,querySprintsResult:e}):this.setState({...this.state,isLoading:!0,querySprintsResult:e})}updateCurrentSprintTaskSummary(e){const{currentSprintId:t,querySprintsResult:o}=this.state;void 0!==t&&void 0!==o&&void 0!==e?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:o,currentSprintTaskSummary:e}):e?this.setState({...this.state,currentSprintTaskSummary:e}):this.setState({...this.state,isLoading:!0,currentSprintTaskSummary:e})}}const Ue=Ee;function We(e){window.__c={n:"CompleteSprintAutomationButtonLoader"};const{taskCollectionContextStore:t,completeSprintAutomationContext:o,children:s,isModalOpen:l}=e,{sprintCollectionStore:a}=o,c=a.id,p=(0,i.O7)(),d=(0,r.VK)((()=>new Ue),[]),u=(0,r.VK)((()=>d.state),[d]),m=(0,r.VK)((()=>{var e;const o=t.relativeVariableStore.state;return null==o||null===(e=o[c])||void 0===e?void 0:e.current}),[c,t]);n.useEffect((()=>{d.updateCurrentSprint(m)}),[m,d]);const[{value:h}]=(0,Ke.r5)((async()=>await async function(e){var t;const{environment:o,completeSprintAutomationContext:n}=e,{sprintCollectionStore:i}=n,r=function(e){var t,o;const{sprintCollectionStore:n,sprintCollectionSchema:i}=e,r=n.getPropertyMapping(),s=null==r?void 0:r[f.b0.StatusV2];if(!s)return;const l=i[s];if(!l||"status"!==l.type)return;const a=null===(t=l.options)||void 0===t||null===(t=t.find((e=>e.id===f.YE)))||void 0===t?void 0:t.value,c=null===(o=l.options)||void 0===o||null===(o=o.find((e=>e.id===f.eH)))||void 0===o?void 0:o.value;if(!a||!c)return;const p=w.qB[f.p$].next.reducer.getCombinatorFilter(i);if(!p)return;const d={type:"results",filter:p,limit:5},u={type:"results",filter:{operator:"and",filters:[{property:s,filter:{operator:"status_is",value:{type:"is_option",value:c}}}]},limit:5};return{[f.YE]:d,[f.eH]:u}}(n),s=i.getPropertyMapping(),l=null==s?void 0:s[f.b0.Dates],a=null==s?void 0:s[f.b0.UniqueId];if(!r||!l||!a)return;const c={type:"reducer",userId:o.currentUser.id,userTimeZone:(0,Ne.r)(),searchQuery:void 0,sort:[{property:l,direction:"ascending"},{property:a,direction:"ascending"}],reducers:r},p=null===(t=i.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores()[0],d=i.getSpaceId();if(!p)return;const u=await Le.queryCollection(o,{source:{type:"collection",id:i.id,spaceId:d},collectionView:{id:p.id,spaceId:d},loader:c},void 0,{src:"complete_sprint_modal_sprint_picker"});if("success"!==u.type)return;const m=u.data.result.reducerResults[f.YE],h=u.data.result.reducerResults[f.eH];if("results"!==m.type||"results"!==h.type)return;const g=m.blockIds,S=h.blockIds;return{nextSprintIds:g,futureSprintIds:S}}({environment:p,completeSprintAutomationContext:o})),[m,p,o]);n.useEffect((()=>{d.updateNextAndFutureSprints(h)}),[h,d]);const[{value:g}]=(0,Ke.r5)((async()=>await async function(e){var t;const{environment:o,completeSprintAutomationContext:n}=e,{taskCollectionStore:i}=n,r=(0,qe.Hy)(i);if(!r)return;const s=(0,qe.kK)(i);if(!s)return;const l={type:"reducer",filter:{operator:"and",filters:[s]},userId:o.currentUser.id,userTimeZone:(0,Ne.r)(),searchQuery:"",sort:[],reducers:{completed_tasks_in_current_sprint:r}},a=null===(t=i.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores()[0],c=i.getSpaceId();if(!a)return;const p=await Le.queryCollection(o,{source:{type:"collection",id:i.id,spaceId:c},collectionView:{id:a.id,spaceId:c},loader:l},void 0,{src:"complete_sprint_modal_sprint_picker"});if("success"!==p.type)return;return(0,qe.yg)(p.data.result.reducerResults.completed_tasks_in_current_sprint)}({environment:p,completeSprintAutomationContext:o})),[m,p,o,l]);return n.useEffect((()=>{d.updateCurrentSprintTaskSummary(g)}),[g,d]),(0,xe.jsx)(xe.Fragment,{children:s({completeSprintAutomationState:u,onAutomationComplete:()=>{d.reset()}})})}var ze=o(56247);function $e(e){const{percentage:t}=e;return(0,xe.jsx)(ze.b,{numberValue:t,numberFormat:void 0,numberShowAs:{type:"ring",maxValue:1,color:"blue",showValue:!1},shouldRenderTooltip:!1,progressSize:15})}var He=o(68785),Ge=o(63296),Ye=o(61764);function Qe(e){window.__c={n:"CompleteSprintAutomationButton"};const{collectionContextStore:t,completeSprintAutomationContext:o}=e,s=(0,i.O7)(),[l,a]=n.useState(!1),[h,g]=n.useState(!1),S=n.useCallback((()=>{g(!1)}),[g]),y=(0,r.VK)((()=>o.permissionsContext.canEdit),[o.permissionsContext.canEdit]),f=(0,r.VK)((()=>m.default.state.currentUserSettingsStore),[]),x=()=>{g(!0);"complete-sprint-button-tooltip"===(0,u.wF)(f,"sprints-onboarding")&&p.tutorialGoToNextStep(s,"sprints-onboarding"),c.$Xl(s,{...(0,d.Pn)(t),action:"open_modal"})};return y?(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(We,{completeSprintAutomationContext:o,taskCollectionContextStore:t,isModalOpen:h,children:e=>{let{completeSprintAutomationState:n,onAutomationComplete:i}=e;return(0,xe.jsx)(we,{completeSprintAutomationContext:o,isOpen:h,onDismiss:S,setIsLoading:a,taskCollectionContextStore:t,completeSprintAutomationState:n,onAutomationComplete:i})}}),(0,xe.jsx)(Ye.g,{taskCollectionContextStore:t,children:e=>(0,xe.jsx)(Xe,{currentSprintTasksInView:e,taskCollectionContextStore:t,onClick:x,isLoading:l})})]}):null}function Xe(e){window.__c={n:"SprintButton"};const{currentSprintTasksInView:t,taskCollectionContextStore:o,onClick:c,isLoading:p}=e,{isPhone:d}=(0,i.Fy)(),u=n.useRef(null),g=function(e){const{isPhone:t}=e;return(0,s.yK)((e=>({icon:{fill:e.accentColors.blue[400]},button:{height:26,marginLeft:8,fontWeight:l.Z.fontWeight.medium,...t&&{flexGrow:1,borderRadius:8,height:44}}})),[t])}({isPhone:d}),S=(0,r.VK)((()=>o.collectionViewBlockStore()),[o]),y=(0,r.VK)((()=>m.default.state.currentSpaceStore),[]);if(!S)return(0,xe.jsx)(xe.Fragment,{});const f=S.getSpaceId()===(null==y?void 0:y.id);return(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(Ge.Z,{ref:u,onClick:c,iconStyle:g.icon,icon:Je({isLoading:p,taskSummary:t}),style:g.button,disabled:p,disabledFeedback:p,children:(0,xe.jsx)(a.FormattedMessage,{defaultMessage:"Complete sprint",id:"completeSprintAutomationButton.label"})}),f&&(0,xe.jsx)(h.Yy,{origin:u})]})}function Je(e){const{isLoading:t,taskSummary:o}=e;if(t)return e=>(0,xe.jsx)("div",{style:e,children:(0,xe.jsx)(He.Z,{})});const n=o?o.completedTaskPercent:0;return e=>(0,xe.jsx)("div",{style:e,children:(0,xe.jsx)($e,{percentage:n})})}},41389:(e,t,o)=>{o.r(t),o.d(t,{default:()=>fe});o(21703);var n=o(67294),i=o(83355),r=o(99036),s=o(8848),l=o(84682),a=o(18955),c=o(91905),p=o(42875),d=o(72126),u=o(82990),m=o(68939),h=o(50906),g=o(62134),S=o(66890),y=o(75079),f=o(87279),x=o(18514),v=o(77907),C=o(34859),b=o(80444),w=o(49085);class j extends w.default{getInitialState(){return{value:"",html:"",query:""}}}const _=j;var M=o(29798),I=o(48019),P=o(78140),k=o(40721),T=o(53336),F=o(72495),A=o(13991),R=o(24405),Z=o(76725),V=o(85893);function B(e){window.__c={n:"FormulaDocumentation"};const{entry:t,Prism:o}=e,{codeStyle:n,headerStyle:i,textStyle:r}=(0,R.yK)((e=>({codeStyle:{paddingTop:6,paddingBottom:8,paddingLeft:10,paddingRight:10,overflowX:"scroll",background:e.sidebarBackground,borderRadius:4,fontSize:13,margin:0,fontFamily:u.Z.getCompositeFontFamily(A.SP).mono,lineHeight:1.4},headerStyle:{fontSize:20,margin:0,lineHeight:1,marginTop:4,marginBottom:12},textStyle:{whiteSpace:"normal",marginTop:8,marginBottom:8,fontSize:13,lineHeight:1.4}})),[]);if(t){const{name:e,examples:s}=t,l=(0,a.EP)(o,(s||[]).join("\n")),p=function(e){if(!e)return[];const{name:t,category:o}=e;return o===c.WD.property?[(0,V.jsxs)("span",{children:["prop(",JSON.stringify(t),")"]},0)]:o===c.WD.constant?[(0,V.jsx)("span",{children:t},0)]:o===c.WD.function?K(e):o===c.WD.operator?function(e){const{operator:t}=e;return d.oA(N(e).map(((e,o)=>{let{arity:n}=e;if(1===n.length){const[e]=n;return(0,V.jsxs)("span",{children:[t," ",(0,V.jsx)("i",{children:e})]},-o-1)}if(2===n.length){const[e,i]=n;return(0,V.jsxs)("span",{children:[(0,V.jsx)("i",{children:e})," ",t," ",(0,V.jsx)("i",{children:i})]},-o-1)}if(3===n.length){const[e,t,i]=n;return(0,V.jsxs)("span",{children:[(0,V.jsx)("i",{children:e})," ","? ",(0,V.jsx)("i",{children:t})," ",": ",(0,V.jsx)("i",{children:i})]},-o-1)}})).concat(K(e)))}(e):[]}(t);return(0,V.jsxs)("div",{children:[(0,V.jsx)("h1",{style:i,children:e}),(0,V.jsx)("p",{style:r,children:(0,V.jsx)(L,{entry:t})}),(0,V.jsx)("p",{style:r,children:(0,V.jsx)("b",{children:(0,V.jsx)(m.FormattedMessage,{id:"database.formula.syntaxSection.title",defaultMessage:"Syntax"})})}),(0,V.jsx)("pre",{style:n,children:(0,Z.Z)(p,(e=>(0,V.jsx)("br",{},`sep:${e}`)))}),s&&s.length>0&&(0,V.jsx)("p",{style:r,children:(0,V.jsx)("b",{children:(0,V.jsx)(m.FormattedMessage,{id:"database.formula.examplesSection.title",defaultMessage:"Examples"})})}),(0,V.jsx)("pre",{style:n,dangerouslySetInnerHTML:{__html:l}})]})}return(0,V.jsx)("div",{})}const O=(0,v.withDependency)(v.deps.prismjs,((e,t)=>(0,V.jsx)(B,{...t,Prism:e}))),D={checkbox:"boolean",number:"number",text:"text",date:"date"};function N(e){const{name:t,signatures:o}=e;return"if"===t?[{arity:["boolean","value","value"]}]:"format"===t||"unaryPlus"===t?[{arity:["value"]}]:"equal"===t||"unequal"===t?[{arity:["value","value"]}]:o.map((e=>{let{arity:t,variadic:o}=e;return{variadic:o?D[o]:void 0,arity:t?d.oA(t.map((e=>D[e]))):[]}}))}function K(e){const{name:t}=e;return N(e).map(((e,o)=>{let{variadic:n,arity:i}=e;return n?(0,V.jsxs)("span",{children:[t,"(",(0,V.jsx)("i",{children:n}),"...)"]},o):(0,V.jsxs)("span",{children:[t,"(",(0,Z.Z)(i.map(((e,t)=>(0,V.jsx)("i",{children:e},t))),(e=>(0,V.jsxs)("span",{children:[","," "]},`sep:${e}`))),")"]},o)}))}function L(e){let{entry:t}=e;if(t){const{descriptionMessage:e,fallbackDescription:o}=t;if(e)return(0,V.jsx)(m.FormattedMessage,{...e});if(o)return(0,V.jsx)(V.Fragment,{children:o})}return null}var q=o(480),E=o(39068),U=o(56505),W=o(64921),z=o(52275),$=o(31945),H=o(28992);class G extends i.Z{renderComponent(){const{entry:{name:e}}=this.props;return(0,V.jsx)(z.Z,{focused:this.props.focused,onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,icon:(0,V.jsx)("div",{style:{...E.f,...this.environment.device.isMobile&&{marginLeft:14}},children:this.renderPropertyIcon()}),title:e,right:(0,V.jsx)(Q,{entry:this.props.entry}),style:{...!this.environment.device.isMobile&&{paddingLeft:8,paddingRight:8}},desktopIconStyle:{marginLeft:0}})}renderPropertyIcon(){const{entry:e}=this.props,{theme:t}=this;if(e.category===c.WD.property||e.category===c.WD.constant){const{resultType:o}=e;return(0,V.jsx)(E.ZP,{type:o,icon:void 0,size:16,theme:t})}if(e.category===c.WD.function||e.category===c.WD.operator){const{signatures:[{resultType:o}]}=e;return(0,V.jsx)(E.ZP,{type:o,icon:void 0,size:16,theme:t})}}}G.displayName="FormulaEntryMenuItem";const Y=G;function Q(e){let{entry:t}=e;window.__c={n:"DocumentationButtonPopupComponent"};const o=(0,R.Fg)(),n=(0,q.O7)(),{device:i}=n;return n.device.isMobile?(0,V.jsx)($.ZP,{popupType:i.isMobile?$.Z4.SlideUp:$.Z4.Popup,renderOrigin:e=>(0,V.jsx)(W.Z,{mobileFeedback:!0,style:{width:16,height:16},...e,children:(0,U.S)({fill:o.mediumIconColor})}),render:e=>{let o;return o=i.isMobile?{menuType:f.og.Modal,title:(0,V.jsx)(m.FormattedMessage,{defaultMessage:"Documentation",id:"database.formulaPropertyEntryMenuItem.title"}),right:(0,V.jsx)(k.DoneMenuText,{}),onClickRight:e.close}:{menuType:f.og.Popup},(0,V.jsx)(P.Z,{...o,children:(0,V.jsx)(F.Z,{children:(0,V.jsx)(H.Z,{title:(0,V.jsx)(O,{entry:t}),style:{paddingTop:10,paddingBottom:16}})})})}}):null}var X=o(63143),J=o(52821),ee=o(45023),te=o(33929),oe=o(89224),ne=o(42922),ie=o(3386),re=o(26388);const se={alignItems:"center",position:"absolute",minWidth:"100%",minHeight:44,margin:0,paddingLeft:16,paddingRight:0,paddingTop:12,paddingBottom:12,fontSize:14,fontFamily:u.Z.getCompositeFontFamily(A.SP).githubMono},le={alignItems:"center",position:"absolute",minWidth:"100%",minHeight:32,margin:0,padding:0,paddingLeft:10,paddingRight:8,paddingTop:8,fontSize:13,fontFamily:u.Z.getCompositeFontFamily(A.SP).mono,wordWrap:"break-word"},ae=(0,m.defineMessages)({placeholder:{id:"database.formula.placeholder",defaultMessage:"Type a formula"}});class ce extends i.Z{constructor(){super(...arguments),this.updateTimer=void 0,this.latestSelectionRange=void 0,this.storeTypes={store:_},this.handleSelectionChange=()=>{const e=oe.get();e&&this.input.contains(e.commonAncestorContainer)&&(this.latestSelectionRange=e)},this.handleInputMount=e=>this.input=e,this.handleInput=e=>{const{target:{textContent:t}}=e;this.updateValue(t),X.z4(this.updateTimer)&&(this.updateTimer=window.setTimeout((()=>this.executeUpdate()),0))},this.handleKeyUp=e=>{this.updateSelection()},this.handleClick=e=>{this.updateSelection()},this.handleKeyDown=e=>{(0,ee.Z)(this.environment,e,"command+enter")&&(this.handleAccept(),e.stopPropagation())}}insertEntry(e){var t,o;const{value:n}=this.stores.store.state,{name:i}=e,r=ce.getCompletion(e),s=(null===(t=this.latestSelectionRange)||void 0===t?void 0:t.startOffset)??0;let l=s,c=(null===(o=this.latestSelectionRange)||void 0===o?void 0:o.endOffset)??0;const p=a.wo(n,s);if(p){const[e,t]=p,o=n.slice(e,t).toLowerCase();o!==r.toLowerCase().slice(0,t-e)&&o!==i.toLowerCase().slice(0,t-e)||(l=e,c=t)}this.input.focus();const d=this.input.firstChild||this.input,u=document.createRange();u.setStart(d,l),u.setEnd(d,c),oe.set(u,this.environment.device),l<c&&document.execCommand("delete",!1),document.execCommand("insertText",!1,r);const m=(c+r.length)/(this.input&&this.input.textContent&&this.input.textContent.length||0)*this.container.scrollWidth;m>this.container.scrollLeft+this.container.offsetWidth&&(this.container.scrollLeft=m-this.container.offsetWidth)}handleAccept(){this.updateTimer&&(window.clearTimeout(this.updateTimer),this.updateTimer=void 0);const{value:e}=this.stores.store.state;if(""===e.trim())this.props.onSubmit();else{const{formula:t,error:o}=de(e,this.props.schema,this.props.property,this.props.formulaStringHelpers);o||this.props.onSubmit(t)}}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const{formula:t,schema:o}=e,n=this.props.formulaStringHelpers.formulaToString(t,o);this.updateValue(n)}didMount(){const{device:e}=this.environment,{value:t}=this.stores.store.state;if(this.input&&(this.input.textContent=t,e.isMobile||this.input.focus(),t)){const e=document.getSelection();this.input.firstChild&&e.collapse(this.input.firstChild,t.length),this.container.scrollLeft=this.container.scrollWidth-this.container.offsetWidth}document.addEventListener("selectionchange",this.handleSelectionChange)}willUnmount(){document.removeEventListener("selectionchange",this.handleSelectionChange)}renderComponent(){const{device:e}=this.environment,{disabled:t}=this.props,{command:o}=g.fg(this.environment),{html:n}=this.stores.store.state;return(0,V.jsxs)("div",{style:ue(this.props.disabled,this.environment,this.theme,this.props.wrapStyle),children:[(0,V.jsxs)("div",{ref:e=>{e&&(this.container=e)},style:(i=this.props.inputContainerStyle,{flexGrow:1,position:"relative",minWidth:0,...i}),children:[(0,V.jsx)(ie.Z,{capture:!t,onLeft:d.yR,onRight:d.yR,onSelectAll:d.yR,onRedo:d.yR,onUndo:d.yR,onToggleBold:d.yR,onToggleItalics:d.yR,onToggleCode:d.yR,onCut:d.yR,onCopy:d.yR,onPaste:d.yR,onKeypress:d.yR,onDelete:d.yR,onBackspace:d.yR,children:(0,V.jsx)("div",{ref:this.handleInputMount,contentEditable:!t,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onClick:this.handleClick,onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,onInput:this.handleInput,onPaste:me,style:this.getInputStyle()})}),(0,V.jsx)("div",{style:this.getOverlayStyle(),dangerouslySetInnerHTML:{__html:n}})]}),!e.isMobile&&!t&&(0,V.jsx)(re.Z,{renderTooltip:()=>(0,V.jsxs)("div",{children:[(0,V.jsx)("span",{children:(0,V.jsx)(m.FormattedMessage,{defaultMessage:"Accept",id:"database.formula.acceptFormulaInput.tooltip"})})," ",(0,V.jsxs)("span",{style:{color:this.theme.mediumInvertedTextColor},children:[o,"+Enter"]})]}),render:t=>(0,V.jsx)(ne.Z,{disabled:Boolean(this.stores.store.state.error),onClick:()=>this.handleAccept(),style:{height:24,padding:"0 8px",alignSelf:"flex-end",marginRight:6,marginBottom:4,...e.isMobile&&{marginRight:12}},...t,children:(0,V.jsx)(m.FormattedMessage,{id:"database.formula.doneButton.label",defaultMessage:"Done"})})})]});var i}updateValue(e){const t=""===e.trim()?this.props.disabled?"":te.default.formatMessage(ae.placeholder):a.EP(this.props.Prism,e);this.stores.store.setState({...this.stores.store.state,html:t,value:e})}updateSelection(){const e=document.getSelection().anchorOffset,{value:t}=this.stores.store.state,o=a.wo(t,e),n=o?t.slice(o[0],o[1]):"";n!==this.stores.store.state.query&&this.stores.store.setState({...this.stores.store.state,query:n})}executeUpdate(){const{value:e}=this.stores.store.state,{error:t,formula:o}=de(e,this.props.schema,this.props.property,this.props.formulaStringHelpers);!t&&o&&this.props.onChange(o),this.updateTimer=void 0,this.stores.store.setState({...this.stores.store.state,error:t})}static getCompletion(e){const{category:t,name:o}=e;return t===c.WD.property?`prop(${JSON.stringify(o)})`:t===c.WD.constant?o:`${o}(`}getOverlayStyle(){const{device:e}=this.environment,{value:t}=this.stores.store.state;return{...e.isMobile?se:le,zIndex:0,...""===t.trim()&&{color:this.theme.mediumTextColor},position:void 0}}getInputStyle(){const{device:e}=this.environment,t=e.isSafari||e.isChrome?"WebkitTextFillColor":"color";return{...e.isMobile?se:le,border:"none",background:"none",[t]:""===this.stores.store.state.value?this.theme.regularTextColor:s.ZP.transparent,caretColor:this.theme.regularTextColor,zIndex:1,width:"100%"}}}ce.displayName="FormulaInput";const pe=ce;function de(e,t,o,n){if(""===e.trim())return{error:void 0,formula:void 0,type:void 0};{const i=n.stringToFormula({str:e,property:o,schema:t,intl:te.default.getIntl(),propertyTypeDisplayName:J.SO});if(i&&"error"===i.type){const{message:e}=i;return{formula:void 0,error:e,type:void 0}}return{formula:i,error:void 0,type:void 0}}}function ue(e,t,o,n){const{device:i,WindowSizeStore:r}=t;return{display:"flex",flex:"none",background:o.inputBackground,minHeight:33,borderTopLeftRadius:4,borderTopRightRadius:4,...e&&{background:o.contentBackground,borderRadius:4},...i.isMobile&&{borderBottom:`1px solid ${o.regularDividerColor}`,background:o.popoverBackground,minHeight:44,paddingLeft:r.state.paddingLeftCSS,paddingRight:r.state.paddingRightCSS},...n}}function me(e){e.preventDefault();const t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}var he=o(74523);const ge={color:s.ZP.redWithAlpha(.8),...u.Z.textOverflowStyle},Se={paddingLeft:16,paddingRight:16};class ye extends i.Z{constructor(){super(...arguments),this.storeTypes={formulaInputStore:_,menuListStore:M.Z},this.state={filteredSections:[]},this.handleFilteredSectionsChange=e=>{d.Xy(e.map((e=>e.key)),this.state.filteredSections.map((e=>e.key)))||this.setState({filteredSections:e})}}renderComponent(){const{device:e}=this.environment,{schema:t,property:o,disabled:i}=this.props,{error:r}=this.stores.formulaInputStore.state,{formula:s}=t[o],l=(0,V.jsxs)(n.Fragment,{children:[(0,V.jsx)(v.DependencyConsumer,{dependency:v.deps.prismjs,children:e=>(0,V.jsx)(v.DependencyConsumer,{dependency:v.deps.formulaStringHelpers,children:n=>(0,V.jsx)(pe,{ref:e=>{e&&(this.formulaInput=e)},Prism:e,formulaStringHelpers:n,store:this.stores.formulaInputStore,formula:s,schema:t,property:o,disabled:i,onChange:e=>this.handleInputChange(e),onSubmit:e=>this.handleInputSubmit(e),wrapStyle:{overflow:"hidden"},inputContainerStyle:{maxHeight:"45vh",overflow:"scroll"}})})}),e.isMobile&&this.renderStatus()]});let a;return a=e.isMobile?{menuType:f.og.Modal,title:(0,V.jsx)(m.FormattedMessage,{id:"database.mobileFormulaModal.title",defaultMessage:"Formula"}),left:(0,V.jsx)(k.CancelMenuText,{}),right:r?void 0:(0,V.jsx)(m.FormattedMessage,{id:"database.mobileFormulaModal.saveButton.label",defaultMessage:"Save"}),onClickLeft:this.props.onClickCancel,onClickRight:()=>this.formulaInput.handleAccept(),header:l}:{menuType:f.og.Popup,width:580,height:i?"none":void 0,minHeight:358,disableScroller:!0,header:l,footer:this.renderStatus(),scrollerStyle:{display:"flex"}},(0,V.jsx)(P.Z,{...a,children:!i&&this.renderContent()})}renderContent(){const{device:e}=this.environment,t=function(e,t,o,n){const i=Object.keys(e).filter((o=>{const n=e[o];return!(o===t||n&&r.rX.includes(n.type))})).map((t=>{const i=e[t];if(!i)throw new Error("Property not found.");const{name:r}=i,s=o?l.Qs({property:t,schema:e,block:o,getRecordModel:b.default.getCurrentBlockModelFn(),collectionRequestContext:{userId:void 0,userTimeZone:(0,p.r)(),intl:n,depth:0,resultCache:new Map,visitedProperties:new Set}}):void 0;return{name:r,category:c.WD.property,fallbackDescription:n.formatMessage({id:"database.formula.property.description",defaultMessage:"Returns the {propertyName} property for each entry."},{propertyName:r}),resultType:a.z6(i),examples:s?[`prop(${JSON.stringify(r)}) == ${JSON.stringify(s)}`]:[]}}));return[c.jQ(c.WD.property,i),...c.ZY]}(this.props.schema,this.props.property,this.props.exampleBlock,this.props.intl),o=this.getFocusedEntry(t);return e.isMobile?(0,V.jsx)(I.Z,{initialFocus:0,context:{blocks:[],environment:this.environment,publicEditMode:void 0},filter:this.stores.formulaInputStore.state.query,sections:this.renderSections(t),menuListStore:this.stores.menuListStore,onFilteredSectionsChange:this.handleFilteredSectionsChange}):(0,V.jsxs)("div",{style:{display:"flex",flexGrow:1,boxShadow:`\n\t\t\t\t\t\t\tinset 0 1px 0 ${this.theme.regularDividerColor},\n\t\t\t\t\t\t\tinset 0 -1px 0 ${this.theme.regularDividerColor}\n\t\t\t\t\t\t`,maxHeight:295},children:[(0,V.jsx)(T.Z,{type:C.Z.Y,style:{width:180,flexGrow:0,flexShrink:0},children:(0,V.jsx)(I.Z,{initialFocus:0,context:{blocks:[],environment:this.environment,publicEditMode:void 0},filter:this.stores.formulaInputStore.state.query,sections:this.renderSections(t),menuListStore:this.stores.menuListStore,onFilteredSectionsChange:this.handleFilteredSectionsChange})}),(0,V.jsx)(T.Z,{type:C.Z.Y,style:{padding:12,boxShadow:`inset 1px 0 0 ${this.theme.regularDividerColor}`,flexGrow:1},children:(0,V.jsx)(O,{entry:o})})]})}renderStatus(){const{device:e}=this.environment,{disabled:t}=this.props,{command:o}=g.fg(this.environment),{error:n}=this.stores.formulaInputStore.state;return n?(0,V.jsxs)("div",{style:e.isMobile?be(this.environment,this.theme):Ce(this.theme),children:[(0,V.jsx)("span",{style:{...e.isMobile&&Se,...ge},children:n}),!e.isMobile&&(0,V.jsx)(ve,{})]}):e.isMobile?(0,V.jsx)("div",{style:be(this.environment,this.theme),children:(0,V.jsx)("span",{style:Se,children:(0,V.jsx)(m.FormattedMessage,{defaultMessage:"No errors.",id:"database.formula.mobileNoErrors.message"})})}):t?void 0:(0,V.jsxs)("div",{style:Ce(this.theme),children:[(0,V.jsx)("span",{children:(0,V.jsx)(m.FormattedMessage,{id:"database.formula.keyboardShortcutHint",defaultMessage:"{commandEnter} to accept",values:{commandEnter:(0,V.jsxs)("span",{style:{fontWeight:u.Z.fontWeight.medium},children:[o,"+Enter"]})}})}),(0,V.jsx)(ve,{})]})}renderSections(e){return e.map((e=>({key:e.key,title:this.props.intl.formatMessage(e.titleMessage),render:e=>(0,V.jsx)(F.Z,{...e,desktopTitleStyle:{paddingLeft:8,paddingRight:8}}),actions:e.entries.map(((e,t)=>({key:xe(e,t),displayName:e.name,analyticsName:e.name,searchName:e.name,render:t=>(0,V.jsx)(Y,{...t,entry:e}),action:()=>{this.formulaInput.insertEntry(e)},closeParentMenu:!1})))})))}handleUpdate(e,t){const{onChange:o,schema:n,property:i,analyticsFrom:r}=this.props;if(e&&"error"===e.type);else{const s=n[i];o({propertySchema:{...s,formula:e},close:t}),s&&h.$qu(this.environment,{...(0,y.Pn)(this.context.collectionContextStore),property_type:s.type,action:"formula_edit",from:r})}}getFocusedEntry(e){var t;const{focus:{section:o,indexLocal:n}}=this.stores.menuListStore.state,i="number"==typeof o&&"number"==typeof n?null===(t=this.state.filteredSections[o])||void 0===t||null===(t=t.actions[n])||void 0===t?void 0:t.key:void 0;if(void 0!==i)for(const r of e)for(const[e,t]of r.entries.entries())if(xe(t,e)===i)return t}handleInputChange(e){this.handleUpdate(e,!1)}handleInputSubmit(e){this.handleUpdate(e,!0)}}ye.displayName="FormulaPropertyMenu",ye.contextTypes={...i.w,...S.xm};const fe=(0,m.injectIntl)(ye);function xe(e,t){return`${e.name} ${t}`}function ve(){return(0,V.jsx)("div",{style:{marginLeft:"auto"},children:(0,V.jsx)(he.Z,{title:(0,V.jsx)("span",{style:{fontSize:u.Z.fontSize.UISmall.desktop},children:(0,V.jsx)(m.FormattedMessage,{defaultMessage:"Learn more about formulas",id:"formulaPropertyMenu.learnMore.button.label"})}),href:(0,x.UY)("guides.formulas"),analyticsFrom:"formula_property_menu"})})}function Ce(e){return{display:"flex",flex:"none",alignItems:"center",fontSize:12,paddingLeft:8,paddingRight:8,height:30,color:e.mediumTextColor}}function be(e,t){const{WindowSizeStore:o}=e;return{display:"flex",flex:"none",alignItems:"center",fontSize:14,height:28,color:t.mediumTextColor,background:t.popoverBackground,boxShadow:`0 1px 0 ${t.regularDividerColor}`,paddingLeft:o.state.paddingLeftCSS,paddingRight:o.state.paddingRightCSS}}},61764:(e,t,o)=>{o.d(t,{g:()=>u});o(67294);var n=o(480),i=o(86628),r=o(24405),s=o(82990),l=o(68939),a=o(97004),c=o(65569),p=o(75498),d=o(85893);function u(e){window.__c={n:"SprintRemainingTasksSummary"};const{taskCollectionContextStore:t,children:o}=e,n=(0,i.VK)((()=>(0,a.Nq)(t)),[t]),r=(0,i.VK)((()=>t.collectionStore()),[t]),s=(0,i.VK)((()=>(0,c.Hy)(r)),[r]);return!s||n?null:(0,d.jsx)(p.Z,{id:"completed_tasks_in_current_sprint_view",collectionContextStore:t,reducer:s,render:e=>{const t=(0,c.yg)(e.state);return t?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(m,{currentSprintTasksInView:t}),o(t)]}):null}})}function m(e){window.__c={n:"RemainingTasksSummary"};const{currentSprintTasksInView:t}=e,o=(0,r.yK)((e=>({summary:{color:e.lightTextColor,fontSize:s.Z.fontSize.UIRegular.desktop,fontWeight:s.Z.fontWeight.regular,whiteSpace:"nowrap"}})),[]),{isPhone:i}=(0,n.Fy)();return i?null:(0,d.jsx)("div",{style:o.summary,children:(0,d.jsx)(l.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} tasks",values:{completedTaskCount:t.completedTaskCount,totalTaskCount:t.totalTaskCount}})})}},58902:(e,t,o)=>{o.d(t,{t:()=>d});var n=o(30120),i=(o(67294),o(480)),r=o(86628),s=o(24405),l=o(82990),a=o(68939),c=o(61764),p=o(85893);function d(e){var t;window.__c={n:"SprintSummaryAndDaysRemaining"};const{collectionContextStore:o,sprintAutomationContext:a}=e,d=(0,s.yK)((e=>({summary:{color:e.lightTextColor,fontSize:l.Z.fontSize.UIRegular.desktop,fontWeight:l.Z.fontWeight.regular,whiteSpace:"nowrap"}})),[]),{isPhone:m}=(0,i.Fy)(),h=(0,r.VK)((()=>{var e;const t=null===(e=a.automationContext)||void 0===e?void 0:e.automationStore.getRunAt();if(!t)return;const o=n.ou.fromMillis(t,{zone:"utc"}).startOf("day"),i=n.ou.now().toUTC().startOf("day"),r=o.diff(i,"days").as("days");return r<1?"soon":1===r?"today":2===r?"tomorrow":r}),[null===(t=a.automationContext)||void 0===t?void 0:t.automationStore]);return h?(0,p.jsx)(c.g,{taskCollectionContextStore:o,children:()=>m?null:(0,p.jsxs)("div",{style:d.summary,children:[(0,p.jsxs)("span",{children:[" ","·"," "]}),(0,p.jsx)(u,{daysRemaining:h})]})}):null}function u(e){const{daysRemaining:t}=e;return"soon"===t?(0,p.jsx)(a.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.endingSoon",defaultMessage:"Ending soon"}):"today"===t?(0,p.jsx)(a.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.endsToday",defaultMessage:"Ends today"}):"tomorrow"===t?(0,p.jsx)(a.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.endsTomorrow",defaultMessage:"Ends tomorrow"}):(0,p.jsx)(a.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.daysRemaining",defaultMessage:"Ends in {daysRemaining} days",values:{daysRemaining:t}})}},30905:(e,t,o)=>{o.d(t,{TB:()=>b,Xh:()=>x,Y7:()=>C,ZP:()=>v,qQ:()=>f});var n=o(67294),i=o(86628),r=o(24405),s=o(6695),l=o(20669),a=o(32056),c=o(3791),p=o(68939),d=o(44866),u=o(14976),m=o(78291),h=o(42917),g=o(91839),S=o(26388),y=o(85893);function f(e){let{collectionStore:t,propertySchema:o}=e;window.__c={n:"AiAutofillFillAllPagesTooltip"};const n=(0,i.VK)((()=>(0,u.Xh)(t.getName(),t)),[t]),r=(0,i.VK)((()=>{var e;const t=(null===(e=m.default.state.data)||void 0===e?void 0:e.addOns)??[];return(0,c.de)(t)}),[]);return(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{style:{color:"white",fontWeight:500,wordWrap:"break-word",whiteSpace:"pre-wrap"},children:(0,y.jsx)(p.FormattedMessage,{...d.fillAllPagesMessages.fillAllPagesTooltip,values:{hasNames:Boolean(n)&&Boolean(o.name),collectionName:n,propertyName:o.name}})}),!r&&(0,y.jsx)("div",{style:{color:"#ACABA9",fontWeight:500},children:(0,y.jsx)(p.FormattedMessage,{...d.fillAllPagesMessages.fillAllPagesAddOnMessage})})]})}function x(e){let{updateAiInferencesTaskStatus:t,iconStyle:o,progressIconStyle:n}=e;window.__c={n:"AiAutofillFillAllPagesButtonIcon"};const i=(0,r.Fg)();return t.isRunning?(0,y.jsx)("div",{style:n,children:(0,y.jsx)(g.Z,{})}):(0,l.y)({width:14,color:i.accentColors.purple[400],...o})}function v(e){let{updateAiInferencesTaskStatus:t,style:o}=e;window.__c={n:"AiAutofillFillAllPagesButtonInner"};const n=(0,p.useIntl)();return(0,y.jsx)("div",{style:o,children:t.isRunning?(0,y.jsx)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:void 0===t.numPagesFilled||void 0===t.numPagesRequested?(0,y.jsx)(p.FormattedMessage,{defaultMessage:"Autofilling all pages",id:"aiAutofill.fillallPages.updatingAllPages"}):(0,y.jsx)(p.FormattedMessage,{defaultMessage:"{numPagesRequested, plural, one {Autofilling {numPagesFilled} of {numPagesRequested} page} other {Updating {numPagesFilled} of {numPagesRequested} pages}}",id:"aiAutofill.fillallPages.updatingAllPagesWithProgress",values:{numPagesFilled:(0,a.uf)(t.numPagesFilled,"compact",n),numPagesRequested:(0,a.uf)(t.numPagesRequested,"compact",n)}})}):(0,y.jsx)(p.FormattedMessage,{defaultMessage:"Autofill all pages",id:"aiAutofill.fillAllPages.buttonTitle"})})}function C(e){let{updateAiInferencesTaskStatus:t}=e;window.__c={n:"AiAutofillFillAllPagesButtonCaption"};const{numPagesFilled:o,numPagesRequested:n}={numPagesFilled:void 0,numPagesRequested:void 0,...t},i=(0,r.yK)((e=>({inner:{background:e.accentColors.purple[400],height:"100%",transition:"width .5s"},outer:{background:e.accentColors.gray[100],height:3,borderRadius:2,minWidth:120,overflow:"hidden",marginTop:8}})),[]);return void 0===o||void 0===n?null:(0,y.jsx)("div",{style:i.outer,role:"progressbar",children:(0,y.jsx)("div",{style:{...i.inner,width:100*Math.min(o/n,1)+"%"}})})}function b(e){window.__c={n:"AiAutofillFillAllPagesMenuItem"};const{environment:t,collectionContextStore:o,collectionStore:r,property:l,propertySchema:a,doesUserHaveAIAddOn:c,isAutofillSetupEnabled:p}=e,u=(0,i.VK)((()=>{const e=o.collectionStore();return e?(0,s.De)(e.getFormat(),l):{isRunning:!1,numPagesFilled:void 0,numPagesRequested:void 0}}),[o,l]),m=(0,n.useCallback)((async()=>{const e=o.collectionStore();e&&a&&await d.autofillPropertyForCollection({environment:t,collectionStore:e,propertySchema:a,property:l})}),[t,a,l,o]);return(0,y.jsx)(S.Z,{disableTooltip:c,renderTooltip:()=>(0,y.jsx)(f,{collectionStore:r,propertySchema:a}),render:e=>(0,y.jsx)(h.Z,{icon:e=>(0,y.jsx)(x,{updateAiInferencesTaskStatus:u,iconStyle:e,progressIconStyle:{marginTop:4,marginLeft:4,marginRight:2}}),title:(0,y.jsx)(v,{updateAiInferencesTaskStatus:u}),caption:void 0!==u.numPagesFilled&&void 0!==u.numPagesRequested&&(0,y.jsx)(C,{updateAiInferencesTaskStatus:u}),focused:!1,onClick:m,disabled:u.isRunning||!p,...e})})}},91965:(e,t,o)=>{o.d(t,{Z:()=>p});var n=o(67294),i=o(4615),r=o(68939),s=o(42917),l=o(24006),a=o(85893);function c(e){let{setAiInference:t,aiInference:o}=e;window.__c={n:"CollectionSettingsAiAutofillAddOptionsToggle"};const c=(0,n.useRef)((0,i.ZP)()),p=()=>{if(!o)return;const e={...o,add_options:!o.add_options};t(e)};return(0,a.jsx)(s.Z,{title:(0,a.jsx)(r.FormattedMessage,{id:"collectionSettingsAiAutofillAddOptionsToggle.title.text",defaultMessage:"Allow new select options"}),showChevron:!1,right:(0,a.jsx)(l.Z,{inputId:c.current,on:!(null==o||!o.add_options),onClick:p,disabled:!1,noColor:!1}),onClick:p,disabled:!1,textWrapperStyle:{minWidth:"auto"}})}const p=n.memo(c)},43350:(e,t,o)=>{o.d(t,{Z:()=>r});o(67294);var n=o(65742);o(57658);var i=o(85893);function r(e){const{startPoint:t,endPoint:o,style:r,showArrowHead:a,useRightAngles:c,cornerRadiusOverride:p,handleMouseMove:d,handleMouseLeave:u}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l,{startPoint:t,startCurvePoint:c?void 0:{x:t.x+n.i2,y:t.y},endPoint:a?{x:o.x-1.5,y:o.y}:o,endCurvePoint:c?void 0:{x:o.x-n.i2,y:o.y},cornerRadiusOverride:p,style:r,handleMouseMove:d,handleMouseLeave:u,children:e.children}),a&&(0,i.jsx)(s,{endPoint:o,style:r})]})}function s(e){const{endPoint:t,style:o}=e;return(0,i.jsx)("polyline",{points:`${t.x-5},${t.y-6} ${t.x},${t.y} ${t.x-5},${t.y+6}`,style:o,fill:"transparent"})}function l(e){const{startPoint:t,startCurvePoint:o,endPoint:n,endCurvePoint:r,style:s,cornerRadiusOverride:l,handleMouseMove:a,handleMouseLeave:c}=e;let p="";p=o&&r?`M ${t.x} ${t.y} L ${o.x} ${o.y} L ${r.x} ${r.y} L ${n.x} ${n.y}`:`M ${t.x} ${t.y} L ${t.x} ${n.y} L ${n.x} ${n.y}`;const d=function(e,t){function o(e,t,o){const i=t.x-e.x,r=t.y-e.y,s=Math.sqrt(i*i+r*r);return n(e,t,Math.min(1,o/s))}function n(e,t,o){return{x:e.x+(t.x-e.x)*o,y:e.y+(t.y-e.y)*o}}function i(e,t){e.length>2&&(e[e.length-2]=t.x.toString(),e[e.length-1]=t.y.toString())}function r(e){return{x:parseFloat(e[e.length-2]),y:parseFloat(e[e.length-1])}}const s=e.split(/[,\s]/).reduce(((e,t)=>{const o=t.match("([a-zA-Z])(.+)");return o?(e.push(o[1]),e.push(o[2])):e.push(t),e}),[]).reduce((function(e,t){return!isNaN(parseFloat(t))&&e.length?e[e.length-1].push(t):e.push([t]),e}),[]);let l=[];if(s.length>1){const e=r(s[0]);let a=null;"Z"===s[s.length-1][0]&&s[0].length>2&&(a=["L",e.x.toString(),e.y.toString()],s[s.length-1]=a),l.push(s[0]);for(let c=1;c<s.length;c++){const e=l[l.length-1],p=s[c],d=p===a?s[1]:s[c+1];if(d&&e&&e.length>2&&"L"===p[0]&&d.length>2&&"L"===d[0]){const s=r(e),a=r(p),c=r(d),u=o(a,s,t),m=o(a,c,t);i(p,u),l.push(p);const h=n(u,a,.5),g=n(a,m,.5),S=["C",h.x.toString(),h.y.toString(),g.x.toString(),g.y.toString(),m.x.toString(),m.y.toString()];l.push(S)}else l.push(p)}if(a){const e=r(l[l.length-1]);l.push(["Z"]),i(l[0],e)}}else l=s;return l.reduce((function(e,t){return`${e}${t.join(" ")} `}),"")}(p,l||16);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d,style:s,fill:"transparent"}),(a||c)&&(0,i.jsxs)("g",{onMouseMove:a,onMouseLeave:c,children:[(0,i.jsx)("path",{d,style:{strokeOpacity:0,strokeWidth:16,pointerEvents:"stroke",cursor:"default"},fill:"transparent"}),e.children]})]})}},13162:(e,t,o)=>{o.d(t,{Z:()=>k});var n=o(67294),i=o(12183),r=o(480),s=o(86628),l=o(24405),a=o(56373),c=o(8848),p=o(59054),d=o(47453),u=o(6287),m=o(82990),h=o(68939),g=o(8406),S=o(54642),y=o(16956),f=o(47307),x=o(39699),v=o(33929),C=o(42922),b=o(68894),w=o(68785),j=o(76798),_=o(32662),M=o(64369),I=o(85893);const P=(0,h.defineMessages)({autoIncrementIdPrefixPlaceholder:{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPlaceholder"},duplicatePrefixNameError:{defaultMessage:"{prefixName} isn't available for use.",id:"database.viewSettings.propertyTab.duplicatePrefixNameError"}});function k(e){window.__c={n:"CollectionSettingsAutoIncrementIdProperty"};const{uniqueIdProperty:t,prefixValue:o,collectionContextStore:c}=e,w=(0,r.O7)(),k=(0,s.VK)((()=>c.collectionStore()),[c]),[F,A]=(0,n.useState)(o??""),[R,Z]=(0,n.useState)(!0),[V,B]=(0,n.useState)(),O=(0,n.useCallback)((()=>{Z(!0),B(void 0)}),[Z,B]),D=(0,n.useCallback)((e=>{Z(!0),B(v.default.formatMessage(P.duplicatePrefixNameError,{prefixName:`"${e}"`}))}),[]),N=(0,n.useCallback)(((e,t,o)=>{const n=o.collectionStore();n&&(Z(!1),S.setRecordKey(w,{spaceId:n.getSpaceId(),table:n.table,key:e,id:n.id}).then((n=>{Z(!0),200!==n.status?D(e):g.$q({environment:w,collectionContextStore:o,property:t,from:"view_settings",action:"unique_id_change_collection_key"})})).catch((()=>D(e))))}),[w,D]),K=(0,n.useCallback)((async e=>{if(!k)return!1;const t=await S.isRecordKeyAvailable(w,{spaceId:k.getSpaceId(),table:k.table,key:e.trim()});return"success"===t.type&&t.data.isAvailable}),[k,w]),L=(0,i.v)((e=>{K(e).then((t=>{t||D(e),Z(!0)})).catch((()=>D(e)))}),500),[q]=(0,p.r5)((async()=>{if(k)return S.suggestRecordKey(w,{spaceId:k.getSpaceId(),table:u.v,id:k.id,shouldSetSuccessfullySuggestedRecord:!1})}),[k,w]);(0,n.useEffect)((()=>{var e;if(!o&&"resolved"===q.status)return"success"===(null===(e=q.value)||void 0===e?void 0:e.type)&&q.value.data?(B(void 0),void A(q.value.data.key)):void 0}),[o,q]),(0,n.useEffect)((()=>()=>{L.cancel()}),[L]);const E=(0,n.useCallback)((e=>{const t=e.target.value.toUpperCase();A(t),O(),t&&t!==o&&((0,a.k5)(t)||B(v.default.formatMessage(a.sY.prefixInvalidError)),Z(!1),L(t))}),[O,o,L]),U=(0,n.useCallback)((()=>{L.flush()}),[L]),W=(0,n.useCallback)((e=>{const n=null==k?void 0:k.getRecordKeyStore();e!==o&&!V&&n&&k&&null!=t&&t.propertySchema?N(e,null==t?void 0:t.propertyId,c):Z(!0)}),[k,o,V,t,N,c]),z=(0,n.useCallback)((()=>{const e=c.collectionStore();e&&x.createAndCommit({userAction:"CollectionSettingsAutoIncrementIdPropertyCreateNewIdProperty",environment:w,perform:t=>{const o=y.G3({environment:w,collectionStore:e,collectionViewArgs:void 0,propertyType:"auto_increment_id",transaction:t});N(F,o,c)}})}),[c,w,F,N]),$=(0,n.useCallback)((e=>{if(!k)return;const t=[{label:(0,I.jsx)(h.FormattedMessage,{id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit",defaultMessage:"Update ID Prefix"}),color:"red",onAccept:()=>W(e)}];f.showDialog({message:(0,I.jsx)("span",{children:(0,I.jsx)(h.FormattedMessage,{id:"database.viewSettings.propertyTab.changePrefixConfirmationMessage",defaultMessage:"Updating the prefix will stop 3rd party automations that rely on this ID (e.g., GitHub PR status automation).",values:{databaseName:(0,I.jsx)(j.Z,{style:{display:"inline",fontWeight:m.Z.fontWeight.medium},shouldWrap:!0,store:k})}})}),showCancel:!0,keepFocus:!0,items:t})}),[k,W]),H=(0,n.useCallback)((e=>{o?$(e):W(e)}),[o,W,$]),G=(0,n.useCallback)((()=>t?t&&!o?(0,I.jsxs)(I.Fragment,{children:[(0,d.R)({width:14,height:14}),(0,I.jsx)(_.Z,{size:4}),(0,I.jsx)(h.FormattedMessage,{defaultMessage:"Add ID prefix",id:"database.viewSettings.propertyTab.autoIncrementIdCreatePrefix"})]}):(0,I.jsx)(h.FormattedMessage,{defaultMessage:"Update ID Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit"}):(0,I.jsxs)(I.Fragment,{children:[(0,d.R)({width:14,height:14}),(0,I.jsx)(_.Z,{size:4}),(0,I.jsx)(h.FormattedMessage,{defaultMessage:"Add ID property",id:"database.viewSettings.propertyTab.autoIncrementIdCreateProperty"})]})),[o,t]),Y=(0,l.yK)((e=>({prefixInputOuterStyle:{color:void 0===o?e.lightTextColor:e.regularTextColor}})),[o]);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(b.ZP,{left:(0,I.jsx)(M.Z,{style:{marginLeft:4,marginRight:7},children:(0,I.jsx)(h.FormattedMessage,{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefix"})}),value:F,inputOuterStyle:Y.prefixInputOuterStyle,onChange:E,onBlur:U,placeholder:P.autoIncrementIdPrefixPlaceholder.defaultMessage,onSubmit:()=>H(F.trim()),focusInitial:!1,selectAll:!1,disabled:!1}),V||!R?(0,I.jsx)(T,{prefixName:F,hasRequestCompleted:R,errorMessage:V}):(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(M.Z,{isSmall:!0,isSecondaryColor:!0,style:{marginTop:16,marginLeft:16},children:(0,I.jsx)(h.FormattedMessage,{defaultMessage:"{prefixWithHyphen}1, {prefixWithHyphen}2, {prefixWithHyphen}3, ...",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPreview",values:{prefixWithHyphen:F?`${F}-`:""}})})}),(0,I.jsx)(C.Z,{isLarge:!0,style:{margin:"8px 16px",width:"90%"},onClick:()=>{t?H(F.trim()):z()},disabled:F===o||Boolean(V)||!R,children:G()})]})}function T(e){const{errorMessage:t,hasRequestCompleted:o}=e;return(0,I.jsx)(M.Z,{isMultiline:!0,style:{paddingTop:12,marginLeft:16,marginRight:16,...o?{color:c.ZP.red}:{},...e.styles},isSecondaryColor:!o,children:o&&t?t:(0,I.jsx)("div",{style:{paddingTop:3,paddingBottom:3},children:(0,I.jsx)(w.Z,{style:{width:14,height:14}})})})}},59187:(e,t,o)=>{o.d(t,{Z:()=>ge});var n=o(67294),i=o(480),r=o(86628),s=o(24405),l=o(77657),a=o(29109),c=o(97880),p=o(68939),d=o(47307),u=o(42631),m=o(16732),h=o(75081),g=o(12205),S=o(30874),y=o(89728),f=o(72495),x=o(32662),v=o(13162),C=(o(57658),o(99036)),b=o(39068),w=o(84619),j=o(74487);const _={pull_request_review_edited:!0,pull_request_review_submitted:!0,pull_request_review_requested:!0,pull_request_review_request_removed:!0,pull_request_closed:!0,pull_request_opened:!0,pull_request_reopened:!0,installation_deleted:!0,installation_suspend:!0,installation_unsuspend:!0,pull_request_converted_to_draft:!0,pull_request_edited:!0,pull_request_assigned:!0},M={pull_request_opened:!0,pull_request_review_requested:!0,pull_request_review_submitted:!0,pull_request_closed:!0};(0,c.AO)((e=>{const t=(0,c.Yd)(_);return(0,c.DE)(t,e)?{true:e}:{false:e}}));j.literals(...(0,c.Yd)({pull_request:!0,pull_request_review:!0,installation:!0})),j.literals(...(0,c.Yd)(_));var I=o(33907),P=o(47453),k=o(37612),T=o(8406),F=o(16956),A=o(14900),R=o(39699),Z=o(66890),V=o(33929),B=o(87279),O=o(29376),D=o(42917),N=o(42922),K=o(52275),L=o(31945),q=o(96525),E=o(61519),U=o(78140),W=o(32163),z=o(40721),$=o(22084),H=o(85893);const G=(0,p.defineMessages)({autoUpdate:{defaultMessage:"Auto-update",id:"collectionSettingsGithubAutomationConfig.statusPicker.autoUpdate"},when:{defaultMessage:"when PR is",id:"collectionSettingsGithubAutomationConfig.statusPicker.when"},addStatusDescription:{defaultMessage:"Add a status property to set up automations.",id:"collectionSettingsGithubAutomationConfig.addStatusDescription"},addStatusButton:{defaultMessage:"Add status property",id:"collectionSettingsGithubAutomationConfig.statusPicker.addStatusButton"},newStatusPropertyButton:{defaultMessage:"New status",id:"collectionSettingsGithubAutomationConfig.statusPicker.newStatusPropertyButton"},pull_request_opened:{defaultMessage:"Opened",id:"collectionSettingsGithubAutomationConfig.pullRequestOpened"},pull_request_review_requested:{defaultMessage:"Review requested",id:"collectionSettingsGithubAutomationConfig.pullRequestReviewRequested"},pull_request_review_submitted:{defaultMessage:"Approved",id:"collectionSettingsGithubAutomationConfig.pullRequestApproved"},pull_request_closed:{defaultMessage:"Merged",id:"collectionSettingsGithubAutomationConfig.pullRequestMerged"},noAutomations:{defaultMessage:"None",id:"collectionSettingsGithubAutomationConfig.noAutomation"},removeStatusOption:{defaultMessage:"Clear",id:"collectionSettingsGithubAutomationConfig.removeStatusOption"}}),Y={pull_request_opened:V.default.formatMessage(G.pull_request_opened),pull_request_review_requested:V.default.formatMessage(G.pull_request_review_requested),pull_request_review_submitted:V.default.formatMessage(G.pull_request_review_submitted),pull_request_closed:V.default.formatMessage(G.pull_request_closed)},Q=V.default.formatMessage(G.noAutomations),X={pull_request_opened:null,pull_request_review_requested:null,pull_request_review_submitted:null,pull_request_closed:null};function J(e){window.__c={n:"CollectionSettingsGithubAutomationConfig"};const{gitHubProperty:t,selectedStatusProperty:o,setSelectedStatusProperty:s,intl:l}=e,a=(0,i.O7)(),p=(0,Z.Y$)(),d=(0,i.Fy)(),u=ne(),m=(0,r.VK)((()=>{const e=(0,O.KV)(p,t);if(e&&(0,C.NK)(e))return e}),[p,t]),h=(0,r.VK)((()=>{const e=p.normalizedSchemaStore.state;return(0,c.qP)(e).flatMap((e=>{let[t,o]=e;return o&&(0,C.gB)(o)?[{id:t,schema:o}]:[]}))}),[p.normalizedSchemaStore]);(0,n.useEffect)((()=>{if(!o&&h.length>0){if(null!=m&&m.connectedRelation.automation)for(const t of h)if(m.connectedRelation.automation[t.id])return void s(t);const e=h[0];s(e)}}),[h,m,o,s]);const[g,S]=(0,n.useState)(X);(0,n.useEffect)((()=>{var e,t;o&&m&&(0,C.NK)(m)&&null!==(e=m.connectedRelation.automation)&&void 0!==e&&e[o.id]?S(null===(t=m.connectedRelation.automation)||void 0===t?void 0:t[o.id]):S(X)}),[m,o]);const y=(0,n.useCallback)((e=>{const n=p.collectionStore();if(!(n&&o&&m&&(0,C.p_)(m)))return;const i=m.connectedRelation;if(!i||!o.id)return;i.automation={...i.automation,...e};const r={...m,connectedRelation:{...i}};T.$q({environment:a,collectionContextStore:p,property:o.id,from:"github_pull_requests_property",action:"configure_github_pr_automation",githubAutomationConfigured:e}),R.createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomation",environment:a,perform:e=>{A.xO({environment:a,collectionStore:n,update:{[t]:r},transaction:e})}})}),[p,o,m,a,t]),v=(0,r.VK)((()=>o&&o.schema.options?o.schema.options:[]),[o]),b=(0,r.VK)((()=>{const e={};return v.forEach((t=>{e[t.id]=t})),e}),[v]),j=(0,r.VK)((()=>{var e,t;const n=null==o||null===(e=o.schema)||void 0===e?void 0:e.groups,i=null==o||null===(t=o.schema)||void 0===t?void 0:t.options;return n&&i?n.map((e=>{const t=i.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));if(0!==t.length)return{group:e,groupOptions:t}})).filter(c.$K):[]}),[o]);function _(e,t){const n=j.map((t=>{let{group:n,groupOptions:i}=t;const r=i.map((t=>({key:t.id,render:e=>(0,H.jsx)(K.Z,{...e,focused:e.focused,isTokenTitle:!0,title:(0,H.jsx)($.F,{format:w.lo.Small,value:t.value,color:t.color,showRemoveButton:!1,groupColor:n.color,isSingle:!0})}),action:()=>{const n={...g,[e]:t.id};o&&(y({[o.id]:n}),S(n))}}))).filter(c.$K);return{key:n.name,render:e=>(0,H.jsx)(f.Z,{...e,title:n.name,topBorder:e.index>0}),items:r}}));if(g[e]){function i(){const n={...g,[e]:null};o&&(y({[o.id]:n}),S(n)),t.close()}const r={key:"removeOptionSection",render:e=>(0,H.jsx)(f.Z,{...e,topBorder:!0}),items:[{key:"removeOptionButton",render:e=>(0,H.jsx)(K.Z,{...e,focused:!1,title:l.formatMessage(G.removeStatusOption),left:(0,k.y)({width:12}),onClick:i}),action:e=>{i()}}]};n.push(r)}return n}return o?(0,H.jsx)(f.Z,{topBorder:!1,disableDesktopPadding:!0,disableMobilePadding:!0,title:(0,H.jsx)(te,{selectedStatusProperty:o,setSelectedStatusProperty:s,existingStatusProperties:h,intl:l}),children:(0,c.Yd)(M).map((e=>(0,H.jsx)(q.Z,{focused:!1,placementToOrigin:L.pO.Top,alignmentToOrigin:L.vR.End,popupType:d.isMobile?L.Z4.SlideUp:L.Z4.Popup,render:t=>{const o=d.isMobile?{menuType:B.og.Modal,right:(0,H.jsx)(z.DoneMenuText,{}),onClickRight:t.close}:{menuType:B.og.Popup,width:150};return(0,H.jsx)(U.Z,{...o,children:(0,H.jsx)(W.Z,{type:W.i.Vertical,sections:_(e,t),initialFocus:void 0,onAccept:t.close})})},renderOrigin:t=>{const n=g[e];let i=(0,H.jsx)("div",{style:u.noneText,children:Q});if(n){const e=b[n];if(e){var r;const t=null==o||null===(r=o.schema)||void 0===r||null===(r=r.groups)||void 0===r||null===(r=r.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(n)})))||void 0===r?void 0:r.color;i=(0,H.jsx)($.F,{format:w.lo.Small,showRemoveButton:!1,isSingle:!0,value:e.value,color:e.color,groupColor:t})}}return(0,H.jsx)(D.Z,{...t,focused:!1,icon:()=>(0,H.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"flex-start",whiteSpace:"nowrap"},children:[Y[e],(0,H.jsx)(x.Z,{size:8}),(0,I.n)(u.automationMenuItemArrow)]}),title:(0,H.jsx)("div",{style:{width:"100%",display:"inline-flex",justifyContent:"flex-end"},children:i}),showChevron:!0,chevronStyle:{margin:0}})}},e)))}):(0,H.jsx)(ee,{setSelectedStatusProperty:s,intl:l})}function ee(e){window.__c={n:"AddStatusProperty"};const{setSelectedStatusProperty:t,intl:o}=e,n=(0,i.O7)(),r=(0,Z.Y$)(),s=ne();return(0,H.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,H.jsx)(E.Z,{size:"100%",innerStyle:s.addStatusDivider}),(0,H.jsx)("div",{style:s.addStatusDescription,children:o.formatMessage(G.addStatusDescription)}),(0,H.jsxs)(N.Z,{style:s.addStatusButton,onClick:e=>{e.stopPropagation(),oe(n,r,t)},children:[(0,P.R)({width:14}),(0,H.jsx)(x.Z,{size:4}),o.formatMessage(G.addStatusButton)]}),(0,H.jsx)(x.Z,{size:4})]})}function te(e){window.__c={n:"GithubStatusPropertyPicker"};const{selectedStatusProperty:t,setSelectedStatusProperty:o,existingStatusProperties:n,intl:r}=e,l=(0,i.O7)(),a=(0,Z.Y$)(),p=(0,i.Fy)(),d=ne(),u=(0,s.Fg)(),m=n.map((e=>{const{id:t,schema:n}=e;return{key:t,action:()=>{o(e)},render:t=>(0,H.jsx)(K.Z,{...t,icon:(0,H.jsx)(b.ZP,{size:14,theme:u,icon:e&&e.schema.icon,type:"status"}),title:n.name})}})).filter(c.$K),h={key:"newStatusProperty",action:()=>{oe(l,a,o)},render:e=>(0,H.jsx)(K.Z,{...e,icon:(0,P.R)(d.statusPickerIcon),title:r.formatMessage(G.newStatusPropertyButton)})};return(0,H.jsxs)("div",{style:d.statusPickerWrapper,children:[(0,H.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[r.formatMessage(G.autoUpdate),p.isMobile&&(0,H.jsx)(x.Z,{size:4}),(0,H.jsx)(L.ZP,{placementToOrigin:L.pO.Bottom,alignmentToOrigin:L.vR.Start,popupType:p.isMobile?L.Z4.SlideUp:L.Z4.Popup,renderOrigin:e=>(0,H.jsx)(K.Z,{...e,title:t.schema.name,focused:!1,style:d.statusPickerButtonCore,textWrapperStyle:d.statusPickerButtonTextWrapper,left:(0,H.jsx)(b.ZP,{size:14,theme:u,icon:t.schema.icon,type:"status"}),leftStyle:{marginLeft:2},showExtensionArrow:!0,extensionArrowStyle:d.statusPickerExtensionArrow}),render:e=>{const t=p.isMobile?{menuType:B.og.ActionSheet}:{menuType:B.og.Popup,width:150};return(0,H.jsx)(U.Z,{...t,children:(0,H.jsx)(W.Z,{type:W.i.Vertical,sections:[{key:0,render:e=>(0,H.jsx)(f.Z,{...e}),items:[...m,h]}],initialFocus:0,onAccept:e.close})})}})]}),p.isMobile&&(0,H.jsx)(x.Z,{size:4}),r.formatMessage(G.when)]})}function oe(e,t,o){const n=t.collectionStore();n&&R.createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomationCreateNewStatusProperty",environment:e,perform:i=>{const r=F.G3({environment:e,collectionStore:n,collectionViewArgs:void 0,propertyType:"status",transaction:i}),s=(0,O.KV)(t,r);s&&(0,C.gB)(s)&&o({id:r,schema:s})}})}function ne(){const e=(0,i.Fy)().isMobile;return(0,s.yK)((t=>({addStatusDivider:{borderColor:t.tableDividerColor},addStatusDescription:{width:"calc(100% - 24px)",padding:e?"16px 8px":"14px 0px",fontSize:e?16:12,color:t.lightTextColor},addStatusButton:{width:"calc(100% - 24px)",display:"inline-flex",alignItems:"center",justifyContent:"center"},noneText:{color:t.lightTextColor},automationMenuItemArrow:{width:12,fill:t.lightIconColor,stroke:t.lightIconColor,strokeOpacity:.5,strokeWidth:2},statusPickerWrapper:{display:"inline-flex",alignItems:"center",flexWrap:"wrap",rowGap:2,marginBottom:e?10:void 0},statusPickerButtonTextWrapper:{margin:"0px 4px",fontSize:12},statusPickerButtonCore:{minHeight:e?28:20,borderRadius:5,maxWidth:e?150:100},statusPickerIcon:{width:14,height:14},statusPickerExtensionArrow:{transform:"rotate(180deg)",marginRight:2}})),[e])}var ie=o(49122);const re=(0,p.defineMessages)({tabTitle:{defaultMessage:"GitHub Pull Requests",id:"database.viewSettings.githubConfigTab.tabTitle"},connect:{defaultMessage:"Connect to GitHub (Workspace)",id:"database.viewSettings.githubConfigTab.connect"},connectDescriptionAdmin:{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) connection.",id:"database.viewSettings.githubConfigTab.connectDescriptionAdmin"},authError:{defaultMessage:"Auth failed. Please try again or contact Notion support.",id:"database.viewSettings.githubConfigTab.authError"},tabDescriptionNoIdPrefix:{defaultMessage:"This feature requires a prefixed ID property to link GitHub PRs to Notion {pluralItemName}.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoIdPrefix"},tabDescriptionNoStatus:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoStatus"},tabDescription:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title. Set up automated status updates in Notion based on PR status changes.",id:"database.viewSettings.githubConfigTab.tabDescription"}});function se(e){let{collectionContextStore:t,intl:o}=e;window.__c={n:"UnauthedFallback"};const n=he(),{hoveredBackground:s,pressedBackground:l}=me(),a=(0,g.J)(),c=(0,i.O7)(),p=ue(),h=function(e){return(0,r.VK)((()=>{var t;return null===(t=e.collectionStore())||void 0===t?void 0:t.getSpaceId()}),[e])}(t);return(0,H.jsxs)(f.Z,{disableMobileBorders:!0,mobileStyle:n.previewContentContainer,style:n.previewContentContainer,children:[(0,H.jsx)("img",{src:"/images/external_integrations/github-icon.png",style:{width:36,height:36}}),(0,H.jsx)("p",{style:n.connectDescription,children:a?(0,m.GT)().description:o.formatMessage(re.connectDescriptionAdmin)}),(0,H.jsx)(y.Z,{style:n.connectButton,hoveredStyle:{background:s},pressedStyle:{background:l},disabled:!a,disabledFeedback:!a,onClick:async e=>{if(e.preventDefault(),h&&p)try{await u.hM({environment:c,spaceId:h,integration:p,from:"connected_relation_property_menu"})}catch(t){const e=o.formatMessage(re.authError);d.showErrorMessage(e)}},children:o.formatMessage(re.connect)}),(0,H.jsx)(x.Z,{size:4})]})}function le(e){let{collectionContextStore:t}=e;window.__c={n:"UserEducationSection"};const o=he(),{isMobile:n}=(0,i.Fy)(),r=de(t);return(0,H.jsxs)(f.Z,{disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,mobileStyle:o.previewContentContainer,style:o.previewContentContainer,children:[(0,H.jsx)(x.Z,{size:n?16:8}),(0,H.jsx)(ie.Z,{width:"calc(100% - 24px)",uniqueIdPrefix:null==r?void 0:r.prefix})]})}function ae(e){let{collectionContextStore:t,intl:o,selectedStatusProperty:n}=e;window.__c={n:"DescriptionSection"};const i=(0,r.VK)((()=>t.databaseType),[t]),s=de(t),l=he(),a=(0,h.sN)(i),c=(0,h.Q_)(i);let p;return p=s&&s.prefix?n?o.formatMessage(re.tabDescription,{singleItemName:a}):o.formatMessage(re.tabDescriptionNoStatus,{singleItemName:a}):o.formatMessage(re.tabDescriptionNoIdPrefix,{pluralItemName:c}),(0,H.jsx)(f.Z,{disableMobileBorders:!0,disableMobilePadding:!0,mobileStyle:l.tabDescription,style:l.tabDescription,children:p})}function ce(e){let{collectionContextStore:t}=e;window.__c={n:"UniqueIdSection"};const o=de(t);return o&&o.prefix?null:(0,H.jsx)(v.Z,{collectionContextStore:t,uniqueIdProperty:o&&{propertyId:o.id,propertySchema:o.schema},prefixValue:null==o?void 0:o.prefix})}function pe(e){let{collectionContextStore:t,selectedStatusProperty:o,setSelectedStatusProperty:n,property:i,intl:r}=e;window.__c={n:"AutomationConfigSection"};const s=de(t);return s&&s.prefix?(0,H.jsx)(J,{selectedStatusProperty:o,setSelectedStatusProperty:n,gitHubProperty:i,intl:r}):null}function de(e){return(0,r.VK)((()=>{var t,o;const n=null===(t=e.collectionStore())||void 0===t||null===(t=t.getRecordKeyStore())||void 0===t?void 0:t.getRecordKey(),i=null===(o=e.collectionStore())||void 0===o?void 0:o.getSchema(),r=i&&(0,c.qP)(i).find((e=>{let[,t]=e;return t&&"auto_increment_id"===t.type}));if(r){const[e,t]=r;if(t&&"auto_increment_id"===t.type)return{id:e,schema:t,prefix:n}}}),[e])}function ue(){return(0,r.VK)((()=>S.Z.integrations.state.find((e=>e.id===l.U9))),[])}function me(){const e=ue(),t=(0,s.Fg)();return(0,r.VK)((()=>(0,a.d)(e,t.mode)),[e,t.mode])}function he(){const{isMobile:e}=(0,i.Fy)(),{background:t}=me();return(0,s.yK)((o=>({previewContentContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},connectButton:{fontSize:14,maxWidth:"calc(100% - 24px)",height:void 0,color:o.regularInvertedTextColor,background:t,whiteSpace:"normal",padding:8,textAlign:"center"},connectDescription:{maxWidth:"calc(100% - 24px)",color:o.lightTextColor,fontSize:14,textAlign:"center"},tabDescription:{padding:e?18:14,fontSize:e?16:12,color:o.lightTextColor}})),[e,t])}const ge=(0,p.injectIntl)((function(e){window.__c={n:"CollectionSettingsGithubConfig"};const{collectionContextStore:t,property:o,intl:i}=e,[s,a]=(0,n.useState)(void 0);return(0,r.VK)((()=>{const e=S.Z.bots.state.find((e=>e.integration_id===l.U9));return Boolean(e)}),[])?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(le,{collectionContextStore:t}),(0,H.jsx)(ae,{collectionContextStore:t,intl:i,selectedStatusProperty:s}),(0,H.jsx)(ce,{collectionContextStore:t}),(0,H.jsx)(pe,{collectionContextStore:t,selectedStatusProperty:s,setSelectedStatusProperty:a,property:o,intl:i})]}):(0,H.jsx)(se,{collectionContextStore:t,intl:i})}))},49122:(e,t,o)=>{o.d(t,{Z:()=>p});o(67294);var n=o(480),i=o(24405),r=o(41892),s=o(82990),l=o(68939),a=o(32662),c=o(85893);function p(e){window.__c={n:"CollectionSettingsGithubPrTaskPreview"};const t=(0,l.useIntl)(),o=function(e){const{isMobile:t}=(0,n.Fy)(),o=t?18:14,r=1,l=6,a=20;return(0,i.yK)((t=>({githubContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:e||"90%",padding:a,border:`${r}px solid ${t.tableDividerColor}`,borderRadius:l,borderBottomRightRadius:4,cursor:"default"},githubPrTitleRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",width:`calc(100% + ${a}px)`,overflow:"hidden"},githubPrTitle:{display:"inline-flex",fontSize:o,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",background:t.whiteButtonBackground,padding:"2px 4px",borderTopLeftRadius:5,borderBottomLeftRadius:5,borderLeft:`2px solid ${t.blueColor}`,borderTop:`2px solid ${t.blueColor}`,borderBottom:`2px solid ${t.blueColor}`,width:"100%"},githubTask:{background:"light"===t.mode?t.accentColors.blue[50]:t.accentColors.blue[400]},githubPrInfoRow:{display:"inline-flex"},githubPrInfoPill:{display:"flex",flexDirection:"row",alignItems:"center",width:"fit-content",padding:"4px 10px",borderRadius:"2em",background:"#238636",flexShrink:0,...s.Z.textOverflowStyle},githubPrInfoOpenText:{color:"white",fontSize:o-2,fontWeight:500},githubPrInfoMergeInto:{display:"inline-flex",alignItems:"center",fontSize:o-2,color:t.lightTextColor,...s.Z.textOverflowStyle},githubPrInfoMain:{padding:"0px 4px",fontFamily:s.Z.baseFontFamily.githubMono,background:t.cardPressedBackground,borderRadius:l,color:t.regularTextColor,verticalAlign:"text-bottom",...s.Z.textOverflowStyle}})),[o,e])}(e.width),p=(0,c.jsx)("div",{id:"github-preview-github-pr-title-row",style:o.githubPrTitleRow,children:(0,c.jsxs)("div",{id:"github-preview-github-pr-title-wrapper",style:o.githubPrTitle,children:[(0,c.jsx)(a.Z,{size:2}),"[",(0,c.jsxs)("div",{id:"github-preview-github-pr-task",style:o.githubTask,children:[e.uniqueIdPrefix||t.formatMessage(d.idPrefix),e.uniqueIdValue?`-${e.uniqueIdValue}`:"-1"]}),"]",(0,c.jsx)(a.Z,{size:2}),t.formatMessage(d.prTitle)]})}),u=(0,c.jsxs)("div",{id:"github-preview-github-pr-info-row",style:o.githubPrInfoRow,children:[(0,c.jsxs)("div",{id:"github-preview-github-open-pr-pill",style:o.githubPrInfoPill,children:[(0,c.jsx)("img",{src:r.Z.images.externalIntegrations.githubPullOpenIconWhitePng,style:{width:16,height:16}}),(0,c.jsx)(a.Z,{size:2}),(0,c.jsx)("div",{style:o.githubPrInfoOpenText,children:t.formatMessage(d.open)})]}),(0,c.jsx)(a.Z,{size:8}),(0,c.jsx)("div",{id:"github-preview-github-merge-into-main",style:o.githubPrInfoMergeInto,children:(0,c.jsxs)("span",{style:o.githubPrInfoMergeInto,children:[t.formatMessage(d.mergeInto),(0,c.jsx)(a.Z,{size:4}),(0,c.jsx)("span",{style:o.githubPrInfoMain,children:t.formatMessage(d.main)})]})})]});return(0,c.jsxs)("div",{id:"github-preview-github-container",style:o.githubContainer,children:[p,(0,c.jsx)(a.Z,{size:12}),u]})}const d=(0,l.defineMessages)({dismissButtonAriaLabel:{defaultMessage:"A button to dismiss the user education preview.",id:"database.viewSettings.githubConfigTab.preview.dismissButtonAriaLabel"},idPrefix:{defaultMessage:"TASK",id:"database.viewSettings.githubConfigTab.preview.idPrefix"},prTitle:{defaultMessage:"GitHub PR Title",id:"database.viewSettings.githubConfigTab.preview.prTitle"},open:{defaultMessage:"Open",id:"database.viewSettings.githubConfigTab.preview.open"},mergeInto:{defaultMessage:"Merge into",id:"database.viewSettings.githubConfigTab.preview.mergeInto"},main:{defaultMessage:"main",id:"database.viewSettings.githubConfigTab.preview.main"}})},65569:(e,t,o)=>{o.d(t,{Hy:()=>l,kK:()=>s,yg:()=>r});var n=o(92996),i=o(16732);function r(e){if(!e)return;if("aggregation"!==e.type)return;if("text"!==e.aggregationResult.type)return;const t=e.aggregationResult.value,o=null==t?void 0:t.split("/");if(!o||2!==o.length)return;const n=Number(o[0]),i=Number(o[1]);return{completedTaskCount:n,incompleteTaskCount:i-n,totalTaskCount:i,completedTaskPercent:0===i?0:n/i}}function s(e){if(!e)return;const t=e.getPropertyMapping(),o=null==t?void 0:t[n.Es.TaskToSprintRelation];if(!o)return;return i.Ws.filter.property=o,{...i.Ws.filter,property:o}}function l(e){var t;if(!e)return;const o=e.getPropertyMapping(),i=s(e);if(!i)return;const r=null==o?void 0:o[n.Es.Status];if(!r)return;const l=e.getSchema()[r];if(!l||"status"!==l.type)return;const a=null===(t=l.groups)||void 0===t||null===(t=t.find((e=>(null==e?void 0:e.id)===n.uS)))||void 0===t?void 0:t.name;return a?{type:"aggregation",filter:{operator:"and",filters:[i]},aggregation:{aggregator:{operator:"count_per_group",groupName:a},property:r}}:void 0}},12205:(e,t,o)=>{o.d(t,{J:()=>r});var n=o(86628),i=o(80444);function r(){const{currentSpaceStore:e}=(0,n.Kw)(i.default);return(0,n.VK)((()=>(null==e?void 0:e.canAdmin())??!1),[e])}},67695:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(35431);class i extends n.Z{findTableHeaderCell(e,t){return this.find((o=>o.props.collectionContextStore===e&&o.props.property===t))}}const r=new i},29109:(e,t,o)=>{o.d(t,{d:()=>i});var n=o(84939);function i(e,t){const{r:o,g:i,b:r}=(null==e?void 0:e.info.accent_color)||{r:0,g:0,b:0},s=`rgba(${o},${i},${r},${"dark"===t?.6:1})`;return{background:s,hoveredBackground:(0,n._j)(s,.4),pressedBackground:(0,n._j)(s,.9)}}},40591:e=>{e.exports=function(e,t,o){var n=(o=o||{}).marker||":",i=n.charCodeAt(0),r=n.length,s=o.validate||function(e){return e.trim().split(" ",2)[0]===t},l=o.render||function(e,o,n,i,r){return 1===e[o].nesting&&e[o].attrJoin("class",t),r.renderToken(e,o,n,i,r)};e.block.ruler.before("fence","container_"+t,(function(e,o,l,a){var c,p,d,u,m,h,g,S,y=!1,f=e.bMarks[o]+e.tShift[o],x=e.eMarks[o];if(i!==e.src.charCodeAt(f))return!1;for(c=f+1;c<=x&&n[(c-f)%r]===e.src[c];c++);if((d=Math.floor((c-f)/r))<3)return!1;if(c-=(c-f)%r,u=e.src.slice(f,c),m=e.src.slice(c,x),!s(m,u))return!1;if(a)return!0;for(p=o;!(++p>=l)&&!((f=e.bMarks[p]+e.tShift[p])<(x=e.eMarks[p])&&e.sCount[p]<e.blkIndent);)if(i===e.src.charCodeAt(f)&&!(e.sCount[p]-e.blkIndent>=4)){for(c=f+1;c<=x&&n[(c-f)%r]===e.src[c];c++);if(!(Math.floor((c-f)/r)<d||(c-=(c-f)%r,(c=e.skipSpaces(c))<x))){y=!0;break}}return g=e.parentType,S=e.lineMax,e.parentType="container",e.lineMax=p,(h=e.push("container_"+t+"_open","div",1)).markup=u,h.block=!0,h.info=m,h.map=[o,p],e.md.block.tokenize(e,o+1,p),(h=e.push("container_"+t+"_close","div",-1)).markup=e.src.slice(f,c),h.block=!0,e.parentType=g,e.lineMax=S,e.line=p+(y?1:0),!0}),{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules["container_"+t+"_open"]=l,e.renderer.rules["container_"+t+"_close"]=l}}}]);