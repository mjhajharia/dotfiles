"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[1166],{3992:(e,t,o)=>{o.r(t),o.d(t,{addRecurrence:()=>g,createRecurrenceInner:()=>h,disableRecurrence:()=>y});var r=o(40506),n=o(4615),i=o(98963),a=o(18844),s=o(6287),l=o(80444),c=o(26350),p=o(50906),d=o(96802),u=o(9953),m=o(39699);function g(e){let{environment:t,blockStore:o,recurrence:l}=e;const d=o.getAutomationId(),g=function(e){return{...e,start_date:(0,r.Io)(new Date(e.start_date))}}(l);d?function(e,t,o,r){const l=o.getParentStore();if(!l||l.table!==s.v)return;const d=o.getSpaceId(),g={table:i.cv,id:t,spaceId:d},y=c.Mz.createChildStore(o,g),h=y.getTrigger();if(!h)return;const v=y.getActionStores()[0];m.createAndCommit({environment:e,userAction:"recurrenceActions.updateRecurrence",perform:t=>{const i=f({automationId:y.id,spaceId:d,collectionPointer:l.getSpaceShardedPointer(),templatePageId:o.id});let s;v?(s=v.id,u.sW({store:v,data:i,transaction:t})):(s=(0,n.ZP)(),u.ae({environment:e,table:a.Xj,inMemoryRecordCache:y.inMemoryRecordCache,transaction:t,value:{id:s,...i}})),u.sW({store:y,data:{status:"active",trigger:{id:h.id,type:"recurrence",recurrence:r},action_ids:[s]},transaction:t})}}),p.h$X(e,{type:"updated",frequency:r.frequency})}(t,d,o,g):function(e,t,o){m.createAndCommit({environment:e,userAction:"recurrenceActions.createRecurrence",perform:r=>{h(r,e,t,o)}})}(t,o,g)}function y(e){let{environment:t,blockStore:o}=e;const r=o.getAutomationId();if(!r)return;const n={table:i.cv,id:r,spaceId:o.getSpaceId()};m.createAndCommit({environment:t,userAction:"recurrenceActions.disableRecurrence",perform:e=>{u.sW({store:(0,c.Kv)(o,n),data:{status:"disabled",run_at:void 0},transaction:e})}}),p.h$X(t,{type:"disabled"})}function h(e,t,o,r){const{currentUserRootStore:c}=l.default.state;if(!c)return;const m=o.getParentStore();if(!m||m.table!==s.v)return;if(!m.getParentBlockStore())return;const g=o.getSpaceId(),y=(0,n.ZP)(),h=(0,n.ZP)();u.ae({environment:t,table:i.cv,inMemoryRecordCache:o.inMemoryRecordCache,value:{id:y,parent_id:o.id,parent_table:o.table,alive:!0,space_id:g,status:"active",trigger:{id:(0,n.ZP)(),type:"recurrence",recurrence:r},action_ids:[h]},transaction:e}),d.FH({stores:[o],update:{automation_id:y},transaction:e}),u.ae({environment:t,table:a.Xj,inMemoryRecordCache:o.inMemoryRecordCache,transaction:e,value:{id:h,...f({automationId:y,spaceId:g,collectionPointer:m.getSpaceShardedPointer(),templatePageId:o.id})}}),p.h$X(t,{type:"created",frequency:r.frequency})}function f(e){const{automationId:t,spaceId:o,collectionPointer:r,templatePageId:n}=e;return{parent_id:t,parent_table:i.cv,type:"create_page",alive:!0,space_id:o,config:{collection:r,template_page_id:n}}}},64973:(e,t,o)=>{o.d(t,{mv:()=>k,pW:()=>P,rn:()=>C});var r=o(67294),n=o(480),i=o(6740),a=o(37989),s=o(86628),l=o(24405),c=o(25651),p=o(37612),d=o(77744),u=o(97880),m=o(68939),g=o(64921),y=o(52275),h=o(78140),f=o(32163),v=o(72495),S=o(61766),x=o(95193),M=o(74197),b=o(85893);function P(e){window.__c={n:"AutomationBaseStepElement"};const{icon:t,onBlur:o,onClick:c,onFocus:p,onMouseDown:u,onMouseEnter:m,onMouseLeave:y,title:h,caption:f,onEdit:v,onDelete:x,disabled:M}=e,{isMobile:P}=(0,n.Fy)(),[C,_]=(0,i.Z)(),[w,T]=(0,a.Z)(),[j,I]=(0,r.useState)(!1),V=j||_||T,R=(0,d.lq)(C,w),A=(0,s.qz)(void 0,S.Z),Z=(0,l.yK)((e=>({button:{position:"relative"},moreButtonWrap:{display:V||P?"block":"none",position:"absolute",right:12,top:14},container:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:8,justifyContent:"center",paddingBlock:16,paddingInline:12},title:{alignItems:"center",display:"flex",flexDirection:"row",gap:6},iconWrap:{flexShrink:0,alignSelf:"baseline",height:"24px",display:"flex",alignItems:"center"},iconStyle:{width:16,height:16,color:e.mediumIconColor},body:{flex:"1 1 auto",fontSize:14,lineHeight:1.3,minWidth:0,whiteSpace:"pre"}})),[V,P]),E=(0,r.useCallback)((e=>{I(!0),m&&m(e)}),[m]),N=(0,r.useCallback)((e=>{I(!1),y&&y(e)}),[y]);return(0,b.jsxs)(g.Z,{onBlur:o,onClick:()=>{null==c||c(A)},onFocus:p,onMouseDown:u,onMouseEnter:E,onMouseLeave:N,style:Z.button,disabled:M,disabledFeedback:M,ref:R,focused:V,children:[!M&&(v||x)&&(0,b.jsx)("div",{style:Z.moreButtonWrap,children:(0,b.jsx)(k,{onEdit:v,onDelete:x,disabled:M,buttonPopupStore:A})}),(0,b.jsxs)("div",{style:Z.container,children:[(0,b.jsxs)("div",{style:Z.title,children:[t&&(0,b.jsx)("div",{"aria-hidden":"true",style:Z.iconWrap,children:t(Z.iconStyle)}),(0,b.jsx)("div",{style:Z.body,children:h})]}),f]})]})}function k(e){window.__c={n:"MoreActionsButton"};const{onDelete:t,onEdit:o,disabled:n,buttonPopupStore:i}=e,a=(0,s.qz)(i,S.Z),l=(0,r.useCallback)((()=>a.setState({open:!1})),[a]),c=(0,r.useMemo)((()=>(0,b.jsx)(C,{onClose:l,onEdit:o,onDelete:t})),[l,t,o]);return(0,b.jsx)(M.f,{actionMenu:c,buttonPopupStore:a,disabled:n})}function C(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,onEdit:o,onDelete:r}=e,n=(0,x.F)(),i=[o?{action:()=>{null==t||t(),o()},key:"edit",render:e=>(0,b.jsx)(y.Z,{...e,icon:(0,c.R)({height:16,width:16}),title:(0,b.jsx)(m.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.edit",defaultMessage:"Edit"})})}:void 0,r?{action:()=>{null==t||t(),r()},key:"delete",render:e=>(0,b.jsx)(y.Z,{...e,icon:(0,p.y)({height:16,width:16}),title:(0,b.jsx)(m.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.delete",defaultMessage:"Delete"})})}:void 0].filter(u.$K);return(0,b.jsx)(h.Z,{...n,children:(0,b.jsx)(f.Z,{type:f.i.Vertical,sections:[{items:i,key:"items",render:e=>(0,b.jsx)(v.Z,{enableActionSheetTitle:!0,topBorder:!0,...e})}],initialFocus:0})})}},93060:(e,t,o)=>{o.d(t,{y:()=>s});var r=o(67294),n=o(24405),i=o(26388),a=o(85893);function s(e){window.__c={n:"AutomationTriggerActionTooltip"};const{caption:t,disable:o,renderOrigin:s,title:l,tooltipAlignment:c,tooltipPlacement:p}=e,d=(0,n.yK)((e=>({tooltipTitle:{margin:0},tooltipCaption:{color:e.mediumInvertedTextColor,margin:0}})),[]),u=(0,r.useCallback)((()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{style:d.tooltipTitle,children:l}),(0,a.jsx)("p",{style:d.tooltipCaption,children:t})]})),[t,l,d.tooltipCaption,d.tooltipTitle]);return(0,a.jsx)(i.Z,{alignment:c,delayThreshold:800,disableTooltip:o,placement:p,render:s,renderTooltip:u,textWrap:!0})}},44257:(e,t,o)=>{o.d(t,{T:()=>X});o(21703);var r=o(67294),n=o(86628),i=o(24405),a=o(68939),s=o(26388),l=o(61766),c=o(9015);function p(){const{automationStore:e,...t}=(0,r.useContext)(c.Z);if(!e)throw new Error("automationStore is undefined. Is this rendered inside an AutomationEditorContext.Provider?");return{...t,automationStore:e}}var d=o(64973),u=o(93060),m=o(480),g=o(6740),y=o(37989),h=o(77744),f=o(98104),v=o(64921),S=o(75024);function x(){const e=(0,r.useRef)(null),[t,o]=(0,r.useState)(!1),n=(0,r.useCallback)((()=>{const t=e.current;t&&o(t.matches(":hover"))}),[]),i=(0,r.useCallback)((t=>{e.current=t,n()}),[n]);return(0,r.useEffect)((()=>{const t=e.current;if(t)return t.addEventListener("mouseenter",n),t.addEventListener("mouseleave",n),()=>{t.removeEventListener("mouseenter",n),t.removeEventListener("mouseleave",n)}}),[n]),[i,t]}var M=o(73266),b=o(74197),P=o(85893);function k(e){window.__c={n:"BaseStepLabel"};const{actionMenu:t,buttonPopupStore:o,children:r,disabled:i,icon:a,onClick:s,onMouseDown:c,onMouseEnter:p,onMouseLeave:d,subtitle:u,styles:g}=e,{isMobile:f}=(0,m.Fy)(),v=(0,n.qz)(o,l.Z),[S,k]=(0,y.Z)(),[C,_]=x(),T=(0,n.VK)((()=>v.getState()),[v]),j=f||_||k||T.open,I=w({disabled:i,hasActionMenu:Boolean(t),isActionMenuVisible:j,overrideStyles:g}),V=(0,M.Z)(),R=(0,h.lq)(S,C);return(0,P.jsxs)("div",{onClick:s,onMouseDown:c,onMouseEnter:p,onMouseLeave:d,ref:R,style:I.componentWrap,children:[(0,P.jsxs)("div",{style:I.headerWrap,children:[!V&&a&&(0,P.jsx)("div",{"aria-hidden":"true",style:I.iconWrap,children:a(I.icon)}),(0,P.jsx)("div",{style:I.titleWrap,children:r})]}),u&&(0,P.jsx)("div",{style:I.subtitleWrap,children:u}),t&&(0,P.jsx)("div",{style:I.actionMenuWrap,children:(0,P.jsx)(b.f,{actionMenu:t,buttonPopupStore:v,disabled:i})})]})}const C={overflow:"hidden",position:"relative"};function _(e){window.__c={n:"BaseStepButton"};const{actionMenu:t,buttonPopupStore:o,children:r,disabled:i,icon:a,onBlur:s,onClick:c,onFocus:p,onMouseDown:d,onMouseEnter:u,onMouseLeave:S,styles:k,subtitle:_}=e,{isMobile:T}=(0,m.Fy)(),[j,I]=(0,g.Z)(),[V,R]=(0,y.Z)(),[A,Z]=x(),E=(0,n.qz)(o,l.Z),N=(0,n.VK)((()=>E.getState()),[E]),F=(0,h.lq)(A,V),W=T||Z||I||R||N.open;(0,n.VK)((()=>{N.open||f.sD()}),[N]);const B=w({disabled:i,hasActionMenu:Boolean(t),isActionMenuVisible:W,overrideStyles:k}),D=(0,M.Z)();return(0,P.jsxs)("div",{ref:F,style:C,children:[(0,P.jsxs)(v.Z,{disabled:i,disabledFeedback:i,hovered:Z,ignoreLocalHoverState:!0,onBlur:s,onClick:c,onFocus:p,onMouseDown:d,onMouseEnter:u,onMouseLeave:S,ref:j,style:B.componentWrap,children:[(0,P.jsxs)("div",{style:B.headerWrap,children:[!D&&a&&(0,P.jsx)("div",{"aria-hidden":"true",style:B.iconWrap,children:a(B.icon)}),(0,P.jsx)("div",{style:B.titleWrap,children:r})]}),_&&(0,P.jsx)("div",{style:B.subtitleWrap,children:_})]}),t&&(0,P.jsx)("div",{style:B.actionMenuWrap,children:(0,P.jsx)(b.f,{actionMenu:t,buttonPopupStore:E,disabled:i})})]})}function w(e){const{disabled:t,hasActionMenu:o,isActionMenuVisible:r,overrideStyles:n}=e;return(0,i.yK)((e=>({componentWrap:{background:e.cardContentBackground,border:`1px solid ${e.stroke.regular}`,display:"flex",flexDirection:"column",gap:12,paddingInline:12,paddingBlock:16,position:"relative",...t?{cursor:"default",opacity:.4}:{},...null==n?void 0:n.componentWrap},headerWrap:{display:"flex",flexDirection:"row",gap:4,marginInlineEnd:o?38:0,...null==n?void 0:n.headerWrap},iconWrap:{flex:"0 0 auto",marginBlockStart:2,...null==n?void 0:n.iconWrap},icon:{fill:e.text.secondary,height:"auto",width:16,...null==n?void 0:n.icon},titleWrap:{alignSelf:"center",flex:"1 1 auto",fontSize:14,lineHeight:1.285,marginBlockStart:1,minWidth:0,whiteSpace:"pre",...null==n?void 0:n.titleWrap},subtitleWrap:{...null==n?void 0:n.subtitleWrap},bodyWrap:{...null==n?void 0:n.bodyWrap},actionMenuWrap:{flex:"0 0 auto",height:26,position:"absolute",right:12,top:14,width:26,...r?{}:S.jy}})),[t,o,r,n])}var T=o(8161),j=o(82990),I=o(56812);const V={debugName:"buttonClicked",getTriggerProps(e){let{intl:t,automationStore:o}=e;if(!o.isTriggerType("button"))return[];const r=t.formatMessage(I.Bo.triggerButtonClicked,{b:R});return[{key:"clickButton",children:r,icon:T.e,tooltip:r}]}};function R(e){return(0,P.jsx)("span",{style:{fontWeight:j.Z.fontWeight.medium},children:e})}var A=o(47453),Z=o(482);const E={debugName:"pageAdded",getTriggerProps(e){let{automationStore:t}=e;return(t.isTriggerType("event")||t.isTriggerType("notification_event"))&&t.getTriggerStore().getKeyStore("event").getKeyStore("pagesAdded").getValue()?[{key:"pageAdded",children:(0,P.jsx)(N,{}),icon:A.R,onDelete(e){e([Z.op.update({args:{pagesAdded:!1},path:["trigger","event"],pointer:t.pointer})])}}]:[]}};function N(){window.__c={n:"PageAddedTriggerTitle"};const e=(0,a.useIntl)(),t=(0,i.yK)((()=>({title:{fontWeight:j.Z.fontWeight.medium}})),[]),o=I.Mz(e);return(0,P.jsx)("div",{style:t.title,children:o})}var F=o(3865),W=o(76205),B=o(52821),D=o(39068);function O(e){let{style:t,propertySchema:o}=e;window.__c={n:"TriggerPropertyIcon"};const r=(0,i.Fg)();return(0,P.jsx)(D.ZP,{size:16,theme:r,icon:o.icon,style:t,type:o.type})}var L=o(80628);function K(e){const{property:t,propertySchema:o}=e;return{key:`propertyEdited:${t}`,children:(0,P.jsx)($,{propertyName:o.name}),icon:e=>(0,P.jsx)(O,{propertySchema:o,style:e}),tooltip:(0,P.jsx)(q,{propertyName:o.name})}}function $(e){let{propertyName:t}=e;window.__c={n:"PropertyEditedTriggerTitle"};const o=(0,a.useIntl)(),r=(0,i.yK)((()=>({propertyName:{...j.Z.textOverflowStyle,fontWeight:j.Z.fontWeight.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),n=I.$G(o,{propertyName:(0,P.jsx)("span",{style:r.propertyName,children:t})});return(0,P.jsx)("span",{style:r.wrap,children:n})}function q(e){let{propertyName:t}=e;window.__c={n:"PropertyEditedTriggerTooltip"};const o=(0,a.useIntl)();return(0,P.jsx)(P.Fragment,{children:I.$G(o,{propertyName:t})})}var z=o(62868),U=o(5909);const H=[V,E,{debugName:"propertyEdited",getTriggerProps(e){const{intl:t,automationStore:o,collectionStore:r}=e;if(!o.isTriggerType("event")&&!o.isTriggerType("notification_event"))return[];const n=o.getTriggerStore().getValue();if(!n)return[];const i=n.event.pagePropertiesEdited;if(!n||"none"===i.type)return[];if("any"===i.type){return[{key:"anyPropertyEdited",children:I.c5(t),icon:A.R}]}const s=null==r?void 0:r.getSchema();return s&&i.some?i.some.map((t=>{let{property:o,filter:r}=t;const n=s[o],l=function(e){const{pagePropertiesEdited:t,automationStore:o,property:r}=e;return{onDelete(e){const n=t.filter((e=>e.property!==r));e([Z.op.update({args:{pagePropertiesEdited:{...t,some:n}},path:["trigger","event"],pointer:o.pointer})])}}}({...e,property:o,pagePropertiesEdited:i.some}),c=function(e){const{collectionStore:t,property:o,propertySchema:r,filter:n}=e;if(!r){var i;const e=null==t||null===(i=t.getDeletedSchema())||void 0===i?void 0:i[o];return{children:(0,P.jsx)(a.FormattedMessage,{id:"deletedPropertyStep.deletedProperty.title",defaultMessage:"{propertyName} property deleted",values:{propertyName:null==e?void 0:e.name}})}}if(!F.Ym[r.type]){const e=B.SO[r.type],t=(0,P.jsx)(a.FormattedMessage,{id:"UnsupportedPropertyTriggerAction.unsupportedProperty.title",defaultMessage:"{propertyType} property not supported",values:{propertyType:e}});return{children:t,tooltip:t}}if("changes_to_any"===n.operator)return K({...e,property:o,propertySchema:r});return function(e){const{propertySchema:t,filter:o}=e;if(!(0,W.vR)(o))return;if("checkbox"===t.type&&(0,W.XA)(o))return(0,L.Ls)({...e,propertySchema:t,filter:o});if("status"===t.type&&(0,W.r2)(o))return(0,U.u)({...e,propertySchema:t,filter:o});if("select"===t.type&&(0,W.dx)(o))return(0,z.T)({...e,propertySchema:t,filter:o});if("multi_select"===t.type&&(0,W.NU)(o))return(0,z.T)({...e,propertySchema:t,filter:o});return}({...e,property:o,propertySchema:r,filter:n})||K({...e,property:o,propertySchema:r})}({...e,property:o,propertySchema:n,filter:r});return{key:`propertyEdited:${o}`,icon:n?e=>(0,P.jsx)(O,{propertySchema:n,style:e}):void 0,...l,...c}})):[]}}];function X(e){window.__c={n:"AutomationTriggerListV2"};const{automationStore:t,collectionStore:o,editorWidth:s}=p(),l=(0,a.useIntl)(),c=(0,i.yK)((()=>({list:{display:"grid",gap:s>500?8:0,gridTemplateColumns:"1fr"}})),[s]),d=(0,n.VK)((()=>H.flatMap((e=>e.getTriggerProps({automationStore:t,collectionStore:o,intl:l})))),[t,o,l]);return(0,P.jsx)("div",{style:c.list,children:d.map(((e,t)=>(0,r.createElement)(G,{...e,key:e.key,isFirst:0===t,isLast:t===d.length-1})))})}function G(e){window.__c={n:"AutomationTriggerListItem"};const{onDelete:t,isFirst:o,isLast:a}=e,{disabled:c,disableTooltip:m,dispatchOperations:g}=p(),y=(0,i.yK)((()=>({componentWrap:{...o?{borderStartStartRadius:6,borderStartEndRadius:6}:{},...a?{borderEndStartRadius:6,borderEndEndRadius:6,borderBottomStyle:"solid"}:{borderBottomStyle:"none"}}})),[o,a]),h=(0,n.qz)(void 0,l.Z),f=(0,r.useCallback)((()=>{if(!t)throw new Error("onDelete is not implemented for trigger");t(g),h.setState({open:!1})}),[h,t,g]),v=(0,r.useMemo)((()=>t?(0,P.jsx)(d.rn,{onDelete:f}):null),[t,f]),S=null!==v,x=(0,r.useCallback)((()=>S&&h.setState({open:!0})),[S,h]),M=(0,r.useCallback)((t=>{const o=S?_:k;return(0,P.jsx)(o,{...t,actionMenu:v,buttonPopupStore:h,disabled:c,icon:e.icon,onClick:x,styles:y,children:e.children})}),[S,v,h,c,e.icon,e.children,x,y]);return(0,P.jsx)(u.y,{disable:m,renderOrigin:M,title:e.tooltip,tooltipAlignment:s.Z.Alignment.Center,tooltipPlacement:s.Z.Placement.Left})}},74197:(e,t,o)=>{o.d(t,{f:()=>u});o(67294);var r=o(480),n=o(24405),i=o(56666),a=o(68939),s=o(31945),l=o(73063),c=o(53437),p=o(85893);const d=(0,a.defineMessages)({moreLabel:{id:"automationBaseStepElement.moreActionsMenu.title",defaultMessage:"More"}});function u(e){window.__c={n:"BaseStepActionsButton"};const{actionMenu:t,disabled:o,buttonPopupStore:u}=e,{device:m}=(0,r.O7)(),g=(0,a.useIntl)(),y=(0,n.yK)((e=>({iconButton:{border:`1px solid ${e.regularDividerColor}`,height:26,width:26},icon:{height:14,width:14}})),[]);return(0,p.jsx)(s.ZP,{alignmentToOrigin:s.vR.Center,buttonPopupStore:u,originGap:0,placementToOrigin:s.pO.Bottom,popupType:m.isMobile?c.kQ.SlideUp:c.kQ.Popup,render:()=>t,renderOrigin:e=>(0,p.jsx)(l.Z,{...e,ariaLabel:g.formatMessage(d.moreLabel),disabled:o,disabledFeedback:o,hasBackground:!0,icon:i.o,iconStyle:y.icon,style:y.iconButton})})}},37867:(e,t,o)=>{o.d(t,{Z:()=>d});o(67294);var r=o(480),n=o(24405),i=o(84619),a=o(54497),s=o(68939),l=o(85567),c=o(56812),p=o(85893);function d(e){let{key:t,tokenFormat:o=i.lo.Medium,isSingle:d,showRemoveButton:u,onClickRemove:m}=e;window.__c={n:"DeletedOptionToken"};const{isMobile:g}=(0,r.Fy)(),y=(0,s.useIntl)(),h=(0,n.yK)((e=>{const t="light"===e.mode?400:800,o="light"===e.mode?50:200,r="light"===e.mode?700:900;return{tokenValueWrap:{display:"inline-flex",gap:"4px",alignItems:"baseline"},warning:{color:e.accentColors.orange[t],height:"auto",width:g?16:14},warningWrap:{alignSelf:"center"},token:{backgroundColor:e.accentColors.yellow[o]},textWrap:{color:e.accentColors.yellow[r]}}}),[g]);return(0,p.jsx)(l.Z,{format:o,isSingle:d??!0,showRemoveButton:u??!1,onClickRemove:m,style:h.token,value:(0,p.jsxs)("span",{style:h.tokenValueWrap,children:[(0,p.jsx)("span",{style:h.warningWrap,children:(0,a.t)(h.warning)}),(0,p.jsx)("span",{style:h.textWrap,children:(0,c.ST)(y)})]})},t)}},80628:(e,t,o)=>{o.d(t,{Ls:()=>p,l4:()=>m,zR:()=>u});o(67294);var r=o(24405),n=o(82990),i=o(68939),a=o(21467),s=o(20776),l=o(56812),c=o(85893);function p(e){const{propertySchema:t,filter:o,intl:r}=e;return{children:(0,c.jsx)(d,{propertySchema:t,filter:o}),tooltip:m({filter:o,intl:r,propertySchema:t})}}function d(e){let{propertySchema:t,filter:o}=e;window.__c={n:"CheckboxPropertyTriggerTitle"};const a=(0,i.useIntl)(),s=(0,r.yK)((()=>({propertyName:{...n.Z.textOverflowStyle,fontWeight:n.Z.fontWeight.medium},wrap:{alignItems:"center",display:"flex",whiteSpace:"pre"}})),[]),l=u({filter:o,intl:a,propertySchema:t,styles:s});return(0,c.jsx)("span",{style:s.wrap,children:l})}function u(e){const{filter:t,intl:o,propertySchema:r,styles:n}=e,i=r.name,a=t.value,s={propertyName:(0,c.jsx)("span",{style:n.propertyName,children:i}),propertyValues:(0,c.jsx)(g,{checkboxValue:a.value??!1})};return(0,l.vz)(o,s)}function m(e){const{filter:t,intl:o,propertySchema:r}=e,n={propertyName:r.name,propertyValues:!0===t.value.value?(0,c.jsx)(i.FormattedMessage,{...l.Bo.actionCheckboxPropertyChecked}):(0,c.jsx)(i.FormattedMessage,{...l.Bo.actionCheckboxPropertyUnchecked})};return(0,l.vz)(o,n)}function g(e){const{checkboxValue:t}=e,o=!0===t?(0,a.c$e)({width:12}):(0,a.UmH)({width:10}),r=!0===t?(0,c.jsx)(i.FormattedMessage,{...l.Bo.actionCheckboxPropertyChecked}):(0,c.jsx)(i.FormattedMessage,{...l.Bo.actionCheckboxPropertyUnchecked});return(0,c.jsx)(s.o,{icon:o,children:r})}},62868:(e,t,o)=>{o.d(t,{T:()=>y,z:()=>f});o(67294);var r=o(24405),n=o(80951),i=o(84619),a=o(97880),s=o(82990),l=o(68939),c=o(22084),p=o(85567),d=o(65380),u=o(56812),m=o(37867),g=o(85893);function y(e){const{filter:t,propertySchema:o,intl:r}=e,n={...s.Z.textOverflowStyle,fontWeight:s.Z.fontWeight.medium},i=t.value,l=o.name,c=f({intl:r,isText:!0,limit:5,optionValues:(Array.isArray(i)?i:[i]).map((e=>e.value)).filter(a.$K),propertySchema:o}),p=r.formatList(c,{style:"long",type:"disjunction"}),m=(0,u.XJ)(r,{propertyName:(0,g.jsx)("span",{style:n,children:l}),propertyValues:(0,d.H)(p)});return{children:(0,g.jsx)(h,{filter:t,propertySchema:o}),tooltip:m}}function h(e){window.__c={n:"SelectPropertyTriggerTitle"};const{filter:t,propertySchema:o}=e,n=(0,l.useIntl)(),i=t.value,c=o.name,p=f({intl:n,limit:5,optionValues:(Array.isArray(i)?i:[i]).map((e=>e.value)).filter(a.$K),propertySchema:o}),m=n.formatList(p,{style:"long",type:"disjunction"}),y=(0,r.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...s.Z.textOverflowStyle,fontWeight:s.Z.fontWeight.semibold}})),[]),h=(0,u.XJ)(n,{propertyName:(0,g.jsx)("span",{style:y.propertyName,children:c}),propertyValues:(0,d.H)(m)});return(0,g.jsx)("div",{style:y.content,children:h})}function f(e){let{intl:t,isText:o,limit:r,optionValues:a,propertySchema:s,tokenFormat:l=i.lo.Medium}=e;const d=s.options??[],y=a.map((e=>{const r=(0,n.i7)(d,e);return r?o?r.value:(0,g.jsx)(c.a,{value:r.value,color:r.color,format:l,isSingle:!0,showRemoveButton:!1},r.id):o?(0,u.ST)(t):(0,g.jsx)(m.Z,{tokenFormat:l},`missing_option_value_${e}`)}));let h;if(void 0!==r&&y.length>r){const e=y.length-r,t=o?`+${e}`:(0,g.jsx)(p.Z,{format:i.lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");h=[...y.slice(0,r),t]}else h=y;return h}},5909:(e,t,o)=>{o.d(t,{L:()=>x,u:()=>f});o(67294);var r=o(24405),n=o(76205),i=o(80951),a=o(84619),s=o(97880),l=o(82990),c=o(68939),p=o(22084),d=o(85567),u=o(65380),m=o(56812),g=o(37867),y=o(85893);const h=5;function f(e){const{intl:t,filter:o,limit:r=h,propertySchema:i}=e,a=i.name,l=(0,n.wB)(o),c=l.map((e=>"is_group"===e.type?e.value:void 0)).filter(s.$K),p=l.map((e=>"is_option"===e.type?e.value:void 0)).filter(s.$K),d=x({intl:t,groupValues:c,limit:r,optionValues:p,propertySchema:i}),u=x({intl:t,isText:!0,groupValues:c,limit:r,optionValues:p,propertySchema:i});return{children:(0,y.jsx)(v,{propertyName:a,statusValues:d}),tooltip:(0,y.jsx)(S,{propertyName:a,statusValues:u})}}function v(e){let{propertyName:t,statusValues:o}=e;window.__c={n:"StatusPropertyTriggerTitle"};const n=(0,c.useIntl)(),i=(0,r.yK)((()=>({propertyName:{...l.Z.textOverflowStyle,fontWeight:l.Z.fontWeight.semibold}})),[]),a=n.formatList(o,{style:"long",type:"disjunction"});return(0,y.jsx)(y.Fragment,{children:(0,m.VO)(n,{propertyName:(0,y.jsx)("span",{style:i.propertyName,children:t}),propertyValues:(0,u.H)(a)})})}function S(e){let{propertyName:t,statusValues:o}=e;window.__c={n:"StatusPropertyTriggerTooltip"};const n=(0,c.useIntl)(),i=(0,r.yK)((()=>({propertyName:{...l.Z.textOverflowStyle,fontWeight:l.Z.fontWeight.semibold}})),[]),a=n.formatList(o,{style:"long",type:"disjunction"});return(0,y.jsx)(y.Fragment,{children:(0,m.VO)(n,{propertyName:(0,y.jsx)("span",{style:i.propertyName,children:t}),propertyValues:(0,u.H)(a)})})}function x(e){let{groupValues:t,intl:o,isText:r,limit:n,optionValues:l,propertySchema:c,tokenFormat:u=a.lo.Medium}=e;const h=c.groups||[],f=c.options||[],v=t.map((e=>{const t=h.find((t=>t.name===e));if(t)return r?t.name:(0,y.jsx)("span",{children:t.name},t.id)})).filter(s.$K),S=l.map((e=>{const t=(0,i.i7)(f,e);if(void 0===t)return r?(0,m.ST)(o):(0,y.jsx)(g.Z,{tokenFormat:u},`missing_option_value_${e}`);if(r)return t.value;const n=h.find((e=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return(0,y.jsx)(p.F,{format:u,isSingle:!0,value:t.value,color:t.color,groupColor:null==n?void 0:n.color,showRemoveButton:!1,showEllipsis:!0},t.id)})),x=[...v,...S];let M=[];if(void 0!==n&&x.length>n){const e=S.length-n,t=r?`+${e}`:(0,y.jsx)(d.Z,{format:a.lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");M=[...S.slice(0,n),t]}else M=x;return M}},9015:(e,t,o)=>{o.d(t,{Z:()=>s,l:()=>l});var r=o(67294),n=o(72126),i=o(33317),a=o(45953);const s=(0,r.createContext)({automationStore:void 0,collectionStore:void 0,disabled:!0,disableTooltip:!1,dispatchOperations:n.ZT,editorWidth:300});function l(e,t,o){return function(r,n){if(!t)return;const s=a.Ak.create();for(const e of o)s.addModel(e);if(n)for(const e of n)s.addModel(e);(0,i.FS)({operations:r,recordMap:s,updateOnly:!1});for(const o of s){const{model:r,pointer:n}=o;e.setModelAndRole({pointer:n,userId:t},r,"editor")}e.emitAll()}}},65380:(e,t,o)=>{o.d(t,{H:()=>n});o(57658),o(67294);var r=o(85893);function n(e){if(!Array.isArray(e))return[e];const t=[];for(const o of e)if("string"==typeof o&&" "!==o[0]){const e=t.pop();t.push((0,r.jsxs)("div",{children:[e,o]}))}else t.push(o);return t}},56812:(e,t,o)=>{o.d(t,{$G:()=>k,Bo:()=>n,Ig:()=>f,Iu:()=>d,Mw:()=>g,Mz:()=>M,NZ:()=>v,Oq:()=>p,S0:()=>u,ST:()=>T,Sj:()=>h,VO:()=>w,XJ:()=>_,aD:()=>x,c5:()=>b,hW:()=>i,ht:()=>l,nf:()=>P,oJ:()=>j,om:()=>m,rf:()=>y,vE:()=>S,vz:()=>C,wE:()=>c,xf:()=>a,zU:()=>s});var r=o(80951);const n=(0,o(68939).defineMessages)({actionCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.action.checkboxProperty.checked"},actionCheckboxPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.checkboxProperty.single"},actionCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.action.checkboxProperty.unchecked"},actionDatePropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.dateProperty.clear"},actionDatePropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.dateProperty.single"},actionPersonPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.personProperty.clear"},actionPersonPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.personProperty.single"},actionPersonPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.personProperty.multiple"},actionRelationPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.relationProperty.clear"},actionRelationPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.relationProperty.multiple"},actionRelationPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.relationProperty.single"},actionSelectPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.selectProperty.clear"},actionSelectPropertySetMultiple:{defaultMessage:"Set {propertyName} to all of {propertyValues}",id:"automations.action.selectProperty.multiple"},actionSelectPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.selectProperty.single"},actionStatusPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.statusProperty.single"},actionTextPropertyClear:{defaultMessage:"Clear {propertyName}",id:"automations.action.textProperty.clear"},actionTextPropertySetSingle:{defaultMessage:"Set {propertyName} to {propertyValue}",id:"automations.action.textProperty.single"},actionDeletedProperty:{defaultMessage:"Edit a deleted property",id:"automations.action.deletedProperty"},triggerAnyPageAdded:{defaultMessage:"Page added",id:"automations.trigger.pageAdded.title"},triggerAnyPagePropertyEdit:{defaultMessage:"Any property edited",id:"automations.trigger.anyPagePropertyEdited.title"},triggerAnyPropertyEdit:{defaultMessage:"{propertyName} is edited",id:"automations.trigger.propertyChangesToAny.title"},triggerButtonClicked:{defaultMessage:"<b>Button</b> is clicked",id:"automations.trigger.button.clicked"},triggerCheckboxPropertyChecked:{defaultMessage:"checked",id:"automations.trigger.checkboxProperty.checked"},triggerCheckboxPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.checkboxPropertySet.title"},triggerCheckboxPropertyUnchecked:{defaultMessage:"unchecked",id:"automations.trigger.checkboxProperty.unchecked"},triggerSelectPropertySet:{id:"automations.trigger.selectPropertySet.title",defaultMessage:"{propertyName} set to {propertyValues}"},triggerStatusPropertySet:{defaultMessage:"{propertyName} set to {propertyValues}",id:"automations.trigger.statusPropertySet.singleProperty"},triggerDeletedPropertyEdit:{defaultMessage:"Deleted property is edited",id:"automations.trigger.deletedPropertyEdited"},deletedPropertyOption:{defaultMessage:"Deleted option",id:"automations.values.deletedPropertyOption"}});function i(e){const{propertyName:t,propertyValue:o}=e;return{...n.actionCheckboxPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function a(e){const{propertyName:t}=e;return{...n.actionDatePropertyClear,values:{propertyName:t}}}function s(e){const{propertyName:t,propertyValue:o}=e;return{...n.actionDatePropertySetSingle,values:{propertyName:t,propertyValue:o}}}function l(e){const{propertyName:t}=e;return{...n.actionPersonPropertyClear,values:{propertyName:t}}}function c(e){const{propertyName:t,propertyValue:o}=e;return{...n.actionPersonPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function p(e){const{propertyName:t,propertyValue:o}=e;return{...n.actionPersonPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function d(e){const{propertyName:t}=e;return{...n.actionRelationPropertyClear,values:{propertyName:t}}}function u(e){const{propertyName:t,propertyValue:o}=e;return{...n.actionRelationPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function m(e){const{propertyName:t,propertyValue:o}=e;return{...n.actionRelationPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function g(e){const{propertyName:t}=e;return{...n.actionSelectPropertyClear,values:{propertyName:t}}}function y(e){const{propertyName:t,propertyValue:o}=e;return{...n.actionSelectPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function h(e){const{propertyName:t,propertyValue:o}=e;return{...n.actionSelectPropertySetMultiple,values:{propertyName:t,propertyValues:o}}}function f(e){const{propertyName:t,propertyValue:o}=e;return{...n.actionStatusPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function v(e){const{propertyName:t}=e;return{...n.actionTextPropertyClear,values:{propertyName:t}}}function S(e){const{propertyName:t,propertyValue:o}=e;return{...n.actionTextPropertySetSingle,values:{propertyName:t,propertyValue:o}}}function x(e){return e.formatMessage(n.actionDeletedProperty)}function M(e){return e.formatMessage(n.triggerAnyPageAdded)}function b(e){return e.formatMessage(n.triggerAnyPagePropertyEdit)}function P(e){return e.formatMessage(n.triggerDeletedPropertyEdit)}function k(e,t){const{propertyName:o}=t;return e.formatMessage(n.triggerAnyPropertyEdit,{propertyName:o})}function C(e,t){return e.formatMessage(n.triggerCheckboxPropertySet,t)}function _(e,t){return e.formatMessage(n.triggerSelectPropertySet,t)}function w(e,t){return e.formatMessage(n.triggerStatusPropertySet,t)}function T(e){return e.formatMessage(n.deletedPropertyOption)}function j(e){const{limit:t,optionValues:o,propertySchema:n}=e,i=n.options??[],a=i.length>0,s=o.map((e=>{const t=a?(0,r.i7)(i,e):void 0;return t?{type:"option",value:t}:{type:"deleted",value:e}}));let l=s;if(void 0!==t&&s.length>t){const e=s.length-t;l=[...s.slice(0,t),{type:"truncation",value:`+${e}`}]}return l}},73266:(e,t,o)=>{o.d(t,{Z:()=>a,a:()=>i});var r=o(67294),n=o(9015);function i(e){return(0,r.useMemo)((()=>Boolean(e&&e.width<400)),[e])}function a(){const e=(0,r.useContext)(n.Z),{editorWidth:t}=e;return t<400}},95193:(e,t,o)=>{o.d(t,{F:()=>s,U:()=>a});var r=o(480),n=o(86628),i=o(87279);function a(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:i.og.ActionSheet}:{menuType:i.og.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function s(e){const t=(0,r.Fy)();return(0,n.VK)((()=>a({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},21269:(e,t,o)=>{o.d(t,{Z:()=>c});o(67294);var r=o(480),n=o(84169),i=o(50906),a=o(42917),s=o(16354),l=o(85893);const c=function(e){window.__c={n:"CollectionSettingsLearnMoreButton"};const{title:t,href:o,analyticsFrom:c}=e,p=(0,r.O7)();return(0,l.jsx)(s.Z,{href:o,onClick:()=>i.Fsx(p,{from:c}),external:!0,children:(0,l.jsx)(a.Z,{icon:n.m,title:t,isGray:!0})})}},71846:(e,t,o)=>{o.d(t,{S:()=>_,Z:()=>j});o(57658),o(67294);var r=o(83355),n=o(49085),i=o(56666),a=o(44495),s=o(6287),l=o(68939),c=o(8406),p=o(23586),d=o(33929),u=o(77907),m=o(75822),g=o(80444),y=o(29798),h=o(26350),f=o(73657),v=o(52275),S=o(68894),x=o(32163),M=o(11470),b=o(72495),P=o(26388),k=o(78948),C=o(85893);let _=function(e){return e[e.Source=0]="Source",e[e.Relation=1]="Relation",e[e.Automation=2]="Automation",e}({});const w=(0,l.defineMessages)({linkedInputPlaceholder:{defaultMessage:"Link to a database…",id:"database.viewSettings.searchCollections.linkedInputPlaceholder"},linkedOrSourceInputPlaceholder:{defaultMessage:"Link or create a database…",id:"database.viewSettings.searchCollections.linkedOrSourceInputPlaceholder"},automationInputPlaceholder:{id:"automations.databasePicker.automationInputPlaceholder",defaultMessage:"Select a database…"}});class T extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:n.default.createClass(""),limitStore:n.default.createClass(5),menuListStore:y.Z}}renderComponent(){const{collectionContextStore:e,selectedCollectionStore:t,context:o,parentStore:r}=this.props,{device:n}=this.environment,{limitStore:a,inputStore:c,menuListStore:y}=this.stores,P=c.state,T="linked"===(null==e?void 0:e.getCollectionViewBlockSourceState())||o===_.Relation?w.linkedInputPlaceholder:o===_.Source?w.linkedOrSourceInputPlaceholder:w.automationInputPlaceholder;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(b.Z,{children:(0,C.jsx)(S.ZP,{focusInitial:!n.isMobile||void 0,value:P,onChange:e=>{c.setState(e.target.value),a.setState(e.target.value?20:5),y.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:d.default.formatMessage(T),showClearButton:!0})}),(0,C.jsx)(p.Z,{request:{query:P,limit:a.state},performRequest:e=>async function(e,t,o,r,n){const{query:i,limit:a}=e,{currentSpaceStore:s}=g.default.state,l=null==r?void 0:r.collectionViewBlockStore(),c=await u.deps.searchActions.loader(),p=await c.searchCollectionsWithRecents({environment:o,collectionViewBlockStore:l,parentStore:t,spaceStore:s,query:i,limit:a,requireEditPermissions:n});return{results:p.results,showMore:Math.max(0,p.total-p.results.length)}}(e,this.props.parentStore,this.environment,this.props.collectionContextStore,this.props.requireEditPermissions),debounce:m.vp,render:(n,c,p)=>{if(!c)return(0,C.jsx)(b.Z,{children:(0,C.jsx)(k.Z,{})});const{results:d,showMore:u}=c,m=d.map((n=>{const i=h.NW.createChildStore(r,{table:s.v,id:n});return{key:n,render:r=>{var a;return(0,C.jsx)(M.Z,{...r,checkState:t&&t.id===n,store:i,right:o===_.Relation&&(null==e||null===(a=e.collectionStore())||void 0===a?void 0:a.id)===n&&(0,C.jsx)(I,{})})},action:e=>{const{index:t}=e;this.handleAcceptExistingCollection({collectionStore:i,totalResults:d.length,clickedIndex:t})}}}));if(u>0){const e={key:"showMore",render:e=>(0,C.jsx)(v.Z,{...e,buttonStyle:{color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor},icon:(0,i.o)({width:16,height:16}),title:(0,C.jsx)(l.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.searchCollections.showMore.title",values:{showMore:Math.min(u,20)}})}),action:()=>{a.setState(a.state+20)}};m.push(e)}return(0,C.jsxs)(C.Fragment,{children:[d.length>0&&(0,C.jsx)(x.Z,{type:x.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,C.jsx)(b.Z,{...e}),items:m}],store:y}),0===d.length&&(0,C.jsx)(f.Z,{caption:(0,C.jsx)(l.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.searchCollections.noResultsTitle"})})]})}})]})}handleAcceptExistingCollection(e){const{collectionStore:t,totalResults:o,clickedIndex:r}=e,{collectionContextStore:n,searchSessionId:i,context:a}=this.props,{inputStore:s}=this.stores;n&&c.wd({environment:this.environment,collectionContextStore:n,action:"select_existing_collection"});const{onAccept:l}=this.props;l(t),c.tW({environment:this.environment,eventName:"select_search_item",totalResults:o,clickedIndex:r,sessionId:i,source:a,queryLength:s.state.length})}}T.displayName="CollectionSettingsSearchCollections";const j=(0,l.injectIntl)(T);function I(){return(0,C.jsx)(P.Z,{renderTooltip:()=>(0,C.jsx)(l.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettigs.searchCollections.thisDatabase.tooltip"}),render:e=>(0,C.jsx)("div",{...e,children:(0,a.D)({width:14,height:14})})})}},40071:(e,t,o)=>{o.d(t,{Z:()=>J});var r=o(94184),n=o.n(r),i=(o(67294),o(83355)),a=o(15145),s=o(88437),l=o(39132),c=o(18557),p=o(53470),d=o(37612),u=o(72126),m=o(68939),g=o(50906),y=o(98834),h=o(47307),f=o(96802),v=o(3992),S=o(75018),x=o(39699),M=o(66890),b=o(66213),P=o(28651),k=o(19037),C=o(43250),_=o(84210),w=o(33929),T=o(87279),j=o(98742),I=o(25498),V=o(77907),R=o(17031),A=o(80444),Z=o(61766),E=o(77080),N=o(96049),F=o(26350),W=o(24736),B=o(45669),D=o(93405),O=o(31945),L=o(78140),K=o(32163),$=o(53437),q=o(31278),z=o(76798),U=o(72495),H=o(26388),X=o(34574),G=o(85893);const Y=(0,m.defineMessages)({emptyPageTitle:{defaultMessage:"Empty",id:"database.templatePicker.emptyPageTitle"}});class Q extends i.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:P.Z,buttonPopupStore:Z.Z},this.renderActionMenuPopup=e=>{const{device:t}=this.environment,o=!!this.props.templateStore&&(0,k.J5)({environment:this.environment,blocks:[this.props.templateStore],publicEditMode:void 0}),r={key:"section",render:e=>(0,G.jsx)(U.Z,{...e}),items:u.oA([this.props.templateStore&&!this.canEditContentOnly.state&&o&&{key:"repeatControl",render:(e,t)=>this.props.templateStore&&(0,G.jsx)(V.LazyRecurrenceConfigMenu,{...e,templateStore:this.props.templateStore,parent:t,cannotEditRecurrence:this.cannotEditRecurrence.state}),action:this.handleRecurrence},this.props.isOverlay&&!this.canEditContentOnly.state&&{key:"Set default",render:e=>(0,G.jsx)(D.Z,{...e,title:(0,G.jsx)(m.FormattedMessage,{defaultMessage:"Set as default",id:"database.collectionTemplatePickerItem.actionMenu.setAsDefault"}),svg:c.z}),action:()=>this.handleSetAsDefault(e)},this.props.templateStore&&{key:"Edit",render:e=>(0,G.jsx)(D.Z,{...e,title:o?(0,G.jsx)(m.FormattedMessage,{defaultMessage:"Edit",id:"database.templatePickerItem.actionMenu.edit"}):(0,G.jsx)(m.FormattedMessage,{defaultMessage:"View",id:"database.templatePickerItem.actionMenu.view"}),svg:o?p.H:l.c}),action:this.handleEdit},this.props.templateStore&&!this.canEditContentOnly.state&&o&&{key:"Duplicate",render:e=>(0,G.jsx)(D.Z,{...e,title:(0,G.jsx)(m.FormattedMessage,{defaultMessage:"Duplicate",id:"database.templatePickerItem.actionMenu.duplicate"}),svg:s.a}),action:this.handleDuplicate},this.props.templateStore&&!this.canEditContentOnly.state&&o&&{key:"Delete",render:e=>(0,G.jsx)(D.Z,{...e,title:(0,G.jsx)(m.FormattedMessage,{defaultMessage:"Delete",id:"database.templatePickerItem.actionMenu.delete"}),svg:d.y}),action:o?this.handleDelete:()=>{}}])};let n;return n=t.isMobile?{menuType:T.og.ActionSheet}:{menuType:T.og.Popup,width:230},(0,G.jsx)(L.Z,{...n,children:(0,G.jsx)(K.Z,{type:K.i.Vertical,initialFocus:void 0,sections:[r]})})},this.handleRecurrence=()=>{g.efr(this.environment,{isConfigured:void 0!==this.props.recurrence})},this.handleEdit=()=>{var e,t;const{buttonPopupStore:o}=this.stores;this.props.templateStore&&(null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t),this.navigateToBlock(this.props.templateStore),o.reset(),g.sYL(this.environment,{template_action:"edit"}))},this.handleDuplicate=()=>{var e,t;const{buttonPopupStore:o}=this.stores,{templateStore:r,collectionStore:n}=this.props;if(!r)return;null===(e=(t=this.props).onCancelClick)||void 0===e||e.call(t);const{performResult:i}=x.createAndCommit({userAction:"CollectionTemplatePickerItem.duplicatedStore",environment:this.environment,perform:e=>{const t=y.Zh({environment:this.environment,collectionStore:n,templateStore:r,transaction:e});if(r.getAutomationId()){const o=F.Mz.fromBlockStore(r),n=null==o?void 0:o.getRecurrence();o&&null!=o&&o.isActive()&&n&&v.createRecurrenceInner(e,this.environment,t,n)}return t}});i&&this.navigateToBlock(i),o.reset(),g.sYL(this.environment,{template_action:"duplicate"})},this.handleDelete=async()=>{const{templateStore:e,collectionStore:t}=this.props;if(!e)return;await h.confirmUserAction({message:(0,G.jsx)(m.FormattedMessage,{defaultMessage:"Are you sure you would like to delete this template?",id:"database.confirmDialog.templatePickerItem.deleteMessage"}),acceptLabel:(0,G.jsx)(m.FormattedMessage,{defaultMessage:"Delete",id:"database.confirmDialog.templatePickerItem.deleteButton.label"})})&&(x.createAndCommit({userAction:"CollectionTemplatePickerItem.handleDelete",environment:this.environment,perform:o=>y.R5({collectionStore:t,templateStore:e,transaction:o})}),g.sYL(this.environment,{template_action:"delete"}))},this.handleSetAsDefault=e=>{var t,o;const{collectionContextStore:r}=this.context,n=null==r?void 0:r.collectionStore(),i=null==r?void 0:r.collectionViewStore();if(!n||null==i||!i.isDefined())return;const a=null!==(t=this.props.templateStore)&&void 0!==t&&t.id?{template_page_id:null===(o=this.props.templateStore)||void 0===o?void 0:o.id}:"empty";h.showDialog({showCancel:!0,keepFocus:!1,message:(0,G.jsx)(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.message",defaultMessage:"<span>Use “{pageName}” as default template when creating new pages?</span>",values:{span:e=>(0,G.jsx)("span",{children:e}),pageName:this.props.templateStore?(0,G.jsx)(z.Z,{store:this.props.templateStore,style:{display:"inline"}}):w.default.formatMessage(Y.emptyPageTitle)}}),items:[{label:(0,G.jsx)(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.setCollection",defaultMessage:"For all views in “{databaseName}”",values:{databaseName:(0,G.jsx)(z.Z,{store:n,style:{display:"inline"}})}}),onAccept:()=>{e.close(),x.createAndCommit({environment:this.environment,userAction:"CollectionTemplatePickerItem.handleSetAsDefault:collection",perform:e=>{f.FH({stores:[n],update:{collection_default_template:a},transaction:e}),f.FH({stores:[i],update:{collection_view_default_template:a},transaction:e})}})}},{label:(0,G.jsx)(m.FormattedMessage,{id:"database.collectionTemplatePickerItem.setAsDefaultDialog.setCollectionView",defaultMessage:"Only on “{viewName}” view",values:{viewName:(0,G.jsx)(B.Z,{collectionViewName:i.getName(),collectionViewType:i.getType()})}}),onAccept:()=>{e.close(),x.createAndCommit({environment:this.environment,userAction:"CollectionTemplatePickerItem.handleSetAsDefault:collectionView",perform:e=>{f.FH({stores:[i],update:{collection_view_default_template:a},transaction:e})}})}}]})},this.handleMouseMove=()=>{N.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.getRecordModel=this.props.collectionStore.getRecordModel,this.canEditContentOnly=this.createComputedStore((()=>{var e;return Boolean(null===(e=this.props.collectionStore.getParentBlockStore())||void 0===e?void 0:e.canEditContentOnly())})),this.cannotEditRecurrence=this.createComputedStore((()=>{if(!E.default.checkGate("recurrence_queue_task_improvements"))return!1;if(!this.props.templateStore)return!1;const e=(0,I.w)(this.props.templateStore);return!e.automationStoresReady||e.violatesConstraint}))}get registries(){return[R.Z]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):S.navigate({environment:this.environment,url:e})}renderComponent(){var e;const{device:t}=this.environment,{templateStore:o,isMobile:r,isOverlay:n,focused:i,locked:a,canConfigureCollection:s,draggable:l}=this.props,{mouseStore:c,buttonPopupStore:p}=this.stores,d=!o&&!n,u=(!a||a&&!l)&&(s||this.canEditContentOnly.state)&&(c.state.mouseEntered||p.state.open||r||n)&&!d,m=o?(0,G.jsx)(z.Z,{store:o}):w.default.formatMessage(Y.emptyPageTitle),g=null==o||null===(e=o.getModel())||void 0===e?void 0:e.getRenderIcon({getRecordModel:this.getRecordModel});return(0,G.jsx)(X.Z,{className:C.$ji,type:o?"custom_template":"empty_page",format:n?"collection-overlay":"page-menu-item",locked:a||!s||!l,icon:(0,G.jsx)(q.Z,{disabled:!0,icon:g,isEmptyPage:(null==o?void 0:o.isEmptyPage())??!0,size:t.isMobile&&n?24:20,isLarge:!n,style:{...!n&&{pointerEvents:"none",marginRight:10}},pageIconStyle:{...!n&&{fill:this.theme.lightIconColor}}}),title:m,onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,right:u&&this.renderActionMenuButton(),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,focused:i,isDefault:this.props.isDefault,recurrence:this.props.recurrence})}renderActionMenuButton(){const{isMobile:e,isOverlay:t}=this.props,{buttonPopupStore:o}=this.stores,r=!!this.props.templateStore&&(0,k.J5)({environment:this.environment,blocks:[this.props.templateStore],publicEditMode:void 0});return(0,G.jsx)(H.Z,{renderTooltip:()=>r?(0,G.jsx)(m.FormattedMessage,{defaultMessage:"Edit this template",id:"database.templatePickerItem.editTemplate.tooltip"}):(0,G.jsx)(m.FormattedMessage,{defaultMessage:"View this template",id:"database.templatePickerItem.viewTemplate.tooltip"}),delayThreshold:300,render:r=>(0,G.jsx)(O.ZP,{popupType:e?$.ZP.PopupType.SlideUp:$.ZP.PopupType.Popup,placementToOrigin:O.pO.Right,originGap:12,buttonPopupStore:o,renderOrigin:o=>(0,G.jsx)(W.Z,{className:n()(C.C_N,{[C.JiD]:e||t}),isMobile:e&&t,style:{...!t&&{marginRight:0}},...(0,j.Z)(r,o)}),render:this.renderActionMenuPopup,onClick:()=>{g.sYL(this.environment,{template_action:"open_menu"})}})})}navigateToBlock(e){const{mainEditorCurrentBlockStore:t}=A.default.state,o=t?(0,_.ZP)({store:t,peekViewBlockId:e.id,fullyQualified:!1,pageVisitSource:a.tY.PeekOpen}):(0,_.ZP)({store:e,fullyQualified:!1,pageVisitSource:a.tY.LinkInPage});this.navigate(o)}}Q.displayName="CollectionTemplatePickerItem",Q.contextTypes={...i.w,...b.wK,...M.xm};const J=Q},45669:(e,t,o)=>{o.d(t,{Z:()=>s});o(67294);var r=o(68939),n=o(78316),i=o(62896),a=o(85893);const s=function(e){let{collectionViewName:t,collectionViewType:o}=e;return t?(0,a.jsx)(i.Z,{children:t}):"page"===o?(0,a.jsx)(r.FormattedMessage,{id:"database.collectionView.untitledName.untitled",defaultMessage:"Untitled"}):(0,a.jsx)(r.FormattedMessage,{...n.b1[o]})}},34574:(e,t,o)=>{o.d(t,{Z:()=>y});o(67294);var r=o(83355),n=o(24405),i=o(49271),a=o(8848),s=o(53523),l=o(82990),c=o(68939),p=o(19124),d=o(64921),u=o(52275),m=o(85893);class g extends r.Z{constructor(){super(...arguments),this.completionsEnabledStore=this.createComputedStore((()=>{var e;const t=null===(e=this.pageContext)||void 0===e?void 0:e.publicEditModeStore.state;return(0,p.GD)(t)}))}renderComponent(){return"collection-overlay"===this.props.format?this.renderCollectionOverlayMenuItem():"phone-modal"===this.props.format?this.renderPhoneModalMenuItem():this.renderPageMenuItem()}renderCollectionOverlayMenuItem(){const{device:e}=this.environment;return(0,m.jsx)(u.Z,{className:this.props.className,icon:this.props.icon,title:(0,m.jsx)(h,{format:this.props.format,title:this.props.title,isDefault:this.props.isDefault,recurrence:this.props.recurrence}),right:this.props.right,focused:this.props.focused,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,showDragHandle:!e.isMobile&&!this.props.locked,dragHandleDisabled:"empty_page"===this.props.type})}renderPhoneModalMenuItem(){return(0,m.jsx)(u.Z,{icon:this.props.icon,title:(0,m.jsx)(h,{format:this.props.format,title:this.props.title,isDefault:this.props.isDefault,recurrence:this.props.recurrence}),focused:this.props.focused,onClick:this.props.onClick,showDragHandle:!1})}renderPageMenuItem(){return(0,m.jsxs)(d.Z,{style:this.getWrapStyle(),hovered:this.props.focused,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,hoveredStyle:{background:this.theme.buttonHoveredBackground,color:this.theme.regularTextColor},pressedStyle:{background:this.theme.buttonPressedBackground},children:[(0,m.jsx)("div",{style:{display:"flex",alignItems:"center",width:24,height:24,marginRight:10},children:this.props.icon}),(0,m.jsx)(h,{format:this.props.format,title:this.props.title,isDefault:this.props.isDefault,recurrence:this.props.recurrence}),this.props.right&&(0,m.jsx)("div",{style:{marginLeft:"auto",marginRight:4},children:this.props.right})]})}getWrapStyle(){const{device:e}=this.environment;return{...i.ZD,display:"flex",alignItems:"center",flexGrow:1,height:e.isMobile?36:32,fontSize:16,borderRadius:4,paddingLeft:8,marginBottom:2,color:this.completionsEnabledStore.state?this.theme.mediumTextColor:this.theme.lightTextColor}}}g.displayName="TemplatePickerMenuItem";const y=g;function h(e){let{format:t,title:o,isDefault:r,recurrence:i}=e;window.__c={n:"TitleComponent"};const p=(0,n.Fg)();return"collection-overlay"!==t?(0,m.jsx)(m.Fragment,{children:o}):(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o,(0,m.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r&&(0,m.jsx)("span",{style:{fontSize:12,fontWeight:l.Z.fontWeight.medium,color:p.mediumTextColor},children:(0,m.jsx)(c.FormattedMessage,{defaultMessage:"DEFAULT",id:"database.templatePickerMenuItem.default"})}),i&&(0,s.N)({width:14,color:a.ZP.blue,marginLeft:8})]})]})}},20776:(e,t,o)=>{o.d(t,{o:()=>s});o(67294);var r=o(24405),n=o(8848),i=o(82990),a=o(85893);function s(e){window.__c={n:"AutomationStepValueToken"};const{children:t,icon:o,shouldTruncateChildren:s}=e,l=(0,r.yK)((e=>{const t=(0,n.KR)(e,void 0);return{iconWrap:{flex:"0 0 auto"},textWrap:{...s?i.Z.textOverflowStyle:{},flex:"1 1 auto"},wrap:{backgroundColor:t.backgroundColor,borderRadius:12,color:t.textColor,display:"inline-flex",gap:4,minWidth:s?50:void 0,padding:"0 8px"}}}),[s]);return(0,a.jsxs)("span",{style:l.wrap,children:[o&&(0,a.jsx)("span",{"aria-hidden":"true",style:l.iconWrap,children:o}),(0,a.jsx)("span",{style:l.textWrap,children:t})]})}},40863:(e,t,o)=>{o.d(t,{BO:()=>f,Ft:()=>u,Lh:()=>M,YG:()=>m,du:()=>h,y$:()=>y});o(57658);var r=o(30120),n=o(30823),i=o(40506),a=o(53877),s=o(42875),l=o(72126),c=o(59753),p=o(68939),d=o(28020);function u(e){const{collectionContextStore:t}=e,o=t.collectionViewStore();if(!o)return;const r=t.normalizedSchemaStore.state,n=o.getQuery(r);if(!n||!n.calendar_by)return;const i=t.dateRangeStart.state,l=t.dateRangeEnd.state,c=(0,a.hT)(i,(0,s.r)()),p=(0,a.hT)(l,(0,s.r)());return g({calendarBy:n.calendar_by,dateRangeStartDate:c,dateRangeEndDate:p})}function m(e){const{collectionContextStore:t,startOfDay:o}=e,n=t.collectionViewStore();if(!n)return;const i=t.normalizedSchemaStore.state,l=n.getQuery(i);if(!l||!l.calendar_by)return;const c=r.ou.fromMillis(o).endOf("day").valueOf(),p=(0,a.hT)(o,(0,s.r)()),d=(0,a.hT)(c,(0,s.r)());return g({calendarBy:l.calendar_by,dateRangeStartDate:p,dateRangeEndDate:d})}function g(e){const{dateRangeStartDate:t,dateRangeEndDate:o,calendarBy:r}=e;return{type:"results",filter:{operator:"and",filters:[{property:r,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:r,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:o}}}]},limit:5e3}}function y(e){const{collectionContextStore:t,results:o,getRecordValue:r,intl:n}=e,c=t.collectionViewStore(),p=t.normalizedQueryStore.state,u=t.normalizedSchemaStore.state,m=p?p.calendar_by:void 0,g=t.dateRangeStart.state,y=t.dateRangeEnd.state,S=d.AK.state,x=(0,s.r)(),M=t.getCurrentUserId();if(!(c&&p&&m&&u))return;const b=l.oA(o.map((e=>f({blockStore:e,calendarBy:m,schema:u,getRecordValue:r,userId:M,intl:n})))),P={};o.forEach(((e,t)=>{P[e.id]=t}));0===(p.sort||[]).length&&b.sort(((e,t)=>{const o=e.start.valueOf(),r=t.start.valueOf();if(o===r){return P[e.id]-P[t.id]}return o-r}));const k=(0,a.em)(g,S,x),C=(0,a.gQ)(y,S,x);let _=k;const w=[];do{const e=(0,a.gQ)(_.valueOf(),S,x),t={},o=b.filter((t=>(0,i.b8)(_.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((o=>{const{id:r,start:n,end:i,includeTime:a,timeZone:s}=o,{startColumn:l,columnCount:c}=h({startUnixTimestampMS:n.valueOf(),endUnixTimestampMS:i?i.valueOf():void 0,startOfWeekUnixTimestampMS:_.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),p=v(l,c,t);return{id:r,start:n.valueOf(),end:i?i.valueOf():void 0,row:p,includeTime:a,timeZone:s}}));w.push({start:_.valueOf(),end:e.valueOf(),items:o}),_=(0,a.em)(_.plus({week:1}).plus({hour:25}).valueOf(),S,x)}while(_<C);return w}function h(e){const t=r.ou.fromMillis(e.startUnixTimestampMS),o=e.endUnixTimestampMS?r.ou.fromMillis(e.endUnixTimestampMS):void 0,n=r.ou.fromMillis(e.startOfWeekUnixTimestampMS),i=r.ou.fromMillis(e.endOfWeekUnixTimestampMS),a=t.startOf("day"),s=r.ou.max(n,a),l=Math.ceil(s.diff(n,"days").get("days"));let c=1;if(o){const e=o.endOf("day"),t=r.ou.min(i,e);c=Math.ceil(t.diff(s,"days").get("days"))}return{start:t,end:o,startOfWeek:n,endOfWeek:i,startColumn:l,columnCount:c}}function f(e){const{blockStore:t,calendarBy:o,schema:r,getRecordValue:i,intl:l,userId:p}=e,d=t.getAssociatedCollectionStore(),u=t.getModel();if(!u)return;const m=(0,n.FT)({property:o,schema:r,block:u,getRecordModel:c.om.fromGetRecordValueFn(i),propertyMapping:null==d?void 0:d.getPropertyMapping(),collectionRequestContext:{userId:p,userTimeZone:(0,s.r)(),depth:0,intl:l,visitedProperties:new Set,resultCache:new Map}}).next().value;if("date"!==m.type)return;const g=m.value,y=g&&(0,a.NK)(g,(0,s.r)());if(!g||!y)return;return{id:u.id,start:y.start,end:y.end,includeTime:"datetime"===g.type||"datetimerange"===g.type,timeZone:"datetime"===g.type||"datetimerange"===g.type?g.time_zone:void 0}}function v(e,t,o){let r=0;for(;;){let n=!1;for(let i=0;i<t;i++)S(o,e+i,r)&&(n=!0);if(!n)break;r++}for(let n=0;n<t;n++)x(o,e+n,r);return r}function S(e,t,o){return Boolean(e[o]&&e[o][t])}function x(e,t,o){e[o]||(e[o]={}),e[o][t]=!0}const M=(0,p.defineMessages)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}})},54802:(e,t,o)=>{o.d(t,{EE:()=>Z,EF:()=>z,Li:()=>F,P$:()=>Y,R4:()=>G,WM:()=>D,Xd:()=>R,cB:()=>q,i1:()=>W,j_:()=>Q,qM:()=>B,qk:()=>E,rU:()=>$,sA:()=>H,tk:()=>U,vM:()=>K,wB:()=>N});o(21703),o(57658);var r=o(43261),n=o.n(r),i=o(67294),a=o(86628),s=o(3865),l=o(83372),c=o(23290),p=o(76205),d=o(1274),u=o(84116),m=o(78106),g=o(76218),y=o(72126),h=o(86517),f=o(4615),v=o(149),S=o(98963),x=o(18844),M=o(77420),b=o(6287),P=o(13493),k=o(97880),C=o(77080),_=o(30874),w=o(26350),T=o(35057),j=o(30912),I=o(52821),V=o(33929);function R(e){return e.isTriggerType("event")||e.isTriggerType("notification_event")}function A(e){const{action:t,actionValue:o,automationValue:r}=e;var n,i,a,s,l,c,p;if("create_page"===t.action.type){if(!o||"create_page"===o.type)return function(e){const{actionId:t,automationId:o,collectionPointer:r,properties:n,values:i,spaceId:a,templatePageId:s}=e;return{...X({actionId:t,actionType:"create_page",automationId:o,spaceId:a}),config:{collection:r,properties:n,values:i,template_page_id:s}}}({actionId:t.action.id,automationId:r.id,collectionPointer:(null===(n=t.action.config)||void 0===n?void 0:n.collection)??(null==o||null===(i=o.config)||void 0===i?void 0:i.collection),properties:(null===(a=t.action.config)||void 0===a?void 0:a.properties)??(null==o||null===(s=o.config)||void 0===s?void 0:s.properties),spaceId:r.space_id,values:(null===(l=t.action.config)||void 0===l?void 0:l.values)??(null==o||null===(c=o.config)||void 0===c?void 0:c.values),templatePageId:null===(p=t.action.config)||void 0===p?void 0:p.template_page_id})}else if("update_pages"===t.action.type){var d,u,m,g,y,h;if(!o||"update_pages"===o.type)return function(e){const{actionId:t,automationId:o,properties:r,spaceId:n,target:i,values:a}=e;return{...X({actionId:t,actionType:"update_pages",automationId:o,spaceId:n}),config:{target:i,properties:r,values:a}}}({actionId:t.action.id,automationId:r.id,properties:(null===(d=t.action.config)||void 0===d?void 0:d.properties)??(null==o||null===(u=o.config)||void 0===u?void 0:u.properties),spaceId:r.space_id,target:(null===(m=t.action.config)||void 0===m?void 0:m.target)??(null==o||null===(g=o.config)||void 0===g?void 0:g.target),values:(null===(y=t.action.config)||void 0===y?void 0:y.values)??(null==o||null===(h=o.config)||void 0===h?void 0:h.values)})}else if("slack_notification"===t.action.type){var f,v,S,x;if(!o||"slack_notification"===o.type)return function(e){const{actionId:t,automationId:o,externalBotId:r,spaceId:n,target:i}=e;return{...X({actionId:t,actionType:"slack_notification",automationId:o,spaceId:n}),config:{target:i,external_bot_id:r}}}({actionId:t.action.id,automationId:r.id,externalBotId:(null===(f=t.action.config)||void 0===f?void 0:f.external_bot_id)??(null==o||null===(v=o.config)||void 0===v?void 0:v.external_bot_id),spaceId:r.space_id,target:(null===(S=t.action.config)||void 0===S?void 0:S.target)??(null==o||null===(x=o.config)||void 0===x?void 0:x.target)})}else{if("duplicate_blocks"===t.action.type||"modal_confirmation"===t.action.type||"open_page"===t.action.type||"query_collection"===t.action.type||"complete_sprint"===t.action.type)return;(0,k.t1)(t.action)}}function Z(e){const{automationStore:t,currentUserId:o,inMemoryRecordCache:r}=e;return(0,a.VK)((()=>{const e=null==t?void 0:t.getRole(),n=null==t?void 0:t.getValue(),i=(null==t?void 0:t.getActionStores().map((e=>e.getValue())).filter(k.$K))??[],a=null==t?void 0:t.pointer;return c=>{if(o&&e&&n&&a){if(!(0,s.Vd)(n)&&!(0,s.nl)(n))return n;if("update_name"===c.type){const t=function(e){var t;const{action:o,automationValue:r}=e;return(null===(t=r.properties)||void 0===t?void 0:t.name)!==o.name?{...r,properties:{...r.properties,name:o.name}}:r}({action:c,automationValue:n});n!==t&&(r.setRecord({pointer:a,userId:o},{role:e,value:t}),r.emitAll())}else if("update_source"===c.type){const t=function(e){const{action:t,automationValue:o}=e,r=t.pointer,n=r.table===b.v?{pointer:r,type:b.v}:{pointer:r,type:P.n};return{...o,trigger:{...o.trigger,event:{...o.trigger.event,source:n}}}}({action:c,automationValue:n});n!==t&&(r.setRecord({pointer:a,userId:o},{role:e,value:t}),r.emitAll())}else if("update_trigger"===c.type){const t=function(e){const{action:t,automationValue:o}=e,r=t.trigger;if("page_added"===r.type)return o.trigger.event.pagesAdded?o:{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!0}}};if("any_page_property_edited"===r.type)return"any"!==o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"any"}}}}:o;if("property_changed"===r.type){const e="some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[],t=y.cx(e,(e=>e.property===r.property)),n={filter:r.filter,property:r.property},i=-1===t?[...e,n]:e.map((e=>e.property===r.property?n:e));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{some:i,type:"some"}}}}}(0,k.t1)(r)}({action:c,automationValue:n});n!==t&&(r.setRecord({pointer:a,userId:o},{role:e,value:t}),r.emitAll())}else if("update_action"===c.type){var p;const t=i.find((e=>e.id===c.action.id)),s=A({action:c,actionValue:t,automationValue:n});if(!s)return;if(r.setRecord({pointer:{id:s.id,spaceId:n.space_id,table:x.Xj},userId:o},{role:"editor",value:s}),null===(p=n.action_ids)||void 0===p||!p.includes(s.id)){const t={...n,action_ids:[...n.action_ids??[],s.id]};r.setRecord({pointer:a,userId:o},{role:e,value:t})}r.emitAll()}else if("remove_action"===c.type){const i=c.action.id;r.deleteRecord({pointer:{id:i,spaceId:n.space_id,table:x.Xj},userId:o});const s={...n,action_ids:(n.action_ids??[]).filter((e=>e!==i))};r.setRecord({pointer:a,userId:o},{role:e,value:s}),function(e){const{automationStore:t,newAutomationValue:o,currentUserId:r,inMemoryRecordCache:n}=e,i=t.getParentStore();if((null==i?void 0:i.table)!==b.v)return;const a={automationStore:t,parentPointer:i.getSpaceShardedPointer(),type:"event",persisted:!0,intl:V.default.getIntl(),parentRecordStore:i},s=(0,j.pt)({context:a,automationValue:o});if(v.x.isFail(s))return;const c=(o.action_ids??[]).map((e=>({pointer:{id:e,spaceId:o.space_id,table:x.Xj},userId:r})));for(const d of c){const e=n.getRecordModel(d),t=n.getRecord(d);if(!e||!t||!t.value||"create_page"!==t.value.type&&"update_pages"!==t.value.type)continue;const o=new Set(s.value.actionInputValueTypes[e.id].map((e=>{if(e.kind===u.yp.ContextValue)return e.id;e.kind!==u.yp.ThisRow&&e.kind!==u.yp.Binding&&(0,k.t1)(e)})).filter(k.$K)),r=(0,l.z)(e.type).acceptFormulaVisitor({action:e,visitor:{visitVariableOutsideOfFormula:e=>o.has(e)?{type:"keep"}:{type:"replace",value:void 0},visitFormula:e=>e.value&&(0,g.UB)(e).some((e=>!o.has(e)))?{type:"replace",value:void 0}:{type:"keep"}}});let i=t.value;for(const n of r)if("update"===n.command)if(1===n.path.length&&"config"===n.path[0]&&Object.keys(n.args).includes("target")&&"update_pages"===i.type)i={...i,config:{target:void 0,properties:[],values:{}}};else if(2===n.path.length&&"config"===n.path[0]&&"values"===n.path[1]){var p;const e=Object.keys(n.args)[0];i={...i,config:{...i.config,values:{...null===(p=i.config)||void 0===p?void 0:p.values,[e]:void 0}}}}n.setRecord(d,{value:i,role:t.role})}}({automationStore:t,newAutomationValue:s,currentUserId:o,inMemoryRecordCache:r}),r.emitAll()}else if("remove_trigger"===c.type){const t=function(e){const{action:t,automationValue:o}=e,r=t.trigger;if("page_added"===r.type)return o.trigger.event.pagesAdded?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!1}}}:o;if("any_page_property_edited"===r.type)return"any"===o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"none"}}}}:o;if("property_changed"===r.type){const e=("some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[]).filter((e=>e.property!==r.property));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:e.length>0?{some:e,type:"some"}:{type:"none"}}}}}(0,k.t1)(r)}({action:c,automationValue:n});n!==t&&(r.setRecord({pointer:a,userId:o},{role:e,value:t}),r.emitAll())}else(0,k.t1)(c)}}}),[t,o,r])}function E(e){const{automationContextStore:t,automationStore:o,collectionStore:r}=e,n=r.getSchema(),i=o.getKeyStore("properties").getKeyStore("name").getValue();if(null==i||!i.trim())return!1;const a=o.getTrigger(),s="event"===(null==a?void 0:a.type),l="notification_event"===(null==a?void 0:a.type);if(!s&&!l)return!1;const{pagesAdded:c,pagePropertiesEdited:p,source:d}=a.event;if(void 0===d)return!1;if("some"===p.type&&p.some.some((e=>O({collectionSchema:n,property:e.property})||L({collectionSchema:n,property:e.property,type:"trigger"}))))return!1;if(!c&&("none"===p.type||"some"===p.type&&0===p.some.length))return!1;const u=o.getActionStores().filter((e=>e.isDefined()));return 0!==u.length&&u.every((e=>function(e){const{actionStore:t,automationContextStore:o,collectionStore:r}=e;if(t.isType("slack_notification"))return(0,k.$K)(t.getConfigStore().getKeyStore("external_bot_id").getValue())&&(0,k.$K)(t.getConfigStore().getKeyStore("target").getValue());if(t.isType("update_pages")){const e=t.getConfigStore().getKeyStore("target").getValue(),n=t.getConfigStore().getKeyStore("properties").getValue()??[];if(!(0,k.$K)(e)||0===n.length)return!1;if("collection"===e.type){const t=w.NW.createChildStore(r,e.collection).getSchema();if(n.some((e=>O({property:e,collectionSchema:t})||L({collectionSchema:t,property:e,type:"action"}))))return!1}else if("variable"===e.type){const t=(0,m.MY)(e.id);if("global"===t.source&&"button_page"===t.global){const e=r.getSchema();if(n.some((t=>O({property:t,collectionSchema:e})||L({collectionSchema:e,property:t,type:"action"}))))return!1}else{const t=null==o?void 0:o.compilationResultStore.state;if(!t||v.x.isFail(t))return!1;const r=(0,m.vx)(t.value.valueTypes,e.id),i=r?N(r,o.context.parentRecordStore):void 0;if(!i)return!1;const a=i.getSchema();if(n.some((e=>O({property:e,collectionSchema:a})||L({collectionSchema:a,property:e,type:"action"}))))return!1}}else{if("page"===e.type)return!1;(0,k.t1)(e)}return!0}if(t.isType("create_page")){const e=t.getConfigStore().getKeyStore("collection").getValue();if(!(0,k.$K)(e))return!1;const o=w.NW.createChildStore(r,e).getSchema();return!(t.getConfigStore().getKeyStore("properties").getValue()??[]).some((e=>O({property:e,collectionSchema:o})||L({collectionSchema:o,property:e,type:"action"})))}throw new Error(`isActionStoreComplete not implemented for ${t.getType()}`)}({actionStore:e,automationContextStore:t,collectionStore:r})))}function N(e,t){let o;return"block"===e.type.type&&e.type.collection?o=w.NW.createChildStore(t,e.type.collection):"array"===e.type.type&&"block"===e.type.of.type&&e.type.of.collection&&(o=w.NW.createChildStore(t,e.type.of.collection)),o}function F(e){const{collectionStore:t}=e;if(!t)return!1;if((t.getFormat().automation_ids??[]).length>=c.ss&&!(0,T.sX)())return!1;const o=t.pointer,r=t.getSpaceId();return(0,d.IC)({targetTriggerType:"event",targetParentPointer:o,targetSpaceId:r}).every((e=>{let{pointer:o,minimumRequiredRole:r}=e;const n=t.getRecordRole(o);return!!n&&(0,h.yY)(n,r)}))}function W(e){const{automationStore:t,actionStores:o}=e,r=t.getMinimumFieldsForPermissions();if(!r)return!1;if(!o.every((e=>e.isDefined())))return!1;const n=o.some((e=>!e.isType("slack_notification")));if(!(0,T.sX)()&&n)return!1;return(0,d.fz)({automationValue:r,actionValues:o.map((e=>({config:e.getConfig(),type:e.getType()})))}).every((e=>{let{pointer:o,minimumRequiredRole:r}=e;const n=t.getRecordRole(o);return!!n&&(0,h.yY)(n,r)}))}function B(e){const{automationStore:t}=e,o=t.getMinimumFieldsForPermissions();if(!o)return!1;return(0,d.bM)(o).every((e=>{let{pointer:o,minimumRequiredRole:r}=e;const n=t.getRecordRole(o);return!!n&&(0,h.yY)(n,r)}))}function D(e){const{anyOptionCheckState:t,currentFilter:o,propertyId:r,updateCurrentState:n}=e;!0===t?n({type:"update_trigger",trigger:{type:"property_changed",property:r,filter:{operator:"changes_to_any"}}}):!1===t?n({type:"remove_trigger",trigger:{type:"property_changed",property:r,filter:{operator:"changes_to_any"}}}):"partial"===t?n({type:"update_trigger",trigger:{type:"property_changed",property:r,filter:o}}):(0,k.t1)(t)}function O(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function L(e){const{collectionSchema:t,property:o,type:r}=e,n=null==t?void 0:t[o];return!n||("action"===r?!(0,s.SF)(n):!s.Ym[n.type])}function K(e){const{automationStore:t,collectionStore:o}=e;if(!t.isTriggerType("event")&&!t.isTriggerType("notification_event"))return!1;const r=t.getEventConfiguration();if(!r||void 0===r.source||r.source.type===b.v||"filter"===r.source.type)return!1;const n=w.Xr.createChildStore(o,r.source.pointer);return function(e){const t=$(e);return(0,k.$K)(t)}({collectionSchema:o.getSchema(),collectionViewStore:n})}function $(e){var t;const{collectionViewStore:o,collectionSchema:r}=e,n=o.getPropertyFiltersStore().getValue()??[],i=null===(t=o.getQuery(r))||void 0===t?void 0:t.filter,a={operator:"and",filters:(0,p.OH)({propertyFilters:n,combinatorFilter:i,schema:r})},l=(0,p.SH)(a,(e=>{if((0,p.aN)(e)){const t=r[e.property];return!!t&&!(0,s.TX)(t)}return!1}));if(l)return(0,p.aN)(l)?l.property:(0,p.Mm)(l)?l.timestamp:void 0}function q(e){if("collectionTypedView"===e.contextType)return!1;const t=e.collectionStore();return!!t&&!(t.isSyncedCollection()&&!C.default.checkGate("support_synced_database_automations"))}function z(e){const{collectionSchema:t,propertyIds:o,searchTerm:r}=e;if(!r)return o.slice(0);const i=new Map,a=o.map((e=>{const o=t[e],r=o?`${o.name} ${I.SO[o.type]}`:"";return i.set(e,r),r})),s=n().filter(r,a).map((e=>{let{original:t}=e;return t}));return o.filter((e=>s.includes(i.get(e)??"")))}function U(e){return v.x.isFail(e.compilationResultStore.state)?[]:e.compilationResultStore.state.value.valueTypes}function H(e){const{automationId:t,automationName:o,collectionStore:r,userId:n}=e;return function(e){const{actionIds:t,automationId:o,collectionStore:r,eventConfiguration:n,lastEditedTime:i,properties:a,userId:s}=e,l=Date.now();return{action_ids:t,alive:!0,created_by_id:s,created_by_table:"notion_user",created_time:l,id:o,last_edited_by_id:s,last_edited_by_table:"notion_user",last_edited_time:i??l,parent_id:r.id,parent_table:b.v,properties:a??{},space_id:r.getSpaceId(),status:"active",trigger:{event:n,id:(0,f.ZP)(),type:"event"},version:1}}({actionIds:[],automationId:t,collectionStore:r,eventConfiguration:{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:r.getSpaceShardedPointer(),type:b.v}},properties:{name:o},userId:n})}function X(e){const{actionId:t,actionType:o,automationId:r,spaceId:n}=e;return{alive:!0,id:t??(0,f.ZP)(),parent_id:r,parent_table:S.cv,space_id:n,type:o,version:1}}function G(e){const t=e.getActionStores().filter((0,k.AO)((e=>e.isType("slack_notification")?{true:e}:{false:e}))),o={};for(const r of t){const e=r.getConfig(),t=null==e?void 0:e.external_bot_id;if(!t)continue;const n=w.Qx.createChildStore(r,{id:t,spaceId:r.getSpaceId(),table:M.cZ}).getCreatedByStore();n&&(o[r.id]=n.getDisplayName(V.default.getIntl()))}return o}async function Y(e){const{automationAvailabilityContext:t}=e;let o=t.automation.getTriggerType();"notification_event"===o&&(o="event");const r=c.Gl[o],n="default_bound"===r.max?c.xZ:r.max;if(t.automationActions.length>=n)return[];const i=(0,l.P)("display"),a=[];for(const s of i)await s.isAvailableForContext(t)&&a.push(s);return a}function Q(){const e=(0,a.VK)((()=>_.Z.completeSlackAuthentications.state),[]);return(0,i.useMemo)((()=>0===e.length?{type:"connectToSlackDefault"}:1===e.length?{type:"selectChannelNew"}:{type:"selectWorkspace"}),[e.length])}},25498:(e,t,o)=>{o.d(t,{m:()=>i,w:()=>a});o(57658);var r=o(81491),n=o(98165);const i=[{frequency:"day",interval:1},{frequency:"week",interval:1},{frequency:"month",interval:1},{frequency:"year",interval:1}],a=e=>{const t=n.qA(e)??[],o=[];for(const r of t){if(!("block"===r.table&&!0===r.isTemplate()&&r.getFormat().automation_id&&r.id!==e.id))continue;const t=r.getAutomationStore();if(t){if(!t.isReady())return{automationStoresReady:!1};void 0!==t.getRecurrence()&&t.isDefined()&&o.push(t.getModel())}}return{automationStoresReady:!0,violatesConstraint:(0,r.templateAncestorsViolateRecurrenceNesting)(o)}}},5971:(e,t,o)=>{o.d(t,{E:()=>i});var r=o(86628),n=o(77080);function i(e){return(0,r.VK)((()=>n.default.checkGate(e)),[e])}},68910:(e,t,o)=>{o.d(t,{L:()=>l});var r=o(14577),n=o(78106),i=o(72126),a=o(149),s=o(30912);class l{constructor(e){this.context=void 0,this.compilationResultStore=new r.Z((()=>(0,s.pt)({context:this.context})),{useDeepEqual:!0,debugName:"compilationResultsStore"}),this.context=e}getAllContextValues(){const e=this.compilationResultStore.state;return a.x.isFail(e)?[]:i.d9(e.value.valueTypes)}getContextValuesForAction(e){const t=this.compilationResultStore.state;return a.x.isFail(t)?[]:t.value.actionInputValueTypes[e]??[]}getValidationErrorsForAction(e){const t=this.compilationResultStore.state;return a.x.isFail(t)?[]:t.value.actionValidationFailures[e]??[]}getContextValueForActionById(e,t){const o=this.getContextValuesForAction(e);return(0,n.vx)(o,t)}}},86488:(e,t,o)=>{o.d(t,{p:()=>i});o(67294);var r=o(45238),n=o(85893);const i=(0,r.I)("squarePlus",{viewBox:"0 0 30 30",svg:(0,n.jsx)("path",{d:"M7.059 27.052H22.94c2.75 0 4.11-1.361 4.11-4.059V7.007c0-2.697-1.36-4.059-4.11-4.059H7.059c-2.736 0-4.111 1.349-4.111 4.059v15.986c0 2.71 1.375 4.06 4.11 4.06zm.026-2.108c-1.31 0-2.03-.694-2.03-2.055V7.112c0-1.362.72-2.056 2.03-2.056h15.83c1.296 0 2.029.694 2.029 2.056v15.777c0 1.361-.733 2.055-2.03 2.055H7.085zm7.895-3.758c.707 0 1.113-.484 1.113-1.243V16.08h4.111c.733 0 1.231-.392 1.231-1.086 0-.707-.471-1.113-1.23-1.113h-4.112V9.769c0-.759-.406-1.243-1.113-1.243-.694 0-1.073.51-1.073 1.243v4.112H9.822c-.773 0-1.257.405-1.257 1.112 0 .694.523 1.087 1.257 1.087h4.085v3.863c0 .733.38 1.243 1.073 1.243z"})})}}]);