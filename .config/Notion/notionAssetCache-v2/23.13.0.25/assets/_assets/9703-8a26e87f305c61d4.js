"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9703,5203],{73657:(e,t,o)=>{o.d(t,{Z:()=>n});o(67294);var r=o(28992),i=o(85893);const n=function(e){return(0,i.jsx)(r.Z,{...e,style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...e.style}})}},46247:(e,t,o)=>{o.d(t,{Z:()=>c});o(67294);var r=o(480),i=o(24405),n=o(84169),s=o(50906),a=o(64921),l=o(16354),d=o(85893);const c=function(e){window.__c={n:"HelpIconButtonMobile"};const t=(0,r.O7)(),o=(0,i.Fg)();return(0,d.jsx)(l.Z,{style:{display:"flex",alignSelf:"stretch",width:36,...e.isRight?{marginRight:-8}:{marginLeft:-8}},external:!0,href:e.href,onClick:()=>s.Fsx(t,{from:e.analyticsFrom}),children:(0,d.jsx)(a.Z,{mobileFeedback:!0,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:(0,n.m)({width:18,marginTop:1,fill:o.lightIconColor})})})}},86765:(e,t,o)=>{o.d(t,{Z:()=>p});o(67294);var r=o(480),i=o(86628),n=o(24405),s=o(68939),a=o(1018),l=o(31278),d=o(76798),c=o(85893);const p=(0,s.injectIntl)((function(e){window.__c={n:"RelationCreateItemText"};const{title:t,targetCollectionStore:o}=e,p=(0,r.Fy)(),u=(0,i.VK)((()=>o.getIcon()),[o]),g=(0,n.yK)((e=>({medium:{color:e.mediumTextColor},dbName:{display:"flex",alignItems:"center",marginLeft:4},title:{marginLeft:a.Qi*(p.isRetina?.5:1)}})),[p.isRetina]),h=t?(0,c.jsxs)("span",{children:[" ",t," "]}):(0,c.jsx)("span",{children:" "}),y=(0,c.jsxs)("div",{style:g.dbName,children:[(0,c.jsx)(l.Z,{disabled:!0,icon:u,isEmptyPage:!1,size:p.isMobile?24:20}),(0,c.jsx)(d.Z,{store:o,style:g.title})]});return(0,c.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,c.jsx)(s.FormattedMessage,{id:"database.searchRelation.createNewPageFooter",defaultMessage:"<medium>New</medium> {pageName} <medium> in</medium> {databaseNameWithIcon}",values:{medium:e=>(0,c.jsx)("span",{style:g.medium,children:e}),pageName:h,databaseNameWithIcon:y}})})}))},75203:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Z});o(67294);var r=o(83355),i=o(39068),n=o(56666),s=o(39132),a=o(61061),l=o(72126),d=o(82990),c=o(68939),p=o(50906),u=o(31869),g=o(96802),h=o(39699),y=o(87279),m=o(29376),f=o(4023),v=o(29798),x=o(73657),b=o(52275),S=o(31945),P=o(79131),M=o(73063),R=o(78140),C=o(32163),k=o(53437),j=o(72495),w=o(26388),I=o(85893);class _ extends r.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:v.Z},this.renderRelationPropertyMenuPopup=e=>{const t=this.allRelatedTargetProperties.state;if(!t)return;const o=t.filter((e=>e.visible)),r=t.filter((e=>!e.visible));return(0,I.jsxs)(R.Z,{menuType:y.og.Popup,maxWidth:240,maxHeight:500,children:[0===t.length&&(0,I.jsx)(j.Z,{children:(0,I.jsx)(x.Z,{caption:(0,I.jsx)(c.FormattedMessage,{defaultMessage:"No properties",id:"database.relationMenu.noProperties"})})}),t.length>0&&(0,I.jsx)(C.Z,{type:C.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,sections:l.oA([o.length>0&&{key:"visible_and_hidden_properties",render:e=>(0,I.jsx)(j.Z,{...e,noTextOverflow:!0,isTitleUppercase:!1,title:(0,I.jsx)(c.FormattedMessage,{defaultMessage:"Shown in relation",id:"database.relationMenu.shownInRelationTitle"}),desktopTitleStyle:{height:18},children:this.renderPropertyDraggableList({visibleProperties:o,hiddenProperties:r,children:e.children})}),items:l.oA([...this.renderPropertySortListItems({properties:o,visibility:!0}),r.length>0&&{key:"group-header-hidden-property",render:e=>(0,I.jsx)(F,{props:e,children:(0,I.jsx)(I.Fragment,{})}),action:()=>{}},...this.renderPropertySortListItems({properties:r,visibility:!1})])},0===o.length&&r.length>0&&{key:"hidden_properties",render:e=>(0,I.jsx)(F,{props:e,children:this.renderPropertyDraggableList({visibleProperties:o,hiddenProperties:r,children:e.children})}),items:this.renderPropertySortListItems({properties:r,visibility:!1})}])})]})},this.handlePropertyReorder=e=>{const{newPropertyKeys:t}=e,{collectionStore:o,property:r}=this.props,i=m.U1({collectionStore:o,property:r}),n=t.indexOf("group-header-hidden-property"),s=l.oA(t.filter((e=>!e.startsWith("group-header-"))).map(((e,t)=>{const o=i.find((t=>t.property===e));return o?n>0?"title"===e&&t>=n?o:{...o,visible:Boolean(t<n)}:o:{property:e,visible:!(n>0)||Boolean(t<n)}}))),a=i.filter((e=>!t.includes(e.property))),d={...m.ZI(o)};d[r]||(d[r]={}),d[r].related_properties=[...s,...a],h.createAndCommit({userAction:"RelationPropertyCustomizeLayoutMenu.handlePropertyReorder",environment:this.environment,perform:e=>{g.FH({stores:[o],update:{collection_relation_options:d},transaction:e})}}),this.stores.menuListStore.reset()},this.allRelatedTargetProperties=this.createComputedStore((()=>{const{collectionStore:e,targetCollectionStore:t,property:o}=this.props,r=m.U1({collectionStore:e,property:o}),i=Object.keys(t.getSchema()).map((e=>r.find((t=>t.property===e))??{property:e,visible:!1})),n=r.map((e=>e.property)),s=e=>{const t=n.indexOf(e);return-1!==t?t:1/0};return i.sort(((e,t)=>s(e.property)-s(t.property))),i}),!0)}renderComponent(){const{device:e}=this.environment;if(!e.isPhone||"section"===this.props.rowType)return(0,I.jsx)(w.Z,{renderTooltip:()=>(0,I.jsx)(c.FormattedMessage,{id:"database.RelationCustomizeLayoutMenu.tooltip.button.message",defaultMessage:"Customize shown properties"}),placement:"section"===this.props.rowType?f.u.Top:f.u.Right,render:e=>(0,I.jsx)(S.ZP,{popupType:k.kQ.Popup,alignmentToOrigin:f.v.Start,...e,renderOrigin:t=>(0,I.jsx)(M.Z,{icon:n.o,iconStyle:{width:16,color:this.theme.mediumIconColor,fill:this.theme.mediumIconColor},...t,...e}),onClick:()=>{p.gP4(this.environment,{from:"section"===this.props.rowType?"relation_section":"configure_relation_modal"})},originGap:16,render:this.renderRelationPropertyMenuPopup})})}renderPropertySortListItems(e){const{properties:t,visibility:o}=e;return l.oA(t.map((e=>this.renderPropertySortListItem({propertyFormat:e,visibility:o}))))}renderPropertyDraggableList(e){const{visibleProperties:t,hiddenProperties:o,children:r}=e,i=l.oA([...t.map((e=>e.property)),t.length>0&&o.length>0&&{key:"group-header-hidden-property",draggable:!1},...o.map((e=>e.property))]);return(0,I.jsx)(P.ZP,{direction:"vertical",keys:i,renderKey:(e,t)=>r[t],onDrop:e=>{this.handlePropertyReorder({newPropertyKeys:e})},disabled:this.props.disabled})}renderPropertySortListItem(e){const{propertyFormat:t,visibility:o}=e,r=!o,{collectionStore:n,targetCollectionStore:l,property:c,disabled:p}=this.props,g=this.environment,h=l.getSchema();if(!h)return;const y=h[t.property];if(!y)return;const{theme:m}=this;return{key:t.property,render:e=>(0,I.jsx)(b.Z,{...e,showDragHandle:!p,title:(0,I.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,I.jsx)(i.ZP,{icon:y.icon,type:y.type,size:16,theme:m,style:{fill:m.regularIconColor}}),(0,I.jsx)("span",{style:{marginLeft:8,...d.Z.textOverflowStyle},children:y.name})]}),right:(0,I.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,I.jsx)(M.Z,{icon:r?a.B:s.c,iconStyle:{width:16,height:16},isDarkIconColor:!r,onClick:()=>{u.qK({propertyFormat:t,visibility:o,collectionStore:n,property:c,environment:g})},disabled:p||"title"===t.property})})}),action:()=>{}}}}_.displayName="RelationPropertyCustomizeLayoutMenu";const Z=_;function F(e){const{props:t,children:o}=e;return(0,I.jsx)(j.Z,{...t,noTextOverflow:!0,isTitleUppercase:!1,title:(0,I.jsx)(c.FormattedMessage,{defaultMessage:"Hidden in relation",id:"database.relationMenu.hiddenInRelationTitle"}),desktopTitleStyle:{height:19},children:o,disableDesktopPadding:!0})}},49122:(e,t,o)=>{o.d(t,{Z:()=>c});o(67294);var r=o(480),i=o(24405),n=o(41892),s=o(82990),a=o(68939),l=o(32662),d=o(85893);function c(e){window.__c={n:"CollectionSettingsGithubPrTaskPreview"};const t=(0,a.useIntl)(),o=function(e){const{isMobile:t}=(0,r.Fy)(),o=t?18:14,n=1,a=6,l=20;return(0,i.yK)((t=>({githubContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:e||"90%",padding:l,border:`${n}px solid ${t.tableDividerColor}`,borderRadius:a,borderBottomRightRadius:4,cursor:"default"},githubPrTitleRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",width:`calc(100% + ${l}px)`,overflow:"hidden"},githubPrTitle:{display:"inline-flex",fontSize:o,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",background:t.whiteButtonBackground,padding:"2px 4px",borderTopLeftRadius:5,borderBottomLeftRadius:5,borderLeft:`2px solid ${t.blueColor}`,borderTop:`2px solid ${t.blueColor}`,borderBottom:`2px solid ${t.blueColor}`,width:"100%"},githubTask:{background:"light"===t.mode?t.accentColors.blue[50]:t.accentColors.blue[400]},githubPrInfoRow:{display:"inline-flex"},githubPrInfoPill:{display:"flex",flexDirection:"row",alignItems:"center",width:"fit-content",padding:"4px 10px",borderRadius:"2em",background:"#238636",flexShrink:0,...s.Z.textOverflowStyle},githubPrInfoOpenText:{color:"white",fontSize:o-2,fontWeight:500},githubPrInfoMergeInto:{display:"inline-flex",alignItems:"center",fontSize:o-2,color:t.lightTextColor,...s.Z.textOverflowStyle},githubPrInfoMain:{padding:"0px 4px",fontFamily:s.Z.baseFontFamily.githubMono,background:t.cardPressedBackground,borderRadius:a,color:t.regularTextColor,verticalAlign:"text-bottom",...s.Z.textOverflowStyle}})),[o,e])}(e.width),c=(0,d.jsx)("div",{id:"github-preview-github-pr-title-row",style:o.githubPrTitleRow,children:(0,d.jsxs)("div",{id:"github-preview-github-pr-title-wrapper",style:o.githubPrTitle,children:[(0,d.jsx)(l.Z,{size:2}),"[",(0,d.jsxs)("div",{id:"github-preview-github-pr-task",style:o.githubTask,children:[e.uniqueIdPrefix||t.formatMessage(p.idPrefix),e.uniqueIdValue?`-${e.uniqueIdValue}`:"-1"]}),"]",(0,d.jsx)(l.Z,{size:2}),t.formatMessage(p.prTitle)]})}),u=(0,d.jsxs)("div",{id:"github-preview-github-pr-info-row",style:o.githubPrInfoRow,children:[(0,d.jsxs)("div",{id:"github-preview-github-open-pr-pill",style:o.githubPrInfoPill,children:[(0,d.jsx)("img",{src:n.Z.images.externalIntegrations.githubPullOpenIconWhitePng,style:{width:16,height:16}}),(0,d.jsx)(l.Z,{size:2}),(0,d.jsx)("div",{style:o.githubPrInfoOpenText,children:t.formatMessage(p.open)})]}),(0,d.jsx)(l.Z,{size:8}),(0,d.jsx)("div",{id:"github-preview-github-merge-into-main",style:o.githubPrInfoMergeInto,children:(0,d.jsxs)("span",{style:o.githubPrInfoMergeInto,children:[t.formatMessage(p.mergeInto),(0,d.jsx)(l.Z,{size:4}),(0,d.jsx)("span",{style:o.githubPrInfoMain,children:t.formatMessage(p.main)})]})})]});return(0,d.jsxs)("div",{id:"github-preview-github-container",style:o.githubContainer,children:[c,(0,d.jsx)(l.Z,{size:12}),u]})}const p=(0,a.defineMessages)({dismissButtonAriaLabel:{defaultMessage:"A button to dismiss the user education preview.",id:"database.viewSettings.githubConfigTab.preview.dismissButtonAriaLabel"},idPrefix:{defaultMessage:"TASK",id:"database.viewSettings.githubConfigTab.preview.idPrefix"},prTitle:{defaultMessage:"GitHub PR Title",id:"database.viewSettings.githubConfigTab.preview.prTitle"},open:{defaultMessage:"Open",id:"database.viewSettings.githubConfigTab.preview.open"},mergeInto:{defaultMessage:"Merge into",id:"database.viewSettings.githubConfigTab.preview.mergeInto"},main:{defaultMessage:"main",id:"database.viewSettings.githubConfigTab.preview.main"}})},53296:(e,t,o)=>{o.r(t),o.d(t,{default:()=>_t});o(57658),o(21703);var r=o(67294),i=o(83355),n=o(1302),s=o(480),a=o(86628),l=o(24405),d=o(15145),c=o(92996),p=o(61514),u=o(99036),g=o(80951),h=o(43690),y=o(1800),m=o(77657),f=o(68626),v=o(42875),x=o(47453),b=o(91155),S=o(59753),P=o(4615),M=o(74446),R=o(21202),C=o(3791),k=o(82990),j=o(68939),w=o(50906),I=o(8406),_=o(54642),Z=o(14871),F=o(47307),T=o(9953),L=o(75018),D=o(39699),B=o(61202),V=o(52275),A=o(36488),O=o(74194),U=o(68894),K=o(84076),E=o(78140),G=o(53437),q=o(31278),N=o(76798),z=o(72495),Q=o(46247),H=o(86765),W=o(85893);function $(e){window.__c={n:"RelationCreateNewRow"};const{targetCollectionStore:t,title:o,onClick:r,focused:i,isSection:n,index:d}=e,c=(0,a.VK)((()=>t.canEdit()),[t]),p=(0,a.VK)((()=>t.isSyncedCollection()),[t]),u=(0,s.Fy)(),g=(0,l.yK)((e=>({wrapper:{borderTop:`1px solid ${e.lightDividerColor}`,paddingTop:4,paddingBottom:4},icon:{width:16,fill:e.mediumIconColor,marginRight:4,marginLeft:-2},row:{fontSize:u.isMobile?16:14,minHeight:u.isMobile?44:32}})),[u]);if(!c)return null;const h=(0,W.jsx)(V.Z,{focused:i,icon:(0,x.R)(g.icon),style:g.row,onClick:()=>r(d),title:(0,W.jsx)(H.Z,{targetCollectionStore:t,title:o})});return p?(0,W.jsx)(W.Fragment,{}):n?(0,W.jsx)(z.Z,{style:g.wrapper,disableDesktopPadding:!0,disableMobilePadding:!0,children:h}):h}var Y=o(66890),X=o(23586),J=o(24215),ee=o(70764),te=o(75079),oe=o(33929),re=o(87279),ie=o(70219),ne=o(65598),se=o(18514),ae=o(77907),le=o(18245),de=o(75822),ce=o(80444),pe=o(77080),ue=o(30874),ge=o(26350),he=o(72087),ye=o(78291),me=o(51741),fe=o(49085);class ve extends fe.default{getInitialState(){return{searchQuery:"",searchLimit:ve.limitIncrement,searchPopupOpen:!1,addingPage:!1}}}ve.limitIncrement=20,ve.incrementScrollOffset=200;const xe=ve;o(30541);var be=o(72126),Se=o(60971),Pe=o(14473),Me=o(79131),Re=o(68785),Ce=o(32163),ke=o(53336),je=o(43145),we=o(26388),Ie=o(68139),_e=o(89767);function Ze(e){window.__c={n:"RelationMoveToBacklog"};const{targetCollectionStore:t,onClick:o,focused:i,isSection:n,index:d,onMouseEnter:c,blockPropertyValueOverlayStore:p}=e,u=(0,a.VK)((()=>t.canEdit()),[t]),g=(0,a.VK)((()=>t.isSyncedCollection()),[t]),h=(0,s.Fy)(),y=(0,l.yK)((e=>({medium:{fontWeight:k.Z.fontWeight.medium},wrapper:{borderTop:`1px solid ${e.lightDividerColor}`},icon:{width:14,fill:"#A6A299",marginRight:-2,marginLeft:0},row:{fontSize:h.isMobile?16:14,minHeight:h.isMobile?44:32}})),[h]),m=(0,W.jsx)(V.Z,{focused:i,onMouseEnter:c,icon:(0,_e.R)(y.icon),style:y.row,onClick:(0,r.useCallback)((()=>{o(d),p.setState({isOpen:!1})}),[d,o,p]),title:(0,W.jsx)(j.FormattedMessage,{id:"database.searchRelation.MoveToBacklogFooter",defaultMessage:"<medium>Move to backlog</medium>",values:{medium:e=>(0,W.jsx)("span",{style:y.medium,children:e})}})}),f=n?(0,W.jsx)(z.Z,{style:y.wrapper,disableDesktopPadding:!0,disableMobilePadding:!0,children:m}):m;return u?g?null:f:null}var Fe=o(75203),Te=o(73744),Le=o(98742),De=o(34859),Be=o(45452),Ve=o(29798),Ae=o(30120),Oe=o(8848),Ue=o(7057),Ke=o(53877),Ee=o(84795),Ge=o(59054),qe=o(20270),Ne=o(75071),ze=o(44805),Qe=o(44876),He=o(63143),We=o(42631),$e=o(12981),Ye=o(95477),Xe=o(24990),Je=o(6398),et=o(12534),tt=o(1634);function ot(){window.__c={n:"FigmaRelationPropertyMenuResults"};const e=(0,s.O7)(),t=function(){const e=(0,s.Fy)().isMobile;return(0,l.yK)((t=>({figmaResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4},figmaResultsCopyWrapper:{marginTop:0,color:t.lightTextColor}})),[e])}();return e.device.isMobile?(0,W.jsx)(W.Fragment,{}):(0,W.jsx)(W.Fragment,{children:(0,W.jsx)("div",{style:t.figmaResults,children:(0,W.jsx)("p",{style:t.figmaResultsCopyWrapper,children:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"To link, paste the Figma File URL above",id:"connectedRelationPropertyMenuResults.figmaRelationUserEducationPasteUrl.description"})})})})}var rt=o(90559),it=o(75553),nt=o(84169),st=o(74882),at=o(16956),lt=o(49122),dt=o(64921),ct=o(61519),pt=o(32662),ut=o(75081);const gt=(0,j.defineMessages)({githubCopyIdAria:{defaultMessage:"Copy the ID value.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.copyIdAria"},githubAddIdAria:{defaultMessage:"Add a unique id property to the database.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.addIdAria"},githubLearnMoreAria:{defaultMessage:"Learn more about the GitHub Pull Requests feature.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.learnMoreAria"}});function ht(e){window.__c={n:"GithubRelationPropertyMenuResults"};const{pageBlockStore:t,blockPropertyValueOverlayStore:o}=e,r=(0,s.O7)(),i=(0,j.useIntl)(),n=yt(),l=(0,Y.Y$)(),d=(0,a.VK)((()=>l.collectionStore()),[l]),c=(0,a.VK)((()=>l.databaseType),[l]),p=(0,a.VK)((()=>{var e;return d&&(null===(e=d.getRecordKeyStore())||void 0===e?void 0:e.getRecordKey())}),[d]),{uniqueIdPropertyId:u,uniqueIdValue:h}=(0,a.VK)((()=>{const e=t.getSchema(),o=(0,rt.$z)(e);if(1!==o.length)return{uniqueIdPropertyId:void 0,uniqueIdValue:void 0};const r=t.getPropertyValue(o[0]);return{uniqueIdPropertyId:o[0],uniqueIdValue:(0,g.ah)(r)}}),[t]),y=(0,a.VK)((()=>(0,rt.wf)(p,h)),[p,h]),f=(0,a.VK)((()=>!Boolean(p)||!Boolean(h)),[p,h]);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{style:n.githubResults,children:[(0,W.jsx)(mt,{}),(0,W.jsx)("p",{style:n.githubResultsCopyWrapper,children:f?(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Create a prefixed ID property to paste in the GitHub PR title.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.badIdError"}):(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Copy the {singleItemName} ID and paste it into the title of your PR in GitHub.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducationLinkPastingOn.description",values:{singleItemName:(0,ut.sN)(c)}})}),(0,W.jsx)(lt.Z,{width:"100%",uniqueIdPrefix:p,uniqueIdValue:h})]}),(0,W.jsxs)("div",{style:n.githubResultsButtonsWrapper,children:[(0,W.jsxs)(dt.Z,{style:n.githubResultsLearnMore,ariaLabel:i.formatMessage(gt.githubLearnMoreAria),onClick:e=>{e.preventDefault(),L.navigateToExternalURL({environment:r,url:(0,se.UY)("guides.githubRelation"),targetSelf:!1})},children:[(0,nt.m)({width:r.device.isMobile?16:12}),(0,W.jsx)(pt.Z,{size:4}),(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Learn more",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.learnMore"})]}),f?(0,W.jsxs)(dt.Z,{style:n.githubResultsCTAButton,ariaLabel:i.formatMessage(gt.githubAddIdAria),onClick:async e=>{e.preventDefault(),d&&(await st.K({environment:r,collectionStore:d}),D.createAndCommit({userAction:"CollectionSettingsAutoIncrementIdPropertyCreateNewIdProperty",environment:r,perform:e=>{at.G3({environment:r,collectionStore:d,collectionViewArgs:void 0,propertyType:"auto_increment_id",transaction:e})}}),I._H({environment:r,collectionContextStore:l,from:"github_relation_menu",property_type:"auto_increment_id",integration_id:m.U9}))},children:[(0,x.R)({width:r.device.isMobile?16:12}),(0,W.jsx)(pt.Z,{size:4}),(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Add ID property",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.addId"})]}):(0,W.jsxs)(dt.Z,{style:n.githubResultsCTAButton,ariaLabel:i.formatMessage(gt.githubCopyIdAria),onClick:async e=>{e.preventDefault(),await Z.RD({stringValue:y,environment:r,copiedMessage:Z.tq.copiedPropertyToClipboard}),u&&I.S$(r,l,{block_id:t.id,property:u,property_type:"auto_increment_id",github_relation_menu:!0}),o.setState({isOpen:!1})},children:[(0,it.U)({width:r.device.isMobile?16:12}),(0,W.jsx)(pt.Z,{size:4}),(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Copy {singleItemName} ID",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.copyId",values:{singleItemName:(0,ut.sN)(c)}})]})]})]})}function yt(){const e=(0,s.Fy)().isMobile;return(0,l.yK)((t=>({githubResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4},githubResultsCopyWrapper:{marginTop:0,color:t.lightTextColor},githubResultsErrorWrapper:{marginTop:0,color:Oe.ZP.red},githubResultsButtonsWrapper:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",fontSize:e?16:12,padding:"10px"},githubResultsLearnMore:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5,color:t.lightTextColor},githubResultsCTAButton:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5,color:t.blueColor},githubLinkPastingSeparator:{border:t.tableDividerColor,width:"100%"},githubLinkPastingContainer:{width:"100%",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",margin:"8px 0px"},githubLinkPastingSeparatorText:{position:"absolute",backgroundColor:t.popoverBackground,color:t.lightTextColor,padding:"0px 8px"}})),[e])}function mt(){window.__c={n:"GithubPropertyLinkPastingUserEducation"};const e=yt();return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("p",{style:e.githubResultsCopyWrapper,children:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"To link, paste the GitHub PR URL above",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducationPasteUrl.description"})}),(0,W.jsxs)("div",{style:e.githubLinkPastingContainer,children:[(0,W.jsx)(ct.Z,{size:1,style:e.githubLinkPastingSeparator}),(0,W.jsx)("div",{style:e.githubLinkPastingSeparatorText,children:"or"})]}),(0,W.jsx)(pt.Z,{size:8})]})}var ft=o(28415);function vt(e){window.__c={n:"GoogleDriveRelationPropertyMenuResults"};const t=(0,s.O7)(),o=function(){const e=(0,s.Fy)().isMobile;return(0,l.yK)((t=>({googleDriveResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4,paddingTop:4},googleDriveResultsCopyWrapper:{marginTop:0,color:t.lightTextColor,marginBottom:0},googleDriveResultsLearnMore:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5},googleDriveResultsAccount:{fontSize:12,margin:0},googleDriveLinkPastingSeparator:{border:t.tableDividerColor,width:"100%"},googleDriveLinkPastingContainer:{width:"100%",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",margin:"8px 0px"},googleDriveLinkPastingSeparatorText:{position:"absolute",backgroundColor:t.cardContentBackground,color:t.lightTextColor,padding:"0px 8px"}})),[e])}(),r=(0,a.VK)((()=>ue.Z.externalAuthentications.state.filter((e=>{let{integration_id:t}=e;return t===m.f3}))),[]);return t.device.isMobile?(0,W.jsx)(W.Fragment,{}):(0,W.jsx)(W.Fragment,{children:(0,W.jsxs)("div",{style:o.googleDriveResults,children:[(0,W.jsx)("p",{style:o.googleDriveResultsCopyWrapper,children:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"To link, paste the Google Drive File URL above",id:"connectedRelationPropertyMenuResults.googleDriveRelationUserEducationPasteUrl.description"})}),(0,W.jsxs)("div",{style:o.googleDriveLinkPastingContainer,children:[(0,W.jsx)(ct.Z,{size:1,style:o.googleDriveLinkPastingSeparator}),(0,W.jsx)("div",{style:o.googleDriveLinkPastingSeparatorText,children:"or"})]}),(0,W.jsx)(pt.Z,{size:2}),(0,W.jsx)("p",{style:o.googleDriveResultsCopyWrapper,children:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Select an account below to browse files on your Google Drive",id:"connectedRelationPropertyMenuResults.googleDriveRelationUserEducationSourcePicker.description"})}),(0,W.jsx)(pt.Z,{size:2}),r.map(((r,i)=>(0,W.jsx)(dt.Z,{style:o.googleDriveResultsLearnMore,onClick:async o=>{o.preventDefault(),await(async(o,r)=>{const i=await B.jh({environment:t,externalAuthenticationValue:r}),n=ue.Z.integrations.state.find((e=>e.id===r.integration_id));if(!n)return;const{id:s,name:a,info:l}=n,{icon:d,dark_icon:c,accent_color:p,accent_icon:u}=l,g="dark"===t.ThemeStore.state.mode&&c?c:d;g&&p&&u&&i&&"failed"!==i.type&&await(0,ft.vE)({environment:t,accessToken:i.data.access_token,callback:(t,r)=>{e.onFileSelect(o,r)},integration:{id:s,name:a,icon:g,accentColor:p,accentIcon:u},from:"connected_relation_property_value"})})(o,r)},children:(0,W.jsx)("p",{style:o.googleDriveResultsAccount,children:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"{account}",id:"connectedRelationPropertyMenuResults.googleDriveRelation.googleDriveAccount.description",values:{account:r.account_name}})})},i)))]})})}function xt(e){var t;window.__c={n:"ConnectedRelationPropertyMenuResults"};const{sections:o,collectionStore:r,targetCollectionStore:i,search:n,property:d,propertySchema:c,pageRecordStore:p,blockPropertyValueOverlayStore:u}=e,h=(0,l.yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"},settingsMenuSearchBox:{background:e.contentBackground,marginBottom:10},addPageButton:{width:"100%",display:"flex",justifyContent:"center"},suggestionBox:{display:"flex",alignItems:"center",fontSize:12,color:Oe.ZP.white,background:Oe.ZP.blue,borderRadius:6,padding:10,boxShadow:e.largeLightBoxShadow,alignSelf:"center",maxWidth:"80%"},errorMessage:{alignSelf:"center",padding:10,fontSize:14,color:e.errorText},addingPage:{width:"100%",padding:10,display:"flex",justifyContent:"flex-start",fontSize:14,color:e.mediumTextColor}})),[]),y=g.Kp(c),f=g.gg(c),x=g.ic(c),b=(0,a.VK)((()=>{if(!i)return;const e=i.getFormat().integration_id;return ue.Z.integrations.state.find((t=>t.id===e))}),[i]),M=(0,a.VK)((()=>b?(0,ee.NP)(b.id):[]),[b]),C=(0,s.O7)(),k=(0,j.useIntl)(),w=(0,l.Fg)(),I=(0,a.VK)((()=>{const e=ue.Z.state;return e.loaded?e.integrations:[]}),[]),Z=(0,a.VK)((()=>{var e;return Boolean(null===(e=ce.default.state.currentSpaceStore)||void 0===e?void 0:e.canAdmin())}),[]),F=(0,a.VK)((()=>{var e;return!(!(null===(e=ce.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit())||!(0,ee.sw)(C))}),[C]),T=(0,a.VK)((()=>{const e=ue.Z.state;return e.loaded&&b?e.externalAuthentications.filter((e=>e.integration_id===b.id)):[]}),[b]),L=(0,a.VK)((()=>T.length?T[0]:null),[T]),[{value:D,status:B}]=(0,Ge.r5)((async()=>{if(!L||!b||!(0,m.ok)(b.id))return;const e=L.parent_id;return _.listExternalObjects(C,{bot_id:e,query:n})}),[C,L,n,b],{debounce:1e3}),A=(0,a.VK)((()=>i.getFormat().pattern_name),[i]),O=(0,a.VK)((()=>{if(b&&n)return bt({integration:b,patternName:A,url:n})}),[A,b,n]),U=(0,ne.OY)(p)?p:void 0,K=(0,ne.OY)(p)?p.getPropertyStore(d):void 0,E=(0,a.VK)((()=>null==i?void 0:i.getIcon()),[i]),G=(0,a.VK)((()=>{var e;return null===(e=ce.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),q=(0,a.VK)((()=>Xe.Z.state),[]),N={key:"githubPrRelationUserEducation",render:e=>void 0!==U&&(0,W.jsx)(ht,{pageBlockStore:U,blockPropertyValueOverlayStore:u}),items:[]},Q={key:"googleDriveRelation",render:t=>(0,W.jsx)(vt,{onFileSelect:(t,o)=>{(0,et.ZP)({context:et.Af.ButtonMouseDown,callback:()=>{e.addPage(o)},event:t})}}),items:[]},H={key:"figmaRelation",render:e=>(0,W.jsx)(ot,{}),items:[]};if(!r||!K||!b)return(0,W.jsx)(Ce.Z,{type:Ce.i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:o});if(!((null==b?void 0:b.id)===m.U9?null===(t=M[0])||void 0===t?void 0:t.id:null==L?void 0:L.parent_id)){const e=function(e){const{collectionIcon:t,integration:o,environment:r,spaceId:i,isAdmin:n,userAllowedToAuth:s}=e,a=o.id===m.U9,l=()=>{i&&(We.hM({environment:r,integration:o,spaceId:i,from:"connected_relation_property_menu"}),tt.Z.reset())};if(!a&&o.id!==m.Dv){if(e.environment.device.isMobile)return{key:"askUseBrowserOrDesktopForAuth",render:e=>(0,W.jsx)(z.Z,{...e,disableMobilePadding:!0,title:(0,W.jsx)("div",{style:{whiteSpace:"normal",paddingTop:8},children:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Please authorize this integration in the browser or a desktop app.",id:"connectedRelationProperty.mobile.guide.title"})})}),items:[]};if(!s)return{key:"askGuestToGetMemberAccess",render:e=>(0,W.jsx)(z.Z,{...e,disableMobilePadding:!0,title:(0,W.jsx)("div",{style:{whiteSpace:"normal",paddingTop:8},children:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"To use {integration} integration, request the workspace admin to add you as a member",id:"connectedRelationProperty.guest.auth.guide",values:{integration:o.name}})})}),items:[]}}return{key:"authenticateIntegration",render:e=>(0,W.jsx)(z.Z,{...e,disableMobilePadding:!0,title:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"connectedRelationPropertyMenuResults.authenticateHeader.title",values:{integration:o.name}})}),items:[!a||n&&s?{key:"authenticateButton",render:e=>(0,W.jsx)(V.Z,{...e,title:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"connectedRelationPropertyMenuResults.authenticateButton.title",values:{integration:o.name}}),icon:(0,W.jsx)($e.Z,{src:null==t?void 0:t.icon,style:{width:14}})}),action:()=>l()}:{key:"askAdminToAuthenticateButton",render:e=>(0,W.jsx)(V.Z,{...e,title:(0,W.jsx)("div",{style:{whiteSpace:"normal"},children:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) connection.",id:"connectedRelationPropertyMenuResults.askAdminToAuthenticateButton.title"})}),icon:(0,W.jsx)($e.Z,{src:null==t?void 0:t.icon,style:{width:14}}),hoveredStyle:{cursor:"default",background:void 0},pressedStyle:{background:void 0}}),action:()=>{}}]}}({environment:C,collectionStore:r,integration:b,collectionIcon:E,spaceId:G,isAdmin:Z,userAllowedToAuth:F});return(0,W.jsx)(Ce.Z,{type:Ce.i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:[...o,e]})}const $=("success"===(null==D?void 0:D.type)&&"data"in D.data?D.data.data:[]).map((e=>{const t=e.attributes.flatMap((e=>{const t=(0,Qe.GY)(e);return(0,qe.nj)(t)?[t]:(console.error(t),[])})),o=(0,He.m8)(t.flatMap((e=>[[e.id,e]])));return{uri:e.uri,attributes:t,attributesById:o}}));function Y(){let e=(0,W.jsx)(j.FormattedMessage,{id:"connectedRelationPropertyMenuResults.addPageButton.label",defaultMessage:"Link Page"});return(null==b?void 0:b.id)===m.f3||(null==b?void 0:b.id)===m.mQ?e=(0,W.jsx)(j.FormattedMessage,{id:"connectedRelationPropertyMenuResults.addFileButton.label",defaultMessage:"Link File"}):(null==b?void 0:b.id)===m.Nw?e=(0,W.jsx)(j.FormattedMessage,{id:"connectedRelationPropertyMenuResults.addTicketButton.label",defaultMessage:"Link Ticket"}):(null==b?void 0:b.id)===m.U9&&(e=(0,W.jsx)(j.FormattedMessage,{id:"connectedRelationPropertyMenuResults.addPRButton.label",defaultMessage:"Link PR"})),e}const X={key:"thirdPartySearchResults",render:e=>(0,W.jsx)(z.Z,{...e,disableMobilePadding:!0}),items:[{key:"addPage",render:e=>(0,W.jsx)(V.Z,{...e,title:Y(),icon:(0,Ne.f)({width:14})}),action:t=>{(0,et.ZP)({event:t,context:et.Af.ButtonMouseDown,callback:()=>{e.addPage()}})}}]},J={key:"noResultsFoundInThirdParty",render:e=>(0,W.jsx)(z.Z,{...e,disableMobilePadding:!0,title:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"No results found in {integration}.",id:"connectedRelationPropertyMenuResults.notMatched.help",values:{integration:b.name}})}),items:[]},te=[];b&&(0,m.ok)(b.id)&&te.push(...function(e){const{environment:t,intl:o,theme:r,externalIntegrations:i,emojiData:n}=e,s=e.results.flatMap((e=>{const t=e.attributesById.start;if(t&&(0,Qe.Gc)(t)){const r=(0,Ke.NK)(t.values[0],(0,v.r)(),o.locale);return[{...e,dateTime:r.start}]}return[]})),a=be.vM(s,(e=>e.dateTime.toFormat(Ke.Iq))),l=be.MR(Object.keys(a),(e=>Ae.ou.fromFormat(e,Ke.Iq).valueOf()));return l.flatMap((s=>{const l=a[s],d=be.MR(l,(e=>e.dateTime.valueOf())),c=(0,Ee.parseDateTimeRangeString)(s);if(!c)return[];let p;(be.Xy(c,(0,Ke.Lg)((0,v.r)()))||be.Xy(c,(0,Ke.Ro)((0,v.r)())))&&(p="relative");const u=(0,Ue.ZV)({value:c,intl:o,allowRelativeDates:Boolean(p),date_format:p});return[{key:u,items:d.flatMap((s=>{const a=new ge.G(t,{table:R.iU,id:(0,P.ZP)(),spaceId:(0,P.ZP)()}),l={id:a.id,type:"external_object_instance",alive:!0,format:{bot_id:"",external_object_id:"",uri:s.uri,attributes:s.attributes},version:0,space_id:"",parent_id:"",parent_table:"block"};let d=null,c=null;const p=s.attributesById.title,u=s.attributesById.start,g=s.attributesById.end;return u&&g&&(0,Qe.Gc)(u)&&(0,Qe.Gc)(g)&&(d=(0,W.jsx)("div",{children:(0,W.jsxs)("span",{children:[(0,W.jsx)(Je.r4,{style:{color:void 0,display:"inline"},attribute:u,dateStyle:"exact_time"})," - ",(0,W.jsx)(Je.r4,{attribute:g,dateStyle:"exact_time",style:{color:void 0,display:"inline"}})]})}),c=(0,W.jsxs)("div",{children:[(0,W.jsx)("span",{children:(0,W.jsx)(Je.ox,{style:{color:void 0,display:"inline"},store:a,attribute:p})}),d]})),{key:s.uri,render:e=>(0,W.jsx)(we.Z,{renderTooltip:()=>c,placement:we.Z.Placement.Left,textWrap:!0,render:s=>(0,W.jsx)(V.Z,{...(0,Le.Z)(s||{},e),title:(0,ze.dD)({blockModel:S.kk.fromBlock(l),intl:o,index:0,style:{},disableHover:!0,disableLinks:!0,isAndroid:!1,theme:r,baseUrl:Ye.default.domainBaseUrl,emojiType:"raw",currentUserId:t.currentUser.id,getRecordModel:a.getRecordModel,externalIntegrations:i,emojiData:n}),caption:d})}),action:t=>{(0,et.ZP)({event:t.event,context:et.Af.ButtonMouseDown,callback:()=>{e.addPage(s.uri)}})}}})),render:e=>(0,W.jsx)(z.Z,{...e,disableMobilePadding:!0,title:u})}]}))}({environment:C,intl:k,theme:w,externalIntegrations:I,results:$,addPage:e.addPage,emojiData:q}));const oe={key:"loadingSpinner",render:t=>(0,W.jsx)(z.Z,{...t,disableMobilePadding:!0,title:(0,W.jsxs)("div",{style:{...h.addingPage,justifyContent:e.addingPage?"center":"flex-start"},children:[(0,W.jsx)(Re.Z,{}),(0,W.jsx)("span",{style:{marginLeft:10},children:(0,W.jsx)(j.FormattedMessage,{id:"connectedRelationPropertyMenuResults.fetchingData",defaultMessage:"Fetching data..."})})]})}),items:[]},re=[];return"pending"===B||e.addingPage?re.push(oe):O?re.push(X):te.length>0?re.push(...te):f?re.push(Q):x?re.push(H):y&&0===o.length?re.push(N):y&&o.length>0||re.push(J),(0,W.jsx)(Ce.Z,{type:Ce.i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:[...o,...re]})}const bt=e=>{var t;if(e.patternName)return null===(t=e.integration.info)||void 0===t||null===(t=t.original_url_patterns)||void 0===t?void 0:t.filter((t=>{var o;return t.name===e.patternName&&(null===(o=t.additional_types)||void 0===o?void 0:o.connectedRelation)})).find((t=>{let{regex:o}=t;return new RegExp(o).test(e.url)}))};class St extends i.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:Ve.Z,draggableListStore:Be.Z},this.handleDraggableListDrop=(e,t)=>{const{onDrag:o}=this.props,{menuListStore:r}=this.stores;o&&o(e),Se.sv({store:r,focus:{section:0,indexLocal:t.endPosition,indexGlobal:t.endPosition}})}}didUpdate(e){const{menuListStore:t}=this.stores,{device:o}=this.environment;!this.props.searchQuery||be.Xy(e.searchQuery,this.props.searchQuery)||o.isMobile||t.setState({...t.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}renderComponent(){const{device:e}=this.environment;return e.isMobile?this.renderMobileResults():this.renderDesktopResults()}renderDesktopResults(){const{results:e,loading:t,onScrollOffsetChange:o}=this.props,i=0===e.length;return(0,W.jsx)(r.Fragment,{children:(0,W.jsxs)(ke.Z,{style:{width:"100%",maxHeight:300,position:"relative",...i&&{marginTop:0}},type:De.Z.Y,children:[this.renderRowsMenuList(e),t&&(0,W.jsx)(Pt,{}),o&&(0,W.jsx)(je.Z,{onChange:o})]})})}renderMobileResults(){const{results:e,loading:t,resultsType:o}=this.props,i=0===e.length,n=this.props.schema[this.props.property];return Boolean("relation"===(null==n?void 0:n.type)&&n.connectedRelation)&&i?(0,W.jsx)("div",{style:{marginTop:20},children:(0,W.jsx)(xt,{blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,collectionStore:this.props.collectionStore,targetCollectionStore:this.props.targetCollectionStore,sections:[],propertySchema:n,property:this.props.property,pageRecordStore:this.props.parentStore,search:this.props.searchQuery,relationPropertyMenuStore:this.props.relationPropertyMenuStore,addPage:this.props.addPage,addingPage:this.props.addingPage})}):(0,W.jsxs)(r.Fragment,{children:[i&&!t&&"existing"===o?void 0:this.renderRowsMenuList(e),t&&(0,W.jsx)(Pt,{})]})}renderRowsMenuList(e){const{parentStore:t,collectionStore:o,targetCollectionStore:r,property:i,canDrag:n,canConfigureCollection:s,loading:a,onCreatePage:l,handleClearProperty:d,overlayMode:p,disabled:u}=this.props,{device:g}=this.environment,h=this.props.schema[i],y=Boolean("relation"===(null==h?void 0:h.type)&&h.connectedRelation),f=r.getFormat().integration_id,v=e=>{let t=(0,W.jsx)(j.FormattedMessage,{id:"database.relationProperty.relatedPages.subHeader",defaultMessage:"{count, plural, one {{count} linked page} other {{count} linked pages}}",values:{count:e}});return f&&([m.f3,m.mQ].includes(f)?t=(0,W.jsx)(j.FormattedMessage,{id:"database.relationProperty.relatedGoogleDriveOrFigmaFiles.subHeader",defaultMessage:"{count, plural, one {{count} linked file} other {{count} linked files}}",values:{count:e}}):f===m.U9&&(t=(0,W.jsx)(j.FormattedMessage,{id:"database.relationProperty.relatedGithubPages.subHeader",defaultMessage:"{count, plural, one {{count} linked PR} other {{count} linked PRs}}",values:{count:e}}))),t},x=r.getFormatStore().getKeyStore("app_config_uri").getValue()===c.p$,b=[],S=[],P=e.filter((e=>{let{pageResult:t}=e;return t.type===me.Rt.SelectedPage})).length;e.map((e=>{if(e.pageResult.type===me.Rt.SearchPage){ge.G.createChildStore(t,e.pageResult.pointer).isTemplate()||S.push(kt(e,e.pageResult.pointer,this.environment,this.props,P))}else e.pageResult.type===me.Rt.SelectedPage&&b.push(kt(e,e.pageResult.pointer,this.environment,this.props,P))}));const M=[];if(b.length>0){const e=b.map((e=>e.key.toString()));M.push({key:"results",render:t=>(0,W.jsx)(Mt,{...t,title:x?void 0:Ct(this.props.property,this.props.schema)?(0,W.jsx)(j.FormattedMessage,{id:"database.relationProperty.relatedPages.limit.subHeader",defaultMessage:"Linked page"}):v(b.length),collectionStore:o,targetCollectionStore:r,property:i,showRight:"add"!==(null==p?void 0:p.type),disabled:!s,style:{paddingBottom:x?0:4},children:n&&!Ct(this.props.property,this.props.schema)&&e.length>1?(0,W.jsx)(Me.ZP,{direction:"vertical",keys:e,renderKey:o=>t.children[e.indexOf(o)],onDrop:this.handleDraggableListDrop,store:this.stores.draggableListStore}):t.children}),items:b})}if(!y&&(0===S.length&&0===b.length||S.length>0)){const e=x||a?void 0:S.length>0?b.length>0?(0,W.jsx)(j.FormattedMessage,{id:"database.relationProperty.unrelatedPages.anotherPage.subHeader",defaultMessage:"Link another page"}):(0,W.jsx)(j.FormattedMessage,{id:"database.relationProperty.unrelatedPages.subHeader",defaultMessage:"Link a page"}):(0,W.jsx)(j.FormattedMessage,{id:"database.relationProperty.noResults.subHeader",defaultMessage:"No results"});let t;a||0!==S.length||g.isMobile||y||!this.props.searchQuery||!(x&&S.length<1)&&x||(S.push({key:"empty",render:e=>(0,W.jsx)($,{targetCollectionStore:r,title:this.props.searchQuery||"",focused:e.focused,onClick:l,isSection:!1,index:this.props.index}),action:()=>{l&&l()}}),t={paddingBottom:0}),x&&(t={paddingBottom:0});const n={key:"unrelated",render:n=>(0,W.jsx)(Mt,{...n,title:e,collectionStore:o,targetCollectionStore:r,property:i,showRight:0===b.length||"add"===(null==p?void 0:p.type),disabled:!s,style:t}),items:S};"add"===(null==p?void 0:p.type)?M.unshift(n):M.push(n)}const R=[];let C;if(x&&!g.isMobile&&b.length>0&&!u){R.push({key:"sprints_backlog",render:e=>(0,W.jsx)(Ze,{focused:e.focused,onMouseEnter:e.onMouseEnter,targetCollectionStore:r,onClick:d,isSection:!1,index:this.props.index,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),action:()=>{d&&d()}}),C={paddingBottom:0,paddingTop:0};const e={key:"backlog",render:e=>(0,W.jsx)(Mt,{...e,collectionStore:o,targetCollectionStore:r,property:i,showRight:0===b.length||"add"===(null==p?void 0:p.type),disabled:!s,style:C}),items:R};M.push(e)}return y?(0,W.jsx)(xt,{blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,collectionStore:o,targetCollectionStore:r,sections:M,propertySchema:h,property:i,pageRecordStore:this.props.parentStore,search:this.props.searchQuery,relationPropertyMenuStore:this.props.relationPropertyMenuStore,addPage:this.props.addPage,addingPage:this.props.addingPage}):(0,W.jsx)(Ce.Z,{type:Ce.i.Vertical,store:this.stores.menuListStore,style:{padding:"4px 0px"},initialFocus:this.environment.device.isMobile?void 0:0,sections:M})}}function Pt(){return(0,W.jsx)("div",{style:{height:"100%",padding:me.wI,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,W.jsx)(Re.Z,{style:{margin:"0 auto"}})})}function Mt(e){window.__c={n:"RelationSectionHeader"};const{collectionStore:t,targetCollectionStore:o,property:r,showRight:i,disabled:n,style:s}=e,l=(0,a.VK)((()=>o.isSyncedCollection()),[o]),d=(0,a.VK)((()=>{const e=t.getSchema()[r];return Boolean(e&&u.NK(e))}),[t,r]);return(0,W.jsx)(z.Z,{...e,noTextOverflow:!0,isTitleUppercase:!1,right:i&&!l&&!d&&(0,W.jsx)(Fe.default,{collectionStore:t,targetCollectionStore:o,property:r,disabled:n}),style:{paddingTop:0,paddingBottom:4,...s},desktopTitleStyle:{height:19,alignItems:"center",marginTop:6,marginBottom:6,paddingLeft:12,paddingRight:9}})}St.displayName="RelationPropertyMenuResults",St.messages=(0,j.defineMessages)({noEditAccessForUnselectedRelation:{id:"collectionsRelationsPicker.noEditAccessForUnselectedRelation",defaultMessage:"Edit access required to add."},noEditAccessForSelectedRelation:{id:"collectionsRelationsPicker.noEditAccessForSelectedRelation",defaultMessage:"Edit access required to remove."}});const Rt=St;function Ct(e,t){const o=t[e];return Boolean(o&&"relation"===o.type&&1===o.limit)}function kt(e,t,o,r,i){const{disabled:n,canDrag:s,parentStore:a,collectionStore:l,targetCollectionStore:d,onAccept:p,property:u,schema:g,blockPropertyValueOverlayStore:h,onClickActionButton:y,handleClearProperty:m}=r,f=ge.G.createChildStore(a,t),v=d.getFormatStore().getKeyStore("app_config_uri").getValue()===c.p$;let x=s&&!Ct(u,g)&&!v;i&&(x=x&&i>1);return{key:f.id,render:r=>{const i=e.pageResult.type===me.Rt.SelectedPage;return(0,W.jsx)(we.Z,{disableTooltip:e.canEdit,renderTooltip:()=>{const e=i?St.messages.noEditAccessForSelectedRelation:St.messages.noEditAccessForUnselectedRelation;return oe.default.formatMessage(e)},render:s=>(0,W.jsx)(Ie.Z,{...r,canDrag:x&&i,collectionStore:l,targetCollectionStore:d,relatedPageStore:f,disabled:n||!e.canEdit,isSelected:i,pageStore:a,property:u,rowType:"popup",onActionButtonClick:()=>y(e.pageResult),blockPropertyValueOverlayStore:h,propertyLimit:Ct(u,g)?1:void 0,onOpenPageButtonClick:()=>{Pe.O([t],f,o,"relation_property")},handleClearProperty:()=>m(),...(0,Le.Z)(r,s)}),textWrap:!0})},action:t=>{p(e.pageResult,Te.DJ(t.event))}}}const jt=(0,j.defineMessages)({inputPlaceholder:{defaultMessage:"Link or create a page…",id:"relationPropertyMenu2.searchPlaceholder"},searchLinkedInputPlaceholder:{defaultMessage:"Search linked pages…",id:"relationPropertyMenu2.viewExisting.searchPlaceholder"},syncedCollectionInputPlaceholder:{defaultMessage:"Link a page",id:"relationPropertyMenu2.syncedCollection.searchPlaceholder"},connectedRelationInputPlaceholder:{defaultMessage:"Find a page",id:"relationPropertyMenu2.connectedRelation.searchPlaceholder"},connectedRelationGoogleDriveInputPlaceholder:{defaultMessage:"Paste in Google Drive or Google Docs link",id:"relationPropertyMenu2.connectedRelationGoogleDrive.searchPlaceholder"},connectedRelationFigmaInputPlaceholder:{defaultMessage:"Paste in https://figma.com/...",id:"relationPropertyMenu2.connectedRelationFigma.searchPlaceholder"},connectedRelationGithubInputPlaceholder:{defaultMessage:"Paste in https://github.com/...",id:"relationPropertyMenu2.connectedRelationGithub.searchPlaceholder"},sprintTypedPropertyInputAddPlaceholder:{defaultMessage:"Search...",id:"relationPropertyMenu2.sprintTypedPropertyInputAddPlaceholder.searchPlaceholder"},sprintTypedPropertyInputViewPlaceholder:{defaultMessage:"Search linked sprints…",id:"relationPropertyMenu2.sprintTypedPropertyInputViewPlaceholder.searchPlaceholder"}});class wt extends i.Z{constructor(){super(...arguments),this.storeTypes={store:xe,requestStore:he.Z},this.maybeOverwriteBaseUrlFromSpaceId=(0,ie.b)(this.environment),this.isMemberOfSpace=this.createComputedStore((()=>{var e;return null===(e=ce.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit()})),this.addPage=async e=>{const{collectionStore:t,blockPropertyValueOverlayStore:o,blockStore:r,schema:i,property:n}=this.props,s=this.getRenderState();if(!s)return;const{targetCollectionStore:a}=s,l=a.getFormat().integration_id,d=ue.Z.externalAuthentications.state.filter((e=>e.integration_id===l))[0],c=a.getFormat().pattern_name,p=ue.Z.integrations.state.find((e=>e.id===l)),{searchQuery:u}=this.stores.store.state,h=(0,ne.OY)(r)?r:void 0,y=(0,ne.OY)(r)?r.getPropertyStore(n):void 0;this.stores.store.setState({...this.stores.store.state,addingPage:!0});try{var f,v;if(!(t&&p&&h&&y))return;const r=g.rq(y.getValue()),s=e||u||"";if(!Zt({integration:p,patternName:c,url:s}))return void F.showDialog({items:[{label:(0,W.jsx)(j.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information"}),color:"blue",onAccept:()=>{Z.RD({environment:this.environment,stringValue:JSON.stringify({botId:null==d?void 0:d.parent_id,url:s},null,2),copiedMessage:Z.tq.copiedToClipboard})}},{label:(0,W.jsx)(j.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close"}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:(0,W.jsx)(j.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source."})});const l=i[n],x=g.Kp(l),b=x?y.id:void 0,S=g.gg(l),P=g.ic(l),M=g.U8(l),k=g.yF(l),L=P&&pe.default.checkGate("figma_connected_relation"),V=M&&pe.default.checkGate("zendesk_connected_relation"),A=k&&pe.default.checkGate("cron_connected_relation"),O=M&&pe.default.checkGate("zendesk_ai_enabled"),U=S&&pe.default.checkGate("google_drive_connected_relation"),K=(0,ee.NP)(p.id),E=(null==p?void 0:p.id)===m.U9?null===(f=K[0])||void 0===f?void 0:f.id:null==d?void 0:d.parent_id,G=x||U||V||A||L?K.map((e=>e.id)):[E],q=await B.yp({environment:this.environment,url:s,botIds:G,userDefinedExternalCollectionStore:a,relatedPageId:b});if(!q)return;const N=(null===(v=ye.default.state.data)||void 0===v?void 0:v.addOns)??[];if(O&&(0,C.de)(N)){const e=this.environment;_.getZendeskTicketConversation(e,{ticketUrl:s,spaceId:q.getSpaceId(),botId:G[0],pageId:y.id}),J.j(e,"zendesk_unfurl_ai")}D.createAndCommit({userAction:"connectedRelationPropertyMenuResults.createRelationPage",environment:this.environment,perform:e=>{const t={id:q.id,table:R.iU,spaceId:q.getSpaceId()},i=null!=l&&l.limit?[t]:[...r,t],s=g.ow(i);T.sO({store:y,value:s,transaction:e}),o&&o.state.isOpen&&o.state.collectionContextStore&&(I.rv({environment:this.environment,collectionContextStore:o.state.collectionContextStore,block_id:h.id,property:n,property_type:"relation",from:"relation_section",isFromBulkActionsToolbar:!1,integration_id:p.id,action:"add"}),w.kmb(this.environment,{...(0,te.Pn)(o.state.collectionContextStore),from:"relation_section",target_collection_id:a.id,integration_id:p.id}))}}),this.stores.store.reset()}finally{this.stores.store.setState({...this.stores.store.state,addingPage:!1})}},this.handleSearchInputChange=e=>{const t=e.target.value;this.stores.store.setState({...this.stores.store.state,searchQuery:t,searchLimit:xe.limitIncrement})},this.handleMobileTargetCollectionClick=()=>{const e=this.getRenderState();e&&(L.navigate({environment:this.environment,url:e.targetParentUrl}),w.ZZ8(this.environment,{from:this.props.analyticsFrom}))},this.handleMobileSearchInputClick=()=>{const e=this.stores.store.state;this.stores.store.setState({...this.stores.store.state,searchQuery:e.searchQuery,searchPopupOpen:!0,searchLimit:xe.limitIncrement})},this.handleSelectedPageClick=(e,t)=>{const{mainEditorCurrentBlockStore:o}=ce.default.state;if(!o)return;let r;if(t){const t=ge.G.createChildStore(o,e.pointer),i=t.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(t.getSpaceId()):void 0;r=(0,y.Z)({pageId:e.pointer.id,pageModel:t.getModel(),baseUrl:i,pageVisitSource:d.tY.LinkInPage})}else{const t=o.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(o.getSpaceId()):void 0;r=(0,y.Z)({pageId:o.id,pageModel:o.getModel(),baseUrl:t,peekViewBlockId:e.pointer.id,pageVisitSource:d.tY.LinkInPage})}L.navigate({environment:this.environment,url:r,openInNew:t}),w.XXm(this.environment,{from:this.props.analyticsFrom,meta_click:Boolean(t)})},this.handleValueRelationPropertyMenuResultsAccept=(e,t)=>{e.type===me.Rt.SelectedPage&&this.handleSelectedPageClick(e,t)},this.handleSearchRelationPropertyMenuResultsAccept=(e,t)=>{var o;if(this.props.disabled)return;const{value:r,onChange:i,overlayMode:n}=this.props,{mainEditorCurrentBlockStore:s}=ce.default.state;if(!s)return;const a=null===(o=this.getRenderState())||void 0===o?void 0:o.propertySchema.limit;if(e.type===me.Rt.SearchPage){var l,d,c,p;i({value:a?[e.pointer]:"add"===(null==n?void 0:n.type)?[...r.slice(0,n.index),e.pointer,...r.slice(n.index)]:[...r,e.pointer]}),w.dw6(this.environment,{from:this.props.analyticsFrom,collection_id:null===(l=this.props.collectionStore)||void 0===l?void 0:l.id,collection_view_id:null===(d=this.context.collectionContextStore)||void 0===d||null===(d=d.collectionViewStore())||void 0===d?void 0:d.id,collection_view_block_id:null===(c=this.context.collectionContextStore)||void 0===c||null===(c=c.collectionViewBlockStore())||void 0===c?void 0:c.id,target_collection_id:null===(p=this.getRenderState())||void 0===p||null===(p=p.targetCollectionStore)||void 0===p?void 0:p.id})}else e.type===me.Rt.SelectedPage&&this.handleSelectedPageClick(e,t)},this.handleCreateNewPage=e=>{var t,o,r;const{searchQuery:i}=this.stores.store.state,n=(0,P.ZP)(),s=null===(t=this.getRenderState())||void 0===t?void 0:t.targetCollectionStore.getSpaceId(),{value:a,onChange:l}=this.props,d=null===(o=this.getRenderState())||void 0===o?void 0:o.propertySchema.limit,c={id:n,table:R.iU,spaceId:s};l({newPage:{id:n,spaceId:s,name:i},value:d?[c]:e?[...a.slice(0,e),c,...a.slice(e)]:[...a,c]}),w.kmb(this.environment,{...(0,te.Pn)(this.context.collectionContextStore),from:this.props.analyticsFrom,target_collection_id:null===(r=this.getRenderState())||void 0===r||null===(r=r.targetCollectionStore)||void 0===r?void 0:r.id})},this.handleClearProperty=()=>{const{onChange:e}=this.props;e({value:[]})},this.handleClickActionButton=e=>{var t;const{value:o,onChange:r,overlayMode:i}=this.props,{mainEditorCurrentBlockStore:n}=ce.default.state;if(!n)return;const s=null===(t=this.getRenderState())||void 0===t?void 0:t.propertySchema.limit;if(e.type===me.Rt.SearchPage){var a;r({value:s?[e.pointer]:"add"===(null==i?void 0:i.type)?[...o.slice(0,i.index),e.pointer,...o.slice(i.index)]:[...o,e.pointer]}),w.dw6(this.environment,{from:this.props.analyticsFrom,...(0,te.Pn)(this.context.collectionContextStore),target_collection_id:null===(a=this.getRenderState())||void 0===a||null===(a=a.targetCollectionStore)||void 0===a?void 0:a.id})}else if(e.type===me.Rt.SelectedPage){var l;r({value:s?[]:o.filter((t=>t.id!==e.pointer.id))}),w.WFT(this.environment,{...(0,te.Pn)(this.context.collectionContextStore),from:this.props.analyticsFrom,target_collection_id:null===(l=this.getRenderState())||void 0===l||null===(l=l.targetCollectionStore)||void 0===l?void 0:l.id})}var d;s&&(null===(d=this.props.blockPropertyValueOverlayStore)||void 0===d||d.setState({isOpen:!1}))},this.handleRelationPropertyMenuResultsDrag=e=>{const{collectionStore:t,onChange:o}=this.props;o({value:e.map((e=>({id:e,spaceId:t.pointer.spaceId,table:R.iU})))}),w.yT1(this.environment,{from:this.props.analyticsFrom})},this.handleMobileSearchMenuClickRight=()=>{this.resetInputState()},this.handleSearchScrollOffsetChange=e=>{const{store:t,requestStore:o}=this.stores,{loading:r,result:i}=o.state;e<xe.incrementScrollOffset&&i&&!r&&i.results.length>=t.state.searchLimit&&t.setState({...t.state,searchLimit:t.state.searchLimit+xe.limitIncrement})},this.performSearchRequest=async e=>{const{disabled:t}=this.props,o={results:[],query:e.query},r=this.getRenderState();if(!r)return o;if(t)return o;if(g.gg(r.propertySchema)||g.ic(r.propertySchema))return o;const{targetCollectionStore:i}=r;let n=[];if(i.getFormatStore().getKeyStore("app_config_uri").getValue()===c.p$)try{return n=Lt(await async function(e){const{environment:t,sprintCollectionStore:o,searchQuery:r}=e,i=o.getPropertyMapping(),n=null==i?void 0:i[p.b0.StatusV2],s=null==i?void 0:i[p.b0.Dates];if(!n||!s)throw new Error("Sprints database does not have the required properties");const a="results",l={type:"reducer",userTimeZone:(0,v.r)(),searchQuery:r,sort:[{property:n,direction:"ascending"},{property:s,direction:"ascending"}],reducers:{[a]:{type:"results",limit:100}}},d=o.getParentBlockStore();if(!d)return[];await d.load();const c=d.getCollectionViewStores()[0];if(!c)return[];const u=o.getSpaceId(),g=await _.queryCollection(t,{source:{type:"collection",id:o.id,spaceId:u},collectionView:{id:c.id,spaceId:u},loader:l},void 0,{src:"relation_property_menu"});if("success"!==g.type)return[];const h=g.data.result.reducerResults[a];if("results"!==h.type)return[];return h.blockIds}({environment:this.environment,sprintCollectionStore:i,searchQuery:e.query}),i,r.propertySchema,this.props.value),{results:n,query:e.query}}catch(s){}try{const t=await ae.deps.searchActions.loader(),{results:o}=await t.searchPagesInCollection({environment:this.environment,query:e.query,collectionId:i.id,limit:e.limit,spaceId:i.getSpaceId(),excludeTemplates:!0,source:"relation_menu",includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!0,ignoresHighlight:!0});n=Lt(o,i,r.propertySchema,this.props.value)}catch(s){f.log({level:"error",from:"relationPropertyMenu",type:"search",error:(0,b.Ui)(s)})}return{results:n,query:e.query}},this.getRecordModel=S.om.fromMonomorphicFunctionUnsafe((e=>ge.G.createChildStore(this.props.blockStore,e).getRecordModel(e)),M.mF.fromMonomorphicFunctionUnsafe((e=>{const t=ge.G.createChildStore(this.props.blockStore,e);return t.computeWithRecordValues((e=>{let{getRecordValueAndSubscribe:o}=e;return o(t)}))})))}didMount(){super.didMount(),n.default.afterNextFlush((()=>{n.default.afterNextFlush((()=>{const e=this.getRenderState();if(e){0===this.getValueResults(e).length&&this.stores.store.setState({searchPopupOpen:this.environment.device.isMobile,searchQuery:this.props.insertChar??"",searchLimit:xe.limitIncrement,addingPage:!1})}}))}))}renderComponent(){const{device:e}=this.environment,t=this.getRenderState();if(t)return(0,W.jsx)(A.Z,{capture:!0,allowMenuList:!0,allowEsc:!0,allowUndo:!0,allowTabUntab:!0,render:()=>e.isMobile?this.renderMobileMenu(t):this.renderDesktopMenu(t)})}renderDesktopMenu(e){const{searchQuery:t}=this.stores.store.state,o=this.stores.requestStore.state.result,{blockStore:r,disabled:i,analyticsFrom:n,overlayMode:s}=this.props,{targetCollectionStore:a}=e,l=Boolean(ue.Z.bots.state.find((e=>e.integration_id===m.U9))),d=g.Kp(e.propertySchema),c=g.gg(e.propertySchema),p=g.ic(e.propertySchema),u=g.U8(e.propertySchema),h=d&&!l||(c||p||u)&&!this.isMemberOfSpace.state,y=s&&"add"===s.type?s.index:void 0;return(0,W.jsx)(E.Z,{menuType:re.og.Popup,header:h?null:(0,W.jsx)(It,{store:this.stores.store,disabled:i,renderState:e,blockStore:r,analyticsFrom:n,isConnectedRelation:Boolean(e.propertySchema.connectedRelation),overlayMode:s,addPage:this.addPage}),footer:this.renderFooter({requestStateResult:o,searchQuery:t,overlayMode:s,disabled:i,targetCollectionStore:a,index:y,propertySchema:e.propertySchema}),children:(0,W.jsx)("div",{style:{overflow:"hidden",maxHeight:"70vh"},children:this.renderSearchResults(e)})})}renderFooter(e){const{requestStateResult:t,searchQuery:o,overlayMode:r,disabled:i,targetCollectionStore:n,index:s,propertySchema:a}=e;return!(n.getFormatStore().getKeyStore("app_config_uri").getValue()===c.p$)&&"view"===(null==r?void 0:r.type)||i||a.connectedRelation?null:t&&t.results.length>0&&o&&(0,W.jsx)($,{targetCollectionStore:n,title:o,onClick:this.handleCreateNewPage,focused:!1,isSection:!0,index:s})}renderMobileMenu(e){const{device:t}=this.environment,{searchPopupOpen:o}=this.stores.store.state,{collectionStore:r,property:i,schema:n,blockStore:s,blockPropertyValueOverlayStore:a,disabled:l,canConfigureCollection:d,onDismiss:c}=this.props,{showProperties:p,targetCollectionStore:h}=e,{mediumTextColor:y}=this.theme,f=this.getValueResults(e),v=n[i],b=v&&u.NK(v),S=Boolean(ue.Z.bots.state.find((e=>e.integration_id===m.U9))),P=Boolean(ue.Z.bots.state.find((e=>e.integration_id===m.f3))),M=Boolean(ue.Z.bots.state.find((e=>e.integration_id===m.mQ))),R=g.Kp(e.propertySchema),C=g.gg(e.propertySchema),k=g.ic(e.propertySchema),w=R&&!S||C&&!P||k&&!M;return(0,W.jsxs)(E.Z,{menuType:re.og.Modal,title:e.propertySchema.name,right:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Done",id:"relationPropertyMenu.mobileMenuDone.button"}),onClickRight:c,children:[b?null:(0,W.jsx)(z.Z,{disableMobilePadding:!0,children:(0,W.jsx)(V.Z,{focused:!1,title:(0,W.jsx)("div",{style:{display:"flex"},children:(0,W.jsx)(j.FormattedMessage,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",values:{regular:e=>e,databaseWithIcon:(0,W.jsxs)("div",{style:{display:"flex",marginLeft:2*me.Qi},children:[(0,W.jsx)(q.Z,{disabled:!0,icon:h.getIcon(),isEmptyPage:!1,size:20}),(0,W.jsx)(N.Z,{store:h,underline:!0,style:{marginLeft:me.Qi}})]})}})}),showExtensionArrow:!1,onClick:this.handleMobileTargetCollectionClick})}),w?null:(0,W.jsx)(z.Z,{topBorder:!0,disableMobilePadding:!1,children:(0,W.jsx)(G.GI,{popupType:G.kQ.SlideUp,open:o,origin:(0,W.jsx)(V.Z,{focused:!1,title:(0,W.jsxs)("span",{style:{display:"flex",alignItems:"center"},children:[(0,x.R)({marginRight:8,width:t.isMobile?16:14,height:t.isMobile?16:14}),(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Add a page",id:"relationPropertyMenu.addAPage.button"})]}),onClick:this.handleMobileSearchInputClick,style:{color:y}}),render:()=>this.renderSearchResults(e)})}),(0,W.jsx)(Rt,{collectionStore:r,targetCollectionStore:h,showProperties:p,results:f,resultsType:"existing",property:i,schema:n,parentStore:s,disabled:l,canConfigureCollection:d,loading:!1,canDrag:!1,blockPropertyValueOverlayStore:a,onAccept:this.handleValueRelationPropertyMenuResultsAccept,onClickActionButton:this.handleClickActionButton,onCreatePage:this.handleCreateNewPage,handleClearProperty:this.handleClearProperty,relationPropertyMenuStore:this.stores.store,addPage:this.addPage,addingPage:this.stores.store.state.addingPage})]})}renderSearchResults(e){const{device:t}=this.environment,{collectionStore:o,value:r,property:i,schema:n,blockStore:s,blockPropertyValueOverlayStore:a,disabled:l,canConfigureCollection:d,overlayMode:c}=this.props,{requestStore:p}=this.stores,{showProperties:y,targetCollectionStore:m,propertySchema:f}=e,{searchQuery:x,searchLimit:b}=this.stores.store.state;let S=le.default.mark("rum.relation_search_query");const P=f.limit?r.slice(0,1):r,M={request:{query:x,limit:b},debounce:de.vp,performRequest:this.performSearchRequest,render:(r,p)=>{let b=[];b=x?this.getValueResults(e).filter((e=>{let{pageResult:t}=e;const o=ge.G.createChildStore(this.props.blockStore,t.pointer),r=o.getModel();if(r)return(0,h.fY)({block:r,query:x,getRecordModel:o.getRecordModel,userTimeZone:(0,v.r)(),schema:n,intl:oe.default.getIntl(),onlyPropertyIds:["title"]})})):this.getValueResults(e);const M=!p&&0===b.length,R=b;p&&p.results.forEach((e=>{const t=e.pageResult;if((t.type===me.Rt.SelectedPage||t.type===me.Rt.SearchPage)&&b.find((e=>(e.pageResult.type===me.Rt.SelectedPage||e.pageResult.type===me.Rt.SearchPage)&&e.pageResult.pointer.id===t.pointer.id)))return;const o=e.pageResult.type!==me.Rt.NewPage?P.map((e=>e.id)).includes(e.pageResult.pointer.id):void 0;o&&!x&&"add"===(null==c?void 0:c.type)||(e.pageResult.type===me.Rt.SearchPage&&o?R.push({...e,pageResult:{...e.pageResult,type:me.Rt.SelectedPage}}):e.pageResult.type!==me.Rt.SelectedPage||o?R.push(e):R.push({...e,pageResult:{...e.pageResult,type:me.Rt.SearchPage}}))})),!M&&""!==x&&S&&p&&p.query===x&&(le.default.measure(S,{environment:this.environment}),S=void 0);const C=(0,W.jsx)(Rt,{collectionStore:o,targetCollectionStore:m,showProperties:y,results:R,resultsType:0===R.length&&0===this.getValueResults(e).length?"existing":"search",property:i,schema:n,parentStore:s,disabled:l,canConfigureCollection:d,loading:M,canDrag:!l&&0===x.length,blockPropertyValueOverlayStore:a,onAccept:this.handleSearchRelationPropertyMenuResultsAccept,onClickActionButton:this.handleClickActionButton,onScrollOffsetChange:this.handleSearchScrollOffsetChange,onDrag:this.handleRelationPropertyMenuResultsDrag,onCreatePage:this.handleCreateNewPage,handleClearProperty:this.handleClearProperty,searchQuery:x,overlayMode:c,relationPropertyMenuStore:this.stores.store,addPage:this.addPage,addingPage:this.stores.store.state.addingPage});if(t.isMobile){let e=oe.default.formatMessage(jt.inputPlaceholder);const o=u.NK(f);return o&&(e=oe.default.formatMessage(jt.connectedRelationInputPlaceholder)),g.gg(f)&&(e=oe.default.formatMessage(jt.connectedRelationGoogleDriveInputPlaceholder)),g.ic(f)&&(e=oe.default.formatMessage(jt.connectedRelationFigmaInputPlaceholder)),g.Kp(f)&&(e=oe.default.formatMessage(jt.connectedRelationGithubInputPlaceholder)),(0,W.jsx)(E.Z,{menuType:re.og.Modal,title:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Relation",id:"relationPropertyMenu.mobileRelationMenu.title"}),left:(0,W.jsx)(Tt,{}),right:(0,W.jsx)(j.FormattedMessage,{defaultMessage:"Done",id:"relationPropertyMenu.mobileDoneButton"}),header:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(U.ZP,{value:x,disabled:l,onChange:this.handleSearchInputChange,placeholder:e,showClearButton:!0,focus:!t.isMobile||void 0,focusInitial:!0,style:{...t.isAndroid&&{borderBottom:"none"}}}),x&&!l&&!o&&(0,W.jsx)($,{targetCollectionStore:m,title:x,onClick:this.handleCreateNewPage,focused:!1,isSection:!0})]}),onClickRight:this.handleMobileSearchMenuClickRight,children:C})}return C}};return(0,W.jsx)(X.Z,{...M,requestStore:p})}getRenderState(){const{schema:e,property:t,blockStore:o,collectionStore:r}=this.props,i=e[t];if(!i||"relation"!==i.type)return;const n=u.j0(i);if(!n)return;const s=ge.NW.createChildStore(o,n),a=s.getParentId();if(!a)return;const l=ge.G.createChildStore(s,{table:R.iU,id:a}),d=u.oC({id:s.id,schema:s.getSchema(),format:s.getFormat(),space_id:s.getSpaceId()}),c=[d[`${g.UU}title`]?`${g.UU}title`:"title"],p=l.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(l.getSpaceId()):void 0,h=(0,y.Z)({pageId:l.id,pageModel:l.getModel(),baseUrl:p,pageVisitSource:void 0});return{propertySchema:i,property:t,targetCollectionStore:s,targetParentBlock:l,showProperties:c,targetCollectionSchema:d,targetParentUrl:h,collectionStore:r}}resetInputState(){this.stores.store.reset()}getValueResults(e){const{value:t,overlayMode:o}=this.props,{propertySchema:r,targetCollectionStore:i}=e,{searchQuery:n}=this.stores.store.state;return n||"add"!==(null==o?void 0:o.type)?g.j$({relationValue:t,propertySchema:r,getRecordModel:this.getRecordModel}).map((e=>({pageResult:{key:e.id,type:me.Rt.SelectedPage,pointer:e},canEdit:Ft(i,r,e)}))):[]}}function It(e){var t;window.__c={n:"RelationPropertyMenuInput"};const o=(0,s.O7)(),r=(0,s.Fy)(),{targetParentUrl:i,targetCollectionStore:n,propertySchema:d}=e.renderState,[p,u,h]=(0,a.AF)(e.store),{searchQuery:y,searchPopupOpen:m}=p,f=(0,a.VK)((()=>n.getIcon()),[n]),v=(0,a.VK)((()=>n.isSyncedCollection()),[n]),x=(0,a.VK)((()=>g.Kp(d)),[d]),b=(0,a.VK)((()=>g.gg(d)),[d]),S=(0,a.VK)((()=>g.ic(d)),[d]),P=(0,a.VK)((()=>n.getFormatStore().getKeyStore("app_config_uri").getValue()===c.p$),[n]),M=(0,l.yK)((e=>({regular:{color:e.mediumTextColor,whiteSpace:"nowrap",marginLeft:4},headerWrap:{display:"flex",width:"100%",position:"relative",zIndex:2,padding:"6px 10px",fontSize:14,background:e.inputBackground,boxShadow:`\n\t\t\t\t\t0 1px 0 ${e.darkDividerColor}\n\t\t\t\t`},recordTitle:{fontWeight:k.Z.fontWeight.semibold,fontSize:14,marginLeft:me.Qi*(r.isRetina?.5:1)},searchIcon:{fill:e.mediumIconColor,width:14,height:14,marginRight:10}})),[r.isRetina]);let R=jt.inputPlaceholder;if(v)R=jt.syncedCollectionInputPlaceholder;else if(x)R=jt.connectedRelationGithubInputPlaceholder;else if(b)R=jt.connectedRelationGoogleDriveInputPlaceholder;else if(S)R=jt.connectedRelationFigmaInputPlaceholder;else if(P){var C;"view"===(null===(C=e.overlayMode)||void 0===C?void 0:C.type)&&(R=jt.sprintTypedPropertyInputViewPlaceholder),R=jt.sprintTypedPropertyInputAddPlaceholder}else e.isConnectedRelation?R=jt.connectedRelationInputPlaceholder:("view"===(null===(t=e.overlayMode)||void 0===t?void 0:t.type)||e.disabled)&&(R=jt.searchLinkedInputPlaceholder);const I=oe.default.formatMessage(R);return(0,W.jsxs)("div",{style:M.headerWrap,children:[(0,W.jsx)(O.Z,{style:{flexGrow:1},value:y,placeholder:I,forceShowClearButton:Boolean(y||m),focus:!0,onChange:e=>{const t=e.target.value;u({...p,searchQuery:t,searchPopupOpen:!!t,searchLimit:xe.limitIncrement})},onClearButtonClick:()=>{u(h.getInitialState())},onClick:()=>{u({...p,searchQuery:p.searchQuery,searchPopupOpen:!0,searchLimit:xe.limitIncrement})},onKeyDown:e=>{"Escape"===e.key&&u(h.getInitialState())},format:O.B.Transparent,onSubmit:()=>(()=>{const t=n.getFormat().integration_id,o=ue.Z.integrations.state.find((e=>e.id===t)),r=n.getFormat().pattern_name;if(!o||!r)return;Zt({integration:o,patternName:r,url:p.searchQuery})&&e.addPage()})()}),!e.isConnectedRelation&&!P&&(0,W.jsx)("div",{style:{display:"flex",marginLeft:10,alignItems:"center"},children:(0,W.jsx)(j.FormattedMessage,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",values:{regular:e=>(0,W.jsx)("span",{style:M.regular,children:e}),databaseWithIcon:(0,W.jsxs)(K.Z,{href:i,style:{marginLeft:me.Qi},innerStyle:{display:"flex"},onClick:()=>{w.ZZ8(o,{from:e.analyticsFrom})},children:[(0,W.jsx)(q.Z,{disabled:!0,icon:f,isEmptyPage:!1,size:20}),(0,W.jsx)(N.Z,{store:n,underline:!0,style:M.recordTitle})]})}})})]})}wt.displayName="RelationPropertyMenu",wt.contextTypes={...i.w,...Y.xm};const _t=wt,Zt=e=>{var t;if(e.patternName)return null===(t=e.integration.info)||void 0===t||null===(t=t.original_url_patterns)||void 0===t?void 0:t.filter((t=>{var o;return t.name===e.patternName&&(null===(o=t.additional_types)||void 0===o?void 0:o.connectedRelation)})).find((t=>{let{regex:o}=t;return new RegExp(o).test(e.url)}))};function Ft(e,t,o){if(!(Boolean(t.property)&&pe.default.checkGate("collections_relation_picker_require_edit_perms")))return!0;return ge.G.createChildStore(e,o).canEdit()}function Tt(){return(0,W.jsx)(Q.Z,{href:(0,se.UY)("guides.relations"),analyticsFrom:"relation_menu"})}function Lt(e,t,o,r){const i=new Set(r.map((e=>e.id))),n=[];return e.forEach((e=>{const r={spaceId:t.getSpaceId(),id:e,table:R.iU},s=Ft(t,o,r);if(i.has(e)){const t={key:e,type:me.Rt.SelectedPage,pointer:r};n.push({pageResult:t,canEdit:s})}else{const t={key:e,type:me.Rt.SearchPage,pointer:r};n.push({pageResult:t,canEdit:s})}})),n}},13148:(e,t,o)=>{o.d(t,{U:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("close",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M2.89795 13.3428C3.18799 13.6262 3.6626 13.6262 3.93945 13.3494L7.99341 9.29541L12.0474 13.3494C12.3308 13.6262 12.8054 13.6328 13.0889 13.3428C13.3723 13.0593 13.3723 12.5847 13.0955 12.3079L9.0415 8.24731L13.0955 4.19336C13.3723 3.9165 13.3789 3.4353 13.0889 3.15845C12.7988 2.875 12.3308 2.875 12.0474 3.15186L7.99341 7.20581L3.93945 3.15186C3.6626 2.875 3.1814 2.86841 2.89795 3.15186C2.6145 3.44189 2.62109 3.9231 2.89795 4.19336L6.9519 8.24731L2.89795 12.3079C2.62109 12.5781 2.6145 13.0659 2.89795 13.3428Z"})})},89767:(e,t,o)=>{o.d(t,{R:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionInbox",{viewBox:"0 0 14 14",svg:(0,i.jsx)("path",{d:"M11.0918,0 C11.5383,0 11.9307,0.295898 12.0533,0.725586 L13.9615,7.40332 C13.9871,7.49316 14,7.58594 14,7.67871 L14,13 C14,13.5527 13.5522,14 13,14 L1,14 C0.447754,14 0,13.5527 0,13 L0,7.67871 C0,7.58594 0.0129395,7.49316 0.0384521,7.40332 L1.94666,0.725586 C2.06934,0.295898 2.46167,0 2.9082,0 L11.0918,0 Z M4.27271,1.5 C3.83728,1.5 3.45178,1.78223 3.31982,2.19727 L1.91455,6.61328 C1.70947,7.25879 2.1908,7.91699 2.86755,7.91699 L4.70837,7.91699 C4.70837,8.93652 5.16663,10.168 7,10.168 C8.83337,10.168 9.29163,8.93652 9.29163,7.91699 L11.1478,7.89355 C11.8201,7.88477 12.2927,7.22852 12.0876,6.58887 L10.681,2.19531 C10.5485,1.78125 10.1635,1.5 9.72864,1.5 L4.27271,1.5 Z"})})},39132:(e,t,o)=>{o.d(t,{c:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("eye",{viewBox:"0 0 32 32",svg:(0,i.jsx)("path",{d:"M16.006 25.812c8.863 0 14.994-7.17 14.994-9.406C31 14.16 24.858 7 16.006 7 7.252 7 1 14.16 1 16.406c0 2.236 6.252 9.406 15.006 9.406zm0-3.242a6.194 6.194 0 01-6.197-6.164c-.012-3.452 2.744-6.164 6.197-6.164 3.419 0 6.185 2.711 6.185 6.164 0 3.364-2.766 6.164-6.185 6.164zm0-3.94c1.228 0 2.246-1.007 2.246-2.224 0-1.228-1.018-2.235-2.246-2.235-1.24 0-2.258 1.007-2.258 2.235 0 1.217 1.018 2.224 2.258 2.224z"})})},16184:(e,t,o)=>{o.d(t,{Q:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("lockedFilled",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M4.69141 14.6338H11.3018C12.2178 14.6338 12.6689 14.1826 12.6689 13.1914V8.08496C12.6689 7.18945 12.293 6.72461 11.541 6.64941V4.96094C11.541 2.36328 9.81152 1.1123 7.99316 1.1123C6.18164 1.1123 4.45215 2.36328 4.45215 4.96094V6.67676C3.74805 6.78613 3.32422 7.2373 3.32422 8.08496V13.1914C3.32422 14.1826 3.77539 14.6338 4.69141 14.6338ZM5.75098 4.83105C5.75098 3.22461 6.76953 2.35645 7.99316 2.35645C9.2168 2.35645 10.2422 3.22461 10.2422 4.83105V6.64258L5.75098 6.64941V4.83105Z"})})},22686:(e,t,o)=>{o.d(t,{f:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("person",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M7.7832 8.00195C9.27344 8.00195 10.5381 6.67578 10.5381 4.95996C10.5381 3.28516 9.2666 2 7.7832 2C6.29297 2 5.01465 3.30566 5.02148 4.97363C5.02148 6.67578 6.28613 8.00195 7.7832 8.00195ZM3.51758 14.3594H12.0352C13.1631 14.3594 13.5527 14.0176 13.5527 13.3887C13.5527 11.6318 11.3242 9.21191 7.77637 9.21191C4.23535 9.21191 2 11.6318 2 13.3887C2 14.0176 2.38965 14.3594 3.51758 14.3594Z"})})},14734:(e,t,o)=>{o.d(t,{X:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("personCrossedOut",{viewBox:"0 0 44 44",svg:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:"M5.4857 44H0L44 8.56549V13.0061L5.4857 44Z"}),(0,i.jsx)("path",{d:"M39.8048 44H8.66491L25.6448 30.4378C26.9394 30.6489 28.1581 30.9719 29.3009 31.4067C31.5362 32.2374 33.4346 33.326 34.9964 34.6723C36.5725 36.0044 37.7761 37.4367 38.6071 38.9692C39.4525 40.5018 39.8752 41.9555 39.8752 43.3305C39.8752 43.5675 39.8517 43.7906 39.8048 44Z"}),(0,i.jsx)("path",{d:"M30.3971 16.7973C30.3971 16.8668 30.3965 16.9359 30.3952 17.0048L19.3828 25.9192C18.7467 25.7134 18.1339 25.4228 17.5446 25.0473C16.2408 24.2023 15.1876 23.0708 14.3853 21.6528C13.5972 20.2205 13.2032 18.6163 13.2032 16.8403C13.2032 15.0929 13.5972 13.5174 14.3853 12.1137C15.1876 10.7101 16.2408 9.60007 17.5446 8.78366C18.8485 7.96725 20.267 7.55905 21.8001 7.55905C23.3332 7.55905 24.7517 7.96009 26.0556 8.76218C27.3595 9.56426 28.4054 10.6671 29.1935 12.0708C29.9959 13.4601 30.3971 15.0356 30.3971 16.7973Z"})]})})},75071:(e,t,o)=>{o.d(t,{f:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("plusThick",{viewBox:"0 0 14 14",svg:(0,i.jsx)("path",{d:"M2 7.16357C2 7.59692 2.36011 7.95093 2.78735 7.95093H6.37622V11.5398C6.37622 11.9731 6.73022 12.3271 7.16357 12.3271C7.59692 12.3271 7.95093 11.9731 7.95093 11.5398V7.95093H11.5398C11.9731 7.95093 12.3271 7.59692 12.3271 7.16357C12.3271 6.73022 11.9731 6.37622 11.5398 6.37622H7.95093V2.78735C7.95093 2.36011 7.59692 2 7.16357 2C6.73022 2 6.37622 2.36011 6.37622 2.78735V6.37622H2.78735C2.36011 6.37622 2 6.73022 2 7.16357Z"})})}}]);