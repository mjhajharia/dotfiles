"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[4544],{58188:(e,t,o)=>{o.d(t,{Lg:()=>m,N:()=>p,Rt:()=>g,aG:()=>u});var n=o(13493),i=o(29369),r=o(39699),a=o(77907),s=o(30806),l=o(80444),c=o(14900),d=o(72711);function u(e){const{environment:t,currentSpaceViewStore:o,...n}=e,i=o.getModel();if(!i)return;const a=!i.showFeatureOnPersonalHome(e.feature);r.createAndCommit({userAction:"userHomeActions.toggleHomeFeature",environment:t,perform:t=>{r.applyOperation({store:o,operation:{pointer:o.pointer,path:["settings","personal_home","enabled_features"],command:"update",args:{[e.feature]:a}},transaction:t})}}),(0,s.cY)({environment:t,show:a,...n})}function p(e){let{environment:t,option:o,from:n,userAction:i}=e;const a=l.default.state.currentSpaceViewStore;if(!a)return!1;const c=a.getOnAppStartStore().getValue();return r.createAndCommit({userAction:i,environment:t,perform:e=>{r.applyOperation({store:a,operation:{pointer:a.pointer,path:["settings","on_app_start"],command:"set",args:o},transaction:e})}}),(0,s.BX)({environment:t,oldValue:c,newValue:o,from:n}),!0}async function g(e){const{environment:t,personalHomeStore:o}=e,n=null==o?void 0:o.getCoverStore();if(!o||!n||n.getValue())return;const i=(await a.deps.pageCovers.loader()).default;r.createAndCommit({userAction:"userHomeActions.addCoverPhoto",environment:t,perform:e=>{d.tk({transaction:e,store:o,coverStore:n,pageCovers:i})}})}function m(e){const{environment:t,selectedStore:o,currentSpaceViewStore:a,collectionContextStore:l}=e,d=l.collectionViewStore(),u=l.collectionStore(),p=l.collectionViewBlockStore();if(!(u&&d&&p&&a))return;const g=a.getTeamsStores(),m=o.table===i.e0?g.indexOf(o)+1:0,S=o.table===i.e0?o.id:void 0;r.createAndCommit({environment:t,userAction:"PersonalHomeTrendingPanel.setCollectionViewSourceTeamId",perform:e=>{r.applyOperation({store:d,operation:{pointer:{id:d.id,table:n.n},path:["format","collection_view_source","teamId"],command:"set",args:S},transaction:e}),c.mc({environment:t,collectionViewBlockStore:p,collectionViewStore:d,collectionStore:u,collectionContextStore:l,isFullScreen:!1,isRootChild:!1,isInPeekRenderer:!1})}}),(0,s.Ay)({environment:t,teamId:S,index:m})}},36821:(e,t,o)=>{o.d(t,{Xx:()=>A,ae:()=>P,m8:()=>I,nn:()=>V,ys:()=>F});var n=o(30120),i=o(15145),r=o(92996),a=o(99036),s=o(53877),l=o(4615),c=o(98963),d=o(18844),u=o(21202),p=o(15047),g=o(29369),m=o(39927),S=o(16732),y=o(40663),h=o(77907),f=o(80444),x=o(77080),v=o(26350),C=o(54642),b=o(16956),w=o(5149),j=o(96802),M=o(9953),_=o(75018),k=o(39699),T=o(39865);function A(e){var t;const{environment:o,transaction:n,tasksBlockStore:i,sprintsBlockStore:r}=e;if(!x.default.checkGate("recurring_sprints"))return;const a=null===(t=r.getFormat())||void 0===t?void 0:t.collection_pointer,s=i.getFormat().collection_pointer;a&&s&&P({environment:o,transaction:n,sprintCollectionStore:v.NW.createChildStore(r,a),taskCollectionStore:v.NW.createChildStore(i,s),sprintSettingsConfig:m.i})}function P(e){const{environment:t,sprintSettingsConfig:o,transaction:n,sprintCollectionStore:i,taskCollectionStore:r}=e,a=i.getSpaceId(),s=(0,l.ZP)(),u=(0,l.ZP)();M.ae({environment:t,table:c.cv,inMemoryRecordCache:i.inMemoryRecordCache,value:{id:s,parent_id:i.id,parent_table:i.table,alive:!0,space_id:a,status:o.autoCompleteSprints?"active":"disabled",trigger:{id:(0,l.ZP)(),type:"recurrence",recurrence:Z(o)},action_ids:[u]},transaction:n}),j.FH({stores:[i],update:{automation_ids:[...i.getFormat().automation_ids??[],s]},transaction:n}),M.ae({environment:t,table:d.Xj,inMemoryRecordCache:i.inMemoryRecordCache,transaction:n,value:{id:u,parent_id:s,parent_table:c.cv,type:"complete_sprint",alive:!0,space_id:a,config:{sprint_collection:i.getSpaceShardedPointer(),task_collection:r.getSpaceShardedPointer(),complete_sprint_action:o.actionConfig.complete_sprint_action}}})}function V(e){const{automationStore:t,transaction:o,sprintSettingsConfig:n,actionStore:i}=e;M.sW({store:i.getConfigStore(),data:{...n.actionConfig},transaction:o}),M.sW({store:t,data:{status:n.autoCompleteSprints?"active":"disabled"},transaction:o}),M.sW({store:t.getTriggerStore().getKeyStore("recurrence"),data:{...n.recurrenceConfig},transaction:o})}async function F(e){var t;const{appTemplatesSetupActions:o,appTemplatesSprintBoardActions:n,appConfigs:i}=await h.deps.AppTemplates.loader(),{environment:r,collectionContextStore:a}=e,{currentSpaceViewStore:s}=f.default.state,l=a.collectionStore(),c=null==l?void 0:l.getParentBlockStore(),d=null==c?void 0:c.getParentStore(),m=null==l||null===(t=l.getFormat())||void 0===t?void 0:t.app_config_uri,x=m&&(0,y.YB)(i(),m);if(!l||!c||!d||!s||d.table!==p.bx&&d.table!==u.iU&&d.table!==g.e0||!x)return;const b=c.getFormat().app_id,j=b?await C.getCollectionViewBlocksByAppId(r,{spaceId:c.getSpaceId(),appId:b}):void 0,M="success"===(null==j?void 0:j.type)&&j.data.result.length?j.data.result.map((e=>v.G.createChildStore(d,{table:u.iU,id:e.blockId,spaceId:c.getSpaceId()}))):[c];await B({environment:r,taskCollectionStore:l,executeFn:()=>{k.createAndCommit({userAction:"sprintSettingsActions.handleTurnOnSprints",environment:r,perform:e=>{const t=o.applyFeatures({environment:r,spaceViewStore:s,appParentStore:d,appUri:x.uri,features:[{type:"simple",featureUri:(0,S.eu)().uri}],transaction:e,createOrModify:"modify",appCollectionViewBlockStores:M});n.createSprintPage({environment:r,spaceViewStore:s,appParentStore:d,transaction:e,blockStores:t,creationEntryPoint:{type:"sprint_settings"}}),w.E3({collectionSettingsStore:a.settingsStore})}})}})}async function I(e){const{environment:t,collectionContextStore:o,sprintSettingsContext:n,sprintBoardViewBlockIds:r}=e,{sprintCollectionStore:a,automationContext:s,currentCollectionViewBlockStore:l,sprintCollectionViewBlockStore:c,taskCollectionStore:d,taskCollectionViewBlockStore:p}=n;if(!a||!c||!s)return;const g=p.getSpaceId(),m=[c,...r.map((e=>new v.G(t,{id:e,table:u.iU,spaceId:g})))];l.id===p.id?w.E3({collectionSettingsStore:o.settingsStore}):_.navigateToPage({environment:t,store:p,pageVisitSource:i.tY.LeaveOrRemove}),await B({environment:t,taskCollectionStore:d,executeFn:()=>{k.createAndCommit({userAction:"sprintSettingsActions.handleTurnOffSprints",environment:t,perform:e=>{!function(e){const{transaction:t,automationStore:o,blocksToDelete:n,environment:i,sprintCollectionStore:r}=e;M.sW({store:r,transaction:t,data:{alive:!1}}),M.sW({store:o,transaction:t,data:{alive:!1}}),T.y8({environment:i,blocks:n,transaction:t,permanentlyDelete:!0})}({environment:t,transaction:e,automationStore:s.automationStore,blocksToDelete:m,sprintCollectionStore:a})}})}})}async function B(e){const{executeFn:t,environment:o,taskCollectionStore:n}=e;await async function(e){var t;const{environment:o,taskCollectionStore:n}=e,i=n.getFormat().app_uri_map,s=r.Es.TaskToSprintRelation,l=n.getSchema(),c=(null==i?void 0:i[s])??s,d=l[c];if(!d||!(0,a.p_)(d))return;const u=null===(t=(0,a.j0)(d))||void 0===t?void 0:t.id;if(!u)return;const p=new Set([c]);Object.entries(l).forEach((e=>{var t;let[o,n]=e;n&&(0,a.p_)(n)&&(null===(t=(0,a.j0)(n))||void 0===t?void 0:t.id)===u&&p.add(o)}));const{serverCommitResult:g}=k.createAndCommit({userAction:"sprintSettingsActions.clearSprintRelationDataFromTaskCollection",environment:o,perform:e=>{for(const t of p)b.E2({environment:o,transaction:e,permanentlyDelete:!0,collectionStore:n,schema:l,property:t});null==i||delete i[s],i&&j.FH({stores:[n],transaction:e,update:{app_uri_map:i}})}});await g}({environment:o,taskCollectionStore:n}),t()}function Z(e){return{frequency:"week",interval:e.recurrenceConfig.interval,weekdays:e.recurrenceConfig.weekdays,start_date:n.ou.local().set({hour:0,minute:0,second:0,millisecond:0}).toMillis(),timezone:(0,s.Sv)(),hour:0,minute:0}}},40811:(e,t,o)=>{o.r(t),o.d(t,{default:()=>lg});var n=o(67294),i=o(83355),r=o(480),a=o(86628),s=o(4615),l=o(68939),c=o(50906),d=o(5149),u=o(96802),p=o(39699),g=(o(57658),o(43261)),m=o.n(g),S=o(24405),y=o(66897),h=o(63362),f=o(3865),x=o(83372),v=o(23290),C=o(76205),b=o(99036),w=o(80951),j=o(84619),M=o(76218),_=o(88607),k=o(91856),T=o(65422),A=o(84169),P=o(20669),V=o(25651),F=o(47453),I=o(24600),B=o(42283),Z=o(63030),K=o(69196),D=o(53016),O=o(48524),R=o(43393),N=o(32426),E=o(71500),W=o(73201),L=o(72050),G=o(55159),U=o(26774),z=o(34093),H=o(92607),$=o(32623),q=o(53866),X=o(3729),Y=o(108),Q=o(83303),J=o(56505),ee=o(8938),te=o(94308),oe=o(606),ne=o(97880),ie=o(82990),re=o(26388),ae=o(21467),se=o(20776),le=o(56812),ce=o(64973),de=o(93060),ue=o(85893);function pe(e){window.__c={n:"UpdateCheckboxPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:r,propertySchema:a,value:s}=e,c=(0,S.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold}})),[]),d=function(e){const{propertySchema:t,styles:o,value:n}=e,i=(0,M.A6)(null==n?void 0:n.value)[0],r=t.name,a=!0===i?(0,ae.c$e)({width:12}):(0,ae.UmH)({width:10}),s=!0===i?(0,ue.jsx)(l.FormattedMessage,{...le.Bo.actionCheckboxPropertyChecked}):(0,ue.jsx)(l.FormattedMessage,{...le.Bo.actionCheckboxPropertyUnchecked});return(0,ue.jsx)(l.FormattedMessage,{...le.hW({propertyName:(0,ue.jsx)("span",{style:o.propertyName,children:r}),propertyValue:(0,ue.jsx)(se.o,{icon:a,shouldTruncateChildren:!0,children:s})})})}({propertySchema:a,styles:c,value:s}),u=ge({propertySchema:a,value:s}),p=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:t,icon:B.r,onClick:o,onDelete:i,onEdit:r,title:(0,ue.jsx)("div",{style:c.content,children:d})})),[t,o,i,r,c.content,d]);return(0,ue.jsx)(de.y,{renderOrigin:p,title:u,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left})}function ge(e){const{propertySchema:t,value:o}=e,n=!0===(0,M.A6)(null==o?void 0:o.value)[0]?(0,ue.jsx)(l.FormattedMessage,{...le.Bo.actionCheckboxPropertyChecked}):(0,ue.jsx)(l.FormattedMessage,{...le.Bo.actionCheckboxPropertyUnchecked});return(0,ue.jsx)(l.FormattedMessage,{...le.hW({propertyName:t.name,propertyValue:n})})}var me=o(7057),Se=o(78106),ye=o(42875),he=o(70203),fe=o(21396),xe=o(75311),ve=o(85567),Ce=o(54802),be=o(33929),we=o(68910);function je(e){const{automationStore:t,collectionStore:o}=e;return(0,a.VK)((()=>{if(!o||!t)return;const e=o.getSpaceShardedPointer();return new we.L({automationStore:t,parentPointer:e,type:"event",persisted:!0,intl:be.default.getIntl(),parentRecordStore:o})}),[o,t])}function Me(e){window.__c={n:"UpdateDatePropertyAction"};const{automationStore:t,collectionStore:o,disabled:i,onClick:r,onDelete:s,onEdit:c,propertySchema:d,value:u,valueContext:p}=e,g=(0,l.useIntl)(),m=(0,S.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold}})),[]),y=je({automationStore:t,collectionStore:o}),h=(0,a.VK)((()=>y?function(e){const{automationContextStore:t,intl:o,propertySchema:n,styles:i,value:r,valueContext:a}=e,s=(0,ue.jsx)("span",{style:i.propertyName,children:n.name});if(void 0===(null==r?void 0:r.value))return(0,ue.jsx)(l.FormattedMessage,{...le.xf({propertyName:s})});let c;const d=Ce.tk(t),u=(0,xe._)(a),p=(0,M.A6)(null==r?void 0:r.value)[0];if("string"==typeof p||"boolean"==typeof p||(0,he.IWo)(p)||(0,he.STW)(p))return;if((0,he.wjk)(p)){const e=(0,he.vmO)(p).id,t=(0,Se.vx)(d,e);c=t?(0,ue.jsx)(fe.F,{value:t,format:j.lo.Medium,isSingle:!1,shouldShrink:!0}):void 0}else if((0,he.fpG)(p)){const e=(0,he.zyO)(p);c=e?(0,me.OB)({value:e,date_format:u.dateFormat,time_format:u.timeFormat,userTimeZone:(0,ye.r)(),allowRelativeDates:!0,intl:o,shortenDateAndRange:!0,displayInUserTimezone:!0,formatValuesFn:e=>{let{endDate:t,endTime:o,startDate:n}=e;return(0,ne.$K)(o)?(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(ke,{value:n})," → ",(0,ue.jsx)(ke,{value:o})]}):(0,ne.$K)(t)?(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(ke,{value:n})," → ",(0,ue.jsx)(ke,{value:t})]}):(0,ue.jsx)(ke,{value:n})}}):null}else(0,ne.t1)(p);return void 0===c?void 0:(0,ue.jsx)(l.FormattedMessage,{...le.zU({propertyName:s,propertyValue:c})})}({automationContextStore:y,intl:g,propertySchema:d,styles:m,value:u,valueContext:p}):void 0),[y,g,d,m,u,p]),f=(0,a.VK)((()=>y?_e({automationContextStore:y,intl:g,propertySchema:d,value:u,valueContext:p}):void 0),[y,g,d,u,p]),x=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:i,icon:D.V,onClick:r,onDelete:s,onEdit:c,title:(0,ue.jsx)("div",{style:m.content,children:h})})),[i,r,s,c,m.content,h]);return y&&h&&f?(0,ue.jsx)(de.y,{renderOrigin:x,title:f,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left}):null}function _e(e){const{automationContextStore:t,intl:o,propertySchema:n,value:i,valueContext:r}=e,a=n.name;if(void 0===(null==i?void 0:i.value))return(0,ue.jsx)(l.FormattedMessage,{...le.xf({propertyName:a})});let s;const c=Ce.tk(t),d=(0,xe._)(r),u=(0,M.A6)(null==i?void 0:i.value)[0];if("string"!=typeof u&&"boolean"!=typeof u&&!(0,he.IWo)(u)&&!(0,he.STW)(u)){if((0,he.wjk)(u)){const e=(0,he.vmO)(u).id,t=(0,Se.vx)(c,e);s=t?(0,fe.e)(t):void 0}else if((0,he.fpG)(u)){const e=(0,he.zyO)(u);s=e?(0,me.ZV)({value:e,date_format:d.dateFormat,time_format:d.timeFormat,userTimeZone:(0,ye.r)(),allowRelativeDates:!0,intl:o,shortenDateAndRange:!0,displayInUserTimezone:!0}):null}else(0,ne.t1)(u);return void 0===s?void 0:(0,ue.jsx)(l.FormattedMessage,{...le.zU({propertyName:a,propertyValue:s})})}}function ke(e){window.__c={n:"AutomationDateToken"};const{value:t}=e,o=(0,S.Fg)();return(0,ue.jsx)(ve.Z,{backgroundColor:o.accentColors.gray[75],format:j.lo.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:{marginBlockEnd:4},value:t})}var Te=o(72126),Ae=o(22084),Pe=o(65380),Ve=o(37867);function Fe(e){window.__c={n:"UpdateSelectPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:r,propertySchema:s,value:c}=e,d=(0,l.useIntl)(),u=(0,S.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold}})),[]),p=null!=c&&c.value?(0,M.A6)(null==c?void 0:c.value)[0]:void 0,g=le.oJ({propertySchema:s,optionValues:(0,Te.HD)(p)?[p]:[]}),m=(0,a.VK)((()=>Ie({intl:d,propertySchema:s,styles:u,values:g})),[d,g,s,u]),y=(0,a.VK)((()=>Be({intl:d,propertySchema:s,values:g})),[d,g,s]),h=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:t,icon:q.w,onClick:o,onDelete:i,onEdit:r,title:(0,ue.jsx)("div",{style:u.content,children:m})})),[t,o,i,r,u.content,m]);return(0,ue.jsx)(de.y,{renderOrigin:h,title:y,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left})}function Ie(e){const{intl:t,propertySchema:o,styles:n,tokenFormat:i,values:r}=e,a=i??j.lo.Medium,s=(0,ue.jsx)("span",{style:n.propertyName,children:o.name}),c=r.map((e=>"deleted"===e.type?(0,ue.jsx)(Ve.Z,{tokenFormat:a},`missing_option_value_${e.value}`):"option"===e.type?(0,ue.jsx)(Ae.a,{color:e.value.color,format:a,isSingle:!0,showRemoveButton:!1,value:e.value.value},e.value.id):"truncation"===e.type?(0,ue.jsx)(ve.Z,{format:a,isRound:!0,isSingle:!0,showRemoveButton:!1,value:e.value},"More tokens"):void(0,ne.t1)(e)));return 0===c.length?(0,ue.jsx)(l.FormattedMessage,{...le.Mw({propertyName:s})}):1===c.length?(0,ue.jsx)(l.FormattedMessage,{...le.rf({propertyName:s,propertyValue:c[0]})}):(0,ue.jsx)(l.FormattedMessage,{...le.Sj({propertyName:s,propertyValue:(0,Pe.H)(t.formatList(c,{style:"long",type:"conjunction"}))})})}function Be(e){const{intl:t,propertySchema:o,values:n}=e,i=o.name,r=n.map((e=>"deleted"===e.type?le.ST(t):"option"===e.type?e.value.value:"truncation"===e.type?e.value:void(0,ne.t1)(e)));return 0===r.length?(0,ue.jsx)(l.FormattedMessage,{...le.Mw({propertyName:i})}):1===r.length?(0,ue.jsx)(l.FormattedMessage,{...le.rf({propertyName:i,propertyValue:r[0]})}):(0,ue.jsx)(l.FormattedMessage,{...le.Sj({propertyName:i,propertyValue:(0,Pe.H)(t.formatList(r,{style:"long",type:"conjunction"}))})})}const Ze=5;function Ke(e){window.__c={n:"UpdateMultiSelectPropertyAction"};const{disabled:t,limit:o=Ze,onClick:i,onDelete:r,onEdit:s,propertySchema:c,value:d}=e,u=(0,l.useIntl)(),p=null!=d&&d.value?(0,M.A6)(null==d?void 0:d.value):[],g=le.oJ({limit:o,optionValues:p.map((e=>"string"==typeof e?e:void 0)).filter(ne.$K),propertySchema:c}),m=(0,S.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:g.length<=1?"nowrap":"wrap",whiteSpace:"pre"},propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold}})),[g.length]),y=(0,a.VK)((()=>Ie({intl:u,propertySchema:c,styles:m,values:g})),[u,g,c,m]),h=(0,a.VK)((()=>Be({intl:u,propertySchema:c,values:g})),[u,g,c]),f=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:t,icon:L.A,onClick:i,onDelete:r,onEdit:s,title:(0,ue.jsx)("div",{style:m.content,children:y})})),[t,i,r,s,m.content,y]);return(0,ue.jsx)(de.y,{renderOrigin:f,title:h,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left})}var De=o(92864);function Oe(e){window.__c={n:"UpdatePersonPropertyAction"};const{collectionStore:t,disabled:o,onClick:i,onDelete:r,onEdit:s,propertySchema:c,value:d}=e,u=(0,l.useIntl)(),p=(0,a.VK)((()=>Re({getRecordModel:t.getRecordModel,propertySchema:c,value:d})),[t.getRecordModel,c,d]),g=(0,S.yK)((()=>({content:{alignItems:"center",display:"flex",flexWrap:p.length>1?"wrap":"nowrap",whiteSpace:"pre"},propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold},propertyValue:{...ie.Z.textOverflowStyle,paddingBlockStart:4},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:4}})),[p.length]),m=(0,a.VK)((()=>function(e){const{actors:t,propertySchema:o,styles:n}=e,i=(0,ue.jsx)("span",{style:n.propertyName,children:o.name}),r=function(e){const{actors:t,styles:o}=e;return 1===t.length?(0,ue.jsx)("div",{style:o.propertyValue,children:(0,ue.jsx)(De.ZP,{actor:t[0],showRemoveButton:!1,format:De.ZP.Format.Medium,isSingle:!1})}):(0,ue.jsx)("ul",{style:o.propertyValueList,children:t.map(((e,t)=>(0,ue.jsx)("li",{children:(0,ue.jsx)("div",{style:o.propertyValue,children:(0,ue.jsx)(De.ZP,{actor:e,showRemoveButton:!1,format:De.ZP.Format.Medium,isSingle:!1})},t)},t)))})}({actors:t,styles:n});let a;a=0===t.length?le.ht({propertyName:i}):1===t.length?le.wE({propertyName:i,propertyValue:r}):le.Oq({propertyName:i,propertyValue:r});return(0,ue.jsx)(l.FormattedMessage,{...a})}({actors:p,propertySchema:c,styles:g})),[p,c,g]),y=(0,a.VK)((()=>Ne({actors:p,intl:u,propertySchema:c})),[p,u,c]),h=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:o,icon:U.O,onClick:i,onDelete:r,onEdit:s,title:(0,ue.jsx)("div",{style:g.content,children:m})})),[o,i,r,s,g.content,m]);return(0,ue.jsx)(de.y,{renderOrigin:h,title:y,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left})}function Re(e){const{getRecordModel:t,propertySchema:o,value:n}=e;return(0,w.DW)({textValue:null==n?void 0:n.value,propertySchema:o,blockCreatorPointer:void 0}).map((e=>(0,y.Hl)({getRecordModel:t,pointer:e}))).filter(ne.$K)}function Ne(e){const{actors:t,intl:o,propertySchema:n}=e,i=t.map((e=>(0,y.$4)(o,e))),r=n.name,a=o.formatList(i,{style:"long",type:"conjunction"});let s;return s=0===t.length?le.ht({propertyName:r}):1===t.length?le.wE({propertyName:r,propertyValue:a}):le.Oq({propertyName:r,propertyValue:a}),(0,ue.jsx)(l.FormattedMessage,{...s})}var Ee=o(21202),We=o(10009),Le=o(37034),Ge=o(26350);function Ue(e){window.__c={n:"UpdateRelationPropertyAction"};const{automationStore:t,collectionStore:o,disabled:i,onClick:s,onDelete:c,onEdit:d,propertySchema:u,value:p}=e,g=(0,r.O7)(),m=(0,l.useIntl)(),y=je({automationStore:t,collectionStore:o}),h=(0,a.VK)((()=>(null==y?void 0:y.getAllContextValues())??[]),[y]),f=(0,S.yK)((()=>({content:{alignItems:"center",display:"flex",flex:"1 1 auto",minWidth:0,whiteSpace:"pre"},propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold,minWidth:20},propertyValue:{...ie.Z.textOverflowStyle,minWidth:40},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:10},propertyValueListItem:{display:"flex"}})),[]),x=(0,a.VK)((()=>function(e){const{automationContextValues:t,collectionStore:o,propertySchema:n,styles:i,value:r}=e,a=r?$e({automationContextValues:t,limit:n.limit,value:r}):[],s=(0,ue.jsx)("span",{style:i.propertyName,children:n.name});let c;c=0===a.length?(0,ue.jsx)("div",{style:i.content,children:(0,ue.jsx)(l.FormattedMessage,{...le.Iu({propertyName:s})})}):1===a.length?(0,ue.jsx)("div",{style:i.content,children:(0,ue.jsx)(l.FormattedMessage,{...le.S0({propertyName:s,propertyValue:(0,ue.jsx)("span",{style:i.propertyValue,children:(0,ue.jsx)(ze,{collectionStore:o,value:a[0]})})})})}):(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)("div",{style:i.content,children:(0,ue.jsx)(l.FormattedMessage,{...le.om({propertyName:s,propertyValue:[]})})}),(0,ue.jsx)("ul",{style:i.propertyValueList,children:a.map(((e,t)=>(0,ue.jsx)("li",{style:i.propertyValueListItem,children:(0,ue.jsx)(ze,{collectionStore:o,value:e})},t)))})]});return c}({automationContextValues:h,collectionStore:o,propertySchema:u,styles:f,value:p})),[h,o,u,f,p]),v=(0,a.VK)((()=>He({automationContextValues:h,collectionStore:o,environment:g,intl:m,propertySchema:u,value:p})),[h,o,g,m,u,p]),C=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:i,icon:H.v,onClick:s,onDelete:c,onEdit:d,title:x})),[i,s,c,d,x]);return(0,ue.jsx)(de.y,{renderOrigin:C,title:v,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left})}function ze(e){const{collectionStore:t,value:o}=e;return"string"==typeof o?(0,ue.jsx)(We.Z,{blockId:o,format:j.lo.Medium,isSingle:!0,noUnderline:!0,parentStore:t,shouldShrink:!0}):(0,ue.jsx)(fe.F,{format:j.lo.Medium,isSingle:!0,shouldShrink:!0,value:o})}function He(e){const{automationContextValues:t,collectionStore:o,environment:n,intl:i,propertySchema:r,value:a}=e,s=(a?$e({automationContextValues:t,limit:r.limit,value:a}):[]).map((e=>{if("string"==typeof e){const t=Ge.G.createChildStore(o,{id:e,table:Ee.iU});return(0,Le.vU)({environment:n,intl:i,store:t})}return(0,fe.e)(e)})).filter(ne.$K),c=r.name;let d;return d=0===s.length?le.Iu({propertyName:c}):1===s.length?le.S0({propertyName:c,propertyValue:s[0]}):le.om({propertyName:c,propertyValue:i.formatList(s,{style:"long",type:"conjunction"})}),(0,ue.jsx)(l.FormattedMessage,{...d})}function $e(e){const{automationContextValues:t,limit:o,value:n}=e;return(0,M.A6)(n.value).slice(0,o).map((e=>{if("string"!=typeof e&&"boolean"!=typeof e){if((0,he.wjk)(e)){const o=(0,he.vmO)(e).id,n=(0,Se.vx)(t,o);if(!n)return;return n}if((0,he.STW)(e)){const t=(0,he.TOT)(e);if(!t)return;return t}}})).filter(ne.$K)}var qe=o(5909);function Xe(e){window.__c={n:"UpdateStatusPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:r,propertySchema:s,value:c}=e,d=(0,l.useIntl)(),u=(0,M.A6)(null==c?void 0:c.value)[0],p=(0,S.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold}})),[]),g=(0,a.VK)((()=>function(e){const{intl:t,propertySchema:o,styles:n,value:i}=e;if(!i||"string"!=typeof i)return;const r=(0,ue.jsx)("span",{style:n.propertyName,children:o.name}),a=(0,qe.L)({intl:t,groupValues:[],optionValues:[i],propertySchema:o});if(0===a.length)return;return(0,ue.jsx)(l.FormattedMessage,{...(0,le.Ig)({propertyName:r,propertyValue:a})})}({intl:d,propertySchema:s,styles:p,value:u})),[d,s,u,p]),m=(0,a.VK)((()=>Ye({intl:d,propertySchema:s,value:u})),[d,s,u]),y=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:t,icon:X.T,onClick:o,onDelete:i,onEdit:r,title:(0,ue.jsx)("div",{style:p.content,children:g})})),[t,o,i,r,p.content,g]);return g&&m?(0,ue.jsx)(de.y,{renderOrigin:y,title:m,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left}):null}function Ye(e){const{intl:t,propertySchema:o,value:n}=e;if(!n||"string"!=typeof n)return;const i=o.name,r=(0,qe.L)({intl:t,isText:!0,groupValues:[],optionValues:[n],propertySchema:o});return 0!==r.length?(0,ue.jsx)(l.FormattedMessage,{...(0,le.Ig)({propertyName:i,propertyValue:r})}):void 0}var Qe=o(23867),Je=o(60682),et=o(14976);function tt(e){window.__c={n:"UpdateBaseTextPropertyAction"};const{automationStore:t,disabled:o,icon:i,onClick:s,onDelete:c,onEdit:d,propertySchema:u,value:p}=e,g=(0,r.O7)(),m=(0,S.Fg)(),y=(0,S.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold}})),[]),h=(0,a.VK)((()=>function(e){const{automationStore:t,environment:o,propertySchema:n,styles:i,theme:r,value:a}=e,s=void 0===(null==a?void 0:a.value),c=null!=a&&a.value?(0,et.IY)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,emojiType:(0,Je.e_)(o),environment:o,formulaValueTypes:[],katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:null==a?void 0:a.value,spaceId:(0,Qe.C)(t.pointer.spaceId)},theme:r}):null,d=(0,ue.jsx)("span",{style:i.propertyName,children:n.name}),u=(0,ue.jsx)(ve.Z,{format:j.lo.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,ue.jsx)("span",{style:ie.Z.textOverflowStyle,children:c})}),p=s?le.NZ({propertyName:d}):le.vE({propertyName:d,propertyValue:u});return(0,ue.jsx)(l.FormattedMessage,{...p})}({automationStore:t,environment:g,propertySchema:u,styles:y,theme:m,value:p})),[t,g,u,y,m,p]),f=(0,a.VK)((()=>ot({automationStore:t,environment:g,propertySchema:u,theme:m,value:p})),[t,g,u,m,p]),x=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:o,icon:i,onClick:s,onDelete:c,onEdit:d,title:(0,ue.jsx)("div",{style:y.content,children:h})})),[o,i,s,c,d,y.content,h]);return h&&f?(0,ue.jsx)(de.y,{renderOrigin:x,title:f,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left}):null}function ot(e){const{automationStore:t,environment:o,propertySchema:n,theme:i,value:r}=e,a=void 0===(null==r?void 0:r.value),s=null!=r&&r.value?(0,et.IY)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,emojiType:(0,Je.e_)(o),environment:o,formulaValueTypes:[],katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:null==r?void 0:r.value,spaceId:(0,Qe.C)(t.pointer.spaceId)},theme:i}):null,c=n.name,d=s,u=a?le.NZ({propertyName:c}):le.vE({propertyName:c,propertyValue:d});return(0,ue.jsx)(l.FormattedMessage,{...u})}function nt(e){return(0,ue.jsx)(tt,{...e,icon:Q.c})}function it(e){return(0,ue.jsx)(tt,{...e,icon:Y.p})}function rt(e){return(0,ue.jsx)(tt,{...e,icon:O.n})}function at(e){return(0,ue.jsx)(tt,{...e,icon:ee.O})}function st(e){return(0,ue.jsx)(tt,{...e,icon:G.J})}function lt(e){return(0,ue.jsx)(tt,{...e,icon:z.u})}var ct=o(90199),dt=o(54497),ut=o(31945),pt=o(67669),gt=o(30874),mt=o(35294),St=o(49085);class yt extends St.default{getInitialState(){return{stack:[]}}getCurrentTab(){return Te.Z$(this.getState().stack)}pushSettingsItem(e){this.update((t=>({...t,stack:[...t.stack,e]})))}popSettingsItem(){this.update((e=>({stack:e.stack.slice(0,e.stack.length-1)})))}replaceSettingsItem(e){this.update((t=>{const o=[...t.stack.slice(0,t.stack.length-1),e];return{...t,stack:o}}))}}class ht extends yt{}class ft extends yt{}var xt=o(8406),vt=o(71846),Ct=o(78140),bt=o(87279),wt=o(80721),jt=o(12392),Mt=o(73063),_t=o(32163),kt=o(40721),Tt=o(89728);const At=(0,l.defineMessages)({backButtonAriaLabel:{id:"notificationRuleSettingsMenu.backButton.ariaLabel",defaultMessage:"Back to previous step"}});function Pt(e){window.__c={n:"AutomationTriggerActionMenu"};const{type:t,automationTriggerActionMenuStore:o,headerTitle:n,onClose:i,width:r,onDone:a}=e,s=Bt({automationTriggerActionMenuStore:o,onClose:i,onDone:a,title:n,width:r});return"custom"===t?(0,ue.jsx)(Ft,{...e,menuProps:s}):(0,ue.jsx)(Vt,{...e,menuProps:s})}function Vt(e){const{sections:t,menuProps:o}=e;return(0,ue.jsx)(Ct.Z,{...o,children:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,initialFocus:0,sections:t})})}function Ft(e){const{children:t,menuProps:o}=e;return(0,ue.jsx)(Ct.Z,{...o,children:t})}function It(e){window.__c={n:"BackToPreviousStepButton"};const{automationActionMenuStore:t,menuHeaderTitle:o,onDone:n}=e,i=(0,l.useIntl)(),r=(0,a.VK)((()=>t.state.stack.length>1),[t]),s=(0,S.yK)((e=>({header:{display:"flex",alignItems:"center",margin:8,color:e.mediumTextColor,fontWeight:ie.Z.fontWeight.medium,fontSize:ie.Z.fontSize.UISmall.desktop},iconButtonStyle:{marginRight:8,marginLeft:-2,height:22},iconButtonIconStyle:{width:16,height:16},doneButtonStyle:{marginLeft:"auto"}})),[]);return void 0!==o||r?(0,ue.jsxs)("div",{style:s.header,children:[r&&(0,ue.jsx)(Mt.Z,{ariaLabel:i.formatMessage(At.backButtonAriaLabel),icon:wt.W,style:s.iconButtonStyle,iconStyle:s.iconButtonIconStyle,onClick:()=>{t.popSettingsItem()}}),o,n&&(0,ue.jsx)(Tt.Z,{onClick:n,isBlue:!0,style:s.doneButtonStyle,children:(0,ue.jsx)(l.FormattedMessage,{id:"automationTriggerActionMenu.doneButton.title",defaultMessage:"Done"})})]}):null}function Bt(e){const{automationTriggerActionMenuStore:t,leftStyle:o,onClose:i,onDone:a,rightStyle:s,title:c,titleStyle:d,width:u}=e,{isMobile:p}=(0,r.Fy)(),g=(0,l.useIntl)(),m=(0,n.useCallback)((()=>{1===t.getState().stack.length?i():t.popSettingsItem()}),[t,i]);return(0,n.useMemo)((()=>{let e;return e=p?{leftOuterStyle:o,menuType:bt.og.Modal,title:c,titleOuterStyle:d,left:(0,ue.jsx)(Mt.Z,{ariaLabel:g.formatMessage(At.backButtonAriaLabel),icon:jt.S,onClick:m}),right:(0,ue.jsx)(kt.DoneMenuText,{}),rightOuterStyle:s,onClickRight:()=>{null==a||a(),i()}}:{width:u??266,menuType:bt.og.Popup,maxHeight:"50vh",header:(0,ue.jsx)(It,{automationActionMenuStore:t,menuHeaderTitle:c,onDone:a})},e}),[t,g,p,o,i,a,m,s,c,d,u])}function Zt(e){window.__c={n:"AutomationEventActionCreatePage"};const{automationActionMenuStore:t,automationStore:o,collectionStore:i,onClose:a,updateCurrentState:c}=e,d=(0,s.ZP)(),u=(0,r.O7)(),p=Bt({automationTriggerActionMenuStore:t,leftStyle:{flexGrow:0},onClose:a,rightStyle:{flexGrow:0},title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Add page to…",id:"automationEventActionCreatePage.menu.title"})}),g=(0,n.useCallback)((()=>{xt.tW({environment:u,eventName:"abandoned_search",sessionId:d,source:vt.S.Automation})}),[u,d]);p.menuType===bt.og.Popup&&(p.onClickOutside=g);const m=je({automationStore:o,collectionStore:i}),S=(0,n.useCallback)((e=>{c({action:{id:(0,s.ZP)(),config:{collection:{...e.pointer,spaceId:(0,Qe.C)(e.pointer.spaceId)},properties:["title"],values:{}},type:"create_page"},type:"update_action"}),a()}),[a,c]);return m?(0,ue.jsx)(Ct.Z,{...p,children:(0,ue.jsx)(vt.Z,{context:vt.S.Automation,onAccept:S,parentStore:m.context.parentRecordStore,requireEditPermissions:!0,searchSessionId:d})}):null}var Kt=o(39068),Dt=o(9999),Ot=o(5257),Rt=o(52275),Nt=o(68894),Et=o(72495),Wt=o(30912),Lt=o(52821),Gt=o(44041),Ut=o(35057),zt=o(95193);const Ht=(0,l.defineMessages)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search for action…"}});function $t(e){window.__c={n:"AutomationEventActionMenu"};const{availableActions:t,automationActionMenuStore:o,automationStore:i,collectionStore:s,updateCurrentState:c,onClose:d}=e,u=(0,S.Fg)(),p=(0,l.useIntl)(),{isMobile:g}=(0,r.Fy)(),y=(0,r.O7)(),[h,x]=n.useState(""),v=(0,a.VK)((()=>s.getSchema()),[s]),C=(0,Ce.j_)(),b=(0,a.VK)((()=>function(e){const{automationStore:t,collectionStore:o,searchInput:n}=e,i=new Set(t.getActionStores().flatMap((e=>e.isType("update_pages")?e.getConfigStore().getKeyStore("properties").getValue()??[]:[]))),r=o.getFormat(),a=o.getSchema(),s=(0,f.cO)({collectionFormat:r,collectionSchema:a,filter:e=>{let[t]=e;return!i.has(t)}}),l=new Map,c=s.map((e=>{const t=a[e];if(t){const o=`${t.name} ${Lt.SO[t.type]}`;return l.set(e,o),o}})).filter(ne.$K),d=new Set(m().filter(n,c).map((e=>{let{original:t}=e;return t})));return s.filter((e=>{const t=l.get(e);return t&&d.has(t)}))}({automationStore:i,collectionStore:s,searchInput:h})),[i,s,h]),w=(0,a.VK)((()=>function(e){const{availableActions:t,searchInput:o}=e;if(0===t.length)return[];const n=new Map,i=t.map((e=>{const t=be.default.formatMessage(e.display.name);return n.set(e.type,t),t})),r=new Set(m().filter(o,i).map((e=>{let{original:t}=e;return t})));return t.filter((e=>{const t=n.get(e.type);return t&&r.has(t)}))}({availableActions:t,searchInput:h})),[t,h]),j=(0,Wt.Rr)({environment:y}),M=(0,a.VK)((()=>!(0,Ut.sX)()),[]),_=0===t.length&&M,k=(0,n.useCallback)((()=>{d(),Gt.y(y,{for:"plus",from:"database_automation_action_item"})}),[y,d]),A=w.length>0?function(e){const{automationActionMenuStore:t,actions:o,initialSlackActionSelectMenuState:n,showTopBorder:i,theme:r}=e,a=o.map((e=>function(e){const{automationActionMenuStore:t,action:o,initialSlackActionSelectMenuState:n,theme:i}=e;if("slack_notification"===o.type)return{key:"slack_action",action:()=>{t.pushSettingsItem(n)},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginLeft:2,marginRight:8,width:12,height:"auto"}),right:(0,Ot.o)({marginInlineStart:6,width:12,height:"auto"}),title:(0,ue.jsx)(l.FormattedMessage,{...o.display.name})})};if("create_page"===o.type)return{key:"create_page",action:()=>{t.pushSettingsItem({actionId:void 0,type:"eventActionCreatePage"})},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginInline:"2px 8px",width:14}),right:(0,Ot.o)({marginInlineStart:6,width:12}),title:(0,ue.jsx)(l.FormattedMessage,{...o.display.name})})};if("update_pages"===o.type)return{key:"update_pages",action:()=>{t.pushSettingsItem({actionId:void 0,automationId:"",type:"eventActionUpdatePages"})},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginInline:"2px 8px",width:14}),right:(0,Ot.o)({marginInlineStart:6,width:12}),title:(0,ue.jsx)(l.FormattedMessage,{...o.display.name})})}}({automationActionMenuStore:t,action:e,initialSlackActionSelectMenuState:n,theme:r}))).filter(ne.$K);if(0===a.length)return;return{key:"other_actions_section",items:a,render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:i})}}({automationActionMenuStore:o,actions:w,initialSlackActionSelectMenuState:C,theme:u}):void 0,P=b.length>0&&!M?function(e){const{automationActionMenuStore:t,properties:o,collectionSchema:n,theme:i,updateCurrentState:r,onClose:a,showTopBorder:s}=e,c=o.map((e=>function(e){const{automationActionMenuStore:t,propertyId:o,collectionSchema:n,theme:i}=e,r=n[o];if(!r)return;return{key:o,action:()=>{t.pushSettingsItem({propertyId:o,actionId:void 0,type:"eventActionProperty"})},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,ue.jsx)(Kt.ZP,{icon:r.icon,size:16,style:{fill:i.regularIconColor,marginRight:6},theme:i,type:r.type}),right:(0,Ot.o)({marginInlineStart:6,width:12,height:"auto"}),title:r.name})}}({propertyId:e,collectionSchema:n,theme:i,updateCurrentState:r,automationActionMenuStore:t,onClose:a}))).filter(ne.$K);if(0===c.length)return;return{key:"page_properties_edited_section",items:c,render:e=>(0,ue.jsx)(Et.Z,{...e,title:(0,ue.jsx)(l.FormattedMessage,{id:"automationEventActionMenu.pagePropertiesEditedSection.title",defaultMessage:"Edit property"}),topBorder:s})}}({automationActionMenuStore:o,properties:b,collectionSchema:v,showTopBorder:(0,ne.$K)(A),theme:u,updateCurrentState:c,onClose:d}):void 0,V=M&&j?function(e){const{onUpsellClick:t,showTopBorder:o,theme:n}=e;return{key:"upsell_section",items:[{action:()=>t(),key:"upsell_item",render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,ue.jsx)("div",{style:{background:n.accentColors.yellow[50],borderRadius:4,height:20,padding:3,width:20},children:(0,T.K)({fill:n.icon.yellow,height:"100%",width:"100%"})}),right:(0,Dt.J)({height:"auto",marginBlockStart:2,width:12}),rightStyle:{alignSelf:"start"},caption:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Automatically set properties, create new pages, and more with automations.",id:"automationEventActionMenu.upsellSection.caption"}),title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Upgrade for more actions",id:"automationEventActionMenu.upsellSection.title"}),shouldWrapCaption:!0})}],render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:o})}}({onUpsellClick:k,showTopBorder:!_,theme:u}):void 0,F=[A,P].filter(ne.$K),I={key:"no_results_section",items:[{key:"no_results_item",action:()=>{},render:e=>(0,ue.jsx)(Rt.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"No results",id:"automations.automationEventActionMenu.noResultsItem"})})}],render:e=>(0,ue.jsx)(Et.Z,{...e})},B=(_?[V]:0===F.length?[I,V]:[...F,V]).filter(ne.$K),Z=(0,zt.F)({width:266,paddingBottom:2});return Z.header=_?void 0:(0,ue.jsx)(Nt.ZP,{onChange:e=>{x(e.target.value)},placeholder:p.formatMessage(Ht.searchInputPlaceholder),style:{marginBlock:"12px 2px"},value:h}),g||(Z.maxHeight="50vh"),(0,ue.jsx)(Ct.Z,{...Z,children:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,sections:B,initialFocus:0})})}var qt=o(10450),Xt=o(30823),Yt=o(6287),Qt=o(53498),Jt=o(32984);const eo=(0,l.defineMessages)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",id:"automations.eventActionProperty.menuHeaderTitle"}});function to(e){var t;window.__c={n:"AutomationEventActionProperty"};const{actionId:o,automationActionMenuStore:i,automationStore:r,collectionStore:c,onClose:d,propertyId:u,updateCurrentState:p}=e,g=(0,l.useIntl)(),m=je({automationStore:r,collectionStore:c}),S=o??(0,s.ZP)(),y=(0,a.VK)((()=>c.getSchema()[u]),[c,u]),h=(0,n.useMemo)((()=>!!y&&("multi_select"===y.type||(0,b.en)(y)&&1!==y.limit)),[y]),f=Boolean(y&&"button"!==y.type&&"rollup"!==y.type&&"formula"!==y.type&&"text"===(0,Xt.vc)(y.type)),x=Boolean(y&&"button"!==y.type&&"rollup"!==y.type&&"formula"!==y.type&&"number"===(0,Xt.vc)(y.type)),v=Boolean(y&&"date"===y.type),C=Boolean(y&&"status"===y.type),w=(0,a.VK)((()=>{if(y)return(0,M.qW)({table:Yt.v,id:c.id,spaceId:c.getSpaceId()},u,y)}),[c,y,u]),j=(0,a.VK)((()=>{const e=r.getActionStores();if(S&&e.length>0){const t=e.find((e=>e.id===S));if(t&&t.isType("update_pages"))return t.getConfigStore().getKeyStore("values").getKeyStore(u).getValue()}}),[r,S,u]),[_,k]=(0,n.useState)(j),T=(0,n.useRef)(null==j?void 0:j.value),A=(0,M.A6)(null==_||null===(t=_.value)||void 0===t?void 0:t.value),P=(0,a.VK)((()=>{if(!m)return[];return m.context.automationStore.getActionIds().some((e=>e===S))?m.getContextValuesForAction(S):m.getAllContextValues()}),[m,S]),V=(0,n.useCallback)((e=>{p({action:{id:S,config:{properties:[u],target:{id:(0,qt.J0)(),type:"variable"},values:{[u]:{action:"replace",value:e}}},type:"update_pages"},type:"update_action"})}),[S,u,p]),F=(0,n.useCallback)((()=>{V(T.current),d()}),[V,d]),I=(0,n.useCallback)((e=>{if(T.current=e,f||x||h)k({action:"replace",value:e});else if(v){const t=(0,M.A6)(null==e?void 0:e.value);0===t.length?F():(0,M.S3)(t[0])&&(0,he.fpG)(t[0])&&k({action:"replace",value:e})}}),[v,f,x,h,F]),B=Bt({automationTriggerActionMenuStore:i,leftStyle:{flexGrow:0},onClose:F,onDone:h||f||x?F:void 0,rightStyle:{flexGrow:0},title:(0,ue.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:g.formatMessage(eo.menuHeaderTitle,{propertyName:(0,ue.jsx)("div",{style:{...ie.Z.textOverflowStyle},children:(null==y?void 0:y.name)??""})})}),titleStyle:{minWidth:0}});if(!y||!w||!m)return null;const Z={type:"collection",collectionStore:c,property:u},K=(0,Jt.li)(y.type);return(0,ue.jsx)(Qt.a,{context:Z,contextStore:m,currentSimpleFormulaValueTokens:A,disabled:!1,formulaTypecheckContextValues:P,menuProps:B,onChange:I,onClose:F,showClearButton:!C,type:w,value:null==_?void 0:_.value,...K})}var oo=o(8808);function no(e){window.__c={n:"AutomationEventActionUpdatePagesMenu"};const{actionId:t,automationActionMenuStore:o,automationStore:i,collectionStore:r,onClose:a,updateCurrentState:c}=e,d=(0,x.z)("update_pages"),u=je({automationStore:i,collectionStore:r}),p=Bt({automationTriggerActionMenuStore:o,leftStyle:{flexGrow:0},onClose:a,rightStyle:{flexGrow:0},title:(0,ue.jsx)(l.FormattedMessage,{...d.display.name})}),g=(0,n.useCallback)((e=>{c({action:{id:(0,s.ZP)(),config:{properties:[],target:e,values:{}},type:"update_pages"},type:"update_action"}),a()}),[a,c]);return u?(0,ue.jsx)(Ct.Z,{...p,children:(0,ue.jsx)(oo.H,{actionId:t,automationContextStore:u,onChange:g,onClose:a,skipPages:!0})}):null}var io=o(41892),ro=o(77657),ao=o(149),so=o(32161),lo=o(42631),co=o(42922),uo=o(18441),po=o(80444);function go(e){window.__c={n:"AutomationSlackConnectToSlackView"};const{type:t,automationActionMenuStore:o,onClose:n}=e,i=fo(),r=(0,a.VK)((()=>{var e;return null===(e=po.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),s=(0,a.VK)((()=>po.default.state.currentUserStore),[]),l=(0,a.VK)((()=>{if("connectToSlackReconnect"===t&&s)return(0,Ge.Kv)(s,{table:so.P,id:e.externalBotId,spaceId:r}).getValue()}),[r,s,e,t]);let c,d=ho({viewType:"connectToSlackDefault"});if("connectToSlackReconnect"===t){if(!l)return null;const{accountName:e,organizationName:t}=(0,uo.jg)(l);c=(0,uo.jc)(l),d=ho({viewType:"connectToSlackReconnect",accountName:e,organizationName:t})}return(0,ue.jsx)(Pt,{type:"custom",automationTriggerActionMenuStore:o,onClose:n,children:(0,ue.jsx)(Et.Z,{children:(0,ue.jsxs)("div",{style:i.container,children:[(0,ue.jsx)(So,{}),(0,ue.jsxs)("div",{style:i.connectToSlackBody,children:[(0,ue.jsx)("div",{style:i.connectToSlackTitleText,children:yo(t)}),(0,ue.jsx)("div",{style:i.connectToSlackDescriptionText,children:d})]}),(0,ue.jsx)(mo,{...e,slackWorkspaceId:c})]})})})}function mo(e){window.__c={n:"AuthActionButtons"};const{automationActionMenuStore:t,slackWorkspaceId:o}=e,n=(0,r.O7)(),i=fo(),s=(0,a.VK)((()=>{var e;return null===(e=po.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),c=(0,a.VK)((()=>gt.Z.integrations.state.find((e=>e.id===ro.nO))),[]);return c&&s?(0,ue.jsxs)("div",{style:i.buttonGroup,children:[(0,ue.jsx)(co.Z,{style:i.connectToSlackButton,isLarge:!0,onClick:async()=>{const i=await lo.hM({environment:n,integration:c,spaceId:s,from:"collection_view_settings",options:{slackWorkspaceId:o}});ao.x.isFail(i)?t.replaceSettingsItem({type:"selectWorkspace"}):"connectToSlackReconnect"===e.type||("connectToSlackDefault"===e.type?i.value.externalAuthentication?t.replaceSettingsItem({type:"selectChannelNew",currentExternalAuthentication:i.value.externalAuthentication}):t.replaceSettingsItem({type:"selectWorkspace"}):(0,ne.t1)(e))},children:(0,ue.jsx)(l.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.connectButton.label",defaultMessage:"Connect"})}),(0,ue.jsx)(Tt.Z,{style:i.cancelButton,isLarge:!0,onClick:()=>{t.popSettingsItem()},children:(0,ue.jsx)(l.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.cancelButton.label",defaultMessage:"Cancel"})})]}):null}function So(){window.__c={n:"SlackIcon"};const e=fo();return(0,ue.jsx)("div",{children:(0,ue.jsx)("img",{src:io.Z.images.externalIntegrations.slackIconPng,style:e.slackIcon})})}function yo(e){return"connectToSlackDefault"===e?(0,ue.jsx)(l.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.title",defaultMessage:"Connect to Slack"}):"connectToSlackReconnect"===e?(0,ue.jsx)(l.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.reconnect.title",defaultMessage:"Reconnect to Slack"}):void(0,ne.t1)(e)}function ho(e){const{viewType:t}=e;return"connectToSlackDefault"===t?(0,ue.jsx)(l.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.description",defaultMessage:"Get notified in channels, see rich previews, and more."}):"connectToSlackReconnect"===t?(0,ue.jsx)(l.FormattedMessage,{id:"AutomationSlackConnectToSlackView.reconnect.description",defaultMessage:'Reconnect your Slack account ({accountName}) on {hasOrganizationName, select, true {"{organizationName}"} other {your Slack workspace}} to resume your notifications.',values:{accountName:e.accountName,hasOrganizationName:(0,ne.$K)(e.organizationName),organizationName:e.organizationName}}):void(0,ne.t1)(t)}function fo(){return(0,S.yK)((e=>({container:{display:"flex",flexDirection:"column",margin:"10px 15px",justifyContent:"center",textAlign:"center"},connectToSlackBody:{margin:"0px 25px"},connectToSlackTitleText:{marginBottom:2,fontWeight:ie.Z.fontWeight.semibold},connectToSlackDescriptionText:{fontSize:13,color:e.mediumTextColor},slackIcon:{width:23,height:"auto"},buttonGroup:{margin:"10px 10px 0px 10px"},connectToSlackButton:{width:"100%"},cancelButton:{color:e.mediumTextColor,width:"100%",justifyContent:"center",fontWeight:ie.Z.fontWeight.medium,fontSize:13,marginTop:8}})),[])}var xo=o(82114),vo=o(36591),Co=o(35840),bo=o(54642),wo=o(12457),jo=o(92595);class Mo extends St.default{getStateForBot(e){return this.state[e]??{channels:{},fetching:!1,lastRefreshed:0}}updateStateForBot(e,t){this.setState({...this.state,[e]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const o=this.getStateForBot(e);this.setState({...this.state,[e]:{...o,channels:{...o.channels,...t}}})}}const _o=new Mo;(0,jo.exposeDebugValue)("ExternalNotificationChannelsStore",_o);const ko=_o;var To=o(68785);const Ao=(0,l.defineMessages)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Search…"}});function Po(e){window.__c={n:"SlackSelectChannelView"};const{currentNotificationChannel:t,onNotificationChannelSelect:o,onClose:i,onNewSlackAccountAdded:s,renderMenu:c,channelFilter:d}=e,u=(0,r.O7)(),{isMobile:p}=(0,r.Fy)(),g=(0,a.VK)((()=>gt.Z.completeSlackAuthentications.state),[]),m=e.currentExternalAuthentication??Te.Ps(g);n.useEffect((()=>{m&&async function(e){const{environment:t,botId:o,spaceId:n}=e,i=ko.getStateForBot(o);if(i.fetching||Date.now()-i.lastRefreshed<15e3)return;let r;ko.updateStateForBot(o,{fetching:!0,lastRefreshed:Date.now()});for(;;){const e=await bo.getExternalNotificationChannels(t,{botId:o,spaceId:n,cursor:r});if("success"!==e.type){console.error(e.error);break}{const t={};for(const o of e.data.channels)t[o.id]=o;if(ko.addChannelsForBot(o,t),r=e.data.cursor,!r)break}}ko.updateStateForBot(o,{fetching:!1})}({environment:u,botId:m.id,spaceId:m.space_id})}),[u,m]);const[y,h]=n.useState(""),{loadedChannelsForAccount:f,isLoading:x}=(0,a.VK)((()=>{if(!m)return{loadedChannelsForAccount:[],isLoading:!1};const e=ko.getStateForBot(m.id);return{loadedChannelsForAccount:Object.values(e.channels),isLoading:e.fetching}}),[m]),v=(0,a.VK)((()=>gt.Z.integrations.state.find((e=>e.id===ro.nO))),[]),C=(0,a.VK)((()=>{var e;return null===(e=po.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),b=n.useCallback((e=>{m&&o(e,m),i()}),[o,m,i]),w=(0,S.yK)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.lightTextColor},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[]),j=n.useCallback((e=>{const{channel:o}=e;return{key:o.id,render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:Fo({channel:o,styles:w.icon}),desktopIconStyle:{width:8},title:o.name,right:o.id===(null==t?void 0:t.id)&&(0,vo.e)(w.icon)}),action:()=>{b(o)}}}),[b,w.icon,t]),{publicChannels:M,privateChannels:_,personalChannels:k}=n.useMemo((()=>function(e,t){const o=[],n=[],i=[];for(const r of e)t&&!t(r)||("public"===r.type?o.push(r):"private"===r.type?n.push(r):"me"===r.type?i.push(r):(0,ne.t1)(r.type));return{publicChannels:o,privateChannels:n,personalChannels:i}}(f,d)),[d,f]),T=n.useCallback((()=>M.map((e=>({menuListItem:j({channel:e}),channelName:e.name})))),[M,j]),A=n.useCallback((()=>_.map((e=>({menuListItem:j({channel:e}),channelName:e.name})))),[_,j]),P=n.useCallback((()=>k.map((e=>({menuListItem:j({channel:e}),channelName:e.name})))),[k,j]),V=n.useCallback((()=>T().map((e=>{let{menuListItem:t,channelName:o}=e;if(Vo({channelName:o,query:y}))return t})).filter(ne.$K)),[T,y]),F=n.useCallback((()=>A().map((e=>{let{menuListItem:t,channelName:o}=e;if(Vo({channelName:o,query:y}))return t})).filter(ne.$K)),[A,y]),I=n.useCallback((()=>P().map((e=>{let{menuListItem:t,channelName:o}=e;if(Vo({channelName:o,query:y}))return t})).filter(ne.$K)),[P,y]),B=n.useCallback((()=>{if(!m)return[];const e=[],t=V(),o=F(),n=I();return n.length>0&&e.push({key:"personal-channels",render:e=>(0,ue.jsx)(Et.Z,{...e,title:(0,uo.jg)(m).organizationName}),items:n}),t.length>0&&e.push({key:"public-channels",render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:n.length>0,title:0===n.length&&(0,uo.jg)(m).organizationName}),items:t}),o.length>0&&e.push({key:"private-channels",render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:t.length>0,title:0===n.length&&t.length>0&&(0,uo.jg)(m).organizationName}),items:o}),e}),[V,F,I,m]);if(!m||!v)return null;const Z=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,ue.jsx)("div",{children:(0,ue.jsx)(Nt.ZP,{...e,inputLeft:(0,ue.jsx)(Nt.f_,{icon:Co.R}),inputRight:(0,ue.jsx)(wo.Z,{show:x,showDelay:500,showHold:300,render:e=>e&&(0,ue.jsx)(To.Z,{style:{marginRight:2}})}),showClearButton:!0,placeholder:be.default.formatMessage(Ao.channelSearchPlaceholder),focusInitial:!p,value:y,onChange:e=>{h(e.target.value)}})})}],render:e=>(0,ue.jsx)(Et.Z,{...e})},...B()];return t||Z.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!C)return;const e=await lo.hM({environment:u,integration:v,spaceId:C,from:"collection_view_settings"});ao.x.isFail(e)||s()},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,ue.jsx)("img",{src:io.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,ue.jsx)(l.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:!0})}),(0,ue.jsx)(ue.Fragment,{children:c(Z)})}function Vo(e){const{channelName:t,query:o}=e;return 0===o.length||t.toLocaleLowerCase().indexOf(o.trim().toLocaleLowerCase())>=0}function Fo(e){const{channel:t,styles:o}=e;return"private"===t.type?(0,ct.b)(o):"me"===t.type?(0,xo.p)(o):(0,G.J)(o)}function Io(e){window.__c={n:"AutomationSlackSelectChannelView"};const{automationActionMenuStore:t,updateCurrentAutomationState:o,onClose:i}=e,r="selectChannelUpdate"===e.type?e.actionId:void 0,a=n.useCallback(((e,t)=>{o({type:"update_action",action:{id:r??(0,s.ZP)(),type:"slack_notification",config:{target:e,external_bot_id:t.parent_id}}}),i()}),[r,i,o]),c=(0,n.useCallback)((()=>{const e=t.getState().stack;e.length<2||("selectWorkspace"===e[e.length-2].type?t.popSettingsItem():t.replaceSettingsItem({type:"selectWorkspace"}))}),[t]);return(0,ue.jsx)(Po,{currentExternalAuthentication:e.currentExternalAuthentication,currentNotificationChannel:"selectChannelNew"===e.type?void 0:"selectChannelUpdate"===e.type?e.currentNotificationChannel:(0,ne.t1)(e),onClose:i,onNotificationChannelSelect:a,onNewSlackAccountAdded:c,renderMenu:e=>(0,ue.jsx)(Pt,{type:"default",automationTriggerActionMenuStore:t,headerTitle:(0,ue.jsx)(l.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel"}),sections:e,onClose:i})})}o(30541);const Bo=(0,l.defineMessages)({workspaceSearchPlaceholder:{id:"notificationRuleSettings.selectWorkspaceView.searchInput.placeholder",defaultMessage:"Search…"}});function Zo(e){window.__c={n:"SlackSelectWorkspaceView"};const{onWorkspaceSelect:t,renderMenu:o,workspaceFilter:i,onNewSlackAccountAdded:s}=e,c=(0,r.O7)(),{isMobile:d}=(0,r.Fy)(),u=(0,a.VK)((()=>{var e;return null===(e=po.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),p=(0,a.VK)((()=>(0,uo.P9)(gt.Z.completeSlackAuthentications.state,i)),[i]),g=(0,a.VK)((()=>gt.Z.integrations.state.find((e=>e.id===ro.nO))),[]),[m,y]=n.useState(""),h=(0,S.yK)((e=>({chevronRight:{width:12,height:"auto",color:e.lightIconColor}})),[]);if(!g)return null;const f=Object.entries((0,uo.YJ)(p,m)).map(((e,o)=>{let[n,i]=e;return{key:n,items:i.map((e=>{let{workspaceName:o,externalAuthentication:n}=e;return{key:n.id,action:()=>{t(n)},render:e=>(0,ue.jsx)(Rt.Z,{...e,title:o??(0,ue.jsx)(l.FormattedMessage,{id:"notificationRuleSettings.selectWorkspace.untitledWorkspace",defaultMessage:"Slack workspace"}),right:(0,Ot.o)(h.chevronRight)})}})),render:e=>(0,ue.jsx)(Et.Z,{...e,title:n,topBorder:0!==o})}}));return f.unshift({key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,ue.jsx)("div",{children:(0,ue.jsx)(Nt.ZP,{...e,inputLeft:(0,ue.jsx)(Nt.f_,{icon:Co.R}),showClearButton:!0,placeholder:be.default.formatMessage(Bo.workspaceSearchPlaceholder),focus:!d||void 0,value:m,onChange:e=>{y(e.target.value)}})})}],render:e=>(0,ue.jsx)(Et.Z,{...e})}),f.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!u)return;const e=await lo.hM({environment:c,integration:g,spaceId:u,from:"collection_view_settings"});ao.x.isFail(e)||e.value.externalAuthentication&&(t(e.value.externalAuthentication),null==s||s())},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,ue.jsx)("img",{src:io.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,ue.jsx)(l.FormattedMessage,{id:"notificationRuleSettings.selectWorkspaceView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:!0})}),(0,ue.jsx)(ue.Fragment,{children:o(f)})}function Ko(e){const{automationActionMenuStore:t,onClose:o}=e,i=n.useCallback((e=>{t.pushSettingsItem({type:"selectChannelNew",currentExternalAuthentication:e})}),[t]);return(0,ue.jsx)(Zo,{onWorkspaceSelect:i,renderMenu:e=>(0,ue.jsx)(Pt,{type:"default",automationTriggerActionMenuStore:t,headerTitle:(0,ue.jsx)(l.FormattedMessage,{id:"notificationRuleSettings.selectSlackWorkspace.title",defaultMessage:"Select Slack workspace"}),sections:e,onClose:o})})}function Do(e){window.__c={n:"AutomationActionMenuController"};const{automationStore:t,collectionStore:o,initialState:i,updateCurrentAutomationState:r,buttonPopupParent:s}=e,l=(0,a.VK)((()=>{const e=new ft;return e.setState({stack:[i]}),e}),[i]),c=(0,a.VK)((()=>l.getCurrentTab()),[l]),d=(0,n.useCallback)((()=>s.close()),[s]);if(!c)return null;if("connectToSlackDefault"===c.type)return(0,ue.jsx)(go,{type:"connectToSlackDefault",automationActionMenuStore:l,onClose:d});if("connectToSlackReconnect"===c.type)return(0,ue.jsx)(go,{type:"connectToSlackReconnect",externalBotId:c.externalBotId,notificationActionConfigStore:c.notificationActionConfigStore,automationActionMenuStore:l,onClose:d});if("selectWorkspace"===c.type)return(0,ue.jsx)(Ko,{automationActionMenuStore:l,onClose:d});if("selectChannelNew"===c.type)return(0,ue.jsx)(Io,{type:"selectChannelNew",updateCurrentAutomationState:r,currentExternalAuthentication:c.currentExternalAuthentication,automationActionMenuStore:l,onClose:d});if("selectChannelUpdate"===c.type)return(0,ue.jsx)(Io,{type:"selectChannelUpdate",updateCurrentAutomationState:r,actionId:c.actionId,currentExternalAuthentication:c.currentExternalAuthentication,currentNotificationChannel:c.currentNotificationChannel,automationActionMenuStore:l,onClose:d});if("eventActions"===c.type)return(0,ue.jsx)($t,{availableActions:c.availableActions,automationActionMenuStore:l,automationStore:t,collectionStore:o,onClose:d,updateCurrentState:r});if("eventActionProperty"===c.type){const{propertyId:e,actionId:n}=c;return(0,ue.jsx)(to,{actionId:n,automationActionMenuStore:l,automationStore:t,collectionStore:o,onClose:d,propertyId:e,updateCurrentState:r})}return"eventActionCreatePage"===c.type?(0,ue.jsx)(Zt,{automationStore:t,automationActionMenuStore:l,collectionStore:o,onClose:d,updateCurrentState:r}):"eventActionUpdatePages"===c.type?(0,ue.jsx)(no,{actionId:c.actionId,automationActionMenuStore:l,automationStore:t,collectionStore:o,onClose:d,updateCurrentState:r}):(0,ne.t1)(c)}const Oo=(0,l.defineMessages)({slackNonOwnerPrivateChannel:{id:"slackNotificationAction.slackTargetPersonalChannel.displayName",defaultMessage:"Private channel"}});function Ro(e){window.__c={n:"SlackNotificationAction"};const{actionStore:t,automationStore:o,collectionStore:n,currentUserIsOwner:i,disabled:r,updateCurrentAutomationState:s}=e,c=(0,mt.d)(),d=(0,a.VK)((()=>t.getConfig()),[t]),u=(0,a.VK)((()=>gt.Z.completeSlackAuthentications.state.find((e=>(null==d?void 0:d.external_bot_id)===e.id))),[d]),p=(0,a.VK)((()=>"disabled_auth"===(null==o?void 0:o.getStatus())),[o]),g=(0,a.VK)((()=>d&&u&&d.target?o&&t&&d.external_bot_id&&p?{type:"connectToSlackReconnect",externalBotId:d.external_bot_id,notificationActionConfigStore:t}:{type:"selectChannelUpdate",actionId:t.id,currentExternalAuthentication:u,currentNotificationChannel:d.target}:{type:"connectToSlackDefault"}),[d,t,o,u,p]),m=Eo();return i?(0,ue.jsx)(ut.ZP,{alignmentToOrigin:ut.vR.Center,placementToOrigin:ut.pO.Bottom,popupType:c,render:e=>(0,ue.jsx)(Do,{automationStore:o,initialState:g,updateCurrentAutomationState:s,buttonPopupParent:e,collectionStore:n}),renderOrigin:e=>(0,ue.jsx)(ce.pW,{...e,disabled:r,onClick:()=>{e.onClick()},title:(0,ue.jsx)(No,{actionStore:t,currentUserIsOwner:i}),icon:I.P,caption:p&&(0,ue.jsxs)("div",{style:m.container,children:[(0,dt.t)(m.warningIcon),(0,ue.jsx)("div",{style:m.caption,children:(0,ue.jsx)(l.FormattedMessage,{id:"SlackNotificationAction.caption.reconnectNeeded",defaultMessage:"Reconnect Slack to resume"})})]}),onEdit:()=>{e.onClick()},onDelete:()=>{s({type:"remove_action",action:{id:t.id,type:"slack_notification"}})}})}):(0,ue.jsx)(ce.pW,{disabled:!0,icon:I.P,title:(0,ue.jsxs)("div",{style:m.container,children:[(0,ue.jsx)("div",{style:{fontWeight:500,marginRight:4},children:(0,ue.jsx)(l.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify"})}),(0,ue.jsx)(Lo,{actionStore:t,isUserAutomationOwner:i})]})})}function No(e){window.__c={n:"SlackActionTitle"};const{actionStore:t,currentUserIsOwner:o}=e,n=Eo(),i=(0,a.VK)((()=>t.getConfig()),[t]);return i&&i.external_bot_id&&i.target?(0,ue.jsxs)("div",{style:n.container,children:[(0,ue.jsx)("div",{style:{fontWeight:500,marginRight:4},children:(0,ue.jsx)(l.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify"})}),(0,ue.jsx)(Lo,{actionStore:t,isUserAutomationOwner:o})]}):(0,ue.jsx)("div",{style:n.container,children:(0,ue.jsx)(l.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotificationPlaceholder",defaultMessage:"Send Slack notification to…"})})}function Eo(){return(0,S.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4},caption:{fontSize:12,fontWeight:400,color:e.mediumTextColor},warningIcon:{width:12,height:"auto",color:e.accentColors.orange[400]}})),[])}function Wo(e){const{isMobile:t}=e,o=t?ie.Z.fontSize.UISmall.mobile:ie.Z.fontSize.UISmall.desktop;return(0,S.yK)((()=>({overflow:{...ie.Z.textOverflowStyle},container:{display:"inline-flex",alignItems:"baseline",gap:2},lockIcon:{width:o,height:"auto",alignSelf:"center"}})),[o])}function Lo(e){window.__c={n:"SlackChannelWithIcon"};const{actionStore:t,isUserAutomationOwner:o}=e,n=(0,r.O7)(),i=(0,a.VK)((()=>Boolean((0,pt.IJ)(n,t))),[t,n]),s=(0,a.VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]);return!s||i?(0,ue.jsx)(Ho,{}):"public"===s.type?(0,ue.jsx)(Go,{channelName:s.name}):"private"===s.type?(0,ue.jsx)(Uo,{channelName:s.name,isUserAutomationOwner:o}):"me"===s.type?(0,ue.jsx)(zo,{channelName:s.name,isUserAutomationOwner:o}):(0,ne.t1)(s.type)}function Go(e){window.__c={n:"PublicSlackChannel"};const{isMobile:t}=(0,r.Fy)(),o=Wo({isMobile:t});return(0,ue.jsx)("span",{style:o.overflow,children:`#${e.channelName}`})}function Uo(e){window.__c={n:"PrivateSlackChannel"};const{channelName:t,isUserAutomationOwner:o}=e,{isMobile:n}=(0,r.Fy)(),i=Wo({isMobile:n});return o?(0,ue.jsxs)("span",{style:{...i.overflow,...i.container},children:[(0,ct.b)(i.lockIcon),t]}):(0,ue.jsx)(Ho,{})}function zo(e){window.__c={n:"MeSlackChannel"};const{channelName:t,isUserAutomationOwner:o}=e,{isMobile:n}=(0,r.Fy)(),i=Wo({isMobile:n});return o?(0,ue.jsx)("span",{style:i.overflow,children:`@${t}`}):(0,ue.jsx)(Ho,{})}function Ho(){window.__c={n:"NonOwnerPrivateChannel"};const e=(0,l.useIntl)(),{isMobile:t}=(0,r.Fy)(),o=Wo({isMobile:t}),n=e.formatMessage(Oo.slackNonOwnerPrivateChannel);return(0,ue.jsxs)("span",{style:{...o.overflow,...o.container},children:[(0,ct.b)(o.lockIcon),n]})}function $o(e){window.__c={n:"UnsupportedPropertyTriggerAction"};const{disabled:t,onClick:o,onDelete:i,propertySchema:r}=e,a=(0,S.Fg)(),s="light"===a.mode?50:200,l="light"===a.mode?700:900,c=(0,S.yK)((e=>{const t="light"===e.mode?400:800;return{warning:{color:e.accentColors.orange[t]},title:{flexShrink:1,fontSize:12,fontWeight:ie.Z.fontWeight.medium},titleWrap:{display:"flex"}}}),[]),d=qo({propertySchema:r}),u=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:t,icon:e=>(0,dt.t)({...e,...c.warning}),onClick:o,onDelete:i,title:(0,ue.jsx)("div",{style:c.titleWrap,children:(0,ue.jsx)(j.ZP,{backgroundColor:a.accentColors.yellow[s],color:a.accentColors.yellow[l],format:j.lo.Medium,isSingle:!0,shouldShrink:!0,style:c.title,theme:a,value:d})})})),[s,t,o,i,c.title,c.titleWrap,c.warning,l,a,d]);return(0,ue.jsx)(de.y,{renderOrigin:u,title:d,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left})}function qo(e){const{propertySchema:t}=e,o=Lt.SO[t.type];return(0,ue.jsx)(l.FormattedMessage,{id:"UnsupportedPropertyTriggerAction.unsupportedProperty.title",defaultMessage:"{propertyType} property not supported",values:{propertyType:o}})}var Xo=o(80628),Yo=o(62868),Qo=o(13005),Jo=o(42917),en=o(16354),tn=o(62385),on=o(63474),nn=o(77080),rn=o(98963),an=o(47307),sn=o(9953),ln=o(2553),cn=o(24215);const dn=(0,l.defineMessages)({automationDeleteConfirmationMessage:{id:"slackAutomations.remove.confirmation.message",defaultMessage:"Are you sure you want to delete {automationName}?"},automationDeleteAcceptLabel:{id:"slackAutomations.remove.confirmation.acceptLabel",defaultMessage:"Delete"}});async function un(e){const{intl:t,environment:o,collectionStore:n,existingAutomationStore:i,triggerType:r,onDelete:a}=e,s=i.getNameWithDefault(t);(await an.confirmUserActionV2({message:t.formatMessage(dn.automationDeleteConfirmationMessage,{automationName:s}),acceptLabel:t.formatMessage(dn.automationDeleteAcceptLabel)})).accept&&(!function(e){const{environment:t,triggerType:o,collectionStore:n,existingAutomationStore:i}=e;p.createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.deleteAutomation",perform:e=>{const t=n.getFormatStore().getKeyStore("automation_ids"),o=Ge.Mz.createChildStore(n,i.pointer);p.applyOperation({store:t,operation:{pointer:t.pointer,path:t.path,command:"listRemove",args:{id:o.id}},transaction:e}),sn.sW({store:o,data:{alive:!1},transaction:e})}});const r=(0,cn.mc)(t),a=Sn({automationStore:i,collectionStore:n});h.uO(r,a),"notification_event"===o&&c.xim(t,{type:"granular",source:"collection_view_settings",collection_id:n.id})}({environment:o,triggerType:r,collectionStore:n,existingAutomationStore:i}),null==a||a())}function pn(e){const{automationStore:t,collectionStore:o,environment:n}=e;p.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.disableAutomation",perform:e=>{const n=Ge.Mz.createChildStore(o,t.pointer);sn.sW({store:n,data:{status:"disabled"},transaction:e})}});const i=(0,cn.mc)(n),r=Sn({automationStore:t,collectionStore:o});h.ai(i,r)}function gn(e){const{automationStore:t,collectionStore:o,environment:n}=e;p.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.enableAutomation",perform:e=>{const n=Ge.Mz.createChildStore(o,t.pointer);sn.sW({store:n,data:{status:"active"},transaction:e})}});const i=(0,cn.mc)(n),r=Sn({automationStore:t,collectionStore:o});h.Rt(i,r)}function mn(e){return 1===e.length&&e[0].isType("slack_notification")?"notification_event":"event"}function Sn(e){const{automationStore:t,collectionStore:o}=e,n=o.getSchema(),i=t.getActionStores().map((e=>{return e.isType("slack_notification")?{type:"slack_notification"}:e.isType("update_pages")?{property_types:((null===(t=e.getConfig())||void 0===t?void 0:t.properties)??[]).map((e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.type})).filter(ne.$K),type:"update_pages"}:e.isType("create_page")?{property_types:((null===(o=e.getConfig())||void 0===o?void 0:o.properties)??[]).map((e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.type})).filter(ne.$K),type:"create_page"}:void 0;var t,o})).filter(ne.$K),r=t.getTriggerStore().getValue(),a=[];if("event"===(null==r?void 0:r.type)||"notification_event"===(null==r?void 0:r.type)){const{pagesAdded:e,pagePropertiesEdited:t}=r.event;e&&a.push({type:"page"}),"any"===t.type?a.push({condition:"any",type:"property"}):"none"===t.type?a.push({condition:"none",type:"property"}):a.push({condition:"some",property_types:t.some.map((e=>{var t;return null===(t=n[e.property])||void 0===t?void 0:t.type})).filter(ne.$K),type:"property"})}let s;if(t.isTriggerType("event")||t.isTriggerType("notification_event")){const e=t.getTriggerStore().getKeyStore("event").getKeyStore("source").getValue();e&&"collection_view"===e.type&&(s=e.pointer.id)}return{automation_actions:i,automation_id:t.id,automation_triggers:a,collection_id:o.id,collection_view_id:s}}var yn=o(6740),hn=o(37989),fn=o(33907),xn=o(77744),vn=o(12589),Cn=o(44736),bn=o(56666),wn=o(88437),jn=o(37612),Mn=o(61766);const _n=(0,l.defineMessages)({automationSummaryCardMoreButtonAriaLabel:{defaultMessage:"More",id:"automations.AutomationSummaryCard.MoreActionsButton.ariaLabel"},automationSummaryCardMoreMenuEditTitle:{defaultMessage:"Edit",id:"automations.AutomationSummaryCard.MoreActionsMenu.Edit.title"},automationSummaryCardMoreMenuDuplicateTitle:{defaultMessage:"Duplicate",id:"automations.AutomationSummaryCard.MoreActionsMenu.Duplicate.title"},automationSummaryCardMoreMenuPauseTitle:{defaultMessage:"Pause",id:"automations.AutomationSummaryCard.MoreActionsMenu.Pause.title"},automationSummaryCardMoreMenuResumeTitle:{defaultMessage:"Resume",id:"automations.AutomationSummaryCard.MoreActionsMenu.Resume.title"},automationSummaryCardMoreMenuDeleteTitle:{defaultMessage:"Delete",id:"automations.AutomationSummaryCard.MoreActionsMenu.Delete.title"}});function kn(e){window.__c={n:"AutomationSummaryMoreActionsButton"};const{focused:t,style:o,onEdit:i,onDelete:r,onDuplicate:s,onDisable:c,onEnable:d}=e,u=(0,l.useIntl)(),p=(0,a.qz)(void 0,Mn.Z),g=(0,mt.d)();(0,n.useEffect)((()=>{t||p.setState({open:!1})}),[t,p]);const m=(0,S.yK)((e=>({iconButton:{border:`1px solid ${e.regularDividerColor}`,height:26,width:26,...o},iconButtonIcon:{width:16}})),[o]);return(0,ue.jsx)(ue.Fragment,{children:(0,ue.jsx)(ut.ZP,{stopClickPropagation:!0,popupType:g,alignmentToOrigin:ut.vR.Center,placementToOrigin:ut.pO.Bottom,originGap:0,renderOrigin:e=>(0,ue.jsx)(Mt.Z,{ariaLabel:u.formatMessage(_n.automationSummaryCardMoreButtonAriaLabel),icon:bn.o,iconStyle:m.iconButtonIcon,style:m.iconButton,hasBackground:!0,...e}),render:e=>(0,ue.jsx)(Tn,{onClose:()=>e.close(),onEdit:i,onDelete:r,onDuplicate:s,onDisable:c,onEnable:d}),buttonPopupStore:p})})}function Tn(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,onEdit:o,onDelete:n,onDuplicate:i,onDisable:r,onEnable:a}=e,s=(0,l.useIntl)(),c=(0,zt.F)(),d=o?{action:()=>{t(),o()},key:"edit",render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,V.R)({height:16,width:16}),title:s.formatMessage(_n.automationSummaryCardMoreMenuEditTitle)})}:void 0,u=i?{action:()=>{t(),i()},key:"duplicate",render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,wn.a)({height:16,width:16}),title:s.formatMessage(_n.automationSummaryCardMoreMenuDuplicateTitle)})}:void 0,p=r?{action:()=>{t(),r()},key:"disable",render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,Cn.g)({height:16,width:16}),title:s.formatMessage(_n.automationSummaryCardMoreMenuPauseTitle)})}:void 0,g=a?{action:()=>{t(),a()},key:"enable",render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,vn.M)({height:16,width:16}),title:s.formatMessage(_n.automationSummaryCardMoreMenuResumeTitle)})}:void 0,m=n?{action:()=>{t(),n()},key:"delete",render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,jn.y)({height:16,width:16}),title:s.formatMessage(_n.automationSummaryCardMoreMenuDeleteTitle)})}:void 0;return(0,ue.jsx)(Ct.Z,{...c,children:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,sections:[{items:[d,u,p,g,m].filter(ne.$K),key:"items",render:e=>(0,ue.jsx)(Et.Z,{enableActionSheetTitle:!0,topBorder:!0,...e})}],initialFocus:0})})}var An=o(64921),Pn=o(75024);function Vn(e){window.__c={n:"AutomationSummaryCard"};const{actions:t,caption:o,focused:i,hasWarning:a,maxIcons:s,onBlur:l,onClick:c,onDelete:d,onDisable:u,onDuplicate:p,onEdit:g,onEnable:m,onFocus:y,onMouseDown:h,onMouseEnter:f,onMouseLeave:x,title:v,triggers:C}=e,{isMobile:b}=(0,r.Fy)(),w=(0,n.useRef)(null),[j,M]=(0,yn.Z)(),[_,k]=(0,hn.Z)(),[T,A]=(0,n.useState)(!1),P=b||T||M||k,V=(0,S.yK)((e=>({wrap:{background:e.cardContentBackground,border:`1px solid ${e.regularDividerColor}`,borderRadius:8,display:"flex",flexDirection:"column",gap:15,padding:15,position:"relative"},moreButtonWrap:{display:P?"block":"none",position:"absolute",right:8,top:8},iconList:{display:"flex",flexWrap:"wrap",gap:5,listStyle:"none",margin:"0 30px 0 0",padding:0},body:{display:"flex",flexDirection:"column",gap:b?4:2},titleWrap:{...a?{alignItems:"center",display:"inline-flex",gap:4}:(0,Pn.pd)(2),fontSize:b?16:14,fontWeight:ie.Z.fontWeight.medium,lineHeight:"130%"},title:{...a?ie.Z.textOverflowStyle:{}},warning:{color:e.accentColors.orange[400],height:"auto",width:b?16:14},caption:{...(0,Pn.pd)(2),color:e.lightTextColor,fontSize:b?14:12,fontWeight:ie.Z.fontWeight.regular,lineHeight:"130%",margin:0}})),[a,P,b]),F=(0,n.useCallback)((e=>{A(!0),f&&f(e)}),[f]),I=(0,n.useCallback)((e=>{A(!1),x&&x(e)}),[x]);(0,n.useEffect)((()=>{i&&null!==w.current&&w.current.focus()}),[i]);const B=(0,xn.lq)(w,j,_),Z=function(e){const{actionIcons:t,maxIcons:o,triggerIcons:n}=e,i=n.length,r=t.length,a=i>0&&r>0,s=Math.max(o,3),l=a?s-1:s;let c=Math.max(Math.floor(l/2),1),d=Math.max(Math.ceil(l/2),1);if(i<c&&r>d){d+=c-i,c=i}else if(r<d&&i>c){c+=d-r,d=r}const u=[];if(i>0)if(i>c)if(1===c)u.push({color:"gray",type:"truncate",value:i});else{const e=i-(c-1);u.push(...n.slice(0,c-1)),u.push({color:"gray",type:"truncate",value:e})}else u.push(...n);a&&u.push({type:"arrow"});if(r>0)if(r>d)if(1===d)u.push({color:"gray",type:"truncate",value:r});else{const e=r-(d-1);u.push(...t.slice(0,d-1)),u.push({color:"gray",type:"truncate",value:e})}else u.push(...t);return u}({actionIcons:t,maxIcons:On(s),triggerIcons:C}),K=Boolean(d||u||m||p||g);return(0,ue.jsxs)(An.Z,{onBlur:l,onClick:c,onFocus:y,onMouseDown:h,onMouseEnter:F,onMouseLeave:I,ref:B,style:V.wrap,children:[(0,ue.jsxs)("header",{children:[K&&(0,ue.jsx)("div",{style:V.moreButtonWrap,children:(0,ue.jsx)(kn,{focused:P,onDelete:d,onDisable:u,onEnable:m,onDuplicate:p,onEdit:g})}),(0,ue.jsx)("ul",{"aria-hidden":"true",style:V.iconList,children:Z.map(((e,t)=>(0,ue.jsx)("li",{children:(0,ue.jsx)(Fn,{icon:e})},t)))})]}),(0,ue.jsxs)("div",{style:V.body,children:[(0,ue.jsxs)("div",{style:V.titleWrap,children:[(0,ue.jsx)("span",{style:V.title,children:v}),a&&(0,dt.t)(V.warning)]}),o&&(0,ue.jsx)("p",{style:V.caption,children:o})]})]})}function Fn(e){const{icon:t}=e;return"property"===t.type||"page"===t.type||"misc"===t.type?(0,ue.jsx)(In,{color:t.color,icon:t.icon}):"person"===t.type?(0,ue.jsx)(Dn,{actor:t.actor}):"app"===t.type?(0,ue.jsx)(Zn,{color:"default",icon:t.icon}):"arrow"===t.type?(0,ue.jsx)(Bn,{}):"truncate"===t.type?(0,ue.jsx)(Kn,{color:t.color,value:t.value}):void(0,ne.t1)(t.type)}function In(e){window.__c={n:"StandardIcon"};const{color:t,icon:o}=e,n=Rn(t);return(0,ue.jsx)("div",{"aria-hidden":"true",style:n.iconWrap,children:o(n.icon)})}function Bn(){window.__c={n:"ArrowIcon"};const e=Rn("default");return(0,ue.jsx)("div",{style:{...e.iconWrap,...e.iconArrowWrap},children:(0,fn.n)({...e.icon,...e.iconArrow})})}function Zn(e){window.__c={n:"AppIcon"};const{icon:t}=e,o=Rn("default");return(0,ue.jsx)("div",{"aria-hidden":"true",style:o.iconAppWrap,children:t(o.iconApp)})}function Kn(e){window.__c={n:"TruncateIcon"};const{color:t,value:o}=e,n=Rn(t);return(0,ue.jsxs)("div",{style:{...n.iconWrap,...n.truncateWrap},children:["+",o]})}function Dn(e){window.__c={n:"PersonIcon"};const{actor:t}=e,o=Rn("default");return(0,ue.jsx)("div",{"aria-hidden":"true",style:o.iconPersonWrap,children:(0,ue.jsx)(De.ZP,{actor:t,avatarSize:26,format:De.ZP.Format.Inline,isSingle:!1,showRemoveButton:!1,style:{margin:0}})})}function On(e){return void 0===e||e<0?6:e}function Rn(e){const t="default"===e?"gray":e;return(0,S.yK)((e=>{const o="light"===e.mode?400:800,n="light"===e.mode?100:400;return{icon:{fill:e.accentColors[t][o],width:16},iconWrap:{background:e.accentColors[t][n],borderRadius:6,padding:6},iconApp:{width:14},iconAppWrap:{borderRadius:6,borderWidth:1,borderStyle:"solid",borderColor:e.accentColors.gray[n],padding:6},iconPerson:{display:"block",width:"100%"},iconPersonWrap:{alignItems:"center",display:"flex",height:28,justifyContent:"center",width:28},iconArrow:{fill:e.accentColors.gray[600]},iconArrowWrap:{background:void 0},truncateWrap:{alignItems:"center",background:e.accentColors.gray[n],color:e.accentColors[t][o],display:"inline-flex",fontSize:12,fontWeight:ie.Z.fontWeight.semibold,height:28,justifyContent:"center",padding:3,width:28}}}),[t])}const Nn=(0,l.defineMessages)({automationTabTitle:{defaultMessage:"Automations",id:"database.viewSettings.automationTab.title"},automationTabFilterButton:{defaultMessage:"Filter",id:"database.viewSettings.automationTab.filterButton"},automationTabAddFilterButton:{defaultMessage:"Add filter",id:"database.viewSettings.automationTab.addFilterButton"},automationTabFilterMenuSearchInputPlaceholder:{defaultMessage:"Filter by…",id:"database.viewSettings.automationTab.filterMenuSearchInputPlaceholder"},automationTabFilterMenuNoResults:{defaultMessage:"No results",id:"database.viewSettings.automationTab.filterMenuNoResults"},automationNewAutomationTitle:{defaultMessage:"New automation",id:"database.viewSettings.automationTab.newAutomationTitle"},automationLearnAutomationTitle:{defaultMessage:"Learn about automations",id:"database.viewSettings.automationTab.learnAutomationTitle"},automationDisabledCaption:{defaultMessage:"Paused",id:"database.viewSettings.automationTab.disabledCaption"},automationEmptyViewEditorPublic:{defaultMessage:"Automatically set status, assignees, property values and more with automations",id:"database.viewSettings.automationTab.automationEmptyViewEditorPublic"},automationEmptyViewReadOnly:{defaultMessage:"You're a content viewer. Content viewers cannot create automations.",id:"database.viewSettings.automationTab.automationEmptyViewReadOnly"},automationEmptyViewContentOnly:{defaultMessage:"You're a content editor. Content editors can edit pages, but cannot create automations.",id:"database.viewSettings.automationTab.automationEmptyViewContentOnly"},automationSearchPlaceholder:{defaultMessage:"Search for an automation…",id:"database.viewSettings.automationTab.automationSearchPlaceholder"}});function En(e){window.__c={n:"CollectionSettingsAutomationsView"};const{collectionContextStore:t,collectionSettingsStore:o,tabSettings:i}=e,s=(0,l.useIntl)(),c=(0,on.D)(),{isMobile:u}=(0,r.Fy)(),[p,g]=(0,n.useState)(""),y=(0,a.VK)((()=>t.collectionStore()),[t]),f=(0,a.VK)((()=>t.collectionViewBlockStore()),[t]),C=(0,a.VK)((()=>y&&y.id),[y]),b=(0,a.VK)((()=>null==y?void 0:y.getSchema()),[y]),w=(0,a.VK)((()=>null==y?void 0:y.getFormat()),[y]),j=(0,a.VK)((()=>function(e){const{collectionStore:t,collectionViewBlockStore:o}=e;if(!t||!o)return[];const n=t.getAutomationStores(),i=[];for(const r of n){const e=r.getModel();null!=e&&e.getAlive()&&((r.isTriggerType("event")||r.isTriggerType("notification_event"))&&i.push(r))}return i}({collectionStore:y,collectionViewBlockStore:f})),[y,f]),M=(0,a.VK)((()=>function(e){const{automationStores:t,collectionSchema:o,intl:n}=e,i=new Map,r=[];for(const l of t){var a;if(!l.isDefined())continue;const e=[],t=l.getName();void 0!==t&&e.push(t);const c=null===(a=l.getOwnerStore())||void 0===a?void 0:a.getDisplayName(n);if(void 0!==c&&e.push(c),l.isTriggerType("event")||l.isTriggerType("notification_event")){const t=l.getEventConfiguration(),i=null==t?void 0:t.pagePropertiesEdited;if("some"===(null==i?void 0:i.type))for(const n of i.some){const t=null==o?void 0:o[n.property];t&&e.push(`${t.name} ${Lt.SO[t.type]}`)}const r=l.getActionStores();for(const a of r){const t=a.getType();if(t){const o=(0,x.z)(t);(0,v.Xp)(o)&&e.push(n.formatMessage(o.display.name))}if(a.isType("create_page")||a.isType("update_pages")){var s;const t=a.getConfig();null==t||null===(s=t.properties)||void 0===s||s.forEach((t=>{const n=null==o?void 0:o[t];n&&e.push(`${n.name} ${Lt.SO[n.type]}`)}))}}}const d=e.join(" ");i.set(l.id,d),r.push(d)}return function(e){const o=new Set(m().filter(e,r).map((e=>{let{original:t}=e;return t})));return t.filter((0,ne.AO)((e=>{if(!e.isTriggerType("event")&&!e.isTriggerType("notification_event"))return{false:e};const t=i.get(e.id);return t&&o.has(t)?{true:e}:{false:e}})))}}({automationStores:j,collectionSchema:b,intl:s})),[j,b,s]),_=(0,a.VK)((()=>M(p)),[M,p]),k=(0,a.VK)((()=>Ce.Li({collectionStore:y})),[y]),T=(0,n.useCallback)((()=>{d.H4({collectionSettingsStore:o,item:{type:"automationCreateSettings"}})}),[o]),P=(0,n.useCallback)((e=>g(e.target.value)),[]),V=(0,n.useCallback)((()=>{c&&C&&h.qu(c,{collection_id:C})}),[c,C]);(0,n.useEffect)((()=>{if(!c||!C)return;const e="collection_table_header"===i.source?{property_type:i.propertyType,source:i.source}:{source:i.source};h.d(c,{...e,collection_id:C}),nn.default.logEvent("automation_list_view","true")}),[c,C,i]);const[I,B]=n.useState(!1),Z=(0,a.VK)((()=>function(e){var t;const o=null===(t=po.default.state.currentUserStore)||void 0===t?void 0:t.pointer,n=[],i=[];for(const r of e){const e=r.getCreatedByPointer();o&&e&&oe.dr.isEqual(o,e)?n.push(r):i.push(r)}return n.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),i.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),{currentUserAutomations:n,otherUserAutomations:i}}(_)),[_]),K=(0,n.useMemo)((()=>{const{currentUserAutomations:e,otherUserAutomations:t}=Z;return I?[...e,...t]:e.length>0?e:t}),[Z,I]),D=_.length-K.length,O=!I&&D>0,R=K.length>0,N=!R&&!(""!==p),E=(0,S.yK)((e=>({buttonList:{display:"flex",flexDirection:"column",flexShrink:1,gap:12,overflow:"hidden auto",paddingBlockEnd:u?0:12,paddingBlockStart:u?12:0,paddingInline:12},emptyViewWrap:{paddingBlockEnd:42,paddingInline:12},menuScrollerStyle:{marginBlockStart:u?12:8},wrap:{display:"flex",flexDirection:"column"},showMoreButtonContainer:{marginLeft:12,marginBottom:12,marginRight:"auto"},showMoreButtonContent:{fontSize:12},noResultsTitle:{color:e.text.secondary,fontSize:12,margin:0}})),[u]);return y&&b&&w&&f?(0,ue.jsx)(Qo.ZP,{...e,header:!N&&(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(Nt.ZP,{focusInitial:!u,onChange:P,placeholder:s.formatMessage(Nn.automationSearchPlaceholder),showClearButton:!0,value:p})}),footer:(0,ue.jsxs)(Et.Z,{topBorder:!0,children:[k&&(0,ue.jsx)(Jo.Z,{icon:F.R,onClick:T,title:s.formatMessage(Nn.automationNewAutomationTitle),isGray:!0}),(0,ue.jsx)(en.Z,{href:"https://www.notion.so/help/database-automations",external:!0,onClick:V,children:(0,ue.jsx)(Jo.Z,{icon:A.m,title:s.formatMessage(Nn.automationLearnAutomationTitle),isGray:!0})})]}),menuScrollerStyle:E.menuScrollerStyle,title:R||p?s.formatMessage(Nn.automationTabTitle):null,children:(0,ue.jsx)("div",{style:E.wrap,children:N?(0,ue.jsx)("div",{style:E.emptyViewWrap,children:(0,ue.jsx)(Wn,{collectionStore:y})}):(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)("div",{style:E.buttonList,children:K.length>0?K.map(((e,n)=>(0,ue.jsx)(Gn,{collectionContextStore:t,collectionStore:y,collectionSettingsStore:o,focused:!1,schema:b,automationStore:e},e.id))):(0,ue.jsx)("p",{style:E.noResultsTitle,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"No results",id:"collectionSettings.automationsView.noResults"})})}),O&&(0,ue.jsx)(tn.Z,{style:E.showMoreButtonContainer,onClick:e=>{e.stopPropagation(),B(!0)},children:(0,ue.jsx)("div",{style:E.showMoreButtonContent,children:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettings.automationsView.showMore",defaultMessage:"Show {number} more",values:{number:D}})})})]})})}):null}function Wn(e){window.__c={n:"EmptyView"};const{collectionStore:t}=e,o=(0,r.O7)(),n=(0,S.yK)((e=>({wrap:{alignItems:"center",display:"flex",flexDirection:"column",gap:7.5,justifyContent:"center",minHeight:250,textAlign:"center"},icon:{fill:e.icon.yellow,height:24,width:24},title:{fontSize:17,fontWeight:ie.Z.fontWeight.medium,margin:0},copy:{color:e.text.secondary,fontSize:14,margin:0,lineHeight:1.5}})),[]),i=(0,a.VK)((()=>t.getRole()),[t]);let s;return s=(0,a.VK)((()=>Boolean((0,pt.IJ)(o,t))),[t,o])||!i||"editor"===i?Nn.automationEmptyViewEditorPublic:"reader"===i||"comment_only"===i?Nn.automationEmptyViewReadOnly:"content_only_editor"===i||"read_and_write"===i?Nn.automationEmptyViewContentOnly:Nn.automationEmptyViewEditorPublic,(0,ue.jsxs)("div",{style:n.wrap,children:[(0,ue.jsx)("div",{"aria-hidden":!0,children:(0,T.K)(n.icon)}),(0,ue.jsx)("p",{style:n.title,children:(0,ue.jsx)(l.FormattedMessage,{...Nn.automationTabTitle})}),(0,ue.jsx)("p",{style:n.copy,children:(0,ue.jsx)(l.FormattedMessage,{...s})})]})}const Ln={text:Y.p,number:G.J,url:ee.O,file:R.Z,date:D.V,person:U.O,email:O.n,phone_number:z.u,checkbox:B.r,select:q.w,multi_select:L.A,status:X.T,relation:H.v,rollup:$.G,formula:N.D,created_time:Z.I,created_by:K.H,title:Q.c,last_edited_time:Z.I,last_edited_by:K.H,last_visited_time:Z.I,button:X.T,auto_increment_id:E.A,location:W.w,verification:te.f,ai_summary:k.Y,ai_custom_prompt:P.y,ai_extract:L.A,ai_translate:_.Q,ai_category:q.w,ai_keywords:L.A};function Gn(e){window.__c={n:"AutomationSummaryCardWrapper"};const{automationStore:t,collectionContextStore:o,collectionStore:i,collectionSettingsStore:s,focused:c,schema:u}=e,p=(0,l.useIntl)(),g=(0,r.O7)(),m=je({automationStore:t,collectionStore:i}),S=(0,a.VK)((()=>!!(i&&t&&m)&&Ce.qk({automationContextStore:m,automationStore:t,collectionStore:i})),[m,t,i]),h=(0,a.VK)((()=>t.getActionStores()),[t]),x=(0,a.VK)((()=>t.getTriggerStore().getValue()),[t]),v=(0,a.VK)((()=>t.getNameWithDefault(p)),[p,t]),_=(0,a.VK)((()=>"active"===t.getStatus()),[t]),k=(0,a.VK)((()=>o.aliveAutomationCount.state),[o]),T=(0,a.VK)((()=>Ce.i1({actionStores:h,automationStore:t})),[h,t]),A=(0,a.VK)((()=>Ce.qM({automationStore:t})),[t]),P=(0,n.useCallback)((async()=>{await un({collectionStore:i,environment:g,existingAutomationStore:t,intl:p,triggerType:"event",onDelete:()=>{1===k&&d.wl({collectionSettingsStore:s,item:{type:"main"}})}})}),[p,g,i,s,t,k]),B=(0,n.useCallback)((()=>{pn({automationStore:t,collectionStore:i,environment:g})}),[i,g,t]),Z=(0,n.useCallback)((()=>{d.H4({collectionSettingsStore:s,item:{type:"automationEditSettings",automationId:t.id}})}),[s,t]),K=(0,n.useCallback)((()=>{gn({automationStore:t,collectionStore:i,environment:g})}),[i,g,t]),D=(0,n.useMemo)((()=>x?function(e){const{schema:t,triggerConfig:o}=e;if("notification_event"!==o.type&&"event"!==o.type)return[];const n=[];o.event.pagesAdded&&n.push({color:"blue",icon:F.R,type:"page"});const i=o.event.pagePropertiesEdited;if("any"===i.type)n.push({color:"blue",icon:V.R,type:"misc"});else if("some"===i.type)for(const r of i.some){const e=t[r.property],o=r.filter;if(!e)continue;if(!f.Ym[e.type]){n.push({color:"gray",icon:Qn(e.type),type:"property"});continue}const i=b.gB(e),a=b.cu(e);if("changes_to_any"===o.operator)n.push({color:i||a?"gray":"blue",icon:Qn(e.type),type:"property"});else if(i&&!C.mv(o)&&C.r2(o)){const t=C.wB(o);if(t.length>1)n.push({color:"gray",icon:Qn(e.type),type:"property"});else if(1===t.length){const o=t[0];if("is_group"===o.type){const t=(e.groups??[]).find((e=>e.name===o.value));t&&n.push({color:t.color??"gray",icon:Qn(e.type),type:"property"})}else{const t=(e.options??[]).find((e=>e.value===o.value));t&&n.push({color:t.color??"gray",icon:Qn(e.type),type:"property"})}}}else if(a&&!C.mv(o)&&(C.dx(o)||C.NU(o))){const t=C.dx(o)?C.mg(o):C.qC(o);if(1===t.length){const o=t[0],i=(e.options??[]).find((e=>e.value===o.value));i&&n.push({color:i.color??"gray",icon:Qn(e.type),type:"property"})}else t.length>1&&n.push({color:"gray",icon:Qn(e.type),type:"property"})}}return n}({schema:u,triggerConfig:x}):[]),[u,x]),O=(0,a.VK)((()=>function(e){const{actionStores:t,collectionStore:o,schema:n}=e,i=[];for(const c of t)if(c.isType("slack_notification"))i.push({icon:I.P,type:"app"});else if(c.isType("update_pages")){const e=c.getConfig(),t=(null==e?void 0:e.properties)??[];if(1===t.length){var r,a;const l=t[0],c=n[l],d=null==e||null===(r=e.values)||void 0===r?void 0:r[l];if(!c||!d)continue;if(!f.SF(c)){i.push({color:"gray",icon:Qn(c.type),type:"property"});continue}const u=(0,M.A6)(null===(a=d.value)||void 0===a?void 0:a.value);if(b.gB(c)){const e=(c.options||[]).find((e=>e.value===u[0]));e&&i.push({color:e.color??"gray",icon:Qn(c.type),type:"property"})}else if(b.cu(c))if(1===u.length){const e=(c.options||[]).find((e=>e.value===u[0]));e&&i.push({color:e.color??"gray",icon:Qn(c.type),type:"property"})}else u.length>1&&i.push({color:"gray",icon:Qn(c.type),type:"property"});else if(b.KR(c)){var s;const e=(0,w.DW)({textValue:null===(s=d.value)||void 0===s?void 0:s.value,propertySchema:c,blockCreatorPointer:void 0}).map((e=>(0,y.Hl)({pointer:e,getRecordValue:o.getRecordValue})));1===e.length?i.push({actor:e[0],type:"person"}):i.push({color:"gray",icon:Qn(c.type),type:"property"})}else i.push({color:"gray",icon:Qn(c.type),type:"property"})}else t.length>1&&i.push({color:"gray",icon:V.R,type:"misc"})}else if(c.isType("create_page")){var l;(null===(l=c.getConfig())||void 0===l?void 0:l.collection)&&i.push({color:"blue",icon:F.R,type:"page"})}return i}({actionStores:h,collectionStore:i,schema:u})),[u,i,h]),R=(0,a.VK)((()=>_?m&&function(e){const{environment:t,actionStores:o,automationContextStore:n,collectionStore:i,canUserManageAutomation:r,intl:a,schema:s,triggerConfig:c}=e;if(!c||"event"!==c.type&&"notification_event"!==c.type)return;const{event:d}=c,u=[];d.pagesAdded&&u.push(le.Mz(a));if("none"===d.pagePropertiesEdited.type);else if("any"===d.pagePropertiesEdited.type)u.push(le.c5(a));else if("some"===d.pagePropertiesEdited.type)for(const l of d.pagePropertiesEdited.some){const e=s[l.property];if(!e){u.push(le.nf(a));continue}if(!f.Ym[e.type]){u.push(qo({propertySchema:e}));continue}const{filter:t}=l;if("changes_to_any"===t.operator)u.push(le.$G(a,{propertyName:e.name}));else if(f.bD(e))if("status"===e.type){if(!C.r2(t)||!C.vR(t))continue;const o=C.wB(t),n=(0,qe.L)({intl:a,groupValues:o.map((e=>"is_group"===e.type?e.value:void 0)).filter(ne.$K),isText:!0,optionValues:o.map((e=>"is_option"===e.type?e.value:void 0)).filter(ne.$K),propertySchema:e,tokenFormat:j.lo.Small}),i=a.formatList(n,{style:"long",type:"disjunction"});u.push(le.VO(a,{propertyName:e.name,propertyValues:i}))}else if("select"===e.type||"multi_select"===e.type){if(C.mv(t)||!C.dx(t)&&!C.NU(t))continue;const o=Array.isArray(t.value)?t.value:[t.value],n=(0,Yo.z)({intl:a,isText:!0,optionValues:o.map((e=>e.value)).filter(ne.$K),propertySchema:e,tokenFormat:j.lo.Small}),i=a.formatList(n,{style:"long",type:"disjunction"});u.push(le.XJ(a,{propertyName:e.name,propertyValues:i}))}else if("checkbox"===e.type){if(!C.XA(t))continue;u.push((0,Xo.l4)({filter:t,propertySchema:e,intl:a}))}else(0,ne.t1)(e)}const p=a.formatList(u,{style:"long",type:"disjunction"}),g=[];for(const y of o)if(y.isType("slack_notification"))g.push((0,ue.jsx)(l.FormattedMessage,{defaultMessage:"notify {channel}",id:"CollectionSettingsAutomationsView.summaryCard.slackAction",values:{channel:(0,ue.jsx)(Lo,{actionStore:y,isUserAutomationOwner:r})}}));else if(y.isType("update_pages")){const e=y.getConfig(),o=null==e?void 0:e.properties,r=null==e?void 0:e.values,c=null==e?void 0:e.target;if(!o||0===o.length||!c)continue;if("collection"===c.type)if((0,oe.qo)(c.collection,i.pointer))g.push((0,ue.jsx)(l.FormattedMessage,{defaultMessage:"edit pages in this collection",id:"automation.summaryCard.updatePages.sameCollection"}));else{const e=Ge.NW.createChildStore(i,c.collection),o=(0,Le.vU)({environment:t,intl:a,store:e});g.push((0,ue.jsx)(l.FormattedMessage,{defaultMessage:"edit pages in {collectionTitle}",id:"automation.summaryCard.updatePages.differentCollection",values:{collectionTitle:o}}))}else if("variable"===c.type){const e=o[0],t=s[e],l=null==r?void 0:r[e];if(!t){g.push(le.aD(a));continue}if(!l)continue;if(f.SF(t))if("person"===t.type)g.push((0,ue.jsx)(Un,{collectionStore:i,propertyActionValue:l,propertySchema:t}));else if("status"===t.type){const e=(0,ue.jsx)(zn,{propertyActionValue:l,propertySchema:t});e&&g.push(e)}else if("select"===t.type||"multi_select"===t.type)g.push((0,ue.jsx)(Hn,{propertyActionValue:l,propertySchema:t}));else if("checkbox"===t.type)g.push((0,ue.jsx)($n,{propertyActionValue:l,propertySchema:t}));else if("relation"===t.type)g.push((0,ue.jsx)(qn,{automationContextStore:n,collectionStore:i,propertyActionValue:l,propertySchema:t}));else if("date"===t.type){const o=(0,ue.jsx)(Xn,{automationContextStore:n,collectionStore:i,propertyActionValue:l,propertyId:e,propertySchema:t});o&&g.push(o)}else"number"===t.type||"phone_number"===t.type||"text"===t.type||"title"===t.type||"email"===t.type||"url"===t.type?g.push((0,ue.jsx)(Yn,{automationStore:n.context.automationStore,propertyActionValue:l,propertySchema:t})):(0,ne.t1)(t);else g.push(qo({propertySchema:t}))}}else if(y.isType("create_page")){var m;const e=null===(m=y.getConfig())||void 0===m?void 0:m.collection;if(!e)continue;e.id===i.pointer.id?g.push((0,ue.jsx)(l.FormattedMessage,{defaultMessage:"create a page in this database",id:"automation.summaryCard.createPageThisDatabase"})):g.push((0,ue.jsx)(l.FormattedMessage,{defaultMessage:"create a page in another database",id:"automation.summaryCard.createPageAnotherDatabase"}))}const S=a.formatList(g,{style:"long",type:"conjunction"});return a.formatMessage({defaultMessage:"When {triggers}, {actions}.",id:"automation.summaryCard.caption"},{actions:S,triggers:p})}({environment:g,actionStores:h,automationContextStore:m,canUserManageAutomation:T,collectionStore:i,intl:p,schema:u,triggerConfig:x}):p.formatMessage(Nn.automationDisabledCaption)),[_,m,g,h,T,i,p,u,x]),N=(0,a.VK)((()=>{if(!t.isTriggerType("event")&&!t.isTriggerType("notification_event"))return!0;return!t.getTrigger()||Ce.vM({automationStore:t,collectionStore:i})}),[t,i]),E=!_||N,W=(0,n.useCallback)((e=>(0,n.createElement)(Vn,{...e,key:t.id,actions:O,caption:R,focused:c,hasWarning:E,onClick:Z,onDelete:A?P:void 0,onDisable:_&&A&&S?B:void 0,onEdit:T?Z:void 0,onEnable:!_&&A&&S?K:void 0,title:v,triggers:D})),[O,t.id,T,A,R,c,E,_,S,P,B,Z,K,v,D]);return(0,ue.jsx)(de.y,{caption:R,renderOrigin:W,title:v,tooltipAlignment:re.Z.Alignment.Start,tooltipPlacement:re.Z.Placement.Bottom})}function Un(e){window.__c={n:"PersonActionTitle"};const{collectionStore:t,propertyActionValue:o,propertySchema:n}=e,i=(0,l.useIntl)(),r=(0,a.VK)((()=>Re({getRecordModel:t.getRecordModel,propertySchema:n,value:o.value})),[t.getRecordModel,o.value,n]),s=(0,a.VK)((()=>Ne({actors:r,intl:i,propertySchema:n})),[r,i,n]);return s||null}function zn(e){var t;window.__c={n:"StatusActionTitle"};const{propertyActionValue:o,propertySchema:n}=e,i=(0,M.A6)(null===(t=o.value)||void 0===t?void 0:t.value)[0],r=Ye({intl:(0,l.useIntl)(),propertySchema:n,value:i});return r||null}function Hn(e){var t,o;window.__c={n:"MultiSelectActionTitle"};const{propertyActionValue:n,propertySchema:i}=e,r=(0,l.useIntl)(),s=null!==(t=n.value)&&void 0!==t&&t.value?(0,M.A6)(null===(o=n.value)||void 0===o?void 0:o.value):[],c=le.oJ({limit:Ze,propertySchema:i,optionValues:s.map((e=>"string"==typeof e?e:void 0)).filter(ne.$K)});return(0,a.VK)((()=>Be({intl:r,propertySchema:i,values:c})),[r,c,i])}function $n(e){const{propertyActionValue:t,propertySchema:o}=e;return ge({propertySchema:o,value:t.value})}function qn(e){window.__c={n:"RelationActionTitle"};const{automationContextStore:t,collectionStore:o,propertyActionValue:n,propertySchema:i}=e,s=(0,l.useIntl)(),c=(0,r.O7)(),d=n.value,u=(0,a.VK)((()=>t.getAllContextValues()),[t]);return(0,a.VK)((()=>He({automationContextValues:u,collectionStore:o,environment:c,intl:s,propertySchema:i,value:d})),[u,o,c,s,i,d])}function Xn(e){window.__c={n:"DateActionTitle"};const{automationContextStore:t,collectionStore:o,propertyActionValue:i,propertyId:r,propertySchema:s}=e,c=(0,l.useIntl)(),d=i.value,u=(0,n.useMemo)((()=>({type:"collection",collectionStore:o,property:r})),[o,r]),p=(0,a.VK)((()=>_e({automationContextStore:t,intl:c,propertySchema:s,value:d,valueContext:u})),[t,c,s,d,u]);return p||null}function Yn(e){window.__c={n:"TextActionTitle"};const{automationStore:t,propertyActionValue:o,propertySchema:n}=e,i=(0,r.O7)(),s=(0,S.Fg)(),l=(0,a.VK)((()=>ot({automationStore:t,environment:i,propertySchema:n,theme:s,value:o.value})),[t,i,o.value,n,s]);return l||null}function Qn(e){return(0,ne.$K)(e)?Ln[e]??J.S:J.S}o(21703);var Jn=o(64964);function ei(e){window.__c={n:"AutomationEmptyStepButton"};const{icon:t,onClick:o,title:n}=e,i=(0,S.yK)((e=>({button:{alignItems:"center",border:`1px dashed ${e.stroke.regular}`,borderRadius:6,display:"flex",color:e.accentColors.gray[900],gap:6,justifyContent:"center",padding:16},iconWrap:{fill:e.accentColors.gray[600]},title:{fontSize:14,lineHeight:1.3}})),[]);return(0,ue.jsxs)(An.Z,{onClick:o,style:i.button,children:[t&&(0,ue.jsx)("div",{"aria-hidden":"true",style:i.iconWrap,children:t}),(0,ue.jsx)("div",{style:i.title,children:n})]})}function ti(e){window.__c={n:"AutomationActionSelectButton"};const{automationStore:t,initialState:o,updateCurrentAutomationState:n,collectionStore:i}=e,r=(0,mt.d)();return i?(0,ue.jsx)(ut.ZP,{alignmentToOrigin:ut.vR.Center,placementToOrigin:ut.pO.Bottom,popupType:r,render:e=>(0,ue.jsx)(Do,{automationStore:t,buttonPopupParent:e,collectionStore:i,initialState:o,updateCurrentAutomationState:n}),renderOrigin:e=>(0,ue.jsx)(oi,{...e})}):(0,ue.jsx)(oi,{onClick:()=>{}})}function oi(e){return(0,ue.jsx)(ei,{...e,icon:(0,F.R)({height:24,width:12}),title:(0,ue.jsx)(l.FormattedMessage,{id:"AutomationActionSelectButton.actionSection.addAction",defaultMessage:"Add action"})})}var ni=o(73657),ii=o(1136),ri=o(45669),ai=o(31278),si=o(78316);function li(e){window.__c={n:"AutomationCollectionSelectMenu"};const{selectedSourcePointer:t,collectionContextStore:o,onSelect:i,disabled:s}=e,{isMobile:c}=(0,r.Fy)(),d=(0,l.useIntl)(),u=(0,r.O7)(),[p,g]=n.useState(""),m=(0,a.VK)((()=>o.collectionStore()),[o]),y=(0,a.VK)((()=>o.collectionViewBlockStore()),[o]),h=(0,a.VK)((()=>y&&m?y.getCollectionViewStores().filter((e=>{var t;const o=null===(t=e.getCollectionStore())||void 0===t?void 0:t.pointer;return(null==o?void 0:o.id)===m.id})):[]),[y,m]),f=(0,a.VK)((()=>{if(!m)return[];let e;t&&"collection_view"===t.table&&(e=Ge.Xr.createChildStore(m,t));return Te.mN([...h,e].filter(ne.$K),(e=>{let{id:t}=e;return t})).filter((e=>(0,si.D)(e,p)))}),[m,h,p,t]),x=(0,a.VK)((()=>{if(m&&(0,Lt.r_)({collectionStore:m,environment:u,intl:d,queryForFilter:p}))return function(e){const{collectionStore:t,environment:o,selectedSourcePointer:n,onSelect:i,isMobile:r,intl:a}=e,s=t.getIcon(),c=(0,Le.vU)({environment:o,intl:a,store:t}),d=n&&"collection"===n.table&&n.id===t.id,u=t.getSpaceShardedPointer();return{key:"collection",items:[{key:t.id,action:()=>{u&&i(u)},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:s&&(0,ue.jsx)(ai.Z,{isEmptyPage:!1,size:r?18:16,disabled:!0,icon:s}),title:c,caption:(0,ue.jsx)(l.FormattedMessage,{id:"AutomationCollectionSelectMenu.collection.caption",defaultMessage:"Any page in this database",values:{collectionName:c}}),right:d&&(0,vo.e)({width:12,height:"auto"})})}],render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:!0})}}({collectionStore:m,environment:u,selectedSourcePointer:t,onSelect:i,isMobile:c,intl:d})}),[m,u,d,c,i,p,t]),v=function(e){const{menuListItems:t}=e;if(0===t.length)return;return{key:"collection-views",items:t,render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:!0})}}({menuListItems:(0,a.VK)((()=>m&&y&&h?function(e){const{blockStore:t,filteredCollectionViewStores:o,collectionStore:n,selectedSourcePointer:i,onSelect:r,intl:a}=e,s=n.getSchema();return[...o.map((e=>{const o=e.getSpaceShardedPointer();if(e.isDefined()&&o){const c=i&&"collection_view"===i.table&&i.id===o.id,d=(0,Ce.rU)({collectionViewStore:e,collectionSchema:s}),u=(0,ne.$K)(d),p=e.getType(),g=e.getFormat().collection_view_icon,m=e.getName(),S=(o,n)=>(0,ue.jsx)(Rt.Z,{...o,...n,icon:(0,ue.jsx)(ii.F,{color:"lightGray",viewType:p,viewIcon:g}),title:(0,ue.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4},children:[(0,ue.jsx)(ri.Z,{collectionViewType:p,collectionViewName:m}),u&&c&&(0,dt.t)({width:16,height:"auto"})]}),caption:(0,ue.jsx)(di,{blockStore:t,collectionViewStore:e,intl:a,collectionSchema:s,referencesIncompatibleProperties:u}),right:c&&(0,vo.e)({width:12,height:"auto"}),disabled:u,disabledFeedback:u});let y;if(u&&d){var n;const e=null===(n=s[d])||void 0===n?void 0:n.type,t=e?Lt.SO[e]:void 0,o=t?(0,ue.jsx)(l.FormattedMessage,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.specific",defaultMessage:"{propertyTypeName} properties are not supported",values:{propertyTypeName:t}}):(0,ue.jsx)(l.FormattedMessage,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.default",defaultMessage:"Some properties are not supported"});y=e=>(0,ue.jsx)(re.Z,{placement:re.Z.Placement.Right,renderTooltip:()=>o,render:t=>S(e,t)})}else y=S;return{key:e.id,action:()=>{r(o)},render:y}}}))].filter(ne.$K)}({blockStore:y,collectionStore:m,filteredCollectionViewStores:f,selectedSourcePointer:t,onSelect:i,intl:d}):[]),[y,m,h,f,d,i,t])}),C={key:"search",items:[{key:"search_item",action:()=>{},render:()=>(0,ue.jsx)(Nt.ZP,{value:p,focus:!0,style:j.searchBar,textWrapperStyle:j.searchText,onChange:e=>g(e.target.value),placeholder:d.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})})}],render:e=>(0,ue.jsx)(Et.Z,{...e})};let b;(0,ne.$K)(x)||(0,ne.$K)(v)||(b={key:"no-results-section",items:[{key:"no-results-item",action:Te.ZT,render:()=>(0,ue.jsx)(ni.Z,{caption:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"No results",id:"collectionViewSelect.noResults.title"})})}],render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:!0})});const w=[C,x,v,b].filter(ne.$K),j=function(e){return(0,S.yK)((t=>({button:{marginTop:8},buttonPopup:{width:e?void 0:230},searchBar:{marginTop:8,marginBottom:8},searchText:{marginLeft:8,marginRight:8},buttonRight:{color:t.selectLightGray[500]},menuItemTextWrapper:{...e?{marginLeft:12}:{},minWidth:"auto"}})),[e])}(c),M=(0,a.qz)(void 0,Mn.Z),_=(0,mt.d)();if(!m)return null;const k=(0,ue.jsx)(ci,{pointer:t,collectionStore:m,intl:d});return(0,ue.jsx)(ut.ZP,{alignmentToOrigin:ut.vR.End,placementToOrigin:ut.pO.Bottom,popupType:_,style:j.buttonPopup,buttonPopupStore:M,render:e=>{let t;return t=c?{menuType:bt.og.Modal,title:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}),right:(0,ue.jsx)(kt.DoneMenuText,{}),onClickRight:()=>{e.close()}}:{menuType:bt.og.Popup,width:230,maxHeight:"50vh"},(0,ue.jsx)(Ct.Z,{...t,children:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,sections:w,initialFocus:0,onAccept:()=>{e.close()}})})},renderOrigin:e=>(0,ue.jsx)(Jo.Z,{title:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}),showChevron:!0,right:k,rightStyle:{flexShrink:1},rotateChevron:M.state.open,disabled:s,textWrapperStyle:j.menuItemTextWrapper,...e})})}function ci(e){window.__c={n:"AutomationSourceCaption"};const{pointer:t,collectionStore:o,intl:n}=e,i=(0,r.O7)(),s=(0,S.yK)((e=>({warningIcon:{width:16,height:"auto",color:e.accentColors.orange[400]},titleContainer:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,flex:"1 1 auto",minWidth:0},title:{...ie.Z.textOverflowStyle},errorText:{color:e.errorText,fontWeight:ie.Z.fontWeight.medium}})),[]),c=(0,a.VK)((()=>t?Ge.t1.createChildStore(o,t):void 0),[o,t]),d=(0,a.VK)((()=>c?(0,Le.vU)({environment:i,intl:n,store:c}):(0,ue.jsx)("span",{style:s.errorText,children:(0,ue.jsx)(l.FormattedMessage,{id:"AutomationCollectionSelectMenu.source.missing",defaultMessage:"Select database"})})),[i,n,s.errorText,c]),u=(0,a.VK)((()=>{if(!c||c.table===Yt.v)return!1;const e=o.getSchema();return(0,ne.$K)((0,Ce.rU)({collectionViewStore:c,collectionSchema:e}))}),[o,c]);return(0,ue.jsxs)("div",{style:s.titleContainer,children:[u&&(0,dt.t)(s.warningIcon),(0,ue.jsx)("span",{style:s.title,children:d})]})}function di(e){window.__c={n:"CollectionViewCaption"};const{blockStore:t,collectionViewStore:o,intl:n,collectionSchema:i,referencesIncompatibleProperties:s}=e,c=(0,r.O7)(),d=(0,a.VK)((()=>!o.getAlive()),[o]),u=(0,a.VK)((()=>{const e=o.getParentBlockStore();if(e)return t.id!==e.id?(0,Le.vU)({environment:c,intl:n,store:e}):void 0}),[t.id,o,n,c]),p=(0,a.VK)((()=>{const e=o.getQuery(i);return(0,C.OH)({propertyFilters:o.getPropertyFiltersStore().getValue()??[],combinatorFilter:null==e?void 0:e.filter,schema:i}).reduce(((e,t)=>{if((0,C.aN)(t))return e+1;return e+(t.filters??[]).length}),0)}),[i,o]);return s?(0,ue.jsx)(l.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.unsupportedView",defaultMessage:"Not supported"}):d?(0,ue.jsx)(l.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.deletedView",defaultMessage:"<emphasis>View not found.</emphasis>",values:{emphasis:e=>(0,ue.jsx)("em",{children:e})}}):u?(0,ue.jsx)(l.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionDifferentParent",defaultMessage:"<emphasis>View configured in {externalParentBlockName}</emphasis>",values:{emphasis:e=>(0,ue.jsx)("em",{children:e}),externalParentBlockName:u}}):0===p?(0,ue.jsx)(l.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionWithNoFilters",defaultMessage:"Any page in this view"}):(0,ue.jsx)(l.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionWithFilters",defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",values:{ruleCount:p}})}function ui(e){window.__c={n:"DeletedPropertyStep"};const{propertyId:t,disabled:o,collectionStore:n,onClick:i}=e,r=(0,S.Fg)(),s="light"===r.mode?50:200,c="light"===r.mode?700:900,d=(0,S.yK)((e=>{const t="light"===e.mode?400:800;return{warning:{color:e.accentColors.orange[t]}}}),[]),u=(0,a.VK)((()=>n.getDeletedSchema()[t]),[n,t]);return(0,ue.jsx)(ce.pW,{disabled:o,icon:e=>(0,dt.t)({...e,...d.warning}),title:(0,ue.jsx)(j.ZP,{format:j.lo.Medium,value:(0,ue.jsx)(l.FormattedMessage,{id:"deletedPropertyStep.deletedProperty.title",defaultMessage:"{propertyName} property deleted",values:{propertyName:null==u?void 0:u.name}}),theme:r,isSingle:!0,backgroundColor:r.accentColors.yellow[s],color:r.accentColors.yellow[c]}),onClick:i})}var pi=o(55863);function gi(e){window.__c={n:"AutomationDeletedPropertyMenu"};const{stepType:t,onDelete:o,onViewDeletedProperties:n}=e,i=(0,zt.F)({width:266}),a=(0,r.Fy)().isMobile,s=(0,S.yK)((e=>({icon:{width:a?"12px":"16px",height:"auto",color:e.accentColors.gray[600]},content:{fontSize:"14px",fontWeight:400}})),[a]);return(0,ue.jsx)(Ct.Z,{...i,children:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,sections:[{key:"actions-section",items:[{key:"view-deleted-properties",action:()=>{n()},render:e=>(0,ue.jsx)(Rt.Z,{...e,title:(0,ue.jsx)("span",{style:s.content,children:(0,ue.jsx)(l.FormattedMessage,{id:"automationDeletedPropertyMenu.viewDeletedProperties.title",defaultMessage:"View deleted properties"})}),icon:(0,pi.s)(s.icon)})},{key:"delete-action",action:()=>{o()},render:e=>(0,ue.jsx)(Rt.Z,{...e,title:(0,ue.jsx)("span",{style:s.content,children:"action"===t?(0,ue.jsx)(l.FormattedMessage,{id:"automationDeletedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}):(0,ue.jsx)(l.FormattedMessage,{id:"automationDeletedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})}),icon:(0,jn.y)(s.icon)})}],render:e=>(0,ue.jsx)(Et.Z,{...e})}],initialFocus:0})})}const mi=(0,l.defineMessages)({searchInputPlaceholder:{id:"automationEventTriggerMenu.searchInputPlaceholder.label",defaultMessage:"Search for trigger…"},pageAddedCopy:{id:"automationEventTriggerMenu.pageAdded.title",defaultMessage:"Page added"},pagePropertiesEditedCopy:{id:"automationEventTriggerMenu.anyPropertyEdited.title",defaultMessage:"Any property"}});function Si(e){window.__c={n:"AutomationEventTriggerMenu"};const{automationStore:t,automationTriggerMenuStore:o,collectionStore:i,updateCurrentState:r,onClose:s}=e,c=(0,S.Fg)(),d=(0,l.useIntl)(),[u,p]=n.useState(""),g=(0,a.VK)((()=>i.getSchema()),[i]),y=(0,a.VK)((()=>t.getTrigger()),[t]),h=(0,a.VK)((()=>("event"===(null==y?void 0:y.type)||"notification_event"===(null==y?void 0:y.type))&&y.event.pagesAdded),[y]),x=(0,a.VK)((()=>(0,f._X)({collectionFormat:i.getFormat(),collectionSchema:g})),[i,g]),v=(0,Ce.EF)({collectionSchema:g,propertyIds:x,searchTerm:u}),C=(0,S.yK)((e=>({propertyIcon:{width:16,height:16,color:e.mediumIconColor}})),[]),b=(0,zt.F)({maxHeight:"50vh",width:266}),w=(0,ue.jsx)(Nt.ZP,{focus:!0,style:{marginTop:12,marginBottom:6},value:u,onChange:e=>{p(e.target.value)},placeholder:d.formatMessage(mi.searchInputPlaceholder)}),j=h?void 0:function(e){const{intl:t,searchInput:o,updateCurrentState:n,onClose:i,styles:r}=e,a=t.formatMessage(mi.pageAddedCopy);if(!m().test(o,a))return;return{key:"page_added_section",items:[{key:"page_added",action:()=>{n({type:"update_trigger",trigger:{type:"page_added"}}),i()},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,F.R)(r.propertyIcon),title:a})}],render:e=>(0,ue.jsx)(Et.Z,{...e})}}({intl:d,searchInput:u,updateCurrentState:r,onClose:s,styles:C}),M=(0,a.VK)((()=>function(e){const{automationTriggerValue:t,automationTriggerMenuStore:o,showTopBorder:n,properties:i,collectionSchema:r,theme:a,updateCurrentState:s,onClose:c,intl:d,searchInput:u,styles:p}=e,g=d.formatMessage(mi.pagePropertiesEditedCopy);let S=!1,y=[];"event"!==(null==t?void 0:t.type)&&"notification_event"!==(null==t?void 0:t.type)||(S="any"===t.event.pagePropertiesEdited.type,y="some"===t.event.pagePropertiesEdited.type?t.event.pagePropertiesEdited.some:[]);const h=[S||!m().test(u,g)?void 0:{key:"any_property_edited",action:async()=>{await async function(e){const{hasSpecificPropertyChangedFilters:t}=e;if(!t)return!0;return await an.confirmUserAction({message:(0,ue.jsx)(l.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.message",defaultMessage:"Replace other triggers?"}),description:(0,ue.jsx)(l.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.description",defaultMessage:"Adding the 'Any property edited' trigger will replace all other property triggers."}),acceptLabel:(0,ue.jsx)(l.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.acceptLabel",defaultMessage:"Replace"})})}({hasSpecificPropertyChangedFilters:y.length>0})&&(s({type:"update_trigger",trigger:{type:"any_page_property_edited"}}),c())},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,V.R)(p.propertyIcon),title:g})},...i.map((e=>{if(!y.find((t=>t.property===e)))return function(e){const{automationTriggerMenuStore:t,propertyId:o,collectionSchema:n,theme:i,updateCurrentState:r,onClose:a}=e,s=n[o];if(!s)return;const l=(0,f.bD)(s);return{key:o,action:()=>{l?t.pushSettingsItem({type:"propertyChangedFilter",property:o}):(r({type:"update_trigger",trigger:{type:"property_changed",property:o,filter:{operator:"changes_to_any"}}}),a())},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,ue.jsx)(Kt.ZP,{icon:s.icon,type:s.type,size:16,theme:i}),title:s.name,right:l?(0,Ot.o)({marginLeft:6,width:12,height:"auto"}):void 0})}}({propertyId:e,collectionSchema:r,theme:a,updateCurrentState:s,automationTriggerMenuStore:o,onClose:c})})).filter(ne.$K)].filter(ne.$K);if(0===h.length)return;return{key:"page_properties_edited_section",items:h,render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:n,title:(0,ue.jsx)(l.FormattedMessage,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Property edited"})})}}({automationTriggerValue:y,automationTriggerMenuStore:o,showTopBorder:Boolean(j),properties:v,collectionSchema:g,theme:c,updateCurrentState:r,onClose:s,searchInput:u,intl:d,styles:C})),[y,o,j,v,g,c,r,s,u,d,C]),_=n.useMemo((()=>{const e=[j,M].filter(ne.$K);return 0===e.length?[{key:"none",items:[{key:"none-item",action:()=>{},render:e=>(0,ue.jsx)(Rt.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,ue.jsx)(l.FormattedMessage,{id:"automations.eventTriggerMenu.noResultsItem",defaultMessage:"No results"})})}],render:e=>(0,ue.jsx)(Et.Z,{...e})}]:e}),[j,M]);return(0,ue.jsx)(Ct.Z,{...b,header:w,children:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,sections:_,initialFocus:0})})}function yi(e){window.__c={n:"AutomationCheckboxPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:i,propertySchema:r,propertyChangedFilter:s,onClose:c}=e,d=(0,a.VK)((()=>"changes_to_any"===s.operator?[{type:"exact",value:!0},{type:"exact",value:!1}]:(0,C.XA)(s)&&(0,C.vR)(s)?Array.isArray(s.value)?s.value:[s.value]:[]),[s]),[u,p]=(0,n.useState)(d),g=(0,n.useMemo)((()=>1===u.length?{operator:"checkbox_is",value:u[0]}:{operator:"changes_to_any"}),[u]),m=(0,n.useMemo)((()=>2===u.length||1===u.length&&"partial"),[u]),S=(0,n.useCallback)((e=>{const t=Boolean(u.find((t=>t.value===e)));p(t?u.filter((t=>t.value!==e)):[...u,{type:"exact",value:e}])}),[u]),y=(0,n.useCallback)((()=>{(0,Ce.WM)({anyOptionCheckState:m,propertyId:t,updateCurrentState:o,currentFilter:g}),c()}),[m,g,c,t,o]),h=Boolean(u.find((e=>!0===e.value))),f=Boolean(u.find((e=>!1===e.value)));return(0,ue.jsx)(Pt,{type:"default",automationTriggerActionMenuStore:i,onDone:y,onClose:c,sections:[{key:"select",render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:!0}),items:[{key:"unchecked",render:e=>(0,ue.jsx)(Rt.Z,{...e,checkState:f,isTokenTitle:!0,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Unchecked",id:"automations.propertyTrigger.checkbox.unchecked"})}),action:()=>S(!1)},{key:"checked",render:e=>(0,ue.jsx)(Rt.Z,{...e,checkState:h,isTokenTitle:!0,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Checked",id:"automations.propertyTrigger.checkbox.checked"})}),action:()=>S(!0)}]}],headerTitle:(0,ue.jsx)(l.FormattedMessage,{id:"automations.propertyTrigger.checkbox.title",defaultMessage:"{propertyName} set to",values:{propertyName:r.name}})})}var hi=o(56416),fi=o(60458),xi=o(47082);function vi(e){window.__c={n:"AutomationSelectPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:i,propertySchema:s,propertyChangedFilter:c,onClose:d}=e,{isMobile:u,isAndroid:p}=(0,r.Fy)(),g=(0,l.useIntl)(),m=(0,a.VK)((()=>{if("changes_to_any"===c.operator){return(s.options??[]).map((e=>({type:"exact",value:e.value})))}if(!(0,C.dx)(c)&&!(0,C.NU)(c))return[];if((0,C.vR)(c)){const e=(s.options??[]).map((e=>e.value));return(Array.isArray(c.value)?c.value:[c.value]).filter((t=>(0,ne.$K)(t.value)&&e.includes(t.value)))}return[]}),[s,c]),[S,y]=n.useState(m),h=(0,a.VK)((()=>function(e){const{propertySchema:t,selectedOptions:o}=e;let n=!1,i=!0;const r=t.options??[];for(const a of r){const e=o.some((e=>e.value===a.value));n||=e,i&&=e}return!!i||!!n&&"partial"}({propertySchema:s,selectedOptions:S})),[s,S]),f=n.useMemo((()=>(s.options??[]).map((e=>({type:"exact",value:e.value})))),[s]),x=n.useMemo((()=>"multi_select"===s.type?{operator:"enum_contains",value:S}:"select"===s.type?{operator:"enum_is",value:S}:(0,ne.t1)(s)),[s,S]),v=!0===h?[]:S.map((e=>{if(!e.value||!s.options)return;const t=(0,w.i7)(s.options,e.value);return t?(0,ue.jsx)(Ae.a,{format:u?j.lo.Large:j.lo.Small,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!0,onClickRemove:()=>{const t=Te.zu(S,e);y(t)}},t.id):void 0})),[b,M]=n.useState(""),_=(0,hi.I4)({query:b,propertySchema:s,selectedValues:S,updateValue:e=>{M(""),y(e)},isMobile:u,styles:{}}),k=[{key:"search",items:[{key:"input",action:()=>{},render:e=>(0,ue.jsx)(xi.Z,{...e,focusInitial:!0,onClick:void 0,focusAfterAnimation:!0,format:xi.Z.Format.FilterValue,tokens:v,placeholder:h?g.formatMessage({defaultMessage:"Any option",id:"automations.selectPropertyChangedFilter.inputPlaceholder.anyOption"}):g.formatMessage({defaultMessage:"Select one or more options…",id:"automations.selectPropertyChangedFilter.inputPlaceholder.searchPlaceholder"}),onRemoveLastToken:()=>{const e=S.slice(0,S.length-1);y(e)},onClearButtonClick:()=>{y([]),d()},value:b,onChange:e=>{M(e.target.value)},dontShowBorderBottom:p,showClearButton:!0})}],render:e=>(0,ue.jsx)(Et.Z,{...e})},{key:"any",items:[{key:"any-option-item",action:()=>{!0===h?y([]):!1===h||"partial"===h?y(f):(0,ne.t1)(h),M("")},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,ue.jsx)(fi.Z,{checked:h,size:14,onClick:e.onClick}),title:(0,ue.jsx)(l.FormattedMessage,{id:"automations.selectPropertyChangedFilter.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:!0})},_.length>0?{key:"items",items:_,render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:!0})}:void 0].filter(ne.$K);return(0,ue.jsx)(Pt,{type:"default",automationTriggerActionMenuStore:i,onDone:()=>{(0,Ce.WM)({anyOptionCheckState:h,propertyId:t,updateCurrentState:o,currentFilter:x}),d()},onClose:d,sections:k,headerTitle:(0,ue.jsx)(l.FormattedMessage,{id:"automations.propertyChangedFilterHeader.select.title",defaultMessage:"{propertyName} set to",values:{propertyName:s.name}})})}var Ci=o(82584),bi=o(97004);function wi(e){window.__c={n:"AutomationStatusPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:i,propertySchema:s,propertyChangedFilter:c,onClose:d}=e,{isMobile:u}=(0,r.Fy)(),p=(0,a.VK)((()=>{if("changes_to_any"===c.operator){return(s.groups??[]).map((e=>({type:"is_group",value:e.name})))}return(0,C.r2)(c)&&(0,C.vR)(c)?(0,C.wB)(c):[]}),[s,c]),[g,m]=n.useState(p),S=(0,a.VK)((()=>function(e){const{propertySchema:t,selectedStatusOptions:o}=e,n=t.groups??[],i=t.options??[],r=n.map((e=>(0,bi.IX)({group:e,options:i,filterValues:o}))),a=r.every((e=>!0===e.groupCheckState)),s=r.some((e=>!1!==e.groupCheckState));return!!a||!!s&&"partial"}({propertySchema:s,selectedStatusOptions:g})),[s,g]),y=n.useMemo((()=>(s.groups??[]).map((e=>({type:"is_group",value:e.name})))),[s]),h=(0,Ci.S)({propertySchema:s,statusFilterValues:g,updateValue:e=>{m(e)},isMobile:u,styles:{},visibleOptions:s.options??[]});return(0,ue.jsx)(Pt,{type:"default",automationTriggerActionMenuStore:i,onDone:()=>{(0,Ce.WM)({anyOptionCheckState:S,propertyId:t,updateCurrentState:o,currentFilter:{operator:"status_is",value:g}}),d()},onClose:()=>{d()},sections:[{key:"any",items:[{key:"any-option-item",action:()=>{!0===S?m([]):!1===S||"partial"===S?m(y):(0,ne.t1)(S)},render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,ue.jsx)(fi.Z,{checked:S,size:14,onClick:e.onClick}),title:(0,ue.jsx)(l.FormattedMessage,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,ue.jsx)(Et.Z,{...e})},{key:"items",items:h,render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:!0})}],headerTitle:(0,ue.jsx)(l.FormattedMessage,{id:"automations.propertyChangedFilterHeader.status.title",defaultMessage:"{propertyName} set to",values:{propertyName:s.name}})})}function ji(e){window.__c={n:"AutomationEventTriggerPropertyChangedFilterMenu"};const{automationStore:t,propertyId:o,automationTriggerMenuStore:n,collectionStore:i,updateCurrentState:r,onClose:s}=e,l=(0,a.VK)((()=>i.getSchema()),[i])[o],c=(0,a.VK)((()=>t.getTrigger()),[t]);let d=[];"event"!==(null==c?void 0:c.type)&&"notification_event"!==(null==c?void 0:c.type)||(d="some"===c.event.pagePropertiesEdited.type?c.event.pagePropertiesEdited.some:[]);const u=d.find((e=>e.property===o))??{property:o,filter:{operator:"changes_to_any"}};if(!l)return null;return(0,f.bD)(l)?"multi_select"===l.type||"select"===l.type?(0,ue.jsx)(vi,{propertyId:o,updateCurrentState:r,automationTriggerMenuStore:n,propertySchema:l,propertyChangedFilter:u.filter,onClose:s}):"status"===l.type?(0,ue.jsx)(wi,{propertyId:o,updateCurrentState:r,automationTriggerMenuStore:n,propertySchema:l,propertyChangedFilter:u.filter,onClose:s}):"checkbox"===l.type?(0,ue.jsx)(yi,{automationTriggerMenuStore:n,onClose:s,propertyChangedFilter:u.filter,propertyId:o,propertySchema:l,updateCurrentState:r}):null:null}function Mi(e){window.__c={n:"AutomationTriggerMenuController"};const{automationStore:t,collectionStore:o,initialState:i,updateCurrentAutomationState:r,buttonPopupParent:s}=e,l=(0,a.VK)((()=>{const e=new ht;return e.setState({stack:[i]}),e}),[i]),c=(0,a.VK)((()=>l.getCurrentTab()),[l]),d=(0,n.useCallback)((()=>s.close()),[s]);return c?"eventTriggers"===c.type?(0,ue.jsx)(Si,{automationStore:t,automationTriggerMenuStore:l,collectionStore:o,updateCurrentState:r,onClose:d}):"propertyChangedFilter"===c.type?(0,ue.jsx)(ji,{automationStore:t,propertyId:c.property,automationTriggerMenuStore:l,collectionStore:o,updateCurrentState:r,onClose:d}):(0,ne.t1)(c):null}var _i=o(50780);function ki(e){window.__c={n:"AutomationUnsupportedPropertyMenu"};const{stepType:t,onDelete:o,onViewEditProperty:n,propertyId:i,propertySchema:a}=e,s=(0,zt.F)({width:266}),c=(0,r.Fy)().isMobile,d=(0,S.yK)((e=>({icon:{width:c?"12px":"16px",height:"auto",color:e.accentColors.gray[600]},content:{fontSize:"14px",fontWeight:400}})),[c]);return(0,ue.jsx)(Ct.Z,{...s,children:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,sections:[{key:"actions-section",items:[{key:"view-edit-property",action:()=>n(i),render:e=>(0,ue.jsx)(Rt.Z,{...e,title:(0,ue.jsx)("span",{style:d.content,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Edit {propertyName}",id:"automationUnsupportedPropertyMenu.viewDeletedProperties.title",values:{propertyName:a.name}})}),icon:(0,_i.E)(d.icon)})},{key:"delete-action",action:()=>o(),render:e=>(0,ue.jsx)(Rt.Z,{...e,title:(0,ue.jsx)("span",{style:d.content,children:"action"===t?(0,ue.jsx)(l.FormattedMessage,{id:"automationUnsupportedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}):(0,ue.jsx)(l.FormattedMessage,{id:"automationUnsupportedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})}),icon:(0,jn.y)(d.icon)})}],render:e=>(0,ue.jsx)(Et.Z,{...e})}],initialFocus:0})})}function Ti(e){window.__c={n:"AutomationAnyEditPropertyTrigger"};const{disabled:t,onDelete:o,onClick:i,propertySchema:r,onEdit:a}=e,s=(0,l.useIntl)(),c=(0,S.Fg)(),d=(0,S.yK)((()=>({propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold},wrap:{display:"inline-flex",width:"100%"}})),[]),u=(0,ue.jsx)("span",{style:d.propertyName,children:r.name}),p=(0,le.$G)(s,{propertyName:u}),g=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:t,onClick:i,icon:e=>(0,ue.jsx)(Kt.ZP,{size:16,theme:c,icon:r.icon,style:e,type:r.type}),title:(0,ue.jsx)("span",{style:d.wrap,children:p}),onEdit:a,onDelete:o})),[t,i,o,a,r.icon,r.type,d.wrap,c,p]);return(0,ue.jsx)(de.y,{renderOrigin:g,title:p,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left})}function Ai(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r}=e;if("changes_to_any"===t.operator)return(0,ue.jsx)(Ti,{disabled:r,propertySchema:o,onClick:n,onEdit:n,onDelete:i});{const e={filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r};return(0,ue.jsx)(Pi,{...e})}}function Pi(e){window.__c={n:"ParametrizableCheckboxPropertyTriggerFilter"};const{filter:t,propertySchema:o,onEdit:i,onDelete:r,disabled:a}=e,s=(0,l.useIntl)(),c=(0,S.yK)((()=>({content:{alignItems:"center",display:"flex",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold}})),[]);let d,u;(0,C.vR)(t)&&(d=(0,Xo.zR)({filter:t,intl:s,propertySchema:o,styles:c}),u=(0,Xo.l4)({filter:t,intl:s,propertySchema:o}));const p=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:a,icon:Kt.wG[o.type],onClick:i,onEdit:i,onDelete:r,title:(0,ue.jsx)("div",{style:c.content,children:d})})),[a,r,i,o.type,c.content,d]);return d&&u?(0,ue.jsx)(de.y,{renderOrigin:p,title:u,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left}):null}function Vi(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r}=e;if("changes_to_any"===t.operator)return(0,ue.jsx)(Ti,{disabled:r,propertySchema:o,onClick:n,onEdit:n,onDelete:i});{const e={filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r};return(0,ue.jsx)(Fi,{...e})}}function Fi(e){window.__c={n:"ParametrizableSelectPropertyTriggerFilter"};const{filter:t,propertySchema:o,onEdit:i,onDelete:r,disabled:a}=e,s=(0,l.useIntl)(),c=(0,S.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold}})),[]);let d,u;if((0,C.vR)(t)){const e=t.value,n=o.name,i=(Array.isArray(e)?e:[e]).map((e=>e.value)).filter(ne.$K),r=(0,Yo.z)({intl:s,limit:5,optionValues:i,propertySchema:o}),a=s.formatList(r,{style:"long",type:"disjunction"}),l=(0,Yo.z)({intl:s,isText:!0,limit:5,optionValues:i,propertySchema:o}),p=s.formatList(l,{style:"long",type:"disjunction"});d=(0,le.XJ)(s,{propertyName:(0,ue.jsx)("span",{style:c.propertyName,children:n}),propertyValues:(0,Pe.H)(a)}),u=(0,le.XJ)(s,{propertyName:(0,ue.jsx)("span",{style:c.propertyName,children:n}),propertyValues:(0,Pe.H)(p)})}const p=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:a,icon:Kt.wG[o.type],onClick:i,onDelete:r,onEdit:i,title:(0,ue.jsx)("div",{style:c.content,children:d})})),[a,r,i,o.type,c.content,d]);return d&&u?(0,ue.jsx)(de.y,{renderOrigin:p,title:u,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left}):null}const Ii=5;function Bi(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r}=e;return"changes_to_any"===t.operator?(0,ue.jsx)(Ti,{disabled:r,propertySchema:o,onClick:n,onDelete:i,onEdit:n}):(0,ue.jsx)(Zi,{...e,filter:t})}function Zi(e){window.__c={n:"ParametrizableStatusPropertyTriggerFilter"};const{filter:t,limit:o=Ii,propertySchema:i,onEdit:r,onDelete:a,disabled:s}=e,c=(0,l.useIntl)(),d=(0,S.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...ie.Z.textOverflowStyle,fontWeight:ie.Z.fontWeight.semibold}})),[]);let u,p;if((0,C.vR)(t)){const e=i.name,n=(0,C.wB)(t),r=n.map((e=>"is_group"===e.type?e.value:void 0)).filter(ne.$K),a=n.map((e=>"is_option"===e.type?e.value:void 0)).filter(ne.$K),s=(0,qe.L)({intl:c,groupValues:r,limit:o,optionValues:a,propertySchema:i}),l=c.formatList(s,{style:"long",type:"disjunction"}),g=(0,qe.L)({intl:c,isText:!0,groupValues:r,limit:o,optionValues:a,propertySchema:i}),m=c.formatList(g,{style:"long",type:"disjunction"});u=(0,le.VO)(c,{propertyName:(0,ue.jsx)("span",{style:d.propertyName,children:e}),propertyValues:(0,Pe.H)(l)}),p=(0,le.VO)(c,{propertyName:(0,ue.jsx)("span",{style:d.propertyName,children:e}),propertyValues:(0,Pe.H)(m)})}const g=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:s,icon:X.T,title:(0,ue.jsx)("div",{style:d.content,children:u}),onEdit:r,onDelete:a,onClick:r})),[s,a,r,d.content,u]);return u&&p?(0,ue.jsx)(de.y,{renderOrigin:g,title:p,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left}):null}function Ki(e){window.__c={n:"AutomationTriggerList"};const{automationStore:t,collectionStore:o,disabled:i,handleNavigateToEditProperty:r,handleNavigateToDeletedProperties:s,updateCurrentState:l}=e,c=(0,mt.d)(),d=(0,a.VK)((()=>o.getSchema()),[o]),u=(0,a.VK)((()=>t.getTriggerStore().getKeyStore("event").getValue()),[t]),p=(0,n.useCallback)((e=>{l({type:"remove_trigger",trigger:{type:"property_changed",property:e,filter:{operator:"changes_to_any"}}})}),[l]),g=Ni(),m=[];return null!=u&&u.pagesAdded&&m.push((0,ue.jsx)(Oi,{disabled:i,updateCurrentState:l},"page_added_trigger")),"any"===(null==u?void 0:u.pagePropertiesEdited.type)&&m.push((0,ue.jsx)(Ri,{disabled:i,updateCurrentState:l},"any_page_property_edited_trigger")),"some"===(null==u?void 0:u.pagePropertiesEdited.type)&&m.push(...u.pagePropertiesEdited.some.map((e=>{const{property:a,filter:u}=e,g=d[a];return g?f.Ym[g.type]?"status"!==g.type||"changes_to_any"!==u.operator&&!(0,C.r2)(u)?"select"!==g.type||"changes_to_any"!==u.operator&&!(0,C.dx)(u)?"multi_select"!==g.type||"changes_to_any"!==u.operator&&!(0,C.NU)(u)?"checkbox"!==g.type||"changes_to_any"!==u.operator&&!(0,C.XA)(u)?"changes_to_any"===u.operator?(0,ue.jsx)(Ti,{disabled:i,onClick:e=>{e.setState({open:!0})},propertySchema:g,onDelete:()=>{p(a)}},`changes_to_any_${a}_trigger`):void 0:(0,ue.jsx)(Di,{automationStore:t,collectionStore:o,property:a,renderOrigin:e=>{let{onClick:t}=e;return(0,ue.jsx)(Ai,{disabled:i,filter:u,propertySchema:g,onEdit:t,onDelete:()=>{p(a)}})},updateCurrentState:l},`changes_to_any_${a}_trigger`):(0,ue.jsx)(Di,{property:a,automationStore:t,collectionStore:o,updateCurrentState:l,renderOrigin:e=>{let{onClick:t}=e;return(0,ue.jsx)(Vi,{disabled:i,filter:u,propertySchema:g,onEdit:t,onDelete:()=>{p(a)}})}},`changes_to_any_${a}_trigger`):(0,ue.jsx)(Di,{property:a,automationStore:t,collectionStore:o,updateCurrentState:l,renderOrigin:e=>{let{onClick:t}=e;return(0,ue.jsx)(Vi,{disabled:i,filter:u,propertySchema:g,onEdit:t,onDelete:()=>{p(a)}})}},`changes_to_any_${a}_trigger`):(0,ue.jsx)(Di,{automationStore:t,property:a,collectionStore:o,updateCurrentState:l,renderOrigin:e=>{let{onClick:t}=e;return(0,ue.jsx)(Bi,{disabled:i,filter:u,propertySchema:g,onEdit:t,onDelete:()=>{p(a)}})}},`changes_to_any_${a}_trigger`):(0,ue.jsx)(ut.ZP,{alignmentToOrigin:ut.vR.Center,placementToOrigin:ut.pO.Bottom,popupType:c,render:()=>(0,ue.jsx)(ki,{onDelete:()=>{l({type:"remove_trigger",trigger:{filter:u,property:a,type:"property_changed"}})},onViewEditProperty:r,propertyId:a,propertySchema:g,stepType:"trigger"}),renderOrigin:e=>(0,n.createElement)($o,{...e,key:`unsupported_${a}_trigger`,disabled:i,onClick:()=>e.onClick(),propertySchema:g})},`unsupported_property_${a}_trigger`):(0,ue.jsx)(ut.ZP,{alignmentToOrigin:ut.vR.Center,placementToOrigin:ut.pO.Bottom,popupType:c,render:()=>(0,ue.jsx)(gi,{stepType:"trigger",onDelete:()=>{l({type:"remove_trigger",trigger:{filter:u,property:a,type:"property_changed"}})},onViewDeletedProperties:s}),renderOrigin:e=>(0,ue.jsx)(ui,{...e,disabled:i,propertyId:a,collectionStore:o})},`deleted_property_${a}_trigger`)})).filter(ne.$K)),(0,ue.jsx)("ul",{style:g.stepList,children:m.map(((e,t)=>(0,ue.jsx)("li",{style:0===t?{}:g.stepItemWithBorderTop,children:e},t)))})}function Di(e){window.__c={n:"AdvancedTriggerPopup"};const{automationStore:t,renderOrigin:o,collectionStore:n,property:i,updateCurrentState:r}=e,a=(0,mt.d)();return(0,ue.jsx)(ut.ZP,{popupType:a,renderOrigin:o,render:e=>(0,ue.jsx)(Mi,{automationStore:t,collectionStore:n,initialState:{type:"propertyChangedFilter",property:i},updateCurrentAutomationState:r,buttonPopupParent:e})})}function Oi(e){window.__c={n:"AutomationTriggerPagedAdded"};const{disabled:t,updateCurrentState:o}=e,i=(0,l.useIntl)(),r=Ni(),a=le.Mz(i),s=(0,n.useCallback)((e=>{e.setState({open:!0})}),[]),c=(0,n.useCallback)((()=>o({trigger:{type:"page_added"},type:"remove_trigger"})),[o]),d=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:t,icon:F.R,onClick:s,onDelete:c,title:(0,ue.jsx)("div",{style:r.semiBoldTitle,children:a})})),[t,s,c,r.semiBoldTitle,a]);return(0,ue.jsx)(de.y,{renderOrigin:d,title:a,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left})}function Ri(e){window.__c={n:"AutomationTriggerAnyPropertyEdited"};const{disabled:t,updateCurrentState:o}=e,i=(0,l.useIntl)(),r=Ni(),a=le.c5(i),s=(0,n.useCallback)((e=>{e.setState({open:!0})}),[]),c=(0,n.useCallback)((()=>{o({type:"remove_trigger",trigger:{type:"any_page_property_edited"}})}),[o]),d=(0,n.useCallback)((e=>(0,ue.jsx)(ce.pW,{...e,disabled:t,onClick:s,icon:V.R,title:(0,ue.jsx)("div",{style:r.semiBoldTitle,children:a}),onDelete:c})),[t,s,c,r.semiBoldTitle,a]);return(0,ue.jsx)(de.y,{renderOrigin:d,title:a,tooltipAlignment:re.Z.Alignment.Center,tooltipPlacement:re.Z.Placement.Left})}function Ni(){return(0,S.yK)((e=>({stepList:{border:`1px solid ${e.stroke.regular}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},semiBoldTitle:{fontWeight:ie.Z.fontWeight.semibold},stepItemWithBorderTop:{borderTop:`1px solid ${e.stroke.regular}`}})),[])}var Ei=o(44257),Wi=o(85740),Li=o(28267),Gi=o(64737),Ui=o(73266),zi=o(73239),Hi=o(29180),$i=o(43690),qi=o(52105);function Xi(e){window.__c={n:"UpdatePagesActionDatabaseAutomation"};const{actionStore:t,updateCurrentAutomationState:o}=e,i=t.id,r=(0,a.VK)((()=>t.getConfig()),[t]),s=(0,n.useCallback)((e=>{var t;const n="collection"===e.type&&"collection"===(null==r||null===(t=r.target)||void 0===t?void 0:t.type)&&e.collection.id!==(null==r?void 0:r.target.collection.id);o({action:{config:{...r,target:e,properties:n?[]:(null==r?void 0:r.properties)??[],values:n?{}:(null==r?void 0:r.values)??{}},id:i,type:"update_pages"},type:"update_action"})}),[r,i,o]),l=(0,n.useCallback)(((e,t)=>{o({action:{config:{...r,properties:e,values:t},id:i,type:"update_pages"},type:"update_action"})}),[i,r,o]),c=(0,n.useCallback)((()=>{o({action:{config:r,id:i,type:"update_pages"},type:"remove_action"})}),[r,i,o]);return(0,ue.jsx)(Yi,{...e,onConfigChange:l,onDelete:c,onTargetChange:s})}function Yi(e){window.__c={n:"UpdatePagesActionV2"};const{actionStore:t,automationStore:o,collectionStore:i,disabled:r,onConfigChange:s,onDelete:l,onTargetChange:c}=e,d=(0,n.useRef)(null),u=(0,Li.X)(d),p=(0,Ui.a)(u),[g,m]=(0,n.useState)(!1),y=(0,x.z)("update_pages"),h=je({automationStore:o,collectionStore:i}),f=(0,a.VK)((()=>{const e=t.getVariableTargetStore();if(e)return e.getValue();const o=t.getCollectionTargetStore();if(o){const e=o.getKeyStore("collection").getValue();if(e)return{collection:e,type:"collection"}}}),[t]),[v,C,b]=(0,a.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.target,null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),w=(0,n.useMemo)((()=>({values:b??{},properties:C??[]})),[b,C]),j=(0,a.VK)((()=>"collection"===(null==f?void 0:f.type)),[f]),M=(0,a.VK)((()=>{const e=t.getTargetStore().getValue();if(e&&h){if("collection"===e.type)return Ge.NW.createChildStore(h.context.parentRecordStore,e.collection);if("variable"===e.type){const t=h.compilationResultStore.state;if(ao.x.isFail(t))return;const o=(0,Se.vx)(t.value.valueTypes,e.id);if(o)return(0,Ce.wB)(o,h.context.parentRecordStore)}else{if("page"===e.type)return;(0,ne.t1)(e)}}}),[t,h]),_=(0,a.VK)((()=>{if("collection"!==(null==v?void 0:v.type))return;const e=v.filter;return(0,ne.$K)(e)?(0,$i.Ih)(e,(null==M?void 0:M.getSchema())??{}):void 0}),[v,M]),k=(0,n.useCallback)((e=>{if(!(0,ne.$K)(v))return void c(e);const t=v.type!==e.type,o="variable"===v.type&&"variable"===e.type&&v.id!==e.id,n="collection"===v.type&&"collection"===e.type&&v.collection.id!==e.collection.id;(t||o||n)&&c(e)}),[v,c]),T=(0,n.useCallback)((e=>{(0,ne.$K)(v)&&"collection"===v.type&&(Te.Xy(v.filter,e)||c({...v,filter:e}))}),[v,c]),A=(0,n.useCallback)((e=>{const t=w.properties.concat([e]);s(t,w.values)}),[s,w]),P=(0,n.useCallback)(((e,t)=>{const o=w.properties.indexOf(e);if(-1===o)return;const n=w.properties.slice(0);n[o]=t;const i={...w.values,[t]:void 0};s(n,i)}),[s,w]),V=(0,n.useCallback)((e=>{const t=w.properties.filter((t=>t!==e)),o={...w.values,[e]:void 0};s(t,o)}),[s,w]),F=(0,n.useCallback)(((e,t)=>{const o={...w.values,[e]:t};s(w.properties,o)}),[s,w]),I=(0,n.useCallback)((()=>{m(!0)}),[]),B=(0,n.useCallback)((()=>{m(!1)}),[]),Z=(0,S.yK)((e=>({sectionWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:p?12:16,paddingBlock:12,paddingInline:12},headerTitle:{alignItems:"center",display:"flex",flexWrap:"wrap",minWidth:100,whiteSpace:"pre"}})),[p]);return h?(0,ue.jsxs)("section",{onMouseEnter:I,onMouseLeave:B,ref:d,style:Z.sectionWrap,children:[(0,ue.jsxs)(er,{disabled:r,icon:y.display.icon({height:21,width:14}),isHovered:g,onDelete:l,children:[(0,ue.jsx)("div",{style:Z.headerTitle,children:(0,ue.jsx)(Qi,{actionStore:t,automationContextStore:h,disabled:r,onChange:k,value:f})}),j&&(0,ne.$K)(M)&&(0,ue.jsx)("div",{style:Z.headerTitle,children:(0,ue.jsx)(Ji,{automationContextStore:h,collectionStore:M,disabled:r,filter:_,onChange:T})})]}),M&&(0,ue.jsx)(Jt.vV,{actionId:t.id,collectionStore:M,config:w,contextStore:h,disabled:r,onPropertyAdd:A,onPropertyChange:P,onPropertyRemove:V,onPropertyValueChange:F,showSetPropertyActions:!0})]}):null}function Qi(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,onChange:i,value:r}=e,a=(0,S.yK)((()=>({b:{fontWeight:ie.Z.fontWeight.medium},picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Wi.H)({})}})),[]);return(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"<span>Update <b>pages</b> in </span>{collectionPicker}",id:"automations.UpdatePagesActionV2.header.title",values:{b:e=>(0,ue.jsx)("b",{style:a.b,children:e}),collectionPicker:(0,ue.jsx)("div",{style:a.picker,children:(0,ue.jsx)(zi.a,{actionStore:t,contextStore:o,currentValue:r,disabled:n,onChange:i})}),span:e=>(0,ue.jsx)("span",{style:a.span,children:e})}})}function Ji(e){window.__c={n:"CollectionFilterTitle"};const{automationContextStore:t,collectionStore:o,disabled:n,filter:i,onChange:s}=e,c=(0,r.O7)(),d=(0,l.useIntl)(),u=(0,a.VK)((()=>(0,Le.vU)({environment:c,intl:d,store:o})),[o,d,c]),p=(0,S.yK)((()=>({picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Wi.H)({})}})),[]);return(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"<span>that match </span>{filterPicker}",id:"automations.UpdatePagesActionV2.header.filterTitle",values:{filterPicker:(0,ue.jsx)("div",{style:p.picker,children:(0,ue.jsx)(qi.W,{collectionStore:o,contextStore:t,disabled:n,filter:i,noFiltersMessage:(0,ne.$K)(u)?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"All pages in {collectionName}",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.label",values:{collectionName:u}}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"All pages in database",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.fallbackLabel"}),onChange:s})}),span:e=>(0,ue.jsx)("span",{style:p.span,children:e})}})}function er(e){window.__c={n:"ActionHeader"};const{children:t,disabled:o,icon:n,isHovered:i,onDelete:a}=e,{isMobile:s}=(0,r.Fy)(),[l,c]=(0,hn.Z)(),d=!o&&(s||i||c),u=(0,S.yK)((()=>({wrap:{alignItems:"start",cursor:o?"default":void 0,opacity:o?.4:void 0,display:"flex",gap:6,minHeight:28},iconWrap:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Wi.H)({})},titleWrap:{display:"flex",flex:"1 1 auto",flexWrap:"wrap",fontSize:14,lineHeight:1.4,minWidth:0},moreButtonWrap:{flex:"0 0 26px"}})),[o]);return(0,ue.jsxs)("header",{ref:l,style:u.wrap,children:[n&&(0,ue.jsx)("div",{style:u.iconWrap,children:n}),(0,ue.jsx)("div",{style:u.titleWrap,children:t}),(0,ue.jsx)("div",{style:u.moreButtonWrap,children:d&&(0,ue.jsx)(ce.mv,{disabled:o,onDelete:a})})]})}function tr(e){window.__c={n:"CreatePageActionDatabaseAutomation"};const{actionStore:t,updateCurrentAutomationState:o}=e,i=t.id,r=(0,a.VK)((()=>t.getConfig()),[t]),s=(0,n.useCallback)((e=>{o({action:{config:{...r,collection:e,properties:["title"],values:{},template_page_id:void 0},id:i,type:"create_page"},type:"update_action"})}),[i,r,o]),l=(0,n.useCallback)((e=>{if(!r)return;const{properties:t,values:n}=r;let a=!1;if(e&&t&&1===t.length&&t.includes("title")){var s;const e=null==n?void 0:n.title;e&&null!==(s=e.value)&&void 0!==s&&s.value||(a=!0)}o({action:{config:{...r,template_page_id:e,...a&&{properties:[]}},id:i,type:"create_page"},type:"update_action"})}),[i,r,o]),c=(0,n.useCallback)(((e,t)=>{o({action:{config:{...r,properties:e,values:t},id:i,type:"create_page"},type:"update_action"})}),[i,r,o]),d=(0,n.useCallback)((()=>{o({action:{config:r,id:i,type:"create_page"},type:"remove_action"})}),[r,i,o]);return(0,ue.jsx)(or,{...e,onConfigChange:c,onDelete:d,onTargetCollectionChange:s,onTemplateChange:l})}function or(e){window.__c={n:"CreatePageActionV2"};const{actionStore:t,automationStore:o,collectionStore:i,disabled:r,onConfigChange:s,onDelete:l,onTargetCollectionChange:c,onTemplateChange:d}=e,u=(0,n.useRef)(null),p=(0,Li.X)(u),g=(0,Ui.a)(p),m=(0,x.z)("create_page"),[y,h]=(0,n.useState)(!1),[f,v,C]=(0,a.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.collection,null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),b=(0,a.VK)((()=>{if(f)return Ge.NW.createChildStore(i,f)}),[i,f]),w=(0,a.VK)((()=>{const e=t.getCollectionStore();if(e)return{collection:e.getSpaceShardedPointer(),type:"collection"}}),[t]),j=(0,a.VK)((()=>(0,Gi.q)(b).length>0),[b]),M=(0,a.VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.template_page_id}),[t]),_=je({automationStore:o,collectionStore:i}),k=(0,n.useMemo)((()=>({values:C??{},properties:v??[]})),[C,v]),T=(0,n.useCallback)((e=>{c&&"collection"===e.type&&c(e.collection)}),[c]),A=(0,n.useCallback)((e=>{const t=k.properties.concat([e]);s(t,k.values)}),[s,k]),P=(0,n.useCallback)(((e,t)=>{const o=k.properties.indexOf(e);if(-1===o)return;const n=k.properties.slice(0);n[o]=t;const i={...k.values,[t]:void 0};s(n,i)}),[s,k]),V=(0,n.useCallback)((e=>{const t=k.properties.filter((t=>t!==e)),o={...k.values,[e]:void 0};s(t,o)}),[s,k]),F=(0,n.useCallback)(((e,t)=>{const o={...k.values,[e]:t};s(k.properties,o)}),[s,k]),I=(0,n.useCallback)((()=>{h(!0)}),[]),B=(0,n.useCallback)((()=>{h(!1)}),[]),Z=(0,S.yK)((e=>({sectionWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:g?12:16,paddingBlock:12,paddingInline:12},headerTitle:{alignItems:"center",display:"flex",flexWrap:"wrap",minWidth:100,whiteSpace:"pre"}})),[g]);return _?(0,ue.jsxs)("section",{onMouseEnter:I,onMouseLeave:B,ref:u,style:Z.sectionWrap,children:[(0,ue.jsxs)(er,{disabled:r,icon:m.display.icon({height:21,width:14}),isHovered:y,onDelete:l,children:[(0,ue.jsx)("div",{style:Z.headerTitle,children:(0,ue.jsx)(nr,{actionStore:t,automationContextStore:_,disabled:r,onChange:T,value:w})}),(0,ne.$K)(b)&&j&&(0,ue.jsx)("div",{style:Z.headerTitle,children:(0,ue.jsx)(ir,{collectionStore:b,disabled:r,onChange:d,value:M})})]}),b&&(0,ue.jsx)(Jt.vV,{actionId:t.id,collectionStore:b,config:k,contextStore:_,disabled:r,onPropertyAdd:A,onPropertyChange:P,onPropertyRemove:V,onPropertyValueChange:F,showSetPropertyActions:!1})]}):null}function nr(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,onChange:i,value:r}=e,a=(0,S.yK)((()=>({b:{fontWeight:ie.Z.fontWeight.medium},picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Wi.H)({})}})),[]);return(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"<span>Add <b>page</b> to </span>{collectionPicker}",id:"automations.CreatePageActionV2.header.title",values:{b:e=>(0,ue.jsx)("b",{style:a.b,children:e}),collectionPicker:(0,ue.jsx)("div",{style:a.picker,children:(0,ue.jsx)(zi.a,{actionStore:t,contextStore:o,currentValue:r,disabled:n,onChange:i})}),span:e=>(0,ue.jsx)("span",{style:a.span,children:e})}})}function ir(e){window.__c={n:"CollectionTemplateTitle"};const{collectionStore:t,disabled:o,onChange:n,value:i}=e,r=(0,S.yK)((()=>({picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,Wi.H)({})}})),[]);return(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"<span>as </span>{collectionTemplatePicker}",id:"automations.CreatePageActionV2.header.template",values:{collectionTemplatePicker:(0,ue.jsx)(Hi.f,{collectionStore:t,currentTemplateId:i,disabled:o,onChange:n}),span:e=>(0,ue.jsx)("span",{style:r.span,children:e})}})}function rr(e){const{automationStore:t,collectionStore:o,disabled:n,formulaValueContext:i,onClick:r,onEdit:a,propertySchema:s,setPropertyValue:l,onDelete:c}=e;return"person"===s.type?(0,ue.jsx)(Oe,{collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"status"===s.type?(0,ue.jsx)(Xe,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"select"===s.type?(0,ue.jsx)(Fe,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"multi_select"===s.type?(0,ue.jsx)(Ke,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"date"===s.type?(0,ue.jsx)(Me,{automationStore:t,collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value,valueContext:i}):"relation"===s.type?(0,ue.jsx)(Ue,{automationStore:t,collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"checkbox"===s.type?(0,ue.jsx)(pe,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"title"===s.type?(0,ue.jsx)(nt,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"text"===s.type?(0,ue.jsx)(it,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"email"===s.type?(0,ue.jsx)(rt,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"url"===s.type?(0,ue.jsx)(at,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"number"===s.type?(0,ue.jsx)(st,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"phone_number"===s.type?(0,ue.jsx)(lt,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):null}function ar(e){window.__c={n:"CollectionSettingsAutomationActionList"};const{automationStore:t,collectionStore:o,updateCurrentAutomationState:n,handleNavigateToDeletedProperties:i,handleNavigateToEditProperty:r,currentUserIsOwner:s,disabled:l}=e,c=(0,a.VK)((()=>t.getActionStores().map((e=>e.isType("update_pages")?(0,ue.jsx)(sr,{actionStore:e,automationStore:t,collectionStore:o,disabled:l,handleNavigateToDeletedProperties:i,handleNavigateToEditProperty:r,updateCurrentAutomationState:n},e.id):e.isType("slack_notification")?(0,ue.jsx)(Ro,{actionStore:e,automationStore:t,collectionStore:o,updateCurrentAutomationState:n,currentUserIsOwner:s,disabled:l},e.id):e.isType("create_page")?(0,ue.jsx)(tr,{actionStore:e,automationStore:t,collectionStore:o,disabled:l,updateCurrentAutomationState:n},e.id):void 0)).filter(ne.$K)),[t,o,s,l,i,r,n]),d=(0,S.yK)((e=>({stepList:{border:`1px solid ${e.regularDividerColor}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},stepItemWithBorderTop:{borderTop:`1px solid ${e.regularDividerColor}`}})),[]);return(0,ue.jsx)("ul",{style:d.stepList,children:c.map(((e,t)=>{const o=0===t?void 0:d.stepItemWithBorderTop;return(0,ue.jsx)("li",{style:o,children:e},t)}))})}function sr(e){var t;window.__c={n:"InternalUpdatePageAction"};const{actionStore:o,automationStore:i,collectionStore:r,disabled:s,handleNavigateToDeletedProperties:l,handleNavigateToEditProperty:c,updateCurrentAutomationState:d}=e,u=(0,mt.d)(),p=(0,a.VK)((()=>o.getConfig()),[o]),g=(0,a.VK)((()=>r.getSchema()),[r]),m=(0,n.useCallback)((()=>{d({action:{config:p,id:o.id,type:"update_pages"},type:"remove_action"})}),[p,o.id,d]),S="variable"===(null==p||null===(t=p.target)||void 0===t?void 0:t.type)?(0,Se.MY)(p.target.id):void 0;if(S&&"global"===S.source&&"button_page"===S.global){var y;const e=((null==p?void 0:p.properties)??[])[0],t=g[e],a=null==p||null===(y=p.values)||void 0===y?void 0:y[e];if(t&&a){const l={type:"collection",collectionStore:r,property:e};return(0,f.SF)(t)?(0,ue.jsx)(ut.ZP,{alignmentToOrigin:ut.vR.End,placementToOrigin:ut.pO.Bottom,popupType:u,render:t=>(0,ue.jsx)(Do,{automationStore:i,buttonPopupParent:t,collectionStore:r,initialState:{propertyId:e,actionId:o.id,type:"eventActionProperty"},updateCurrentAutomationState:d}),renderOrigin:e=>(0,ue.jsx)(rr,{...e,automationStore:i,collectionStore:r,disabled:s,formulaValueContext:l,onDelete:m,onEdit:e.onClick,propertySchema:t,setPropertyValue:a})}):(0,ue.jsx)(ut.ZP,{alignmentToOrigin:ut.vR.Center,placementToOrigin:ut.pO.Bottom,popupType:u,render:()=>(0,ue.jsx)(ki,{onDelete:m,onViewEditProperty:c,propertyId:e,propertySchema:t,stepType:"action"}),renderOrigin:o=>(0,n.createElement)($o,{...o,key:`unsupported_${e}_action`,disabled:s,onClick:()=>o.onClick(),propertySchema:t})},`unsupported_property_${e}_action`)}return t?null:(0,ue.jsx)(ut.ZP,{alignmentToOrigin:ut.vR.Center,placementToOrigin:ut.pO.Bottom,popupType:u,render:e=>(0,ue.jsx)(gi,{stepType:"action",onDelete:m,onViewDeletedProperties:l}),renderOrigin:t=>(0,ue.jsx)(ui,{...t,disabled:s,propertyId:e,collectionStore:r})})}return(0,ue.jsx)(Xi,{actionStore:o,automationStore:i,collectionStore:r,disabled:s,updateCurrentAutomationState:d})}var lr=o(9015);var cr=o(3386),dr=o(68641),ur=o(5971),pr=o(84398);var gr=o(18844);function mr(e){var t,o;const{automationStorePointer:n,defaultRecordCache:i,inMemoryRecordCache:r,userId:a}=e;if(!n||!a)return!1;const s=i.getRecordModel({pointer:n,userId:a}),l=r.getRecordModel({pointer:n,userId:a});if(!l)return!0;return!((null==s||null===(t=s.getProperties())||void 0===t?void 0:t.name)===(null===(o=l.getProperties())||void 0===o?void 0:o.name))||(!!function(e,t){if((0,ne.$K)(e)){if(e.isEventType()&&t.isEventType()||e.isNotificationType()&&t.isNotificationType()){const o=e.getEventConfiguration(),n=t.getEventConfiguration();return!(0,Te.Xy)(o,n)}if(e.isRecurrenceType()&&t.isRecurrenceType()){const o=e.getRecurrence(),n=t.getRecurrence();return!(0,Te.Xy)(o,n)}return!e.isButtonType()||!t.isButtonType()}if(t.isEventType()||t.isNotificationType()){const e=t.getEventConfiguration();return!1!==e.pagesAdded||"none"!==e.pagePropertiesEdited.type}if(t.isRecurrenceType())return!0;if(t.isButtonType())return!1;(0,ne.t1)(t)}(s,l)||!!function(e,t,o){const{defaultRecordCache:n,inMemoryRecordCache:i,userId:r}=o;if((0,ne.$K)(e)){const o=e.getActionIds(),a=t.getActionIds();return o.length!==a.length||!(0,Te.Xy)(o,a)||a.some((e=>{const o={id:e,spaceId:t.spaceId,table:gr.Xj},a=n.getRecordModel({pointer:o,userId:r}),s=i.getRecordModel({pointer:o,userId:r});return!(0,ne.$K)(a)||!(0,Te.Xy)(a.getConfig(),null==s?void 0:s.getConfig())}))}return t.getActionIds().length>0}(s,l,{defaultRecordCache:i,inMemoryRecordCache:r,userId:a}))}var Sr=o(13273);var yr=o(16184),hr=o(42402);const fr=(0,l.defineMessages)({automationIncompatibleViewFilterAndOwner:{defaultMessage:"This automation may not work because the view has a non-supported filter",id:"AutomationHeaderView.incompatibleCollectionViewFilter.owner"},automationPublicAccess:{defaultMessage:"This automation is part of a public page",id:"AutomationHeaderView.automationPublicAccess"},automationUpgrade:{defaultMessage:"<anchor-upsell>Upgrade</anchor-upsell> to edit this automation or create your own",id:"AutomationHeaderView.automationUpgrade"},automationEditOnSite:{defaultMessage:"This automation can only be edited on notion.com",id:"AutomationHeaderView.automationEditOnSite"},automationSlackNoPermissions:{defaultMessage:"Ask {user} to edit this automation",id:"AutomationHeaderView.automationSlackNoPermissions"},automationSlackWithPermissions:{defaultMessage:"Ask {user} to edit this automation or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationSlackWithPermissions"},automationMissingPermissionsNoPermissions:{defaultMessage:"You must have full access to target databases in this automation to edit it",id:"AutomationHeaderView.automationMissingPermissionsNoPermissions"},automationMissingPermissionsWithPermissions:{defaultMessage:"You must have full access to target databases in this automation to edit it or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationMissingPermissionsWithPermissions"},automationGenericFullAccess:{defaultMessage:"You must have full access to this database to edit automations",id:"AutomationHeaderView.automationGenericFullAccess"}});function xr(e){window.__c={n:"AutomationHeaderView"};const{automationStore:t,automationPermissionScope:o,collectionStore:i,onDelete:s,referencesIncompatibleCollectionViewFilter:c}=e,d=(0,r.O7)(),u=je({automationStore:t,collectionStore:i}),p=(0,a.VK)((()=>Boolean((0,pt.IJ)(d,t))),[t,d]),g=(0,a.VK)((()=>(0,Wt.$5)(null==u?void 0:u.context)),[u]),m=(0,a.VK)((()=>(0,Ce.R4)(t)),[t]),S=(0,n.useCallback)((()=>{Gt.y(d,{from:"database_automation_settings_header_message",for:"plus"})}),[d]),y=br();if(p)return(0,ue.jsx)(vr,{icon:(0,ue.jsx)("div",{style:y.lockedIconWrap,children:(0,yr.Q)(y.lockedIcon)}),children:(0,ue.jsx)("p",{style:y.paragraph,children:(0,ue.jsx)(l.FormattedMessage,{...fr.automationPublicAccess})})});if("sufficient"!==g.editPermissionStatus&&"free_workspace"===g.reason)return(0,Wt.Rr)({environment:d})?(0,ue.jsx)(Cr,{icon:(0,ue.jsx)("div",{style:y.boltIconWrap,children:(0,T.K)(y.boltIcon)}),children:(0,ue.jsx)("p",{style:y.paragraph,children:(0,ue.jsx)(l.FormattedMessage,{...fr.automationUpgrade,values:{"anchor-upsell":e=>(0,ue.jsx)(hr.Z,{onClick:S,style:y.link,children:e})}})})}):(0,ue.jsx)(vr,{icon:(0,ue.jsx)("div",{style:y.lockedIconWrap,children:(0,yr.Q)(y.lockedIcon)}),children:(0,ue.jsx)("p",{style:y.paragraph,children:(0,ue.jsx)(l.FormattedMessage,{...fr.automationEditOnSite})})});if("sufficient"!==g.editPermissionStatus&&"missing_permissions"===g.reason&&g.actionId){const e=m[g.actionId];return(0,ue.jsx)(vr,{icon:(0,ue.jsx)("div",{style:y.lockedIconWrap,children:(0,yr.Q)(y.lockedIcon)}),children:(0,ue.jsx)("p",{style:y.paragraph,children:(0,ue.jsx)(l.FormattedMessage,{..."readonly"===o?fr.automationSlackNoPermissions:fr.automationSlackWithPermissions,values:{"anchor-delete":e=>(0,ue.jsx)(hr.Z,{onClick:s,style:y.link,children:e}),user:e}})})})}return"insufficient"===g.editPermissionStatus||"unknown"===g.editPermissionStatus?(0,ue.jsx)(vr,{icon:(0,ue.jsx)("div",{style:y.lockedIconWrap,children:(0,yr.Q)(y.lockedIcon)}),children:(0,ue.jsx)("p",{style:y.paragraph,children:(0,ue.jsx)(l.FormattedMessage,{...fr.automationGenericFullAccess})})}):c?(0,ue.jsx)(vr,{icon:(0,ue.jsx)("div",{style:y.lockedIconWrap,children:(0,dt.t)(y.warningIcon)}),children:(0,ue.jsx)(l.FormattedMessage,{...fr.automationIncompatibleViewFilterAndOwner})}):null}function vr(e){window.__c={n:"AutomationMessage"};const{children:t,icon:o}=e,n=br();return(0,ue.jsx)("div",{style:n.wrapWrap,children:(0,ue.jsxs)("div",{style:n.wrap,children:[o&&(0,ue.jsx)("div",{style:n.iconWrap,children:o}),(0,ue.jsx)("div",{style:n.messageWrap,children:t})]})})}function Cr(e){window.__c={n:"AutomationUpsellMessage"};const{children:t,icon:o}=e,n=br();return(0,ue.jsx)("div",{style:n.wrapWrap,children:(0,ue.jsxs)("div",{style:n.upsellWrap,children:[o&&(0,ue.jsx)("div",{style:n.iconWrap,children:o}),(0,ue.jsx)("div",{style:n.messageWrap,children:t})]})})}function br(){const{isMobile:e}=(0,r.Fy)();return(0,S.yK)((t=>({boltIcon:{fill:t.icon.yellow,height:"100%",width:"100%"},boltIconWrap:{height:20,padding:2,width:20},icon:{},iconWrap:{flexGrow:0,flexShrink:0},lockedIcon:{fill:t.icon.secondary,height:"100%",width:"100%"},lockedIconWrap:{background:t.fill.lightGray,borderRadius:4,height:20,padding:2,width:20},link:{color:t.text.uiBluePrimary},messageWrap:{flexGrow:1},paragraph:{color:t.text.secondary,fontSize:e?14:12,margin:0},warningIcon:{color:t.accentColors.orange[400],height:"100%",width:"100%"},warningIconWrap:{height:20,padding:2,width:20},wrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:10},wrapWrap:{padding:e?12:"0 12px 12px 12px"},upsellWrap:{alignItems:"center",background:t.accentColors.yellow[50],border:`1px solid ${t.accentColors.yellow[100]}`,borderRadius:6,display:"flex",flexDirection:"row",gap:10,padding:8},personBadgeQuestionMark:{fill:t.mediumIconColor,width:16,height:"auto"},personBadgeQuestionMarkWrap:{height:20,padding:2,width:20}})),[e])}var wr=o(24006);const jr=(0,l.defineMessages)({automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationPausedLabel:{defaultMessage:"Paused",id:"collectionSettings.editAutomationView.automationPausedLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"}});function Mr(e){window.__c={n:"AutomationSectionStatus"};const{automationId:t,automationOwner:o,disabled:i,isAutomationPaused:r,onPause:a,onResume:s}=e,c=`toggle-${t}`,d=(0,n.useCallback)((()=>{r?null==s||s():null==a||a()}),[r,s,a]),u=(0,S.yK)((e=>({labelWrap:{color:i?e.text.tertiary:r?e.text.secondary:e.text.primary,flex:"1 1 auto",fontSize:14},sectionWrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:6,marginBlockEnd:12},toggleWrap:{flex:"0 0 auto",paddingBlockStart:2}})),[i,r]),p=r?jr.automationPausedLabel:jr.automationEnabledLabel,g=r?jr.automationPausedHiddenAriaLabel:jr.automationEnabledHiddenAriaLabel;return(0,ue.jsxs)("section",{style:u.sectionWrap,children:[(0,ue.jsx)("div",{style:u.toggleWrap,children:(0,ue.jsx)(re.Z,{disableTooltip:!i||!r,renderTooltip:()=>(0,ue.jsx)(l.FormattedMessage,{...jr.automationDisabledTooltip,values:{user:o}}),render:e=>(0,ue.jsx)("div",{...e,children:(0,ue.jsx)(wr.Z,{disabled:i,inputId:c,on:!r,onClick:d})})})}),(0,ue.jsx)("div",{style:u.labelWrap,children:(0,ue.jsxs)("label",{htmlFor:c,children:[(0,ue.jsx)("span",{"aria-hidden":!0,children:(0,ue.jsx)(l.FormattedMessage,{...p})}),(0,ue.jsx)("span",{style:Pn.jy,children:(0,ue.jsx)(l.FormattedMessage,{...g})})]})})]})}const _r=(0,l.defineMessages)({createAutomationViewMenuTitle:{id:"collectionSettings.createStatusAutomationView.menuTitle",defaultMessage:"New automation"},editAutomationViewMenuTitle:{id:"collectionSettings.editStatusAutomationView.menuTitle",defaultMessage:"Edit automation"},addTriggerAriaLabel:{id:"collectionSettings.editAutomationView.addTrigger.iconButton",defaultMessage:"Add trigger"},addActionAriaLabel:{id:"collectionSettings.editAutomationView.addAction.iconButton",defaultMessage:"Add action"},deleteButton:{id:"collectionSettings.editAutomationView.deleteButton",defaultMessage:"Delete"},automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationPausedLabel:{defaultMessage:"Paused",id:"collectionSettings.editAutomationView.automationPausedLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"}}),kr=()=>{};function Tr(e){window.__c={n:"CollectionSettingsEditAutomationView"};const{collectionSettingsStore:t,collectionContextStore:o,...i}=e,c=(0,n.useMemo)((()=>i),[]),{mode:u}=c,g=(0,l.useIntl)(),m=(0,on.D)(),y=(0,r.O7)(),{isMobile:x}=(0,r.Fy)(),v=(0,mt.d)(),C=(0,ur.E)("automation_ui_unify"),b="create"===u,w=(0,pr.$)("CollectionSettingsEditAutomationView",{cacheFallback:y.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),j=(0,a.VK)((()=>po.default.state.currentUserStore),[]),M=(0,a.VK)((()=>null==j?void 0:j.userId),[j]),_=(0,a.VK)((()=>null==j?void 0:j.getDisplayName(g)),[j,g]),k=(0,a.VK)((()=>(0,Ut.sX)()),[]),T=(0,a.VK)((()=>o.collectionStore()),[o]),A=(0,a.VK)((()=>null==T?void 0:T.getSpaceId()),[T]),P=(0,a.VK)((()=>null==T?void 0:T.id),[T]),V=(0,a.VK)((()=>null==T?void 0:T.getSchema()),[T]),I=(0,a.VK)((()=>(0,dr.jI)({timelineViewTab:"timeline",collectionContextStore:o})),[o]),B=(0,n.useMemo)((()=>"update"===c.mode?c.automationId:(0,s.ZP)()),[c]),Z=(0,a.VK)((()=>o.aliveAutomationCount.state),[o]),K=(0,a.VK)((()=>{if(A&&T&&M)return new Ge.Mz(y,{id:B,table:rn.cv,spaceId:A})}),[B,T,M,y,A]),D=(0,a.VK)((()=>(null==K?void 0:K.getStatus())??"disabled"),[K]),O="active"===D,R=(0,a.VK)((()=>(0,f.XO)(g,_)),[_,g]),N=(0,a.VK)((()=>{if(!A||!T||!M)return;const e={id:B,table:rn.cv,spaceId:A},t=w.getEntry({pointer:e,userId:M});return t?t.value.value:Ce.sA({automationId:B,automationName:R,collectionStore:T,userId:M})}),[R,B,T,M,A,w]),E=(0,a.VK)((()=>{if(!A||!T)return;const e={id:B,table:rn.cv,spaceId:A},t=w.getEntry({pointer:e,userId:M});b&&!(0,ne.$K)(t)&&M&&w.setRecord({pointer:e,userId:M},{role:"editor",value:N});const o=new Ge.Mz(y,e,{inMemoryRecordCache:w});return Ce.Xd(o)?o:void 0}),[N,B,T,M,y,b,A,w]),W=(0,a.VK)((()=>null==E?void 0:E.getModel()),[E]),L=(0,n.useMemo)((()=>{if(!W)throw new Error("Error initializing dispatchOperations: could not get automationModel");return(0,lr.l)(w,M,[W])}),[W,w,M]),G=(0,a.VK)((()=>(null==E?void 0:E.getName())??""),[E]),U=(0,a.VK)((()=>{var e;return(null==E||null===(e=E.getOwnerStore())||void 0===e?void 0:e.getDisplayName(g))??""}),[g,E]),z=(0,a.VK)((()=>{if(E&&(0,Ce.Xd)(E)){const e=E.getTriggerStore().getKeyStore("event").getKeyStore("source").getValue();if(e&&"filter"!==e.type)return e.pointer}}),[E]),H=(0,a.VK)((()=>((null==E?void 0:E.getActionStores())??[]).filter((e=>e.isDefined()))),[E]),$=function(e){const{actionStores:t,automationStore:o,loadingStatus:n,mode:i}=e;return(0,a.VK)((()=>"create"===i?"edit":"resolved"===n&&o&&t?(0,Ce.i1)({automationStore:o,actionStores:t})?"edit":(0,Ce.qM)({automationStore:o})?"readonly_with_delete":"readonly":"readonly"),[i,n,o,t])}({automationStore:E,actionStores:H,loadingStatus:"resolved",mode:c.mode}),q="readonly_with_delete"===$||"edit"===$&&!b,X="edit"===$,Y=(0,a.VK)((()=>{if(!E||!j)return!1;const e=j.pointer,t=E.getCreatedByPointer();return!(!e||!t)&&oe.dr.isEqual(e,t)}),[E,j]),Q=je({automationStore:E,collectionStore:T}),J=je({automationStore:K,collectionStore:T}),ee=function(e){const{contextStore:t}=e,[o,i]=(0,n.useState)([]),r=(0,a.VK)((()=>t?(0,Wt.uV)(t.context.automationStore,t.context.type):void 0),[t]);return(0,a.VK)((()=>{r?(0,Ce.P$)({automationAvailabilityContext:r}).then((e=>i(function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.display.hasSideEffects)-t(e.display.hasSideEffects)))}(e))),(()=>i([]))):o.length>0&&i([])}),[o.length,r]),o}({contextStore:Q}),te=(0,a.VK)((()=>!!(0,ne.$K)(E)&&function(e){if(!(0,Ce.Xd)(e))return!1;const t=e.getTriggerStore().getKeyStore("event").getValue();return(null==t?void 0:t.pagesAdded)||"none"!==(null==t?void 0:t.pagePropertiesEdited.type)}(E)),[E]),re=(0,a.VK)((()=>!!(0,ne.$K)(E)&&function(e){return e.getActionIds().length>0}(E)),[E]),ae=0===ee.length,se=(0,a.VK)((()=>!(!E||!T)&&Ce.vM({automationStore:E,collectionStore:T})),[E,T]),le=(0,a.VK)((()=>!!(T&&E&&Q)&&Ce.qk({automationContextStore:Q,automationStore:E,collectionStore:T})),[Q,E,T]),ce=(0,a.VK)((()=>!!(T&&K&&J)&&Ce.qk({automationContextStore:J,automationStore:K,collectionStore:T})),[T,J,K]),de=mr({automationStorePointer:null==E?void 0:E.pointer,defaultRecordCache:y.defaultRecordCache.inMemoryRecordCache,inMemoryRecordCache:w,userId:M}),pe=(0,n.useMemo)((()=>({type:"eventTriggers"})),[]),ge=(0,n.useMemo)((()=>({type:"eventActions",availableActions:ee})),[ee]);!function(e){const{automationStore:t,collectionStoreId:o,eventTracker:i}=e,[r,s]=(0,n.useState)(!1),l=(0,a.VK)((()=>(null==t?void 0:t.getActionIds().length)??0),[t]),c=(0,a.VK)((()=>{if(!t||!(0,Ce.Xd)(t))return 0;const e=t.getTriggerStore().getKeyStore("event");let o=0;e.getKeyStore("pagesAdded").getValue()&&o++;const n=e.getKeyStore("pagePropertiesEdited").getValue();return"any"===(null==n?void 0:n.type)?o++:"some"===(null==n?void 0:n.type)&&(o+=n.some.length),o}),[t]);(0,n.useEffect)((()=>{i&&o&&!r&&t&&((0,h.nC)(i,{automation_id:t.id,automation_total_actions:l,automation_total_triggers:c,collection_id:o}),nn.default.logEvent("automation_configure_view","true"),s(!0))}),[i,o,r,l,c,null==t?void 0:t.id,t])}({automationStore:E,collectionStoreId:P,eventTracker:m});const me=(0,a.VK)((()=>!(!X||!re)&&(!k||!ae)),[X,re,ae,k]),Se=Ce.EE({automationStore:E,currentUserId:M,inMemoryRecordCache:w}),ye=(0,n.useCallback)((()=>{T&&E&&de&&("create"===u?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i,intl:r}=e;(function(e){const{automationStore:t,collectionStore:o,environment:n,intl:i}=e,r=(0,cn.mc)(n);p.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.createDatabaseAutomation",perform:e=>{p.applyOperation({store:o,operation:{pointer:o.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:t.id}},transaction:e});const r=Ge.Mz.createChildStore(o,t.pointer),a=t.getActionStores();for(const t of a){const o=t.getType();o&&ln.zY({actionId:t.id,actionType:o,automationStore:r,config:t.getConfig(),environment:n,intl:i,transaction:e})}const l=mn(a);sn.ae({environment:n,inMemoryRecordCache:o.inMemoryRecordCache,table:rn.cv,transaction:e,value:{action_ids:t.getActionIds(),alive:!0,id:t.id,parent_id:o.id,parent_table:o.table,properties:{name:t.getName()},space_id:o.getSpaceId(),status:"active",trigger:{id:(0,s.ZP)(),event:t.getEventConfiguration()??{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:o.getSpaceShardedPointer(),type:"collection"}},type:l}}})}});const a=Sn({automationStore:t,collectionStore:o});h.T0(r,a)})({automationStore:t,collectionStore:n,environment:i,intl:r}),Jn.oV({label:(0,ue.jsx)(l.FormattedMessage,{id:"automations.editAutomationView.createdConfirmation",defaultMessage:"{automationName} created",values:{automationName:t.getName()}})}),d.z$({collectionSettingsStore:o})}({automationStore:E,collectionSettingsStore:t,collectionStore:T,environment:y,intl:g}):"update"===u?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i}=e;(function(e){const{automationStore:t,collectionStore:o,environment:n}=e;p.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.saveDatabaseAutomation",perform:e=>{const n=Ge.Mz.createChildStore(o,t.pointer),i=t.getName(),r=n.getKeyStore("properties");sn.sW({store:r,data:{name:i},transaction:e});const a=t.getActionStores(),s=mn(a),l=n.getTriggerStore();if(sn.sW({store:l,data:{type:s},transaction:e}),(0,Ce.Xd)(n)&&(0,Ce.Xd)(t)){const o=n.getTriggerStore().getKeyStore("event");sn.sW({store:o,data:t.getTriggerStore().getKeyStore("event").getValue(),transaction:e})}const c=[];for(const t of a){const o=t.getModel();if(!o)continue;const i=Ge.zq.createChildStore(n,t.pointer);sn.sO({store:i,value:{alive:!0,config:o.getConfig(),id:o.id,parent_id:n.id,parent_table:n.table,space_id:n.getSpaceId(),type:o.type},transaction:e}),c.push(t.id)}sn.sW({store:n,data:{action_ids:c},transaction:e})}});const i=(0,cn.mc)(n),r=Sn({automationStore:t,collectionStore:o});h.r4(i,r)})({automationStore:t,collectionStore:n,environment:i}),Jn.oV({label:(0,ue.jsx)(l.FormattedMessage,{id:"automations.editAutomationView.updatedConfirmation",defaultMessage:"{automationName} updated",values:{automationName:t.getName()}})}),d.z$({collectionSettingsStore:o})}({automationStore:E,collectionSettingsStore:t,collectionStore:T,environment:y}):(0,ne.t1)(u))}),[E,t,T,y,de,g,u]),he=(0,n.useCallback)((()=>{E&&T&&pn({automationStore:E,collectionStore:T,environment:y})}),[T,y,E]),fe=(0,n.useCallback)((()=>{E&&T&&gn({automationStore:E,collectionStore:T,environment:y})}),[T,y,E]),xe=(0,n.useCallback)((async()=>{E&&T&&!b&&await un({intl:g,environment:y,existingAutomationStore:E,collectionStore:T,triggerType:"event",onDelete:()=>{1===Z?d.wl({collectionSettingsStore:t,item:{type:"main"}}):d.z$({collectionSettingsStore:t})}})}),[Z,E,t,T,y,g,b]),ve=(0,n.useCallback)((async()=>{await Ar({automationName:G,hasPendingChanges:de})&&(0===Z?d.wl({collectionSettingsStore:t,item:{type:"main"}}):d.z$({collectionSettingsStore:t}))}),[Z,G,t,de]),be=(0,n.useCallback)((async()=>{await Ar({automationName:G,hasPendingChanges:de})&&d.E3({collectionSettingsStore:t})}),[G,t,de]);!function(e){const{hasPendingChanges:t,onClick:o}=e;(0,n.useEffect)((()=>{async function e(e){const n=e.target;if(t&&e.eventPhase===Event.CAPTURING_PHASE&&n instanceof Element){if((0,Sr.jM)(n)||(0,Sr.yT)(n))return;e.stopPropagation(),e.preventDefault(),await o()}}return window.addEventListener("click",e,{capture:!0}),()=>{window.removeEventListener("click",e,{capture:!0})}}),[t,o])}({hasPendingChanges:de,onClick:be});const we=(0,n.useCallback)((async()=>{await Ar({automationName:G,hasPendingChanges:de})&&(d.wl({collectionSettingsStore:t,item:{type:"main"}}),d.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"timeline"}}),d.H4({collectionSettingsStore:t,item:{type:"deletedProperties",timelineViewTab:"timeline"}}))}),[G,t,de]),Me=(0,n.useCallback)((async e=>{await Ar({automationName:G,hasPendingChanges:de})&&(d.wl({collectionSettingsStore:t,item:{type:"main"}}),d.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"timeline"}}),d.H4({collectionSettingsStore:t,item:{type:"property",formatKey:I,property:e}}))}),[G,t,I,de]),_e=(0,a.VK)((()=>e=>{if(Se(e),P&&V&&E)if("update_trigger"===e.type||"remove_trigger"===e.type){const t=function(e){const{action:t,automationId:o,collectionStoreId:n,schema:i}=e;let r;if("page_added"===t.trigger.type)r={type:"page"};else if("any_page_property_edited"===t.trigger.type)r={condition:"any",type:"property"};else if("property_changed"===t.trigger.type){const e=i[t.trigger.property];if(!e)return;r={condition:"some",property_types:[e.type],type:"property"}}else(0,ne.t1)(t.trigger);return{automation_id:o,automation_trigger:r,collection_id:n}}({action:e,automationId:B,collectionStoreId:P,schema:V});if(!t)return;"remove_trigger"===e.type?(0,h.Ey)(m,t):"update_trigger"===e.type&&function(e,t){if(!(0,Ce.Xd)(t))return!0;const o=t.getTriggerStore().getKeyStore("event");if("page_added"===e.type&&!0===o.getKeyStore("pagesAdded").getValue())return!1;if("any_page_property_edited"===e.type&&"any"===o.getKeyStore("pagePropertiesEdited").getKeyStore("type").getValue())return!1;if("property_changed"===e.type){const t=o.getKeyStore("pagePropertiesEdited").getValue();if("some"===(null==t?void 0:t.type)&&t.some.some((t=>t.property===e.property)))return!0}return!0}(e.trigger,E)&&(0,h.nK)(m,t)}else if("update_action"===e.type||"remove_action"===e.type){const t=function(e){const{action:t,automationId:o,collectionStoreId:n,schema:i}=e;let r;if("slack_notification"===t.action.type)r={type:"slack_notification"};else{if("update_pages"!==t.action.type)return;var a;r={property_types:((null===(a=t.action.config)||void 0===a?void 0:a.properties)??[]).map((e=>{var t;return null===(t=i[e])||void 0===t?void 0:t.type})).filter(ne.$K),type:"update_pages"}}return{automation_action:r,automation_action_id:t.action.id,automation_id:o,collection_id:n}}({action:e,automationId:B,collectionStoreId:P,schema:V});if(!t)return;"remove_action"===e.type?(0,h.OK)(m,t):"update_action"===e.type&&function(e,t){return!t.getActionIds().includes(e.id)}(e.action,E)&&(0,h.A2)(m,t)}}),[B,E,V,P,m,Se]),ke=(0,n.useCallback)((e=>{const t=e.target.value;_e({type:"update_name",name:t})}),[_e]),Te=(0,n.useCallback)((e=>{_e({type:"update_source",pointer:e})}),[_e]),Ae=function(e){const t=4,{showDeleteEnableDisableOptions:o}=e,{isMobile:n}=(0,r.Fy)();return(0,S.yK)((e=>({automationSection:{display:"flex",flexDirection:"column",gap:t},automationSectionAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0},automationSectionHeader:{alignItems:"center",display:"flex",flexDirection:"row"},automationSectionHeaderAction:{background:`linear-gradient(to right, ${e.stroke.regular} 50%, transparent 50%), linear-gradient(to right, ${e.stroke.regular} 50%, transparent 50%)`,backgroundPosition:"20px 0px, 20px bottom",backgroundRepeat:"no-repeat",backgroundSize:`2px 36px, 2px ${t+2}px`,marginBlockEnd:-t,paddingBlock:`36px ${t}px`,position:"relative"},automationSectionTitle:{color:e.lightTextColor,fontSize:n?14:12,lineHeight:1.3,position:"relative",fontWeight:ie.Z.fontWeight.medium},automationCreateMobile:{boxShadow:"none",paddingBlock:"0 12px",paddingInline:12},automationCreateDesktop:{paddingBlock:o?"12px 0":12,paddingInline:12},automationCreateButton:{...n?{minHeight:45}:{},width:"100%"},automationNameInput:{marginBlockEnd:n?void 0:8},automationNameText:{marginInlineStart:12},automationOptionIconDesktop:{marginInlineStart:12},menuScroller:{...n?{}:{marginBlockStart:6}},wrap:{borderTop:`1px solid ${e.regularDividerColor}`,paddingBlockStart:15,paddingBlockEnd:12,paddingInline:12}})),[n,o])}({showDeleteEnableDisableOptions:q}),Pe=[],Ve=de&&le;if(X&&Pe.push((0,ue.jsx)(Et.Z,{mobileStyle:Ae.automationCreateMobile,style:Ae.automationCreateDesktop,topBorder:!x,children:(0,ue.jsx)(co.Z,{onClick:ye,disabled:!Ve,style:Ae.automationCreateButton,children:b?(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettings.editAutomationView.createButton.label",defaultMessage:"Create"}):(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettings.editAutomationView.saveButton.label",defaultMessage:"Save"})})})),q&&Pe.push((0,ue.jsx)(Et.Z,{disableMobilePadding:!0,topBorder:x||0===Pe.length,children:(0,ue.jsx)(Jo.Z,{desktopIconStyle:Ae.automationOptionIconDesktop,icon:jn.y,isRed:!0,onClick:xe,title:g.formatMessage(_r.deleteButton)})})),!T||!E)return null;const Fe=b?g.formatMessage(_r.createAutomationViewMenuTitle):g.formatMessage(_r.editAutomationViewMenuTitle),Ie=D&&U&&(0,ue.jsx)(xr,{automationStore:E,collectionStore:T,automationPermissionScope:$,referencesIncompatibleCollectionViewFilter:se,onDelete:xe});return(0,ue.jsx)(cr.Z,{capture:!0,onEsc:be,children:(0,ue.jsx)(Qo.ZP,{title:Fe,collectionSettingsStore:t,collectionContextStore:o,handleBackArrowClick:ve,handleClose:be,footer:Pe,fullHeight:!0,menuScrollerStyle:Ae.menuScroller,children:(0,ue.jsxs)(lr.Z.Provider,{value:{dispatchOperations:L,editorWidth:Qo.nJ,automationStore:E,collectionStore:T,disabled:!X,disableTooltip:!X},children:[Ie,(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:[{key:"automation_name",action:()=>{},render:e=>(0,ue.jsx)(Nt.ZP,{style:Ae.automationNameInput,...e,value:G??"Loading...",onChange:ke,disabled:!X,textWrapperStyle:Ae.automationNameText})},{key:"automation_source",action:kr,render:e=>(0,ue.jsx)(li,{menuListItemProps:e,selectedSourcePointer:z,collectionContextStore:o,onSelect:Te,disabled:!X})}],render:e=>(0,ue.jsx)(Et.Z,{...e,disableMobilePadding:Boolean(Ie)})}]}),(0,ue.jsxs)("div",{style:Ae.wrap,children:[ce&&q&&(0,ue.jsx)(Mr,{automationId:E.id,automationOwner:U,isAutomationPaused:!O,onPause:he,onResume:fe}),C?(0,ue.jsx)(Ei.T,{}):(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)("section",{style:Ae.automationSection,children:[(0,ue.jsxs)("header",{style:Ae.automationSectionHeader,children:[(0,ue.jsx)("div",{style:Ae.automationSectionTitle,children:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettings.editAutomationView.triggerSection.title",defaultMessage:"When any of these occur"})}),(0,ue.jsx)("div",{style:{...Ae.automationSectionAdd,visibility:te&&X?void 0:"hidden"},children:(0,ue.jsx)(ut.ZP,{popupType:v,alignmentToOrigin:ut.vR.End,placementToOrigin:ut.pO.Bottom,renderOrigin:e=>(0,ue.jsx)(Mt.Z,{...e,ariaLabel:g.formatMessage(_r.addTriggerAriaLabel),icon:F.R}),render:e=>T&&(0,ue.jsx)(Mi,{automationStore:E,collectionStore:T,initialState:pe,updateCurrentAutomationState:_e,buttonPopupParent:e})})})]}),te?(0,ue.jsx)(Ki,{automationStore:E,collectionStore:T,updateCurrentState:_e,handleNavigateToDeletedProperties:we,handleNavigateToEditProperty:Me,disabled:!X}):(0,ue.jsx)(ut.ZP,{popupType:v,renderOrigin:e=>(0,ue.jsx)(ei,{...e,icon:(0,F.R)({height:24,width:12}),title:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettings.editAutomationView.triggerSection.placeholder",defaultMessage:"Add trigger"})}),render:e=>T&&(0,ue.jsx)(Mi,{automationStore:E,collectionStore:T,initialState:pe,updateCurrentAutomationState:_e,buttonPopupParent:e})})]}),(0,ue.jsxs)("section",{style:Ae.automationSection,children:[(0,ue.jsxs)("header",{style:{...Ae.automationSectionHeader,...Ae.automationSectionHeaderAction},children:[(0,ue.jsx)("div",{style:Ae.automationSectionTitle,children:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettings.editAutomationView.actionSection.title",defaultMessage:"Do this"})}),(0,ue.jsx)("div",{style:{...Ae.automationSectionAdd,visibility:me?void 0:"hidden"},children:(0,ue.jsx)(ut.ZP,{alignmentToOrigin:ut.vR.End,placementToOrigin:ut.pO.Bottom,popupType:v,render:e=>(0,ue.jsx)(Do,{automationStore:E,buttonPopupParent:e,collectionStore:T,initialState:ge,updateCurrentAutomationState:_e}),renderOrigin:e=>(0,ue.jsx)(Mt.Z,{...e,ariaLabel:g.formatMessage(_r.addActionAriaLabel),icon:F.R})})})]}),re?(0,ue.jsx)(ar,{automationStore:E,collectionStore:T,handleNavigateToDeletedProperties:we,handleNavigateToEditProperty:Me,updateCurrentAutomationState:_e,currentUserIsOwner:Y,disabled:!X}):(0,ue.jsx)(ti,{automationStore:E,collectionStore:T,initialState:ge,updateCurrentAutomationState:_e})]})]})]})]})})})}async function Ar(e){const{automationName:t,hasPendingChanges:o}=e;return!o||await an.confirmUserAction({message:(0,ue.jsx)(l.FormattedMessage,{id:"automations.confirmDiscardChanges.message",defaultMessage:"{hasName, select, true {Are you sure you want to discard {automationName}?} other {Are you sure you want to discard this automation?}}",values:{automationName:t,hasName:Boolean(t)}}),acceptLabel:(0,ue.jsx)(l.FormattedMessage,{id:"automations.confirmDiscardChanges.acceptLabel",defaultMessage:"Discard"})})}var Pr=o(12534),Vr=o(34859),Fr=o(58421),Ir=o(36857),Br=o(59187),Zr=(o(52262),o(24506),o(1302)),Kr=o(39132),Dr=o(61061),Or=o(44495),Rr=o(95371),Nr=o(30188),Er=o(66890);var Wr=o(77181),Lr=o(42937),Gr=o(29376),Ur=o(64275);function zr(e){window.__c={n:"CollectionSettingsNotification"};const{title:t,icon:o,style:n,children:i,right:r,showCloseButton:a,onClose:s}=e,l=(0,S.Fg)(),c=(0,ue.jsx)(An.Z,{onClick:s,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16},children:(0,Ur.D)({width:14,fill:l.mediumTextColor})});return(0,ue.jsxs)("div",{style:{padding:"12px 16px",margin:"4px 12px",fontSize:12,background:l.accentColors.orange[50],borderRadius:6,...n},children:[t&&(0,ue.jsxs)("div",{style:{display:"flex",marginBottom:2,alignItems:"center"},children:[o,(0,ue.jsx)("div",{style:{fontWeight:ie.Z.fontWeight.medium,flexGrow:1},children:t}),a?c:r]}),i]})}var Hr=o(64369),$r=o(5210);function qr(e){window.__c={n:"CollectionSettingsViewSubitemsPreview"};const{propertyName:t,inversePropertyName:o,newDesign:n}=e,i=(0,S.yK)((e=>({togglePreviewParentIcon:{color:e.regularIconColor,marginRight:"4"},togglePreviewChildIcon:{color:e.mediumIconColor,marginLeft:"24px",marginRight:"4"},togglePreviewRowWithDivider:{padding:"4px",margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center",borderBottom:`1px solid ${e.regularDividerColor}`},togglePreviewRow:{padding:"4px",margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center"},togglePreviewOutsideBorder:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:"4px",alignItems:"center",...n?{fontWeight:ie.Z.fontWeight.medium,backgroundColor:e.accentColors.gray[30],padding:"9px 0"}:{}}})),[n]);return(0,ue.jsx)(ue.Fragment,{children:(0,ue.jsx)(Et.Z,{disableMobileBorders:!0,children:(0,ue.jsxs)("div",{style:i.togglePreviewOutsideBorder,children:[(0,ue.jsxs)("div",{style:i.togglePreviewRowWithDivider,children:[(0,ue.jsx)($r.Z,{isSidebar:!1,open:!0,fill:!0,onClick:()=>{},style:i.togglePreviewParentIcon,disabled:!0}),(0,ue.jsx)("span",{children:"🐔"}),(0,ue.jsx)("div",{style:{marginLeft:"5px"},children:o})]}),(0,ue.jsxs)("div",{style:i.togglePreviewRowWithDivider,children:[(0,ue.jsx)($r.Z,{isSidebar:!1,open:!1,fill:!0,onClick:()=>{},style:i.togglePreviewChildIcon,disabled:!0}),(0,ue.jsx)("span",{children:"🐣"}),(0,ue.jsx)("div",{style:{marginLeft:"5px"},children:t})]}),(0,ue.jsxs)("div",{style:i.togglePreviewRow,children:[(0,ue.jsx)($r.Z,{isSidebar:!1,open:!1,fill:!0,onClick:()=>{},style:i.togglePreviewChildIcon,disabled:!0}),(0,ue.jsx)("span",{children:"🐣"}),(0,ue.jsx)("div",{style:{marginLeft:"5px"},children:t})]})]})})})}var Xr=o(22491),Yr=o(65742),Qr=o(27731);function*Jr(e,t){const o=new Qr.Z;for(o.currentValue=e,o.endValue=t,o.stiffness=35;;){const e=yield o.currentValue;if(o.step(e)){yield o.currentValue;break}}}function*ea(e,t,o){let n=0;for(;n<o;){n+=(yield e+n/o*(t-e))}}function*ta(e){for(const[t,o]of Te.$R(e,e.slice(1)))(0,ne.$K)(t)&&(0,ne.$K)(o)&&(yield*Jr(t,o))}function*oa(e,t){let o=0;for(;!(0,ne.$K)(t)||o<t;){o+=(yield e)}}function*na(e){let t=0;for(;;){const o={};for(const[n,i]of(0,ne.qP)(e)){const e=i.next(t);if(e.done)return;o[n]=e.value}t=yield o}}var ia=o(43350);const ra="inactive-task-filter",aa="active-task-filter",sa="mouse-cursor-filter",la=80,ca=24;function*da(e){yield*na({x:e,opacity:oa(1)})}function ua(e){window.__c={n:"DateShiftingPreview"};const{mode:t}=e,o=(0,S.yK)((e=>({wrap:{margin:"0px 10px",border:`1px solid ${e.regularDividerColor}`,borderRadius:4,alignItems:"center",position:"relative",height:112}})),[1]),i=(0,n.useRef)(null),r=(0,Li.X)(i),a=r?r.width-2:264;return(0,ue.jsx)("div",{style:o.wrap,ref:i,children:(0,ue.jsx)(pa,{mode:t,sceneWidth:a})})}function pa(e){window.__c={n:"DateShiftingPreviewAnimation"};const{mode:t,sceneWidth:o}=e,i=(0,S.yK)((e=>({svgArrowTheme:{stroke:e.collectionValidDependencyArrow,strokeWidth:Yr.lf},invalidArrow:{stroke:e.collectionInvalidDependencyArrow},svgContainer:{position:"absolute",width:"100%",height:"100%",backgroundColor:e.accentColors.gray[30]}})),[]),r=(0,n.useMemo)((()=>({none:function*(){for(;;)yield*da(ta([o/2,o/2+40+20,o/2-40-20,o/2]))},preserve_gap:function*(){for(;;)yield*da(ta([o/2,o/2+40,o/2-40,o/2]))},consume_gap:function*(){for(;;){yield*da(ta([o/2,o/2-40,o/2+40,o/2+la]));const e=500;yield*na({x:oa(o/2+la),opacity:ea(1,0,e)}),yield*na({x:oa(o/2),opacity:ea(0,1,e)})}}})),[o]),{x:a,opacity:s}=function(e){const t=(0,n.useMemo)((()=>e()),[e]),[o,i]=(0,n.useState)((()=>{const e=t.next(0);if(e.done)throw new Error("Generator must provide at least one result");return e.value}));return(0,n.useEffect)((()=>{const e=t.next(0);e.done||i(e.value);let o=Date.now(),n=0;return n=requestAnimationFrame((function e(){n=requestAnimationFrame(e);const r=Date.now(),a=r-o;o=r;const s=t.next(a);s.done||i(s.value)})),()=>cancelAnimationFrame(n)}),[t]),o}(r[t??"none"]),l={x:o/2-160,y:10},c={x:a-40,y:42},d={x:o/2+la,y:74},u={x:c.x+40,y:c.y+12};return(0,ne.$K)(t)&&("consume_gap"===t?(l.x=Math.min(l.x,c.x-la),d.x=Math.max(d.x,c.x+la)):"preserve_gap"===t?(l.x=l.x+a-o/2,d.x=d.x+a-o/2):(0,ne.t1)(t)),(0,ue.jsxs)("svg",{style:i.svgContainer,children:[Te.w6(o/2-160,o,40).map(((e,t)=>(0,ue.jsx)(ma,{startPoint:{x:e,y:0},endPoint:{x:e,y:110}},t))),(0,ue.jsx)(ia.Z,{startPoint:{x:c.x+la,y:c.y+12},endPoint:{x:d.x-2,y:d.y+12},...(0,Xr.iv)(i.svgArrowTheme,c.x+la>d.x?i.invalidArrow:void 0,{opacity:s}),showArrowHead:!0}),(0,ue.jsx)(ia.Z,{startPoint:{x:l.x+la,y:l.y+12},endPoint:{x:c.x-2,y:c.y+12},...(0,Xr.iv)(i.svgArrowTheme,c.x<l.x+la?i.invalidArrow:void 0,{opacity:s}),showArrowHead:!0}),(0,ue.jsx)(ga,{point:l,opacity:s}),(0,ue.jsx)(ga,{point:c,active:!0,opacity:s}),(0,ue.jsx)(ga,{point:d,opacity:s}),(0,ue.jsx)(Sa,{point:u,opacity:s}),(0,ue.jsx)(ya,{})]})}function ga(e){window.__c={n:"SvgTaskBox"};const{point:t,active:o,opacity:n}=e,i=(0,S.Fg)(),r=o?"dark"===i.mode?"#28456C":"#E7F3F8":i.buttonBackground;return(0,ue.jsx)("g",{transform:`translate(${t.x-4},${t.y-2})`,opacity:n,children:(0,ue.jsx)("rect",{filter:`url(#${o?aa:ra})`,width:la,height:ca,x:"4",y:"2",fill:r,rx:"3"})})}function ma(e){window.__c={n:"SvgDashedLine"};const{startPoint:t,endPoint:o}=e,n=(0,S.Fg)(),i="dark"===n.mode?n.accentColors.gray[300]:"#E3E2E0";return(0,ue.jsx)("line",{x1:t.x,y1:t.y,x2:o.x,y2:o.y,stroke:i,strokeDasharray:"3 4"})}function Sa(e){const{point:t,opacity:o}=e;return(0,ue.jsxs)("g",{filter:"url(#mouse-cursor-filter)",transform:`translate(${t.x},${t.y})`,opacity:o,children:[(0,ue.jsx)("path",{fill:"#32302C",d:"M14 12.25h-3.334l2.193 5.294-2.309.956-2.194-5.294L6 15.563l-.75-.75V3.94l1.06-.44L14 11.19v1.06z"}),(0,ue.jsx)("path",{stroke:"#fff",fill:"#32302C",strokeWidth:"0.5",d:"M14 12.5h.25v-1.413l-.073-.073-7.69-7.69-.12-.12-.154.065-1.059.44L5 3.775v11.142l.073.073.75.75.177.177.177-.177 2.092-2.091 2.05 4.948.096.23.23-.095 2.31-.956.231-.096-.096-.231-2.05-4.948H14z"})]})}function ya(){return(0,ue.jsxs)("defs",{children:[(0,ue.jsxs)("filter",{id:ra,width:88,height:32,x:"0",y:"0",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,ue.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,ue.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,ue.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_637_7659"}),(0,ue.jsx)("feOffset",{}),(0,ue.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,ue.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,ue.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_7659"}),(0,ue.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,ue.jsx)("feOffset",{dy:"2"}),(0,ue.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,ue.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,ue.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,ue.jsx)("feBlend",{in2:"effect1_dropShadow_637_7659",result:"effect2_dropShadow_637_7659"}),(0,ue.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_637_7659",result:"shape"})]}),(0,ue.jsxs)("filter",{id:aa,width:88,height:32,x:"0",y:"0",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,ue.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,ue.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,ue.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_637_5084"}),(0,ue.jsx)("feOffset",{}),(0,ue.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,ue.jsx)("feColorMatrix",{values:"0 0 0 0 0.2 0 0 0 0 0.494118 0 0 0 0 0.662745 0 0 0 0.2 0"}),(0,ue.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_5084"}),(0,ue.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,ue.jsx)("feOffset",{dy:"2"}),(0,ue.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,ue.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,ue.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,ue.jsx)("feBlend",{in2:"effect1_dropShadow_637_5084",result:"effect2_dropShadow_637_5084"}),(0,ue.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_637_5084",result:"shape"})]}),(0,ue.jsxs)("filter",{id:sa,width:"17.75",height:"24.244",x:"0.75",y:"0.91",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,ue.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,ue.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,ue.jsx)("feOffset",{dy:"2"}),(0,ue.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,ue.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,ue.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.2 0"}),(0,ue.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_4925"}),(0,ue.jsx)("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_637_4925",result:"shape"})]})]})}var ha=o(52936),fa=o(18442),xa=o(71644),va=o(16956),Ca=o(14900),ba=o(86825),wa=o(61053),ja=o(98519),Ma=o(69872);function _a(e){window.__c={n:"CollectionSettingsViewDefaultPropertyPopup"};const{menuProps:t,property:o,defaultProperty:n,checkState:i,propertySchema:s,collectionContextStore:l,handleDefaultPropertySelect:c,handlePropertySelect:d,...u}=e,p=(0,r.MO)(),g=(0,a.VK)((()=>l.permissionScopes.state),[l]);return(0,a.VK)((()=>nn.default.checkGate("collection_level_subitems_setting")),[])?(0,ue.jsx)(Ma.Z,{...t,disabled:!g.canConfigureBlock,propertySchema:s,format:Ma.Z.DisplayFormat.Name,onClick:()=>c(o),right:(0,ue.jsx)(ka,{property:o,checkState:o===n,collectionContextStore:l,defaultProperty:void 0})}):(0,ue.jsx)(ut.ZP,{popupType:p?ut.Z4.SlideUp:ut.Z4.Popup,alignmentToOrigin:ut.vR.End,placementToOrigin:ut.pO.Bottom,originGap:0,renderOrigin:e=>(0,ue.jsx)(Ma.Z,{...t,...e,disabled:!g.canConfigureBlock,propertySchema:s,format:Ma.Z.DisplayFormat.Name,right:(0,ue.jsx)(ka,{property:o,defaultProperty:n,checkState:i,collectionContextStore:l})}),render:e=>(0,ue.jsx)(Ta,{...u,parent:e,property:o,collectionContextStore:l,handleDefaultPropertySelect:c,handlePropertySelect:d})})}function ka(e){window.__c={n:"DefaultCheck"};const{property:t,defaultProperty:o,checkState:n,collectionContextStore:i}=e,s=(0,r.MO)(),c=(0,a.VK)((()=>{var e;return null===(e=i.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()}),[i]),d=(0,S.yK)((e=>({defaultText:{color:e.mediumTextColor,fontSize:12,fontWeight:500,textTransform:"uppercase",marginRight:4}})),[]);return(0,ue.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,ue.jsx)("div",{style:{...d.defaultText},children:t===o&&(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Default",id:"database.viewSettings.setViewPropertyDefault.defaultProperty.tag",values:{databaseName:c}})}),n&&(0,ue.jsx)("div",{style:{...s?{marginLeft:"auto",marginRight:20,minWidth:0,flexShrink:0}:{marginLeft:"auto",marginRight:12,minWidth:0,flexShrink:0},width:s?16:14,flexShrink:0},children:(0,ja.k)()})]})}function Ta(e){window.__c={n:"PropertySelectPopup"};const{parent:t,property:o,collectionContextStore:n,handleDefaultPropertySelect:i,handlePropertySelect:s,...c}=e,d=(0,r.MO)(),u=(0,a.VK)((()=>n.permissionScopes.state),[n]),p=(0,a.VK)((()=>n.databaseType),[n]),g=(0,a.VK)((()=>{var e;return null===(e=n.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()}),[n]);let m;m=d?{menuType:bt.og.ActionSheet}:{menuType:bt.og.Popup,width:300};const S=u.canConfigureCollection;let y;if("v1"===e.version)y=(0,ue.jsxs)(Et.Z,{topBorder:!0,children:[S&&(0,ue.jsx)(Jo.Z,{isGray:!0,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Set on all new {databaseName} views",id:"database.viewSettings.setViewPropertyDefault.allDefaultButton.title",values:{databaseName:g}}),onClick:()=>{i(o),t.close()}}),(0,ue.jsx)(Jo.Z,{title:(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.setViewPropertyDefault.setProperty.title",defaultMessage:"Set on this view"}),isGray:!0,onClick:()=>{s(o),t.close()}})]});else if("v2"===e.version){const n=(0,Lr.K9)({feature:e.feature,databaseType:p});y=(0,ue.jsxs)(ue.Fragment,{children:[S&&(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(Jo.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Set as default",id:"database.viewSettings.relationFeatures.setViewPropertyDefault.allDefaultButton.title",values:{databaseName:g}}),caption:(0,ue.jsx)(l.FormattedMessage,{...n}),shouldWrapCaption:!0,onClick:()=>{i(o),t.close()}})}),(0,ue.jsx)(Et.Z,{topBorder:S,children:(0,ue.jsx)(Jo.Z,{title:(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.relationFeatures.setViewPropertyDefault.setProperty.title",defaultMessage:"Set on this view only"}),onClick:()=>{s(o),t.close()}})})]})}else(0,ne.t1)(e);return(0,ue.jsx)(Ct.Z,{...m,children:y})}var Aa=o(6695),Pa=o(29798);const Va=(0,l.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertySelect.inputPlaceholder"}});function Fa(e){window.__c={n:"CollectionSetttingsGroupedPropertySelectMenu"};const{currentProperty:t,getGroupedProperties:o,onAccept:i,renderProperty:s,inputPlaceholder:c,schema:d,format:u,defaultShowPropertyGroupCount:p}=e,g=(0,r.Fy)(),y=(0,a.qz)(void 0,Pa.Z),h=(0,a.VK)((()=>o()),[o]),[f,x]=(0,n.useState)(!1),[v,C]=(0,n.useState)(""),b=(0,Aa.iB)(u,d,void 0,Aa.j5.Page).collection_page_properties||[],w=(0,n.useCallback)((e=>{C(e.target.value),y.setState({...y.state,focus:{section:0,indexLocal:0,indexGlobal:0}}),x(!1)}),[y]),j=(0,S.yK)((e=>({dotsIcon:{width:16,fill:e.mediumTextColor,marginLeft:4,marginRight:2},showMoreButton:{color:e.mediumTextColor}})),[]),M=Te.MR(h,(e=>Math.min(...e.map((e=>b.findIndex((t=>t.property===e))))))),_=[{key:"input",comp:(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(Nt.ZP,{focusInitial:!g.isMobile||void 0,focus:!g.isMobile||void 0,value:v,onChange:w,placeholder:c||be.default.formatMessage(Va.inputPlaceholder)})})}];if(v){const e=M.map((e=>e.filter((e=>{const t=d[e],o=t?`${t.name} ${Lt.SO[t.type]}`:"";return Boolean(m().match(v,o))})))).filter((e=>e.length>0));if(0===e.length)_.push({key:"noResults",comp:(0,ue.jsx)(ni.Z,{caption:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})})});else{const o=[{key:"results",render:e=>(0,ue.jsx)(Et.Z,{...e}),items:e.flat().map((e=>Ba({onAccept:i,property:e,schema:d,currentProperty:t,renderProperty:s}))).filter(ne.$K)}];_.push(Ia({sections:o,menuListStore:y}))}}else{const e=p||2;let o,n;if(!f&&M.length>e){o=M.slice(0,e);const t=Te.Sm(M.slice(e).map((e=>e.length)));n={key:"show_more",render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,bn.o)(j.dotsIcon),style:j.showMoreButton,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:t}})}),action:()=>{x(!0)}}}else o=M;const r=o.map(((e,r)=>({key:e.join("-"),render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:0!==r}),items:e.map((e=>Ba({onAccept:i,property:e,schema:d,currentProperty:t,renderProperty:s}))).concat(r===o.length-1?[n]:[]).filter(ne.$K)})));_.push(Ia({sections:r,menuListStore:y}))}return(0,ue.jsx)(ue.Fragment,{children:_.map((e=>{let{key:t,comp:o}=e;return(0,ue.jsx)(n.Fragment,{children:o},t)}))})}function Ia(e){const{menuListStore:t,sections:o}=e;return{key:"properties",comp:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,initialFocus:0,sections:o,store:t})}}function Ba(e){const{schema:t,currentProperty:o,onAccept:n,renderProperty:i,property:r}=e,a=t[r];if(!a)return;return{key:r,render:e=>{const t=r===o;return i?i(e,r,t,a):(0,ue.jsx)(Ma.Z,{...e,propertySchema:a,format:Ma.Z.DisplayFormat.Name,checkState:t})},action:()=>{n(r)}}}var Za=o(53437),Ka=o(31869),Da=o(54281);function Oa(e){const{collectionContextStore:t,feature:o}=e,n=(0,l.useIntl)();return{initialPropertyName:(0,a.VK)((()=>{const e=t.collectionStore();if(null!=e&&e.isDefined()){const i=t.normalizedSchemaStore.state;return Gr.m8(n,{targetCollectionStore:e,isSelfRelation:!0,sourceSchema:i,createUnique:!0,from:o})}return n.formatMessage({id:"database.viewSettings.relationsPropertyTab.initialPropertyName.placeholder",defaultMessage:"Related to target"})}),[t,n,o])}}function Ra(e){const{feature:t,collectionContextStore:o,collectionSettingsStore:i,onPropertySelect:s}=e,c=(0,r.O7)(),u=(0,l.useIntl)(),{initialPropertyName:g}=Oa({collectionContextStore:o,feature:t}),m=(0,n.useCallback)((e=>{const{collectionViewStore:o,newProperty:n,transaction:i}=e;"subitem"===t?Nr.dR({collectionViewStore:o,propertyId:n,transaction:i}):"timeline_arrows_by"===t?Da.tF({collectionViewStore:o,newProperty:n,transaction:i}):(0,ne.t1)(t)}),[t]),S=(0,a.VK)((()=>o.normalizedSchemaStore.state),[o]),y=(0,n.useCallback)((()=>Gr.ND(o,S)),[o,S]),h=(0,n.useCallback)((e=>{const{relationPropertyId:n,transaction:i}=e;"subitem"===t?Nr.jA({environment:c,collectionContextStore:o,relationPropertyId:n,transaction:i}):"timeline_arrows_by"===t?Da._p({collectionContextStore:o,relationPropertyId:n,transaction:i}):(0,ne.t1)(t)}),[o,c,t]),f=(0,n.useCallback)((e=>{const{featureType:t}=e,n=o.collectionStore(),r=n,a=o.collectionViewStore();n&&r&&(p.createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:c,perform:i=>{const s=va.G3({environment:c,collectionStore:n,collectionViewArgs:a?{collectionViewStore:a,format:a.getFormat(),formatKey:"collection_page_properties"}:void 0,propertyType:"relation",transaction:i});return Ka.n7({environment:c,collectionContextStore:o,collectionStore:n,property:s,propertyName:g,targetCollectionStore:r,hasInverseRelation:!0,inverseName:void 0,autoRelate:{enabled:!1},propertyLimit:"no_limit",intl:u,transaction:i,from:t}),a&&(m({collectionViewStore:a,newProperty:s,transaction:i}),h({relationPropertyId:s,transaction:i})),"timeline_arrows_by"===t&&Ja({environment:c,intl:u,collectionStore:n,transaction:i,newConfig:e.dateShiftingConfig}),s}}),d.wl({collectionSettingsStore:i,item:{type:"main"}}),xt._H({environment:c,collectionContextStore:o,from:t,property_type:"relation"}))}),[o,i,c,g,u,h,m]),x=(0,n.useCallback)((e=>{const n=o.collectionViewStore();if(!n)return;let i;p.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handleDefaultPropertySelect",environment:c,perform:t=>{m({collectionViewStore:n,newProperty:e,transaction:t}),h({relationPropertyId:e,transaction:t})}}),s(e),"subitem"===t?i="update_default_subitem":"timeline_arrows_by"===t?i="update_default_timeline_arrows_by":(0,ne.t1)(t),xt.wd({action:i,original_view_type:void 0,property_type:e?"relation":void 0,environment:c,collectionContextStore:o})}),[o,c,s,t,m,h]);return{handlePropertySelect:(0,n.useCallback)((e=>{const n=o.collectionViewStore();if(!n)return;let i;p.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handlePropertySelect",environment:c,perform:t=>{m({collectionViewStore:n,newProperty:e,transaction:t})}}),s(e),"subitem"===t?i="update_subitem":"timeline_arrows_by"===t?i="update_timeline_arrows_by":(0,ne.t1)(t),xt.wd({action:i,original_view_type:void 0,property_type:e?"relation":void 0,environment:c,collectionContextStore:o})}),[o,c,s,t,m]),handleDefaultPropertySelect:x,handleAddRelation:f,getProperties:y}}function Na(e){const{feature:t,collectionContextStore:o}=e;let n,i;const r=nn.default.checkGate("collection_level_subitems_setting");var a,s,l,c;if("subitem"===t)r?(i=null===(a=o.collectionStore())||void 0===a?void 0:a.getFormatStore().getKeyStore("subitem_property").getValue(),n="flattened"===(null===(s=o.collectionViewStore())||void 0===s?void 0:s.getFormat().subitem_display_mode)?void 0:i):(n=null===(l=o.currentSubitemFormatStore.state)||void 0===l?void 0:l.property,i=null===(c=o.collectionStore())||void 0===c?void 0:c.getFormatStore().getKeyStore("collection_default_subitem").getValue());else if("timeline_arrows_by"===t){var d;n=o.currentArrowsByFormatStore.state,i=null===(d=o.collectionStore())||void 0===d?void 0:d.getFormatStore().getKeyStore("collection_default_arrows_by").getValue()}else(0,ne.t1)(t);const u=o.normalizedSchemaStore.state,p=Gr.NA(o,u);(0,ne.$K)(n)&&!p.includes(n)&&(n=void 0),(0,ne.$K)(i)&&!p.includes(i)&&(i=void 0);const g=n??i;if(g)return{property:g,isDefault:g===i,enabledOnView:Boolean(n),enabledOnCollection:Boolean(i),supportedInView:es({feature:t,viewType:o.getViewType()})}}function Ea(e){const{feature:t,collectionContextStore:o}=e;return(0,a.VK)((()=>Na({feature:t,collectionContextStore:o})),[o,t])}function Wa(e){window.__c={n:"RelationPropertyPicker"};const{currentPropertyId:t,feature:o,collectionContextStore:n,collectionSettingsStore:i,permissionScopes:r,onPropertySelect:s,buttonPopupStore:c,disabled:d}=e,u=(0,l.useIntl)(),p=(0,a.VK)((()=>{var e,t;return"subitem"===o?null===(e=n.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.collection_default_subitem:"timeline_arrows_by"===o?null===(t=n.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.collection_default_arrows_by:void(0,ne.t1)(o)}),[o,n]),g=(0,a.VK)((()=>n.databaseType),[n]),{handleDefaultPropertySelect:m,handlePropertySelect:S,getProperties:y}=Ra({collectionContextStore:n,collectionSettingsStore:i,feature:o,onPropertySelect:s}),h=(0,Lr.g3)({feature:o,databaseType:g});return(0,ue.jsx)(Ga,{intl:u,icon:H.v,caption:(0,ue.jsx)(l.FormattedMessage,{...h}),collectionContextStore:n,buttonPopupStore:c,shouldGroupProperties:!0,getGroupedProperties:y,currentProperty:t,disabled:d,onAccept:r.canConfigureBlock&&r.canConfigureCollection?S:()=>{},renderProperty:(e,t,i,r)=>(0,ue.jsx)(_a,{version:"v2",feature:o,menuProps:e,property:t,defaultProperty:p,checkState:i,propertySchema:r,collectionContextStore:n,handleDefaultPropertySelect:m,handlePropertySelect:S})})}function La(e){window.__c={n:"DatePropertyPicker"};const{currentPropertyId:t,collectionContextStore:o,onPropertyChanged:i,disabled:r,title:s}=e,c=(0,l.useIntl)(),d=(0,a.qz)(void 0,Mn.Z),u=(0,a.VK)((()=>o.normalizedSchemaStore.state),[o]),p=(0,n.useCallback)((()=>Object.keys(u).filter((e=>{const t=u[e];return"date"===(null==t?void 0:t.type)})).filter(ne.$K)),[u]);return(0,ue.jsx)(Ga,{intl:c,buttonPopupStore:d,title:s,collectionContextStore:o,shouldGroupProperties:!1,getProperties:p,currentProperty:t,disabled:r,onAccept:e=>{e&&i(e),d.setState({open:!1})}})}function Ga(e){window.__c={n:"PopupPropertyPicker"};const{currentProperty:t,icon:o,caption:n,buttonPopupStore:i,collectionContextStore:s,disabled:c,title:d,shouldGroupProperties:u}=e,p=(0,r.Fy)(),g=(0,a.VK)((()=>{var e;return(null===(e=s.collectionStore())||void 0===e?void 0:e.getFormat())??{}}),[s]),m=(0,a.VK)((()=>s.normalizedSchemaStore.state),[s]),y=(0,S.yK)((e=>({caption:{fontSize:p.isMobile?ie.Z.fontSize.UISmall.mobile:ie.Z.fontSize.UISmall.desktop,color:e.mediumTextColor,margin:"0 12px 12px 14px"}})),[p]),h=(0,a.VK)((()=>i.state.open),[i]),f=(0,a.VK)((()=>p.isPhone?{menuType:bt.og.ActionSheet}:{menuType:bt.og.Popup,width:300}),[p.isPhone]);return(0,ue.jsxs)(ue.Fragment,{children:[n&&(0,ue.jsx)("div",{style:y.caption,children:n}),(0,ue.jsx)(ut.ZP,{popupType:p.isPhone?Za.kQ.SlideUp:Za.kQ.Popup,alignmentToOrigin:ut.vR.End,placementToOrigin:ut.pO.Bottom,disabled:c,originGap:0,renderOrigin:e=>{var n;return(0,ue.jsx)(Jo.Z,{title:d??(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.relationFeatures.propertyPicker.default.title",defaultMessage:"Property"}),showChevron:!0,right:t?(0,ue.jsx)("span",{style:ie.Z.textOverflowStyle,children:null===(n=m[t])||void 0===n?void 0:n.name}):void 0,rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},rotateChevron:h,disabled:c,icon:o,...e})},render:t=>(0,ue.jsx)(Ct.Z,{...f,children:u?(0,ue.jsx)(Fa,{...e,getGroupedProperties:e.getGroupedProperties,format:g,schema:m}):(0,ue.jsx)(wa.Z,{...e,getProperties:e.getProperties,format:g,schema:m})}),buttonPopupStore:i})]})}function Ua(e){var t;window.__c={n:"DateShiftingConfigSection"};const{currentConfig:o,onConfigChange:i,disabled:s,collectionContextStore:c}=e,d=(0,a.VK)((()=>c.databaseType),[c]),u=(0,r.O7)(),p=null===(t=o.configWithoutDates)||void 0===t?void 0:t.mode,[g,m]=(0,n.useState)(!(0,ne.$K)(o.configWithoutDates)||Boolean(o.configWithoutDates.avoid_weekends)),y=(0,ne.$K)(o.configWithoutDates)?Boolean(o.configWithoutDates.avoid_weekends):g;(0,n.useEffect)((()=>{if((0,ne.$K)(o.configWithoutDates)){const e=Boolean(o.configWithoutDates.avoid_weekends);e!==g&&m(e)}}),[o,g]);const h=(0,S.yK)((()=>({dateShiftContainer:{marginLeft:4},previewContainer:{marginLeft:4},previewTitle:{paddingLeft:10}})),[]),f=(0,n.useCallback)((e=>{(0,ne.$K)(o.configWithoutDates)&&(i({...o,configWithoutDates:{...o.configWithoutDates,avoid_weekends:e}}),xt.wd({environment:u,collectionContextStore:c,action:"update_dependency_date_shift_avoid_weekends",new_avoid_weekends:e}))}),[c,o,u,i]),x=(0,n.useCallback)((e=>{(0,ne.$K)(e)?i({...o,configWithoutDates:{...o.configWithoutDates,mode:e,avoid_weekends:g}}):i({...o,configWithoutDates:void 0}),xt.wd({environment:u,collectionContextStore:c,action:"update_dependency_date_shift_mode",new_date_shift_mode:e??"none"})}),[c,o,u,g,i]);return(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(Et.Z,{title:(0,ue.jsx)(l.FormattedMessage,{...Lr.dH.dateShiftingSectionCaption}),disableMobileBorders:!0,style:h.previewContainer,desktopTitleStyle:h.previewTitle,children:(0,ue.jsx)(ua,{mode:p})}),(0,ue.jsx)(Et.Z,{disableMobileBorders:!0,style:h.dateShiftContainer,children:(0,ue.jsx)(Ya,{currentMode:p,onModeChange:x,databaseType:d,disabled:s})}),(0,ue.jsxs)(Et.Z,{children:[(0,ue.jsx)(Xa,{currentValue:y,databaseType:d,onChange:f,disabled:s||!(0,ne.$K)(o.configWithoutDates)}),(0,ue.jsx)(za,{...e})]})]})}function za(e){window.__c={n:"DatePropertiesConfigSection"};const{collectionContextStore:t,currentConfig:o,onConfigChange:i,disabled:r}=e,s=(0,a.VK)((()=>{const e=t.normalizedSchemaStore.state;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,b.Lt)(o)}))}),[t]),c=s.length,d=o.datePropertyId?s.find((e=>e!==o.datePropertyId)):void 0,u="string"==typeof o.datePropertyId&&(0,ne.$K)(o.endDatePropertyId),p=(0,n.useCallback)(((e,t)=>{const n={[e]:t};if(u&&(0,ne.$K)(o.datePropertyId)){const i="datePropertyId"===e?"endDatePropertyId":"datePropertyId";o[i]===t&&(n[i]=s.find((e=>e!==t)))}i({...o,...n})}),[o,s,i,u]);return!(0,ne.$K)(o.configWithoutDates)||c<=1?null:(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(La,{collectionContextStore:t,currentPropertyId:o.datePropertyId,title:u?(0,ue.jsx)(l.FormattedMessage,{...Lr.dH.startDate}):(0,ue.jsx)(l.FormattedMessage,{...Lr.dH.datePropertyPickerTitle}),onPropertyChanged:e=>p("datePropertyId",e),disabled:r}),(0,ne.$K)(d)&&"string"==typeof o.datePropertyId&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ne.$K)(o.endDatePropertyId)&&(0,ue.jsx)(La,{collectionContextStore:t,currentPropertyId:o.endDatePropertyId,title:(0,ue.jsx)(l.FormattedMessage,{...Lr.dH.endDate}),onPropertyChanged:e=>p("endDatePropertyId",e),disabled:r}),(0,ue.jsx)(ba.Z,{title:(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.relationFeatures.datePropertyPicker.separateStartEnd",defaultMessage:"Separate start and end dates"}),focused:!1,on:u,disabled:r,disabledFeedback:!0,onClick:()=>{i({...o,endDatePropertyId:u?void 0:d})}})]})]})}function Ha(e){const{collectionSettingsStore:t,feature:o,permissionScopes:n}=e,i=!n.canConfigureCollection&&!n.canConfigureBlock;return(0,ue.jsx)(Jo.Z,{icon:fa.H,showChevron:!0,disabled:i,title:(0,ue.jsx)(l.FormattedMessage,{...Lr.dH.advancedSettings}),onClick:()=>{d.H4({collectionSettingsStore:t,item:{type:"relationFeaturesAdvancedSettings",feature:o}})}})}function $a(e){window.__c={n:"TurnOnFeatureButton"};const{feature:t,handleAddRelation:o,databaseType:n,permissionScopes:i}=e,r=(0,S.yK)((e=>({button:{width:"100%"},buttonWrap:{margin:"0px 12px"}})),[]);if(!i.canConfigureBlock||!i.canConfigureCollection)return null;const a=(0,Lr.Tq)({feature:t,databaseType:n});return(0,ue.jsx)(Et.Z,{disableMobileBorders:!0,children:(0,ue.jsx)("div",{style:r.buttonWrap,children:(0,ue.jsx)(co.Z,{style:r.button,onClick:o,isLarge:!0,children:(0,ue.jsx)(l.FormattedMessage,{...a})})})})}function qa(e){window.__c={n:"TurnOffFeatureMenuItem"};const{feature:t,permissionScopes:o,propertyName:n,relationPropertyId:i,inversePropertyName:a,collectionContextStore:s,collectionSettingsStore:c,handleDefaultPropertySelect:u,databaseType:g}=e,m=(0,r.O7)(),y=(0,S.yK)((e=>({modalTitle:{fontWeight:ie.Z.fontWeight.semibold,fontSize:18},modalInnerStyle:{textAlign:"center"},modalPropertyName:{color:e.darkTextColor,fontWeight:ie.Z.fontWeight.semibold}})),[]);if(!(o.canConfigureCollection&&o.canConfigureBlock&&n&&a))return null;const h=(0,Lr.nB)({feature:t,databaseType:g}),f=(0,Lr.OH)({feature:t,databaseType:g});return(0,ue.jsx)(Jo.Z,{icon:jn.y,title:(0,ue.jsx)(l.FormattedMessage,{...h}),isRed:!0,onClick:()=>{an.showDialog({description:(0,ue.jsx)(l.FormattedMessage,{...Lr.dH.turnOffFeatureDeletedProperties,values:{span:e=>(0,ue.jsx)("span",{style:y.modalPropertyName,children:e}),propertyName:n,inversePropertyName:a}}),message:(0,ue.jsx)("div",{style:y.modalTitle,children:(0,ue.jsx)(l.FormattedMessage,{...f})}),innerStyle:y.modalInnerStyle,showCancel:!0,keepFocus:!0,items:[{label:(0,ue.jsx)(l.FormattedMessage,{...Lr.dH.turnOffAndDelete}),color:"red",onAccept:async()=>{i&&(await async function(e){const{environment:t,collectionContextStore:o,propertyId:n,feature:i}=e,r=o.normalizedSchemaStore.state,a=o.collectionStore();if(!a)return;await p.createAndCommitAsync({environment:t,userAction:"CollectionSettingsViewRelationFeatures.handleTurnOffFeatureAndDeleteAccept",waitForServerCommit:!1,perform:e=>va.yV({environment:t,collectionStore:a,schema:r,property:n,transaction:e})});const s=r[n];s&&xt.y9({environment:t,collectionContextStore:o,property_type:s.type,from:i,property:n})}({environment:m,propertyId:i,collectionContextStore:s,feature:t}),u(void 0),d.wl({collectionSettingsStore:c,item:{type:"main"}}))}},{label:(0,ue.jsx)(l.FormattedMessage,{...Lr.dH.turnOffFeature}),color:"red",onAccept:()=>{i&&(u(void 0),d.wl({collectionSettingsStore:c,item:{type:"main"}}))}}]})}})}function Xa(e){const{currentValue:t,onChange:o,disabled:n,databaseType:i}=e;return(0,ue.jsx)(ba.Z,{title:(0,ue.jsx)(l.FormattedMessage,{...Lr.dH.avoidWeekendsSwitcherTitle}),caption:(0,ue.jsx)(l.FormattedMessage,{...(0,Lr.Bq)(i)}),shouldWrapCaption:!0,shouldWrapTitle:!0,focused:!1,on:t,disabled:n,disabledFeedback:!0,onClick:()=>o(!t)})}function Ya(e){window.__c={n:"DateShiftModeSelect"};const{currentMode:t,onModeChange:o,disabled:n,databaseType:i}=e,r=(0,S.yK)((e=>({wrap:{display:"flex",flexDirection:"column",rowGap:8,marginLeft:12,marginRight:12}})),[]);return(0,ue.jsx)("div",{style:r.wrap,children:[...ha.Bp,void 0].map((e=>(0,ue.jsx)(Qa,{dateShiftingMode:e,databaseType:i,onClick:()=>o(e),active:e===t,disabled:n},e??"none")))})}function Qa(e){window.__c={n:"DateShiftButton"};const{dateShiftingMode:t,onClick:o,active:n,disabled:i,databaseType:a}=e,s=(0,r.Fy)(),c=(0,S.yK)((e=>({buttonStyles:{fontSize:s.isMobile?ie.Z.fontSize.UISmall.mobile:ie.Z.fontSize.UISmall.desktop,fontWeight:ie.Z.fontWeight.medium,borderRadius:4,width:"100%",padding:"8px 8px",boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.darkTextColor,fill:e.mediumTextColor,...n&&{boxShadow:`0 0 0 2px ${e.blueColor}`,color:e.blueColor,fill:e.blueColor},...i&&{opacity:.65}},icon:{width:20,height:20,marginRight:6},buttonContentWrap:{display:"flex",alignItems:"center"}})),[n,s,i]),d=(0,Lr.W3)({dateShiftingMode:t,databaseType:a}),u=(0,Lr.l7)(t);return(0,ue.jsx)(An.Z,{style:c.buttonStyles,onClick:o,disabled:i,children:(0,ue.jsxs)("div",{style:c.buttonContentWrap,children:[(0,ue.jsx)("div",{children:u(c.icon)}),(0,ue.jsx)("div",{children:(0,ue.jsx)(l.FormattedMessage,{...d})})]})})}function Ja(e){const{environment:t,newConfig:o,collectionStore:n,transaction:i,intl:r}=e;let a;if((0,ne.$K)(o.configWithoutDates))if(o.datePropertyId)a={...o.configWithoutDates,date_property:o.datePropertyId,end_date_property:o.endDatePropertyId};else{const e=(0,xa.ZP)(),s={name:r.formatMessage(Lr.dH.newDateProperty),type:"date"};Ca.xO({environment:t,collectionStore:n,update:{[e]:s},transaction:i}),a={...o.configWithoutDates,date_property:e,end_date_property:void 0}}sn.sW({store:n.getFormatStore(),data:{dependency_date_shifting_config:a??null},transaction:i})}function es(e){const{viewType:t,feature:o}=e;return"timeline_arrows_by"===o?"timeline"===t:"subitem"===o||void(0,ne.t1)(o)}function ts(e){window.__c={n:"CollectionSettingsViewRelationFeatures"};const{collectionContextStore:t,collectionSettingsStore:o,feature:i}=e,s=(0,l.useIntl)(),c=(0,r.Fy)(),d=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t]),u=(0,a.VK)((()=>t.databaseType),[t]),p=(0,a.VK)((()=>t.collectionStore()),[t]),g=Ea({collectionContextStore:t,feature:i}),m=null==g?void 0:g.property,y=(0,n.useMemo)((()=>si.HI(d)),[d]),h=(0,a.VK)((()=>t.permissionScopes.state),[t]),f=(0,a.VK)((()=>{var e;return m&&(null===(e=d[m])||void 0===e?void 0:e.name)}),[d,m]),x=(0,a.VK)((()=>{const e=m&&d[m];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=d[o])||void 0===t?void 0:t.name:void 0}}),[m,d]),v=(0,a.VK)((()=>{const e=t.collectionStore();return null!=e&&e.isDefined()?Gr.aI(s,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:i}):s.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[t,s,i]),C=(0,a.VK)((()=>Boolean(p&&function(e){const{collectionContextStore:t,collectionStore:o}=e,n=o.getFormat().collection_default_arrows_by,i=t.currentArrowsByFormatStore.state;return!(0,ne.$K)(i)||i===n}({collectionContextStore:t,collectionStore:p}))),[t,p]),b=(0,a.qz)(void 0,Mn.Z),w=(0,n.useCallback)((e=>{e&&b.setState({open:!1})}),[b]),{initialPropertyName:j}=Oa({collectionContextStore:t,feature:i}),M=Ra({collectionContextStore:t,collectionSettingsStore:o,onPropertySelect:w,feature:i}),{handleAddRelation:_,handleDefaultPropertySelect:k}=M,T=(0,ur.E)("collection_level_subitems_setting"),A=(0,S.yK)((e=>({container:{marginLeft:12,marginRight:12},captionText:{fontSize:c.isMobile?ie.Z.fontSize.UISmall.mobile:ie.Z.fontSize.UISmall.desktop,color:e.mediumTextColor,fontWeight:ie.Z.fontWeight.regular,marginLeft:14},subitemsPreviewContainer:{marginBottom:6,marginLeft:2}})),[c]);if(!p)return null;let P;if("subitem"===i)if(g)P=(0,ue.jsxs)(Et.Z,{disableMobileBorders:!0,children:[(0,ue.jsx)("div",{style:A.subitemsPreviewContainer,children:(0,ue.jsx)(qr,{propertyName:f||j,inversePropertyName:x||v,newDesign:!0})}),T?(0,ue.jsx)(as,{databaseType:u,permissionScopes:h}):(0,ue.jsx)(rs,{feature:i,databaseType:u,featuredRelationProperty:g,actions:M,permissionScopes:h}),(0,ue.jsx)(Ha,{collectionSettingsStore:o,feature:i,permissionScopes:h}),(0,ue.jsx)(qa,{feature:i,databaseType:u,permissionScopes:h,propertyName:f,relationPropertyId:m,collectionContextStore:t,collectionSettingsStore:o,handleDefaultPropertySelect:k,inversePropertyName:x})]});else{const e=()=>{_({featureType:"subitem"}),T&&Zr.default.afterNextFlush((()=>{const e=t.subitemTreeStore.getState(),o=t.resultsInViewOrder(1).at(0),n=(0,Rr.DY)(e.children,(e=>e.value.store===o));if(n){const e=n.map((e=>e.value.store.pointer)),o=(0,Wr.Af)(e);Nr.rT({collectionContextStore:t,pathKey:o})}}))};P=(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(qr,{propertyName:f||j,inversePropertyName:x||v,newDesign:!0}),(0,ue.jsx)($a,{feature:i,permissionScopes:h,databaseType:u,handleAddRelation:e})]})}else"timeline_arrows_by"===i?P=g?(0,ue.jsxs)(ue.Fragment,{children:[C?(0,ue.jsx)(ns,{collectionContextStore:t,firstDatePropertyId:y,permissionScopes:h}):(0,ue.jsx)(os,{collectionContextStore:t,databaseType:u}),(0,ue.jsxs)(Et.Z,{topBorder:!0,children:[(0,ue.jsx)(Ha,{collectionSettingsStore:o,feature:i,permissionScopes:h}),(0,ue.jsx)(rs,{feature:i,databaseType:u,featuredRelationProperty:g,actions:M,permissionScopes:h}),(0,ue.jsx)(qa,{feature:i,databaseType:u,permissionScopes:h,relationPropertyId:m,propertyName:f,inversePropertyName:x,collectionContextStore:t,collectionSettingsStore:o,handleDefaultPropertySelect:k})]})]}):(0,ue.jsx)(is,{databaseType:u,collectionContextStore:t,firstDatePropertyId:y,handleAddRelation:_,permissionScopes:h}):(0,ne.t1)(i);const V=(0,Lr.Gt)({feature:i,databaseType:u}),F=(0,Lr.qi)({feature:i,databaseType:u});return(0,ue.jsxs)(Qo.ZP,{...e,title:(0,ue.jsx)(l.FormattedMessage,{...V}),children:[(0,ue.jsx)(Et.Z,{disableMobileBorders:!0,children:(0,ue.jsx)("div",{style:{...A.container,...A.captionText},children:(0,ue.jsx)(l.FormattedMessage,{...F})})}),P]})}function os(e){window.__c={n:"DateShiftingNotApplicableToThisViewMessage"};const{collectionContextStore:t,databaseType:o}=e,n=(0,r.MO)(),i=(0,S.yK)((e=>({wrap:{boxShadow:e.plainButtonBoxShadow,...n?{backgroundColor:e.sidebarBackground,margin:void 0,borderRadius:void 0}:{background:"rgba(196, 196, 196, 0.13)",marginTop:14,marginBottom:20}},iconWithMessage:{display:"flex",gap:8},icon:{width:14,height:14,position:"relative",top:1,color:e.mediumTextColor}})),[n]),s=(0,a.VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getNormalizedDependencyDateShiftingConfig()}),[t]),c=(0,Lr.uM)({currentDateShiftConfig:s,databaseType:o});return(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(Et.Z,{title:(0,ue.jsx)(l.FormattedMessage,{...Lr.dH.dateShiftingSectionCaption}),children:(0,ue.jsx)(ua,{mode:null==s?void 0:s.mode})}),(0,ue.jsx)(zr,{style:i.wrap,showCloseButton:!1,children:(0,ue.jsxs)("div",{style:i.iconWithMessage,children:[(0,Or.D)(i.icon),(0,ue.jsx)(Hr.Z,{isSmall:!0,isMultiline:!0,children:(0,ue.jsx)(l.FormattedMessage,{...c})})]})})]})}function ns(e){window.__c={n:"FeatureEnabledDependenciesSection"};const{collectionContextStore:t,firstDatePropertyId:o,permissionScopes:i}=e,s=(0,r.O7)(),c=(0,l.useIntl)(),d=(0,a.VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getNormalizedDependencyDateShiftingConfig()}),[t]),u=(0,n.useCallback)((e=>{const o=t.collectionStore();o&&p.createAndCommit({userAction:"FeatureEnabledDependenciesSection.handleConfigChange",environment:s,perform:t=>{Ja({collectionStore:o,environment:s,intl:c,newConfig:e,transaction:t})}})}),[t,s,c]),g=(0,n.useMemo)((()=>({configWithoutDates:d,...d?{datePropertyId:d.date_property,endDatePropertyId:d.end_date_property}:{datePropertyId:o}})),[d,o]);return(0,ue.jsx)(Ua,{collectionContextStore:t,currentConfig:g,disabled:!i.canConfigureBlock||!i.canConfigureCollection,onConfigChange:u})}function is(e){window.__c={n:"FeatureDisabledDependenciesSection"};const{collectionContextStore:t,handleAddRelation:o,firstDatePropertyId:i,permissionScopes:r,databaseType:a}=e,[s,l]=(0,n.useState)({datePropertyId:i,configWithoutDates:{mode:"consume_gap",avoid_weekends:true}});return(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(Ua,{collectionContextStore:t,currentConfig:s,disabled:!r.canConfigureBlock||!r.canConfigureCollection,onConfigChange:l}),(0,ue.jsx)($a,{feature:"timeline_arrows_by",permissionScopes:r,databaseType:a,handleAddRelation:()=>{o({featureType:"timeline_arrows_by",dateShiftingConfig:s})}})]})}function rs(e){window.__c={n:"ToggleViewVisibilityMenuItem"};const{feature:t,featuredRelationProperty:o,actions:n,permissionScopes:i,databaseType:a}=e,s=(0,r.Fy)(),c=(0,S.yK)((()=>({eyeHideIcon:{width:20,height:s.isMobile?24:12,marginLeft:3}})),[s]);if(!o.supportedInView)return null;const d=o.enabledOnView,u=d?{icon:Dr.B,iconStyle:c.eyeHideIcon}:{icon:Kr.c};return(0,ue.jsx)(Jo.Z,{...u,onClick:()=>{n.handlePropertySelect(d?void 0:o.property)},title:(0,ue.jsx)(l.FormattedMessage,{...(0,Lr.cn)({feature:t,isOn:d,databaseType:a})}),disabled:!i.canConfigureBlock})}function as(e){window.__c={n:"SubitemDisplayModeMenuItem"};const{databaseType:t,permissionScopes:o}=e,i=(0,Er.Y$)(),s=(0,a.VK)((()=>i.collectionViewStore()),[i]),c=(0,a.VK)((()=>null==s?void 0:s.getFormat()),[s]),d=void 0===(null==c?void 0:c.subitem_display_mode)||"show"===(null==c?void 0:c.subitem_display_mode),g=(0,r.Fy)(),m=(0,r.O7)(),y=(0,S.yK)((()=>({eyeHideIcon:{width:20,height:g.isMobile?24:12,marginLeft:3}})),[g]),h=n.useCallback((()=>{s&&p.createAndCommit({userAction:"actionRegistry.updateCollectionViewSubitemDisplayMode",environment:m,perform:e=>{u.FH({stores:[s],update:{subitem_display_mode:d?"flattened":"show",collection_view_subitem:d?void 0:(0,Wr.wf)(i)},transaction:e})}})}),[d,i,s,m]);cn.j(m,"configure_subitem_display_mode",{userAction:d?"CollectionSettingsViewRelationFeatures.configureSubitemDisplayMode.flattened":"CollectionSettingsViewRelationFeatures.configureSubitemDisplayMode.show"});const f=d?{icon:Dr.B,iconStyle:y.eyeHideIcon}:{icon:Kr.c};return(0,ue.jsx)(Jo.Z,{...f,onClick:h,title:(0,ue.jsx)(l.FormattedMessage,{...(0,Lr.cn)({feature:"subitem",isOn:d,databaseType:t})}),disabled:!o.canConfigureBlock})}var ss=o(91),ls=o(80402),cs=o(60442);function ds(e){const{render:t,showImage:o,caption:i,tooltipImage:r}=e,a=e.tooltipImageScale||1,[s,l]=n.useState(!1),[c,d]=n.useState({width:0,height:0});return n.useEffect((()=>{if(r){const e=new Image;e.src=r,e.onload=()=>{d({width:e.width*a,height:e.height*a}),l(!0)}}}),[r,a]),(0,ue.jsx)(re.Z,{placement:re.Z.Placement.Left,disableTooltip:void 0===i,style:{whiteSpace:"break-spaces"},render:t,renderTooltip:()=>r&&s&&o?(0,ue.jsx)(cs.Z,{caption:i,imageURL:r,imageWidth:c.width,imageHeight:c.height}):(0,ue.jsx)("div",{children:i})})}const us="box1-filter",ps="box2-filter";function gs(e){window.__c={n:"CollectionSettingsViewDependenciesPreview2"};const{propertyName:t,inversePropertyName:o}=e,n=(0,S.Fg)(),i=(0,S.yK)((e=>({svgWrap:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:4,alignItems:"center",position:"relative",height:112,backgroundColor:e.accentColors.gray[30],display:"flex",justifyContent:"center"}})),[]);return(0,ue.jsx)(Et.Z,{disableMobileBorders:!0,children:(0,ue.jsx)("div",{style:i.svgWrap,children:(0,ue.jsxs)("svg",{width:"266",height:"116",fill:"none",children:[(0,ue.jsx)("path",{stroke:"#DFAF49",strokeWidth:"2",d:"M124 20h.426c7.703 0 17.307-.002 25.029 1.93 3.979.994 8.078 2.638 11.248 5.575C164.082 30.635 166 34.868 166 40c0 8.001-6.095 12.917-11.524 15.932-5.553 3.086-12.74 5.481-19.23 7.644l-.349.116c-6.919 2.307-13.074 4.381-17.546 6.866C112.655 73.166 112 75 112 76c0 1.868.582 2.885 1.453 3.692 1.08 1.001 2.981 1.982 6.002 2.737C125.59 83.963 132.773 84 141 84"}),(0,ue.jsx)("path",{stroke:"#E3E2E0",strokeWidth:"2",d:"M125 32c8.227 0 15.41.037 21.545 1.57 3.021.756 4.922 1.737 6.002 2.738.871.807 1.453 1.824 1.453 3.692 0 .999-.655 2.834-5.351 5.443-4.472 2.484-10.627 4.558-17.546 6.865l-.349.116c-6.49 2.163-13.677 4.558-19.23 7.644C106.095 63.084 100 67.998 100 76c0 5.132 1.918 9.365 5.297 12.495 3.17 2.937 7.269 4.581 11.248 5.576C124.267 96 133.871 96 141.574 96H142"}),(0,ue.jsx)("path",{fill:n.accentColors.gray[30],d:"M157 27h16v18h-16zM92 70h16v18H92z"}),(0,ue.jsx)("path",{stroke:"#DFAF49",strokeWidth:"2",d:"M136 88l5-4-5-4"}),(0,ue.jsx)("path",{stroke:"#E3E2E0",strokeWidth:"2",d:"M130 36l-5-4 5-4"}),(0,ue.jsxs)("g",{filter:"url(#box1-filter)",children:[(0,ue.jsx)("rect",{width:"100",height:"28",x:"24",y:"12",fill:n.buttonBackground,rx:"3"}),(0,ue.jsx)("text",{x:"67",y:"31",fill:"#000",children:"🌱"})]}),(0,ue.jsxs)("g",{filter:"url(#box2-filter)",children:[(0,ue.jsx)("rect",{width:"100",height:"28",x:"142",y:"76",fill:n.buttonBackground,rx:"3"}),(0,ue.jsx)("text",{x:"185",y:"95",fill:"#000",children:"🌳"})]}),(0,ue.jsx)(ms,{x:"161",y:"26",width:"100",height:"16",textStyles:{fontSize:12,fontWeight:590,color:n.regularTextColor},children:t}),(0,ue.jsx)(ms,{x:"15",y:"69",width:"90",height:"16",textStyles:{color:n.lightTextColor,fontSize:12,fontWeight:500,textAlign:"right"},children:o}),(0,ue.jsxs)("defs",{children:[(0,ue.jsxs)("filter",{id:us,width:"108",height:"36",x:"20",y:"10",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,ue.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,ue.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,ue.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_1034_52436"}),(0,ue.jsx)("feOffset",{}),(0,ue.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,ue.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,ue.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_1034_52436"}),(0,ue.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,ue.jsx)("feOffset",{dy:"2"}),(0,ue.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,ue.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,ue.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,ue.jsx)("feBlend",{in2:"effect1_dropShadow_1034_52436",result:"effect2_dropShadow_1034_52436"}),(0,ue.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_1034_52436",result:"shape"})]}),(0,ue.jsxs)("filter",{id:ps,width:"108",height:"36",x:"138",y:"74",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,ue.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,ue.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,ue.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_1034_52436"}),(0,ue.jsx)("feOffset",{}),(0,ue.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,ue.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,ue.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_1034_52436"}),(0,ue.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,ue.jsx)("feOffset",{dy:"2"}),(0,ue.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,ue.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,ue.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,ue.jsx)("feBlend",{in2:"effect1_dropShadow_1034_52436",result:"effect2_dropShadow_1034_52436"}),(0,ue.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_1034_52436",result:"shape"})]})]})]})})})}function ms(e){const{children:t,textStyles:o,...n}=e;return(0,ue.jsx)("foreignObject",{...n,children:(0,ue.jsx)("div",{style:{...ie.Z.textOverflowStyle,...n.width?{width:Number(n.width)}:{},...o},children:t})})}function Ss(e){var t;window.__c={n:"CollectionSettingsDependenciesAdvancedSettings"};const{collectionContextStore:o,collectionSettingsStore:i,feature:r}=e,s=(0,l.useIntl)(),c=(0,ur.E)("collection_level_subitems_setting"),d=(0,a.VK)((()=>o.collectionStore()),[o]),u=(0,a.VK)((()=>o.normalizedSchemaStore.state),[o]),p=(0,a.VK)((()=>o.permissionScopes.state),[o]),g=null===(t=Ea({collectionContextStore:o,feature:r}))||void 0===t?void 0:t.property,m=(0,a.VK)((()=>{var e;return g&&(null===(e=u[g])||void 0===e?void 0:e.name)}),[g,u]),y=(0,a.VK)((()=>{var e;return"table"===(null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType())}),[o]),h=(0,a.VK)((()=>{const e=g&&u[g];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=u[o])||void 0===t?void 0:t.name:void 0}}),[g,u]),f=(0,a.VK)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?Gr.aI(s,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:r}):s.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[o,s,r]),x=(0,a.qz)(void 0,Mn.Z),{initialPropertyName:v}=Oa({collectionContextStore:o,feature:r}),C=(0,n.useCallback)((e=>{e&&x.setState({open:!1})}),[x]),b=(0,S.yK)((()=>({previewContainer:{marginLeft:2}})),[]);if(!d)return null;let w;return"subitem"===r?w=(0,ue.jsx)(qr,{propertyName:m||v,inversePropertyName:h||f,newDesign:!0}):"timeline_arrows_by"===r?w=(0,ue.jsx)(gs,{propertyName:m||v,inversePropertyName:h||f}):(0,ne.t1)(r),(0,ue.jsxs)(Qo.ZP,{...e,title:(0,ue.jsx)(l.FormattedMessage,{...Lr.dH.advancedSettings}),children:[(0,ue.jsx)("div",{style:b.previewContainer,children:w}),(0,ue.jsxs)(Et.Z,{disableMobileBorders:!0,children:[(0,ue.jsx)(Wa,{currentPropertyId:g,feature:r,onPropertySelect:C,buttonPopupStore:x,collectionContextStore:o,collectionSettingsStore:i,permissionScopes:p,disabled:c&&!p.canConfigureCollection}),"subitem"===r&&y&&(0,ue.jsx)(ys,{collectionContextStore:o,permissionScopes:p})]})]})}function ys(e){window.__c={n:"ToggleNestingOnTitleMenuItem"};const{collectionContextStore:t,permissionScopes:o}=e,i=(0,l.useIntl)(),s=(0,r.O7)(),c=(0,a.VK)((()=>"title"===t.normalizedFormatStore.state.table_subitem_toggle_column),[t]),d=!o.canConfigureBlock,u=(0,n.useCallback)((()=>{const e=t.collectionViewStore();e&&(ls.d1({environment:s,collectionViewStore:e,currentValue:t.normalizedFormatStore.state.table_subitem_toggle_column}),xt.wd({environment:s,collectionContextStore:t,action:"toggle_table_subitem_toggle_on_title"}))}),[t,s]);return(0,ue.jsx)(ds,{showImage:o.canConfigureBlock,caption:i.formatMessage(Lr.dH.toggleNestingOnTitleMenuItemTooltip),tooltipImage:io.Z.images.tooltips.collectionSettings.subitemsToggleOnTitlePng,tooltipImageScale:.3,render:e=>(0,ue.jsx)(Jo.Z,{...e,icon:e=>(0,ss.L)({width:11,height:11,marginRight:5,marginLeft:6,transform:"rotateZ(180deg)"}),onClick:u,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Show nesting toggle on title",id:"database.viewSettings.layoutTab.tableSubitemToggleOnTitle"}),right:(0,ue.jsx)(wr.Z,{disallowTabbing:!0,on:c,disabled:d,onClick:u}),disabled:d})})}var hs=o(40663),fs=o(53787);function xs(e){window.__c={n:"CollectionSettingsViewDependenciesPreview"};const{propertyName:t}=e,o=(0,S.Fg)(),n=(0,S.yK)((e=>({dependenciesPreviewOutsideBorder:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:4,alignItems:"center",position:"relative",height:112,paddingLeft:19},svgContainer:{position:"absolute",width:"100%",height:"100%"},svgArrowTheme:{stroke:e.collectionValidDependencyArrow,strokeWidth:Yr.lf},dependencyPropertyNamePreview:{fontSize:12,position:"absolute",background:e.buttonBackground,top:48,left:96},timelineItemPreview:{padding:4,margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center",borderRadius:5,background:e.cardBackground,boxShadow:e.buttonBoxShadow,width:100,justifyContent:"center"}})),[]);return(0,ue.jsx)(ue.Fragment,{children:(0,ue.jsx)(Et.Z,{children:(0,ue.jsxs)("div",{style:n.dependenciesPreviewOutsideBorder,children:[(0,ue.jsxs)("svg",{style:n.svgContainer,children:[(0,ue.jsx)(ia.Z,{startPoint:{x:110,y:25},endPoint:{x:110,y:87},style:n.svgArrowTheme,showArrowHead:!0}),(0,ue.jsx)(ia.Z,{startPoint:{x:210,y:87},endPoint:{x:223,y:87},style:n.svgArrowTheme,showArrowHead:!1}),(0,ue.jsx)("circle",{cx:223,cy:87,r:Yr.Wk,style:n.svgArrowTheme,fill:o.white})]}),(0,ue.jsx)("div",{style:n.dependencyPropertyNamePreview,children:t}),(0,ue.jsx)("div",{style:{...n.timelineItemPreview,marginTop:10,marginLeft:10},children:(0,ue.jsx)("span",{children:"🌱"})}),(0,ue.jsx)("div",{style:{...n.timelineItemPreview,marginTop:34,marginLeft:111},children:(0,ue.jsx)("span",{children:"🌳"})})]})})})}const vs=(0,l.defineMessages)({subitemInputPlaceholder:{defaultMessage:"Sub-tasks…",id:"database.viewSettings.relationsPropertyTab.subitemInputPlaceholder"},timelineArrowsByInputPlaceholder:{defaultMessage:"Dependencies…",id:"database.viewSettings.relationsPropertyTab.timelineArrowsByInputPlaceholder"}});const Cs=(0,l.injectIntl)((function(e,t){window.__c={n:"CollectionSettingsViewRelationsProperty"};const{collectionContextStore:o,collectionSettingsStore:i,formatSetting:s}=e,c=(0,r.Fy)(),g=(0,l.useIntl)(),m=(0,r.O7)(),y="collection_page_properties",[h]=(0,n.useState)("no_limit"),f="subitem"===s,x="timeline_arrows_by"===s,v=(0,a.VK)((()=>o.databaseType),[o.databaseType]),C=(0,a.VK)((()=>o.normalizedSchemaStore.state),[o]),b=(0,a.VK)((()=>o.collectionStore()),[o]),w=(0,a.VK)((()=>(null==b?void 0:b.getFormat())??{}),[b]),j=(0,a.VK)((()=>{var e;return f?null===(e=o.currentSubitemFormatStore.state)||void 0===e?void 0:e.property:x?o.currentArrowsByFormatStore.state:void 0}),[o,f,x]),M=(0,a.VK)((()=>{var e,t;return f?null===(e=o.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.collection_default_subitem:x?null===(t=o.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.collection_default_arrows_by:void 0}),[o,f,x]),_=(0,a.VK)((()=>o.permissionScopes.state),[o]),k=(0,a.VK)((()=>Gr.NA(o,C)),[o,C]),T=(0,a.VK)((()=>o.normalizedSchemaStore.state),[o]),A=(0,a.VK)((()=>{var e;const t=o.currentSubitemFormatStore.state,n=o.currentArrowsByFormatStore.state;let i;return f?i=t?C[t.property]:void 0:x&&(i=n?C[n]:void 0),null===(e=i)||void 0===e?void 0:e.name}),[o,C,f,x]),P=(0,a.VK)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?Gr.m8(g,{targetCollectionStore:e,isSelfRelation:!0,sourceSchema:T,createUnique:!0,from:s}):g.formatMessage({id:"database.viewSettings.relationsPropertyTab.initialPropertyName.placeholder",defaultMessage:"Related to target"})}),[o,T,g,s]),[V,I]=(0,n.useState)(A||P),B=V===P,Z=(0,a.VK)((()=>{const e=o.currentSubitemFormatStore.state,t=o.currentArrowsByFormatStore.state;let n;if(f?n=e?C[e.property]:void 0:x&&(n=t?C[t]:void 0),n&&"relation"===n.type){var i;const e=n.property;return e?null===(i=C[e])||void 0===i?void 0:i.name:void 0}}),[o,C,f,x]),K=(0,a.VK)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?Gr.aI(g,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:s}):g.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[o,g,s]),D=(0,a.VK)((()=>"title"===o.normalizedFormatStore.state.table_subitem_toggle_column),[o]),[O,R]=(0,n.useState)({hasInverseRelation:!0,inverseName:Z,autoRelate:{enabled:!1}}),[N,E]=(0,n.useState)(0===k.length),W=(0,a.VK)((()=>(0,hs.$4)()),[]),L=(0,a.qz)(void 0,Mn.Z),G=(0,a.Kw)(L),U=(0,n.useCallback)((()=>Gr.NA(o,C)),[o,C]),z=(0,n.useCallback)((e=>{if(e){const t=C[e];if(t&&"relation"===t.type){const e=t.property;if(e){const t=C[e];if(t&&O){const e=t.name;R({hasInverseRelation:null==O?void 0:O.hasInverseRelation,inverseName:e,autoRelate:null==O?void 0:O.autoRelate})}}I(t.name)}}}),[C,O,I]),$=(0,n.useCallback)((e=>{const{collectionViewStore:t,newProperty:o,transaction:n}=e;f?(Nr.dR({collectionViewStore:t,propertyId:o,transaction:n}),(0,Te.o8)(t.getFormat().table_subitem_toggle_column)&&u.FH({stores:[t],update:{table_subitem_toggle_column:"title"},transaction:n})):x&&Da.tF({collectionViewStore:t,newProperty:o,transaction:n})}),[f,x]),q=(0,n.useCallback)((e=>{const{relationPropertyId:t,transaction:n}=e;f&&Nr.jA({environment:m,collectionContextStore:o,relationPropertyId:t,transaction:n}),x&&Da._p({collectionContextStore:o,relationPropertyId:t,transaction:n})}),[f,x,m,o]),X=(0,n.useCallback)((e=>{const t=o.collectionViewStore();t&&(p.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handleDefaultPropertySelect",environment:m,perform:o=>{$({collectionViewStore:t,newProperty:e,transaction:o}),q({relationPropertyId:e,transaction:o})}}),z(e),E(!1),d.E3({collectionSettingsStore:i}),xt.wd({action:f?"update_default_subitem":"update_default_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:m,collectionContextStore:o}))}),[o,m,E,z,i,f,$,q]),Y=(0,n.useCallback)((e=>{const t=o.collectionViewStore();t&&(p.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handlePropertySelect",environment:m,perform:o=>{$({collectionViewStore:t,newProperty:e,transaction:o})}}),z(e),E(!1),d.E3({collectionSettingsStore:i}),xt.wd({action:f?"update_subitem":"update_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:m,collectionContextStore:o}))}),[o,m,z,i,f,$]),Q=(0,n.useCallback)((()=>{Zr.default.afterNextFlush((()=>{E(!0),R({hasInverseRelation:!0,inverseName:K,autoRelate:{enabled:!1}}),I(P)}))}),[K,P]),J=(0,n.useCallback)((()=>{if(!O)return;const{hasInverseRelation:e,inverseName:t,autoRelate:n}=O,r=o.collectionStore(),a=r,l=o.collectionViewStore();r&&a&&(p.createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:m,perform:i=>{const c=va.G3({environment:m,collectionStore:r,collectionViewArgs:l?{collectionViewStore:l,format:l.getFormat(),formatKey:y}:void 0,propertyType:"relation",transaction:i});return Ka.n7({environment:m,collectionContextStore:o,collectionStore:r,property:c,propertyName:V,targetCollectionStore:a,hasInverseRelation:e,inverseName:t,autoRelate:n,propertyLimit:h,intl:g,transaction:i,from:s}),l&&($({collectionViewStore:l,newProperty:c,transaction:i}),q({relationPropertyId:c,transaction:i})),c}}),d.z$({collectionSettingsStore:i}),d.H4({collectionSettingsStore:i,item:{type:"main"}}),xt._H({environment:m,collectionContextStore:o,from:s,property_type:"relation"}))}),[o,m,i,y,g,h,V,O,s,$,q]),ee=(0,n.useCallback)((()=>{const e=o.collectionViewStore();e&&(ls.d1({environment:m,collectionViewStore:e,currentValue:o.normalizedFormatStore.state.table_subitem_toggle_column}),xt.wd({environment:m,collectionContextStore:o,action:"toggle_table_subitem_toggle_on_title"}))}),[o,m]),te=!_.canConfigureBlock,oe=(0,S.yK)((e=>({emptyStateText:{color:e.mediumTextColor,fontSize:14,margin:"0px 12px"},useExistingTitle:{fontSize:12,color:e.mediumTextColor,marginLeft:12,marginTop:12}})),[]);if(!b)return null;const ne=f&&_.canConfigureBlock&&A&&W,ie=_.canConfigureCollection,re=(e,t,n,i)=>(0,ue.jsx)(_a,{version:"v1",menuProps:e,property:t,defaultProperty:M,checkState:n,propertySchema:i,collectionContextStore:o,handleDefaultPropertySelect:X,handlePropertySelect:Y});return(0,ue.jsxs)(Qo.ZP,{...e,title:(0,ue.jsx)(l.FormattedMessage,{...(0,Lr.Gt)({feature:s,databaseType:v})}),footer:(0,ue.jsxs)(Et.Z,{topBorder:k.length>0&&!N,children:[ne&&!N&&(0,ue.jsx)(ds,{showImage:!te,caption:be.default.formatMessage(Lr.dH.toggleNestingOnTitleMenuItemTooltip),tooltipImage:io.Z.images.tooltips.collectionSettings.subitemsToggleOnTitlePng,tooltipImageScale:.3,render:e=>(0,ue.jsx)(Jo.Z,{...e,icon:e=>(0,ss.L)({width:11,height:11,marginRight:5,marginLeft:6,transform:"rotateZ(180deg)"}),title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Show nesting toggle on title",id:"database.viewSettings.layoutTab.tableSubitemToggleOnTitle"}),right:(0,ue.jsx)(wr.Z,{disallowTabbing:!0,on:D,onClick:ee,disabled:te}),disabled:te,isGray:!0,onClick:ee})}),ie&&k.length>0&&!N&&(0,ue.jsx)(Jo.Z,{icon:F.R,title:(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.subitemTab.newRelation",defaultMessage:"Create new relation"}),isGray:!0,onClick:Q}),!N&&(0,ue.jsx)(ue.Fragment,{children:_.canConfigureBlock&&!_.canConfigureCollection?(0,ue.jsx)(Jo.Z,{title:(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.removeSubitemRelation.removeSubitemButton.title",defaultMessage:"Turn off for this view"}),isRed:!0,onClick:()=>Y(void 0)}):_.canConfigureBlock&&(0,ue.jsx)(ut.ZP,{popupType:c.isPhone?Za.kQ.SlideUp:Za.kQ.Popup,alignmentToOrigin:ut.vR.End,placementToOrigin:ut.pO.Bottom,originGap:0,renderOrigin:e=>(0,ue.jsx)(ue.Fragment,{children:!(!_.canConfigureBlock||!j)&&(0,ue.jsx)(Jo.Z,{isGray:!0,icon:jn.y,title:(0,ue.jsx)(l.FormattedMessage,{...(0,Lr.nB)({feature:s,databaseType:v})}),isRed:!0,...e})}),render:e=>{let t;return t=c.isPhone?{menuType:bt.og.ActionSheet}:{menuType:bt.og.Popup,width:300},(0,ue.jsx)(Ct.Z,{...t,footer:(0,ue.jsxs)(Et.Z,{topBorder:!0,children:[_.canConfigureBlock&&(0,ue.jsx)(Jo.Z,{title:(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.removeRelation.removeRelationButton.title",defaultMessage:"Turn off for this view"}),isRed:!0,onClick:()=>Y(void 0)}),_.canConfigureCollection&&(0,ue.jsx)(Jo.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Turn off for all new views",id:"database.viewSettings.relationsPropertyTab.removeRelation.removeAllDefaultButton.title"}),isRed:!0,onClick:()=>{X(void 0)}})]})})}})})]}),children:[f&&(0,ue.jsx)(qr,{propertyName:V||P,inversePropertyName:(null==O?void 0:O.inverseName)||K,newDesign:!1}),x&&(0,ue.jsx)(xs,{propertyName:V||P}),!N&&(0,ue.jsx)("div",{style:oe.useExistingTitle,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Use an existing relation",id:"database.viewSettings.relationsPropertyTab.useExistingRelation.title"})}),k.length>0&&!N?(0,ue.jsx)("div",{style:{paddingBottom:"6px"},children:(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(ut.ZP,{buttonPopupStore:L,render:e=>{let t;return t=c.isPhone?{menuType:bt.og.ActionSheet}:{menuType:bt.og.Popup,width:300},(0,ue.jsx)(Ct.Z,{...t,footer:(0,ue.jsx)(wa.Z,{schema:C,format:w,getProperties:U,onAccept:_.canConfigureBlock&&!_.canConfigureCollection?Y:()=>{},inputPlaceholder:be.default.formatMessage(f?vs.subitemInputPlaceholder:vs.timelineArrowsByInputPlaceholder),currentProperty:j,defaultShowPropertyCount:5,renderProperty:_.canConfigureBlock&&!_.canConfigureCollection?void 0:re})})},renderOrigin:e=>{var t;return(0,ue.jsx)(Jo.Z,{title:(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.existingRelation",defaultMessage:"Property"}),showChevron:!0,right:j?null===(t=C[j])||void 0===t?void 0:t.name:void 0,rotateChevron:G.open,disabled:!1,icon:H.v,...e})},popupType:c.isPhone?Za.kQ.SlideUp:Za.kQ.Popup,alignmentToOrigin:ut.vR.End,placementToOrigin:ut.pO.Bottom,originGap:0})})}):ie&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)("div",{style:oe.emptyStateText,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Rename (optional)",id:"database.viewSettings.relationsPropertyTab.emptyStateDescription"})})}),(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(Nt.ZP,{value:V,placeholder:V,onChange:e=>I(e.target.value),onBlur:()=>{},onSubmit:()=>{},focusInitial:!0,selectAll:!1})}),(0,ue.jsx)(fs.Z,{collectionContextStore:o,targetCollectionStore:b,property:void 0,buttonContents:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Create",id:"database.viewSettings.relationsPropertyTab.createButton.title"}),temporaryInverseState:O,setTemporaryInverseState:R,isInitialPropertyName:B,onSubmit:J,from:s}),k.length>0&&(0,ue.jsx)("div",{style:{margin:"auto",textAlign:"center"},children:(0,ue.jsx)(Tt.Z,{onClick:()=>{Zr.default.afterNextFlush((()=>{E(!1)}))},isGray:!0,style:{margin:"6px 12px 6px 12px",width:"auto"},children:(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.newRelation",defaultMessage:"Use existing relation"})})})]})]})}));var bs=o(98742);function ws(e){window.__c={n:"CollectionSettingsAccountPicker"};const{integration:t,collectionSettingsStore:o,collectionContextStore:n,onAccountSelect:i}=e,s=(0,S.yK)((()=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"}})),[]),c=(0,r.O7)(),u=(0,a.VK)((()=>{var e;return null===(e=n.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[n]),p=(0,a.VK)((()=>{const e=gt.Z.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===t.id)):[]}),[t]);return t&&u?(0,ue.jsx)(Qo.ZP,{...e,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Choose an account",id:"collectionSettingsAccountPicker.title"}),footer:js({environment:c,integration:t,spaceId:u}),children:(0,ue.jsx)("div",{style:s.settingsMenu,children:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,initialFocus:0,sections:[{key:"externalAuthentications",items:p.map((e=>({key:e.id,render:o=>(0,ue.jsx)(re.Z,{renderTooltip:()=>(0,ue.jsx)("span",{children:e.account_name}),placement:re.Z.Placement.Left,textWrap:!0,render:n=>(0,ue.jsx)(Rt.Z,{...(0,bs.Z)(n||{},o),title:e.account_name,icon:(0,ue.jsx)("img",{style:{width:18},src:t.info.icon}),focused:o.focused})}),action:()=>{d.z$({collectionSettingsStore:o}),i(e)}}))),render:e=>(0,ue.jsx)(Et.Z,{...e})}]})})}):null}function js(e){const t=e.environment.device.isMobileBrowser;return(0,ue.jsx)(Et.Z,{topBorder:!0,children:t?void 0:Ms(e)})}function Ms(e){return(0,ue.jsx)(Jo.Z,{...e,icon:F.R,title:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettingsAccountPicker.addAccount",defaultMessage:"Connect another account"}),isGray:!0,onClick:async()=>{await lo.hM({...e,from:"source_picker_connect_another_account"})}})}var _s=o(8848),ks=o(58573),Ts=o(59054),As=o(20270),Ps=o(64002),Vs=o(14871),Fs=o(61202),Is=o(70764),Bs=o(75079);function Zs(e){window.__c={n:"CollectionSettingsAccountSelectionIndicator"};const{onClick:t,integration:o,accountName:n}=e,i=(0,S.yK)((e=>({accountSelection:{padding:"8px",borderTop:`1px solid ${e.regularDividerColor}`,cursor:"pointer"},accountSelectionLabel:{fontWeight:ie.Z.fontWeight.medium,paddingLeft:4,paddingTop:4}})),[]);return(0,ue.jsx)("div",{style:i.accountSelection,children:(0,ue.jsxs)("div",{onClick:t,children:[(0,ue.jsx)(Hr.Z,{isSecondaryColor:!0,isSmall:!0,style:i.accountSelectionLabel,children:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.currentAccountSection.label",defaultMessage:"Connected to {integration}",values:{integration:o.name}})}),(0,ue.jsx)(re.Z,{renderTooltip:()=>(0,ue.jsx)("span",{children:n}),placement:re.Z.Placement.Left,textWrap:!0,render:t=>(0,ue.jsx)(Rt.Z,{showExtensionArrow:!0,focused:!1,...(0,bs.Z)(t||{},e),title:n,icon:(0,ue.jsx)("img",{style:{width:18},src:o.info.icon})})})]})})}var Ks=o(29109),Ds=o(1634);function Os(e){window.__c={n:"CollectionSettingsExternalAuthentication"};const{collectionContextStore:t,integration:o}=e,n=(0,S.Fg)(),i=(0,a.VK)((()=>t.collectionStore()),[t]),s=(0,a.VK)((()=>null==i?void 0:i.getIcon()),[i]),c=(0,r.O7)(),d=(0,a.VK)((()=>{var e;return null===(e=po.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),u=(0,S.yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"},authenticationBody:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",padding:"0px 16px 16px 16px",textAlign:"center"},settingsMenuSubHeading:{display:"inline",fontSize:14,margin:"4px 20px 20px 20px",color:e.mediumTextColor,textAlign:"center"},settingsMenuAuthenticationButton:{fontSize:14,height:32,color:e.regularInvertedTextColor}})),[]),{background:p,hoveredBackground:g,pressedBackground:m}=(0,Ks.d)(o,n.mode);return(0,ue.jsx)(Qo.ZP,{...e,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateHeader.title",values:{integration:o.name}}),children:(0,ue.jsx)("div",{style:u.settingsMenu,children:(0,ue.jsxs)("div",{style:u.authenticationBody,children:[(0,ue.jsx)(ai.Z,{disabled:!0,bucket:"secure",store:i,icon:s,size:40,isEmptyPage:!1,style:{marginBottom:6}}),(0,ue.jsx)("div",{style:u.settingsMenuSubHeading,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Link your {integration} account for richer content previews and seamless imports.",id:"collectionSettingsCreateExternalViewPicker.authenticateBody.title",values:{integration:o.name}})}),(0,ue.jsx)(Tt.Z,{onClick:()=>{d&&(lo.hM({environment:c,integration:o,spaceId:d,from:"placeholder_root_external_collection_view_block"}),Ds.Z.reset())},style:{background:p,...u.settingsMenuAuthenticationButton},hoveredStyle:{background:g},pressedStyle:{background:m},children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateButton.title",values:{integration:o.name}})})]})})})}var Rs=o(33338),Ns=o(53336);function Es(e){window.__c={n:"CollectionSettingsCreateExternalViewPicker"};const{collectionSettingsStore:t,collectionContextStore:o,externalAuthentication:n}=e,i=(0,a.VK)((()=>o.collectionStore()),[o]),r=(0,a.VK)((()=>{if(!i)return;const e=i.getFormat().integration_id;return gt.Z.integrations.state.find((t=>t.id===e))}),[i]),s=(0,a.VK)((()=>!!r&&(0,Is.NP)(r.id).length>0),[r]),l=(0,a.VK)((()=>{var e;return null===(e=po.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit()}),[]);return i&&l&&r?(0,ue.jsx)(ue.Fragment,{children:s?(0,ue.jsx)(Gs,{...e,collectionContextStore:o,collectionSettingsStore:t,integration:r,externalAuthentication:n}):(0,ue.jsx)(Os,{...e,collectionContextStore:o,collectionSettingsStore:t,integration:r})}):null}const Ws=e=>{var t;return null===(t=e.integration.info)||void 0===t||null===(t=t.original_url_patterns)||void 0===t?void 0:t.filter((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.collection})).find((t=>{let{regex:o}=t;return new RegExp(o).test(e.url)}))},Ls=(0,l.defineMessages)({all:{id:"collectionSettingsCreateExternalViewPicker.filters.all",defaultMessage:"All"},issues:{id:"collectionSettingsCreateExternalViewPicker.filters.issues",defaultMessage:"Issues"},pull_requests:{id:"collectionSettingsCreateExternalViewPicker.filters.pullRequests",defaultMessage:"Pull Requests"},board:{id:"collectionSettingsCreateExternalViewPicker.filters.boards",defaultMessage:"Boards"},project:{id:"collectionSettingsCreateExternalViewPicker.filters.projects",defaultMessage:"Projects"},Releases:{id:"collectionSettingsCreateExternalViewPicker.filters.releases",defaultMessage:"Releases"},"Pull Request":{id:"collectionSettingsCreateExternalViewPicker.filters.PullRequests",defaultMessage:"Pull Requests"},Issues:{id:"collectionSettingsCreateExternalViewPicker.filters.Issues",defaultMessage:"Issues"}});function Gs(e){window.__c={n:"CollectionSettingsSourceSelection"};const{integration:t,collectionContextStore:o,collectionSettingsStore:i,externalAuthentication:s}=e,[u,p]=(0,n.useState)(""),g=(0,a.VK)((()=>{const e=gt.Z.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===t.id)):[]}),[t]),m=(0,a.VK)((()=>s||(g.length?g[0]:null)),[g,s]),[y,h]=(0,n.useState)(!1),[f,x]=(0,n.useState)(null),v=(0,S.yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px"},settingsMenuSearchBox:{background:e.contentBackground,marginBottom:10},syncSourceButton:{width:"100%",display:"flex",justifyContent:"center"},noResults:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:e.mediumTextColor},suggestionBox:{display:"flex",alignItems:"center",fontSize:12,color:_s.ZP.white,background:_s.ZP.blue,borderRadius:6,padding:10,boxShadow:e.largeLightBoxShadow,alignSelf:"center",maxWidth:"80%"},errorMessage:{alignSelf:"center",padding:10,fontSize:14,color:e.errorText},syncingData:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:e.mediumTextColor},filterContainer:{position:"relative",flexGrow:0,overflow:"hidden"},filterContainerScroller:{display:"flex",alignItems:"center",padding:"8px 12px"}})),[]),C=(0,a.VK)((()=>o.collectionStore()),[o]),b=(0,a.VK)((()=>o.collectionViewBlockStore()),[o]),w=(0,r.O7)(),[{value:j,status:M}]=(0,Ts.r5)((async()=>{if(!m)return;const e=m.parent_id;return bo.listExternalCollections(w,{bot_id:e})}),[w,m]),_="success"===(null==j?void 0:j.type)&&"data"in j.data?j.data.data:[],k="success"===(null==j?void 0:j.type)&&"error"in j.data?j.data.error:null,T=_.filter((e=>!f||e.type===f)),A=T.length?(0,ks.ZP)(u,T,(e=>e.title)):[],P=Array.from(new Set(_.map((e=>e.type)))),V=Ws({integration:t,url:u}),F=async e=>{if(h(!0),!C||!b)return;const n=e||u,r=Ws({integration:t,url:n});if(!r)return h(!1),void an.showDialog({items:[{label:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information"}),color:"blue",onAccept:()=>{Vs.RD({environment:w,stringValue:JSON.stringify({botId:null==m?void 0:m.parent_id,url:n},null,2),copiedMessage:Vs.tq.copiedToClipboard})}},{label:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close"}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source."})});const a=(0,Is.NP)(t.id);await Fs.UY({environment:w,url:n,botIds:a.map((e=>e.id)),externalCollectionStore:C,externalCollectionViewBlockStore:b});const{host:s}=(0,Ps.Qc)(n);c.Mp(w,{...(0,Bs.Pn)(o),integrationId:t.id,type:"collection",entity:r.name,domain:s||"",from:"external_picker_settings"}),d.wl({collectionSettingsStore:i,item:{type:"shareSyncedView",integrationName:t.name,integrationIcon:t.info.icon}}),h(!1)};if(!C||!b)return null;const I=P.length>1?(0,ue.jsx)("div",{style:v.filterContainer,children:(0,ue.jsxs)(Ns.Z,{type:Vr.Z.X,style:v.filterContainerScroller,showLeftRightOverlay:!1,children:[(0,ue.jsx)(Rs.Z,{title:(0,ue.jsx)("span",{children:be.default.formatMessage(Ls.all)}),on:!(0,ne.K0)(f),hideChevron:!0,onClick:e=>{(0,Pr.ZP)({event:e,context:Pr.Af.CollectionSettingsClick,callback:()=>{x(null)}})}},"all"),P.map((e=>(0,ue.jsx)(Rs.Z,{title:(0,ue.jsx)("span",{children:be.default.formatMessage(Ls[e])}),on:f===e,hideChevron:!0,onClick:t=>{(0,Pr.ZP)({event:t,context:Pr.Af.CollectionSettingsClick,callback:()=>{x((t=>t===e?null:e))}})}},e)))]})}):null,B=V?(0,ue.jsx)("div",{style:v.syncSourceButton,children:(0,ue.jsx)(co.Z,{isLarge:!0,onClick:e=>{(0,Pr.ZP)({event:e,context:Pr.Af.CollectionSettingsClick,callback:()=>{F()}})},disabled:!1,children:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.syncSourceButton.label",defaultMessage:"Sync Source"})})}):null,Z=V||_.length&&A.length?null:(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)("div",{style:v.noResults,children:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.noResults.text",defaultMessage:"No results"})}),(0,ue.jsxs)("div",{style:v.suggestionBox,children:[(0,Or.D)({marginRight:8,width:14,height:14}),(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Try different search or paste any {integration} URL",id:"collectionSettingsCreateExternalViewPicker.noResults.help",values:{integration:t.name}})]})]}),K=_.length&&A.length?(0,ue.jsx)(ue.Fragment,{children:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,initialFocus:0,sections:[{key:"collections",items:A.map((e=>({key:e.url,render:t=>(0,ue.jsx)(re.Z,{renderTooltip:()=>(0,ue.jsx)("span",{children:e.title}),placement:re.Z.Placement.Left,textWrap:!0,render:o=>(0,ue.jsx)(Rt.Z,{...(0,bs.Z)(o||{},t),title:e.title,icon:(0,ue.jsx)("img",{style:{width:18},src:e.icon}),caption:e.parent.title})}),action:t=>{"stopPropagation"in t.event&&t.event.stopPropagation(),F(e.url)}}))),render:e=>(0,ue.jsx)(Et.Z,{...e,disableMobilePadding:!0})}]})}):null,D="pending"===M||"idle"===M||y;if(!m||k&&(k.status===As.mQ.UNAUTHORIZED||k.status===As.mQ.FORBIDDEN))return(0,ue.jsx)(Os,{collectionContextStore:o,collectionSettingsStore:i,integration:t});const O="rejected"===M||"failed"===(null==j?void 0:j.type)||k,R=(0,ue.jsx)(Zs,{onClick:()=>{d.H4({collectionSettingsStore:i,item:{type:"selectAccountForExternalSource",integration:t,onAccountSelect:e=>{d.H4({collectionSettingsStore:i,item:{type:"createSyncedViewSource",externalAuthentication:e}})}}})},integration:t,accountName:m.account_name});return(0,ue.jsx)(Qo.ZP,{...e,footer:B||y?null:R,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Select from {integration}",id:"collectionSettingsCreateExternalViewPicker.title",values:{integration:t.name}}),header:!D&&"resolved"===M&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(Nt.ZP,{inputLeft:(0,ue.jsx)(Nt.f_,{icon:Co.R}),onSubmit:()=>{V&&F()},style:v.settingsMenuSearchBox,focusInitial:!0,value:u,onChange:e=>{p(e.target.value)},placeholder:"Search source or paste a link..."}),V?null:I]}),children:(0,ue.jsxs)("div",{style:v.settingsMenu,children:[O&&(0,ue.jsx)("div",{style:v.errorMessage,children:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.error.unknown",defaultMessage:"Something went wrong.",values:{integration:t.name}})}),D&&(y?(0,ue.jsxs)("div",{style:v.syncingData,children:[(0,ue.jsx)("span",{children:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.settingUpSync",defaultMessage:"Setting up sync..."})}),(0,ue.jsx)(To.Z,{style:{alignSelf:"center"}})]}):(0,ue.jsxs)("div",{style:v.syncingData,children:[(0,ue.jsx)("span",{children:(0,ue.jsx)(l.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.loadingData",defaultMessage:"Loading available sources..."})}),(0,ue.jsx)(To.Z,{style:{alignSelf:"center"}})]})),!D&&"resolved"===M&&(0,ue.jsxs)(ue.Fragment,{children:[B,Z,K]})]})})}var Us=o(26263),zs=o(92996),Hs=o(93108),$s=o(38715),qs=o(75081),Xs=o(26122);function Ys(e){window.__c={n:"CollectionSettingsCreateTypedDB"};const t=(0,S.Fg)(),o=(0,r.O7)(),i=o.device,[s,c]=(0,n.useState)(zs.br),[u,g]=(0,n.useState)(),m=(0,n.useMemo)((()=>St.default.createValue("")),[]),y=(0,n.useMemo)((()=>new Us.Z({name:"CollectionSettingsCreateTypedDB"})),[]),h=(0,a.VK)((()=>{const t=e.collectionContextStore.collectionStore();if(t)return t.clone(y).getIcon()}),[e.collectionContextStore,y]);(0,n.useEffect)((()=>{var t;void 0===u&&g(null===(t=e.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.getType())}),[e.collectionContextStore,u]),(0,n.useEffect)((()=>{const e=o.defaultRecordCache.inMemoryRecordCache;return e.addCacheOverride(y),()=>{e.removeCacheOverride(y)}}),[o,y,e.collectionContextStore]);const f=(0,n.useCallback)((e=>{m.setState(e)}),[m]),x=(0,n.useCallback)(((t,n)=>{const{collectionContextStore:i}=e,r=i.collectionViewStore(),a=i.collectionViewBlockStore();r&&a&&d.nr({environment:o,baseViewType:u,selectedDBType:n,collectionName:m.state,collectionContextStore:i,collectionViewBlockStore:a,collectionViewStore:r,useTemporaryRecordCache:t,temporaryRecordCache:y})}),[e,u,o,m,y]);(0,n.useEffect)((()=>{x(!0,zs.br)}),[x]);const v=(0,n.useCallback)((t=>{const{collectionContextStore:o}=e;c(t),x(!0,t),Ca.Ip({collectionContextStore:o})}),[e,x]);const C=(0,n.useCallback)((t=>{var n;const i=null===(n=e.collectionContextStore.collectionStore())||void 0===n?void 0:n.getIconStore().clone(y);i&&p.createAndCommit({userAction:"SpacePermissionGroup.handleIconChange",environment:o,perform:e=>{sn.sO({store:i,value:t,transaction:e})}})}),[e.collectionContextStore,o,y]),b=(0,n.useCallback)((t=>{(0,Pr.ZP)({event:t,context:Pr.Af.CollectionSettingsClick,callback:()=>{const{collectionSettingsStore:t}=e;an.showDialog({message:(0,ue.jsx)("span",{children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Would you like to continue creating this database?",id:"collectionSettingsNewDatabase.confirmDialog.prompt"})}),showCancel:!1,keepFocus:!1,items:[{label:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Yes create {selectedType, select, untyped {an {type}} other {a {type}}} database",values:{selectedType:s,type:s===zs.br?"empty":(0,qs.Mn)(s)},id:"collectionSettingsNewDatabase.confirmDialog.affirmativeButton.label"}),color:"red",onAccept:()=>{x(!1,s),d.E3({collectionSettingsStore:t})}},{label:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Cancel",id:"collectionSettingsNewDatabase.confirmDialog.cancel.label"}),color:"blue",onAccept:()=>{}}]})}})}),[e,s,x]),w=(0,n.useCallback)((()=>{o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(y);const{collectionContextStore:t,collectionSettingsStore:n}=e,i=t.collectionViewBlockStore(),r=t.collectionViewStore();void 0!==i&&void 0!==r&&(t.setContext({type:"collectionView",collectionViewBlockStore:i,collectionStore:void 0,collectionViewStore:r}),d.H4({collectionSettingsStore:n,item:{type:"createViewSource"}}))}),[o,e,y]);return(0,ue.jsxs)(Qo.ZP,{...e,handleClose:b,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"New database",id:"database.viewSettings.createTypedDBTab.title"}),footer:(0,ue.jsxs)(Et.Z,{topBorder:!0,children:[(0,ue.jsx)(Jo.Z,{icon:Hs.p,isGray:!0,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"View an existing database",id:"database.viewSettings.createTypedDBTab.viewExistingDatabaseButton"}),onClick:w}),(0,ue.jsx)(Jo.Z,{icon:$s.N,isGray:!0,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Import or sync from",id:"database.viewSettings.createTypedDB.importDatabaseButton"})})]}),children:[(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(Xs.Z,{initialValue:"",placeholder:(0,qs.Mn)(s),inputStore:m,onBlur:f,onSubmit:f,iconButton:{icon:e=>(0,ue.jsx)(ai.Z,{isEmptyPage:!0,disabled:!0,defaultIcon:(0,zs.T)(s)({width:16,height:16,backfaceVisibility:void 0,marginRight:6}),icon:h,size:16}),onSubmit:C,includeEmojiTab:!0}})}),(0,ue.jsxs)("div",{style:{...!i.isMobile&&{width:"100%",paddingLeft:8,paddingRight:8},...i.isMobile&&{background:t.contentBackground,width:"100%",paddingTop:12,paddingBottom:12}},children:[(0,ue.jsx)("div",{style:{display:"flex",flexFlow:"wrap",justifyContent:"center"},children:zs.Cr[zs.TM].map((function(e){return(0,ue.jsx)(Qs,{dbType:e,isCurrentType:s===e,onClick:()=>v(e)})}))}),(0,ue.jsx)(co.Z,{style:{display:"flex",margin:"14px",height:32},onClick:function(){const{collectionSettingsStore:t}=e;x(!1,s),d.E3({collectionSettingsStore:t})},children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Create database",id:"database.viewSettings.createTypedDB.createDatabase"})})]})]})}function Qs(e){window.__c={n:"CollectionSettingsTypedDBButton"};const{dbType:t,onClick:o,isCurrentType:n}=e,i=(0,S.Fg)();return(0,ue.jsxs)(An.Z,{style:{display:"flex",width:"95%",height:45,flexGrow:0,flexShrink:0,fontSize:11,borderRadius:4,margin:6,padding:6,boxShadow:`0 0 0 1px ${i.regularDividerColor}`,color:i.mediumTextColor,fill:i.mediumTextColor,...n&&{boxShadow:`0 0 0 2px ${i.blueColor}`,color:i.blueColor,fill:i.blueColor,fontWeight:500}},disabled:n,onClick:o,children:[(0,ue.jsx)("div",{children:(0,zs.T)(t)({...n&&{fill:i.blueColor,color:i.blueColor},width:17,height:17,marginBottom:4,marginTop:4,marginLeft:4})}),(0,ue.jsxs)("div",{style:{position:"relative",width:"100%",marginLeft:12},children:[(0,ue.jsx)("span",{style:{position:"absolute",fontSize:13,fontWeight:500},children:(0,qs.Mn)(t)}),(0,ue.jsx)("span",{style:{position:"absolute",top:15,fontSize:12,marginTop:1},children:(0,ue.jsx)(l.FormattedMessage,{...zs.LI[t].caption})})]})]})}var Js=o(79362),el=o(23877),tl=o(92165),ol=o(80881),nl=o(44643),il=o(6637),rl=o(89036),al=o(93644),sl=o(87990),ll=o(13495),cl=o(27714),dl=o(62208),ul=o(12677),pl=o(84199),gl=o(94110),ml=o(33507),Sl=o(37888),yl=o(58188),hl=o(72711),fl=o(28020),xl=o(95697),vl=o(39927),Cl=o(36821),bl=o(15047),wl=o(29369),jl=o(77907);const Ml=[1,2,3,4,5,6,7,8],_l={1:{key:"one_week",value:1},2:{key:"two_weeks",value:2},3:{key:"three_weeks",value:3},4:{key:"four_weeks",value:4},5:{key:"five_weeks",value:5},6:{key:"six_weeks",value:6},7:{key:"seven_weeks",value:7},8:{key:"eight_weeks",value:8}},kl={MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday",SU:"Sunday"},Tl=(0,l.defineMessages)({sprintsMenuTitle:{id:"sprintSettingsMenu.label",defaultMessage:"Sprints"},setupSprintsTitle:{id:"sprintSettingsMenu.setupSprints.label",defaultMessage:"Set up sprints"},setupSprintsCaption:{id:"sprintSettingsMenu.setupSprints.caption",defaultMessage:"Use sprints to regularly tackle a group of tasks in a recurring, set amount of time."},setupSprintsTeamspaceStatement:{id:"sprintSettingsMenu.setupSprintsTeamspaceStatement.caption",defaultMessage:"We'll also add to your teamspace:"},setupSprintsSprintBoardPageStatement:{id:"sprintSettingsMenu.setupSprintsSprintBoardPageStatement.caption",defaultMessage:"<bold>Sprint board page</bold>: To manage the tasks in each sprint"},setupSprintsSprintsDatabaseStatement:{id:"sprintSettingsMenu.setupSprintsSprintsDatabaseStatement.caption",defaultMessage:"<bold>Sprints database</bold>: To keep a historical record of sprints"},on:{id:"sprintSettingsMenu.on.label",defaultMessage:"On"},off:{id:"sprintSettingsMenu.off.label",defaultMessage:"Off"},completeSprintNextSprintActionMenuOptionText:{id:"sprintSettingsMenu.remainingTasks.moveToNextSprintOption.label",defaultMessage:"Move to next sprint"},completeSprintNextSprintActionSelectedText:{id:"sprintSettingsMenu.remainingTasks.moveToNextSprintOption.selected.label",defaultMessage:"Next sprint"},completeSprintBacklogActionMenuOptionText:{id:"sprintSettingsMenu.remainingTasks.moveToBacklogOption.label",defaultMessage:"Move to backlog"},completeSprintBacklogActionSelectedText:{id:"sprintSettingsMenu.remainingTasks.moveToBacklogOption.selected.label",defaultMessage:"Backlog"},completeSprintKeepInCurrentSprintActionMenuOptionText:{id:"sprintSettingsMenu.remainingTasks.keepInCurrentSprint.label",defaultMessage:"Keep in current sprint"},completeSprintKeepInCurrentSprintActionSelectedText:{id:"sprintSettingsMenu.remainingTasks.keepInCurrentSprint.selected.label",defaultMessage:"Current sprint"},automatedSprintsToggleTitle:{id:"sprintSettingsMenu.automatedSprintsToggle.label",defaultMessage:"Automated sprints"},automatedSprintsToggleCaption:{id:"sprintSettingsMenu.automatedSprintsToggle.caption",defaultMessage:"Sprints complete automatically before the start of the next sprint."},duration:{id:"sprintSettingsMenu.duration.label",defaultMessage:"Duration"},durationMenuOptionText:{id:"sprintSettingsMenu.duration.option.label",defaultMessage:"{durationValue, plural, one {1 week} other {{durationValue} weeks}}"},startOn:{id:"sprintSettingsMenu.startOn.label",defaultMessage:"Start on"},weekdayOption:{id:"sprintSettings.weekdayOption.label",defaultMessage:"{weekdayName}s"},incompleteTasks:{id:"sprintSettingsMenu.incompleteTasks.label",defaultMessage:"Incomplete tasks"},turnOnSprints:{id:"sprintSettingsMenu.turnOnSprints.button.label",defaultMessage:"Turn on sprints"},turnOffSprints:{id:"sprintSettingsMenu.turnOffSprints.button.label",defaultMessage:"Turn off sprints"},turnOffSprintsModalTitle:{id:"sprintSettingsMenu.turnOffSprints.modal.title.label",defaultMessage:"Turn off sprints?"},turnOffSprintsModalNoSprintBoardsDescription:{id:"sprintSettingsMenu.turnOffSprints.modal.default.description",defaultMessage:"This will delete your sprints database and its linked views."},turnOffSprintsModalWithSprintBoardsDescription:{id:"sprintSettingsMenu.turnOffSprints.modal.withSprintBoards.description",defaultMessage:"This will delete your sprint board(s), sprints database and its linked views."},turnOffAndDeleteModalButton:{id:"sprintSettingsMenu.turnOffAndDeleteModal.button.label",defaultMessage:"Turn off and delete"}}),Al={complete_sprint_and_move_incomplete_tasks_to_next_sprint:{menuOptionText:Tl.completeSprintNextSprintActionMenuOptionText,selectedText:Tl.completeSprintNextSprintActionSelectedText},complete_sprint_and_move_incomplete_tasks_to_backlog:{menuOptionText:Tl.completeSprintBacklogActionMenuOptionText,selectedText:Tl.completeSprintBacklogActionSelectedText},complete_sprint:{menuOptionText:Tl.completeSprintKeepInCurrentSprintActionMenuOptionText,selectedText:Tl.completeSprintKeepInCurrentSprintActionSelectedText}};function Pl(e){return(0,ue.jsx)(l.FormattedMessage,{...Al[e.completeSprintAction].menuOptionText})}function Vl(e){return(0,ue.jsx)(l.FormattedMessage,{...Al[e.completeSprintAction].selectedText})}function Fl(e){const{weekday:t}=e;return(0,ue.jsx)(l.FormattedMessage,{...Tl.weekdayOption,values:{weekdayName:kl[t]}})}function Il(e){return _l[e]}function Bl(e){const{sprintDurationValue:t}=e;return(0,ue.jsx)(l.FormattedMessage,{...Tl.durationMenuOptionText,values:{durationValue:_l[t].value}})}function Zl(e){const{numOfSprintBoards:t}=e;return t>0?(0,ue.jsx)(l.FormattedMessage,{...Tl.turnOffSprintsModalWithSprintBoardsDescription}):(0,ue.jsx)(l.FormattedMessage,{...Tl.turnOffSprintsModalNoSprintBoardsDescription})}function Kl(e){const{collectionContextStore:t}=e,o=(0,r.O7)(),i=(0,a.VK)((()=>nn.default.checkGate("recurring_sprints")),[]),s=(0,a.VK)((()=>t.sprintSettingsContext.state),[t.sprintSettingsContext]);n.useEffect((()=>{(()=>{if(!s||!i)return;const e=s.taskCollectionStore,t=s.sprintCollectionStore,n=s.automationContext;t&&!n&&p.createAndCommit({userAction:"useSprintSettings.ensureCompleteSprintAutomation",environment:o,perform:n=>{Cl.ae({environment:o,transaction:n,sprintCollectionStore:t,taskCollectionStore:e,sprintSettingsConfig:vl.i})}})})()}),[]);const l=(0,a.VK)((()=>{if(s)return function(e){const{sprintCollectionStore:t,taskCollectionStore:o,automationContext:n}=e;if(!o.canEditCollection())return;const i=Boolean(null==t?void 0:t.canEditCollection());return!t||i?!t||i&&!n?"displayOff":i&&n?"displayOn":void 0:void 0}(s)}),[s]),c=(0,a.VK)((()=>{var e,t,o;if(!s)return;const n=(null===(e=s.automationContext)||void 0===e||null===(e=e.automationActionStore.getConfig())||void 0===e?void 0:e.complete_sprint_action)??vl.i.actionConfig.complete_sprint_action,i="active"===(null===(t=s.automationContext)||void 0===t?void 0:t.automationStore.getStatus()),r=null===(o=s.automationContext)||void 0===o?void 0:o.automationStore.getRecurrence();return{autoCompleteSprints:i,actionConfig:{complete_sprint_action:n},recurrenceConfig:{interval:(null==r?void 0:r.interval)??vl.i.recurrenceConfig.interval,weekdays:(null==r?void 0:r.weekdays)??vl.i.recurrenceConfig.weekdays}}}),[s]),d=n.useCallback((e=>{p.createAndCommit({userAction:"useSprintSettings.updateSprintSettingsConfig",environment:o,perform:t=>{s&&s.sprintCollectionStore&&s.automationContext&&c&&Cl.nn({transaction:t,automationStore:s.automationContext.automationStore,actionStore:s.automationContext.automationActionStore,sprintSettingsConfig:{...c,...e}})}})}),[o,c,s]),u=n.useCallback((async()=>{await Cl.ys({environment:o,collectionContextStore:t})}),[t,o]),g=n.useCallback((async e=>{s&&await Cl.m8({environment:o,collectionContextStore:t,sprintSettingsContext:s,sprintBoardViewBlockIds:e})}),[t,o,s]);return{sprintSettingsConfig:c,sprintSettingsDisplayState:l,handleSprintSettingsConfigChange:d,turnOnSprints:u,turnOffSprints:g}}var Dl=o(52489);function Ol(e){window.__c={n:"CollectionContentOnlyEditorEducationPill"};const{style:t}=e,o=(0,S.Fg)(),n=(0,r.MO)(),i=(0,ue.jsx)("div",{style:{marginTop:1},children:(0,ct.b)({width:14,marginRight:8,height:void 0})}),a=(0,ue.jsx)(Hr.Z,{style:{color:o.regularTextColor,lineHeight:ie.Z.lineHeight.UISmall.desktop},isSmall:!0,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"You're a content editor",id:"database.viewSettings.mainTab.contentOnlyEditorPill.title"})});return(0,ue.jsx)(zr,{icon:i,title:a,style:n?{backgroundColor:o.sidebarBackground,boxShadow:o.plainButtonBoxShadow,margin:void 0,borderRadius:void 0,...t}:{background:"rgba(196, 196, 196, 0.13)",margin:"8px 14px",...t},showCloseButton:!1,children:(0,ue.jsx)(Hr.Z,{style:{marginLeft:22},isSmall:!0,isMultiline:!0,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Content editors can edit pages, but cannot change view and database settings.",id:"database.viewSettings.mainTab.contentOnlyEditorPill.subtitle"})})})}var Rl=o(40745),Nl=o(13709);class El extends i.Z{constructor(){super(...arguments),this.handleFirstLoadLimitChange=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&(p.createAndCommit({userAction:"CollectionSettingsFirstLoadLimit.handleFirstLoadLimitChange",environment:this.environment,perform:t=>{u.FH({stores:[o],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),xt.wd({environment:this.environment,collectionContextStore:t,action:"set_first_load_limit"}))}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=e.isFullScreen.state,n=function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(this.props.collectionContextStore);if(!(t.collection_group_by||!o&&"calendar"!==n))return;const i=function(e){const t=e.normalizedFormatStore.state;return(0,Aa.rx)(t.inline_collection_first_load_limit,Boolean(t.collection_group_by))}(this.props.collectionContextStore),r=e.permissionScopes.state;return(0,ue.jsx)(Nl.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Load limit",id:"database.viewSettings.layoutTab.firstLoadLimitSetting"}),selectedKey:i,popupStyle:{minWidth:190},options:Aa.jk.map((e=>({key:e,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:e.limit},id:"database.viewSettings.layoutTab.limitPagesTitle"})}))),onChange:this.handleFirstLoadLimitChange,disabled:!r.canConfigureBlock,icon:Rl.M})}}El.displayName="CollectionSettingsFirstLoadLimit";const Wl=(0,l.injectIntl)(El);var Ll=o(35011),Gl=o(14714),Ul=o(49865),zl=o(81849),Hl=o(18514),$l=o(26055),ql=o(75498),Xl=o(21269),Yl=o(79131),Ql=o(5145),Jl=o(28992),ec=o(97820);class tc extends i.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:St.default.createClass(void 0),groupsLimit:St.default.createClass(zl.XD)},this.handleHideEmptyGroupsClick=()=>{const{groupByKey:e,collectionContextStore:t,groupsFormatKey:o}=this.props,n=yc(this.props.collectionContextStore,this.props.groupByKey),i=this.groupsDisplayStateStore.state;if(!i)return;const{currentGroups:r}=i,a=t.collectionViewStore();if(!n||!a)return;const s=!n.hideEmptyGroups;p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleHideEmptyGroupsClick",environment:this.environment,perform:i=>{if(s){const e=r.map((e=>!1===e.hidden?{...e,hidden:void 0}:e));Ul.A6({collectionContextStore:t,newGroups:e,groupsFormatKey:o,transaction:i})}u.FH({stores:[a],update:{[e]:{...n,hideEmptyGroups:s}},transaction:i})}}),xt.wd({environment:this.environment,collectionContextStore:t,action:"toggle_hide_empty_groups"})},this.handleHideAllClick=()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=this.groupsDisplayStateStore.state;if(!o)return;const{currentGroups:n}=o,i=n.map((e=>({...e,hidden:!0})));this.stores.groupsLimit.setState(zl.XD),p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleHideAllClick",environment:this.environment,perform:o=>{Ul.A6({collectionContextStore:e,newGroups:i,groupsFormatKey:t,transaction:o})}}),xt.wd({environment:this.environment,collectionContextStore:e,action:"click_groups_hide_all"})},this.handleShowAllClick=()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=this.groupsDisplayStateStore.state;if(!o)return;const{currentGroups:n}=o,i=n.map((e=>({...e,hidden:!1})));this.stores.groupsLimit.setState(zl.XD),p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleShowAllClick",environment:this.environment,perform:o=>{Ul.A6({collectionContextStore:e,newGroups:i,groupsFormatKey:t,transaction:o})}}),xt.wd({environment:this.environment,collectionContextStore:e,action:"click_groups_show_all"})},this.handleGroupReorder=(e,t)=>{const{collectionContextStore:o,groupsFormatKey:n}=this.props,i=this.groupsDisplayStateStore.state;if(!i)return;const{currentGroups:r}=i,a=r.filter((t=>e.indexOf((0,Gl.mD)(t))<0)),s=r.filter((t=>e.indexOf((0,Gl.mD)(t))>=0)),l=Te.MR(s,(t=>{const o=e.indexOf((0,Gl.mD)(t));return o>=0?o:1/0})),d=t?[...a,...l]:[...l,...a];p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleGroupReorder",environment:this.environment,perform:e=>{Ul.A6({collectionContextStore:o,newGroups:d,groupsFormatKey:n,transaction:e})}}),c.wds(this.environment,{view_type:Sc(this.props.collectionContextStore),action:t?"reorder_hidden_groups":"reorder_groups"})},this.handleToggleGroupVisibility=e=>{const{collectionContextStore:t,groupsFormatKey:o}=this.props,n=this.groupsDisplayStateStore.state;if(!n)return;const{currentGroups:i}=n,r=i.map((t=>(0,Gl.ZH)(t,e)?{...e,hidden:!(0,Gl.eF)(e)}:t));p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleToggleGroupVisibility",environment:this.environment,perform:e=>{Ul.A6({collectionContextStore:t,newGroups:r,groupsFormatKey:o,transaction:e})}}),xt.wd({environment:this.environment,collectionContextStore:t,action:"toggle_group_visibility"})},this.handleSortTypeChange=e=>{const{collectionContextStore:t,groupByKey:o}=this.props,n=yc(this.props.collectionContextStore,this.props.groupByKey),i=t.collectionViewStore();if(n&&i){if("formula"===n.type){const t={...n,groupBy:{...n.groupBy,sort:{type:e}}};p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleSortTypeChange",environment:this.environment,perform:e=>{u.FH({stores:[i],update:{[o]:t},transaction:e})}})}else p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleSortTypeChange",environment:this.environment,perform:t=>{u.FH({stores:[i],update:{[o]:{...n,sort:{type:e}}},transaction:t})}});xt.wd({environment:this.environment,collectionContextStore:t,action:"update_group_sort"})}},this.handleTextGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:n}=this.props,i=yc(this.props.collectionContextStore,this.props.groupByKey),r=t.collectionViewStore();if(!i||!r)return;const a=lc(i);if(a){if((0,Gl.aB)(i))p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleTextGroupByTypeChange",environment:this.environment,perform:t=>{u.FH({stores:[r],update:{[o]:{...i,groupBy:e},[n]:void 0},transaction:t})}});else if("formula"===i.type){const t={...Te.CE(a,"property"),groupBy:e},s={...i,groupBy:t};p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleTextGroupByTypeChange",environment:this.environment,perform:e=>{u.FH({stores:[r],update:{[o]:s,[n]:void 0},transaction:e})}})}xt.wd({environment:this.environment,collectionContextStore:t,action:"update_text_group_by"})}},this.handleDateGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:n}=this.props,i=yc(this.props.collectionContextStore,this.props.groupByKey),r=t.collectionViewStore();if(!i||!r)return;const a=sc(i);if(a){if((0,Gl.ib)(i))p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleDateGroupByTypeChange",environment:this.environment,perform:t=>{u.FH({stores:[r],update:{[o]:{...i,groupBy:e},[n]:void 0},transaction:t})}});else if("formula"===i.type){const t={...Te.CE(a,"property"),type:"date",groupBy:e},s={...i,groupBy:t};p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleDateGroupByTypeChange",environment:this.environment,perform:e=>{u.FH({stores:[r],update:{[o]:s,[n]:void 0},transaction:e})}})}xt.wd({environment:this.environment,collectionContextStore:t,action:"update_date_group_by"})}},this.handleStatusGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:n}=this.props,i=yc(this.props.collectionContextStore,this.props.groupByKey),r=t.collectionViewStore();i&&r&&"status"===(null==i?void 0:i.type)&&(p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleStatusGroupByTypeChange",environment:this.environment,perform:t=>{u.FH({stores:[r],update:{[o]:{...i,groupBy:e},[n]:void 0},transaction:t})}}),xt.wd({environment:this.environment,collectionContextStore:t,action:"update_status_group_by"}))},this.handleRemoveClick=()=>{const{collectionContextStore:e,groupByKey:t,groupsFormatKey:o}=this.props,n=e.collectionViewStore();n&&(p.createAndCommit({userAction:"CollectionSettingsViewGroup.handleRemoveClick",environment:this.environment,perform:e=>{u.FH({stores:[n],update:{[t]:void 0,[o]:void 0},transaction:e})}}),xt.wd({environment:this.environment,collectionContextStore:e,action:"click_remove_grouping"}))},this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=e.normalizedFormatStore.state,n=e.normalizedSchemaStore.state,i=e.remoteRequestStore.state,r=yc(this.props.collectionContextStore,this.props.groupByKey);if(r)return(0,zl.ej)({groupBy:r,schema:n,format:o,filter:null==i?void 0:i.loader.filter,groupsFormatKey:t,limit:this.stores.groupsLimit.state})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=yc(this.props.collectionContextStore,this.props.groupByKey);if(o)return(0,Gl.Qq)({schema:t,groupBy:o})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupsFormatKey:t,collectionContextStore:o}=this.props,n=o.normalizedFormatStore.state,i=o.normalizedSchemaStore.state,r=o.collectionViewBlockStore(),a=yc(this.props.collectionContextStore,this.props.groupByKey),s=this.stores.reducerResultStore.state;if(!a||!r||!s)return;const l=this.stores.groupsLimit.state,c=this.schemaGroupsStore.state,d=s.results,u=s?s.total:0,p=(0,zl.Cz)({groupBy:a,schema:i,formatGroups:n[t]||[],schemaGroups:c,reducerResults:d,getRecordModel:r.getRecordModel,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}),g=p.filter((e=>!(0,Gl.eF)(e))).slice(0,l),m=p.filter((e=>(0,Gl.eF)(e)));return{currentGroups:[...g,...m],visibleGroups:g,hiddenGroups:m,total:u}}),!0)}renderComponent(){const{collectionContextStore:e,groupByKey:t}=this.props,o=yc(this.props.collectionContextStore,this.props.groupByKey),n=e.normalizedSchemaStore.state;return(0,ue.jsxs)(Qo.ZP,{...this.props,title:(0,ue.jsx)(xc,{collectionSettingsStore:this.props.collectionSettingsStore,collectionContextStore:this.props.collectionContextStore}),children:[(0,ue.jsxs)(Et.Z,{children:[(0,ue.jsx)(vc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore,groupByKey:this.props.groupByKey,groupsFormatKey:this.props.groupsFormatKey,groupBy:o}),o&&rc({groupBy:o,schema:n})&&this.renderTypeMenuButton(o),o&&this.renderSortMenuButton(o),o&&this.renderAutoHideButton(o),o&&"board_columns_by"===t&&(0,ue.jsx)(Cc,{collectionContextStore:this.props.collectionContextStore})]}),o&&this.renderGroupSortListReducer(),(0,ue.jsxs)(Et.Z,{topBorder:!0,children:[o&&fc(this.props.collectionContextStore,this.props.groupByKey)&&(0,ue.jsx)(Jo.Z,{isGray:!0,icon:jn.y,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Remove grouping",id:"database.viewSettings.groupTab.removeButton.title"}),onClick:this.handleRemoveClick,isRed:!0}),(0,ue.jsx)(Xl.Z,{href:(0,Hl.UY)("guides.databaseGroup"),title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Learn about grouping",id:"database.viewSettings.groupTab.learnMoreButton.title"}),analyticsFrom:"view_settings_group"})]})]})}renderTypeMenuButton(e){const{collectionContextStore:t,collectionSettingsStore:o,groupByKey:n,groupsFormatKey:i}=this.props,r=t.normalizedSchemaStore.state,a=hc(this.props.collectionContextStore),s="formula"===e.type?{...e.groupBy,property:e.property}:e;return(0,Gl.ib)(s)?(0,ue.jsx)(Nl.Z,{title:ac({groupBy:s,schema:r}),popupStyle:{minWidth:190},selectedKey:s.groupBy,options:Gl.z8.map((e=>({key:e,title:pc(e)}))),onChange:this.handleDateGroupByTypeChange,disabled:!a}):(0,Gl.aB)(s)?(0,ue.jsx)(Nl.Z,{title:ac({groupBy:s,schema:r}),popupStyle:{minWidth:190},selectedKey:s.groupBy,options:Gl.Kp.map((e=>({key:e,title:gc(e)}))),onChange:this.handleTextGroupByTypeChange,disabled:!a}):"number"===s.type?(0,ue.jsx)(Jo.Z,{title:ac({groupBy:s,schema:r}),showChevron:!0,right:dc({groupBy:s,schema:r}),onClick:()=>{d.H4({collectionSettingsStore:o,item:{type:"groupByNumber",groupByKey:n,groupsFormatKey:i}})},disabled:!a}):"status"===s.type?(0,ue.jsx)(Nl.Z,{title:ac({groupBy:s,schema:r}),popupStyle:{minWidth:190},selectedKey:s.groupBy,options:Gl.vu.map((e=>({key:e,title:uc(e)}))),onChange:this.handleStatusGroupByTypeChange,disabled:!a}):void 0}renderSortMenuButton(e){const t=(0,Gl.YG)(e,!nn.default.checkGate("collection_properties_select_auto_sort_options"));if(t.length<=1)return;const o=(0,Gl.mu)(e);return(0,ue.jsx)(Nl.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.groupTab.sort"}),popupStyle:{minWidth:190},selectedKey:o.type,options:t.map((t=>({key:t,title:ic(e,t)}))),onChange:this.handleSortTypeChange,disabled:!hc(this.props.collectionContextStore)})}renderAutoHideButton(e){return(0,ue.jsx)(ba.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Hide empty groups",id:"database.viewSettings.groupTab.hideEmptyGroups"}),on:Boolean(e.hideEmptyGroups),focused:!1,onClick:this.handleHideEmptyGroupsClick,disabled:!hc(this.props.collectionContextStore),textWrapperStyle:{opacity:1}})}renderGroupSortListReducer(){const{groupsFormatKey:e}=this.props,t=this.reducerStore.state,o=this.groupsDisplayStateStore.state;return t?(0,ue.jsx)(ql.Z,{id:`group_menu_${e}`,reducer:t,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>this.renderGroupSortListSections(o)}):this.renderGroupSortListSections(o)}renderGroupSortListSections(e){const t=yc(this.props.collectionContextStore,this.props.groupByKey);if(!t)return;if(!e)return(0,ue.jsx)(Et.Z,{topBorder:!0,disableMobileBorders:!0,noTextOverflow:!0,children:(0,ue.jsx)("div",{style:{marginTop:6,display:"flex",alignItems:"center",flexDirection:"column"},children:(0,ue.jsx)(To.Z,{})})});const o="manual"===(0,Gl.mu)(t).type&&!this.environment.device.isMobile&&hc(this.props.collectionContextStore),n=this.stores.groupsLimit.state,{total:i,hiddenGroups:r,visibleGroups:a}=e,s=Math.min(zl.kW,i-r.length-a.length),c=s>0?(0,ue.jsx)(Rt.Z,{disabled:!1,focused:!1,style:{color:this.theme.mediumTextColor},icon:(0,bn.o)({width:14,height:14}),title:(0,ue.jsx)(l.FormattedMessage,{id:"database.groupMenu.loadMoreButton.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:s}}),onClick:()=>{this.props.collectionContextStore.isLoading.state||this.props.collectionContextStore.loadingDetails.setState({type:"load_groups_menu"}),this.stores.groupsLimit.setState(n+zl.kW)}}):void 0;return(0,ue.jsxs)(ue.Fragment,{children:[e.visibleGroups.length>0&&(0,ue.jsxs)(Et.Z,{topBorder:!0,noTextOverflow:!0,isTitleUppercase:!1,title:(0,ue.jsx)("span",{style:{alignSelf:"center"},children:(0,ue.jsx)(l.FormattedMessage,{id:"database.groupMenu.visibleGroups",defaultMessage:"Visible groups"})}),right:(0,ue.jsx)(Tt.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:this.handleHideAllClick,disabled:!hc(this.props.collectionContextStore),children:(0,ue.jsx)(l.FormattedMessage,{id:"database.groupMenu.hideAllGroups",defaultMessage:"Hide all"})}),children:[this.renderGroupSortList({displayState:e,groups:e.visibleGroups,canReorder:o,isHidden:!1}),c]}),e.hiddenGroups.length>0&&(0,ue.jsx)(Et.Z,{topBorder:!1,noTextOverflow:!0,isTitleUppercase:!1,title:(0,ue.jsx)(l.FormattedMessage,{id:"database.groupMenu.hiddenGroups",defaultMessage:"Hidden groups"}),right:(0,ue.jsx)(Tt.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:this.handleShowAllClick,disabled:!hc(this.props.collectionContextStore),children:(0,ue.jsx)(l.FormattedMessage,{id:"database.groupMenu.showAllGroups",defaultMessage:"Show all"})}),children:this.renderGroupSortList({displayState:e,groups:e.hiddenGroups,canReorder:o,isHidden:!0})})]})}renderGroupSortList(e){const{displayState:t,groups:o,canReorder:i,isHidden:r}=e;return i?(0,ue.jsx)(Yl.ZP,{direction:"vertical",keys:o.map((e=>(0,Gl.mD)(e))),renderKey:(e,n)=>{const r=o[n];return this.renderGroupSortListItem({displayState:t,groupFormat:r,canReorder:i})},onDrop:e=>{this.handleGroupReorder(e,r)},disabled:!hc(this.props.collectionContextStore)}):o.map((e=>(0,ue.jsx)(n.Fragment,{children:this.renderGroupSortListItem({displayState:t,groupFormat:e,canReorder:i})},(0,Gl.mD)(e))))}renderGroupSortListItem(e){const{collectionContextStore:t}=this.props,{displayState:o,groupFormat:n,canReorder:i}=e,r=t.normalizedSchemaStore.state,a=(0,Gl.eF)(n),s=yc(this.props.collectionContextStore,this.props.groupByKey);if(s)return(0,ue.jsx)(Jl.Z,{disabled:!hc(this.props.collectionContextStore),title:(0,ue.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[i&&(0,ue.jsx)(Ql.ZP,{iconSize:12,style:{marginRight:3}}),(0,ue.jsx)($l.Z,{groupBy:s,groupFormat:n,currentGroups:o.currentGroups,schema:r,disabled:!0,isHiddenGroup:!1,style:{padding:0},collectionContextStore:t})]}),right:(0,ue.jsx)(Mt.Z,{icon:a?Dr.B:Kr.c,iconStyle:{width:16,height:16},isDarkIconColor:!a,onClick:()=>{this.handleToggleGroupVisibility(n)},disabled:!hc(this.props.collectionContextStore)}),textWrapperStyle:{opacity:1}})}}function oc(e){return e?(0,ue.jsx)(ec.Z,{propertySchema:e,showIcon:!1}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.groupTab.noGroupingSetMessage"})}function nc(e,t){return"collection_group_by"===e&&"board"===t?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Sub-group by",id:"database.viewSettings.groupTab.subGroupProperty"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Group by",id:"database.viewSettings.groupTab.groupProperty"})}function ic(e,t){return"manual"===t?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Manual",id:"database.viewSettings.groupTab.sortType.manual"}):"ascending"===t?(0,Gl.ib)(e)||"formula"===e.type&&"date"===e.groupBy.type?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Oldest first",id:"database.viewSettings.groupTab.sortType.chronological"}):(0,Gl.aB)(e)||"relation"===e.type||"select"===e.type||"multi_select"===e.type||"formula"===e.type&&"text"===e.groupBy.type?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.viewSettings.groupTab.sortType.alphabetical"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Ascending",id:"database.viewSettings.groupTab.sortType.ascending"}):"descending"===t?(0,Gl.ib)(e)||"formula"===e.type&&"date"===e.groupBy.type?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Newest first",id:"database.viewSettings.groupTab.sortType.reverseChronological"}):(0,Gl.aB)(e)||"relation"===e.type||"select"===e.type||"multi_select"===e.type||"formula"===e.type&&"text"===e.groupBy.type?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Reverse alphabetical",id:"database.viewSettings.groupTab.sortType.reverseAlphabetical"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Descending",id:"database.viewSettings.groupTab.sortType.descending"}):void(0,ne.t1)(t)}function rc(e){const{groupBy:t,schema:o}=e,n=o[t.property];if(!n||!(0,Gl.LG)(n))return;let i;if("formula"===n.type){const e=(0,Ll.mm)(n);if("unknown"===e||"array"===e)return;i="block"===e?"relation":e}else i=n.type;return(0,Gl.A1)(i)||(0,Gl.HB)(i)||"number"===i||"status"===i?i:void 0}function ac(e){const t=rc(e);if(t)return(0,Gl.A1)(t)?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Date by",id:"database.viewSettings.groupByTypeTab.dateBy"}):(0,Gl.HB)(t)?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Text by",id:"database.viewSettings.groupByTypeTab.textBy"}):"number"===t?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Number by",id:"database.viewSettings.groupByTypeTab.numberBy"}):"status"===t?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Status by",id:"database.viewSettings.groupByTypeTab.statusBy"}):void 0}function sc(e){return(0,Gl.ib)(e)?e:"formula"===e.type&&"date"===e.groupBy.type?e.groupBy:void 0}function lc(e){return(0,Gl.aB)(e)?e:"formula"===e.type&&"text"===e.groupBy.type?e.groupBy:void 0}function cc(e){return"number"===e.type?e:"formula"===e.type&&"number"===e.groupBy.type?{...e.groupBy,property:e.property}:void 0}function dc(e){const{groupBy:t}=e,o=rc(e);if(o)if((0,Gl.A1)(o)){const e=sc(t);if(e)return pc(e.groupBy)}else if((0,Gl.HB)(o)){const e=lc(t);if(e)return gc(e.groupBy)}else if("number"===o){const e=cc(t);if(e)return(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"{start} to {end}",id:"database.groupMenu.numberGroupBy.range",values:{start:e.start,end:e.end}})}}function uc(e){return"group"===e?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Group",id:"database.groupMenu.statusGroupBy.group"}):"option"===e?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Option",id:"database.groupMenu.statusGroupBy.option"}):void(0,ne.t1)(e)}function pc(e){return"relative"===e?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Relative",id:"database.groupMenu.dateGroupBy.relative"}):"day"===e?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Day",id:"database.groupMenu.dateGroupBy.day"}):"week"===e?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Week",id:"database.groupMenu.dateGroupBy.week"}):"month"===e?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Month",id:"database.groupMenu.dateGroupBy.month"}):"year"===e?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Year",id:"database.groupMenu.dateGroupBy.year"}):void(0,ne.t1)(e)}function gc(e){return"exact"===e?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Exact",id:"database.groupMenu.textGroupBy.exact"}):"alphabet_prefix"===e?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.groupMenu.textGroupBy.alphabetical"}):void(0,ne.t1)(e)}tc.displayName="CollectionSettingsViewGroup";const mc=(0,l.injectIntl)(tc);function Sc(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function yc(e,t){return e.normalizedFormatStore.state[t]}function hc(e){return e.permissionScopes.state.canConfigureBlock}function fc(e,t){return hc(e)&&(0,zl._1)({viewType:Sc(e),groupByKey:t})}function xc(e){let{collectionSettingsStore:t,collectionContextStore:o}=e;window.__c={n:"Title"};const n=(0,a.VK)((()=>(0,Fr.n)(t)),[t]),i=(0,a.VK)((()=>Sc(o)),[o]);return n&&"group"===n.type?"collection_group_by"===n.groupByKey&&"board"===i?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Sub-group",id:"database.viewSettings.groupTab.subGroup.title"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Group",id:"database.viewSettings.groupTab.group.title"}):null}function vc(e){let{groupBy:t,collectionContextStore:o,collectionSettingsStore:n,groupByKey:i,groupsFormatKey:s}=e;window.__c={n:"PropertyMenuButton"};const l=(0,r.O7)(),c=(0,a.VK)((()=>o.normalizedSchemaStore.state),[o]),u=t?c[t.property]:void 0,p=(0,a.VK)((()=>hc(o)),[o]),g=(0,a.VK)((()=>Sc(o)),[o]);return(0,ue.jsx)(Jo.Z,{title:nc(i,g),showChevron:!0,right:oc(u),onClick:()=>{xt.wd({environment:l,collectionContextStore:o,action:"click_group_by_property",original_view_type:void 0,property_type:null==u?void 0:u.type}),d.H4({collectionSettingsStore:n,item:{type:"groupByProperty",groupByKey:i,groupsFormatKey:s}})},disabled:!p})}function Cc(e){let{collectionContextStore:t}=e;window.__c={n:"ColorColumnsOption"};const o=(0,r.O7)(),n=(0,a.VK)((()=>(0,zl.h6)(o,t)),[o,t]),i=(0,a.VK)((()=>hc(t)),[t]);return(0,ue.jsx)(ba.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Color columns",id:"database.viewSettings.groupTab.colorColumns"}),on:!n,focused:!1,onClick:()=>{d.iN({environment:o,collectionContextStore:t})},disabled:!i,textWrapperStyle:{opacity:1}})}var bc=o(13148),wc=o(59960),jc=o(48299),Mc=o(75018),_c=o(94841),kc=o(83182);const Tc=(0,l.defineMessages)({learn:{id:"CollectionTaskTypeBadge.MoreMenu.LearnMore.title",defaultMessage:"Learn more"}});function Ac(e){window.__c={n:"CollectionTaskTypeBadge"};const t=(0,S.yK)((e=>({homeIcon:{width:13,marginRight:8},badgeTitle:{color:e.regularTextColor,lineHeight:ie.Z.lineHeight.UISmall.desktop,marginRight:5},badgeStyle:{background:"rgba(196, 196, 196, 0.13)",margin:"8px 14px",padding:"12px 14px"}})),[]),{collectionContextStore:o}=e,n=(0,wc.w)(t.homeIcon),i=(0,a.VK)((()=>o.permissionScopes.state.canConfigureCollection),[o]),r=(0,ue.jsx)(Hr.Z,{style:t.badgeTitle,isSmall:!0,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"This is a task database",id:"CollectionTaskTypeBadge.title"})});return(0,ue.jsx)(zr,{icon:n,title:r,showCloseButton:!1,right:i?(0,ue.jsx)(Vc,{collectionContextStore:o}):(0,ue.jsx)(Pc,{}),style:t.badgeStyle,children:(0,ue.jsx)(Hr.Z,{style:{marginLeft:22},isSmall:!0,isMultiline:!0,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"See your assigned tasks in Home.",id:"CollectionTaskTypeBadge.description"})})})}function Pc(){window.__c={n:"LearnMore"};const e=(0,l.useIntl)(),t=(0,r.O7)();return(0,ue.jsx)(Mt.Z,{icon:A.m,ariaLabel:e.formatMessage(Tc.learn),onClick:()=>{c.Fsx(t,{from:"view_settings_task_type_badge"}),Mc.navigateToExternalURL({environment:t,url:_c.h5})}})}function Vc(e){window.__c={n:"MoreMenu"};const t=(0,r.O7)(),o=(0,l.useIntl)(),{collectionContextStore:i}=e,a=(0,S.yK)((e=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:3,height:24,width:24},threeDotIcon:{width:12,height:12,fill:e.mediumIconColor},hideButtonIcon:{height:17,width:17},confirmationModalTitle:{fontWeight:500},confirmationModalDescription:{fontSize:13,display:"flex",textAlign:"center"}})),[]),s=(0,n.useCallback)((()=>{p.createAndCommit({environment:t,userAction:"CollectionTaskTypeBadge.untypeDatabase",perform:e=>{jc.RQ({environment:t,collectionContextStore:i,transaction:e})}})}),[t,i]),c=(0,ue.jsx)("span",{style:a.confirmationModalDescription,children:(0,ue.jsx)(l.FormattedMessage,{id:"CollectionTaskTypeBadge.MoreMenu.RemoveFromHome.description",defaultMessage:"Tasks assigned from this database will no longer appear in Home or work with Sprints."})}),d=e=>[{key:"removeFromHome",render:e=>(0,ue.jsx)(Rt.Z,{...e,icon:(0,bc.U)(a.hideButtonIcon),title:(0,ue.jsx)(l.FormattedMessage,{id:"CollectionTaskTypeBadge.MoreMenu.RemoveFromHome.title",defaultMessage:"Undo task database"})}),action:()=>{const t=[{label:(0,ue.jsx)(l.FormattedMessage,{id:"CollectionTaskTypeBadge.UntypeDatabase.modal.confirm",defaultMessage:"Remove"}),color:"red",onAccept:s}];an.showDialog({message:(0,ue.jsx)("div",{style:{textAlign:"center"},children:(0,ue.jsx)("span",{style:a.confirmationModalTitle,children:(0,ue.jsx)(l.FormattedMessage,{id:"CollectionTaskTypeBadge.UntypeDatabase.modal.title",defaultMessage:"Undo Task Database?"})})}),description:c,showCancel:!0,keepFocus:!0,items:t}),e.close()}}],u=(0,ue.jsx)(Et.Z,{topBorder:!0,children:(0,ue.jsx)(kc.Z,{href:_c.h5,title:o.formatMessage(Tc.learn),analyticsFrom:"view_settings_task_type_badge"})});return(0,ue.jsx)(ut.ZP,{popupType:ut.Z4.Popup,alignmentToOrigin:ut.vR.Center,originGap:2,renderOrigin:e=>(0,ue.jsx)(An.Z,{style:a.buttonStyle,...e,children:(0,bn.o)(a.threeDotIcon)}),render:e=>{const t=[{key:"all",render:e=>(0,ue.jsx)(Et.Z,{...e}),items:d(e)}];return(0,ue.jsxs)(Ct.Z,{menuType:bt.og.Popup,width:200,children:[(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,sections:t,initialFocus:void 0}),u]})}})}var Fc=o(74420),Ic=o(76798),Bc=o(32662);const Zc=(0,l.defineMessages)({viewNamePlaceholderMessage:{defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNamePlaceholder.title"}});class Kc extends i.Z{constructor(){super(...arguments),this.handleViewNameSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(o.getName()!==e&&p.createAndCommit({userAction:"CollectionSettingsViewMain.handleViewNameSubmit",environment:this.environment,perform:t=>{Ca.iG({collectionViewStore:o,update:{name:e},transaction:t})}}),xt.wd({environment:this.environment,collectionContextStore:t,action:"rename",original_view_type:o.getType()}))},this.handleViewIconSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(p.createAndCommit({userAction:"CollectionSettingsViewMain.handleViewIconSubmit",environment:this.environment,perform:t=>{Ca.Uy({collectionViewBlockStore:o,icon:e,transaction:t})}}),xt.wd({environment:this.environment,collectionContextStore:t,action:"change_icon",icon:e}))},this.handleDuplicateClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t,intl:o}=this.props,n=e.collectionViewStore();n&&(d.zt({environment:this.environment,collectionContextStore:e,collectionViewStore:n,collectionSettingsStore:t,intl:o}),xt.wd({environment:this.environment,collectionContextStore:e,action:"click_duplicate",original_view_type:n.getType()}))},this.handleCopyLinkClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();t&&(d.Ol({environment:this.environment,collectionContextStore:e,collectionViewStore:t}),xt.wd({environment:this.environment,collectionContextStore:e,action:"click_copy_link",original_view_type:t.getType()}))},this.handleDeleteClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionViewStore();o&&(d.TT({environment:this.environment,collectionContextStore:e,collectionViewStore:o,collectionSettingsStore:t,from:"view_settings"}),xt.wd({environment:this.environment,collectionContextStore:e,action:"click_delete",original_view_type:o.getType()}))},this.handleToggleLockClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();t&&(hl.bo({environment:this.environment,store:t,lock:!t.isLocked()}),xt.wd({environment:this.environment,collectionContextStore:e,action:"click_toggle_lock"}))},this.shouldRenderTurnIntoTaskStore=this.createComputedStore((()=>{const{device:e}=this.environment,{collectionContextStore:t}=this.props,o=t.collectionStore(),n=t.collectionViewBlockStore(),i=t.collectionViewStore();if(e.isMobile)return!1;if(!o||!n||!i)return!1;if(o.isSyncedCollection())return!1;const r=n.getCollectionViewSourceCollectionStore();return!!t.permissionScopes.state.canConfigureBlock&&((null==r||!r.isTypedCollection())&&void 0!==r)})),this.shouldRenderSourceStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore(),n=e.collectionViewStore();if(!t||!o||!n)return!1;if(t.isSyncedCollection())return!0;return void 0===o.getCollectionViewSourceCollectionStore()})),this.isMyTasks=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id;return o&&(0,fl.qG)(o)}))}renderComponent(){const{device:e}=this.environment,{collectionContextStore:t,selectViewNameInitial:o}=this.props,n=t.collectionViewStore(),i=t.collectionViewBlockStore();if(!n||!i)return;if(!n.isDefined())return;const r=t.permissionScopes.state,a=n.getFormat().collection_view_icon,s=n.getType(),c=n.getAppConfigUri(),d=c&&(0,hs.xB)(c),u=!this.isMyTasks.state&&!d,p=(0,ue.jsx)(Et.Z,{title:e.isMobile&&(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNameSection.title"}),children:(0,ue.jsx)(Xs.Z,{initialValue:n.getName()||"",placeholder:be.default.formatMessage(Zc.viewNamePlaceholderMessage),onBlur:this.handleViewNameSubmit,onSubmit:this.handleViewNameSubmit,focusInitial:o,selectAll:o,disabled:!r.canConfigureBlock||!u,iconButton:{icon:e=>(0,ue.jsx)(ii.F,{color:"gray",viewIcon:a,viewType:s,style:{marginRight:6}}),iconStyle:{fill:Js.Lr[this.theme.mode].gray},enforceIconColor:"gray",onSubmit:this.handleViewIconSubmit}})});return"page"===n.getType()?(0,ue.jsx)(Qo.ZP,{...this.props,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"View options",id:"database.viewSettings.mainTab.title"}),children:p}):this.isMyTasks.state&&t.isCompactView.state?(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(Et.Z,{children:[(0,ue.jsx)(Jc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ue.jsx)(ed,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ue.jsx)(td,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore})]}),(0,ue.jsx)(Et.Z,{topBorder:!0,children:(0,ue.jsx)(Jo.Z,{icon:nl.L,isPadded:!0,title:(0,ue.jsx)(l.FormattedMessage,{id:"PersonalHomePanel.moreDropdown.hide.title",defaultMessage:"Hide from home"}),showChevron:!1,onClick:()=>{po.default.state.currentSpaceViewStore&&yl.aG({environment:this.environment,currentSpaceViewStore:po.default.state.currentSpaceViewStore,feature:"tasks",from:"tasks_more_menu"})}})})]}):(0,ue.jsxs)(Qo.ZP,{...this.props,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"View options",id:"database.viewSettings.mainTab.title"}),children:[(0,ue.jsx)(Wc,{collectionContextStore:this.props.collectionContextStore}),p,e.isMobile?(0,ue.jsxs)(Et.Z,{topBorder:!0,children:[this.renderSource(),(0,ue.jsx)(Qc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ue.jsx)(Jc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ue.jsx)(ed,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ue.jsx)(td,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ue.jsx)($c,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ue.jsx)(qc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),this.renderRelationFeatures(),(0,ue.jsx)(zc,{collectionSettingsStore:this.props.collectionSettingsStore,collectionContextStore:this.props.collectionContextStore}),(0,ue.jsx)(Wl,{collectionContextStore:t}),(0,ue.jsx)(Uc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore})]}):(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(Et.Z,{children:[this.renderSource(),(0,ue.jsx)(Qc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore})]}),(0,ue.jsxs)(Et.Z,{topBorder:!0,children:[(0,ue.jsx)(Jc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ue.jsx)(ed,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ue.jsx)(td,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ue.jsx)($c,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),(0,ue.jsx)(qc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}),this.renderRelationFeatures(),(0,ue.jsx)(zc,{collectionSettingsStore:this.props.collectionSettingsStore,collectionContextStore:this.props.collectionContextStore}),(0,ue.jsx)(Wl,{collectionContextStore:t}),(0,ue.jsx)(Uc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore})]})]}),(0,xl.QI)("dev_or_beta")?this.renderTurnIntoTask():void 0,(0,ue.jsxs)(Et.Z,{topBorder:!0,children:[(0,xl.QI)("dev_or_beta")?(0,ue.jsx)(Hc,{collectionContextStore:this.props.collectionContextStore}):void 0,this.renderLockAction(),this.renderCopyLinkAction(),this.renderDuplicateAction(),this.renderDeleteAction()]})]})}renderLockAction(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();if(!t)return;const o=t.getCollectionViewSourceCollectionStore(),n=t.isLocked();if(!(o?o.canEditCollection():t.canEditCollection()))return;const i=null==t?void 0:t.isCollectionViewPageWithContent();return(0,ue.jsx)(Jo.Z,{icon:n?Sl.U:ct.b,title:Oc(o,i,n),onClick:this.handleToggleLockClick})}renderCopyLinkAction(){return(0,ue.jsx)(Jo.Z,{icon:cl.N,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.mainTab.copyLinkButton.title"}),onClick:this.handleCopyLinkClick})}renderDuplicateAction(){const{collectionContextStore:e}=this.props;if(e.permissionScopes.state.canConfigureBlock&&"collectionTypedView"!==e.contextType)return(0,ue.jsx)(Jo.Z,{icon:wn.a,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Duplicate view",id:"database.viewSettings.mainTab.duplicateButton.title"}),onClick:this.handleDuplicateClick})}renderRelationFeatures(){const{collectionContextStore:e}=this.props,t=e.collectionStore();if((null==t||!t.isSyncedCollection())&&"collectionTypedView"!==e.contextType)return(0,ue.jsxs)(n.Fragment,{children:[this.renderSubitem(),this.renderArrowsBy()]})}renderSubitem(){return nn.default.checkGate("dependency_date_shifting_by_space")?(0,ue.jsx)(Lc,{collectionSettingsStore:this.props.collectionSettingsStore,collectionContextStore:this.props.collectionContextStore}):(0,ue.jsx)(Xc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore})}renderArrowsBy(){return nn.default.checkGate("dependency_date_shifting_by_space")?(0,ue.jsx)(Gc,{collectionSettingsStore:this.props.collectionSettingsStore,collectionContextStore:this.props.collectionContextStore}):es({feature:"timeline_arrows_by",viewType:Ec(this.props.collectionContextStore)})?(0,ue.jsx)(Yc,{collectionContextStore:this.props.collectionContextStore,collectionSettingsStore:this.props.collectionSettingsStore}):void 0}renderDeleteAction(){const{collectionContextStore:e}=this.props;if(!e.collectionViewBlockStore())return;return e.permissionScopes.state.canConfigureBlock&&"collectionTypedView"!==e.contextType?(0,ue.jsx)(Jo.Z,{icon:jn.y,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Delete view",id:"database.viewSettings.mainTab.deleteButton.title"}),isRed:!0,onClick:this.handleDeleteClick}):void 0}renderSource(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionStore(),n=e.collectionViewBlockStore();if(!o||!n)return;if(!this.shouldRenderSourceStore.state)return;const i=o.getIcon();return(0,ue.jsx)(Jo.Z,{icon:rl.v,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Source",id:"database.viewSettings.mainTab.sourceButton.title"}),showChevron:!0,right:(0,ue.jsxs)(ue.Fragment,{children:[i&&(0,ue.jsx)(ai.Z,{icon:i,isEmptyPage:!1,size:20,disabled:!0,style:{marginRight:4,opacity:.6}}),(0,ue.jsx)(Ic.Z,{store:o})]}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},onClick:()=>{xt.wd({environment:this.environment,collectionContextStore:e,action:"click_source"}),d.H4({collectionSettingsStore:t,item:{type:"source"}})}})}renderTurnIntoTask(){const{collectionContextStore:e}=this.props;if(e.collectionStore()&&this.shouldRenderTurnIntoTaskStore.state)return(0,ue.jsx)(Et.Z,{topBorder:!0,style:{marginLeft:4},children:(0,ue.jsx)(Jo.Z,{icon:()=>(0,dl.z)({width:14}),title:(0,ue.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:4},children:[(0,ue.jsx)("div",{style:ie.Z.textOverflowStyle,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Turn into task database",id:"database.viewSettings.mainTab.turnIntoTask.title"})}),(0,ue.jsx)(Fc.Z,{})]}),caption:(0,ue.jsx)("div",{children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"See your assigned tasks in Home, manage tasks in sprints, and more.",id:"database.viewSettings.mainTab.turnIntoTask.caption"})}),shouldWrapCaption:!0,showChevron:!1,onClick:()=>{Dl.Z.setState({isModalOpen:!0,databaseType:zs.iS,collectionContextStore:e}),xt.gd({environment:this.environment,database_type:zs.iS,collectionContextStore:e})}})})}}Kc.displayName="CollectionSettingsViewMain";const Dc=(0,l.injectIntl)(Kc);function Oc(e,t,o){return t?o?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Unlock wiki",id:"action.unlockWikiName.name"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Lock wiki",id:"action.lockWikiName.name"}):e?o?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Unlock database",id:"database.viewSettings.mainTab.unlockDatabase.title"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Lock database",id:"database.viewSettings.mainTab.lockDatabase.title"}):o?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Unlock views",id:"database.viewSettings.mainTab.unlockViews.title"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Lock views",id:"database.viewSettings.mainTab.lockViews.title"})}function Rc(e){let t;return t=e?e.supportedInView&&!e.enabledOnView?Lr.dH.relationFeatureHiddenMessage:Lr.dH.relationFeatureOnMessage:Lr.dH.relationFeatureOffMessage,be.default.formatMessage(t)}function Nc(e,t){const o=t.permissionScopes.state,n=(0,ne.$K)(e),i=o.canConfigureBlock;return n||i}function Ec(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function Wc(e){let{collectionContextStore:t}=e;window.__c={n:"ContentOnlyEditorEducationPill"};return(0,a.VK)((()=>{const e=t.collectionViewBlockStore();return e&&"content_only_editor"!==e.getRole()}),[t])?null:(0,ue.jsx)(Ol,{})}function Lc(e){let{collectionSettingsStore:t,collectionContextStore:o}=e;window.__c={n:"SubitemV2"};const n=(0,a.VK)((()=>o.currentSubitemFormatStore.state),[o]),i=(0,a.VK)((()=>o.databaseType),[o]),r=(0,a.VK)((()=>Na({feature:"subitem",collectionContextStore:o})),[o]),s=(0,a.VK)((()=>Nc(n,o)),[o,n]);return(0,ue.jsx)(Jo.Z,{icon:ul.Y,title:(0,ue.jsx)(l.FormattedMessage,{...(0,Lr.Gt)({feature:"subitem",databaseType:i})}),showChevron:!0,right:Rc(r),onClick:()=>{d.H4({collectionSettingsStore:t,item:{type:"subitemV2"}})},disabled:!s})}function Gc(e){let{collectionSettingsStore:t,collectionContextStore:o}=e;window.__c={n:"ArrowsByV2"};const n=(0,a.VK)((()=>o.currentArrowsByFormatStore.state),[o]),i=(0,a.VK)((()=>o.databaseType),[o]),r=(0,a.VK)((()=>Na({feature:"timeline_arrows_by",collectionContextStore:o})),[o]),s=(0,a.VK)((()=>Nc(n,o)),[o,n]);return(0,ue.jsx)(Jo.Z,{title:(0,ue.jsx)(l.FormattedMessage,{...(0,Lr.Gt)({feature:"timeline_arrows_by",databaseType:i})}),showChevron:!0,icon:ol.I,right:Rc(r),onClick:()=>{d.H4({collectionSettingsStore:t,item:{type:"dependencies"}})},disabled:!s})}function Uc(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"AutomationAction"};const n=(0,a.VK)((()=>(0,Ce.cB)(t)),[t]),i=(0,a.VK)((()=>t.aliveAutomationCount.state),[t]);return n?(0,ue.jsx)(Jo.Z,{icon:vn.M,onClick:()=>{i>0?d.H4({collectionSettingsStore:o,item:{source:"collection_view_settings",type:"automationSettings"}}):(d.H4({collectionSettingsStore:o,item:{source:"collection_view_settings",type:"automationSettings"}}),d.H4({collectionSettingsStore:o,item:{type:"automationCreateSettings"}}))},right:i>0?i:(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.mainTab.automations.none",defaultMessage:"None"}),showChevron:!0,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Automations",id:"database.viewSettings.mainTab.automations.title"})}):null}function zc(e){let{collectionSettingsStore:t,collectionContextStore:o}=e;window.__c={n:"SprintSettings"};const n=(0,a.VK)((()=>nn.default.checkGate("recurring_sprints")),[]),i=(0,a.VK)((()=>{const e=o.databaseType;return n&&(e===zs.iS||e===zs.p$)}),[o,n]),{sprintSettingsDisplayState:r}=Kl({collectionSettingsStore:t,collectionContextStore:o});let s;return"displayOn"===r?s=(0,ue.jsx)(l.FormattedMessage,{...Tl.on}):"displayOff"===r?s=(0,ue.jsx)(l.FormattedMessage,{...Tl.off}):void 0===r?s=void 0:(0,ne.t1)(r),i&&s?(0,ue.jsx)(Jo.Z,{icon:ml.L,right:s,showChevron:!0,title:(0,ue.jsx)(l.FormattedMessage,{...Tl.sprintsMenuTitle}),onClick:()=>{d.H4({collectionSettingsStore:t,item:{type:"sprintSettings"}})}}):null}function Hc(e){let{collectionContextStore:t}=e;window.__c={n:"TaskTypeBadgeComponent"};const o=(0,r.Fy)(),n=(0,a.VK)((()=>t.collectionViewBlockStore()),[t]),i=(0,a.VK)((()=>null==n?void 0:n.getRole()),[n]),s=(0,a.VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getDatabaseType()}),[t]);return o.isMobile||s!==zs.iS?null:n&&"content_only_editor"!==i?(0,ue.jsx)(Ac,{collectionContextStore:t}):null}function $c(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"GroupComponent"};const n=(0,r.O7)(),i=(0,a.VK)((()=>Ec(t)),[t]),s="board"===i?{groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}:{groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},c=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t]),u=(0,a.VK)((()=>t.normalizedFormatStore.state),[t])[s.groupByKey],p=(0,a.VK)((()=>t.permissionScopes.state),[t]);return"calendar"!==i?(0,ue.jsx)(Jo.Z,{icon:"board"===i?al.b:sl.q,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Group",id:"database.viewSettings.mainTab.groupButton.title"}),showChevron:!0,right:oc(u?c[u.property]:void 0),onClick:()=>{var e;xt.wd({environment:n,collectionContextStore:t,action:"click_group",original_view_type:i,property_type:u?null===(e=c[u.property])||void 0===e?void 0:e.type:void 0}),t.isLoading.state||t.loadingDetails.setState({type:"load_groups_menu"}),d.H4({collectionSettingsStore:o,item:u?{type:"group",...s}:{type:"groupByProperty",...s}})},disabled:!u&&!p.canConfigureBlock}):null}function qc(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"SubGroupComponent"};const n=(0,r.O7)(),i=(0,a.VK)((()=>Ec(t)),[t]),s=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t]),c=(0,a.VK)((()=>t.normalizedFormatStore.state),[t]).collection_group_by,u={groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},p=(0,a.VK)((()=>t.permissionScopes.state),[t]);return"board"===i?(0,ue.jsx)(Jo.Z,{icon:sl.q,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Sub-group",id:"database.viewSettings.mainTab.subGroupButton.title"}),showChevron:!0,right:oc(c?s[c.property]:void 0),onClick:()=>{var e;xt.wd({environment:n,collectionContextStore:t,action:"click_subgroup",original_view_type:i,property_type:c?null===(e=s[c.property])||void 0===e?void 0:e.type:void 0}),t.isLoading.state||t.loadingDetails.setState({type:"load_groups_menu"}),d.H4({collectionSettingsStore:o,item:c?{type:"group",...u}:{type:"groupByProperty",...u}})},disabled:!c&&!p.canConfigureBlock}):null}function Xc(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"SubitemV1Component"};const n=(0,r.O7)(),i=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t]),s=(0,a.VK)((()=>t.currentSubitemFormatStore.state),[t]),c=s?i[s.property]:void 0,u=(0,a.VK)((()=>t.permissionScopes.state),[t]),p=(0,a.VK)((()=>t.databaseType),[t]);return(0,ue.jsx)(Jo.Z,{icon:ul.Y,title:(0,ue.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[(0,ue.jsx)(l.FormattedMessage,{...(0,Lr.Gt)({feature:"subitem",databaseType:p})}),(0,ue.jsx)(Bc.Z,{size:2})]}),showChevron:!0,right:(0,ue.jsx)("span",{style:{...ie.Z.textOverflowStyle},children:(null==c?void 0:c.name)??(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.subitemTab.none"})}),onClick:()=>{xt.wd({environment:n,collectionContextStore:t,action:"click_subitem"}),d.H4({collectionSettingsStore:o,item:{type:"subitem"}})},disabled:!s&&!u.canConfigureBlock})}function Yc(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"ArrowsByV1Component"};const n=(0,r.O7)(),i=(0,a.VK)((()=>t.normalizedSchemaStore.state),[t]),s=(0,a.VK)((()=>t.currentArrowsByFormatStore.state),[t]),c=s?i[s]:void 0,u=(0,a.VK)((()=>t.permissionScopes.state),[t]);return(0,ue.jsx)(Jo.Z,{icon:tl.Z,title:(0,ue.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Dependencies",id:"database.viewSettings.mainTab.dependencies.title"}),(0,ue.jsx)(Bc.Z,{size:2})]}),showChevron:!0,right:(0,ue.jsx)("span",{style:{...ie.Z.textOverflowStyle},children:(null==c?void 0:c.name)??(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.arrowsByTab.none"})}),onClick:()=>{xt.wd({environment:n,collectionContextStore:t,action:"click_timeline_arrows_by"}),d.H4({collectionSettingsStore:o,item:{type:"arrowsBy"}})},disabled:!s&&!u.canConfigureBlock})}function Qc(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"LayoutComponent"};const n=(0,r.O7)(),i=(0,a.VK)((()=>t.collectionViewStore()),[t]),s=(0,a.VK)((()=>null==i?void 0:i.getType()),[i]);return i&&s?(0,ue.jsx)(Jo.Z,{icon:ll.M,isPadded:!0,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Layout",id:"database.viewSettings.mainTab.layoutButton.title"}),showChevron:!0,right:Lt.Bh[s],onClick:()=>{xt.wd({environment:n,collectionContextStore:t,action:"click_layout"}),d.H4({collectionSettingsStore:o,item:{type:"layout"}})}}):null}function Jc(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"PropertiesComponent"};const n=(0,r.O7)(),i=((0,a.VK)((()=>t.normalizedFormatStore.state),[t])[(0,a.VK)((()=>(0,Aa.oz)(Ec(t))),[t])]||[]).filter((e=>Boolean(e.visible))).length;return(0,ue.jsx)(Jo.Z,{icon:pl.N,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Properties",id:"database.viewSettings.mainTab.propertiesButton.title"}),showChevron:!0,right:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"{propertiesShown} shown",id:"database.viewSettings.mainTab.propertiesButton.propertiesShown.title",values:{propertiesShown:i}}),onClick:()=>{xt.wd({environment:n,collectionContextStore:t,action:"click_properties"}),d.H4({collectionSettingsStore:o,item:{type:"properties",timelineViewTab:"timeline"}})}})}function ed(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"FilterComponent"};const n=(0,r.O7)(),i=(0,a.VK)((()=>t.permissionScopes.state),[t]),s=(0,a.VK)((()=>t.currentPropertyFiltersStore.state.length+(t.currentCombinatorFilterStore.state&&i.canConfigureBlock?1:0)),[t,i]);return(0,ue.jsx)(Jo.Z,{icon:il.I,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Filter",id:"database.viewSettings.mainTab.filterButton.title"}),showChevron:!0,right:s>0?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"{numberOfFilters, plural, one {{numberOfFilters} filter} other {{numberOfFilters} filters}}",values:{numberOfFilters:s},id:"database.viewSettings.mainTab.filterButton.filters.title"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.mainTab.filterButton.noFilters.title"}),onClick:()=>{xt.wd({environment:n,collectionContextStore:t,action:"click_filters"}),0===s?d.H4({collectionSettingsStore:o,item:{type:"createFilter"}}):d.H4({collectionSettingsStore:o,item:{type:"filters"}})}})}function td(e){let{collectionContextStore:t,collectionSettingsStore:o}=e;window.__c={n:"SortComponent"};const n=(0,r.O7)(),i=(0,a.VK)((()=>t.currentSortsStore.state.length),[t]);return(0,ue.jsx)(Jo.Z,{icon:gl.j,isPadded:!0,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.mainTab.sortButton.title"}),showChevron:!0,right:i>0?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"{numberOfSorts, plural, one {{numberOfSorts} sort} other {{numberOfSorts} sorts}}",values:{numberOfSorts:i},id:"database.viewSettings.mainTab.sortButton.oneOrMoreSorts.title"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.mainTab.sortButton.noSorts.title"}),onClick:()=>{xt.wd({environment:n,collectionContextStore:t,action:"click_sort"}),0===i?d.H4({collectionSettingsStore:o,item:{type:"createSort"}}):d.H4({collectionSettingsStore:o,item:{type:"sort"}})}})}class od extends i.Z{constructor(){super(...arguments),this.handleViewNameBlur=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&o.getName()!==e&&p.createAndCommit({userAction:"CollectionSettingsCreateView.handleViewNameBlur",environment:this.environment,perform:t=>{Ca.iG({collectionViewStore:o,update:{name:e},transaction:t})}})},this.handleViewNameSubmit=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;this.handleViewNameBlur(e),d.wl({collectionSettingsStore:t,item:{type:"main"}}),xt.wd({environment:this.environment,collectionContextStore:o,action:"rename"})},this.handleViewIconSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(p.createAndCommit({userAction:"CollectionSettingsCreateView.handleViewIconSubmit",environment:this.environment,perform:t=>{Ca.Uy({collectionViewBlockStore:o,icon:e,transaction:t})}}),xt.wd({environment:this.environment,collectionContextStore:t,action:"change_icon",icon:e}))}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,{device:o}=this.environment,n=e.collectionViewStore();if(!n)return;if(!n.isDefined())return;const i=n.getFormat().collection_view_icon,r=n.getType();return(0,ue.jsxs)(Qo.ZP,{...this.props,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"New view",id:"database.viewSettings.createViewTab.title"}),desktopWidth:290,children:[(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(Xs.Z,{initialValue:"",placeholder:be.default.formatMessage(Zc.viewNamePlaceholderMessage),focusInitial:!o.isMobile||void 0,onBlur:this.handleViewNameBlur,iconButton:{icon:e=>(0,ue.jsx)(ii.F,{color:"gray",viewIcon:i,viewType:r,style:{marginRight:6}}),iconStyle:{fill:Js.Lr[this.theme.mode].gray},enforceIconColor:"gray",onSubmit:this.handleViewIconSubmit},onSubmit:this.handleViewNameSubmit})}),(0,ue.jsx)(el.Z,{collectionContextStore:e,collectionSettingsStore:t,showDoneButton:!o.isMobile})]})}}od.displayName="CollectionSettingsCreateView";const nd=(0,l.injectIntl)(od);var id=o(49670);class rd extends i.Z{renderComponent(){return(0,ue.jsx)(Qo.ZP,{...this.props,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Deleted properties",id:"database.viewSettings.propertyTab.deletedTitle"}),children:this.renderContent()})}renderContent(){const{collectionContextStore:e}=this.props,t=e.normalizedDeletedSchemaStore.state,o=Object.entries(t).map((e=>{let[t,o]=e;if(o)return{propertyId:t,propertySchema:o}})).filter(ne.$K);if(0===o.length)return(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(Jl.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.deletedPropertiesTab.noResults"})})});const{theme:n}=this;return(0,ue.jsx)(Et.Z,{children:o.map((e=>{let{propertyId:t,propertySchema:o}=e;return(0,ue.jsx)(Jl.Z,{title:(0,ue.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,ue.jsx)(Kt.ZP,{type:o.type,icon:o.icon,size:16,theme:n,style:{fill:n.regularIconColor}}),(0,ue.jsx)("span",{style:{marginLeft:6,maxWidth:200,...ie.Z.textOverflowStyle},children:o.name})]}),right:(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(Mt.Z,{icon:pi.s,iconStyle:{marginRight:2},onClick:()=>{!function(e,t,o,n,i){const r=o.collectionStore(),a=(0,dr.jI)({timelineViewTab:n,collectionContextStore:o});if(r){const o=si.D8({deletedSchema:r.getDeletedSchema(),property:e});if(o){var s;if("verification"===(null===(s=r.getDeletedSchema()[e])||void 0===s?void 0:s.type)){const e=r.getSchema();if(Object.keys(e).some((t=>{var o;return"verification"===(null===(o=e[t])||void 0===o?void 0:o.type)})))return void an.showDialog({message:(0,ue.jsx)(l.FormattedMessage,{id:"database.deletedPropertiesTab.cannotRestoreDuplicateProperty.modal.verification",defaultMessage:"You can only have one verification property."}),showCancel:!1,keepFocus:!0,items:[{label:(0,ue.jsx)(l.FormattedMessage,{id:"database.deletedPropertiesTab.cannotRestoreDuplicateProperty.modal.dismissButton",defaultMessage:"Dismiss"}),onAccept:()=>{}}]})}p.createAndCommit({userAction:"CollectionSettingsDeletedProperties.handleRestoreDeletedPropertyClick",environment:i,perform:e=>{Ca.xO({environment:i,collectionStore:r,update:o.updateSchema,transaction:e}),Ca.$N({collectionStore:r,update:o.updateDeletedSchema,transaction:e})}}),d.z$({collectionSettingsStore:t}),d.H4({collectionSettingsStore:t,item:{type:"property",property:e,formatKey:a}})}}}(t,this.props.collectionSettingsStore,this.props.collectionContextStore,this.props.timelineViewTab,this.environment)}}),(0,ue.jsx)(Mt.Z,{icon:jn.y,onClick:()=>{!function(e,t,o){an.showDialog({message:(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.deletedPropertiesTab.permanentlyDeleteProperty.modal.prompt",defaultMessage:"Are you sure you want to delete this property?"}),showCancel:!0,keepFocus:!0,items:[{label:(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.propertyTab.deleteProperty.modal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:()=>{const n=t.collectionStore();n&&p.createAndCommit({userAction:"CollectionSettingsDeletedProperties.handlePermanentlyDeleteDeletedPropertyClick",environment:o,perform:t=>{Ca.$N({collectionStore:n,update:{[e]:null},transaction:t})}})}}]})}(t,this.props.collectionContextStore,this.environment)}})]})},t)}))})}}rd.displayName="CollectionSettingsDeletedProperties";const ad=(0,l.injectIntl)(rd);var sd=o(83319),ld=o(89211),cd=o(28410),dd=o(3791),ud=o(79474),pd=o(1892),gd=o(44866),md=o(19124),Sd=o(83212),yd=o(78291),hd=o(30905),fd=o(91965);const xd=(0,l.defineMessages)({autoUpdateExplanationMessage:{defaultMessage:"Keep values updated with the latest edits to pages",id:"database.CollectionSettingsPropertyAiAutofill.autoUpdateExplanationMessage"},onlyWithAiAddOnMessage:{defaultMessage:"Only with Notion AI add-on",id:"database.CollectionSettingsPropertyAiAutofill.onlyWithAiAddOnMessage"},updateOnPageEdits:{defaultMessage:"Auto-update on page edits",id:"database.viewSettings.propertyTab.aiAutofill.updateOnPageEdits"}});function vd(e){let{collectionContextStore:t,environment:o,setAiInference:i,aiInference:r,doesUserHaveAIAddOn:a}=e;window.__c={n:"CollectionSettingsAiAutofillAutoUpdateToggle"};const c=(0,n.useRef)((0,s.ZP)()),d=(0,n.useCallback)((()=>{if(!t.collectionStore())return;if(!r)return;if(!(a||null!=r&&r.auto_update_on_edit))return void gd.triggerAiAutofillUpsell({environment:o,from:"ai_autofill_on_page_edit"});const e={...r,auto_update_on_edit:!r.auto_update_on_edit};i(e)}),[t,r,a,i,o]);return r?(0,ue.jsx)(re.Z,{renderTooltip:()=>(0,ue.jsxs)("div",{style:{width:159},children:[(0,ue.jsx)("div",{style:{color:"white",fontWeight:500,wordWrap:"break-word",whiteSpace:"pre-wrap"},children:(0,ue.jsx)(l.FormattedMessage,{...xd.autoUpdateExplanationMessage})}),!a&&(0,ue.jsx)("div",{style:{color:"#ACABA9",fontWeight:500},children:(0,ue.jsx)(l.FormattedMessage,{...xd.onlyWithAiAddOnMessage})})]}),render:e=>(0,ue.jsx)(Jo.Z,{title:(0,ue.jsx)(l.FormattedMessage,{...xd.updateOnPageEdits}),showChevron:!1,right:(0,ue.jsx)(wr.Z,{inputId:c.current,on:!!r.auto_update_on_edit,onClick:d,disabled:!1,noColor:!1}),onClick:d,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})}):null}var Cd=o(1743);const bd=(0,l.defineMessages)({optionsSectionTitle:{defaultMessage:"Options",id:"database.viewSettings.propertyTab.aiAutofill.optionsSectionTitle"},extractPromptSectionTitle:{defaultMessage:"What key info to extract?",id:"database.viewSettings.propertyTab.aiAutofill.extractPromptSectionTitle"},customPromptSectionTitle:{defaultMessage:"What to generate?",id:"database.viewSettings.propertyTab.aiAutofill.customPromptSectionTitle"},extractPromptInputPlaceholder:{defaultMessage:"e.g. “Key topics in bullets” or “People mentioned on the page”",id:"database.viewSettings.propertyTab.aiAutofill.extractPromptInputPlaceholder"},customPromptInputPlaceholder:{defaultMessage:"Tell AI what to generate from page content and properties…",id:"database.viewSettings.propertyTab.aiAutofill.customPromptInputPlaceholder"}});function wd(e){var t;let{environment:o,aiInference:i,setAiInference:r,collectionContextStore:s,isAutofillSetupEnabled:c,shouldShowUserPromptIsInvalidError:d,setShouldShowUserPromptIsInvalidError:u}=e;window.__c={n:"CollectionSettingsAiAutofillPromptInput"};const p=function(e){if(!e)return;switch(e.type){case"summarize":case"translate":return;case"extract":return{aiInferenceType:e.type,sectionTitle:bd.extractPromptSectionTitle,inputPlaceholder:bd.extractPromptInputPlaceholder,value:e.prompt};case"custom":return{aiInferenceType:e.type,sectionTitle:bd.customPromptSectionTitle,inputPlaceholder:bd.customPromptInputPlaceholder,value:e.prompt};case"select":case"multi_select":return{aiInferenceType:e.type,sectionTitle:bd.customPromptSectionTitle,inputPlaceholder:bd.customPromptInputPlaceholder,value:e.prompt};default:(0,ne.t1)(e)}}(i),g=(0,a.VK)((()=>(0,Lt.k4)()),[]),m=(0,n.useCallback)((e=>{if(s.collectionStore()&&p)switch(e.target.value&&e.target.value.length<=cd.Th?u(!1):e.target.value.length>cd.Th&&u(!0),p.aiInferenceType){case"extract":case"custom":r({type:p.aiInferenceType,prompt:e.target.value,auto_update_on_edit:(null==i?void 0:i.auto_update_on_edit)??g});break;case"select":case"multi_select":r({type:p.aiInferenceType,prompt:e.target.value,auto_update_on_edit:(null==i?void 0:i.auto_update_on_edit)??g,add_options:((null==i?void 0:i.type)===p.aiInferenceType&&(null==i?void 0:i.add_options))??!1});break;case"summarize":case"translate":return;default:(0,ne.t1)(p.aiInferenceType)}}),[i,s,g,p,r,u]);return p?(0,ue.jsxs)(Et.Z,{title:be.default.formatMessage(p.sectionTitle),isInput:!0,style:{marginTop:-4},children:[(0,ue.jsx)(Cd.Z,{capture:!0,allowEsc:!0,children:(0,ue.jsx)(Nt.ZP,{inputOuterStyle:{margin:o.device.isMobile?"8px 0":0,border:d?"1px solid red":void 0},type:"text",value:p.value||"",onChange:m,placeholder:be.default.formatMessage(p.inputPlaceholder),textarea:!0,disabled:!c,autosize:!0,autosizeMinHeight:100,autosizeMaxHeight:600},p.aiInferenceType)}),d&&(0,ue.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingLeft:12,fontSize:12},children:[(0,dt.t)({width:12,height:12,fill:"#D34F43"}),(0,ue.jsx)("div",{style:{color:"#D34F43",paddingLeft:4},children:((null===(t=p.value)||void 0===t?void 0:t.length)??0)>cd.Th?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Instruction is too long",id:"CollectionSettings.propertyTab.aiAutofill.promptInput.exceedsMaxLength"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Required",id:"CollectionSettings.propertyTab.aiAutofill.promptInput.required"})})]})]}):null}function jd(e){const{collectionContextStore:t,isAutofillSetupEnabled:o,draftAiInference:n,setDraftAiInference:i,environment:r,shouldShowUserPromptIsInvalidError:a,setShouldShowUserPromptIsInvalidError:s,doesUserHaveAIAddOn:l}=e;return n?"select"!==n.type&&"multi_select"!==n.type?null:(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(Et.Z,{style:{marginBottom:10},children:[(0,ue.jsx)(vd,{collectionContextStore:t,environment:r,setAiInference:i,aiInference:n,doesUserHaveAIAddOn:l}),(0,ue.jsx)(fd.Z,{setAiInference:i,aiInference:n})]}),n&&(0,ue.jsx)(Et.Z,{topBorder:!0,children:(0,ue.jsx)(wd,{environment:r,aiInference:n,setAiInference:i,collectionContextStore:t,isAutofillSetupEnabled:o,shouldShowUserPromptIsInvalidError:a,setShouldShowUserPromptIsInvalidError:s})})]}):null}var Md=o(87205),_d=o(99417);const kd=new Mn.Z;var Td=o(43765);const Ad=(0,l.defineMessages)({optionsSectionTitle:{defaultMessage:"Options",id:"database.viewSettings.propertyTab.aiAutofill.optionsSectionTitle"},whatToTranslate:{defaultMessage:"What to translate?",id:"CollectionSettingsPropertyAiAutofill.translateProperty.propertySelector"},translateTo:{defaultMessage:"Translate to",id:"CollectionSettingsPropertyAiAutofill.translateProperty.languageSelector"},selectorSearchPlaceholder:{defaultMessage:"Search",id:"CollectionSettingsPropertyAiAutofill.selectorOption.searchbar.placeholder"},allProperties:{defaultMessage:"All properties",id:"CollectionSettingsPropertyAiAutofill.selectorOption.allProperties.checkbox"},noAiAutofillSelected:{defaultMessage:"Select an option",id:"database.CollectionSettingsPropertyAiAutofill.noAiAutofillSelected"}});function Pd(e){window.__c={n:"CollectionSettingsTextPropertyAiAutofill"};const{collectionContextStore:t,propertySchema:o,previousPromptByAiInferenceType:i,isAutofillSetupEnabled:r,draftAiInference:a,setDraftAiInference:s,environment:l,propertyId:c,collectionSchema:d,shouldShowUserPromptIsInvalidError:u,setShouldShowUserPromptIsInvalidError:p,doesUserHaveAIAddOn:g}=e,m=(0,S.Fg)(),y=(0,n.useMemo)((()=>[new Mn.Z,new Mn.Z]),[]),h=(0,n.useMemo)((()=>function(e){var t;let{environment:o,aiInference:n,collectionSchema:i,setAiInference:r,property:a,theme:s,optionsButtonPopupStores:l}=e;if(!n||!(0,b.MD)(n.type))return[];switch(n.type){case"summarize":return[];case"translate":const e=Te.oA((0,ne.Yd)(i).map((e=>{if(e===a)return;const t=i[e];if(t&&(0,Md.K9)(t)){var o;if("text"===t.type&&"translate"===(null===(o=t.ai_inference)||void 0===o?void 0:o.type))return;return{id:e,option:t.name,icon:(0,ue.jsx)(Kt.ZP,{icon:t.icon,type:t.type,theme:s,size:16})}}}))),o=e.findIndex((e=>"title"===e.id));if(o&&o>0){const t=e[o];e.splice(o,1),e.unshift(t)}for(;l.length<2;)l.push(new Mn.Z);return[{type:"multi",options:e,selectedIds:(null===(t=n.targetProperties)||void 0===t?void 0:t.length)>0?n.targetProperties:["title"],setSelectedIds:e=>{r({...n,targetProperties:e})},selectorTitle:Ad.whatToTranslate,selectAllTitle:Ad.allProperties,buttonPopupStore:l[0]},{type:"single",options:Md.nI.map((e=>{let{key:t,name:o}=e;return{id:t,option:be.default.formatMessage(o)}})),selectedId:n.toLanguage,onSelect:e=>{r({...n,toLanguage:e})},selectorTitle:Ad.translateTo,buttonPopupStore:l[1]}];case"extract":case"custom":return[];default:(0,ne.t1)(n)}}({environment:l,aiInference:a,collectionSchema:d,setAiInference:s,property:c,theme:m,optionsButtonPopupStores:y})),[l,a,d,s,c,m,y]);return(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsxs)(Et.Z,{style:{marginBottom:10},children:[(0,ue.jsx)(Vd,{propertySchema:o,previousPromptByAiInferenceType:i,draftAiInference:a,setDraftAiInference:s,environment:l}),(0,b.by)(a,"text")&&(0,ue.jsx)(vd,{collectionContextStore:t,environment:l,setAiInference:s,aiInference:a,doesUserHaveAIAddOn:g})]}),(0,b.by)(a,"text")&&(0,ue.jsxs)(Et.Z,{topBorder:!0,children:[(0,ue.jsx)(wd,{environment:l,aiInference:a,setAiInference:s,collectionContextStore:t,isAutofillSetupEnabled:r,shouldShowUserPromptIsInvalidError:u,setShouldShowUserPromptIsInvalidError:p}),(0,ue.jsx)(Id,{environment:l,optionProps:h})]})]})}function Vd(e){let{propertySchema:t,previousPromptByAiInferenceType:o,draftAiInference:i,setDraftAiInference:r,environment:s}=e;window.__c={n:"AiPromptTypeSelectorSections"};const c=(0,a.VK)((()=>(0,Lt.k4)()),[]),d=(0,n.useCallback)((e=>{var n,i,a,s,l,d,u,p;if(!t||!(0,b.qQ)(t)||!e)return;let g;switch(e){case"summarize":g={type:e,auto_update_on_edit:c};break;case"translate":g={type:e,auto_update_on_edit:c,targetProperties:(null===(n=t.ai_inference)||void 0===n?void 0:n.type)===e?null===(i=t.ai_inference)||void 0===i?void 0:i.targetProperties:["title"],toLanguage:(null===(a=t.ai_inference)||void 0===a?void 0:a.type)===e?null===(s=t.ai_inference)||void 0===s?void 0:s.toLanguage:"english"};break;case"extract":g={type:e,prompt:(null===(l=t.ai_inference)||void 0===l?void 0:l.type)===e?null===(d=t.ai_inference)||void 0===d?void 0:d.prompt:o[e]??"",auto_update_on_edit:c};break;case"custom":g={type:e,prompt:(null===(u=t.ai_inference)||void 0===u?void 0:u.type)===e?null===(p=t.ai_inference)||void 0===p?void 0:p.prompt:o[e]??"",auto_update_on_edit:c};break;default:(0,ne.t1)(e)}r(g)}),[c,o,t,r]),u=(0,S.Fg)();return t&&(0,b.qQ)(t)?(0,ue.jsx)(ut.ZP,{popupType:s.device.isMobile?ut.Z4.SlideUp:ut.Z4.Popup,buttonPopupStore:kd,render:e=>{const t={key:"section",render:e=>(0,ue.jsx)(Et.Z,{...e}),items:Te.oA(Object.keys(_d.OE.text).map((t=>{if(("translate"!==t||(0,md.hu)())&&(0,b.MD)(t))return{key:t,render:e=>{const o=_d.OE.text[t];return(0,ue.jsx)(Rt.Z,{focused:!1,onClick:e.onClick,icon:o.svg({height:20,width:24,fill:u.aiPurpleColor}),title:be.default.formatMessage(o.name),checkState:(null==i?void 0:i.type)===t})},action:()=>{e.close(),d(t)}}})))};return(0,ue.jsx)(Ct.Z,{menuType:bt.og.Popup,minWidth:260,maxWidth:"100vw",children:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,initialFocus:void 0,sections:[t]})})},renderOrigin:e=>{let{onClick:t}=e;return(0,ue.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:14,marginLeft:4,marginRight:4,marginTop:8,paddingLeft:12,paddingRight:12,cursor:"pointer",height:28},onClick:t,children:[(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Fill with",id:"CollectionSettingsPropertyAiAutofill.ClosedSelector.Title"}),(0,ue.jsx)(Fd,{aiActionType:null==i?void 0:i.type})]})}}):null}function Fd(e){let{aiActionType:t}=e;window.__c={n:"AiActionRenderer"};const o=(0,S.Fg)(),n=t&&(0,b.MD)(t)?_d.OE.text[t]:{name:Ad.noAiAutofillSelected,svg:()=>null};return(0,ue.jsxs)("div",{style:{display:"flex",alignItems:"center",cursor:"pointer",fontSize:14,paddingLeft:15,paddingBottom:0},children:[(0,ue.jsx)("div",{style:{color:o.lightIconColor},children:n.svg({height:16,width:16,marginRight:2})}),(0,ue.jsx)("div",{style:{color:o.lightTextColor,paddingLeft:4},children:(0,ue.jsx)(l.FormattedMessage,{...n.name})}),(0,ue.jsx)("div",{style:{color:o.lightIconColor,paddingLeft:4},children:(0,Ot.o)({height:12,width:12})})]})}function Id(e){let{environment:t,optionProps:o}=e;return o&&o.length>0?(0,ue.jsx)(Et.Z,{title:be.default.formatMessage(Ad.optionsSectionTitle),isInput:!0,style:{marginTop:-4},children:o.map(((e,o)=>"multi"===e.type?(0,ue.jsx)(Bd,{environment:t,options:e.options,selectedIds:e.selectedIds,setSelectedIds:e.setSelectedIds,selectorTitle:e.selectorTitle,selectAllTitle:e.selectAllTitle,buttonPopupStore:e.buttonPopupStore},o):(0,ue.jsx)(Zd,{environment:t,options:e.options,selectedId:e.selectedId,onSelect:e.onSelect,selectorTitle:e.selectorTitle,buttonPopupStore:e.buttonPopupStore},o)))}):null}function Bd(e){let{environment:t,options:o,selectedIds:i,setSelectedIds:r,selectorTitle:s,selectAllTitle:c,buttonPopupStore:d}=e;window.__c={n:"CheckSelectorOption"};const[u,p]=(0,n.useState)(""),g=(0,S.Fg)(),m=o.filter((e=>i.includes(e.id))),y=(0,a.VK)((()=>Te.jj(Te.MR(o.map((e=>e.id)))).join(",")===Te.jj(Te.MR(i)).join(",")),[o,i]),h=e=>{i.includes(e)?r(i.filter((t=>t!==e))):r(Te.jj([...i,e]))},f=()=>{i.length<o.length?r(o.map((e=>e.id))):r(["title"])},x=(0,ue.jsx)(Et.Z,{desktopStyle:{paddingTop:12,paddingBottom:4},children:(0,ue.jsx)(Nt.ZP,{focusInitial:!t.device.isMobile||void 0,focus:!t.device.isMobile||void 0,value:u,onChange:e=>{p(e.target.value)},placeholder:be.default.formatMessage(Ad.selectorSearchPlaceholder)})});return(0,ue.jsx)(ut.ZP,{popupType:t.device.isMobile?ut.Z4.SlideUp:ut.Z4.Popup,buttonPopupStore:d,render:e=>{const t=o.filter((e=>{var t;const o=null===(t=e.option)||void 0===t?void 0:t.toLowerCase();return-1!==(null==o?void 0:o.indexOf(u.toLowerCase()))})).map((e=>{let{id:t,option:o,icon:n}=e;return{key:t,render:e=>(0,ue.jsx)(Rt.Z,{focused:!1,onClick:e.onClick,left:(0,ue.jsx)(fi.Z,{checked:i.includes(t),size:14,checkSize:8,onClick:e=>{h(t)}}),icon:n,title:o}),action:()=>{h(t)}}})),n={key:"section",render:e=>(0,ue.jsx)(Et.Z,{...e,topBorder:!0}),items:t},r={key:"all-items",render:e=>(0,ue.jsx)(Et.Z,{...e}),items:[{key:"all-items",render:e=>(0,ue.jsx)(Rt.Z,{focused:!1,onClick:()=>{f()},left:(0,ue.jsx)(fi.Z,{checked:y,size:14,checkSize:8,onClick:()=>{f()}}),title:be.default.formatMessage(c)}),action:()=>{f()}}]};return(0,ue.jsxs)(Ct.Z,{menuType:bt.og.Popup,minWidth:260,maxWidth:"100vw",children:[x,0===t.length?(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(Td.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"No results",id:"CollectionSettingsPropertyAiAutofill.searchBar.noResults.label"})})}):(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,initialFocus:void 0,sections:[r,n]})]})},renderOrigin:e=>(0,ue.jsx)(Jo.Z,{title:be.default.formatMessage(s),showChevron:!0,right:(0,ue.jsx)("div",{style:{color:g.lightTextColor,paddingLeft:4,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"90%"},children:Te.oA(m.map((e=>{let{id:t,option:o,icon:n}=e;return o}))).join(", ")}),rightStyle:{flexShrink:1},rotateChevron:d.state.open,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})})}function Zd(e){let{environment:t,options:o,selectedId:i,onSelect:r,selectorTitle:a,buttonPopupStore:s}=e;window.__c={n:"SelectorOption"};const[c,d]=(0,n.useState)(""),u=o.find((e=>e.id===i)),p=(0,S.Fg)(),g=(0,ue.jsx)(Et.Z,{desktopStyle:{paddingTop:12,paddingBottom:4},children:(0,ue.jsx)(Nt.ZP,{focusInitial:!t.device.isMobile||void 0,focus:!t.device.isMobile||void 0,value:c,onChange:e=>{d(e.target.value)},placeholder:be.default.formatMessage(Ad.selectorSearchPlaceholder)})});return(0,ue.jsx)(ut.ZP,{popupType:t.device.isMobile?ut.Z4.SlideUp:ut.Z4.Popup,buttonPopupStore:s,render:e=>{const t=o.filter((e=>{var t;return-1!==(null===(t=e.option)||void 0===t?void 0:t.toLowerCase().indexOf(c.toLowerCase()))})).map((t=>{let{id:o,option:n,icon:a}=t;return{key:o,render:e=>(0,ue.jsx)(Rt.Z,{focused:!1,onClick:e.onClick,icon:a,title:n,checkState:o===i}),action:()=>{e.close(),r(o)}}})),n={key:"section",render:e=>(0,ue.jsx)(Et.Z,{...e}),items:t};return(0,ue.jsxs)(Ct.Z,{menuType:bt.og.Popup,minWidth:260,maxWidth:"100vw",children:[g,0===t.length?(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(Td.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"No results",id:"CollectionSettingsPropertyAiAutofill.searchBar.noResults.label"})})}):(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,initialFocus:void 0,sections:[n]})]})},renderOrigin:e=>(0,ue.jsx)(Jo.Z,{title:be.default.formatMessage(a),showChevron:!0,right:u&&(0,ue.jsxs)(ue.Fragment,{children:[u.icon,(0,ue.jsx)("div",{style:{color:p.lightTextColor,paddingLeft:4,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"90%"},children:u.option})]}),rightStyle:{flexShrink:1},rotateChevron:s.state.open,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})})}var Kd=o(73420),Dd=o(91839);const Od=(0,l.defineMessages)({optionsSectionTitle:{defaultMessage:"Options",id:"database.viewSettings.propertyTab.aiAutofill.optionsSectionTitle"},removeAutofillButton:{defaultMessage:"Turn off AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.removeAutofillButton"},toggleFillWithAiSectionLabel:{defaultMessage:"Actions",id:"database.viewSettings.propertyTab.aiAutofill.actionsSectionLabel"},confirmOverwriteExistingPropertyValues:{defaultMessage:"Filling “{propertyName}” with AI will overwrite any existing values of the property. Are you sure you want to continue?",id:"database.viewSettings.propertyTab.aiAutofill.confirmOverwriteModal"},noAiAutofillSelected:{defaultMessage:"Select an option",id:"database.CollectionSettingsPropertyAiAutofill.noAiAutofillSelected"}});function Rd(e){window.__c={n:"CollectionSettingsPropertyAiAutofill"};const{property:t,collectionContextStore:o,collectionSettingsStore:i}=e,s=(0,a.VK)((()=>o.normalizedSchemaStore.state[t]),[t,o.normalizedSchemaStore]),c=(0,a.VK)((()=>o.collectionStore()),[o]),u=(0,a.VK)((()=>o.normalizedSchemaStore.getState()),[o]),g=s&&(0,b.qQ)(s)?(0,b.q3)(s):void 0,m=(0,r.O7)(),S=Ed(),y=(0,a.VK)((()=>{const e=o.collectionStore();return e&&(0,md.mX)(m,Sd.Z.getMode(m,e),e)}),[m,o]),h=St.default.createValue({stage:"not_started"});(0,n.useEffect)((()=>{var e,n;if("page"===o.getViewType())return;if(!1!==(null===(e=o.getPropertyFormat(t))||void 0===e?void 0:e.visible))return;const i=new Us.Z({name:"CollectionSettingsPropertyAiAutofill"});m.defaultRecordCache.inMemoryRecordCache.addCacheOverride(i);const r=null===(n=o.formatStore())||void 0===n?void 0:n.clone(i),a=o.getPropertyFormatKey();return r&&a&&p.createAndCommit({userAction:"CollectionSettingsPropertyAiAutofill.open",environment:m,perform:e=>{va.er({formatStore:r,formatKey:a,property:t,update:{visible:!0},transaction:e})}}),()=>{m.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(i)}}),[o,m,t]);const f=(0,n.useRef)({}),x=(0,a.VK)((()=>(0,Lt.k4)()),[]),[v,C]=(0,n.useState)(s&&gd.getDefaultAiInference(s,x)),[w,j]=(0,n.useState)(!1),M=(0,n.useCallback)((()=>{const e=o.collectionStore();if(!e||!s||!(0,b.qQ)(s))return;const n=(0,b.q3)(s);n&&"prompt"in n&&(f.current={...f.current,[n.type]:n.prompt}),gd.saveOrRemovePropertyAiInference({environment:m,propertySchema:s,collectionStore:e,property:t,draftAiInference:v})}),[o,s,v,t,m]),_=(0,a.VK)((()=>{var e;return(null===(e=o.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString())||""}),[o]),k=(0,n.useCallback)((async()=>{if(s&&(0,b.qQ)(s)&&Te.Xy(v,(0,b.q3)(s)))d.E3({collectionSettingsStore:i});else if(v){var e;if("prompt"in v)if((0,b.DS)(v)&&0===(null===(e=v.prompt)||void 0===e?void 0:e.length)||(0,ne.$K)(v.prompt)&&v.prompt.length>cd.Th)return void j(!0);(null==g||!g.auto_update_on_edit)&&null!=v&&v.auto_update_on_edit&&x&&s?await ud.r({sourceAction:"auto_update",propertyName:s.name,collectionName:_})&&M():M()}}),[_,i,g,v,M,x,s]),T=(0,n.useCallback)((()=>{const e=o.collectionStore();e&&g&&s&&(gd.saveOrRemovePropertyAiInference({environment:m,propertySchema:s,collectionStore:e,property:t,draftAiInference:null}),d.z$({collectionSettingsStore:i}))}),[o,g,m,s,t,i]),A=s&&(0,b.qQ)(s)&&Te.Xy(v,(0,b.q3)(s)),V=(0,n.useCallback)((async()=>new Promise((e=>{an.showDialog({showCancel:!1,keepFocus:!1,message:(0,ue.jsxs)(Kd.sg,{alignItems:"center",gap:8,children:[(0,P.y)(S.confirmDiscardChangesDialogIconStyle),(0,ue.jsx)("div",{style:S.confirmDiscardChangesDialogMessageStyle,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Do you want to discard changes for AI autofill?",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.message"})})]}),items:[{label:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Discard",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.acceptLabel"}),color:"red",onAccept:()=>e(!0)},{label:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Continue editing",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.cancelLabel"}),onAccept:()=>e(!1)}]})}))),[S]),F=(0,n.useCallback)((async()=>{(A||await V())&&d.z$({collectionSettingsStore:i})}),[A,i,V]),I=(0,n.useCallback)((async()=>{(A||await V())&&d.E3({collectionSettingsStore:i})}),[A,i,V]),B=(0,a.VK)((()=>{var e;const t=(null===(e=yd.default.state.data)||void 0===e?void 0:e.addOns)??[];return(0,dd.de)(t)}),[]);return s&&(0,b.qQ)(s)&&c?(0,ue.jsx)(cr.Z,{capture:!0,onEsc:I,children:(0,ue.jsxs)(Qo.ZP,{...e,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Fill “{propertyName}” with AI",id:"database.viewSettings.propertyTab.aiAutofill.title",values:{propertyName:s.name}}),handleBackArrowClick:F,handleClose:I,children:[!y&&(0,ue.jsx)(Et.Z,{style:S.menuItemStyle,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"You don't have permission to set up AI autofill on this database.",id:"database.viewSettings.propertyTab.aiAutofill.noSetupPermission"})}),"text"===s.type&&(0,ue.jsx)(Pd,{collectionContextStore:o,propertySchema:s,previousPromptByAiInferenceType:f.current,isAutofillSetupEnabled:Boolean(y),draftAiInference:v,setDraftAiInference:C,environment:m,propertyId:t,collectionSchema:u,shouldShowUserPromptIsInvalidError:w,setShouldShowUserPromptIsInvalidError:j,doesUserHaveAIAddOn:B}),(0,b.cu)(s)&&(0,ue.jsx)(jd,{collectionContextStore:o,isAutofillSetupEnabled:Boolean(y),draftAiInference:v,setDraftAiInference:C,environment:m,shouldShowUserPromptIsInvalidError:w,setShouldShowUserPromptIsInvalidError:j,doesUserHaveAIAddOn:B}),(0,b.by)(v,s.type)&&(0,ue.jsxs)(Et.Z,{children:[(0,ue.jsx)(Nd,{environment:m,isAutofillSetupEnabled:y,collectionContextStore:o,tryAutofillStore:h,propertySchema:s,property:t,aiInference:v}),(0,ue.jsx)(co.Z,{style:{...S.buttonStyle,margin:"8px 12px 12px 12px",display:A?"none":"flex"},onClick:k,disabled:!y,children:A?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Done",id:"database.viewSettings.propertyTab.aiAutofill.saveButtonAllSaved"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Save changes",id:"database.viewSettings.propertyTab.aiAutofill.saveButtonWithChanges"})})]}),(0,ue.jsxs)(Et.Z,{topBorder:!0,title:m.device.isMobile&&be.default.formatMessage(Od.toggleFillWithAiSectionLabel),children:[(0,b.by)(g,s.type)&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(hd.TB,{environment:m,collectionContextStore:o,collectionStore:c,property:t,propertySchema:s,doesUserHaveAIAddOn:B,isAutofillSetupEnabled:Boolean(y)}),(0,ue.jsx)(Jo.Z,{icon:jn.y,isRed:!0,focused:!1,title:be.default.formatMessage(Od.removeAutofillButton),onClick:T,disabled:!y})]}),(0,ue.jsx)(Xl.Z,{href:(0,Hl.UY)("guides.aiAutofill"),title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Learn about AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.learnMoreLink"}),analyticsFrom:"collection_ai_autofill_menu"})]})]})}):null}function Nd(e){let{environment:t,isAutofillSetupEnabled:o,collectionContextStore:i,tryAutofillStore:r,propertySchema:d,property:u,aiInference:p}=e;window.__c={n:"TryOnThisViewActionSection"};const[g,m]=(0,n.useState)((0,s.ZP)()),S=(0,n.useRef)((0,s.ZP)()),y=(0,a.VK)((()=>r.state.stage),[r]),h=(0,a.VK)((()=>{const e=i.contextType;if("collectionPage"===e)return{type:"page",candidateBlockStores:Te.oA([(0,fl.np)()])};if("collectionTypedView"===e||"collectionView"===e)return{type:"collection",candidateBlockStores:i.resultsInViewOrder(5)};throw new Error(`Unexpected context type: ${e}`)}),[i]),f=(0,n.useCallback)((()=>{var e;c.qG2(t,{ai_inference_type:p.type,type:"undo_from_collection_settings",inference_id:g,collection_id:null===(e=i.collectionStore())||void 0===e?void 0:e.id,session_id:S.current}),"not_started"!==y&&(pd.Yw(t,!1),r.setState({stage:"not_started"}))}),[t,p,g,i,y,r]),x=(0,ne.Of)(h.candidateBlockStores),v=Ed({isTryAutofillEnabled:o&&x});if(t.device.isMobile)return null;let C;return C=x?"collection"===h.type?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Updates the first {maxPages} pages. You can undo changes anytime.",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollectionDescription",values:{maxPages:5}}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:'Updates "{propertyName}" on this page. You can undo changes anytime.',id:"database.viewSettings.propertyTab.aiAutofill.tryOnPageDescription",values:{propertyName:d.name}}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Add more pages or remove filters to try AI on this view.",id:"database.viewSettings.propertyTab.tryAutofillDisabledDescription"}),(0,ue.jsx)(n.Fragment,{children:(0,ue.jsx)("div",{style:{margin:"8px 12px"},children:(0,ue.jsxs)(Kd.X2,{gap:8,children:[(0,ue.jsx)(Tt.Z,{disabled:!o||!x,style:{...v.buttonStyle,...v.undoButtonStyle,..."not_started"===y&&{display:"none"}},onClick:f,children:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Undo",id:"database.viewSettings.propertyTab.aiAutofill.undoButton"})}),(0,ue.jsx)(re.Z,{renderTooltip:()=>(0,ue.jsx)("div",{children:C}),render:e=>(0,ue.jsx)(Tt.Z,{...e,disabled:!o||!x,style:{...v.buttonStyle,...v.tryButtonStyle},hoveredStyle:v.tryButtonHoveredStyle,pressedStyle:v.tryButtonPressedStyle,onClick:async()=>{if((0,ne.Of)(h.candidateBlockStores)){const e=(0,s.ZP)();m(e),r.setState({stage:"in_progress"}),await gd.autofillPropertyForBlocks({environment:t,stores:h.candidateBlockStores,property:u,propertySchema:d,aiInferenceOverride:p,userEventForAnalytics:"generate_from_try_on_view_button",sessionIdForAnalytics:S.current,collectionContextStore:i,from:"ai_autofill_settings"}),r.setState({stage:"complete"})}},children:"in_progress"===y?(0,ue.jsx)(Dd.Z,{}):(0,ue.jsxs)(ue.Fragment,{children:[(0,P.y)({width:16,..."not_started"!==y&&{display:"none"}}),"not_started"!==y?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Try again",id:"database.viewSettings.propertyTab.aiAutofill.tryAgain"}):"collection"===h.type?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Try on this view",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollection"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Try on this page",id:"database.viewSettings.propertyTab.aiAutofill.tryOnPage"})]})})})]})})})}function Ed(e){const t=(0,S.Fg)();return(0,S.yK)((()=>({buttonStyle:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8},menuItemStyle:{fontSize:13,borderRadius:6,background:t.accentColors.purple[50],color:t.accentColors.purple[500],margin:"8px 12px",padding:"8px 12px"},undoButtonStyle:{border:`1px solid ${t.accentColors.gray[100]}`,flex:1},tryButtonStyle:{fontWeight:500,flex:1,background:null!=e&&e.isTryAutofillEnabled?"light"===t.mode?t.accentColors.purple[50]:t.accentColors.purple[200]:t.accentColors.gray[50],color:null!=e&&e.isTryAutofillEnabled?t.aiPurpleColor:t.accentColors.gray[400]},fillAllPagesWandIconStyle:{fill:t.aiPurpleColor},tryButtonHoveredStyle:{background:t.accentColors.purple[100]},tryButtonPressedStyle:{background:t.accentColors.purple[200]},confirmDiscardChangesDialogIconStyle:{width:32,height:32,fill:t.aiPurpleColor,paddingTop:8},confirmDiscardChangesDialogMessageStyle:{textAlign:"center",fontWeight:500}})),[t,null==e?void 0:e.isTryAutofillEnabled])}var Wd=o(88268),Ld=o(16732);const Gd=(0,l.defineMessages)({upgradeButton:{id:"appTemplateUpgradeActions.upgradeConfirmationDialog.upgrade.label",defaultMessage:"Upgrade"},cancelUpgradeButton:{id:"appTemplateUpgradeActions.upgradeConfirmationDialog.cancelUpgrade.label",defaultMessage:"Don't upgrade"}});async function Ud(e){const{environment:t,collectionViewBlockStore:o,collectionSettingsStore:n}=e,i=null==o?void 0:o.getFormat().app_config_uri,r=null==o?void 0:o.getParentStore();if(!o||i!==zs.TZ&&i!==zs.pz)return!1;const a=i===zs.TZ?o:await jc.JN({environment:t,collectionViewBlockStore:o,databaseUri:zs.iS}),s=i===zs.pz?o:await jc.JN({environment:t,collectionViewBlockStore:o,databaseUri:zs.p$});return!(!(a&&s&&r)||r.table!==bl.bx&&r.table!==Ee.iU&&r.table!==wl.e0)&&(an.showDialog({message:(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)("div",{children:"Upgrade Existing Sprints to Latest?"}),(0,ue.jsx)("div",{style:{fontSize:12,padding:8},children:"This will update your Sprints Database, and change some existing views and properties."})]}),items:[{label:be.default.formatMessage(Gd.upgradeButton),color:"red",onAccept:async()=>{await async function(e){var t;const{environment:o,appParentStore:n,collectionViewBlockStore:i}=e,r=null===(t=i.getFormat())||void 0===t?void 0:t.app_uri_map,a=i.getCollectionStore();if(!r||!a)return;const s=await zd(i,n),l=(0,b.oC)({id:a.id,format:a.getFormat(),space_id:a.getSpaceId(),schema:a.getSchema()});p.createAndCommit({userAction:"appTemplateActions.upgradeSprintsDatabaseFromV1ToV2",environment:o,perform:e=>{Ca.Rm({environment:o,collectionStore:a,update:Hd[zs.p$](l,a.getFormat()),transaction:e}),s.forEach((t=>{const o=t.id,n=t.getFormat(),i=t.getQuery(l);r["notion://sprints/sprints_timeline_view"]===o?Ca.iG({collectionViewStore:t,update:Hd["notion://sprints/sprints_timeline_view"](n,i),transaction:e}):r["notion://sprints/sprints_view"]===o&&Ca.iG({collectionViewStore:t,update:Hd["notion://sprints/sprints_view"](n,i),transaction:e})}))}})}({environment:t,appParentStore:r,collectionViewBlockStore:s}),await async function(e){var t;const{environment:o,appParentStore:n,collectionViewBlockStore:i}=e,r=null===(t=i.getFormat())||void 0===t?void 0:t.app_uri_map;if(!r)return;const a=await zd(i,n);p.createAndCommit({userAction:"appTemplateActions.upgradeTasksDatabaseSprintsFeatureFromV1ToV2",environment:o,perform:e=>{a.forEach((t=>{const o=t.id,n=t.getFormat();if(r[zs.g3]===o){const o=Hd[zs.g3](n);Ca.iG({collectionViewStore:t,update:o,transaction:e})}else r[zs.y$]===o&&Ca.iG({collectionViewStore:t,update:Hd[zs.y$](n),transaction:e})}))}})}({environment:t,appParentStore:r,collectionViewBlockStore:a}),n.setState({open:!1,stack:[]})}},{label:be.default.formatMessage(Gd.cancelUpgradeButton),onAccept:()=>{}}],showCancel:!1,keepFocus:!0}),!0)}async function zd(e,t){return await Promise.all(e.getCollectionViewPointers().map((async e=>{const o=Ge.Xr.createChildStore(t,e);return await o.load(),o})))}const Hd={[zs.g3]:e=>({name:be.default.formatMessage(Ld.sY.tasksCurrentSprintV2ViewName),format:{...e,property_filters:[...(e.property_filters??[]).filter((e=>e.filter.property!==zs.Es.SprintStatusRollup)),Ld.Ws]}}),[zs.y$]:e=>({format:{...e,property_filters:[...(e.property_filters??[]).filter((e=>e.filter.property!==zs.Es.TaskToSprintRelation))],table_properties:[...(e.table_properties??[]).filter((e=>e.property!==zs.Es.SprintStatusRollup)),{property:zs.Es.SprintStatusRollup,visible:!1}]}}),[zs.p$]:(e,t)=>({schema:{...e,[zs.b0.UniqueId]:Wd.eK(be.default.getIntl())[zs.b0.UniqueId],[zs.b0.TotalTasksRollup]:Ld.X$,[zs.b0.CompletedTasksRollup]:Ld.sU,[zs.b0.StatusV2]:Wd.eK(be.default.getIntl())[zs.b0.StatusV2]},format:{...t,app_uri_map:{...(null==t?void 0:t.app_uri_map)||{},[zs.b0.UniqueId]:zs.b0.UniqueId,[zs.b0.TotalTasksRollup]:zs.b0.TotalTasksRollup,[zs.b0.CompletedTasksRollup]:zs.b0.CompletedTasksRollup,[zs.b0.StatusV2]:zs.b0.StatusV2}}}),"notion://sprints/sprints_timeline_view":(e,t)=>({format:{...e,table_properties:[...(e.table_properties??[]).filter((e=>e.property!==zs.b0.Status)),{width:147,visible:!1,property:zs.b0.Status},{width:147,visible:!0,property:zs.b0.StatusV2}],timeline_table_properties:[...(e.timeline_table_properties??[]).filter((e=>e.property!==zs.b0.Status)),{width:132,visible:!1,property:zs.b0.Status},{width:132,visible:!0,property:zs.b0.StatusV2}],collection_group_by:{sort:{type:"ascending"},type:"status",groupBy:"group",property:zs.b0.StatusV2}},query2:{...t??{},sort:[...(null==t?void 0:t.sort)??[],{property:zs.b0.StatusV2,direction:"ascending"}]}}),"notion://sprints/sprints_view":(e,t)=>({format:{...e,table_properties:[...(e.table_properties??[]).filter((e=>e.property!==zs.b0.Status)),{width:137,visible:!1,property:zs.b0.Status},{width:137,visible:!0,property:zs.b0.StatusV2},{width:75,visible:!0,property:zs.b0.TotalTasksRollup}],collection_group_by:{sort:{type:"ascending"},type:"status",groupBy:"group",property:zs.b0.StatusV2}},query2:{...t??{},sort:[...(null==t?void 0:t.sort)??[],{property:zs.b0.StatusV2,direction:"ascending"}]}})};var $d=o(90559),qd=o(10070),Xd=o(87085),Yd=o(76235);function Qd(e){var t,o;const{render:n,showDisabledTooltip:i,property:r,overrideCaption:a}=e;let s=r.description;if(a)s=a;else if(i){var l;s=null===(l=r.canOnlyAdminAuth)||void 0===l?void 0:l.disabledPropertyTooltipMessage}return(0,ue.jsx)(ds,{render:n,showImage:!i,caption:s,tooltipImage:null===(t=r.tooltipImage)||void 0===t?void 0:t.img,tooltipImageScale:null===(o=r.tooltipImage)||void 0===o?void 0:o.scale})}var Jd=o(54119),eu=o(15560),tu=o(45959),ou=o(95477);var nu=o(4850),iu=o(32363);var ru=o(33954),au=o(85644),su=o(12205);const lu=(0,l.defineMessages)({duplicateGithubPropertyTooltip:{defaultMessage:"A database can only have one GitHub Pull Requests property",id:"database.viewSettings.propertyTab.duplicateGithubProperty.tooltip"},wikiGithubPropertyTooltip:{defaultMessage:"A wiki cannot have a GitHub Pull Requests property",id:"database.viewSettings.propertyTab.wikiGithubProperty.tooltip"},syncedDatabaseGithubPropertyTooltip:{defaultMessage:"A synced database cannot have a GitHub Pull Requests property",id:"database.viewSettings.propertyTab.syncedDatabaseGithubProperty.tooltip"},nonMeetingsCronPropertyTooltip:{defaultMessage:"The Cron Calendar property can only be added to a Meetings database",id:"database.viewSettings.propertyTab.nonMeetingsCronProperty.tooltip"},duplicateCronEventPropertyTooltip:{defaultMessage:"A database can only have one Cron Calendar event property",id:"database.viewSettings.propertyTab.duplicateCronEventProperty.tooltip"},newPill:{defaultMessage:"New",id:"database.viewSettings.newHighlightedFeature"}});function cu(e){let{collectionContextStore:t,propertySchema:o}=e;const i=(0,r.O7)(),s=(0,S.Fg)(),l=(0,a.VK)((()=>nn.default.checkGate("recurring_sprints")),[]),c=(0,a.VK)((()=>t.collectionStore()),[t]),d=(0,a.VK)((()=>{if(!c)return;return c.getParentBlockStore()}),[c]),u=(0,a.VK)((()=>gt.Z.bots.state),[]),p=(0,a.VK)((()=>{var e;if(!c)return;const t=null===(e=c.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,hs.YB)((0,Yd.appConfigs)(),t):void 0}),[c]),g=(0,a.VK)((()=>{if(!c||!d||!p)return;if(void 0!==o)return;const e=c.isDefined()?function(e,t,o){const n=t=>{var n,i;const r=null===(n=o.format)||void 0===n?void 0:n.app_config_uri,a=qd.aQ.deriveTypeUris(o.schema??{},null===(i=o.format)||void 0===i?void 0:i.app_uri_map);if(t.collectionUri!==r)return!1;const s=po.default.state.mainEditorCurrentBlockStore,l=s&&Sd.Z.getMode(e,s),c=(0,md.GD)(l);let d=!0;return t.uri===(0,Ld.GT)().uri&&a.has(zs.Es.GithubPrsRelation)&&(d=!1),t.dependencies.some((e=>"property"===e.type&&e.collectionUri===r&&(0,zs.jP)(e.uri)&&!a.has(e.uri)))&&(!t.isAi||c)&&d},i={};t.allFeatures.forEach((e=>{(0,hs.FW)(e)&&e.variants.every((e=>Boolean(t.allFeatures.find((t=>t.uri===e&&(0,hs.oX)(t)&&n(t))))))&&(i[e.uri]=e.variants)}));const r=Object.values(i).flat();return t.allFeatures.filter((e=>(0,hs.oX)(e)&&!r.find((t=>t===e.uri))?n(e):!!(0,hs.FW)(e)&&Boolean(i[e.uri]))).sort(((e,t)=>(0,hs.FW)(e)?-1:(0,hs.FW)(t)?1:e.dependencies.length-t.dependencies.length))}(i,p,{format:c.getFormat(),space_id:c.getSpaceId(),schema:c.getSchema()}):void 0;return e&&l?e.filter((e=>e.uri!==(0,Ld.eu)().uri)):e}),[c,d,p,o,i,l]),m=(0,su.J)();return{suggestedProperties:g,renderSuggestedProperty:n.useCallback((e=>{const o=e.integrationId,n=Boolean(u.find((e=>e.integration_id===o))),r=Boolean(e.canOnlyAdminAuth),a=(0,w.gi)(n,m,r,i.device.isMobile),l=(e,t,o,n)=>{const i=qd.aQ.deriveTypeUris((null==c?void 0:c.getSchema())??{},null==c?void 0:c.getPropertyMapping()),r=o.dependencies.find((e=>{var t;return"property"===e.type&&e.collectionUri===(null==c||null===(t=c.getFormat())||void 0===t?void 0:t.app_config_uri)&&(0,zs.jP)(e.uri)&&!i.has(e.uri)})),l=o.dependencies.find((e=>"property"===e.type&&(0,b.qQ)(e.propertySchema)&&(0,b.q3)(e.propertySchema)));if(r)return(0,ue.jsx)(Rt.Z,{...e,disabled:a,disabledFeedback:a,title:(0,ue.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[t,l?(0,ue.jsx)(Jd.Z,{}):null,o.isNew?"notion://projects/tasks_with_sprints_feature"===o.uri&&(0,ue.jsx)(eu.Z,{}):null]}),icon:(0,ue.jsx)(Kt.ZP,{type:r.propertySchema.type,theme:s,icon:n,size:16,style:{fill:s.regularIconColor}})})};return{key:e.name,render:o=>(0,ue.jsx)(Qd,{showDisabledTooltip:a,property:e,render:n=>{if((0,hs.oX)(e))return l({...o,...n,onMouseEnter:e=>{var t,i;null===(t=n.onMouseEnter)||void 0===t||t.call(n,e),null===(i=o.onMouseEnter)||void 0===i||i.call(o,e)}},e.name,e,e.icon);{const r=Te.oA(e.variants.map((e=>{const t=null==p?void 0:p.allFeatures.find((t=>t.uri===e));if(t&&(0,hs.oX)(t))return t})));return(0,ue.jsx)(tu.Z,{items:r,getKey:e=>e.name,onSelect:async e=>{await Xd.G0({environment:i,feature:e,collectionContextStore:t})},selectedItem:void 0,renderOrigin:t=>l({...o,...n,...t,onMouseEnter:e=>{var t,i;null===(t=n.onMouseEnter)||void 0===t||t.call(n,e),null===(i=o.onMouseEnter)||void 0===i||i.call(o,e)}},e.name,r[0],e.icon),renderItem:e=>(0,ue.jsx)(Rt.Z,{...e,title:e.value.name,shouldWrapCaption:!0,shouldWrapTitle:!0})})}}}),action:async()=>{await Xd.G0({environment:i,feature:e,collectionContextStore:t})}}}),[u,m,i,c,s,null==p?void 0:p.allFeatures,t])}}function du(e){let{collectionContextStore:t,propertyTypes:o,onAccept:i,propertySchema:r}=e;const s=(0,S.Fg)(),l=(0,a.VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getSchema()}),[t]),c=(0,a.VK)((()=>t.collectionViewBlockStore()),[t]),d=n.useCallback((()=>{if(!(0,au.iL)()||null==c||!c.isCollectionViewPageWithContent()||r&&"verification"!==r.type)return!1;for(const e in l){const t=l[e];if("verification"===(null==t?void 0:t.type))return!1;if((0,w.Kp)(t))return!1}return!0}),[r,l,c]),u=n.useCallback((()=>{for(const t in l){var e;const o=l[t];if("text"===(null==o?void 0:o.type)&&"summarize"===(null===(e=o.ai_inference)||void 0===e?void 0:e.type))return!1}return!0}),[l]);return{standardAndDerivedPropertyTypes:(0,a.VK)((()=>o.filter((e=>"button"===e?(0,Wt.PN)():"auto_increment_id"===e?nn.default.checkGate("unique_id"):"verification"===e?d():"ai_summary"===e?u():"ai_translate"===e?(0,md.hu)():"ai_category"!==e&&"ai_keywords"!==e||(0,md.KZ)()))),[o,d,u]),renderStandardOrDerivedProperty:n.useCallback(((e,o)=>({key:e,render:n=>{const i=(null==r?void 0:r.type)===e,a=function(e,t,o){if("auto_increment_id"===t){var n;const t=e.collectionStore(),i=null==t?void 0:t.isPageTreeCollection(),r=Boolean(null==t?void 0:t.isSyncedCollection());if(i)return be.default.formatMessage(ru.zU.wiki_forbidden_auto_increment_id_property);if(r)return be.default.formatMessage(ru.zU.synced_database_forbidden_auto_increment_id_property);if(null!=o&&o.type)return be.default.formatMessage(ru.zU.convert_to_auto_increment_id_property);const a=t&&t.id,s=t&&t.getFormat(),l=t&&(null===(n=t.getSpaceStore())||void 0===n?void 0:n.id),c=t&&t.getSchema(),d=t&&t.getDeletedSchema();if(!(a&&s&&l&&c&&d))return;if(t&&(0,$d.cj)({id:a,format:s,space_id:l,schema:c,deleted_schema:d}))return be.default.formatMessage(ru.zU.duplicate_auto_increment_id_property)}}(t,e,r),l=void 0!==a,c=(0,ue.jsx)(Rt.Z,{...n,checkState:i,title:(0,ue.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[o??Lt.SO[e],!1]}),icon:(0,ue.jsx)(Kt.ZP,{type:e,icon:void 0,size:16,theme:s,style:{fill:(0,b.XU)(e)?s.aiPurpleColor:s.regularIconColor}}),disabled:l,disabledFeedback:l});return a?(0,ue.jsx)(re.Z,{placement:re.Z.Placement.Left,render:e=>(0,ue.jsx)("div",{...e,children:c}),renderTooltip:()=>a,style:{whiteSpace:"break-spaces"}}):c},action:()=>{i(e,o)}})),[r,t,s,i])}}const uu=new Set([ro.Nw]);function pu(e,t){const o=(0,r.O7)(),i=(0,l.useIntl)(),s=(0,a.VK)((()=>gt.Z.bots.state),[]),c=(0,a.VK)((()=>e.collectionStore()),[e]),d=(0,a.VK)((()=>null==c?void 0:c.getSchema()),[c]),u=(0,a.VK)((()=>null==c?void 0:c.isPageTreeCollection()),[c]),p=(0,a.VK)((()=>e.databaseType),[e]),g=(0,a.VK)((()=>{var e;return null===(e=po.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit()}),[]),m=(0,a.VK)((()=>{if(void 0===t)return function(e,t){if(!e)return[];const o=nn.default.checkGate("google_drive_connected_relation"),n=nn.default.checkGate("figma_connected_relation"),i=nn.default.checkGate("zendesk_connected_relation"),r=nn.default.checkGate("cron_connected_relation"),a=nn.default.checkGate("connected_relation"),s=e.getDatabaseType()===zs.iS,l=gt.Z.state;if(!l.loaded)return[];const c=l.integrations,d={};if(!s){const e=c.find((e=>e.id===ro.U9)),t=(0,Ld.GT)();var u;e&&(d[t.name]={name:t.name,pattern:nu.x,integration:e,tooltipImage:{img:io.Z.images.tooltips.properties.githubSyncPullStatusPng,scale:.5},description:t.description,canOnlyAdminAuth:{disabledPropertyTooltipMessage:null===(u=t.canOnlyAdminAuth)||void 0===u?void 0:u.disabledPropertyTooltipMessage}})}const p=[];if(t&&(o&&p.push(ro.f3),n&&p.push(ro.mQ),i&&p.push(ro.Nw)),r&&p.push(ro.Dv),p.forEach((e=>{const t=c.find((t=>t.id===e));if(null!=t&&t.info.original_url_patterns)for(const n of t.info.original_url_patterns){var o;null!==(o=n.additional_types)&&void 0!==o&&o.connectedRelation&&(d[n.name]||(d[n.name]={name:(0,iu.ni)({pattern:n,integration:t}),pattern:n,integration:t}))}})),!a)return Object.values(d);for(const m of c)if(m.info.original_url_patterns&&t&&![ro.U9,ro.f3,ro.mQ,ro.Dv,ro.Nw].includes(m.id))for(const e of m.info.original_url_patterns){var g;null!==(g=e.additional_types)&&void 0!==g&&g.connectedRelation&&(d[e.name]||(d[e.name]={name:(0,iu.ni)({pattern:e,integration:m}),pattern:e,integration:m}))}return Object.values(d)}(c,g)}),[c,t,g]),S=(0,a.VK)((()=>Boolean(null==c?void 0:c.isSyncedCollection())),[c]),y=(0,su.J)();return{connectedRelationProperties:m,renderConnectedRelationProperty:n.useCallback((t=>{const n=t.integration.id,r=Boolean(s.find((e=>e.integration_id===n))),a=Boolean(t.canOnlyAdminAuth),l=Boolean(d&&(0,ne.qP)(d).find((e=>{let[t,o]=e;return o&&(0,w.Kp)(o)}))),c=Boolean(d&&(0,ne.qP)(d).find((e=>{let[t,o]=e;return o&&(0,w.A0)(o)}))),g=t.integration.id===ro.U9&&l||u||S;let m;g&&(l?m=i.formatMessage(lu.duplicateGithubPropertyTooltip):u?m=i.formatMessage(lu.wikiGithubPropertyTooltip):S&&(m=i.formatMessage(lu.syncedDatabaseGithubPropertyTooltip)));const h=p===zs.Fi,f=t.integration.id===ro.Dv&&(!h||c);f&&(h?c&&(m=i.formatMessage(lu.duplicateCronEventPropertyTooltip)):m=i.formatMessage(lu.nonMeetingsCronPropertyTooltip));const x=(0,w.gi)(r,y,a,o.device.isMobile)||g||f;return{key:t.name,render:e=>(0,ue.jsx)(Qd,{showDisabledTooltip:x,property:t,overrideCaption:m,render:o=>(0,ue.jsx)(Rt.Z,{...e,...o,checkState:!1,title:(0,ue.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[t.name,uu.has(t.integration.id)?(0,ue.jsx)(Fc.Z,{}):null]}),icon:(0,ue.jsx)("img",{src:t.integration.info.icon,alt:t.name,style:{width:16,height:16}}),disabled:x,disabledFeedback:x})}),action:async()=>{await Xd.Jw({environment:o,connectedRelationProperty:t,collectionContextStore:e,intl:i})}}}),[s,e,p,o,i,y,S,u,d])}}const gu=(0,l.defineMessages)({searchPlaceholder:{defaultMessage:"Search or add new property",id:"database.viewSettings.propertyTypeSelect.searchPlaceholder"},suggestedSectionTitle:{defaultMessage:"Suggested",id:"database.viewSettings.propertyTypeSection.suggested"},connectedRelationSectionTitle:{defaultMessage:"Connections",id:"database.viewSettings.propertyTypeSection.connected"},typesSectionTitle:{defaultMessage:"Type",id:"database.viewSettings.propertyTab.propertyType"},newProperty:{defaultMessage:"New property",id:"database.viewSettings.newProperty"},newPropertyWithDatabaseName:{defaultMessage:"New property on {databaseName}",id:"database.viewSettings.newPropertyOnDatabase"},selectToAddNewProperty:{defaultMessage:"Select to add",id:"database.viewSettings.selectToAdd"}});function mu(e){window.__c={n:"CollectionSettingsPropertyType"};const t=(0,r.Fy)(),[o,i]=n.useState(""),{collectionContextStore:s,propertyTypes:l,onAccept:c,propertySchema:d}=e,u=(0,r.O7)(),p=(0,a.VK)((()=>{var e;return null==s||null===(e=s.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()}),[s]),{connectedRelationProperties:g,renderConnectedRelationProperty:S}=pu(e.collectionContextStore,e.propertySchema),{standardAndDerivedPropertyTypes:y,renderStandardOrDerivedProperty:h}=du({collectionContextStore:s,propertyTypes:l,onAccept:c,propertySchema:d}),{suggestedProperties:f,renderSuggestedProperty:x}=cu({collectionContextStore:e.collectionContextStore,propertySchema:e.propertySchema}),{derivedPropertyTypesInSuggestedSection:v}=(0,n.useMemo)((()=>{const e=new Set;for(const t of y)(0,b.XU)(t)&&"suggested"===(0,Lt.to)(t)&&e.add(t);return{derivedPropertyTypesInSuggestedSection:e}}),[y]);n.useEffect((()=>{!async function(){const e=await async function(e,t){if(!(0,hs.Ru)()||!t.permissionScopes.state.canConfigureCollection)return!1;const o=t.collectionStore(),n=t.collectionViewBlockStore();if(!n)return!1;const i=n.getFormat();if((null==i?void 0:i.app_config_uri)===zs.TZ){var r;const t=await jc.JN({environment:e,collectionViewBlockStore:n,databaseUri:zs.p$});if(!t)return!1;const o=null==t?void 0:t.getCollectionStore();return Boolean(!(null!=o&&null!==(r=o.getPropertyMapping())&&void 0!==r&&r[zs.b0.StatusV2]))}var a;return(null==i?void 0:i.app_config_uri)===zs.pz&&Boolean(!(null!=o&&null!==(a=o.getPropertyMapping())&&void 0!==a&&a[zs.b0.StatusV2]))}(u,s);w(e)}()}),[s,u]);const[C,w]=(0,n.useState)(!1),j=n.useCallback((async()=>{await Ud({environment:u,collectionViewBlockStore:s.collectionViewBlockStore(),collectionSettingsStore:e.collectionSettingsStore})}),[s,u,e.collectionSettingsStore]),M=(0,n.useMemo)((()=>new Map(y.map((e=>[Lt.SO[e],e])))),[y]);let _=[];if(""!==o){const e=(null==f?void 0:f.reduce(((e,t)=>(e[t.name]=x(t),e)),{}))||{};for(const o of v)e[Lt.SO[o]]=h(o);const t=(null==g?void 0:g.reduce(((e,t)=>(S&&(e[t.name]=S(t)),e)),{}))||{},n=m().filter(o,Object.keys(e)).flatMap((t=>e[t.original])),i=m().filter(o,Array.from(M.keys())).flatMap((e=>{const t=M.get(e.original);return!t||v.has(t)?[]:h(t)})),r=m().filter(o,Object.keys(t)).flatMap((e=>t[e.original]));n.length&&_.push({key:"suggested",render:e=>(0,ue.jsx)(Et.Z,{...e,title:be.default.formatMessage(gu.suggestedSectionTitle)}),items:n}),i.length&&_.push({key:"search",render:e=>(0,ue.jsx)(Et.Z,{title:be.default.formatMessage(gu.typesSectionTitle),...e}),items:i}),r.length&&_.push({key:"connected",render:e=>(0,ue.jsx)(Et.Z,{...e,title:be.default.formatMessage(gu.connectedRelationSectionTitle)}),items:r}),0===n.length&&0===i.length&&_.push({key:"custom",render:e=>(0,ue.jsx)(Et.Z,{...e,title:be.default.formatMessage(gu.selectToAddNewProperty)}),items:[h("text",o)]})}else{const e=(null==f?void 0:f.map((e=>x(e))))??[];for(const n of v)e.push(h(n));const t=y.map((e=>v.has(e)?void 0:h(e))).filter(ne.$K),o=(null==g?void 0:g.map((e=>S&&S(e))).filter(ne.$K))??[];_=Te.oA([e.length&&{key:"suggested",render:e=>(0,ue.jsx)(Et.Z,{...e,title:be.default.formatMessage(gu.suggestedSectionTitle)}),items:e},t.length&&{key:"properties",render:e=>(0,ue.jsx)(Et.Z,{...e,title:be.default.formatMessage(gu.typesSectionTitle)}),items:t},o.length&&{key:"connected",render:e=>(0,ue.jsx)(Et.Z,{...e,title:be.default.formatMessage(gu.connectedRelationSectionTitle)}),items:o}])}const k=(0,ue.jsx)(Et.Z,{desktopStyle:{paddingTop:12,paddingBottom:4},children:(0,ue.jsx)(Nt.ZP,{focusInitial:!t.isMobile||void 0,focus:!t.isMobile||void 0,value:o,onChange:e=>{i(e.target.value)},placeholder:be.default.formatMessage(gu.searchPlaceholder)})});return(0,ue.jsxs)(Qo.ZP,{...e,title:t.isDesktop&&p?be.default.formatMessage(gu.newPropertyWithDatabaseName,{databaseName:p}):be.default.formatMessage(gu.newProperty),children:[k,C&&(0,ue.jsxs)(An.Z,{style:{border:"1px solid #b3d4fc",borderRadius:5,margin:"3px 11px",padding:7,fontSize:14,color:"rgba(35, 131, 226, 1)",boxShadow:"2px 2px 3px 0px #b3d4fc",cursor:"pointer",marginTop:10},onClick:j,children:["🏃 New Sprints 💨",(0,ue.jsx)("div",{style:{fontSize:11},children:"Upgrade V1 to V2!!!"})]}),(0,ue.jsx)(_t.Z,{disableInitialScroll:!0,type:_t.i.Vertical,initialFocus:0,sections:_})]})}var Su=o(34296);class yu extends i.Z{constructor(){super(...arguments),this.searchSessionId="",this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o,property:n,formatKey:i}=this.props;if(!t.collectionStore())return;xt.wd({environment:this.environment,collectionContextStore:t,action:"select_relation_source"});const{stack:r}=o.state,a=r[r.length-2];a&&"setupRelation"===a.type&&d.z$({collectionSettingsStore:o}),d.FK({collectionSettingsStore:o,item:{type:"setupRelation",property:n,formatKey:i,targetCollectionPointer:e.pointer}})}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionViewBlockStore();if(!o)return;const n=St.default.createValue("");return(0,ue.jsx)(Qo.ZP,{...this.props,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Related to",id:"database.viewSettings.selectNewRelationSourceTab.title"}),handleClose:()=>{xt.tW({environment:this.environment,eventName:"abandoned_search",queryLength:n.state.length,sessionId:this.searchSessionId,source:Su.S.Relation}),d.E3({collectionSettingsStore:t})},children:(0,ue.jsx)(vt.Z,{collectionContextStore:e,onAccept:this.handleSourcePickerAccept,parentStore:o,context:Su.S.Relation,searchSessionId:this.searchSessionId,inputStore:n})})}UNSAFE_willMount(){this.searchSessionId=(0,s.ZP)()}}yu.displayName="CollectionSettingsSelectRelationSource";const hu=(0,l.injectIntl)(yu);var fu=o(16257),xu=o(79892);function vu(e){window.__c={n:"CollectionSettingsSetupRelation"};const{collectionContextStore:t,collectionSettingsStore:o,property:i,formatKey:s,targetCollectionPointer:c,from:g}=e,m=(0,a.VK)((()=>t.collectionStore()),[t]),S=(0,a.VK)((()=>{const e=t.collectionViewBlockStore();return function(e){const{targetCollectionPointer:t,collectionStore:o,collectionViewBlockStore:n}=e;if(!t)return;if(o&&o.pointer===t)return o;return n?Ge.NW.createChildStore(n,t):void 0}({targetCollectionPointer:c,collectionStore:m,collectionViewBlockStore:e})}),[t,m,c]),y=(0,a.VK)((()=>i?Gr.KV(t,i):void 0),[t,i]),h=Boolean(m&&S&&m.id===S.id),f=Boolean("relation"===(null==y?void 0:y.type)&&y.connectedRelation),x=Boolean("subitem"===g),v=Boolean("timeline_arrows_by"===g),C=(0,a.VK)((()=>t.contextType),[t]),b=(0,r.O7)(),w=(0,l.useIntl)(),j=(0,a.VK)((()=>{const e=null==m?void 0:m.getSchema();return void 0===(null==y?void 0:y.name)&&S&&e?Gr.m8(w,{targetCollectionStore:S,isSelfRelation:h,sourceSchema:e,createUnique:!0,from:g}):(null==y?void 0:y.name)||""}),[m,null==y?void 0:y.name,S,w,h,g]),[M,_]=(0,n.useState)(j),[k,T]=(0,n.useState)("no_limit"),[A,P]=(0,n.useState)(x||v?{hasInverseRelation:!0,inverseName:void 0,autoRelate:{enabled:!1}}:{hasInverseRelation:!1,inverseName:void 0,autoRelate:{enabled:!1}}),V=M===j,F=(0,n.useCallback)((()=>{d.H4({collectionSettingsStore:o,item:{type:"selectRelationSource",property:i,formatKey:s}})}),[o,i,s]),I=(0,n.useCallback)((()=>{if(!A)return;const{hasInverseRelation:e,inverseName:n,autoRelate:r}=A,a=t.collectionStore(),l=t.collectionViewStore();if(!a||!S)return;const{performResult:c}=p.createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:b,perform:o=>{const c=i??va.G3({environment:b,collectionStore:a,collectionViewArgs:l&&s?{collectionViewStore:l,format:l.getFormat(),formatKey:s}:void 0,propertyType:"relation",transaction:o});if(Ka.n7({environment:b,collectionContextStore:t,collectionStore:a,property:c,propertyName:M,targetCollectionStore:S,hasInverseRelation:e,inverseName:n,autoRelate:r,propertyLimit:k,intl:w,transaction:o,from:g}),l){var d;const e=(null===(d=l.getFormat().table_properties)||void 0===d?void 0:d.find((e=>e.property===c)))??{property:c,visible:!0};u.FH({stores:[l],update:{table_properties:[...l.getFormat().table_properties??[],e]},transaction:o})}return"subitem"===g&&l?(Nr.dR({collectionViewStore:l,propertyId:c,transaction:o}),Nr.jA({environment:b,collectionContextStore:t,relationPropertyId:c,transaction:o})):"timeline_arrows_by"===g&&l&&(Da.tF({collectionViewStore:l,newProperty:c,transaction:o}),Da._p({collectionContextStore:t,relationPropertyId:c,transaction:o})),c}});"subitem"===g||"timeline_arrows_by"===g?(d.z$({collectionSettingsStore:o}),d.H4({collectionSettingsStore:o,item:{type:"main"}})):d.qU({collectionSettingsStore:o,property:c,formatKey:s}),xt._H({environment:b,collectionContextStore:t,from:"collectionPage"===C?"page_properties":"view_settings",property_type:"relation"})}),[A,t,S,b,o,i,s,C,M,k,w,g]);return(0,ue.jsxs)(Qo.ZP,{...e,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"New relation",id:"database.viewSettings.setupRelationTab.title"}),children:[(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(Nt.ZP,{value:M||"",placeholder:"Property name",onChange:e=>_(e.target.value),onBlur:()=>{},onSubmit:()=>{},focusInitial:!0,selectAll:!1})}),(0,ue.jsx)(xu.Z,{isSelfRelation:h,collectionStore:S,showAs:"chevron",onClick:F,disabled:x}),!g&&(0,ue.jsx)(fu.U,{selectedKey:k,propertyType:"relation",onChange:e=>T(e)}),S&&!f&&(0,ue.jsx)(fs.Z,{collectionContextStore:t,targetCollectionStore:S,property:i,propertyName:M,buttonContents:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Add relation",id:"database.viewSettings.setupRelationTab.addButton.title"}),temporaryInverseState:A,setTemporaryInverseState:P,isInitialPropertyName:V,onSubmit:I,from:g}),(0,ue.jsx)(Et.Z,{children:(0,ue.jsx)(Xl.Z,{href:(0,Hl.UY)("guides.relations"),title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Learn about relations",id:"database.viewSettings.propertyTab.relations.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})})]})}var Cu=o(72141),bu=o(63143),wu=o(76464),ju=o(88893),Mu=o(29551),_u=o(46978);class ku extends i.Z{constructor(){super(...arguments),this.storeTypes={restrictedStore:St.default.createClass(!1)},this.handleContinue=()=>{const e=this.stores.restrictedStore.state,{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore(),n=t.settingsStore;o&&(e&&function(e){const{environment:t,store:o}=e,n=t.currentUser.id;if(!n)return;p.createAndCommit({userAction:"CollectionSettingsSyncedContentShare.restrictAccessToSyncedContent",environment:t,perform:e=>{wu.Pk({environment:t,store:o,shouldInherit:!1,transaction:e,permissionItem:{type:"user_permission",user_id:n,role:"editor"}})}})}({environment:this.environment,store:o}),c.KIh(this.environment,{type:e?"restrict":"share"}),d.E3({collectionSettingsStore:n}))}}renderComponent(){const{collectionSettingsStore:e,collectionContextStore:t,integrationName:o,integrationIcon:n}=this.props,{restrictedStore:i}=this.stores,r=t.collectionViewBlockStore();if(!r)return;const a=this.createComputedStore((()=>{const e=yd.default.state.data?ju.CM(yd.default.state.data):[],t=(0,bu.m8)(Te.oA(e.map((e=>[e.userId,e.role])))),o=(0,pt.YO)(r).map((e=>e.permissionItem));let n=!1,i=!1;for(const r of o)Cu.$D(r)?n=!0:Cu.ix(r)&&!Cu.Wi(r.role)&&(i=!0);const a=Te.jj(Te.oA([...o.map((e=>"user_permission"===e.type?e.user_id:void 0)),...i?Object.keys(t):[]])),s=a.filter((e=>"none"!==t[e])).length,l=a.filter((e=>{const n=t[e],i=Boolean(o.filter(Cu.jg).find((t=>t.user_id===e)));return Boolean(n&&i&&!Cu.YX(n))})).length;return{numberOfGuests:l,numberOfUsers:s+l,isPublic:n}})),{numberOfGuests:s,numberOfUsers:c,isPublic:u}=a.state;if(!u&&1===c)return void d.E3({collectionSettingsStore:e});const p=(0,ue.jsx)("div",{style:this.getPromptTitleStyle(),children:(0,ue.jsx)(l.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.header",defaultMessage:"Share synced content with"})}),g=(0,ue.jsxs)(ue.Fragment,{children:[0!==s?(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(l.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithGuests",defaultMessage:"{numberOfUsers} people (including you {numberOfGuests, plural, one {and {numberOfGuests} guest} other {and {numberOfGuests} guests}})",values:{numberOfUsers:c,numberOfGuests:s}})," "]}):(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(l.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithoutGuests",defaultMessage:"{numberOfUsers} people (including you)",values:{numberOfUsers:c}})," "]}),u&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(l.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.sharedWithPublic",defaultMessage:"and those with the link"})," "]}),(0,ue.jsx)(l.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.accessToIntegration",defaultMessage:"will get access to content synced from {integrationName}",values:{integrationName:o}})]}),m=(0,ue.jsx)(Mu.gq,{style:{marginTop:10},children:(0,ue.jsx)(co.Z,{style:{flex:"0 0 100%"},isLarge:!0,onClick:this.handleContinue,children:(0,ue.jsx)(l.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.continueButton",defaultMessage:"Continue"})})}),S=(0,ue.jsx)(Mu.gq,{style:{paddingBottom:24},alignItems:"center",justifyContent:"center",children:(0,ue.jsx)("img",{style:{width:40},src:n})}),y=(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,initialFocus:void 0,sections:[{key:"grant_permissions",items:[{key:"allow",action:()=>null,render:e=>(0,ue.jsx)(Rt.Z,{...e,textWrapperStyle:{textAlign:"left"},title:(0,ue.jsx)(l.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.title",defaultMessage:"Anyone on this page"}),shouldWrapCaption:!0,caption:g,icon:(0,ue.jsx)(_u.Z,{isSelected:!i.state}),onClick:()=>{i.setState(!1)}})},{key:"restrict",action:()=>null,render:e=>(0,ue.jsx)(Rt.Z,{...e,textWrapperStyle:{textAlign:"left"},title:(0,ue.jsx)(l.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.restrict.title",defaultMessage:"Only you"}),shouldWrapCaption:!0,caption:(0,ue.jsx)(l.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.restrict.caption",defaultMessage:"You'll need to share with others using the share menu"}),icon:(0,ue.jsx)(_u.Z,{isSelected:i.state}),onClick:()=>{i.setState(!0)}})}],render:e=>(0,ue.jsx)(Et.Z,{...e})}]});return(0,ue.jsx)(Qo.ZP,{...this.props,children:(0,ue.jsxs)(Mu.gq,{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"0px 16px 16px 16px"},flexDirection:"column",children:[S,(0,ue.jsxs)("div",{children:[p,y]}),m]})})}getPromptTitleStyle(){return{color:this.theme.regularTextColor,fontWeight:ie.Z.fontWeight.semibold,fontSize:14}}}ku.displayName="CollectionSettingsSyncedContentShare";const Tu=(0,l.injectIntl)(ku);var Au=o(21197),Pu=o(40778);const Vu=(0,l.defineMessages)({inputPlaceholder:{defaultMessage:"Filter by…",id:"database.viewSettings.createFilterTab.inputPlaceholder"}});class Fu extends i.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{if(!e)return;const{collectionContextStore:t}=this.props,o=t.collectionViewStore(),n=this.suggestedFilters.state.find((t=>t.property===e));if(!n||!o)return;const i={id:(0,s.ZP)(),filter:n};Pu.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:[...Ku(this.props.collectionContextStore),i]}}}),function(e,t,o,n,i){if(xt.wd({environment:i,collectionContextStore:t,action:"create_property_filter"}),o===dr.HV.FilterBar||o===dr.HV.TopbarFilterPopup){Bu(t,n);const o=t.getFilterBarItemSettingsStore(e);d.wl({collectionSettingsStore:o,item:{type:"filter"}})}else if(o===dr.HV.ViewSettings){Zu(n);const o=t.getFilterOptionsItemSettingsStore(e);d.wl({collectionSettingsStore:o,item:{type:"filter"}})}}(i,this.props.collectionContextStore,this.props.context,this.props.collectionSettingsStore,this.environment)},this.handleCombinatorFilterClick=()=>{const{collectionContextStore:e}=this.props;if(!e.collectionViewStore())return;Du(this.props.collectionContextStore)||Pu.iU({environment:this.environment,collectionContextStore:e,temporaryState:{...e.temporaryState.state,combinatorFilter:{value:C.TI}}}),Ou(this.props.collectionContextStore,this.props.context,this.props.collectionSettingsStore,this.environment)},this.suggestedFilters=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=e.collectionViewStore();if(!o)return[];return(0,bi.qd)({schema:t,filters:Ku(this.props.collectionContextStore),getRecordModel:o.getRecordModel})}),!0)}renderComponent(){var e;const{collectionContextStore:t}=this.props,o=this.suggestedFilters.state,n=Du(this.props.collectionContextStore),i=t.permissionScopes.state;return(0,ue.jsx)(Qo.ZP,{...this.props,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Add filter",id:"database.viewSettings.createFilterTab.title"}),footer:i.canConfigureBlock&&(0,ue.jsx)(Et.Z,{topBorder:!0,children:(0,ue.jsx)(Jo.Z,{icon:n?Au.Q:F.R,isGray:!0,title:n?(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Advanced filter",id:"database.viewSettings.createFilterTab.advancedFilter.title"}):(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Add advanced filter",id:"database.viewSettings.createFilterTab.addAdvancedFilter.title"}),right:n&&(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.viewSettings.createFilterTab.advancedFilterRulesCount.title",values:{ruleCount:(null===(e=n.filters)||void 0===e?void 0:e.length)||1}}),onClick:this.handleCombinatorFilterClick})}),children:(0,ue.jsx)(wa.Z,{schema:t.normalizedSchemaStore.state,format:t.normalizedFormatStore.state,getProperties:()=>o.map((e=>e.property)),onAccept:this.handlePropertyAccept,inputPlaceholder:be.default.formatMessage(Vu.inputPlaceholder)})})}}Fu.displayName="CollectionSettingsViewCreateFilter";const Iu=(0,l.injectIntl)(Fu);function Bu(e,t){e.filtersBarOpen.setState(!0),d.z$({collectionSettingsStore:t})}function Zu(e){d.wl({collectionSettingsStore:e,item:{type:"main"}}),d.H4({collectionSettingsStore:e,item:{type:"filters"}})}function Ku(e){return e.currentPropertyFiltersStore.state}function Du(e){return e.currentCombinatorFilterStore.state}function Ou(e,t,o,n){xt.wd({environment:n,collectionContextStore:e,action:"create_combinator_filter"}),t===dr.HV.FilterBar||t===dr.HV.TopbarFilterPopup?(Bu(e,o),d.wl({collectionSettingsStore:e.filterBarCombinatorFilterSettingsState,item:{type:"filter"}})):t===dr.HV.ViewSettings&&(Zu(o),d.wl({collectionSettingsStore:e.filterOptionsCombinatorFilterSettingsState,item:{type:"filter"}}))}const Ru=(0,l.defineMessages)({inputPlaceholder:{defaultMessage:"Sort by…",id:"database.viewSettings.createSortTab.inputPlaceholder"}});class Nu extends i.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{var t;if(!e)return;const{collectionContextStore:o,context:n,collectionSettingsStore:i}=this.props,r=o.collectionViewStore(),a=o.normalizedSchemaStore.state;if(!r||!a)return;const s=null===(t=a[e])||void 0===t?void 0:t.type;xt.wd({environment:this.environment,collectionContextStore:o,action:"create_sort_accept",original_view_type:r.getType(),property_type:s});const l={property:e,direction:"ascending"},c=[...Wu(this.props.collectionContextStore),l];if(Pu.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.state,sorts:{value:c}}}),n===dr.HV.TopbarSortPopup||n===dr.HV.FilterBar){o.filtersBarOpen.setState(!0),d.z$({collectionSettingsStore:i});const{filterBarSortSettingsStore:e}=o;d.wl({collectionSettingsStore:e,item:{type:"sort"}})}else n===dr.HV.ViewSettings&&(d.wl({collectionSettingsStore:i,item:{type:"main"}}),d.H4({collectionSettingsStore:i,item:{type:"sort"}}))}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=Wu(this.props.collectionContextStore);return(0,ue.jsx)(Qo.ZP,{...this.props,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"New sort",id:"database.viewSettings.createSortTab.title"}),children:(0,ue.jsx)(wa.Z,{schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,getProperties:()=>Object.keys(t).filter((e=>!o.find((t=>t.property===e)))),onAccept:this.handlePropertyAccept,inputPlaceholder:be.default.formatMessage(Ru.inputPlaceholder)})})}}Nu.displayName="CollectionSettingsViewCreateSort";const Eu=(0,l.injectIntl)(Nu);function Wu(e){return e.currentSortsStore.state}var Lu=o(18245),Gu=o(6758),Uu=o(8982);class zu extends i.Z{constructor(){super(...arguments),this.handleFilterChange=(e,t)=>{var o;const{collectionContextStore:n}=this.props,i=null===(o=n.remoteResult.state)||void 0===o?void 0:o.sizeHint,r=Lu.default.mark("collections.update_filter_lag");Lu.default.measureAfterNextFlush(r,{environment:this.environment,getData:()=>Bs.Y5({from:"combinator_filter",collectionContextStore:n,sizeHintAtStart:i})}),Pu.iU({environment:this.environment,collectionContextStore:n,temporaryState:{...n.temporaryState.state,combinatorFilter:{value:t}}}),xt.wd({environment:this.environment,collectionContextStore:n,action:"update_combinator_filter"})},this.handleRemoveClick=()=>{const{collectionContextStore:e,context:t,collectionSettingsStore:o}=this.props;Pu.iU({environment:this.environment,collectionContextStore:e,temporaryState:{...e.temporaryState.state,combinatorFilter:{value:void 0}}}),t===dr.HV.FilterBar&&d.E3({collectionSettingsStore:o}),xt.wd({environment:this.environment,collectionContextStore:e,action:"delete_combinator_filter"})}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=e.normalizedSchemaStore.state,n=function(e){return e.currentCombinatorFilterStore.state}(this.props.collectionContextStore);if(!t||!n)return;const i=t.getType();return i?(0,ue.jsxs)(Qo.ZP,{...this.props,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Advanced filter",id:"database.viewSettings.filterTab.title"}),unconstrainedWidth:!0,children:[(0,ue.jsx)(Uu.D,{children:(0,ue.jsx)(Gu.Pq,{index:0,level:0,combinatorFilter:n,schema:o,onChange:this.handleFilterChange,collectionViewType:i,collectionViewId:t.id,parentStore:t})}),(0,ue.jsx)(Et.Z,{topBorder:!0,children:(0,ue.jsx)(Jo.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Delete filter",id:"database.viewSettings.filterTab.deleteFilterButton.title"}),onClick:this.handleRemoveClick})})]}):void 0}}zu.displayName="CollectionSettingsViewFilter";const Hu=(0,l.injectIntl)(zu);var $u=o(28398),qu=o(40121),Xu=o(58814),Yu=o(19699);class Qu extends i.Z{constructor(){super(...arguments),this.handleFiltersDrop=e=>{const{collectionContextStore:t}=this.props;if(!t.collectionViewBlockStore())return;const o=t.currentPropertyFiltersStore.state,n=Te.oA(e.map((e=>o.find((t=>t.id===e)))));Pu.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:n}}}),xt.wd({environment:this.environment,collectionContextStore:t,action:"reorder_filters"})},this.handleNewFilterClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props;xt.wd({environment:this.environment,collectionContextStore:t,action:"click_new_filter"}),d.H4({collectionSettingsStore:e,item:{type:"createFilter"}}),t.filtersBarOpen.setState(!0)},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,bi.yU)(e)}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.environment,o=e.currentPropertyFiltersStore.state,n=o.map((e=>e.id)),i=e.permissionScopes.state,r=i.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0;return(0,ue.jsx)(Qo.ZP,{...this.props,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Filters",id:"database.viewSettings.filtersTab.title"}),footer:this.localStateHasChangesStore.state&&(0,ue.jsx)(Et.Z,{topBorder:!0,children:(0,ue.jsx)(ep,{collectionContextStore:this.props.collectionContextStore})}),unconstrainedWidth:!0,children:(0,ue.jsxs)(Et.Z,{desktopStyle:{paddingBottom:24},children:[(n.length>0||r)&&(0,ue.jsxs)("div",{style:t.isMobile?{paddingTop:8,background:this.theme.contentBackground}:void 0,children:[r&&(0,ue.jsx)(op,{collectionContextStore:this.props.collectionContextStore}),tp(this.environment)?(0,ue.jsx)(Yl.ZP,{direction:"vertical",keys:n,renderKey:e=>{const t=n.indexOf(e);return(0,ue.jsx)(np,{collectionContextStore:this.props.collectionContextStore,filter:o[t]})},onDrop:this.handleFiltersDrop,disabled:!i.canConfigureBlock}):n.map((e=>{const t=n.indexOf(e);return(0,ue.jsx)(np,{collectionContextStore:this.props.collectionContextStore,filter:o[t]},e)}))]}),(0,ue.jsx)(Rt.Z,{focused:!1,icon:(0,F.R)({width:14,marginLeft:4,marginRight:4,fill:this.theme.mediumIconColor}),style:{color:this.theme.mediumTextColor},title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Add filter",id:"database.viewSettings.filtersTab.newFilter.title"}),onClick:this.handleNewFilterClick})]})})}}Qu.displayName="CollectionSettingsViewFilters";const Ju=(0,l.injectIntl)(Qu);function ep(e){let{collectionContextStore:t}=e;return(0,ue.jsx)($u.ZP,{context:$u.R1.SettingsFilters,collectionContextStore:t})}function tp(e){return!e.device.isMobile}function op(e){let{collectionContextStore:t}=e;window.__c={n:"CombinatorFilter"};const o=(0,r.O7)();return(0,ue.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"},children:[tp(o)&&(0,ue.jsx)(Ql.ZP,{iconSize:12,style:{marginLeft:6,marginRight:6,opacity:.4,cursor:void 0}}),(0,ue.jsx)(Xu.Z,{context:qu.P.SettingsFilters,collectionContextStore:t,collectionSettingsStore:t.filterOptionsCombinatorFilterSettingsState})]})}function np(e){let{filter:t,collectionContextStore:o}=e;window.__c={n:"PropertyFilterComponent"};const n=(0,r.O7)(),i=(0,a.VK)((()=>o.getFilterOptionsItemSettingsStore(t)),[o,t]);return(0,ue.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"},children:[tp(n)&&(0,ue.jsx)(Ql.ZP,{iconSize:12,style:{marginLeft:6,marginRight:6}}),(0,ue.jsx)(Yu.Z,{id:t.id,context:qu.P.SettingsFilters,collectionContextStore:o,collectionSettingsStore:i},t.id)]})}var ip=o(74194);class rp extends i.Z{constructor(){super(...arguments),this.storeTypes={inputValue:St.default.createClass("")},this.handleChangeDebounced=Te.Ds((e=>{void 0!==e&&this.props.onChange(e)}),300)}UNSAFE_willMount(e){this.stores.inputValue.setState(e.value.toString())}renderComponent(){const e=this.stores.inputValue.state;return(0,ue.jsx)(ip.Z,{type:"number",value:e,inputClassName:"input-hide-arrows",style:{background:this.theme.contentBackground},onChange:e=>{const t=e.target.value,o=parseFloat(t);isNaN(o)?this.handleChangeDebounced(void 0):this.handleChangeDebounced(o),this.stores.inputValue.setState(t)}})}}rp.displayName="CollectionViewGroupMenuNumberInput";const ap=rp;class sp extends i.Z{renderComponent(){const{numberGroupBy:e,collectionContextStore:t,schema:o}=this.props,n=o[e.property];if(t.collectionStore()&&n)return(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(Et.Z,{topBorder:!1,disableMobileBorders:!0,title:(0,ue.jsx)(l.FormattedMessage,{id:"database.groupMenu.numberGroupRange",defaultMessage:"Group range"}),isTitleUppercase:!1,children:(0,ue.jsxs)("div",{style:{display:"flex",paddingLeft:14,paddingRight:14},children:[(0,ue.jsx)(cp,{onChange:this.props.onChange,numberGroupBy:e,inputKey:"start"}),(0,ue.jsx)("span",{style:{color:this.theme.mediumTextColor,margin:"0 8px"},children:"–"}),(0,ue.jsx)(cp,{onChange:this.props.onChange,numberGroupBy:e,inputKey:"end"})]})}),(0,ue.jsx)(Et.Z,{topBorder:!1,disableMobileBorders:!0,title:(0,ue.jsx)(l.FormattedMessage,{id:"database.groupMenu.numberGroupSize",defaultMessage:"Group every"}),isTitleUppercase:!1,children:(0,ue.jsxs)("div",{style:{paddingLeft:14,paddingRight:14},children:[(0,ue.jsx)(cp,{onChange:this.props.onChange,numberGroupBy:e,inputKey:"size"}),(0,ue.jsxs)("span",{style:{color:this.theme.mediumTextColor,fontSize:12},children:[(0,ue.jsx)($l.Z,{groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start,end:e.start+e.size}}},schema:o,currentGroups:[],disabled:!0,isHiddenGroup:!1,style:{display:"inline",paddingRight:0,paddingLeft:0},collectionContextStore:t}),", ",(0,ue.jsx)($l.Z,{groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start+e.size,end:e.start+2*e.size}}},schema:o,currentGroups:[],disabled:!0,isHiddenGroup:!1,style:{display:"inline",paddingRight:0,paddingLeft:0},collectionContextStore:t}),", ..."]})]})})]})}}sp.displayName="CollectionViewNumberGroupMenu";const lp=(0,l.injectIntl)(sp);function cp(e){let{numberGroupBy:t,inputKey:o,onChange:n}=e;return(0,ue.jsx)(ap,{value:t[o],onChange:e=>{"size"===o&&e<=0&&(e=1),"start"===o&&e>t.end&&(e=t.end),"end"===o&&e<t.start&&(e=t.start),n({newNumberGroupBy:{...t,[o]:e}})}})}const dp=(0,l.injectIntl)((function(e){return(0,ue.jsx)(Qo.ZP,{...e,title:(0,ue.jsx)(up,{collectionSettingsStore:e.collectionSettingsStore,collectionContextStore:e.collectionContextStore}),children:(0,ue.jsx)(pp,{groupByKey:e.groupByKey,groupsFormatKey:e.groupsFormatKey,collectionContextStore:e.collectionContextStore})})}));function up(e){let{collectionSettingsStore:t,collectionContextStore:o}=e;window.__c={n:"Title"};const n=(0,a.VK)((()=>(0,Fr.n)(t)),[t]),i=(0,a.VK)((()=>o.normalizedSchemaStore.state),[o]),r=(0,a.VK)((()=>o.normalizedFormatStore.state),[o]);if(!n||"groupByNumber"!==n.type)return null;const s=r[n.groupByKey];return s?ac({groupBy:s,schema:i})??null:null}function pp(e){let{groupByKey:t,groupsFormatKey:o,collectionContextStore:n}=e;window.__c={n:"Content"};const i=(0,r.O7)(),s=n.collectionViewStore(),l=(0,a.VK)((()=>n.normalizedSchemaStore.state),[n]),c=(0,a.VK)((()=>function(e,t){return e.normalizedFormatStore.state[t]}(n,t)),[n,t]);if(!c||!s)return null;const d=cc(c);return d?(0,ue.jsx)(lp,{numberGroupBy:d,disabled:!1,schema:l,onChange:e=>{if("number"===c.type)p.createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:i,perform:n=>{u.FH({stores:[s],update:{[t]:e.newNumberGroupBy,[o]:void 0},transaction:n})}});else if("formula"===c.type){const n=Te.CE(e.newNumberGroupBy,"property"),r={...c,groupBy:n};p.createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:i,perform:e=>{u.FH({stores:[s],update:{[t]:r,[o]:void 0},transaction:e})}})}xt.wd({environment:i,collectionContextStore:n,action:"group_by_number_update",original_view_type:void 0,property_type:c.type})},collectionContextStore:n}):null}class gp extends i.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o,groupByKey:n,groupsFormatKey:i}=this.props,r=t.collectionViewStore(),a=t.normalizedSchemaStore.state;if(r){if(e){const o=a[e];if(!o||!(0,Gl.LG)(o))return;const s=(0,Gl.fw)(e,o,"collectionTypedView"===t.contextType);p.createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:this.environment,perform:e=>{u.FH({stores:[r],update:{[n]:s,[i]:void 0},transaction:e})}}),xt.wd({environment:this.environment,collectionContextStore:t,action:"group_by_property_accept",original_view_type:void 0,property_type:o.type})}else p.createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:this.environment,perform:e=>{u.FH({stores:[r],update:{[n]:void 0,[i]:void 0},transaction:e})}}),xt.wd({environment:this.environment,collectionContextStore:t,action:"group_by_property_accept"});d.wl({collectionSettingsStore:o,item:{type:"main"}}),d.H4({collectionSettingsStore:o,item:{type:"group",groupByKey:n,groupsFormatKey:i}})}}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=(0,Fr.n)(t),n=e.collectionViewBlockStore(),i=e.collectionViewStore();if(!n||!i||!o||"groupByProperty"!==o.type)return;const r=function(e,t){return e.normalizedFormatStore.state[t]}(this.props.collectionContextStore,this.props.groupByKey);return(0,ue.jsx)(Qo.ZP,{...this.props,title:nc(o.groupByKey,Sp(this.props.collectionContextStore)),children:(0,ue.jsx)(wa.Z,{schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,currentProperty:null==r?void 0:r.property,showNoneOption:yp(this.props.collectionContextStore,this.props.groupByKey),getProperties:()=>this.getGroupableProperties(),onAccept:this.handlePropertyAccept})})}getGroupableProperties(){const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state;return Object.entries(t).sort(hp).map((e=>e[0])).filter((e=>{const o=t[e];return o&&(0,Gl.LG)(o)}))}}gp.displayName="CollectionSettingsViewGroupByProperty";const mp=(0,l.injectIntl)(gp);function Sp(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}function yp(e,t){return(0,zl._1)({viewType:Sp(e),groupByKey:t})}function hp(e,t){var o,n;const i=null==e||null===(o=e[1])||void 0===o?void 0:o.name,r=null==t||null===(n=t[1])||void 0===n?void 0:n.name;return i&&r?i.localeCompare(r,void 0,{sensitivity:"base"}):i?1:r?-1:0}const fp=(0,l.injectIntl)((function(e){return(0,ue.jsx)(Qo.ZP,{...e,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Layout",id:"database.viewSettings.layoutTab.title"}),desktopWidth:290,children:(0,ue.jsx)(el.Z,{...e})})}));var xp=o(75544),vp=o(75117);class Cp extends i.Z{constructor(){super(...arguments),this.handleSortChange=e=>{!function(e,t,o){if(!t.collectionViewStore())return;Pu.iU({environment:o,collectionContextStore:t,temporaryState:{...t.temporaryState.state,sorts:{value:e}}})}(e,this.props.collectionContextStore,this.environment)},this.handleDeleteAllSortsClick=()=>{const{collectionSettingsStore:e,context:t}=this.props;t===dr.HV.FilterBar&&d.E3({collectionSettingsStore:e})},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,bi.Mj)(e)}))}renderComponent(){const{collectionContextStore:e,context:t}=this.props,o=e.permissionScopes.state,n=t===dr.HV.ViewSettings&&this.localStateHasChangesStore.state,i=e.collectionViewStore();if(i)return(0,ue.jsx)(Qo.ZP,{...this.props,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.sortTab.title"}),footer:n&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)("div",{style:{paddingTop:24}}),(0,ue.jsx)(Et.Z,{topBorder:!0,children:(0,ue.jsx)(jp,{collectionContextStore:this.props.collectionContextStore})})]}),unconstrainedWidth:!0,children:(0,ue.jsx)(vp.Z,{collectionViewStore:e.collectionViewStore(),schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,sorts:wp(this.props.collectionContextStore),disabled:!o.canConfigureBlock,parentStore:i,onChange:this.handleSortChange,showDeleteAll:!0,onDeleteAll:this.handleDeleteAllSortsClick})})}}Cp.displayName="CollectionSettingsViewSort";const bp=(0,l.injectIntl)(Cp);function wp(e){return e.currentSortsStore.state}function jp(e){let{collectionContextStore:t}=e;return(0,ue.jsx)($u.ZP,{context:$u.R1.SettingsSort,collectionContextStore:t})}var Mp=o(59753),_p=o(47425);var kp=o(75553),Tp=o(1436),Ap=o(60291),Pp=o(69619),Vp=o(15157),Fp=o(32056),Ip=o(16402),Bp=o(24039);class Zp extends i.Z{constructor(e){super(e),this.storeTypes={nextSync:St.default.createClass(void 0),uri:St.default.createClass(void 0),botId:St.default.createClass(void 0)},this.reducer={type:"aggregation",filter:void 0,aggregation:{aggregator:"count",property:"title"}},this.setNextSync=this.setNextSync.bind(this)}didMount(){const e=this.stores.uri.state,t=this.stores.botId.state;if(e&&t){const o=`${t}:${e}`,n=Vp.Z.get({userId:this.environment.currentUser.id,key:o});this.setNextSync(n)}}renderComponent(){var e;const{collectionContextStore:t}=this.props,o=t.collectionStore(),n=null==o?void 0:o.getFormatStore(),i=null==n?void 0:n.getKeyStore("uri").getValue(),r=null==n?void 0:n.getKeyStore("bot_id").getValue(),a=null==o||null===(e=o.pointer)||void 0===e?void 0:e.spaceId,s=po.default.state.currentSpaceStore,c=null==n?void 0:n.getKeyStore("original_url").getValue(),d=(0,iu.wY)(c,a),u=t.collectionViewBlockStore(),p=nn.default.checkGate("free_tier_sync_database")||s&&!(0,_p.QM)(s.getSubscriptionTier());return this.stores.uri.setState(i),this.stores.botId.setState(r),(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(Et.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Source database",id:"database.viewSettings.syncedSourceTab.sourceDatabase"}),children:(0,ue.jsx)(re.Z,{placement:re.Z.Placement.Left,alignment:re.Z.Alignment.Center,renderTooltip:()=>u&&(0,ue.jsx)(Bp.Z,{store:u,compactFormat:!0}),render:e=>(0,ue.jsx)(Jl.Z,{...e,title:d,icon:(0,ue.jsx)(ai.Z,{disabled:!0,icon:null==o?void 0:o.getIcon(),isEmptyPage:!1,size:20,style:this.styles().menuItemIcon}),style:this.styles().menuItemTitle})}),style:{paddingBottom:0}}),(0,ue.jsx)(Et.Z,{children:this.renderLimitMenuItem()}),(0,ue.jsxs)(Et.Z,{topBorder:!0,children:[p&&i&&r&&this.renderSyncButton({uri:i,botId:r}),(0,ue.jsx)(Jo.Z,{isGray:!0,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Copy debugging information",id:"database.viewSettings.syncedSourceTab.copyDebugging"}),icon:kp.U,onClick:()=>{const e={uri:i,botId:r,spaceId:a};Vs.RD({environment:this.environment,stringValue:JSON.stringify(e,null,2),copiedMessage:Vs.tq.copiedLinkToClipboard})}}),(0,ue.jsx)(en.Z,{href:`${ou.default.domainBaseUrl}?target=connected_apps`,children:(0,ue.jsx)(Jo.Z,{icon:Tp.g,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Manage my connections",id:"database.viewSettings.syncedSourceTab.manageConnections"}),isGray:!0})}),(0,ue.jsx)(Xl.Z,{href:(0,Hl.UY)("guides.syncedDatabases"),title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Learn about synced databases",id:"database.viewSettings.syncedSourceTab.learnMoreButton.title."}),analyticsFrom:"view_settings_source"})]})]})}renderCountRowValue(e){const{collectionContextStore:t}=this.props;return(0,ue.jsx)(ql.Z,{id:"table:uncategorized:title:count",collectionContextStore:t,reducer:this.reducer,render:t=>{const o=t.state;if(!o||"aggregation"!==o.type)return;if("number"!==o.aggregationResult.type)return;const n={...o.aggregationResult,value:o.aggregationResult.value&&Math.min(e,o.aggregationResult.value)};return(0,Fp.uf)(n.value,"number_with_commas",this.props.intl)}})}renderLimitMenuItem(){const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=null==t?void 0:t.getFormatStore(),n="row_limit_exceeded"===(null==o?void 0:o.getKeyStore("sync_state").getKeyStore("syncing").getValue()),i=po.default.state.currentSpaceStore,r=this.createComputedStore((()=>{var e;return function(e){if(!e)return 2e4;const t=Mp.kk.fromSpace(e),o=t.getSetting("database_sync_row_limit");return void 0!==o?o:(0,_p.QM)(t.getSubscriptionTier())?100:2e4}(null===(e=po.default.state.currentSpaceStore)||void 0===e?void 0:e.getModel())}));return(0,ue.jsx)(Jl.Z,{title:(0,ue.jsxs)("span",{style:{display:"inline-flex",alignItems:"center"},children:[n&&i&&(0,_p.QM)(i.getSubscriptionTier())&&(0,ue.jsx)(re.Z,{placement:re.Z.Placement.Left,alignment:re.Z.Alignment.Center,renderTooltip:()=>(0,ue.jsx)(l.FormattedMessage,{id:"database.viewSettings.syncedSourceTab.limitFree.toolTip",defaultMessage:"Free Plans are limited to 1 synced database with up to 100 rows."}),render:e=>(0,ue.jsx)("div",{...e,children:(0,dt.t)({fill:(0,_s.fi)("orange",this.theme).fill,marginRight:14,width:12,alignSelf:"center"})})}),(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Limit",id:"database.viewSettings.syncedSourceTab.limit"})]}),right:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"{value}/{limit} rows",id:"database.viewSettings.syncedSourceTab.limitRows",values:{value:this.renderCountRowValue(r.state),limit:(0,Fp.uf)(r.state,"number_with_commas",this.props.intl)}}),style:this.styles().menuItem})}renderSyncButton(e){const{uri:t,botId:o}=e,n=this.stores.nextSync.state,i=!n||n<Date.now();return function(e,t){var o;const n=e.numberChildrenUnfurled.state,i=e.numberChildrenReceived.state,r=n/i,a=!0===(null===(o=e.collectionStore())||void 0===o||null===(o=o.getFormat().sync_state)||void 0===o?void 0:o.syncing),s=t.device.isMobile,l=a&&s;return n&&i&&r<1&&!s||l}(this.props.collectionContextStore,this.environment)?(0,ue.jsx)(Jl.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Syncing",id:"database.viewSettings.syncedSourceTab.isSyncing"}),icon:(0,Ap.b)(this.styles().menuItemIcon,"sync-spinner"),style:this.styles().menuItem}):i?(0,ue.jsx)(Jo.Z,{isGray:!0,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"{message}",id:"database.viewSettings.syncedSourceTab.syncNow",values:{message:Dp().defaultMessage,description:Dp().description}}),icon:Ap.b,onClick:async()=>{var e,i;const r=null===(e=this.props.collectionContextStore.collectionStore())||void 0===e?void 0:e.id,a=!0===(null===(i=this.props.collectionContextStore.collectionStore())||void 0===i?void 0:i.getFormat().stale);r&&await d.R0({environment:this.environment,uri:t,botId:o,collectionId:r,nextSync:n,setNextSync:this.setNextSync,isStale:a})}}):(0,ue.jsx)(Jl.Z,{title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Sync available in {timeToNextSync}",id:"database.viewSettings.syncedSourceTab.syncNow.disabled",values:{timeToNextSync:(0,Ip.hH)(Date.now(),n)}}),icon:(0,Pp.T)(this.styles().menuItemIcon),style:this.styles().menuItem})}setNextSync(e){this.stores.nextSync.setState(e)}styles(){const e=this.environment.device.isMobile;return{menuItemTitle:{paddingLeft:e?4:8},menuItem:{color:this.theme.mediumTextColor,paddingLeft:e?4:8},menuItemIcon:{height:16,width:16,marginRight:2}}}}Zp.displayName="CollectionSettingsViewSyncedSource";const Kp=(0,l.injectIntl)(Zp);function Dp(){const e=po.default.state.currentSpaceStore,t=e&&(0,_p.QM)(e.getSubscriptionTier());return{defaultMessage:t?"Clear and sync database":"Sync database",description:t?"Clears and refreshes the database ":"Refreshes the synced database."}}class Op extends i.Z{constructor(){super(...arguments),this.searchSessionId="",this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o}=this.props;p.createAndCommit({userAction:"CollectionSettingsViewSource.handleSourcePickerAccept",environment:this.environment,perform:o=>{Ca.yc({environment:this.environment,collectionContextStore:t,collectionStore:e,transaction:o})}}),d.z$({collectionSettingsStore:o})}}renderComponent(){var e;const{collectionContextStore:t,collectionSettingsStore:o}=this.props,n=Boolean(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewSourceCollectionStore()),i=t.collectionViewBlockStore();if(!i)return;const r=St.default.createValue("");return(0,ue.jsx)(Qo.ZP,{...this.props,title:(0,ue.jsx)(l.FormattedMessage,{defaultMessage:"Source",id:"database.viewSettings.sourceTab.title"}),handleClose:()=>{xt.tW({environment:this.environment,eventName:"abandoned_search",sessionId:this.searchSessionId,source:Su.S.Source,queryLength:r.state.length}),d.E3({collectionSettingsStore:o})},children:n?(0,ue.jsx)(Kp,{collectionContextStore:t}):(0,ue.jsx)(vt.Z,{collectionContextStore:t,parentStore:i,onAccept:this.handleSourcePickerAccept,context:Su.S.Source,searchSessionId:this.searchSessionId,inputStore:r})})}UNSAFE_willMount(){this.searchSessionId=(0,s.ZP)()}}Op.displayName="CollectionSettingsViewSource";const Rp=(0,l.injectIntl)(Op);var Np=o(72897),Ep=o(5336),Wp=o(69651),Lp=o(96711),Gp=o(88177),Up=o(5377),zp=o(53523);function Hp(e){window.__c={n:"SprintSettingsMenu"};const{collectionContextStore:t,collectionSettingsStore:o}=e,{sprintSettingsConfig:n,sprintSettingsDisplayState:i,handleSprintSettingsConfigChange:r,turnOffSprints:a,turnOnSprints:s}=Kl({collectionContextStore:t,collectionSettingsStore:o});if(void 0===i||!n)return null;let l;return"displayOn"===i?l=(0,ue.jsx)($p,{...e,onChange:r,onTurnOffSprints:a,sprintSettingsConfig:n}):"displayOff"===i?l=(0,ue.jsx)(qp,{...e,onTurnOnSprints:s}):(0,ne.t1)(i),l}function $p(e){const{sprintSettingsConfig:t,collectionContextStore:o,onChange:n,onTurnOffSprints:i}=e,r=[];return r.push((0,ue.jsx)(Et.Z,{topBorder:!0,disableMobileBorders:!0,children:(0,ue.jsx)(eg,{turnOffSprints:i,collectionContextStore:o})},"turn-off-sprints-section")),(0,ue.jsxs)(Qo.ZP,{...e,title:(0,ue.jsx)(l.FormattedMessage,{...Tl.sprintsMenuTitle}),footer:r,children:[(0,ue.jsxs)(Et.Z,{children:[(0,ue.jsx)(og,{onChange:n,sprintSettingsConfig:t}),(0,ue.jsx)(ng,{onChange:n,sprintSettingsConfig:t}),(0,ue.jsx)(ig,{onChange:n,sprintSettingsConfig:t})]}),(0,ue.jsx)(Et.Z,{topBorder:!0,children:(0,ue.jsx)(tg,{onChange:n,sprintSettingsConfig:t})})]})}function qp(e){window.__c={n:"SprintSettingsDisabledMenuView"};const{onTurnOnSprints:t}=e,o=ag(),n=[];return n.push((0,ue.jsx)(Et.Z,{disableMobileBorders:!0,children:(0,ue.jsx)("div",{style:o.buttonWrap,children:(0,ue.jsx)(co.Z,{style:o.button,onClick:async()=>{await t()},isLarge:!0,children:(0,ue.jsx)(l.FormattedMessage,{...Tl.turnOnSprints})})})},"turn-on-sprints-section")),(0,ue.jsx)(Qo.ZP,{...e,title:(0,ue.jsx)(l.FormattedMessage,{...Tl.setupSprintsTitle}),footer:n,children:(0,ue.jsxs)(Et.Z,{disableMobileBorders:!0,children:[(0,ue.jsx)(Xp,{}),(0,ue.jsx)(Yp,{}),(0,ue.jsx)(Qp,{})]})})}function Xp(){window.__c={n:"SprintSettingsMenuDescription"};const e=ag();return(0,ue.jsx)("div",{style:{...e.menuDescriptionContainer,...e.menuDescriptionText},children:(0,ue.jsx)(l.FormattedMessage,{...Tl.setupSprintsCaption})})}function Yp(){window.__c={n:"SprintSettingsPreviewMedia"};const e=ag();return(0,ue.jsx)("div",{style:e.mediaWrap,children:(0,ue.jsx)("div",{style:e.media,children:(0,Up.y)(e.mediaIcon)})})}function Qp(){window.__c={n:"SprintSettingsDisclaimer"};const e=ag(),t=t=>(0,ue.jsx)("span",{style:e.boldText,children:t});return(0,ue.jsxs)("div",{style:e.disclaimerWrap,children:[(0,ue.jsx)("div",{children:(0,ue.jsx)(l.FormattedMessage,{...Tl.setupSprintsTeamspaceStatement})}),(0,ue.jsx)(Jp,{text:(0,ue.jsx)(l.FormattedMessage,{...Tl.setupSprintsSprintBoardPageStatement,values:{bold:t}}),icon:ml.L}),(0,ue.jsx)(Jp,{text:(0,ue.jsx)(l.FormattedMessage,{...Tl.setupSprintsSprintsDatabaseStatement,values:{bold:t}}),icon:Gp.t})]})}function Jp(e){window.__c={n:"SprintSettingsDisclaimerSubitem"};const{text:t,icon:o}=e,n=ag();return(0,ue.jsxs)("div",{style:n.disclaimerSubitem,children:[(0,ue.jsx)("div",{children:o(n.disclaimerSubitemIcon)}),(0,ue.jsx)("div",{children:t})]})}function eg(e){window.__c={n:"TurnOffSprintsButton"};const{collectionContextStore:t,turnOffSprints:o}=e,n=(0,r.O7)(),i=(0,a.VK)((()=>t.sprintSettingsContext.state),[t.sprintSettingsContext]),[{value:s}]=(0,Ts.r5)((async()=>{if(null==i||!i.taskCollectionStore||null==i||!i.taskCollectionViewBlockStore)return;return await async function(e){var t;const{environment:o,collectionStore:n,collectionViewBlockStore:i}=e,{appConfigs:r}=await jl.deps.AppTemplates.loader(),a=i.getSpaceId(),s=i.getParentStore(),l=null===(t=n.getFormat())||void 0===t?void 0:t.app_config_uri,c=l&&(0,hs.YB)(r(),l);if(!s||s.table!==bl.bx&&s.table!==Ee.iU&&s.table!==wl.e0||!c)return;const d=await bo.getSprintBoardViewBlocks(o,{spaceId:a,taskCollectionId:n.id,parentId:s.id,parentTable:s.table});return"success"===(null==d?void 0:d.type)?d.data.result:[]}({environment:n,collectionStore:i.taskCollectionStore,collectionViewBlockStore:i.taskCollectionViewBlockStore})}),[n,null==i?void 0:i.taskCollectionStore,null==i?void 0:i.taskCollectionViewBlockStore]),c=ag();return(0,ue.jsx)(Jo.Z,{icon:jn.y,title:(0,ue.jsx)(l.FormattedMessage,{...Tl.turnOffSprints}),isRed:!0,iconStyle:c.icon,onClick:()=>{an.showDialog({description:(0,ue.jsx)(Zl,{numOfSprintBoards:s?s.length:0}),message:(0,ue.jsx)("div",{style:c.modalTitle,children:(0,ue.jsx)(l.FormattedMessage,{...Tl.turnOffSprintsModalTitle})}),innerStyle:c.modalInnerStyle,showCancel:!0,keepFocus:!0,items:[{label:(0,ue.jsx)(l.FormattedMessage,{...Tl.turnOffAndDeleteModalButton}),color:"red",onAccept:async()=>{await o(s??[])}}]})}})}function tg(e){window.__c={n:"AutoCompleteSprintSwitcherMenuItem"};const{onChange:t,sprintSettingsConfig:o}=e,n=ag();return(0,ue.jsx)(ba.Z,{title:(0,ue.jsx)(l.FormattedMessage,{...Tl.automatedSprintsToggleTitle}),caption:(0,ue.jsx)(l.FormattedMessage,{...Tl.automatedSprintsToggleCaption}),focused:!1,on:o.autoCompleteSprints,onClick:()=>{t({autoCompleteSprints:!o.autoCompleteSprints})},style:{alignItems:void 0},icon:(0,zp.N)(n.icon),shouldWrapCaption:!0})}function og(e){const{onChange:t,sprintSettingsConfig:o}=e,n=Il(o.recurrenceConfig.interval),i=Ml.map((e=>Il(e)));return(0,ue.jsx)(rg,{title:(0,ue.jsx)(l.FormattedMessage,{...Tl.duration}),right:(0,ue.jsx)(Bl,{sprintDurationValue:n.value}),icon:Ep.r,getMenuItems:e=>i.map((i=>({key:i.key,render:e=>(0,ue.jsx)(Rt.Z,{...e,disabled:!1,title:(0,ue.jsx)(Bl,{sprintDurationValue:i.value}),checkState:i.key===n.key}),action:()=>{t({recurrenceConfig:{...o.recurrenceConfig,interval:i.value}}),e.close()}}))),showChevron:!0})}function ng(e){const{onChange:t,sprintSettingsConfig:o}=e,n=o.recurrenceConfig.weekdays[0],i=["SU","MO","TU","WE","TH","FR","SA"];return(0,ue.jsx)(rg,{title:(0,ue.jsx)(l.FormattedMessage,{...Tl.startOn}),icon:Wp.C,right:(0,ue.jsx)(Fl,{weekday:n}),getMenuItems:e=>i.map((i=>({key:i,render:e=>(0,ue.jsx)(Rt.Z,{...e,disabled:!1,title:(0,ue.jsx)(Fl,{weekday:i}),checkState:i===n}),action:()=>{t({recurrenceConfig:{...o.recurrenceConfig,weekdays:[i]}}),e.close()}}))),showChevron:!0})}function ig(e){const{onChange:t,sprintSettingsConfig:o}=e,n=o.actionConfig.complete_sprint_action,i=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];return(0,ue.jsx)(rg,{title:(0,ue.jsx)(l.FormattedMessage,{...Tl.incompleteTasks}),right:(0,ue.jsx)(Vl,{completeSprintAction:n}),icon:Lp.V,getMenuItems:e=>i.map((i=>({key:i,render:e=>(0,ue.jsx)(Rt.Z,{...e,disabled:!1,title:(0,ue.jsx)(Pl,{completeSprintAction:i}),checkState:i===n}),action:()=>{t({actionConfig:{...o.actionConfig,complete_sprint_action:i}}),e.close()}}))),showChevron:!0})}function rg(e){window.__c={n:"DropdownButton"};const{getMenuItems:t}=e,o=(0,r.Fy)(),n=ag(),i=(0,zt.F)({width:250});return(0,ue.jsx)(ut.ZP,{popupType:o.isMobile?Za.kQ.SlideUp:Za.kQ.Popup,alignmentToOrigin:ut.vR.End,placementToOrigin:ut.pO.Bottom,renderOrigin:t=>(0,ue.jsx)(Jo.Z,{...e,iconStyle:n.icon,...t}),render:e=>(0,ue.jsx)(Ct.Z,{...i,children:(0,ue.jsx)(_t.Z,{type:_t.i.Vertical,sections:[{key:0,render:e=>(0,ue.jsx)(Et.Z,{enableActionSheetTitle:!0,...e}),items:t(e)}],initialFocus:0})})})}function ag(){const e=(0,r.Fy)();return(0,S.yK)((t=>({icon:{width:14,height:14},menuDescriptionContainer:{margin:"0px 12px"},menuDescriptionText:{fontSize:e.isMobile?ie.Z.fontSize.UISmall.mobile:ie.Z.fontSize.UISmall.desktop,color:t.mediumTextColor,fontWeight:ie.Z.fontWeight.regular,marginLeft:14},button:{width:"100%"},buttonWrap:{margin:"0px 12px"},disclaimerWrap:{margin:"0px 12px",fontSize:e.isMobile?ie.Z.fontSize.UIRegular.mobile:ie.Z.fontSize.UIRegular.desktop,color:t.mediumTextColor,fontWeight:ie.Z.fontWeight.regular},disclaimerSubitem:{display:"flex",padding:"0px 10px",margin:"7px 0px",gap:7},disclaimerSubitemIcon:{width:20,height:20,marginTop:e.isMobile?3:1},boldText:{color:t.regularTextColor,fontWeight:ie.Z.fontWeight.semibold},mediaWrap:{margin:"0px 12px"},media:{display:"flex",margin:"15px 0px",width:"100%",padding:"12px 0px",height:120,border:`1px solid ${t.regularDividerColor}`,borderRadius:"4px",background:t.cardBackground,justifyContent:"center",alignItems:"center"},mediaIcon:{width:40,height:40,color:t.lightIconColor},modalTitle:{fontWeight:ie.Z.fontWeight.semibold,fontSize:18},modalInnerStyle:{textAlign:"center"},modalReferencedPageName:{color:t.darkTextColor,fontWeight:ie.Z.fontWeight.semibold}})),[e])}class sg extends i.Z{constructor(){super(...arguments),this.lastTab=void 0,this.handleClose=e=>{(0,Pr.ZP)({event:e,context:Pr.Af.CollectionSettingsClick,callback:()=>{const{collectionSettingsStore:e}=this.props;d.E3({collectionSettingsStore:e})}})}}didMountOrUpdate(){const{collectionSettingsStore:e}=this.props,t=(0,Fr.n)(e),o=this.props.collectionContextStore.getViewType();t&&this.lastTab!==t&&c.r5L(this.environment,{view_type:o,menu:t.type}),this.lastTab=t}renderComponent(){var e;const{collectionSettingsStore:t}=this.props,o=(0,Fr.n)(t),n=(i=this.props,{main:e=>(0,ue.jsx)(cg,{tab:e,...i}),source:()=>(0,ue.jsx)(Rp,{...i}),createViewSource:()=>(0,ue.jsx)(id.Z,{...i}),createSyncedViewSource:e=>(0,ue.jsx)(ug,{tab:e,...i}),selectAccountForExternalSource:e=>(0,ue.jsx)(pg,{tab:e,...i}),shareSyncedView:e=>(0,ue.jsx)(gg,{tab:e,...i}),propertyType:e=>(0,ue.jsx)(mg,{tab:e,...i}),propertyAiAutofill:e=>(0,ue.jsx)(Sg,{tab:e,...i}),createView:()=>(0,ue.jsx)(nd,{...i}),duplicateExistingView:()=>(0,ue.jsx)(sd.Z,{...i}),properties:e=>(0,ue.jsx)(yg,{tab:e,...i}),property:e=>(0,ue.jsx)(hg,{tab:e,...i}),deletedProperties:e=>(0,ue.jsx)(fg,{tab:e,...i}),selectRelationSource:e=>(0,ue.jsx)(xg,{tab:e,...i}),setupRelation:e=>(0,ue.jsx)(vg,{tab:e,...i}),layout:()=>(0,ue.jsx)(fp,{...i}),group:e=>(0,ue.jsx)(Cg,{tab:e,...i}),groupByProperty:e=>(0,ue.jsx)(bg,{tab:e,...i}),subitem:e=>(0,ue.jsx)(jg,{tab:e,...i}),arrowsBy:e=>(0,ue.jsx)(_g,{tab:e,...i}),githubConfig:e=>(0,ue.jsx)(Ag,{tab:e,...i}),filters:()=>(0,ue.jsx)(Ju,{...i}),groupByNumber:e=>(0,ue.jsx)(wg,{tab:e,...i}),filter:e=>(0,ue.jsx)(Pg,{tab:e,...i}),createFilter:()=>(0,ue.jsx)(Iu,{...i}),createSort:()=>(0,ue.jsx)(Eu,{...i}),sort:()=>(0,ue.jsx)(bp,{...i}),page:()=>(0,ue.jsx)(dg,{...i}),createTypedDB:()=>(0,ue.jsx)(Ys,{...i}),automationSettings:e=>(0,ue.jsx)(Vg,{tab:e,...i}),automationCreateSettings:e=>(0,ue.jsx)(Fg,{tab:e,...i}),automationEditSettings:e=>(0,ue.jsx)(Ig,{tab:e,...i}),dependencies:e=>(0,ue.jsx)(kg,{tab:e,...i}),relationFeaturesAdvancedSettings:e=>(0,ue.jsx)(Tg,{tab:e,...i}),subitemV2:e=>(0,ue.jsx)(Mg,{tab:e,...i}),sprintSettings:e=>(0,ue.jsx)(Bg,{tab:e,...i})});var i;if(o)return(0,ue.jsx)(Np.Z,{capture:!0,preventType:Vr.Z.Y,children:(0,ue.jsx)(cr.Z,{capture:!0,onEsc:this.handleClose,children:null===(e=n[o.type])||void 0===e?void 0:e.call(n,o)})})}}sg.displayName="CollectionSettings";const lg=(0,l.injectIntl)(sg);function cg(e){window.__c={n:"MainTabComponent"};const{collectionContextStore:t,tab:o}=e,n=(0,a.VK)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.id}),[t]);return"main"!==o.type?null:(0,ue.jsx)(Dc,{selectViewNameInitial:o.selectViewNameInitial,...e},n)}function dg(e){window.__c={n:"PageViewTabComponent"};const{collectionContextStore:t}=e,o=(0,r.O7)(),n=(0,a.VK)((()=>t.collectionViewStore()),[t]);return n?(0,ue.jsx)(Qo.ZP,{...e,title:"Select page to display",children:(0,ue.jsx)("div",{style:{margin:12},children:(0,ue.jsx)(ip.Z,{showClearButton:!0,placeholder:"Enter page ID",focusInitial:!0,onChange:e=>{Ir.Z.setState({pageId:e.target.value})},onSubmit:e=>{const t=Ir.Z.state.pageId;if(!t)return null;p.createAndCommit({userAction:"collectionSettings.pageView.selectPage",environment:o,perform:e=>{u.FH({stores:[n],update:{page_pointer:{id:(0,s.Mt)(t),spaceId:e.spaceId,table:"block"}},transaction:e})}})}})})}):null}function ug(e){const{tab:t}=e;return"createSyncedViewSource"!==t.type?null:(0,ue.jsx)(Es,{...e,...t})}function pg(e){const{tab:t}=e;return"selectAccountForExternalSource"!==t.type?null:(0,ue.jsx)(ws,{...e,...t})}function gg(e){const{tab:t}=e;return"shareSyncedView"!==t.type?null:(0,ue.jsx)(Tu,{...e,...t})}function mg(e){const{tab:t}=e;return"propertyType"!==t.type?null:(0,ue.jsx)(mu,{...e,...t})}function Sg(e){const{tab:t}=e;return"propertyAiAutofill"!==t.type?null:(0,ue.jsx)(Rd,{...e,...t})}function yg(e){const{tab:t}=e;return"properties"!==t.type?null:(0,ue.jsx)(xp.Z,{...e,timelineViewTab:t.timelineViewTab})}function hg(e){const{tab:t}=e;return"property"!==t.type?null:(0,ue.jsx)(ld.ZP,{...e,...t},t.property)}function fg(e){const{tab:t}=e;return"deletedProperties"!==t.type?null:(0,ue.jsx)(ad,{...t,...e})}function xg(e){const{tab:t}=e;return"selectRelationSource"!==t.type?null:(0,ue.jsx)(hu,{...e,...t})}function vg(e){const{tab:t}=e;return"setupRelation"!==t.type?null:(0,ue.jsx)(vu,{...e,...t})}function Cg(e){const{tab:t}=e;return"group"!==t.type?null:(0,ue.jsx)(mc,{...e,...t})}function bg(e){const{tab:t}=e;return"groupByProperty"!==t.type?null:(0,ue.jsx)(mp,{...e,...t})}function wg(e){const{tab:t}=e;return"groupByNumber"!==t.type?null:(0,ue.jsx)(dp,{...e,...t})}function jg(e){const{tab:t}=e;return"subitem"!==t.type?null:(0,ue.jsx)(Cs,{...e,...t,formatSetting:"subitem"})}function Mg(e){const{tab:t}=e;return"subitemV2"!==t.type?null:(0,ue.jsx)(ts,{...e,feature:"subitem"})}function _g(e){const{tab:t}=e;return"arrowsBy"!==t.type?null:(0,ue.jsx)(Cs,{...e,...t,formatSetting:"timeline_arrows_by"})}function kg(e){const{tab:t}=e;return"dependencies"!==t.type?null:(0,ue.jsx)(ts,{...e,feature:"timeline_arrows_by"})}function Tg(e){const{tab:t}=e;return"relationFeaturesAdvancedSettings"!==t.type?null:(0,ue.jsx)(Ss,{...e,feature:t.feature})}function Ag(e){const{tab:t}=e;return"githubConfig"!==t.type?null:(0,ue.jsx)(Br.Z,{...e,property:t.property})}function Pg(e){const{tab:t}=e;return"filter"!==t.type?null:(0,ue.jsx)(Hu,{...e})}function Vg(e){const{tab:t}=e;return"automationSettings"!==t.type?null:(0,ue.jsx)(En,{...e,tabSettings:t})}function Fg(e){let{tab:t,collectionContextStore:o,collectionSettingsStore:n}=e;return"automationCreateSettings"!==t.type?null:(0,ue.jsx)(Tr,{collectionContextStore:o,collectionSettingsStore:n,mode:"create"})}function Ig(e){let{tab:t,collectionContextStore:o,collectionSettingsStore:n}=e;if("automationEditSettings"!==t.type)return null;const{automationId:i}=t;return(0,ue.jsx)(Tr,{automationId:i,collectionContextStore:o,collectionSettingsStore:n,mode:"update"})}function Bg(e){let{tab:t,collectionContextStore:o,collectionSettingsStore:n}=e;return"sprintSettings"!==t.type?null:(0,ue.jsx)(Hp,{collectionContextStore:o,collectionSettingsStore:n})}},51774:(e,t,o)=>{o.d(t,{P:()=>s});o(67294);var n=o(77907),i=o(13005),r=o(68785),a=o(85893);function s(e){return(0,a.jsx)(n.LazyCollectionSettings,{...e,renderLoading:t=>(0,a.jsx)(i.ZP,{collectionSettingsStore:e.collectionSettingsStore,collectionContextStore:e.collectionContextStore,fullHeight:e.fullHeight,hideDesktopHeader:e.hideDesktopHeader,children:t&&(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",overflow:"hidden"},children:(0,a.jsx)(r.Z,{})})})})}},46978:(e,t,o)=>{o.d(t,{Z:()=>s});var n=o(67294),i=o(24405),r=o(85893);function a(e,t){let{isSelected:o}=e;window.__c={n:"RadioButtonIcon"};const{radioButtonStyle:n,dotStyle:a}=(0,i.yK)((e=>({radioButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:16,height:16,borderRadius:16,marginRight:8,background:o?e.blueColor:e.whiteButtonBackground,border:o?"none":`1px solid ${e.radioButtonBorder}`,transition:"background 100ms ease-out"},dotStyle:{width:6,height:6,borderRadius:6,background:e.regularInvertedTextColor,transition:"opacity 100ms ease-out",opacity:o?1:0}})),[o]);return(0,r.jsx)("div",{ref:t,style:n,children:(0,r.jsx)("div",{style:a})})}const s=n.forwardRef(a)},90683:(e,t,o)=>{o.d(t,{a:()=>l});o(67294);var n=o(66897),i=o(97880),r=o(70301),a=o(45653),s=o(85893);function l(e){const{actor:t}=e,o={size:e.size??14,style:{marginRight:2,...e.style}};return(0,n.YU)(t)?(0,s.jsx)(r.Z,{botValue:t.asActor,...o}):(0,n.$S)(t)?(0,s.jsx)(a.Z,{userValue:t.asActor,...o}):(0,n.Iq)(t)?(0,s.jsx)(a.Z,{userValue:void 0,...o}):void(0,i.t1)(t)}},18441:(e,t,o)=>{o.d(t,{P9:()=>l,YJ:()=>c,jc:()=>s,jg:()=>a});o(57658);var n=o(77657),i=o(59753),r=o(32161);function a(e){if(e.integration_id!==n.nO)throw"Cannot render account for integration.";const t=/(.+) - (.+)/.exec(e.account_name);if(!t)return{accountName:e.account_name};const[,o,i]=t;return{organizationName:o,accountName:i}}function s(e){return i.kk.fromValue(r.P,e).getSlackWorkspaceId()}function l(e,t){return t?e.filter((e=>{const o=s(e);return!!o&&t(o)})):e}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const o={};for(const n of e){const{accountName:e,organizationName:i}=a(n);d({query:t,accountName:e,organizationName:i})&&(o[e]||(o[e]=[]),o[e].push({externalAuthentication:n,workspaceName:i}))}return o}function d(e){const{accountName:t,organizationName:o,query:n}=e;if(0===n.length)return!0;const i=t.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0,r=!!o&&o.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0;return i||r}},52489:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(49085);class i extends n.default{getInitialState(){return{isModalOpen:!1,collectionContextStore:void 0}}}const r=new i},28410:(e,t,o)=>{o.d(t,{Th:()=>n,jQ:()=>a});const n=12e3,i=["openai-1.1","openai-2","openai-4","openai-5","openai-6","openai-7","openai-8"];const r=["anthropic-1","anthropic-2","anthropic-qa-alpha","anthropic-3"];function a(e){return r.includes(e)}},39927:(e,t,o)=>{o.d(t,{i:()=>n});const n={autoCompleteSprints:!1,actionConfig:{complete_sprint_action:"complete_sprint_and_move_incomplete_tasks_to_next_sprint"},recurrenceConfig:{interval:2,weekdays:["MO"]}}}}]);