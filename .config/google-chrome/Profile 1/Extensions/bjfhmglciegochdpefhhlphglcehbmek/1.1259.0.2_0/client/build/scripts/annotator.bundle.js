!function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(){function t(t){var e=!0,n=!1,i=null,o={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function r(t){return!!(t&&t!==document&&"HTML"!==t.nodeName&&"BODY"!==t.nodeName&&"classList"in t&&"contains"in t.classList)}function s(t){var e=t.type,n=t.tagName
;return!("INPUT"!==n||!o[e]||t.readOnly)||"TEXTAREA"===n&&!t.readOnly||!!t.isContentEditable}function a(t){t.classList.contains("focus-visible")||(t.classList.add("focus-visible"),t.setAttribute("data-focus-visible-added",""))}function l(t){t.hasAttribute("data-focus-visible-added")&&(t.classList.remove("focus-visible"),t.removeAttribute("data-focus-visible-added"))}function c(n){n.metaKey||n.altKey||n.ctrlKey||(r(t.activeElement)&&a(t.activeElement),e=!0)}function h(t){e=!1}function u(t){r(t.target)&&(e||s(t.target))&&a(t.target)}function d(t){r(t.target)&&(t.target.classList.contains("focus-visible")||t.target.hasAttribute("data-focus-visible-added"))&&(n=!0,window.clearTimeout(i),i=window.setTimeout((function(){n=!1}),100),l(t.target))}function f(t){"hidden"===document.visibilityState&&(n&&(e=!0),p())}function p(){document.addEventListener("mousemove",g),document.addEventListener("mousedown",g),document.addEventListener("mouseup",g),document.addEventListener("pointermove",g),
document.addEventListener("pointerdown",g),document.addEventListener("pointerup",g),document.addEventListener("touchmove",g),document.addEventListener("touchstart",g),document.addEventListener("touchend",g)}function m(){document.removeEventListener("mousemove",g),document.removeEventListener("mousedown",g),document.removeEventListener("mouseup",g),document.removeEventListener("pointermove",g),document.removeEventListener("pointerdown",g),document.removeEventListener("pointerup",g),document.removeEventListener("touchmove",g),document.removeEventListener("touchstart",g),document.removeEventListener("touchend",g)}function g(t){t.target.nodeName&&"html"===t.target.nodeName.toLowerCase()||(e=!1,m())}document.addEventListener("keydown",c,!0),document.addEventListener("mousedown",h,!0),document.addEventListener("pointerdown",h,!0),document.addEventListener("touchstart",h,!0),document.addEventListener("visibilitychange",f,!0),p(),t.addEventListener("focus",u,!0),t.addEventListener("blur",d,!0),
t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&t.host?t.host.setAttribute("data-js-focus-visible",""):t.nodeType===Node.DOCUMENT_NODE&&(document.documentElement.classList.add("js-focus-visible"),document.documentElement.setAttribute("data-js-focus-visible",""))}if("undefined"!=typeof window&&"undefined"!=typeof document){var e;window.applyFocusVisiblePolyfill=t;try{e=new CustomEvent("focus-visible-polyfill-ready")}catch(t){(e=document.createEvent("CustomEvent")).initCustomEvent("focus-visible-polyfill-ready",!1,!1,{})}window.dispatchEvent(e)}"undefined"!=typeof document&&t(document)}();class n{constructor(){e(this,"_listeners",void 0),this._listeners=new Map}add(t,e,n,i){t.addEventListener(e,n,i);const o=Symbol();return this._listeners.set(o,{eventTarget:t,eventType:e,listener:n}),o}remove(t){const e=this._listeners.get(t);if(e){const{eventTarget:n,eventType:i,listener:o}=e;n.removeEventListener(i,o),this._listeners.delete(t)}}removeAll(){this._listeners.forEach((({eventTarget:t,eventType:e,listener:n})=>{
t.removeEventListener(e,n)})),this._listeners.clear()}}function i(t){const e=t.toString(16);return 1===e.length?"0"+e:e}function o(t){const e=new Uint8Array(t/2);return window.crypto.getRandomValues(e),Array.from(e).map(i).join("")}function r(t){if(null===t||"object"!=typeof t)return!1;for(let e of["frame1","frame2","type","requestId"])if("string"!=typeof t[e])return!1;return!0}function s(t,e){return!!r(t)&&JSON.stringify(t,Object.keys(e).sort())===JSON.stringify(e,Object.keys(e).sort())}class a{constructor({hostFrame:t,source:e,sourceId:i}){this._hostFrame=t,this._source=e,this._sourceId=i,this._listeners=new n}destroy(){this._listeners.removeAll()}async discover(t){let e=!1;if(("guest"===this._source&&"host"===t||"guest"===this._source&&"sidebar"===t||"sidebar"===this._source&&"host"===t||"notebook"===this._source&&"sidebar"===t)&&(e=!0),!e)throw new Error("Invalid request of channel/port");const n=o(6);return new Promise(((e,i)=>{const o=()=>{this._hostFrame.postMessage({frame1:this._source,frame2:t,
type:"request",requestId:n,sourceId:this._sourceId},"*")},r=setInterval(o,250),a=setTimeout((()=>{clearInterval(r),i(new Error(`Unable to establish ${this._source}-${t} communication channel`))}),2e4),l=this._listeners.add(window,"message",(i=>{const{data:o,ports:c}=i;s(o,{frame1:this._source,frame2:t,type:"offer",requestId:n})&&(clearInterval(r),clearTimeout(a),this._listeners.remove(l),e(c[0]))}));o()}))}}var l={},c={get exports(){return l},set exports(t){l=t}};function h(){}h.prototype={on:function(t,e,n){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var i=this;function o(){i.off(t,o),e.apply(n,arguments)}return o._=e,this.on(t,o,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),i=0,o=n.length;i<o;i++)n[i].fn.apply(n[i].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),i=n[t],o=[];if(i&&e)for(var r=0,s=i.length;r<s;r++)i[r].fn!==e&&i[r].fn._!==e&&o.push(i[r]);return o.length?n[t]=o:delete n[t],
this}},c.exports=h;var u=l.TinyEmitter=h;let d=null;function f(t){return t instanceof Error?{message:t.message,stack:t.stack}:{message:String(t),stack:void 0}}function p(t,e){if(!d)return;const n={type:"hypothesis-error",error:t instanceof Error?t:f(t),context:e};try{try{d.postMessage(n,"*")}catch(t){if(!(t instanceof DOMException&&"DataCloneError"===t.name))throw t;n.error=f(n.error),d.postMessage(n,"*")}}catch(t){console.warn("Unable to report Hypothesis error",t)}}function m(t){d=t}class g{constructor(t){this._hypothesisAppsOrigin=t,this._emitter=new u,this._handledRequests=new Set,this._sidebarHostChannel=new MessageChannel,this._listeners=new n,this._allowedMessages=[{allowedOrigin:"*",frame1:"guest",frame2:"host",type:"request"},{allowedOrigin:"*",frame1:"guest",frame2:"sidebar",type:"request"},{allowedOrigin:this._hypothesisAppsOrigin,frame1:"sidebar",frame2:"host",type:"request"},{allowedOrigin:this._hypothesisAppsOrigin,frame1:"notebook",frame2:"sidebar",type:"request"}],this._listen()}_listen(){
const t="Handling port request",e=new Set,n=n=>{e.has(n)||(e.add(n),p(new Error(n),t))};var i,o;this._listeners.add(window,"message",(i=t=>{const{data:e,origin:i,source:o}=t;if(!r(e)||"request"!==e.type)return;const{frame1:s,frame2:a,requestId:l,sourceId:c}=e,h=`${s}-${a}`;if(!function(t){return!(null===t||t instanceof MessagePort||window.ServiceWorker&&t instanceof ServiceWorker)}(o))return void n(`Ignored port request for channel ${h} from non-Window source`);if(void 0===this._allowedMessages.find((({allowedOrigin:t,...n})=>this._messageMatches({allowedMessage:n,allowedOrigin:t,data:e,origin:i}))))return void n(`Ignored invalid port request for channel ${h} from ${i}`);if(this._handledRequests.has(l))return;this._handledRequests.add(l);const u="sidebar-host"===h?this._sidebarHostChannel:new MessageChannel,d={frame1:s,frame2:a,type:"offer",requestId:l,sourceId:c},f="null"===i?"*":i;o.postMessage(d,f,[u.port1]),
"sidebar"===a?this._sidebarHostChannel.port2.postMessage(d,[u.port2]):"host"===a&&this._emitter.emit("frameConnected",s,u.port2)},o=t,(...t)=>{try{return i(...t)}catch(t){throw p(t,o),t}}))}_messageMatches({allowedMessage:t,allowedOrigin:e,data:n,origin:i}){return("*"===e||i===e)&&s(n,t)}on(t,e){this._emitter.on(t,e)}destroy(){this._listeners.removeAll()}}const _="1.0.0",v="frame-rpc";function b(t,e,n=[],i=-1){t.postMessage({protocol:v,version:_,arguments:n,method:e,sequence:i})}function y(t){const e=t.match(/\bAppleWebKit\/([0-9]+)\b/);if(!e)return!1;return!(parseInt(e[1])<=537)}class w{constructor({userAgent:t=navigator.userAgent,currentWindow:e=window}={}){this._port=null,this._methods=new Map,this._sequence=1,this._callbacks=new Map,this._listeners=new n,this._listeners.add(e,"unload",(()=>{this._port&&(b(this._port,"close"),e!==e.parent&&y(t)&&e.parent.postMessage({type:"hypothesisPortClosed"},"*",[this._port]))})),this._pendingCalls=[],this._receivedCloseEvent=!1}on(t,e){
if(this._port)throw new Error("Cannot add a method handler after a port is connected");this._methods.set(t,e)}connect(t){this._port=t,this._listeners.add(t,"message",(t=>this._handle(t))),t.start(),b(t,"connect");for(let[t,e]of this._pendingCalls)this.call(t,...e);this._pendingCalls=[]}destroy(){this._port&&(b(this._port,"close"),this._port.close()),this._destroyed=!0,this._listeners.removeAll()}call(t,...e){if(this._port||this._pendingCalls.push([t,e]),!this._port||this._destroyed)return;const n=this._sequence++,i=e[e.length-1];"function"==typeof i&&(this._callbacks.set(n,i),e=e.slice(0,-1)),b(this._port,t,e,n)}_parseMessage({data:t}){return t&&"object"==typeof t?t.protocol!==v||t.version!==_?null:Array.isArray(t.arguments)?t:null:null}_handle(t){const e=this._parseMessage(t),n=this._port;if(e&&n)if("method"in e){if("close"===e.method){if(this._receivedCloseEvent)return;this._receivedCloseEvent=!0}const t=this._methods.get(e.method);if(!t)return;const i=(...t)=>{const i={arguments:t,protocol:v,
response:e.sequence,version:_};n.postMessage(i)};t(...e.arguments,i)}else if("response"in e){const t=this._callbacks.get(e.response);this._callbacks.delete(e.response),t&&t(...e.arguments)}}}function x(t){if("string"==typeof t&&"false"===t.trim().toLocaleLowerCase())return!1;const e=Number(t);return isNaN(e)?"string"==typeof t:Boolean(e)}function C(t){for(var e={},n=t.querySelectorAll("script.js-hypothesis-config"),i=0;i<n.length;i++){var o=void 0;try{o=JSON.parse(n[i].textContent||"")}catch(t){console.warn("Could not parse settings from js-hypothesis-config tags",t),o={}}Object.assign(e,o)}return e}function S(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function E(t,e,n){const i=t.document.querySelector(`link[type="application/annotator+${n}"][rel="${e}"]`);if(!i)throw new Error(`No application/annotator+${n} (rel="${e}") link in the document`);if(!i.href)throw new Error(`application/annotator+${n} (rel="${e}") link has no href`);return i.href}function N(t){return"string"==typeof t?t:null}
function A(t){const e=function(t){if(!S(t,"hypothesisConfig"))return{};if("function"!=typeof t.hypothesisConfig){const t="https://h.readthedocs.io/projects/client/en/latest/publishers/config/#window.hypothesisConfig";return console.warn("hypothesisConfig must be a function, see: "+t),{}}return t.hypothesisConfig()}(t),n=x(e.ignoreOtherConfiguration)?{}:C(t.document);function i(t){return S(e,t)?e[t]:S(n,t)?n[t]:void 0}return{get annotations(){return N(n.annotations)||function(){const e=t.location.href.match(/#annotations:([A-Za-z0-9_-]+)$/);return e?e[1]:null}()},get clientUrl(){return E(t,"hypothesis-client","javascript")},get group(){return N(n.group)||function(){const e=t.location.href.match(/#annotations:group:([A-Za-z0-9_-]+)$/);return e?e[1]:null}()},get notebookAppUrl(){return E(t,"notebook","html")},get profileAppUrl(){return E(t,"profile","html")},get showHighlights(){return function(){const t=i("showHighlights");switch(t){case"always":case"never":case"whenSidebarOpen":return t;case!0:return"always"
;case!1:return"never";default:return"always"}}()},get sidebarAppUrl(){return E(t,"sidebar","html")},get query(){return N(n.query)||function(){const e=t.location.href.match(/#annotations:(query|q):(.+)$/i);if(e)try{return decodeURIComponent(e[2])}catch(t){}return null}()},hostPageSetting:i}}const R=(t,e)=>t.hostPageSetting(e),k={annotations:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.annotations},appType:{allowInBrowserExt:!0,defaultValue:null,getValue:R},branding:{defaultValue:null,allowInBrowserExt:!1,getValue:R},clientUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.clientUrl},contentInfoBanner:{allowInBrowserExt:!1,defaultValue:null,getValue:R},enableExperimentalNewNoteButton:{allowInBrowserExt:!1,defaultValue:null,getValue:R},group:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.group},focus:{allowInBrowserExt:!1,defaultValue:null,getValue:R},theme:{allowInBrowserExt:!1,defaultValue:null,getValue:R},usernameUrl:{allowInBrowserExt:!1,defaultValue:null,getValue:R},onLayoutChange:{
allowInBrowserExt:!1,defaultValue:null,getValue:R},openSidebar:{allowInBrowserExt:!0,defaultValue:!1,coerce:x,getValue:R},query:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.query},requestConfigFromFrame:{allowInBrowserExt:!1,defaultValue:null,getValue:R},services:{allowInBrowserExt:!1,defaultValue:null,getValue:R},showHighlights:{allowInBrowserExt:!1,defaultValue:"always",getValue:t=>t.showHighlights},notebookAppUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.notebookAppUrl},profileAppUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.profileAppUrl},sidebarAppUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:t=>t.sidebarAppUrl},subFrameIdentifier:{allowInBrowserExt:!0,defaultValue:null,getValue:R},externalContainerSelector:{allowInBrowserExt:!1,defaultValue:null,getValue:R}};function T(t,e=window){const n=A(e),i={};for(const r of function(t){const e={annotator:["clientUrl","contentInfoBanner","subFrameIdentifier"],
sidebar:["appType","annotations","branding","enableExperimentalNewNoteButton","externalContainerSelector","focus","group","onLayoutChange","openSidebar","query","requestConfigFromFrame","services","showHighlights","sidebarAppUrl","theme","usernameUrl"],notebook:["branding","group","notebookAppUrl","requestConfigFromFrame","services","theme","usernameUrl"],profile:["profileAppUrl"]};switch(t){case"annotator":return e.annotator;case"sidebar":return e.sidebar;case"notebook":return e.notebook;case"profile":return e.profile;case"all":return Object.values(e).flat();default:throw new Error(`Invalid application context used: "${t}"`)}}(t)){const t=k[r],s=void 0!==t.defaultValue,a=!((o=E(e,"sidebar","html")).startsWith("http://")||o.startsWith("https://"));if(!t.allowInBrowserExt&&a){s&&(i[r]=t.defaultValue);continue}const l=t.getValue(n,r);void 0!==l?i[r]=t.coerce?t.coerce(l):l:s&&(i[r]=t.defaultValue)}var o;return i}var P,O,L,M,I,F,D,B,H={},V=[],U=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i
;function q(t,e){for(var n in e)t[n]=e[n];return t}function W(t){var e=t.parentNode;e&&e.removeChild(t)}function z(t,e,n,i,o){var r={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==o?++L:o};return null==o&&null!=O.vnode&&O.vnode(r),r}function $(t){return t.children}function j(t,e){this.props=t,this.context=e}function X(t,e){if(null==e)return t.__?X(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof t.type?X(t):null}function Y(t){var e,n;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if(null!=(n=t.__k[e])&&null!=n.__e){t.__e=t.__c.base=n.__e;break}return Y(t)}}function Z(t){(!t.__d&&(t.__d=!0)&&M.push(t)&&!G.__r++||I!==O.debounceRendering)&&((I=O.debounceRendering)||F)(G)}function G(){var t,e,n,i,o,r,s,a;for(M.sort(D);t=M.shift();)t.__d&&(e=M.length,i=void 0,o=void 0,s=(r=(n=t).__v).__e,(a=n.__P)&&(i=[],
(o=q({},r)).__v=r.__v+1,rt(a,r,o,n.__n,void 0!==a.ownerSVGElement,null!=r.__h?[s]:null,i,null==s?X(r):s,r.__h),st(i,r),r.__e!=s&&Y(r)),M.length>e&&M.sort(D));G.__r=0}function K(t,e,n,i,o,r,s,a,l,c){var h,u,d,f,p,m,g,_=i&&i.__k||V,v=_.length;for(n.__k=[],h=0;h<e.length;h++)if(null!=(f=n.__k[h]=null==(f=e[h])||"boolean"==typeof f||"function"==typeof f?null:"string"==typeof f||"number"==typeof f||"bigint"==typeof f?z(null,f,null,null,f):Array.isArray(f)?z($,{children:f},null,null,null):f.__b>0?z(f.type,f.props,f.key,f.ref?f.ref:null,f.__v):f)){if(f.__=n,f.__b=n.__b+1,null===(d=_[h])||d&&f.key==d.key&&f.type===d.type)_[h]=void 0;else for(u=0;u<v;u++){if((d=_[u])&&f.key==d.key&&f.type===d.type){_[u]=void 0;break}d=null}rt(t,f,d=d||H,o,r,s,a,l,c),p=f.__e,(u=f.ref)&&d.ref!=u&&(g||(g=[]),d.ref&&g.push(d.ref,null,f),g.push(u,f.__c||p,f)),null!=p?(null==m&&(m=p),"function"==typeof f.type&&f.__k===d.__k?f.__d=l=Q(f,l,t):l=J(t,f,d,_,p,l),"function"==typeof n.type&&(n.__d=l)):l&&d.__e==l&&l.parentNode!=t&&(l=X(d))}
for(n.__e=m,h=v;h--;)null!=_[h]&&("function"==typeof n.type&&null!=_[h].__e&&_[h].__e==n.__d&&(n.__d=tt(i).nextSibling),ct(_[h],_[h]));if(g)for(h=0;h<g.length;h++)lt(g[h],g[++h],g[++h])}function Q(t,e,n){for(var i,o=t.__k,r=0;o&&r<o.length;r++)(i=o[r])&&(i.__=t,e="function"==typeof i.type?Q(i,e,n):J(n,i,i,o,i.__e,e));return e}function J(t,e,n,i,o,r){var s,a,l;if(void 0!==e.__d)s=e.__d,e.__d=void 0;else if(null==n||o!=r||null==o.parentNode)t:if(null==r||r.parentNode!==t)t.appendChild(o),s=null;else{for(a=r,l=0;(a=a.nextSibling)&&l<i.length;l+=1)if(a==o)break t;t.insertBefore(o,r),s=r}return void 0!==s?s:o.nextSibling}function tt(t){var e,n,i;if(null==t.type||"string"==typeof t.type)return t.__e;if(t.__k)for(e=t.__k.length-1;e>=0;e--)if((n=t.__k[e])&&(i=tt(n)))return i;return null}function et(t,e,n){"-"===e[0]?t.setProperty(e,null==n?"":n):t[e]=null==n?"":"number"!=typeof n||U.test(e)?n:n+"px"}function nt(t,e,n,i,o){var r;t:if("style"===e)if("string"==typeof n)t.style.cssText=n;else{
if("string"==typeof i&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||et(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||et(t.style,e,n[e])}else if("o"===e[0]&&"n"===e[1])r=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+r]=n,n?i||t.addEventListener(e,r?ot:it,r):t.removeEventListener(e,r?ot:it,r);else if("dangerouslySetInnerHTML"!==e){if(o)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==e&&"height"!==e&&"href"!==e&&"list"!==e&&"form"!==e&&"tabIndex"!==e&&"download"!==e&&e in t)try{t[e]=null==n?"":n;break t}catch(t){}"function"==typeof n||(null==n||!1===n&&"-"!==e[4]?t.removeAttribute(e):t.setAttribute(e,n))}}function it(t){return this.l[t.type+!1](O.event?O.event(t):t)}function ot(t){return this.l[t.type+!0](O.event?O.event(t):t)}function rt(t,e,n,i,o,r,s,a,l){var c,h,u,d,f,p,m,g,_,v,b,y,w,x,C,S=e.type;if(void 0!==e.constructor)return null;null!=n.__h&&(l=n.__h,a=e.__e=n.__e,e.__h=null,r=[a]),(c=O.__b)&&c(e);try{
t:if("function"==typeof S){if(g=e.props,_=(c=S.contextType)&&i[c.__c],v=c?_?_.props.value:c.__:i,n.__c?m=(h=e.__c=n.__c).__=h.__E:("prototype"in S&&S.prototype.render?e.__c=h=new S(g,v):(e.__c=h=new j(g,v),h.constructor=S,h.render=ht),_&&_.sub(h),h.props=g,h.state||(h.state={}),h.context=v,h.__n=i,u=h.__d=!0,h.__h=[],h._sb=[]),null==h.__s&&(h.__s=h.state),null!=S.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=q({},h.__s)),q(h.__s,S.getDerivedStateFromProps(g,h.__s))),d=h.props,f=h.state,h.__v=e,u)null==S.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==S.getDerivedStateFromProps&&g!==d&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(g,v),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(g,h.__s,v)||e.__v===n.__v){for(e.__v!==n.__v&&(h.props=g,h.state=h.__s,h.__d=!1),h.__e=!1,e.__e=n.__e,e.__k=n.__k,e.__k.forEach((function(t){t&&(t.__=e)})),
b=0;b<h._sb.length;b++)h.__h.push(h._sb[b]);h._sb=[],h.__h.length&&s.push(h);break t}null!=h.componentWillUpdate&&h.componentWillUpdate(g,h.__s,v),null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(d,f,p)}))}if(h.context=v,h.props=g,h.__P=t,y=O.__r,w=0,"prototype"in S&&S.prototype.render){for(h.state=h.__s,h.__d=!1,y&&y(e),c=h.render(h.props,h.state,h.context),x=0;x<h._sb.length;x++)h.__h.push(h._sb[x]);h._sb=[]}else do{h.__d=!1,y&&y(e),c=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++w<25);h.state=h.__s,null!=h.getChildContext&&(i=q(q({},i),h.getChildContext())),u||null==h.getSnapshotBeforeUpdate||(p=h.getSnapshotBeforeUpdate(d,f)),C=null!=c&&c.type===$&&null==c.key?c.props.children:c,K(t,Array.isArray(C)?C:[C],e,n,i,o,r,s,a,l),h.base=e.__e,e.__h=null,h.__h.length&&s.push(h),m&&(h.__E=h.__=null),h.__e=!1}else null==r&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=at(n.__e,e,n,i,o,r,s,l);(c=O.diffed)&&c(e)}catch(t){e.__v=null,(l||null!=r)&&(e.__e=a,e.__h=!!l,
r[r.indexOf(a)]=null),O.__e(t,e,n)}}function st(t,e){O.__c&&O.__c(e,t),t.some((function(e){try{t=e.__h,e.__h=[],t.some((function(t){t.call(e)}))}catch(t){O.__e(t,e.__v)}}))}function at(t,e,n,i,o,r,s,a){var l,c,h,u=n.props,d=e.props,f=e.type,p=0;if("svg"===f&&(o=!0),null!=r)for(;p<r.length;p++)if((l=r[p])&&"setAttribute"in l==!!f&&(f?l.localName===f:3===l.nodeType)){t=l,r[p]=null;break}if(null==t){if(null===f)return document.createTextNode(d);t=o?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,d.is&&d),r=null,a=!1}if(null===f)u===d||a&&t.data===d||(t.data=d);else{if(r=r&&P.call(t.childNodes),c=(u=n.props||H).dangerouslySetInnerHTML,h=d.dangerouslySetInnerHTML,!a){if(null!=r)for(u={},p=0;p<t.attributes.length;p++)u[t.attributes[p].name]=t.attributes[p].value;(h||c)&&(h&&(c&&h.__html==c.__html||h.__html===t.innerHTML)||(t.innerHTML=h&&h.__html||""))}if(function(t,e,n,i,o){var r;for(r in n)"children"===r||"key"===r||r in e||nt(t,r,null,n[r],i)
;for(r in e)o&&"function"!=typeof e[r]||"children"===r||"key"===r||"value"===r||"checked"===r||n[r]===e[r]||nt(t,r,e[r],n[r],i)}(t,d,u,o,a),h)e.__k=[];else if(p=e.props.children,K(t,Array.isArray(p)?p:[p],e,n,i,o&&"foreignObject"!==f,r,s,r?r[0]:n.__k&&X(n,0),a),null!=r)for(p=r.length;p--;)null!=r[p]&&W(r[p]);a||("value"in d&&void 0!==(p=d.value)&&(p!==t.value||"progress"===f&&!p||"option"===f&&p!==u.value)&&nt(t,"value",p,u.value,!1),"checked"in d&&void 0!==(p=d.checked)&&p!==t.checked&&nt(t,"checked",p,u.checked,!1))}return t}function lt(t,e,n){try{"function"==typeof t?t(e):t.current=e}catch(t){O.__e(t,n)}}function ct(t,e,n){var i,o;if(O.unmount&&O.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||lt(i,null,e)),null!=(i=t.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(t){O.__e(t,e)}i.base=i.__P=null,t.__c=void 0}if(i=t.__k)for(o=0;o<i.length;o++)i[o]&&ct(i[o],e,n||"function"!=typeof t.type);n||null==t.__e||W(t.__e),t.__=t.__e=t.__d=void 0}function ht(t,e,n){return this.constructor(t,n)
}function ut(t,e,n){var i,o,r;O.__&&O.__(t,e),o=(i="function"==typeof n)?null:n&&n.__k||e.__k,r=[],rt(e,t=(!i&&n||e).__k=function(t,e,n){var i,o,r,s={};for(r in e)"key"==r?i=e[r]:"ref"==r?o=e[r]:s[r]=e[r];if(arguments.length>2&&(s.children=arguments.length>3?P.call(arguments,2):n),"function"==typeof t&&null!=t.defaultProps)for(r in t.defaultProps)void 0===s[r]&&(s[r]=t.defaultProps[r]);return z(t,s,i,o,null)}($,null,[t]),o||H,H,void 0!==e.ownerSVGElement,!i&&n?[n]:o?null:e.firstChild?P.call(e.childNodes):null,r,!i&&n?n:o?o.__e:e.firstChild,i),st(r,t)}function dt(t,e){var n={__c:e="__cC"+B++,__:t,Consumer:function(t,e){return t.children(e)},Provider:function(t){var n,i;return this.getChildContext||(n=[],(i={})[e]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(t){this.props.value!==t.value&&n.some((function(t){t.__e=!0,Z(t)}))},this.sub=function(t){n.push(t);var e=t.componentWillUnmount;t.componentWillUnmount=function(){n.splice(n.indexOf(t),1),e&&e.call(t)}}),t.children}}
;return n.Provider.__=n.Consumer.contextType=n}P=V.slice,O={__e:function(t,e,n,i){for(var o,r,s;e=e.__;)if((o=e.__c)&&!o.__)try{if((r=o.constructor)&&null!=r.getDerivedStateFromError&&(o.setState(r.getDerivedStateFromError(t)),s=o.__d),null!=o.componentDidCatch&&(o.componentDidCatch(t,i||{}),s=o.__d),s)return o.__E=o}catch(e){t=e}throw t}},L=0,j.prototype.setState=function(t,e){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=q({},this.state),"function"==typeof t&&(t=t(q({},n),this.props)),t&&q(n,t),null!=t&&this.__v&&(e&&this._sb.push(e),Z(this))},j.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Z(this))},j.prototype.render=$,M=[],F="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,D=function(t,e){return t.__v.__b-e.__v.__b},G.__r=0,B=0;var ft,pt,mt,gt,_t=0,vt=[],bt=[],yt=O.__b,wt=O.__r,xt=O.diffed,Ct=O.__c,St=O.unmount;function Et(t,e){O.__h&&O.__h(pt,t,_t||e),_t=0;var n=pt.__H||(pt.__H={__:[],__h:[]})
;return t>=n.__.length&&n.__.push({__V:bt}),n.__[t]}function Nt(t){return _t=1,function(t,e,n){var i=Et(ft++,2);if(i.t=t,!i.__c&&(i.__=[n?n(e):Dt(void 0,e),function(t){var e=i.__N?i.__N[0]:i.__[0],n=i.t(e,t);e!==n&&(i.__N=[n,i.__[1]],i.__c.setState({}))}],i.__c=pt,!pt.u)){var o=function(t,e,n){if(!i.__c.__H)return!0;var o=i.__c.__H.__.filter((function(t){return t.__c}));if(o.every((function(t){return!t.__N})))return!r||r.call(this,t,e,n);var s=!1;return o.forEach((function(t){if(t.__N){var e=t.__[0];t.__=t.__N,t.__N=void 0,e!==t.__[0]&&(s=!0)}})),!(!s&&i.__c.props===t)&&(!r||r.call(this,t,e,n))};pt.u=!0;var r=pt.shouldComponentUpdate,s=pt.componentWillUpdate;pt.componentWillUpdate=function(t,e,n){if(this.__e){var i=r;r=void 0,o(t,e,n),r=i}s&&s.call(this,t,e,n)},pt.shouldComponentUpdate=o}return i.__N||i.__}(Dt,t)}function At(t,e){var n=Et(ft++,3);!O.__s&&Ft(n.__H,e)&&(n.__=t,n.i=e,pt.__H.__h.push(n))}function Rt(t){return _t=5,kt((function(){return{current:t}}),[])}function kt(t,e){var n=Et(ft++,7)
;return Ft(n.__H,e)?(n.__V=t(),n.i=e,n.__h=t,n.__V):n.__}function Tt(t,e){return _t=8,kt((function(){return t}),e)}function Pt(){for(var t;t=vt.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(Mt),t.__H.__h.forEach(It),t.__H.__h=[]}catch(e){t.__H.__h=[],O.__e(e,t.__v)}}O.__b=function(t){pt=null,yt&&yt(t)},O.__r=function(t){wt&&wt(t),ft=0;var e=(pt=t.__c).__H;e&&(mt===pt?(e.__h=[],pt.__h=[],e.__.forEach((function(t){t.__N&&(t.__=t.__N),t.__V=bt,t.__N=t.i=void 0}))):(e.__h.forEach(Mt),e.__h.forEach(It),e.__h=[])),mt=pt},O.diffed=function(t){xt&&xt(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(1!==vt.push(e)&&gt===O.requestAnimationFrame||((gt=O.requestAnimationFrame)||Lt)(Pt)),e.__H.__.forEach((function(t){t.i&&(t.__H=t.i),t.__V!==bt&&(t.__=t.__V),t.i=void 0,t.__V=bt}))),mt=pt=null},O.__c=function(t,e){e.some((function(t){try{t.__h.forEach(Mt),t.__h=t.__h.filter((function(t){return!t.__||It(t)}))}catch(n){e.some((function(t){t.__h&&(t.__h=[])})),e=[],O.__e(n,t.__v)}})),Ct&&Ct(t,e)},O.unmount=function(t){St&&St(t)
;var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach((function(t){try{Mt(t)}catch(t){e=t}})),n.__H=void 0,e&&O.__e(e,n.__v))};var Ot="function"==typeof requestAnimationFrame;function Lt(t){var e,n=function(){clearTimeout(i),Ot&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(n,100);Ot&&(e=requestAnimationFrame(n))}function Mt(t){var e=pt,n=t.__c;"function"==typeof n&&(t.__c=void 0,n()),pt=e}function It(t){var e=pt;t.__c=t.__(),pt=e}function Ft(t,e){return!t||t.length!==e.length||e.some((function(e,n){return e!==t[n]}))}function Dt(t,e){return"function"==typeof e?e(t):e}const Bt={alt:1,ctrl:2,meta:4,shift:8};function Ht(t,e){const n=e.split("+").map((t=>t.toLowerCase()));let i=0,o=null;for(const t of n){const e=Bt[t];if(e)i|=e;else{if(null!==o)throw new Error("Multiple non-modifier keys specified");o=t}}if(!o)throw new Error(`Invalid shortcut: ${e}`);return((t.ctrlKey?Bt.ctrl:0)|(t.metaKey?Bt.meta:0)|(t.altKey?Bt.alt:0)|(t.shiftKey?Bt.shift:0))===i&&t.key.toLowerCase()===o}function Vt(t,e,{rootElement:n}={}){
At((()=>{if(t)return function(t,e,{rootElement:n=document.documentElement}={}){const i=n=>{Ht(n,t)&&e(n)};return n.addEventListener("keydown",i),()=>n.removeEventListener("keydown",i)}(t,e,{rootElement:n})}),[t,e,n])}const Ut=(t=window)=>t.matchMedia("(pointer: coarse)").matches;var qt=0;function Wt(t,e,n,i,o,r){var s,a,l={};for(a in e)"ref"==a?s=e[a]:l[a]=e[a];var c={type:t,props:l,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--qt,__source:o,__self:r};if("function"==typeof t&&(s=t.defaultProps))for(a in s)void 0===l[a]&&(l[a]=s[a]);return O.vnode&&O.vnode(c),c}var zt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Annotate.tsx";function $t(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","data-component":"AnnotateIcon",...t,children:Wt("path",{fill:"currentColor",
d:"M15 0c.27 0 .505.099.703.297A.961.961 0 0 1 16 1v15l-4-3H1a.974.974 0 0 1-.703-.29A.953.953 0 0 1 0 12V1A.96.96 0 0 1 .29.29.966.966 0 0 1 1 0h14zM7 3l-.469.063c-.312.041-.656.187-1.031.437-.375.25-.719.646-1.031 1.188C4.156 5.229 4 6 4 7l.002.063.006.062a.896.896 0 0 1 .008.11l-.002.074-.006.066a1.447 1.447 0 0 0 .43 1.188C4.729 8.854 5.082 9 5.5 9c.417 0 .77-.146 1.063-.438C6.854 8.271 7 7.918 7 7.5c0-.417-.146-.77-.438-1.063A1.447 1.447 0 0 0 5.5 6a1.467 1.467 0 0 0-.422.062c.177-1.03.542-1.632 1.094-1.804L7 4V3zm5 0-.469.063c-.312.041-.656.187-1.031.437-.375.25-.719.646-1.031 1.188C9.156 5.229 9 6 9 7l.002.063.006.062a.896.896 0 0 1 .008.11l-.002.074-.006.066a1.447 1.447 0 0 0 .43 1.188c.291.291.645.437 1.062.437.417 0 .77-.146 1.063-.438.291-.291.437-.645.437-1.062 0-.417-.146-.77-.438-1.063A1.447 1.447 0 0 0 10.5 6a1.467 1.467 0 0 0-.422.062c.177-1.03.542-1.632 1.094-1.804L12 4V3z"},void 0,0,{fileName:zt,lineNumber:19,columnNumber:7},this)},void 0,0,{fileName:zt,lineNumber:11,columnNumber:5},this)}
var jt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Cancel.tsx";function Xt(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CancelIcon",...t,children:Wt("g",{fill:"none","fill-rule":"evenodd",children:[Wt("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:jt,lineNumber:21,columnNumber:9},this),Wt("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m8 8 3.536-3.536L8 8 4.464 4.464 8 8zm0 0-3.536 3.536L8 8l3.536 3.536L8 8z"},void 0,0,{fileName:jt,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:jt,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:jt,lineNumber:11,columnNumber:5},this)}var Yt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretDown.tsx";function Zt(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretDownIcon",
...t,children:Wt("g",{fill:"none","fill-rule":"evenodd",children:[Wt("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:Yt,lineNumber:21,columnNumber:9},this),Wt("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m12 6-4 4-4-4"},void 0,0,{fileName:Yt,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Yt,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Yt,lineNumber:11,columnNumber:5},this)}var Gt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretLeft.tsx";function Kt(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretLeftIcon",...t,children:Wt("g",{fill:"none","fill-rule":"evenodd",children:[Wt("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:Gt,lineNumber:21,columnNumber:9},this),Wt("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 12 6 8l4-4"},void 0,0,{fileName:Gt,lineNumber:22,
columnNumber:9},this)]},void 0,0,{fileName:Gt,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Gt,lineNumber:11,columnNumber:5},this)}var Qt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretRight.tsx";function Jt(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretRightIcon",...t,children:Wt("g",{fill:"none","fill-rule":"evenodd",children:[Wt("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:Qt,lineNumber:21,columnNumber:9},this),Wt("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m6 4 4 4-4 4"},void 0,0,{fileName:Qt,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Qt,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Qt,lineNumber:11,columnNumber:5},this)}var te="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Caution.tsx";function ee(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",
height:"16",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",viewBox:"0 0 24 24","data-component":"CautionIcon",...t,children:Wt("path",{d:"M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01"},void 0,0,{fileName:te,lineNumber:24,columnNumber:7},this)},void 0,0,{fileName:te,lineNumber:11,columnNumber:5},this)}var ne="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Check.tsx";function ie(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","data-component":"CheckIcon",...t,children:Wt("g",{fill:"none","fill-rule":"evenodd",children:[Wt("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:ne,lineNumber:20,columnNumber:9},this),Wt("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 3 6 13 3 8"},void 0,0,{fileName:ne,lineNumber:21,columnNumber:9},this)]},void 0,0,{fileName:ne,lineNumber:19,
columnNumber:7},this)},void 0,0,{fileName:ne,lineNumber:11,columnNumber:5},this)}var oe="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Hide.tsx";function re(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"HideIcon",...t,children:Wt("path",{fill:"currentColor",d:"m1.613.21.094.083 14 14a1 1 0 0 1-1.32 1.497l-.094-.083-14-14A1 1 0 0 1 1.613.21Zm.583 4.845a1 1 0 0 1 .292 1.384C2.165 6.935 2 7.46 2 8c0 2.123 2.628 4 6 4 .22 0 .44-.008.657-.024a1 1 0 0 1 .147 1.994c-.266.02-.534.03-.804.03-4.36 0-8-2.6-8-6 0-.937.283-1.84.812-2.653a1 1 0 0 1 1.384-.292ZM8 2c4.36 0 8 2.6 8 6 0 .937-.283 1.84-.812 2.653a1 1 0 0 1-1.676-1.092C13.835 9.065 14 8.54 14 8c0-2.123-2.628-4-6-4-.22 0-.44.008-.657.024a1 1 0 1 1-.147-1.994C7.462 2.01 7.73 2 8 2Z"},void 0,0,{fileName:oe,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:oe,lineNumber:11,columnNumber:5},this)}
var se="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Highlight.tsx";function ae(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"HighlightIcon",...t,children:Wt("g",{fill:"none","fill-rule":"evenodd",children:[Wt("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:se,lineNumber:21,columnNumber:9},this),Wt("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15H1h11zm-.5-6v2l-1 1v-2l1-1zm.5-7v6h-2V2h2zm0-1h-2 2zm0 8h-2 2z"},void 0,0,{fileName:se,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:se,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:se,lineNumber:11,columnNumber:5},this)}var le="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Note.tsx";function ce(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"NoteIcon",...t,
children:Wt("path",{fill:"currentColor",d:"M14 0a2 2 0 0 1 1.995 1.85L16 2v7a1 1 0 0 1-.31.724l-.09.076-8 6a1 1 0 0 1-.471.192L7 16H2a2 2 0 0 1-1.995-1.85L0 14V2A2 2 0 0 1 1.85.005L2 0h12Zm0 2H2v12h4V9a1 1 0 0 1 .883-.993L7 8h7V2Zm-2 8H8v3l4-3Z"},void 0,0,{fileName:le,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:le,lineNumber:11,columnNumber:5},this)}var he="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/PointerDown.tsx";function ue(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"9","data-component":"PointerDownIcon",...t,children:Wt("path",{stroke:"currentColor",d:"m15.5 0-7 8-8-8"},void 0,0,{fileName:he,lineNumber:18,columnNumber:7},this)},void 0,0,{fileName:he,lineNumber:11,columnNumber:5},this)}var de="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/PointerUp.tsx";function fe(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"9","data-component":"PointerUpIcon",...t,children:Wt("path",{
stroke:"currentColor",d:"m.5 9 7-8 8 8"},void 0,0,{fileName:de,lineNumber:18,columnNumber:7},this)},void 0,0,{fileName:de,lineNumber:11,columnNumber:5},this)}var pe="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Show.tsx";function me(t){return Wt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"ShowIcon",...t,children:Wt("path",{fill:"currentColor",d:"M8 2c4.36 0 8 2.6 8 6s-3.64 6-8 6c-4.36 0-8-2.6-8-6s3.64-6 8-6Zm0 2C4.628 4 2 5.877 2 8s2.628 4 6 4 6-1.877 6-4-2.628-4-6-4Zm0 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4Z"},void 0,0,{fileName:pe,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:pe,lineNumber:11,columnNumber:5},this)}var ge,_e={},ve={get exports(){return _e},set exports(t){_e=t}};ge=ve,function(){var t={}.hasOwnProperty;function e(){for(var n=[],i=0;i<arguments.length;i++){var o=arguments[i];if(o){var r=typeof o;if("string"===r||"number"===r)n.push(o);else if(Array.isArray(o)){if(o.length){
var s=e.apply(null,o);s&&n.push(s)}}else if("object"===r){if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]")){n.push(o.toString());continue}for(var a in o)t.call(o,a)&&o[a]&&n.push(a)}}}return n.join(" ")}ge.exports?(e.default=e,ge.exports=e):window.classNames=e}();var be=_e;dt({}),dt({}),dt(null);const ye=function({children:t,classes:e,elementRef:n,active:i=!1,variant:o="raised",width:r="full",...s}){return Wt("div",{"data-component":"Card",...s,ref:n,className:be("rounded-sm border bg-white",{"shadow hover:shadow-md":"raised"===o,"shadow-md":i&&"raised"===o},{"w-full":"full"===r,"w-auto":"auto"===r},e),children:t},void 0,0,{fileName:"/home/runner/work/frontend-shared/frontend-shared/src/components/layout/Card.tsx",lineNumber:40,columnNumber:5},this)};const we=function({children:t,classes:e,elementRef:n,size:i="md",...o}){return Wt("div",{"data-component":"CardContent",...o,ref:n,className:be({"p-3 space-y-4":"md"===i,"p-2 space-y-3":"sm"===i,"p-4 space-y-6":"lg"===i
},e),children:t},void 0,0,{fileName:"/home/runner/work/frontend-shared/frontend-shared/src/components/layout/CardContent.tsx",lineNumber:29,columnNumber:5},this)};const xe=function({elementRef:t,children:e,classes:n,unstyled:i=!1,expanded:o,pressed:r,title:s,role:a,...l}){const c={"aria-label":s};return"tab"===a?c["aria-selected"]=r:(c["aria-pressed"]=r,c["aria-expanded"]=o),Wt("button",{role:null!=a?a:"button",...c,"data-base-component":"ButtonBase","data-component":"ButtonBase",type:"button",...l,className:be({"focus-visible-ring":!i,"transition-colors":!i,"whitespace-nowrap flex items-center":!i},n),title:s,ref:t,children:e},void 0,0,{fileName:"/home/runner/work/frontend-shared/frontend-shared/src/components/input/ButtonBase.tsx",lineNumber:79,columnNumber:5},this)};var Ce="/home/runner/work/frontend-shared/frontend-shared/src/components/input/Button.tsx";const Se=function({children:t,classes:e,elementRef:n,expanded:i,pressed:o,title:r,icon:s,size:a="md",variant:l="secondary",...c}){return Wt(xe,{
"data-component":"Button",...c,classes:be("focus-visible-ring transition-colors whitespace-nowrap flex items-center","font-semibold rounded-sm",{"text-grey-7 bg-grey-1 enabled:hover:text-grey-9 enabled:hover:bg-grey-2 aria-pressed:text-grey-9 aria-expanded:text-grey-9":"secondary"===l,"text-grey-1 bg-grey-7 enabled:hover:bg-grey-8 disabled:text-grey-4":"primary"===l},{"p-2 gap-x-2":"md"===a,"p-1 gap-x-1":"xs"===a,"p-1.5 gap-x-1.5":"sm"===a,"p-2.5 gap-x-1.5":"lg"===a},e),elementRef:n,expanded:i,pressed:o,title:r,unstyled:!0,children:[s&&Wt(s,{className:"w-em h-em"},void 0,0,{fileName:Ce,lineNumber:71,columnNumber:16},this),t]},void 0,0,{fileName:Ce,lineNumber:43,columnNumber:5},this)},Ee=be("input-group:border input-group:rounded-none","input-group:first:rounded-l-sm input-group:last:rounded-r-sm","input-group:border-l-0 input-group:first:border-l");var Ne="/home/runner/work/frontend-shared/frontend-shared/src/components/input/IconButton.tsx"
;const Ae=function({children:t,classes:e,elementRef:n,pressed:i,expanded:o,icon:r,disableTouchSizing:s=!1,size:a="md",title:l,variant:c="secondary",...h}){return Wt(xe,{"data-component":"IconButton",...h,classes:be("focus-visible-ring transition-colors whitespace-nowrap flex items-center","justify-center gap-x-2 rounded-sm",{"text-grey-7 bg-transparent enabled:hover:text-grey-9 aria-pressed:text-brand aria-expanded:text-brand":"secondary"===c,"text-brand bg-transparent enabled:hover:text-grey-9 disabled:text-grey-7":"primary"===c,"text-grey-7 bg-grey-2 enabled:hover:text-grey-9 enabled:hover:bg-grey-3 disabled:text-grey-5 aria-pressed:bg-grey-3 aria-expanded:bg-grey-3":"dark"===c,"p-2":"md"===a,"p-1":"xs"===a,"p-1.5":"sm"===a,"p-2.5":"lg"===a,"touch:min-w-touch-minimum touch:min-h-touch-minimum":!s},Ee,e),elementRef:n,title:l,pressed:i,expanded:o,unstyled:!0,children:[r&&Wt(r,{className:"w-em h-em"},void 0,0,{fileName:Ne,lineNumber:85,columnNumber:16},this),t]},void 0,0,{fileName:Ne,lineNumber:50,
columnNumber:5},this)};const Re=function({children:t,classes:e,elementRef:n,unstyled:i=!1,...o}){return Wt("a",{"data-base-component":"LinkBase","data-component":"LinkBase",...o,className:be({"focus-visible-ring":!i},e),rel:"noopener noreferrer",ref:n,children:t},void 0,0,{fileName:"/home/runner/work/frontend-shared/frontend-shared/src/components/navigation/LinkBase.tsx",lineNumber:21,columnNumber:5},this)};const ke=function({children:t,classes:e,elementRef:n,underline:i="none",color:o="brand",...r}){return Wt(Re,{"data-component":"Link",...r,classes:be("rounded-sm",{"text-brand hover:text-brand-dark":"brand"===o,"text-color-text-light hover:text-brand":"text-light"===o,"text-color-text hover:text-brand-dark":"text"===o},{"no-underline hover:no-underline":"none"===i,"underline hover:underline":"always"===i,"no-underline hover:underline":"hover"===i},e),elementRef:n,children:t},void 0,0,{fileName:"/home/runner/work/frontend-shared/frontend-shared/src/components/navigation/Link.tsx",lineNumber:31,columnNumber:5
},this)};const Te=function({children:t,classes:e,elementRef:n,expanded:i,pressed:o,title:r,direction:s,...a}){return Wt(xe,{"data-component":"PointerButton",...a,elementRef:n,classes:be("relative w-[26px] h-[16px]","flex items-center justify-center","bg-white rounded-[4px] border","before:absolute before:border-transparent","after:absolute after:border-transparent","text-[10px] text-color-text-light leading-none font-semibold",{"shadow-[1px_1px_1px_rgba(0,0,0,0.1)]":"down"!==s,"shadow-[1px_0px_1px_rgba(0,0,0,0.1)]":"down"===s},{"rounded-r-[4px] rounded-l-[2px]":"left"===s,"before:right-full before:top-1/2 after:right-full after:top-1/2":"left"===s,"before:mt-[-8px] before:border-8 before:border-r-[5px] before:border-r-grey-3":"left"===s,"after:mt-[-7px] after:border-[7px] after:border-r-[4px] after:border-r-white":"left"===s},{"z-1 rounded-t-px-sm rounded-b-px":"up"===s,"before:top-auto before:left-1/2 before:bottom-full after:top-auto after:left-1/2 after:bottom-full":"up"===s,
"before:ml-[-13px] before:border-[13px] before:border-b-[6px] before:border-b-grey-3":"up"===s,"after:ml-[-12px] after:border-[12px] after:border-b-[5px] after:border-b-white":"up"===s},{"z-1 rounded-t-px rounded-b-px-sm":"down"===s,"before:top-full before:left-1/2 after:top-full after:left-1/2":"down"===s,"before:ml-[-13px] before:border-[13px] before:border-t-[6px] before:border-t-grey-3":"down"===s,"after:ml-[-12px] after:border-[12px] after:border-t-[5px] after:border-t-white":"down"===s},e),expanded:i,pressed:o,title:r,children:t},void 0,0,{fileName:"/home/runner/work/frontend-shared/frontend-shared/src/components/navigation/PointerButton.tsx",lineNumber:52,columnNumber:5},this)};function Pe({badgeCount:t}){return Wt("span",{className:be("rounded px-1 py-0.5","bg-current"),children:Wt("span",{className:"font-bold text-color-text-inverted",children:t})})}function Oe({arrowDirection:t}){return Wt("div",{className:be("absolute left-1/2 -translate-x-1/2 z-2","fill-white text-grey-3",{
"top-0 -translate-y-full":"up"===t}),children:Wt("up"===t?fe:ue,{})})}function Le({badgeCount:t,icon:e,label:n,onClick:i,shortcut:o}){Vt(o,i);const r=o?`${n} (${o})`:n;return Wt(xe,{classes:be("flex-col gap-y-1 py-2.5 px-2","text-annotator-sm leading-none","text-grey-7","group-hover:text-grey-5","hover:group-hover:text-grey-9"),onClick:i,title:r,children:[e&&Wt(e,{className:"text-annotator-lg",title:r}),"number"==typeof t&&Wt(Pe,{badgeCount:t}),Wt("span",{children:n})]})}function Me({annotationCount:t,isVisible:e}){return Wt("div",{className:"sr-only",children:[Wt("span",{"aria-live":"polite","aria-atomic":"true",role:"status","data-testid":"annotation-count-announce",children:t>0&&Wt("span",{children:[t," ",1===t?"annotation":"annotations"," for this selection."]})}),Wt("ul",{"aria-live":"polite","data-testid":"annotate-shortcuts-announce",children:e&&Wt($,{children:[t>0&&Wt("li",{children:["Press ","'S'"," to show annotations."]}),Wt("li",{children:["Press ","'A'"," to annotate."]}),Wt("li",{
children:["Press ","'H'"," to highlight."]})]})})]})}function Ie({arrowDirection:t,isVisible:e,onCommand:n,annotationCount:i=0}){const o=e?"a":null,r=e?"h":null,s=e?"s":null;return Vt(e?"Escape":null,(()=>n("hide"))),Wt("div",{className:be("all-initial","border border-solid border-grey-3","absolute select-none bg-white rounded shadow-adder-toolbar","opacity-5",{"animate-adder-pop-up":"up"===t&&e,"animate-adder-pop-down":"down"===t&&e}),"data-component":"AdderToolbar",dir:"ltr",style:{visibility:e?"visible":"hidden"},children:[Wt("div",{className:be("flex group"),children:[Wt(Le,{icon:$t,onClick:()=>n("annotate"),label:"Annotate",shortcut:o}),Wt(Le,{icon:ae,onClick:()=>n("highlight"),label:"Highlight",shortcut:r}),i>0&&Wt($,{children:[Wt("div",{className:be("m-1.5 border-r border-grey-4 border-solid")}),Wt(Le,{badgeCount:i,onClick:()=>n("show"),label:"Show",shortcut:s})]})]}),Wt(Oe,{arrowDirection:t}),Wt(Me,{annotationCount:i,isVisible:e})]})}function Fe(t){const e=t.attachShadow({mode:"open"});!function(t){
var e;const n=null===(e=document.querySelector('link[rel="preload"][href*="/build/styles/annotator.css"]'))||void 0===e?void 0:e.href;if(!n)return;const i=document.createElement("link");i.rel="stylesheet",i.href=n,t.appendChild(i)}(e);const n=window.applyFocusVisiblePolyfill;var i;return n&&n(e),(i=e).addEventListener("mouseup",(t=>t.stopPropagation())),i.addEventListener("mousedown",(t=>t.stopPropagation())),i.addEventListener("touchstart",(t=>t.stopPropagation()),{passive:!0}),e}let De=function(t){return t[t.DOWN=1]="DOWN",t[t.UP=2]="UP",t}({});function Be(t){return t.toString()+"px"}class He{constructor(t,n){e(this,"_outerContainer",void 0),e(this,"_shadowRoot",void 0),e(this,"_view",void 0),e(this,"_isVisible",void 0),e(this,"_arrowDirection",void 0),e(this,"_onAnnotate",void 0),e(this,"_onHighlight",void 0),e(this,"_onShowAnnotations",void 0),e(this,"_annotationsForSelection",void 0),this._outerContainer=document.createElement("hypothesis-adder"),t.appendChild(this._outerContainer),
this._shadowRoot=Fe(this._outerContainer),Object.assign(this._outerContainer.style,{position:"absolute",top:0,left:0}),this._view=t.ownerDocument.defaultView,this._isVisible=!1,this._arrowDirection="up",this._annotationsForSelection=[],this._onAnnotate=n.onAnnotate,this._onHighlight=n.onHighlight,this._onShowAnnotations=n.onShowAnnotations,this._render()}get annotationsForSelection(){return this._annotationsForSelection}set annotationsForSelection(t){this._annotationsForSelection=t,this._render()}hide(){this._isVisible=!1,this._render(),Object.assign(this._outerContainer.style,{top:0,left:0})}destroy(){ut(null,this._shadowRoot),this._outerContainer.remove()}show(t,e){const{left:n,top:i,arrowDirection:o}=this._calculateTarget(t,e);this._showAt(n,i),this._isVisible=!0,this._arrowDirection=o===De.UP?"up":"down",this._render()}_width(){return this._shadowRoot.firstChild.getBoundingClientRect().width}_height(){return this._shadowRoot.firstChild.getBoundingClientRect().height}_calculateTarget(t,e){let n,i,o
;n=e&&!Ut()?De.DOWN:De.UP;const r=Math.min(20,t.width),s=this._width(),a=Ut()?10:0,l=this._height();return o=e?t.left-s/2+r:t.left+t.width-s/2-r,t.top-l<0&&n===De.DOWN?n=De.UP:t.top+l>this._view.innerHeight&&(n=De.DOWN),i=n===De.UP?t.top+t.height+10+a:t.top-l-10,o=Math.max(o,0),o=Math.min(o,this._view.innerWidth-s),i=Math.max(i,0),i=Math.min(i,this._view.innerHeight-l),{top:i,left:o,arrowDirection:n}}_findZindex(t,e){if(void 0===document.elementsFromPoint)return 32768;const n=this._width(),i=this._height(),o=[...new Set([...document.elementsFromPoint(t,e),...document.elementsFromPoint(t,e+i),...document.elementsFromPoint(t+n/2,e+i/2),...document.elementsFromPoint(t+n,e),...document.elementsFromPoint(t+n,e+i)])].map((t=>+getComputedStyle(t).zIndex)).filter(Number.isInteger);return o.push(0),Math.max(...o)+1}_showAt(t,e){const n=function(t){let e=t.parentElement;for(;e.parentElement&&"static"===getComputedStyle(e).position;)e=e.parentElement;return e
}(this._outerContainer).getBoundingClientRect(),i=this._findZindex(t,e);Object.assign(this._outerContainer.style,{left:Be(t-n.left),top:Be(e-n.top),zIndex:i})}_render(){ut(Wt(Ie,{isVisible:this._isVisible,arrowDirection:this._arrowDirection,onCommand:t=>{switch(t){case"annotate":this._onAnnotate(),this.hide();break;case"highlight":this._onHighlight(),this.hide();break;case"show":this._onShowAnnotations(this.annotationsForSelection);break;case"hide":this.hide()}},annotationCount:this.annotationsForSelection.length}),this._shadowRoot)}}var Ve=function(t){return t[t.Forwards=1]="Forwards",t[t.Backwards=2]="Backwards",t}(Ve||{});function Ue(t,e,n){const i=n===Ve.Forwards?e:e-1;if(""!==t.charAt(i).trim())return e;let o,r;if(n===Ve.Backwards?(o=t.substring(0,e),r=o.trimEnd()):(o=t.substring(e),r=o.trimStart()),!r.length)return-1;const s=o.length-r.length;return n===Ve.Backwards?e-s:e+s}function qe(t,e){
const n=t.commonAncestorContainer.ownerDocument.createNodeIterator(t.commonAncestorContainer,NodeFilter.SHOW_TEXT),i=e===Ve.Forwards?t.startContainer:t.endContainer,o=e===Ve.Forwards?t.endContainer:t.startContainer;let r=n.nextNode();for(;r&&r!==i;)r=n.nextNode();e===Ve.Backwards&&(r=n.previousNode());let s=-1;const a=()=>{if(r=e===Ve.Forwards?n.nextNode():n.previousNode(),r){const t=r.textContent,n=e===Ve.Forwards?0:t.length;s=Ue(t,n,e)}};for(;r&&-1===s&&r!==o;)a();if(r&&s>=0)return{node:r,offset:s};throw new RangeError("No text nodes with non-whitespace text found in range")}function We(t){var e,n;switch(t.nodeType){case Node.ELEMENT_NODE:case Node.TEXT_NODE:return null!==(e=null===(n=t.textContent)||void 0===n?void 0:n.length)&&void 0!==e?e:0;default:return 0}}function ze(t){let e=t.previousSibling,n=0;for(;e;)n+=We(e),e=e.previousSibling;return n}function $e(t,...e){let n=e.shift();const i=t.ownerDocument.createNodeIterator(t,NodeFilter.SHOW_TEXT),o=[];let r,s=i.nextNode(),a=0;for(;void 0!==n&&s;)r=s,
a+r.data.length>n?(o.push({node:r,offset:n-a}),n=e.shift()):(s=i.nextNode(),a+=r.data.length);for(;void 0!==n&&r&&a===n;)o.push({node:r,offset:r.data.length}),n=e.shift();if(void 0!==n)throw new RangeError("Offset exceeds text length");return o}let je=function(t){return t[t.FORWARDS=1]="FORWARDS",t[t.BACKWARDS=2]="BACKWARDS",t}({});class Xe{constructor(t,n){if(e(this,"element",void 0),e(this,"offset",void 0),n<0)throw new Error("Offset is invalid");this.element=t,this.offset=n}relativeTo(t){if(!t.contains(this.element))throw new Error("Parent is not an ancestor of current element");let e=this.element,n=this.offset;for(;e!==t;)n+=ze(e),e=e.parentElement;return new Xe(e,n)}resolve(t={}){try{return $e(this.element,this.offset)[0]}catch(e){if(0===this.offset&&void 0!==t.direction){const n=document.createTreeWalker(this.element.getRootNode(),NodeFilter.SHOW_TEXT);n.currentNode=this.element;const i=t.direction===je.FORWARDS,o=i?n.nextNode():n.previousNode();if(!o)throw e;return{node:o,offset:i?0:o.data.length}}
throw e}}static fromCharOffset(t,e){switch(t.nodeType){case Node.TEXT_NODE:return Xe.fromPoint(t,e);case Node.ELEMENT_NODE:return new Xe(t,e);default:throw new Error("Node is not an element or text node")}}static fromPoint(t,e){switch(t.nodeType){case Node.TEXT_NODE:{if(e<0||e>t.data.length)throw new Error("Text node offset is out of range");if(!t.parentElement)throw new Error("Text node has no parent");const n=ze(t)+e;return new Xe(t.parentElement,n)}case Node.ELEMENT_NODE:{if(e<0||e>t.childNodes.length)throw new Error("Child node offset is out of range");let n=0;for(let i=0;i<e;i++)n+=We(t.childNodes[i]);return new Xe(t,n)}default:throw new Error("Point is not in an element or text node")}}}class Ye{constructor(t,n){e(this,"start",void 0),e(this,"end",void 0),this.start=t,this.end=n}relativeTo(t){return new Ye(this.start.relativeTo(t),this.end.relativeTo(t))}toRange(){let t,e
;this.start.element===this.end.element&&this.start.offset<=this.end.offset?[t,e]=$e(this.start.element,this.start.offset,this.end.offset):(t=this.start.resolve({direction:je.FORWARDS}),e=this.end.resolve({direction:je.BACKWARDS}));const n=new Range;return n.setStart(t.node,t.offset),n.setEnd(e.node,e.offset),n}static fromRange(t){const e=Xe.fromPoint(t.startContainer,t.startOffset),n=Xe.fromPoint(t.endContainer,t.endOffset);return new Ye(e,n)}static fromOffsets(t,e,n){return new Ye(new Xe(t,e),new Xe(t,n))}static trimmedRange(t){return function(t){if(!t.toString().trim().length)throw new RangeError("Range contains no non-whitespace text");if(t.startContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range startContainer is not a text node");if(t.endContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range endContainer is not a text node");const e=t.cloneRange();let n=!1,i=!1;const o={start:Ue(t.startContainer.textContent,t.startOffset,Ve.Forwards),
end:Ue(t.endContainer.textContent,t.endOffset,Ve.Backwards)};if(o.start>=0&&(e.setStart(t.startContainer,o.start),n=!0),o.end>0&&(e.setEnd(t.endContainer,o.end),i=!0),n&&i)return e;if(!n){const{node:t,offset:n}=qe(e,Ve.Forwards);t&&n>=0&&e.setStart(t,n)}if(!i){const{node:t,offset:n}=qe(e,Ve.Backwards);t&&n>0&&e.setEnd(t,n)}return e}(Ye.fromRange(t).toRange())}}const Ze=".annotator-placeholder";function Ge(t){return!!t.parentElement&&null!==t.parentElement.closest(Ze)}function Ke(t){return t.nodeType===Node.ELEMENT_NODE}function Qe(t){return t.nodeType===Node.TEXT_NODE}function Je(t){if(t.focusNode===t.anchorNode)return t.focusOffset<t.anchorOffset;return t.getRangeAt(0).startContainer===t.focusNode}function tn(t,e){try{var n,i;const o=null!==(n=null===(i=e.nodeValue)||void 0===i?void 0:i.length)&&void 0!==n?n:e.childNodes.length;return t.comparePoint(e,0)<=0&&t.comparePoint(e,o)>=0}catch(t){return!1}}function en(t,e){const n=t.commonAncestorContainer,i=n.ownerDocument.createNodeIterator(n,NodeFilter.SHOW_ALL)
;let o;for(;o=i.nextNode();)tn(t,o)&&e(o)}function nn(t){if(t.isCollapsed)return null;const e=function(t){const e=[];return en(t,(t=>{Qe(t)&&!t.textContent.match(/^\s*$/)&&e.push(t)})),e.flatMap((e=>{const n=e.ownerDocument.createRange();if(n.selectNodeContents(e),e===t.startContainer&&n.setStart(e,t.startOffset),e===t.endContainer&&n.setEnd(e,t.endOffset),n.collapsed)return[];const i=Array.from(n.getClientRects());return n.detach(),i}))}(t.getRangeAt(0));return 0===e.length?null:Je(t)?e[0]:e[e.length-1]}const on="http://www.w3.org/2000/svg",rn=["user-annotations","user-highlights","other-content"];function sn(t,e){const n=function(t){if(t.collapsed)return[];let e=t.commonAncestorContainer;if(e&&e.nodeType!==Node.ELEMENT_NODE&&(e=e.parentElement),!e)return[];const n=[],i=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT);let o;for(;o=i.nextNode();){if(!tn(t,o))continue;const e=o
;e===t.startContainer&&t.startOffset>0?e.splitText(t.startOffset):(e===t.endContainer&&t.endOffset<e.data.length&&e.splitText(t.endOffset),n.push(e))}return n}(t),i=n.length>0&&Ge(n[0]);let o=[],r=null,s=null;n.forEach((t=>{r&&r.nextSibling===t?s.push(t):(s=[t],o.push(s)),r=t}));const a=/^\s*$/;o=o.filter((t=>t.some((t=>!a.test(t.data)))));const l=[];return o.forEach((t=>{const n=document.createElement("hypothesis-highlight");n.className=be("hypothesis-highlight",e);t[0].parentNode.replaceChild(n,t[0]),t.forEach((t=>n.appendChild(t))),l.push(n)})),i||function(t,e){if(0===t.length)return;const n=function(t){const e=t.closest(".page");return e&&e.querySelector(".canvasWrapper > canvas")||null}(t[0]);if(!n||!n.parentElement)return;let i=n.parentElement.querySelector(".hypothesis-highlight-layer");if(!i){i=document.createElementNS(on,"svg"),i.setAttribute("class","hypothesis-highlight-layer"),n.parentElement.appendChild(i),n.parentElement.style.position="relative";const t=i.style;t.position="absolute",t.left="0",
t.top="0",t.width="100%",t.height="100%",t.mixBlendMode="multiply"}const o=n.getBoundingClientRect(),r=t.map((t=>{const n=t.getBoundingClientRect(),i=document.createElementNS(on,"rect");return i.setAttribute("x",(n.left-o.left).toString()),i.setAttribute("y",(n.top-o.top).toString()),i.setAttribute("width",n.width.toString()),i.setAttribute("height",n.height.toString()),i.setAttribute("class",be("hypothesis-svg-highlight",e)),t.classList.add("is-transparent"),t.svgHighlight=i,i}));i.append(...r)}(l,e),l}function an(t,e){const n=t.parentNode;e.forEach((e=>n.insertBefore(e,t))),t.remove()}function ln(t){cn(t,!1);for(const e of t){if(e.parentNode){an(e,Array.from(e.childNodes))}e.svgHighlight&&e.svgHighlight.remove()}}function cn(t,e){t.forEach((t=>{t.svgHighlight?function(t,e){const n=t.parentNode,i=t.getAttribute("data-focused-id");if(Boolean(i)!==e)if(e){t.setAttribute("data-focused-id",o(8));const e=t.cloneNode();e.setAttribute("data-is-focused","data-is-focused"),n.append(e)}else{
const e=n.querySelector(`[data-focused-id="${i}"][data-is-focused]`);null==e||e.remove(),t.removeAttribute("data-focused-id")}}(t.svgHighlight,e):t.classList.toggle("hypothesis-highlight-focused",e)}))}function hn(t){const e=t.map((t=>t.getBoundingClientRect()));return e.reduce(((t,e)=>({top:Math.min(t.top,e.top),left:Math.min(t.left,e.left),bottom:Math.max(t.bottom,e.bottom),right:Math.max(t.right,e.right)})))}function un(t){pn(fn(t)),function(t){for(const[e,n]of function(t){const e=new Map;for(const n of(null!=t?t:document).getElementsByClassName("hypothesis-highlight-layer"))e.set(n,Array.from(n.querySelectorAll(".hypothesis-svg-highlight")));return e}(t)){n.every(((t,e,n)=>0===e||mn(t)>=mn(n[e-1])))||(n.sort(((t,e)=>mn(t)-mn(e))),e.replaceChildren(...n))}}(t)}const dn=t=>"hypothesis-highlight"===t.tagName.toLowerCase();function fn(t){let e;return e=dn(t)?Array.from(t.children).filter(dn):Array.from(t.getElementsByTagName("hypothesis-highlight")).filter((t=>!t.parentElement||!dn(t.parentElement))),e}
function pn(t,e="",n=0,i=0){for(const r of t){var o;const t=null!==(o=rn.find((t=>r.classList.contains(t))))&&void 0!==o?o:"other-content",s=e&&t===e?i+1:0;r.setAttribute("data-nesting-level",`${n}`),r.setAttribute("data-cluster-level",`${s}`),r.svgHighlight&&(r.svgHighlight.setAttribute("data-nesting-level",`${n}`),r.svgHighlight.setAttribute("data-cluster-level",`${s}`)),pn(fn(r),t,n+1,s)}}function mn(t){var e;return t.getAttribute("data-is-focused")?Number.MAX_SAFE_INTEGER:parseInt(null!==(e=t.getAttribute("data-nesting-level"))&&void 0!==e?e:"0",10)}class gn{constructor({contentContainer:t,hostRPC:i}){e(this,"_hostRPC",void 0),e(this,"_updatePending",void 0),e(this,"_anchors",void 0),e(this,"_listeners",void 0),this._hostRPC=i,this._updatePending=!1,this._anchors=[],this._listeners=new n,this._listeners.add(window,"resize",(()=>this.update())),this._listeners.add(window,"scroll",(()=>this.update())),this._listeners.add(t,"scroll",(()=>this.update()))}destroy(){this._listeners.removeAll()}update(t){
t&&(this._anchors=t),this._updatePending||(this._updatePending=!0,requestAnimationFrame((()=>{const t=function(t){const e=[];return t.forEach((({annotation:t,highlights:n})=>{if(null==n||!n.length)return;const{top:i,bottom:o}=hn(n);i>=o||e.push({tag:t.$tag,top:i,bottom:o})})),e.sort(((t,e)=>t.top-e.top)),e}(this._anchors);this._hostRPC.call("anchorsChanged",t),this._updatePending=!1})))}}let _n=new Set;function vn(...t){const e=t.join();_n.has(e)||(console.warn(...t),_n.add(e))}vn.reset=()=>{_n.clear()};const bn=["html_side_by_side","styled_highlight_clusters"];class yn extends u{constructor(t=bn){super(),e(this,"_flags",void 0),e(this,"_knownFlags",void 0),this._flags=new Map,this._knownFlags=t}update(t){this._flags.clear();for(const[e,n]of Object.entries(t))this._flags.set(e,n);this.emit("flagsChanged")}flagEnabled(t){var e;return this._knownFlags.includes(t)?null!==(e=this._flags.get(t))&&void 0!==e&&e:(vn("Looked up unknown feature",t),!1)}allFlags(){return Object.fromEntries(this._flags)}}
function wn({cluster:t,label:e,onChange:n,currentStyles:i,highlightStyles:o}){const r=i[t],s="transparent"===r;return Wt("div",{className:"space-y-2",children:[Wt("div",{className:"flex items-center gap-x-2 text-annotator-base",children:Wt("div",{className:"grow text-color-text px-2 py-1 rounded",style:{backgroundColor:o[r].color},children:e})}),Wt("div",{className:"flex items-center gap-x-2",children:Object.keys(o).map((e=>Wt("div",{className:"relative",children:[Wt("input",{className:be("absolute w-6 h-6","opacity-[.00001]","cursor-pointer"),name:t,id:`hypothesis-${t}-${e}`,checked:r===e,onChange:n,type:"radio",value:e}),Wt("label",{className:"block",htmlFor:`${t}-${e}`,children:[Wt("div",{style:{backgroundColor:o[e].color},className:be("block w-6 h-6 rounded-full flex items-center justify-center",{"border-2 border-slate-0":r!==e,"border-2 border-slate-3":r===e}),children:"transparent"===e&&Wt(re,{className:be("w-3 h-3",{"text-slate-3":!s,"text-slate-7":s})})}),Wt("span",{className:"sr-only",children:e})]
})]},`${t}-${e}`)))})]})}function xn({active:t,availableStyles:e,currentStyles:n,onStyleChange:i}){const o=Tt((t=>{const e=t.target,n=e.name,o=e.value;i(n,o)}),[i]),[r,s]=Nt(!1);return t?Wt(ye,{children:Wt("div",{className:"flex flex-col text-annotator-base text-color-text",children:[Wt(Se,{"data-testid":"control-toggle-button",onClick:()=>s(!r),title:r?"Hide highlight settings":"Show highlight settings",children:Wt($,r?{children:[Wt(Zt,{}),Wt("span",{children:"Highlight Appearance"})]}:{children:[Wt(Jt,{}),Wt(ae,{})]})}),r&&Wt(we,{"data-testid":"cluster-style-controls",size:"sm",children:[Wt(wn,{highlightStyles:e,label:"My annotations",cluster:"user-annotations",onChange:o,currentStyles:n}),Wt(wn,{highlightStyles:e,label:"My highlights",cluster:"user-highlights",onChange:o,currentStyles:n}),Wt(wn,{highlightStyles:e,label:"Everybody's content",cluster:"other-content",onChange:o,currentStyles:n})]})]})}):null}const Cn={transparent:{color:"transparent",secondColor:"transparent",thirdColor:"transparent"},pink:{
color:"var(--hypothesis-color-pink)",secondColor:"var(--hypothesis-color-pink-1)",thirdColor:"var(--hypothesis-color-pink-2)"},orange:{color:"var(--hypothesis-color-orange)",secondColor:"var(--hypothesis-color-orange-1)",thirdColor:"var(--hypothesis-color-orange-2)"},yellow:{color:"var(--hypothesis-color-yellow)",secondColor:"var(--hypothesis-color-yellow-1)",thirdColor:"var(--hypothesis-color-yellow-2)"},green:{color:"var(--hypothesis-color-green)",secondColor:"var(--hypothesis-color-green-1)",thirdColor:"var(--hypothesis-color-green-2)"},purple:{color:"var(--hypothesis-color-purple)",secondColor:"var(--hypothesis-color-purple-1)",thirdColor:"var(--hypothesis-color-purple-2)"},grey:{color:"var(--hypothesis-color-grey)",secondColor:"var(--hypothesis-color-grey-1)",thirdColor:"var(--hypothesis-color-grey-2)"}},Sn={"other-content":"yellow","user-annotations":"orange","user-highlights":"purple"};class En{constructor(t,n){e(this,"appliedStyles",void 0),e(this,"_element",void 0),e(this,"_features",void 0),
e(this,"_outerContainer",void 0),e(this,"_shadowRoot",void 0),e(this,"_updateTimeout",void 0),this._element=t,this._features=n.features,this._outerContainer=document.createElement("hypothesis-highlight-cluster-toolbar"),this._element.appendChild(this._outerContainer),this._shadowRoot=Fe(this._outerContainer),Object.assign(this._outerContainer.style,{position:"fixed",top:`${this._element.offsetTop+4}px`,left:"4px"}),this.appliedStyles=Sn,this._init(),this._features.on("flagsChanged",(()=>{this._activate(this._isActive())})),this._render()}destroy(){clearTimeout(this._updateTimeout),ut(null,this._shadowRoot),this._activate(!1),this._outerContainer.remove()}scheduleClusterUpdates(){clearTimeout(this._updateTimeout),this._updateTimeout=setTimeout((()=>this._updateClusters()),100)}_init(){for(const t of Object.keys(this.appliedStyles))this._setClusterStyles(t,this.appliedStyles[t]);this._activate(this._isActive())}_updateClusters(){this._isActive()&&un(this._element)}_isActive(){
return this._features.flagEnabled("styled_highlight_clusters")}_activate(t){this._element.classList.toggle("hypothesis-highlights-clustered",t),this._render()}_setClusterStyle(t,e){document.documentElement.style.setProperty(t,e)}_setClusterStyles(t,e){const n=Cn[e];for(const e of Object.keys(n))this._setClusterStyle(`--hypothesis-${t}-${e}`,n[e])}_onChangeClusterStyle(t,e){this.appliedStyles[t]=e,this._setClusterStyles(t,e),this._render()}_render(){ut(Wt(xn,{active:this._isActive(),availableStyles:Cn,currentStyles:this.appliedStyles,onStyleChange:(t,e)=>this._onChangeClusterStyle(t,e)}),this._shadowRoot)}}function Nn(t){return t.split("").reverse().join("")}function An(t){return(t|-t)>>31&1}function Rn(t,e,n,i){let o=t.P[n],r=t.M[n];const s=i>>>31,a=e[n]|s,l=a|r,c=(a&o)+o^o|a;let h=r|~(c|o),u=o&c;const d=An(h&t.lastRowMask[n])-An(u&t.lastRowMask[n]);return h<<=1,u<<=1,u|=s,h|=An(i)-s,o=u|~(l|h),r=h&l,t.P[n]=o,t.M[n]=r,d}function kn(t,e,n){if(0===e.length)return[];n=Math.min(n,e.length)
;const i=[],o=32,r=Math.ceil(e.length/o)-1,s={P:new Uint32Array(r+1),M:new Uint32Array(r+1),lastRowMask:new Uint32Array(r+1)};s.lastRowMask.fill(1<<31),s.lastRowMask[r]=1<<(e.length-1)%o;const a=new Uint32Array(r+1),l=new Map,c=[];for(let t=0;t<256;t++)c.push(a);for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(l.has(n))continue;const i=new Uint32Array(r+1);l.set(n,i),n<c.length&&(c[n]=i);for(let t=0;t<=r;t+=1){i[t]=0;for(let r=0;r<o;r+=1){const s=t*o+r;if(s>=e.length)continue;e.charCodeAt(s)===n&&(i[t]|=1<<r)}}}let h=Math.max(0,Math.ceil(n/o)-1);const u=new Uint32Array(r+1);for(let t=0;t<=h;t+=1)u[t]=(t+1)*o;u[r]=e.length;for(let t=0;t<=h;t+=1)s.P[t]=-1,s.M[t]=0;for(let d=0;d<t.length;d+=1){const f=t.charCodeAt(d);let p;f<c.length?p=c[f]:(p=l.get(f),void 0===p&&(p=a));let m=0;for(let t=0;t<=h;t+=1)m=Rn(s,p,t,m),u[t]+=m;if(u[h]-m<=n&&h<r&&(1&p[h+1]||m<0)){let t;if(h+=1,s.P[h]=-1,s.M[h]=0,h===r){const n=e.length%o;t=0===n?o:n}else t=o;u[h]=u[h-1]+t-m+Rn(s,p,h,m)}else for(;h>0&&u[h]>=n+o;)h-=1
;h===r&&u[h]<=n&&(u[h]<n&&i.splice(0,i.length),i.push({start:-1,end:d+1,errors:u[h]}),n=u[h])}return i}function Tn(t,e,n){return function(t,e,n){const i=Nn(e);return n.map((n=>{const o=Math.max(0,n.end-e.length-n.errors);return{start:kn(Nn(t.slice(o,n.end)),i,n.errors).reduce(((t,e)=>n.end-e.end<t?n.end-e.end:t),n.end),end:n.end,errors:n.errors}}))}(t,e,kn(t,e,n))}function Pn(t,e,n){let i=0;const o=[];for(;-1!==i;)i=t.indexOf(e,i),-1!==i&&(o.push({start:i,end:i+e.length,errors:0}),i+=1);return o.length>0?o:Tn(t,e,n)}function On(t,e){if(0===e.length||0===t.length)return 0;return 1-Pn(t,e,e.length)[0].errors/e.length}function Ln(t,e,n={}){if(0===e.length)return null;const i=Math.min(256,e.length/2),o=Pn(t,e,i);if(0===o.length)return null;const r=i=>{const o=1-i.errors/e.length,r=n.prefix?On(t.slice(Math.max(0,i.start-n.prefix.length),i.start),n.prefix):1,s=n.suffix?On(t.slice(i.end,i.end+n.suffix.length),n.suffix):1;let a=1;if("number"==typeof n.hint){a=1-Math.abs(i.start-n.hint)/t.length}
return(50*o+20*r+20*s+2*a)/92},s=o.map((t=>({start:t.start,end:t.end,score:r(t)})));return s.sort(((t,e)=>e.score-t.score)),s[0]}function Mn(t){const e=function(t){const e=t.nodeName.toLowerCase();let n=e;return"#text"===e&&(n="text()"),n}(t),n=function(t){let e=0,n=t;for(;n;)n.nodeName===t.nodeName&&(e+=1),n=n.previousSibling;return e}(t);return`${e}[${n}]`}function In(t,e){let n="",i=t;for(;i!==e;){if(!i)throw new Error("Node is not a descendant of root");n=Mn(i)+"/"+n,i=i.parentNode}return n="/"+n,n=n.replace(/\/$/,""),n}function Fn(t,e,n){e=e.toUpperCase();let i=-1;for(let o=0;o<t.children.length;o++){const r=t.children[o];if(r.nodeName.toUpperCase()===e&&(++i,i===n))return r}return null}function Dn(t,e=document.body){try{return function(t,e){if(null===t.match(/^(\/[A-Za-z0-9-]+(\[[0-9]+\])?)+$/))throw new Error("Expression is not a simple XPath");const n=t.split("/");let i=e;n.shift();for(let t of n){let e,n;const o=t.indexOf("[");if(-1!==o){e=t.slice(0,o);const i=t.slice(o+1,t.indexOf("]"))
;if(n=parseInt(i)-1,n<0)return null}else e=t,n=0;const r=Fn(i,e,n);if(!r)return null;i=r}return i}(t,e)}catch(n){return document.evaluate("."+t,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}}class Bn{constructor(t,e){this.root=t,this.range=e}static fromRange(t,e){return new Bn(t,e)}static fromSelector(t,e){const n=Dn(e.startContainer,t);if(!n)throw new Error("Failed to resolve startContainer XPath");const i=Dn(e.endContainer,t);if(!i)throw new Error("Failed to resolve endContainer XPath");const o=Xe.fromCharOffset(n,e.startOffset),r=Xe.fromCharOffset(i,e.endOffset),s=new Ye(o,r).toRange();return new Bn(t,s)}toRange(){return this.range}toSelector(){const t=Ye.fromRange(this.range).toRange(),e=Ye.fromRange(t),n=In(e.start.element,this.root),i=In(e.end.element,this.root);return{type:"RangeSelector",startContainer:n,startOffset:e.start.offset,endContainer:i,endOffset:e.end.offset}}}class Hn{constructor(t,e,n){this.root=t,this.start=e,this.end=n}static fromRange(t,e){
const n=Ye.fromRange(e).relativeTo(t);return new Hn(t,n.start.offset,n.end.offset)}static fromSelector(t,e){return new Hn(t,e.start,e.end)}toSelector(){return{type:"TextPositionSelector",start:this.start,end:this.end}}toRange(){return Ye.fromOffsets(this.root,this.start,this.end).toRange()}}class Vn{constructor(t,e,n={}){this.root=t,this.exact=e,this.context=n}static fromRange(t,e){const n=t.textContent,i=Ye.fromRange(e).relativeTo(t),o=i.start.offset,r=i.end.offset;return new Vn(t,n.slice(o,r),{prefix:n.slice(Math.max(0,o-32),o),suffix:n.slice(r,Math.min(n.length,r+32))})}static fromSelector(t,e){const{prefix:n,suffix:i}=e;return new Vn(t,e.exact,{prefix:n,suffix:i})}toSelector(){return{type:"TextQuoteSelector",exact:this.exact,prefix:this.context.prefix,suffix:this.context.suffix}}toRange(t={}){return this.toPositionAnchor(t).toRange()}toPositionAnchor(t={}){const e=Ln(this.root.textContent,this.exact,{...this.context,hint:t.hint});if(!e)throw new Error("Quote not found")
;return new Hn(this.root,e.start,e.end)}}async function Un(t,e){return t.toRange(e)}function qn(t,e,n){const i=t[e];if("function"!=typeof i)throw new Error("Can only intercept functions");return t[e]=(...e)=>{const o=i.call(t,...e);return n(...e),o},()=>{t[e]=i}}function Wn(t){return t.replace(/#.*/,"")}class zn{constructor(t,e=(()=>location.href)){this._listeners=new n;let i=e();const o=(n=e())=>{Wn(i)!==Wn(n)&&(i=n,t(n))},r=function(){const t=window.navigation;return"function"==typeof Navigation&&t instanceof Navigation?t:null}();if(r)this._listeners.add(r,"navigatesuccess",(()=>o()));else{const t=[qn(window.history,"pushState",(()=>o())),qn(window.history,"replaceState",(()=>o()))];this._unpatchHistory=()=>t.forEach((t=>t())),this._listeners.add(window,"popstate",(()=>o()))}}disconnect(){var t;null===(t=this._unpatchHistory)||void 0===t||t.call(this),this._listeners.removeAll()}}var $n="complete",jn="canceled";function Xn(t,e,n){t.self===t?t.scrollTo(e,n):(t.scrollLeft=e,t.scrollTop=n)}function Yn(t){
var e=t._scrollSettings;if(e){var n=e.maxSynchronousAlignments,i=function(t,e){var n,i,o,r,s,a,l,c=t.align,h=t.target.getBoundingClientRect(),u=c&&null!=c.left?c.left:.5,d=c&&null!=c.top?c.top:.5,f=c&&null!=c.leftOffset?c.leftOffset:0,p=c&&null!=c.topOffset?c.topOffset:0,m=u,g=d;if(t.isWindow(e))a=Math.min(h.width,e.innerWidth),l=Math.min(h.height,e.innerHeight),i=h.left+e.pageXOffset-e.innerWidth*m+a*m,o=h.top+e.pageYOffset-e.innerHeight*g+l*g,i-=f,o-=p,i=t.align.lockX?e.pageXOffset:i,o=t.align.lockY?e.pageYOffset:o,r=i-e.pageXOffset,s=o-e.pageYOffset;else{a=h.width,l=h.height,n=e.getBoundingClientRect();var _=h.left-(n.left-e.scrollLeft),v=h.top-(n.top-e.scrollTop);i=_+a*m-e.clientWidth*m,o=v+l*g-e.clientHeight*g,i-=f,o-=p,i=Math.max(Math.min(i,e.scrollWidth-e.clientWidth),0),o=Math.max(Math.min(o,e.scrollHeight-e.clientHeight),0),i=t.align.lockX?e.scrollLeft:i,o=t.align.lockY?e.scrollTop:o,r=i-e.scrollLeft,s=o-e.scrollTop}return{x:i,y:o,differenceX:r,differenceY:s}
}(e,t),o=Date.now()-e.startTime,r=Math.min(1/e.time*o,1);if(e.endIterations>=n)return Xn(t,i.x,i.y),t._scrollSettings=null,e.end($n);var s=1-e.ease(r);if(Xn(t,i.x-i.differenceX*s,i.y-i.differenceY*s),o>=e.time)return e.endIterations++,e.scrollAncestor&&Yn(e.scrollAncestor),void Yn(t);!function(t){if("requestAnimationFrame"in window)return window.requestAnimationFrame(t);setTimeout(t,16)}(Yn.bind(null,t))}}function Zn(t){return t.self===t}function Gn(t){return"pageXOffset"in t||(t.scrollHeight!==t.clientHeight||t.scrollWidth!==t.clientWidth)&&"hidden"!==getComputedStyle(t).overflow}function Kn(){return!0}function Qn(t){if(t.assignedSlot)return Qn(t.assignedSlot);if(t.parentElement)return"body"===t.parentElement.tagName.toLowerCase()?t.parentElement.ownerDocument.defaultView||t.parentElement.ownerDocument.ownerWindow:t.parentElement;if(t.getRootNode){var e=t.getRootNode();if(11===e.nodeType)return e.host}}var Jn=function(t,e,n){if(t){"function"==typeof e&&(n=e,e=null),e||(e={}),e.time=isNaN(e.time)?1e3:e.time,
e.ease=e.ease||function(t){return 1-Math.pow(1-t,t/2)},e.align=e.align||{};var i=Qn(t),o=1,r=e.validTarget||Kn,s=e.isScrollable;e.debug&&(console.log("About to scroll to",t),i||console.error("Target did not have a parent, is it mounted in the DOM?"));for(var a=[];i;)if(e.debug&&console.log("Scrolling parent node",i),r(i,o)&&(s?s(i,Gn):Gn(i))&&(o++,a.push(i)),!(i=Qn(i))){l($n);break}return a.reduce(((n,i,o)=>function(t,e,n,i,o){var r,s=!e._scrollSettings,a=e._scrollSettings,l=Date.now(),c={passive:!0};function h(t){e._scrollSettings=null,e.parentElement&&e.parentElement._scrollSettings&&e.parentElement._scrollSettings.end(t),n.debug&&console.log("Scrolling ended with type",t,"for",e),o(t),r&&(e.removeEventListener("touchstart",r,c),e.removeEventListener("wheel",r,c))}a&&a.end(jn);var u=n.maxSynchronousAlignments;return null==u&&(u=3),e._scrollSettings={startTime:l,endIterations:0,target:t,time:n.time,ease:n.ease,align:n.align,isWindow:n.isWindow||Zn,maxSynchronousAlignments:u,end:h,scrollAncestor:i},
"cancellable"in n&&!n.cancellable||(r=h.bind(null,jn),e.addEventListener("touchstart",r,c),e.addEventListener("wheel",r,c)),s&&Yn(e),r}(t,i,e,a[o+1],l)),null)}function l(t){--o||n&&n(t)}};function ti(t,e,n){return t+n*(e-t)}async function ei(t,e,{maxDuration:n=500}={}){const i=t.scrollTop,o=e,r=Date.now(),s=Math.min(Math.abs(o-i)/3,n);let a=0;for(;a<1;)await new Promise((t=>{requestAnimationFrame(t)})),a=Math.min(1,(Date.now()-r)/s),t.scrollTop=ti(i,o,a)}function ni(t,e=document.baseURI){return new URL(t,e).href.toString().replace(/#.*/,"")}class ii{constructor(t={}){e(this,"document",void 0),this.document=t.document||document}uri(){let t=decodeURIComponent(this._getDocumentHref());const e=this._getLinks();for(const n of e)"canonical"===n.rel&&(t=n.href);return t}getDocumentMetadata(){const t={title:document.title,link:[],dc:this._getMetaTags("name","dc."),eprints:this._getMetaTags("name","eprints."),facebook:this._getMetaTags("property","og:"),highwire:this._getMetaTags("name","citation_"),
prism:this._getMetaTags("name","prism."),twitter:this._getMetaTags("name","twitter:")},e=this._getFavicon();e&&(t.favicon=e),t.title=this._getTitle(t),t.link=this._getLinks(t);const n=t.link.find((t=>t.href.startsWith("urn:x-dc")));return n&&(t.documentFingerprint=n.href),t}_getMetaTags(t,e){const n={};for(const i of Array.from(this.document.querySelectorAll("meta"))){const o=i.getAttribute(t),{content:r}=i;if(o&&r){const t=o.match(RegExp(`^${e}(.+)$`,"i"));if(t){const e=t[1].toLowerCase();n[e]?n[e].push(r):n[e]=[r]}}}return n}_getTitle(t){return t.highwire.title?t.highwire.title[0]:t.eprints.title?t.eprints.title[0]:t.prism.title?t.prism.title[0]:t.facebook.title?t.facebook.title[0]:t.twitter.title?t.twitter.title[0]:t.dc.title?t.dc.title[0]:this.document.title}_getLinks(t={dc:{},highwire:{}}){const e=[{href:this._getDocumentHref()}],n=Array.from(this.document.querySelectorAll("link"));for(const t of n)if(["alternate","canonical","bookmark","shortlink"].includes(t.rel)){if("alternate"===t.rel){
if(t.type&&t.type.match(/^application\/(rss|atom)\+xml/))continue;if(t.hreflang)continue}try{const n=this._absoluteUrl(t.href);e.push({href:n,rel:t.rel,type:t.type})}catch(t){}}for(const n of Object.keys(t.highwire)){const i=t.highwire[n];if("pdf_url"===n)for(const t of i)try{e.push({href:this._absoluteUrl(t),type:"application/pdf"})}catch(t){}if("doi"===n)for(let t of i)"doi:"!==t.slice(0,4)&&(t=`doi:${t}`),e.push({href:t})}for(const n of Object.keys(t.dc)){const i=t.dc[n];if("identifier"===n)for(const t of i)"doi:"===t.slice(0,4)&&e.push({href:t})}const i=t.dc["relation.ispartof"],o=t.dc.identifier;if(i&&o){const t=i[i.length-1],n=o[o.length-1],r="urn:x-dc:"+encodeURIComponent(t)+"/"+encodeURIComponent(n);e.push({href:r})}return e}_getFavicon(){let t=null;for(const e of Array.from(this.document.querySelectorAll("link")))if(["shortcut icon","icon"].includes(e.rel))try{t=this._absoluteUrl(e.href)}catch(t){}return t}_absoluteUrl(t){return ni(t,this.document.baseURI)}_getDocumentHref(){
const{href:t}=this.document.location,e=["http:","https:","file:"],n=new URL(t).protocol;return e.includes(n)?t:this.document.baseURI&&e.includes(new URL(this.document.baseURI).protocol)?this.document.baseURI:t}}function oi(t){return t.width<=0||t.height<=0}function ri(t,e,n,i){return Math.max(t,n)<Math.min(e,i)}function si(t,e){return!oi(t)&&!oi(e)&&(ri(t.left,t.right,e.left,e.right)&&ri(t.top,t.bottom,e.top,e.bottom))}function ai(t,e){return ri(t.top,t.bottom,e.top,e.bottom)}function li(t,e){return ri(t.left,t.right,e.left,e.right)}function ci(t,e){if(oi(t))return e;if(oi(e))return t;const n=Math.min(t.left,e.left),i=Math.min(t.top,e.top),o=Math.max(t.right,e.right),r=Math.max(t.bottom,e.bottom);return new DOMRect(n,i,o-n,r-i)}function hi(t){return new DOMPoint((t.left+t.right)/2,(t.top+t.bottom)/2)}const ui=["p",".para"];let di;function fi(t,e=0,n=t.data.length){return di||(di=document.createRange()),di.setStart(t,e),di.setEnd(t,n),di.getBoundingClientRect()}function pi(t){const e=t.getBoundingClientRect()
;return e.x-=t.scrollLeft,e.y-=t.scrollTop,e.height=Math.max(e.height,t.scrollHeight),e.width=Math.max(e.width,t.scrollWidth),e}function*mi(t,e,n){let i=t.firstChild;for(;i;){if(Ke(i)){const t=si(pi(i),e);n(i)&&t&&(yield*mi(i,e,n))}else Qe(i)&&si(fi(i),e)&&(yield i);i=i.nextSibling}}function gi(t,e){let n=null;const i=t=>!function(t){switch(getComputedStyle(t).position){case"fixed":case"sticky":return!0;default:return!1}}(t);t:for(const s of mi(t,e,i)){let t=0;for(const i of s.data.split(/\b/)){if(/\S/.test(i)){const a=t,l=t+i.length,c=fi(s,a,l);if(r=c,!oi(o=e)&&!oi(r)&&r.left>=o.left&&r.right<=o.right&&r.top>=o.top&&r.bottom<=o.bottom){n=document.createRange(),n.setStart(s,a),n.setEnd(s,l);break t}}t+=i.length}}var o,r;return n}function _i(t,e=document.documentElement,n=new DOMRect(0,0,window.innerWidth,window.innerHeight)){const i=gi(e,n);if(!i)return t(),0;const o=i.getBoundingClientRect().top;t();const r=i.getBoundingClientRect().top-o;return e.scrollTop+=r,r}class vi extends u{
constructor({features:t,container:n=document.body}){super(),e(this,"container",void 0),e(this,"features",void 0),e(this,"_flagsChanged",void 0),e(this,"_htmlMeta",void 0),e(this,"_prevURI",void 0),e(this,"_sideBySideEnabled",void 0),e(this,"_sideBySideActive",void 0),e(this,"_lastLayout",void 0),e(this,"_navObserver",void 0),e(this,"_metaObserver",void 0),this.features=t,this.container=n,this._htmlMeta=new ii,this._prevURI=this._htmlMeta.uri(),this._sideBySideEnabled=this.features.flagEnabled("html_side_by_side"),this._sideBySideActive=!1,this._lastLayout=null,this._navObserver=new zn((()=>this._checkForURIChange())),this._metaObserver=new MutationObserver((()=>this._checkForURIChange())),this._metaObserver.observe(document.head,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["rel","href","name","content"]}),this._flagsChanged=()=>{const e=t.flagEnabled("html_side_by_side");e!==this._sideBySideEnabled&&(this._sideBySideEnabled=e,this._lastLayout&&this.fitSideBySide(this._lastLayout))},
this.features.on("flagsChanged",this._flagsChanged)}anchor(t,e){return function(t,e,n={}){let i=null,o=null,r=null;for(const t of e)switch(t.type){case"TextPositionSelector":i=t,n.hint=i.start;break;case"TextQuoteSelector":o=t;break;case"RangeSelector":r=t}const s=t=>{var e;if(null!==(e=o)&&void 0!==e&&e.exact&&t.toString()!==o.exact)throw new Error("quote mismatch");return t};let a=Promise.reject("unable to anchor");if(r){const e=r;a=a.catch((()=>Un(Bn.fromSelector(t,e),n).then(s)))}if(i){const e=i;a=a.catch((()=>Un(Hn.fromSelector(t,e),n).then(s)))}if(o){const e=o;a=a.catch((()=>Un(Vn.fromSelector(t,e),n)))}return a}(t,e)}describe(t,e){return function(t,e){const n=[Bn,Hn,Vn],i=[];for(const o of n)try{const n=o.fromRange(t,e);i.push(n.toSelector())}catch(t){}return i}(t,e)}_checkForURIChange(){const t=this._htmlMeta.uri();t!==this._prevURI&&(this._prevURI=t,this.emit("uriChanged",t))}getAnnotatableRange(t){try{return Ye.trimmedRange(t)}catch(t){if(t instanceof RangeError)return null;throw t}}
canStyleClusteredHighlights(){return!0}destroy(){this._navObserver.disconnect(),this._metaObserver.disconnect(),this.features.off("flagsChanged",this._flagsChanged)}contentContainer(){return this.container}fitSideBySide(t){this._lastLayout=t;const e=window.innerWidth-t.width,n=this._sideBySideEnabled&&t.expanded&&e>=480;return n?this._activateSideBySide(t.width):this._sideBySideActive&&this._deactivateSideBySide(),this._sideBySideActive=n,n}_activateSideBySide(t){const e=t+12,n=t=>parseInt(window.getComputedStyle(t).marginLeft,10);_i((()=>{document.body.style.marginLeft="",document.body.style.marginRight="";const t=n(document.body);document.body.style.marginRight=`${e}px`;const i=function(t){const e=new Map,n=new Map,i=ui.join(","),o=Array.from(t.querySelectorAll(i)).map((t=>({rect:t.getBoundingClientRect(),textLength:t.textContent.length}))).filter((({rect:t})=>t.width>0&&t.height>0)).sort(((t,e)=>e.textLength-t.textLength)).slice(0,15);if(o.forEach((({rect:t})=>{var i,o
;let r=null!==(i=e.get(t.left))&&void 0!==i?i:0;r+=1,e.set(t.left,r);let s=null!==(o=n.get(t.right))&&void 0!==o?o:0;s+=1,n.set(t.right,s)})),0===e.size||0===n.size)return null;const r=[...e.entries()].sort(((t,e)=>e[1]-t[1])),s=[...n.entries()].sort(((t,e)=>e[1]-t[1])),[a]=r[0],[l]=s[0];return{left:a,right:l}}(document.body);if(i){const o=Math.max(0,window.innerWidth-e-i.right);if(o>0){const t=Math.max(0,e-o);document.body.style.marginRight=`${t}px`}n(document.body)>t&&(document.body.style.marginLeft=`${t}px`),i.left<12&&(document.body.style.marginLeft="12px")}else document.body.style.marginLeft="",document.body.style.marginRight=""}))}_deactivateSideBySide(){_i((()=>{document.body.style.marginLeft="",document.body.style.marginRight=""}))}async getMetadata(){return this._htmlMeta.getDocumentMetadata()}async uri(){return this._htmlMeta.uri()}async scrollToAnchor(t){var e;const n=null===(e=t.highlights)||void 0===e?void 0:e[0];n&&await async function(t,{maxDuration:e=500}={}){const n=t.closest("body")
;n&&"BODY"!==n.tagName&&Object.defineProperty(n,"tagName",{value:"BODY",configurable:!0}),await new Promise((n=>Jn(t,{time:e},n)))}(n)}}var bi=/^\s+|\s+$/g,yi=/^[-+]0x[0-9a-f]+$/i,wi=/^0b[01]+$/i,xi=/^0o[0-7]+$/i,Ci=parseInt,Si="object"==typeof t&&t&&t.Object===Object&&t,Ei="object"==typeof self&&self&&self.Object===Object&&self,Ni=Si||Ei||Function("return this")(),Ai=Object.prototype.toString,Ri=Math.max,ki=Math.min,Ti=function(){return Ni.Date.now()};function Pi(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Oi(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==Ai.call(t)}(t))return NaN;if(Pi(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Pi(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(bi,"");var n=wi.test(t);return n||xi.test(t)?Ci(t.slice(2),n?2:8):yi.test(t)?NaN:+t}var Li=function(t,e,n){var i,o,r,s,a,l,c=0,h=!1,u=!1,d=!0
;if("function"!=typeof t)throw new TypeError("Expected a function");function f(e){var n=i,r=o;return i=o=void 0,c=e,s=t.apply(r,n)}function p(t){return c=t,a=setTimeout(g,e),h?f(t):s}function m(t){var n=t-l;return void 0===l||n>=e||n<0||u&&t-c>=r}function g(){var t=Ti();if(m(t))return _(t);a=setTimeout(g,function(t){var n=e-(t-l);return u?ki(n,r-(t-c)):n}(t))}function _(t){return a=void 0,d&&i?f(t):(i=o=void 0,s)}function v(){var t=Ti(),n=m(t);if(i=arguments,o=this,l=t,n){if(void 0===a)return p(l);if(u)return a=setTimeout(g,e),f(l)}return void 0===a&&(a=setTimeout(g,e)),s}return e=Oi(e)||0,Pi(n)&&(h=!!n.leading,r=(u="maxWait"in n)?Ri(Oi(n.maxWait)||0,e):r,d="trailing"in n?!!n.trailing:d),v.cancel=function(){void 0!==a&&clearTimeout(a),c=0,i=l=o=a=void 0},v.flush=function(){return void 0===a?s:_(Ti())},v};function Mi(t,e,n,i=0){let o=i;for(;o<t.length&&e>0;)n(t[o])&&--e,++o;return o}function Ii(t,e,n,i){let o=0;for(let r=n;r<i;r++)e(t[r])&&++o;return o}function Fi(t,e,n,i,o){const r=Ii(t,o,0,n),s=Ii(t,o,n,i)
;let a=Mi(e,r,o);for(;a<e.length&&!o(e[a]);)++a;return[a,Mi(e,s,o,a)]}const Di=0,Bi=3,Hi=new Map,Vi=new Map;function Ui(t,e){return`${t}:${e}`}function qi(t){var e;const n="closest"in t?t:t.parentElement;return null!==(e=null==n?void 0:n.closest(".textLayer"))&&void 0!==e?e:null}function Wi(){return PDFViewerApplication.pdfViewer}async function zi(t){const e=Wi();let n=e.getPageView(t);return n&&n.pdfPage||(n=await new Promise((n=>{const i=()=>{e.eventBus?e.eventBus.off("pagesloaded",i):document.removeEventListener("pagesloaded",i),n(e.getPageView(t))};e.eventBus?e.eventBus.on("pagesloaded",i):document.addEventListener("pagesloaded",i)}))),n}function $i(t){const e=Hi.get(t);if(e)return e;const n=(async()=>{const e=await zi(t);return(await e.pdfPage.getTextContent({normalizeWhitespace:!0})).items.map((t=>t.str)).join("")})();return Hi.set(t,n),n}async function ji(t){const e=Wi();let n=0,i=0,o="";for(let r=0;r<e.pagesCount;r++)if(o=await $i(r),n=i,i+=o.length,i>=t)return{index:r,offset:n,text:o};return{
index:e.pagesCount-1,offset:n,text:o}}function Xi(t){switch(t){case" ":case"\f":case"\n":case"\r":case"\t":case"\v":case"":return!0;default:return!1}}const Yi=t=>!Xi(t);async function Zi(t,e,n){const[i,o]=await Promise.all([zi(t),$i(t)]);if(i.renderingState===Bi&&i.textLayer&&i.textLayer.renderingDone){var r;const t=null!==(r=i.textLayer.textLayerDiv)&&void 0!==r?r:i.textLayer.div;if(!t)throw new Error("Unable to find PDF.js text layer root");const s=t.textContent,[a,l]=Fi(o,s,e,n,Yi);Gi(s.slice(a,l))!==Gi(o.slice(e,n))&&vn("Text layer text does not match page text. Highlights will be mis-aligned.");const c=new Xe(t,a),h=new Xe(t,l);return new Ye(c,h).toRange()}const s=function(t){let e=t.querySelector(Ze);return e||(e=document.createElement("span"),e.classList.add("annotator-placeholder"),e.textContent="Loading annotations...",t.appendChild(e),e)}(i.div),a=document.createRange();return a.setStartBefore(s),a.setEndAfter(s),a}function Gi(t){let e="";for(let n=0;n<t.length;n++){const i=t[n];Xi(i)||(e+=i)}
return e}async function Ki(t,e){const n=e.find((t=>"TextQuoteSelector"===t.type));if(!n)throw new Error("No quote selector found");const i=e.find((t=>"TextPositionSelector"===t.type));if(i){try{const{index:t,offset:e,text:o}=await ji(i.start),r=i.start-e,s=i.end-e,a=o.substring(r,s);if(n.exact!==a)throw new Error("quote mismatch");return await Zi(t,r,s)}catch{}try{const t=Ui(n.exact,i.start),e=Vi.get(t);if(e){const{pageIndex:t,anchor:n}=e;return await Zi(t,n.start,n.end)}}catch{}}return async function(t,e){const n=Wi().pagesCount,i=Array(n).fill(0).map(((t,e)=>e));let o,r;if(e){const{index:t,offset:n}=await ji(e);o=t,r=e-n,i.sort(((e,n)=>Math.abs(e-t)-Math.abs(n-t)))}const s=void 0!==t.prefix?Gi(t.prefix):void 0,a=void 0!==t.suffix?Gi(t.suffix):void 0,l=Gi(t.exact);let c;for(const t of i){const e=await $i(t),n=Gi(e);let i;void 0!==o&&void 0!==r&&(t<o?i=n.length:t===o?[i]=Fi(e,n,r,r,Yi):i=0);const h=Ln(n,l,{prefix:s,suffix:a,hint:i});if(h&&(!c||h.score>c.match.score)){const[i,o]=Fi(n,e,h.start,h.end,Yi);c={
page:t,match:{start:i,end:o,score:h.score}};const r=n.slice(h.start,h.end)===l,u=void 0!==s&&n.slice(Math.max(0,h.start-s.length),h.start)===s,d=void 0!==a&&n.slice(h.end,a.length)===a,f=void 0!==s||void 0!==a;if(r&&(u||d||!f))break}}if(c){const{page:n,match:i}=c;if(e){const o=Ui(t.exact,e);Vi.set(o,{pageIndex:n,anchor:i})}return Zi(n,i.start,i.end)}throw new Error("Quote not found")}(n,null==i?void 0:i.start)}function Qi(t){try{t=Ye.fromRange(t).toRange()}catch{throw new Error("Selection does not contain text")}const e=qi(t.startContainer),n=qi(t.endContainer);if(!e||!n)throw new Error("Selection is outside page text");if(e!==n)throw new Error("Selecting across page breaks is not supported");return[t,e]}async function Ji(t,e){const[n,i]=Qi(e),o=Xe.fromPoint(n.startContainer,n.startOffset).relativeTo(i),r=Xe.fromPoint(n.endContainer,n.endOffset).relativeTo(i),s=function(t){let e=0;for(;t.previousSibling;)++e,t=t.previousSibling;return e}(i.parentNode),a=await async function(t){
if(t>=Wi().pagesCount)throw new Error("Invalid page index");let e=0;for(let n=0;n<t;n++)e+=(await $i(n)).length;return e}(s);return[{type:"TextPositionSelector",start:a+o.offset,end:a+r.offset},Vn.fromRange(t,n).toSelector()]}function to({children:t}){return Wt("div",{className:"flex flex-col",children:t})}function eo({info:t}){let e=t.item.title;return t.item.subtitle&&(e+=`: ${t.item.subtitle}`),Wt("div",{className:be("h-10 bg-white px-4 text-slate-7 text-annotator-base border-b","grid items-center","grid-cols-[100px_minmax(0,auto)]","2xl:grid-cols-[100px_minmax(0,auto)_minmax(0,auto)] 2xl:gap-x-3"),children:[Wt("div",{"data-testid":"content-logo",children:t.logo&&Wt(ke,{href:t.logo.link,target:"_blank","data-testid":"logo-link",children:Wt("img",{alt:t.logo.title,src:t.logo.logo,"data-testid":"logo-image"})})}),Wt("div",{className:be("hidden","2xl:block 2xl:whitespace-nowrap 2xl:overflow-hidden 2xl:text-ellipsis","font-semibold"),"data-testid":"content-container-info",title:t.container.title,
children:t.container.title}),Wt("div",{className:be("flex justify-center items-center gap-x-2"),"data-testid":"content-item-info",children:[Wt("div",{className:be("hidden","2xl:block 2xl:grow")}),t.links.previousItem&&Wt($,{children:[Wt(ke,{classes:"flex gap-x-1 items-center text-annotator-sm whitespace-nowrap",title:"Open previous item",href:t.links.previousItem,underline:"always",target:"_blank","data-testid":"content-previous-link",children:[Wt(Kt,{className:"w-em h-em"}),Wt("span",{children:"Previous"})]}),Wt("div",{className:"text-annotator-sm",children:"|"})]}),Wt("div",{className:be("min-w-0 whitespace-nowrap overflow-hidden text-ellipsis shrink font-medium"),children:Wt(Re,{title:e,href:t.links.currentItem,"data-testid":"content-item-link",target:"_blank",unstyled:!0,children:e})}),t.links.nextItem&&Wt($,{children:[Wt("div",{className:"text-annotator-sm",children:"|"}),Wt(ke,{title:"Open next item",classes:"flex gap-x-1 items-center text-annotator-sm whitespace-nowrap",href:t.links.nextItem,
underline:"always",target:"_blank","data-testid":"content-next-link",children:[Wt("span",{children:"Next"}),Wt(Jt,{className:"w-em h-em"})]})]})]})]})}function no(){return Wt("div",{className:"bg-white",role:"alert",children:Wt("div",{className:be("flex items-center gap-x-2","border border-yellow-notice bg-yellow-notice/10 text-annotator-base"),children:[Wt("div",{className:"bg-yellow-notice text-white p-2",children:Wt(ee,{className:"text-annotator-xl"})}),Wt("div",{children:[Wt("strong",{children:"This PDF does not contain selectable text:"})," ",Wt(ke,{target:"_blank",href:"https://web.hypothes.is/help/how-to-ocr-optimize-pdfs/",underline:"always",children:"Learn how to fix this"})," ","in order to annotate with Hypothesis."]})]})})}class io{constructor(t){e(this,"_loaded",void 0),this._loaded=function(t){return t.initializedPromise?t.initializedPromise:t.initialized?Promise.resolve():new Promise((e=>{const n=setInterval((()=>{t.initialized&&(clearTimeout(n),e())}),5)}))
}(t).then((()=>t.downloadComplete?t:new Promise((e=>{const n=()=>{t.eventBus?(t.eventBus.off("documentload",n),t.eventBus.off("documentloaded",n)):window.removeEventListener("documentload",n),e(t)};t.eventBus?(t.eventBus.on("documentloaded",n),t.eventBus.on("documentload",n)):window.addEventListener("documentload",n)}))))}getUri(){return this._loaded.then((t=>{let e=so(t);return e||(e=ro(oo(t))),e}))}async getMetadata(){const t=await this._loaded,{info:e,contentDispositionFilename:n,metadata:i}=await t.pdfDocument.getMetadata(),o=oo(t),r=so(t);let s;s=null!=i&&i.has("dc:title")&&"Untitled"!==i.get("dc:title")?i.get("dc:title"):null!=e&&e.Title?e.Title:n||(r?function(t){const e=new URL(t).pathname.split("/");return e[e.length-1]}(r):"");const a=[{href:ro(o)}];return r&&a.push({href:r}),{title:s,link:a,documentFingerprint:o}}}function oo(t){return Array.isArray(t.pdfDocument.fingerprints)?t.pdfDocument.fingerprints[0]:t.pdfDocument.fingerprint}function ro(t){return`urn:x-pdf:${t}`}function so(t){
if(!t.url)return null;const e=ni(t.url);return 0!==e.indexOf("file://")?e:null}function ao(t){var e;const n=null===(e=t.highlights)||void 0===e?void 0:e[0];return n&&Ge(n)}function lo(t){return new Promise((e=>setTimeout(e,t)))}class co extends u{constructor(t,i={}){var o,r,s;super(),e(this,"_annotator",void 0),e(this,"_banner",void 0),e(this,"_bannerState",void 0),e(this,"_destroyed",void 0),e(this,"_listeners",void 0),e(this,"_observer",void 0),e(this,"_pdfContainer",void 0),e(this,"_pdfMetadata",void 0),e(this,"_pdfViewer",void 0),e(this,"_reanchoringMaxWait",void 0),e(this,"_updateAnnotationLayerVisibility",void 0),this._annotator=t;const a=window,l=a.PDFViewerApplication;this._pdfViewer=l.pdfViewer,this._pdfViewer.viewer.classList.add("has-transparent-text-layer"),this._pdfContainer=null!==(o=null===(r=l.appConfig)||void 0===r?void 0:r.appContainer)&&void 0!==o?o:document.body,this._pdfMetadata=new io(l),this._observer=new MutationObserver(Li((()=>this._update()),100)),
this._observer.observe(this._pdfViewer.viewer,{attributes:!0,attributeFilter:["data-loaded"],childList:!0,subtree:!0}),this._reanchoringMaxWait=null!==(s=i.reanchoringMaxWait)&&void 0!==s?s:3e3,this._banner=null,this._bannerState={contentInfo:null,noTextWarning:!1},this._updateBannerState(this._bannerState),this._checkForSelectableText(),this._updateAnnotationLayerVisibility=()=>{const t=a.getSelection();this._pdfViewer.viewer.classList.toggle("is-selecting",!t.isCollapsed)},this._listeners=new n,this._listeners.add(document,"selectionchange",this._updateAnnotationLayerVisibility),this._destroyed=!1}destroy(){var t;this._listeners.removeAll(),this._pdfViewer.viewer.classList.remove("has-transparent-text-layer"),this._observer.disconnect(),null===(t=this._banner)||void 0===t||t.remove(),this._destroyed=!0}uri(){return this._pdfMetadata.getUri()}getMetadata(){return this._pdfMetadata.getMetadata()}showContentInfo(t){this._updateBannerState({contentInfo:t})}anchor(t,e){return Ki(0,e)}getAnnotatableRange(t){try{
const e=Ye.trimmedRange(t);if(function(t){try{return Qi(t),!0}catch{return!1}}(e))return e}catch(t){if(!(t instanceof RangeError))throw t}return null}canStyleClusteredHighlights(){return!0}describe(t,e){return Ji(t,e)}async _checkForSelectableText(){try{await this.uri()}catch(t){return}if(!this._destroyed)try{const t=await async function(){const t=Wi();let e=!1;for(let n=0;n<t.pagesCount;n++)if((await $i(n)).trim().length>0){e=!0;break}return e}();this._updateBannerState({noTextWarning:!t})}catch(t){console.warn("Unable to check for text in PDF:",t)}}_updateBannerState(t){this._bannerState={...this._bannerState,...t};const e=document.querySelector("#outerContainer");var n;if(!(this._bannerState.contentInfo||this._bannerState.noTextWarning))return null===(n=this._banner)||void 0===n||n.remove(),this._banner=null,void(e.style.height="");this._banner||(this._banner=document.createElement("hypothesis-banner"),document.body.prepend(this._banner),Fe(this._banner)),ut(Wt(to,{
children:[this._bannerState.contentInfo&&Wt(eo,{info:this._bannerState.contentInfo}),this._bannerState.noTextWarning&&Wt(no,{})]}),this._banner.shadowRoot);const i=this._banner.getBoundingClientRect().height;e.style.height=`calc(100% - ${i}px)`}_update(){const t=[],e=this._pdfViewer.pagesCount;for(let t=0;t<e;t++){var n;const e=this._pdfViewer.getPageView(t);if(null!=e&&null!==(n=e.textLayer)&&void 0!==n&&n.renderingDone)switch(e.renderingState){case Di:e.textLayer=null;break;case Bi:i=e.div,o=void 0,null===(o=i.querySelector(Ze))||void 0===o||o.remove()}}var i,o;for(const e of this._annotator.anchors)if(e.highlights){if(t.includes(e.annotation))continue;for(let n=0;n<e.highlights.length;n++){const i=e.highlights[n];if(!document.body.contains(i)){e.highlights.splice(n,1),delete e.range,t.push(e.annotation);break}}}t.map((t=>this._annotator.anchor(t)))}contentContainer(){return document.querySelector("#viewerContainer")}fitSideBySide(t){
const e=window.innerWidth-t.width,n=t.expanded&&e>=680,i=n?t.width:t.toolbarWidth;this._pdfContainer.style.width=`calc(100% - ${i}px)`;const o=this._pdfViewer.currentScaleValue;return"auto"!==o&&"page-fit"!==o&&"page-width"!==o||(this._pdfViewer.currentScaleValue=o),this._pdfViewer.update(),n}async scrollToAnchor(t){const e=t.annotation,n=ao(t),i=this._anchorOffset(t);if(null!==i&&(await ei(this.contentContainer(),i),n)){const t=await this._waitForAnnotationToBeAnchored(e,this._reanchoringMaxWait);if(!t)return;const n=this._anchorOffset(t);if(null===n)return;await ei(this.contentContainer(),n)}}async _waitForAnnotationToBeAnchored(t,e){var n;const i=Date.now();let o;do{o=this._annotator.anchors.find((e=>e.annotation===t)),o&&!ao(o)||(o=null,await lo(20))}while(!o&&Date.now()-i<e);return null!==(n=o)&&void 0!==n?n:null}_anchorOffset(t){if(!t.highlights)return null;return function(t,e){let n=0;for(;t!==e&&e.contains(t);)n+=t.offsetTop,t=t.offsetParent;return n}(t.highlights[0],this.contentContainer())}}
function ho(t){const e=function(t){if(!t.includes("["))return t;let e="",n=!1,i=!1;for(const o of t)n||"^"!==o?(n||"["!==o?!n&&i&&"]"===o?i=!1:i||(e+=o):i=!0,n=!1):n=!0;return e}(t),n=e.indexOf("!");return-1===n?e:e.slice(0,n)}class uo{constructor(t,n,i){e(this,"_element",void 0),e(this,"_onFrameAdded",void 0),e(this,"_onFrameRemoved",void 0),e(this,"_annotatableFrames",void 0),e(this,"_isDisconnected",void 0),e(this,"_mutationObserver",void 0),this._element=t,this._onFrameAdded=n,this._onFrameRemoved=i,this._annotatableFrames=new Set,this._isDisconnected=!1,this._mutationObserver=new MutationObserver(Li((()=>{this._discoverFrames()}),40)),this._discoverFrames(),this._mutationObserver.observe(this._element,{childList:!0,subtree:!0,attributeFilter:["enable-annotation"]})}disconnect(){this._isDisconnected=!0,this._mutationObserver.disconnect()}async _addFrame(t){this._annotatableFrames.add(t);try{if(await fo(t),this._isDisconnected)return;t.contentWindow.addEventListener("unload",(()=>{this._removeFrame(t)})),
this._onFrameAdded(t)}catch(e){console.warn(`Unable to inject the Hypothesis client (from '${document.location.href}' into a cross-origin frame '${t.src}')`)}}_removeFrame(t){this._annotatableFrames.delete(t),this._onFrameRemoved(t)}_discoverFrames(){const t=new Set(this._element.querySelectorAll("iframe[enable-annotation]"));for(const e of t)this._annotatableFrames.has(e)||this._addFrame(e);for(const e of this._annotatableFrames)t.has(e)||this._removeFrame(e)}}function fo(t){return new Promise(((e,n)=>{const i=po(t,((t,o)=>{i(),o?e(o):n(t)}))}))}function po(t,e,{pollInterval:n=10}={}){let i,o;const r=new WeakSet,s=()=>{clearTimeout(i),i=void 0},a=()=>{const n=t.contentDocument;if(n){if(!r.has(n)){if(r.add(n),s(),!function(t){var e;return"about:blank"===(null===(e=t.contentDocument)||void 0===e?void 0:e.location.href)&&t.hasAttribute("src")&&"about:blank"!==t.src}(t)){"interactive"===n.readyState||"complete"===n.readyState?e(null,n):n.addEventListener("DOMContentLoaded",(()=>e(null,n)))}var i
;t.contentDocument&&(null===(i=t.contentWindow)||void 0===i||i.addEventListener("unload",o))}}else{s();const n=t.isConnected?"Frame is cross-origin":"Frame is disconnected";e(new Error(n))}};let l=!1;o=()=>{s(),l||(i=setInterval(a,n))},t.addEventListener("load",a);const c=setTimeout(a,0);return()=>{l=!0,clearTimeout(c),s(),t.removeEventListener("load",a)}}class mo{constructor(t,n){e(this,"_config",void 0),e(this,"_frameObserver",void 0),this._config=n,this._frameObserver=new uo(t,(t=>go(t,n)),(()=>{}))}destroy(){this._frameObserver.disconnect()}}async function go(t,e,n){if(null!==t.contentDocument.querySelector("script.js-hypothesis-config"))return;await fo(t);const{assetRoot:i,notebookAppUrl:r,profileAppUrl:s,sidebarAppUrl:a}=C(document),l={...e,assetRoot:i,notebookAppUrl:r,profileAppUrl:s,sidebarAppUrl:a,subFrameIdentifier:null!=n?n:o(10)},c=document.createElement("script");c.className="js-hypothesis-config",c.setAttribute("data-remove-on-unload",""),c.type="application/json",c.innerText=JSON.stringify(l)
;const h=document.createElement("script");h.async=!0,h.src=e.clientUrl;const u=t.contentDocument;u.body.appendChild(c),u.body.appendChild(h)}class _o{constructor(t,i,o){if(e(this,"container",void 0),e(this,"_imageSizeObserver",void 0),e(this,"_listeners",void 0),e(this,"_updateTextLayerSize",void 0),i.length!==o.length)throw new Error("Char boxes length does not match text length");const r=t.parentNode,s=document.createElement("hypothesis-text-layer");r.insertBefore(s,t.nextSibling),r.style.position="relative",s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.color="transparent",s.style.textAlign="left",s.style.mixBlendMode="multiply";const a="sans-serif";s.style.fontSize="16px",s.style.fontFamily=a;const l=document.createElement("canvas").getContext("2d");l.font="16px sans-serif";const c=(t,e,n="px")=>`calc(var(--${t}-scale) * ${e}${n})`,h=function(t,e){const n=[];let i={text:"",rect:new DOMRect};const o=()=>{i.text.length>0&&(n.push(i),i={text:"",rect:new DOMRect})}
;for(const[n,r]of t.entries()){const t=e[n],s=/\s/.test(t);i.text.length>0&&!ai(i.rect,r)&&o(),i.rect=ci(i.rect,r),i.text+=s?" ":t,s&&o()}o();const r=[];let s={words:[],rect:new DOMRect};const a=()=>{s.words.length>0&&(r.push(s),s={words:[],rect:new DOMRect})};for(const t of n){const e=s.words[s.words.length-1];if(e){const n=hi(e.rect),i=hi(t.rect).x-n.x;(!ai(e.rect,t.rect)||i<0)&&a()}s.words.push(t),s.rect=ci(s.rect,t.rect)}a();const l=[];let c={lines:[],rect:new DOMRect};const h=()=>{c.lines.length>0&&(l.push(c),c={lines:[],rect:new DOMRect})};for(const t of r){const e=c.lines[c.lines.length-1];if(e){const n=hi(e.rect),i=hi(t.rect).y-n.y;(!li(e.rect,t.rect)||ai(e.rect,t.rect)||i<0||i>4*t.rect.height)&&h()}c.lines.push(t),c.rect=ci(c.rect,t.rect)}return h(),l}(i,o);for(const t of h){const e=document.createElement("hypothesis-text-column");e.style.display="block",e.style.position="absolute",e.style.left=c("x",t.rect.left),e.style.top=c("y",t.rect.top);let n=null;for(const i of t.lines){
const o=document.createElement("hypothesis-text-line");o.style.display="block",o.style.marginLeft=c("x",i.rect.left-t.rect.left),o.style.height=c("y",i.rect.height),n&&(o.style.marginTop=c("y",i.rect.top-n.rect.bottom)),n=i,o.style.whiteSpace="nowrap";let r=null;for(const t of i.words){const e=document.createElement("hypothesis-text-word");e.style.display="inline-block",e.style.transformOrigin="top left",e.textContent=t.text,r&&(e.style.marginLeft=c("x",t.rect.left-r.rect.right)),r=t,e.style.width=c("x",t.rect.width),e.style.height=c("y",t.rect.height),e.style.whiteSpace="pre";const n=l.measureText(t.text),i=c("x",t.rect.width/n.width,""),s=c("y",t.rect.height/16,"");e.style.transform=`scale(${i}, ${s})`,o.append(e)}e.append(o)}s.append(e)}const u=()=>{const{width:e,height:n}=t.getBoundingClientRect();s.style.width=e+"px",s.style.height=n+"px",s.style.setProperty("--x-scale",`${e}`),s.style.setProperty("--y-scale",`${n}`)};u(),this.container=s,this._updateTextLayerSize=Li(u,{maxWait:50}),
this._listeners=new n,"undefined"!=typeof ResizeObserver&&(this._imageSizeObserver=new ResizeObserver((()=>{this._updateTextLayerSize()})),this._imageSizeObserver.observe(t)),this._listeners.add(window,"resize",this._updateTextLayerSize)}updateSync(){this._updateTextLayerSize(),this._updateTextLayerSize.flush()}destroy(){var t;this.container.remove(),this._listeners.removeAll(),this._updateTextLayerSize.cancel(),null===(t=this._imageSizeObserver)||void 0===t||t.disconnect()}}function vo(t=document){return t.querySelector("mosaic-book")}function bo(t=window){var e;if(vo(t.document))return"container";const n=null===(e=t.frameElement)||void 0===e?void 0:e.ownerDocument;return n&&vo(n)?"content":null}class yo{constructor(t){e(this,"_frameObserver",void 0);const n=vo();if(!n)throw new Error("Book container element not found");const i=new WeakSet,o=n.shadowRoot,r=()=>{const e=o.querySelector("iframe");e&&!i.has(e)&&(i.add(e),po(e,((n,i)=>{if(n)return;const o=i.body
;o&&!o.querySelector("#page-content")&&go(e,t,"vitalsource-content")})))};r(),this._frameObserver=new MutationObserver(r),this._frameObserver.observe(o,{childList:!0,subtree:!0})}destroy(){this._frameObserver.disconnect()}}function wo(){return document.querySelector("img#pbk-page")}class xo extends u{constructor(t=document.body,i={}){var o;super(),e(this,"_bookElement",void 0),e(this,"_htmlIntegration",void 0),e(this,"_listeners",void 0),e(this,"_textLayer",void 0);const r=null!==(o=i.bookElement)&&void 0!==o?o:vo(window.parent.document);if(!r)throw new Error("Failed to find <mosaic-book> element in container frame");this._bookElement=r;const s=new yn;s.update({html_side_by_side:!0}),this._htmlIntegration=new vi({container:t,features:s}),this._listeners=new n;const a=["mouseup","mousedown","mouseout"];for(const t of a)this._listeners.add(document.documentElement,t,(t=>{t.stopPropagation()}));const l=window.frameElement;l&&function(t){if("no"!==t.getAttribute("scrolling"))return
;const e=document.createElement("style");e.textContent="iframe { height: 100% !important; }",t.insertAdjacentElement("beforebegin",e);const n=()=>t.removeAttribute("scrolling");n(),new MutationObserver(n).observe(t,{attributes:!0})}(l);const c=wo(),h=window.innerPageData;if(c&&h){const t=h.glyphs.glyphs.map((t=>{const e=t.l/100,n=t.r/100,i=t.t/100,o=t.b/100;return new DOMRect(e,i,n-e,o-i)}));this._textLayer=new _o(c,t,h.words),this._textLayer.container.style.zIndex="100"}}getAnnotatableRange(t){return this._htmlIntegration.getAnnotatableRange(t)}destroy(){var t;null===(t=this._textLayer)||void 0===t||t.destroy(),this._listeners.removeAll(),this._htmlIntegration.destroy()}anchor(t,e){return this._htmlIntegration.anchor(t,e)}async describe(t,e){const n=this._htmlIntegration.describe(t,e),{cfi:i,index:o,page:r,title:s,url:a}=await this._getPageInfo(!0),l=[{type:"EPUBContentSelector",cfi:i,url:a,title:s}];return"pbk"===this._bookElement.getBookInfo().format&&"number"==typeof o&&l.push({type:"PageSelector",
index:o,label:r}),n.push(...l),n}contentContainer(){return this._htmlIntegration.contentContainer()}fitSideBySide(t){const e=wo();if(e&&this._textLayer){const n=e.parentElement,i=this._textLayer,o=window.innerWidth-t.width;return _i((()=>{t.expanded&&o>480?(n.style.textAlign="left",e.style.width=`${o}px`):(n.style.textAlign="",e.style.width=""),i.updateSync()})),t.expanded}return this._htmlIntegration.fitSideBySide(t)}async getMetadata(){return{title:this._bookElement.getBookInfo().title,link:[]}}navigateToSegment(t){var e;const n=null===(e=t.target[0].selector)||void 0===e?void 0:e.find((t=>"EPUBContentSelector"===t.type));if(null!=n&&n.cfi)this._bookElement.goToCfi(n.cfi);else{if(null==n||!n.url)throw new Error("No segment information available");this._bookElement.goToURL(function(t){const e=new URL(t,document.baseURI);return e.pathname+e.search}(n.url))}}persistFrame(){return!0}async _getPageInfo(t){
const[e,n]=await Promise.all([this._bookElement.getCurrentPage(),t?this._bookElement.getTOC():void 0]),i=["absoluteURL","cfi"];for(const t of i)if(!(t in e))throw new Error(`Page metadata field "${t}" is missing`);let o;if(n){var r;o=e.chapterTitle;const t=ho(e.cfi),i=null===(r=n.data)||void 0===r?void 0:r.find((e=>ho(e.cfi)===t));i&&(o=i.title)}return{cfi:e.cfi,index:e.index,page:e.page,title:o,url:new URL(e.absoluteURL,document.baseURI).toString()}}async segmentInfo(){const{cfi:t,url:e}=await this._getPageInfo(!1);return{cfi:t,url:e}}async uri(){const t=this._bookElement.getBookInfo().isbn;if(!t)throw new Error("Unable to get book ID from VitalSource");return`https://bookshelf.vitalsource.com/reader/books/${t}`}async scrollToAnchor(t){return this._htmlIntegration.scrollToAnchor(t)}}function Co(t){if(void 0!==window.PDFViewerApplication)return new co(t);return"content"===bo()?new xo(document.body):new vi({features:t.features})}function So(t){const e=t.getSelection();if(!e||0===e.rangeCount)return null
;const n=e.getRangeAt(0);return n.collapsed?null:n}class Eo{constructor(t,i=document){e(this,"_pendingCallback",void 0),e(this,"_document",void 0),e(this,"_listeners",void 0);let o=!1;this._pendingCallback=null;const r=(e=10)=>{this._pendingCallback=setTimeout((()=>{t(So(i))}),e)},s=t=>{if("mousedown"===t.type&&(o=!0),"mouseup"===t.type&&(o=!1),o)return;this._cancelPendingCallback();const e="mouseup"===t.type?10:100;r(e)};this._document=i,this._listeners=new n,this._listeners.add(i,"selectionchange",s),this._listeners.add(i.body,"mousedown",s),this._listeners.add(i.body,"mouseup",s),r(1)}disconnect(){this._listeners.removeAll(),this._cancelPendingCallback()}_cancelPendingCallback(){this._pendingCallback&&(clearTimeout(this._pendingCallback),this._pendingCallback=null)}}function No(){const t=function(t,e){const n=new Set,i=new Set;return en(t,(t=>{for(;t&&!n.has(t);){n.add(t);const o=e(t);null!=o&&i.add(o),t=t.parentNode}})),[...i]}(window.getSelection().getRangeAt(0),(t=>{var e
;return null===(e=t._annotation)||void 0===e?void 0:e.$tag}));return t}function Ao(t){const e=function(t){let e=t.nodeType===Node.ELEMENT_NODE?t:t.parentElement;const n=[];for(;e;)e.classList.contains("hypothesis-highlight")&&n.push(e),e=e.parentElement;return n}(t).map((t=>t._annotation)).filter((t=>void 0!==t)).map((t=>null==t?void 0:t.$tag));return e}function Ro(t){if(!t.range)return null;try{return t.range.toRange()}catch{return null}}function ko(){var t;null===(t=document.getSelection())||void 0===t||t.removeAllRanges()}class To extends u{constructor(t,i={},o=window){var r,s,l,c,h;(super(),e(this,"element",void 0),e(this,"selectedRanges",void 0),e(this,"anchors",void 0),e(this,"features",void 0),e(this,"_featureFlagsReceived",void 0),e(this,"_adder",void 0),e(this,"_clusterToolbar",void 0),e(this,"_hostFrame",void 0),e(this,"_highlightsVisible",void 0),e(this,"_isAdderVisible",void 0),e(this,"_informHostOnNextSelectionClear",void 0),e(this,"_selectionObserver",void 0),e(this,"_annotations",void 0),
e(this,"_frameIdentifier",void 0),e(this,"_portFinder",void 0),e(this,"_integration",void 0),e(this,"_hostRPC",void 0),e(this,"_sidebarRPC",void 0),e(this,"_bucketBarClient",void 0),e(this,"_sideBySideActive",void 0),e(this,"_listeners",void 0),e(this,"_hoveredAnnotations",void 0),this.element=t,this._hostFrame=o,this._highlightsVisible=!1,this._isAdderVisible=!1,this._informHostOnNextSelectionClear=!0,this.selectedRanges=[],this._adder=new He(this.element,{onAnnotate:()=>this.createAnnotation(),onHighlight:()=>this.createAnnotation({highlight:!0}),onShowAnnotations:t=>this.selectAnnotations(t,{focusInSidebar:!0})}),this._selectionObserver=new Eo((t=>{t?this._onSelection(t):this._onClearSelection()})),this.anchors=[],this._annotations=new Set,this._frameIdentifier=i.subFrameIdentifier||null,this._portFinder=new a({hostFrame:this._hostFrame,source:"guest",sourceId:null!==(r=this._frameIdentifier)&&void 0!==r?r:void 0}),this.features=new yn,this._featureFlagsReceived=new Promise((t=>{
this.features.on("flagsChanged",t)})),this._integration=Co(this),this._integration.on("uriChanged",(()=>this._sendDocumentInfo())),i.contentInfoBanner)&&(null===(c=(h=this._integration).showContentInfo)||void 0===c||c.call(h,i.contentInfoBanner));null!==(s=(l=this._integration).canStyleClusteredHighlights)&&void 0!==s&&s.call(l)&&(this._clusterToolbar=new En(this._integration.contentContainer(),{features:this.features})),this._hostRPC=new w,this._connectHost(o),this._sidebarRPC=new w,this._connectSidebar(),this._bucketBarClient=new gn({contentContainer:this._integration.contentContainer(),hostRPC:this._hostRPC}),this._sideBySideActive=!1,this._listeners=new n,this._setupElementEvents(),this._hoveredAnnotations=new Set}_setupElementEvents(){const t=t=>{this._sideBySideActive||Ao(t).length||this._sidebarRPC.call("closeSidebar")};this._listeners.add(this.element,"mouseup",(t=>{const{target:e,metaKey:n,ctrlKey:i}=t,o=Ao(e);if(o.length&&this._highlightsVisible){const t=n||i;this.selectAnnotations(o,{toggle:t})}
})),this._listeners.add(this.element,"mousedown",(({target:e})=>{t(e)})),this._listeners.add(this.element,"touchstart",(({target:e})=>{t(e)})),this._listeners.add(this.element,"mouseover",(({target:t})=>{const e=Ao(t);e.length&&this._highlightsVisible&&this._sidebarRPC.call("hoverAnnotations",e)})),this._listeners.add(this.element,"mouseout",(()=>{this._highlightsVisible&&this._sidebarRPC.call("hoverAnnotations",[])})),this._listeners.add(this.element,"keydown",(t=>{this._handleShortcut(t)})),this._listeners.add(window,"resize",(()=>this._repositionAdder()))}async getDocumentInfo(){var t,e,n,i,o;const[r,s,a]=await Promise.all([this._integration.uri(),this._integration.getMetadata(),null===(t=(e=this._integration).segmentInfo)||void 0===t?void 0:t.call(e)]);return{uri:ni(r),metadata:s,segmentInfo:a,persistent:null!==(n=null===(i=(o=this._integration).persistFrame)||void 0===i?void 0:i.call(o))&&void 0!==n&&n}}async _sendDocumentInfo(){var t,e
;null!==(t=(e=this._integration).waitForFeatureFlags)&&void 0!==t&&t.call(e)&&await this._featureFlagsReceived;const n=await this.getDocumentInfo();this._sidebarRPC.call("documentInfoChanged",n)}_repositionAdder(){var t;if(!1===this._isAdderVisible)return;const e=null===(t=window.getSelection())||void 0===t?void 0:t.getRangeAt(0);e&&this._onSelection(e)}async _connectHost(t){this._hostRPC.on("clearSelection",(()=>{So(document)&&(this._informHostOnNextSelectionClear=!1,ko())})),this._hostRPC.on("createAnnotation",(()=>this.createAnnotation())),this._hostRPC.on("hoverAnnotations",(t=>this._hoverAnnotations(t))),this._hostRPC.on("scrollToClosestOffScreenAnchor",((t,e)=>this._scrollToClosestOffScreenAnchor(t,e))),this._hostRPC.on("selectAnnotations",((t,e)=>this.selectAnnotations(t,{toggle:e}))),this._hostRPC.on("sidebarLayoutChanged",(e=>{var n,i;((n=window)===(i=t)||n.parent===i&&n.frameElement&&n.frameElement.getBoundingClientRect().width/n.parent.innerWidth>=.8)&&this.fitSideBySide(e)})),
this._hostRPC.on("close",(()=>this.emit("hostDisconnected")));const e=await this._portFinder.discover("host");this._hostRPC.connect(e)}async _connectSidebar(){this._sidebarRPC.on("featureFlagsUpdated",(t=>this.features.update(t))),this._sidebarRPC.on("hoverAnnotations",(t=>this._hoverAnnotations(t))),this._sidebarRPC.on("scrollToAnnotation",(t=>{const e=this.anchors.find((e=>e.annotation.$tag===t));if(null==e||!e.highlights)return;const n=Ro(e);if(!n)return;const i=new CustomEvent("scrolltorange",{bubbles:!0,cancelable:!0,detail:n});this.element.dispatchEvent(i)&&this._integration.scrollToAnchor(e)})),this._sidebarRPC.on("setHighlightsVisible",(t=>{this.setHighlightsVisible(t,!1)})),this._sidebarRPC.on("deleteAnnotation",(t=>this.detach(t))),this._sidebarRPC.on("loadAnnotations",(t=>t.forEach((t=>this.anchor(t))))),this._sidebarRPC.on("showContentInfo",(t=>{var e,n;return null===(e=(n=this._integration).showContentInfo)||void 0===e?void 0:e.call(n,t)})),this._sidebarRPC.on("navigateToSegment",(t=>{var e,n
;return null===(e=(n=this._integration).navigateToSegment)||void 0===e?void 0:e.call(n,t)})),this._portFinder.discover("sidebar").then((t=>{this._sidebarRPC.connect(t)})),this._sendDocumentInfo()}destroy(){var t;this._portFinder.destroy(),this._hostRPC.destroy(),this._sidebarRPC.destroy(),this._listeners.removeAll(),this._selectionObserver.disconnect(),this._adder.destroy(),this._bucketBarClient.destroy(),null===(t=this._clusterToolbar)||void 0===t||t.destroy(),function(t){ln(Array.from(t.querySelectorAll("hypothesis-highlight")))}(this.element),this._integration.destroy()}async anchor(t){const e=t=>{var e;const n=Ro(t);if(!n)return;const i=sn(n,null===(e=t.annotation)||void 0===e?void 0:e.$cluster);i.forEach((e=>{e._annotation=t.annotation})),t.highlights=i,this._hoveredAnnotations.has(t.annotation.$tag)&&cn(i,!0)};this.detach(t.$tag,!1),this._annotations.add(t.$tag),t.target||(t.target=[]);const n=await Promise.all(t.target.map((async e=>{
if(!e.selector||!e.selector.some((t=>"TextQuoteSelector"===t.type)))return{annotation:t,target:e};let n;try{const i=await this._integration.anchor(this.element,e.selector),o=Ye.fromRange(i);n={annotation:t,target:e,range:o}}catch(i){n={annotation:t,target:e}}return n})));if(!this._annotations.has(t.$tag))return[];for(const t of n)e(t);return t.$orphan=n.length>0&&n.every((t=>t.target.selector&&!t.range)),this._updateAnchors(this.anchors.concat(n),!0),this._sidebarRPC.call("syncAnchoringStatus",t),n}detach(t,e=!0){this._annotations.delete(t);const n=[];for(const e of this.anchors)e.annotation.$tag!==t?n.push(e):e.highlights&&ln(e.highlights);this._updateAnchors(n,e)}_updateAnchors(t,e){var n;this.anchors=t,null===(n=this._clusterToolbar)||void 0===n||n.scheduleClusterUpdates(),e&&this._bucketBarClient.update(this.anchors)}async createAnnotation({highlight:t=!1}={}){const e=this.selectedRanges;this.selectedRanges=[]
;const n=await this.getDocumentInfo(),i=this.element,r=(await Promise.all(e.map((t=>this._integration.describe(i,t))))).map((t=>({source:n.uri,selector:t}))),s={uri:n.uri,document:n.metadata,target:r,$highlight:t,$cluster:t?"user-highlights":"user-annotations",$tag:"a:"+o(8)};return this._sidebarRPC.call("createAnnotation",s),this.anchor(s),ko(),s}_hoverAnnotations(t){this._hoveredAnnotations.clear(),t.forEach((t=>this._hoveredAnnotations.add(t)));for(const e of this.anchors)if(e.highlights){const n=t.includes(e.annotation.$tag);cn(e.highlights,n)}this._sidebarRPC.call("hoverAnnotations",t)}_scrollToClosestOffScreenAnchor(t,e){const n=function(t,e){let n=null,i=0;for(let r of t){var o;if(null===(o=r.highlights)||void 0===o||!o.length)continue;const t=hn(r.highlights).top;"up"===e&&t>=137||"down"===e&&t<=window.innerHeight-22||(!n||"up"===e&&t>i||"down"===e&&t<i)&&(n=r,i=t)}return n}(this.anchors.filter((({annotation:e})=>t.includes(e.$tag))),e);n&&this._integration.scrollToAnchor(n)}_onSelection(t){
const e=this._integration.getAnnotatableRange(t);if(!e)return void this._onClearSelection();const n=document.getSelection(),i=Je(n),o=nn(n);o?(this.selectedRanges=[e],this._hostRPC.call("textSelected"),this._adder.annotationsForSelection=No(),this._isAdderVisible=!0,this._adder.show(o,i)):this._onClearSelection()}_onClearSelection(){this._isAdderVisible=!1,this._adder.hide(),this.selectedRanges=[],this._informHostOnNextSelectionClear&&this._hostRPC.call("textUnselected"),this._informHostOnNextSelectionClear=!0}selectAnnotations(t,{toggle:e=!1,focusInSidebar:n=!1}={}){e?this._sidebarRPC.call("toggleAnnotationSelection",t):this._sidebarRPC.call("showAnnotations",t,n),this._sidebarRPC.call("openSidebar")}setHighlightsVisible(t,e=!0){!function(t,e){t.classList.toggle("hypothesis-highlights-always-on",e)}(this.element,t),this._highlightsVisible=t,e&&this._hostRPC.call("highlightsVisibleChanged",t)}get highlightsVisible(){return this._highlightsVisible}fitSideBySide(t){
this._sideBySideActive=this._integration.fitSideBySide(t)}get sideBySideActive(){return this._sideBySideActive}get hoveredAnnotationTags(){return this._hoveredAnnotations}_handleShortcut(t){Ht(t,"Ctrl+Shift+H")&&this.setHighlightsVisible(!this._highlightsVisible)}}function Po(t,e){const n=new URL(t),i=new URLSearchParams;return i.append("config",JSON.stringify(e)),n.hash=i.toString(),n.toString()}function Oo(t,e){var n;const i={};for(const[t,n]of Object.entries(e))"notebookAppUrl"!==t&&"sidebarAppUrl"!==t&&null!=n&&(i[t]=n);i.origin=new URL(t).origin,i.version="1.1259.0";const o=new URL(window.location.href);if(o.hash="",i.hostURL=o.toString(),Array.isArray(i.services)&&(null===(n=i.services)||void 0===n?void 0:n.length)>0){const t=i.services[0];t.onLoginRequest&&(t.onLoginRequestProvided=!0),t.onLogoutRequest&&(t.onLogoutRequestProvided=!0),t.onSignupRequest&&(t.onSignupRequestProvided=!0),t.onProfileRequest&&(t.onProfileRequestProvided=!0),t.onHelpRequest&&(t.onHelpRequestProvided=!0)}return i}
function Lo({config:t,groupId:e}){return Wt("iframe",{title:"Hypothesis annotation notebook",className:"h-full w-full border-0",allowFullScreen:!0,src:Po(t.notebookAppUrl,{...Oo(t.notebookAppUrl,t),group:e})})}function Mo({eventBus:t,config:e}){const[n,i]=Nt(0),[o,r]=Nt(!0),[s,a]=Nt(null),l=Rt(""),c=Rt(null);At((()=>(l.current=document.body.style.overflow,()=>{document.body.style.overflow=l.current})),[]),At((()=>{document.body.style.overflow=o?l.current:"hidden"}),[o]),At((()=>{const e=t.createEmitter();return e.subscribe("openNotebook",(t=>{r(!1),i((t=>t+1)),a(t)})),c.current=e,()=>{e.destroy()}}),[t]);return null===s?null:Wt("div",{className:be("fixed z-max top-0 left-0 right-0 bottom-0 p-3 bg-black/50",{hidden:o}),"data-testid":"notebook-outer",children:Wt("div",{className:"relative w-full h-full","data-testid":"notebook-inner",children:[Wt("div",{className:"absolute right-0 m-3",children:Wt(Ae,{title:"Close the Notebook",onClick:()=>{var t;r(!0),
null===(t=c.current)||void 0===t||t.publish("closeNotebook")},variant:"dark",classes:be("!bg-transparent enabled:hover:!bg-grey-3"),children:Wt(Xt,{className:"w-4 h-4"})})}),Wt(Lo,{config:e,groupId:s},n)]})})}class Io{constructor(t,n,i){e(this,"_outerContainer",void 0),e(this,"_shadowRoot",void 0),this._outerContainer=document.createElement("hypothesis-notebook"),t.appendChild(this._outerContainer),this._shadowRoot=Fe(this._outerContainer),ut(Wt(Mo,{eventBus:n,config:i}),this._shadowRoot)}destroy(){ut(null,this._shadowRoot),this._outerContainer.remove()}}function Fo({eventBus:t,config:e}){const[n,i]=Nt(!0),o=Rt(null);At((()=>{const e=t.createEmitter();return e.subscribe("openProfile",(()=>{i(!1)})),o.current=e,()=>{e.destroy()}}),[t]);return n?null:Wt("div",{className:"fixed z-max top-0 left-0 right-0 bottom-0 p-3 bg-black/50","data-testid":"profile-outer",children:Wt("div",{className:"relative w-full h-full","data-testid":"profile-inner",children:[Wt("div",{className:"absolute right-0 m-3",children:Wt(Ae,{
title:"Close the Profile",onClick:()=>{var t;i(!0),null===(t=o.current)||void 0===t||t.publish("closeProfile")},variant:"dark",classes:be("!bg-transparent enabled:hover:!bg-grey-3"),children:Wt(Xt,{className:"w-4 h-4"})})}),Wt("iframe",{title:"Hypothesis profile",className:"h-full w-full border-0",src:e.profileAppUrl})]})})}class Do{constructor(t,n,i){e(this,"_outerContainer",void 0),e(this,"shadowRoot",void 0),this._outerContainer=document.createElement("hypothesis-profile"),t.appendChild(this._outerContainer),this.shadowRoot=Fe(this._outerContainer),ut(Wt(Fo,{eventBus:n,config:i}),this.shadowRoot)}destroy(){ut(null,this.shadowRoot),this._outerContainer.remove()}}var Bo={},Ho={get exports(){return Bo},set exports(t){Bo=t}};!function(t){!function(e,n,i,o){var r,s=["","webkit","Moz","MS","ms","o"],a=n.createElement("div"),l=Math.round,c=Math.abs,h=Date.now;function u(t,e,n){return setTimeout(v(t,n),e)}function d(t,e,n){return!!Array.isArray(t)&&(f(t,n[e],n),!0)}function f(t,e,n){var i
;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==o)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function p(t,n,i){var o="DEPRECATED METHOD: "+n+"\n"+i+" AT \n";return function(){var n=new Error("get-stack-trace"),i=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",r=e.console&&(e.console.warn||e.console.log);return r&&r.call(e.console,o,i),t.apply(this,arguments)}}r="function"!=typeof Object.assign?function(t){if(t===o||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==o&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e}:Object.assign;var m=p((function(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;)(!n||n&&t[i[r]]===o)&&(t[i[r]]=e[i[r]]),r++;return t}),"extend","Use `assign`."),g=p((function(t,e){return m(t,e,!0)
}),"merge","Use `assign`.");function _(t,e,n){var i,o=e.prototype;(i=t.prototype=Object.create(o)).constructor=t,i._super=o,n&&r(i,n)}function v(t,e){return function(){return t.apply(e,arguments)}}function b(t,e){return"function"==typeof t?t.apply(e&&e[0]||o,e):t}function y(t,e){return t===o?e:t}function w(t,e,n){f(E(e),(function(e){t.addEventListener(e,n,!1)}))}function x(t,e,n){f(E(e),(function(e){t.removeEventListener(e,n,!1)}))}function C(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function S(t,e){return t.indexOf(e)>-1}function E(t){return t.trim().split(/\s+/g)}function N(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function A(t){return Array.prototype.slice.call(t,0)}function R(t,e,n){for(var i=[],o=[],r=0;r<t.length;){var s=e?t[r][e]:t[r];N(o,s)<0&&i.push(t[r]),o[r]=s,r++}return n&&(i=e?i.sort((function(t,n){return t[e]>n[e]})):i.sort()),i}function k(t,e){
for(var n,i,r=e[0].toUpperCase()+e.slice(1),a=0;a<s.length;){if((i=(n=s[a])?n+r:e)in t)return i;a++}return o}var T=1;function P(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}var O="ontouchstart"in e,L=k(e,"PointerEvent")!==o,M=O&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),I="touch",F="mouse",D=24,B=["x","y"],H=["clientX","clientY"];function V(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){b(t.options.enable,[t])&&n.handler(e)},this.init()}function U(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,s=1&e&&i-r==0,a=12&e&&i-r==0;n.isFirst=!!s,n.isFinal=!!a,s&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=q(e));r>1&&!n.firstMultiple?n.firstMultiple=q(e):1===r&&(n.firstMultiple=!1);var s=n.firstInput,a=n.firstMultiple,l=a?a.center:s.center,u=e.center=W(i);e.timeStamp=h(),e.deltaTime=e.timeStamp-s.timeStamp,
e.angle=X(l,u),e.distance=j(l,u),function(t,e){var n=e.center,i=t.offsetDelta||{},o=t.prevDelta||{},r=t.prevInput||{};1!==e.eventType&&4!==r.eventType||(o=t.prevDelta={x:r.deltaX||0,y:r.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y});e.deltaX=o.x+(n.x-i.x),e.deltaY=o.y+(n.y-i.y)}(n,e),e.offsetDirection=$(e.deltaX,e.deltaY);var d=z(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=d.x,e.overallVelocityY=d.y,e.overallVelocity=c(d.x)>c(d.y)?d.x:d.y,e.scale=a?(f=a.pointers,p=i,j(p[0],p[1],H)/j(f[0],f[1],H)):1,e.rotation=a?function(t,e){return X(e[1],e[0],H)+X(t[1],t[0],H)}(a.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,i,r,s,a=t.lastInterval||e,l=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(l>25||a.velocity===o)){var h=e.deltaX-a.deltaX,u=e.deltaY-a.deltaY,d=z(l,h,u);i=d.x,r=d.y,n=c(d.x)>c(d.y)?d.x:d.y,s=$(h,u),t.lastInterval=e}else n=a.velocity,i=a.velocityX,r=a.velocityY,s=a.direction;e.velocity=n,
e.velocityX=i,e.velocityY=r,e.direction=s}(n,e);var f,p;var m=t.element;C(e.srcEvent.target,m)&&(m=e.srcEvent.target);e.target=m}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function q(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:l(t.pointers[n].clientX),clientY:l(t.pointers[n].clientY)},n++;return{timeStamp:h(),pointers:e,center:W(e),deltaX:t.deltaX,deltaY:t.deltaY}}function W(t){var e=t.length;if(1===e)return{x:l(t[0].clientX),y:l(t[0].clientY)};for(var n=0,i=0,o=0;o<e;)n+=t[o].clientX,i+=t[o].clientY,o++;return{x:l(n/e),y:l(i/e)}}function z(t,e,n){return{x:e/t||0,y:n/t||0}}function $(t,e){return t===e?1:c(t)>=c(e)?t<0?2:4:e<0?8:16}function j(t,e,n){n||(n=B);var i=e[n[0]]-t[n[0]],o=e[n[1]]-t[n[1]];return Math.sqrt(i*i+o*o)}function X(t,e,n){n||(n=B);var i=e[n[0]]-t[n[0]],o=e[n[1]]-t[n[1]];return 180*Math.atan2(o,i)/Math.PI}V.prototype={handler:function(){},init:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),
this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(P(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(P(this.element),this.evWin,this.domHandler)}};var Y={mousedown:1,mousemove:2,mouseup:4},Z="mousedown",G="mousemove mouseup";function K(){this.evEl=Z,this.evWin=G,this.pressed=!1,V.apply(this,arguments)}_(K,V,{handler:function(t){var e=Y[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:F,srcEvent:t}))}});var Q={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},J={2:I,3:"pen",4:F,5:"kinect"},tt="pointerdown",et="pointermove pointerup pointercancel";function nt(){this.evEl=tt,this.evWin=et,V.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}
e.MSPointerEvent&&!e.PointerEvent&&(tt="MSPointerDown",et="MSPointerMove MSPointerUp MSPointerCancel"),_(nt,V,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),o=Q[i],r=J[t.pointerType]||t.pointerType,s=r==I,a=N(e,t.pointerId,"pointerId");1&o&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):12&o&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,o,{pointers:e,changedPointers:[t],pointerType:r,srcEvent:t}),n&&e.splice(a,1))}});var it={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ot="touchstart",rt="touchstart touchmove touchend touchcancel";function st(){this.evTarget=ot,this.evWin=rt,this.started=!1,V.apply(this,arguments)}function at(t,e){var n=A(t.touches),i=A(t.changedTouches);return 12&e&&(n=R(n.concat(i),"identifier",!0)),[n,i]}_(st,V,{handler:function(t){var e=it[t.type];if(1===e&&(this.started=!0),this.started){var n=at.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:I,
srcEvent:t})}}});var lt={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ct="touchstart touchmove touchend touchcancel";function ht(){this.evTarget=ct,this.targetIds={},V.apply(this,arguments)}function ut(t,e){var n=A(t.touches),i=this.targetIds;if(3&e&&1===n.length)return i[n[0].identifier]=!0,[n,n];var o,r,s=A(t.changedTouches),a=[],l=this.target;if(r=n.filter((function(t){return C(t.target,l)})),1===e)for(o=0;o<r.length;)i[r[o].identifier]=!0,o++;for(o=0;o<s.length;)i[s[o].identifier]&&a.push(s[o]),12&e&&delete i[s[o].identifier],o++;return a.length?[R(r.concat(a),"identifier",!0),a]:void 0}_(ht,V,{handler:function(t){var e=lt[t.type],n=ut.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:I,srcEvent:t})}});function dt(){V.apply(this,arguments);var t=v(this.handler,this);this.touch=new ht(this.manager,t),this.mouse=new K(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function ft(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,
pt.call(this,e)):12&t&&pt.call(this,e)}function pt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout((function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)}),2500)}}function mt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var o=this.lastTouches[i],r=Math.abs(e-o.x),s=Math.abs(n-o.y);if(r<=25&&s<=25)return!0}return!1}_(dt,V,{handler:function(t,e,n){var i=n.pointerType==I,o=n.pointerType==F;if(!(o&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)ft.call(this,e,n);else if(o&&mt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var gt=k(a.style,"touchAction"),_t=gt!==o,vt="compute",bt="auto",yt="manipulation",wt="none",xt="pan-x",Ct="pan-y",St=function(){if(!_t)return!1;var t={},n=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(i){
t[i]=!n||e.CSS.supports("touch-action",i)})),t}();function Et(t,e){this.manager=t,this.set(e)}Et.prototype={set:function(t){t==vt&&(t=this.compute()),_t&&this.manager.element.style&&St[t]&&(this.manager.element.style[gt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return f(this.manager.recognizers,(function(e){b(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(S(t,wt))return wt;var e=S(t,xt),n=S(t,Ct);if(e&&n)return wt;if(e||n)return e?xt:Ct;if(S(t,yt))return yt;return bt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,o=S(i,wt)&&!St.none,r=S(i,Ct)&&!St["pan-y"],s=S(i,xt)&&!St["pan-x"];if(o){var a=1===t.pointers.length,l=t.distance<2,c=t.deltaTime<250;if(a&&l&&c)return}if(!s||!r)return o||r&&6&n||s&&n&D?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,
t.preventDefault()}};var Nt=32;function At(t){this.options=r({},this.defaults,t||{}),this.id=T++,this.manager=null,this.options.enable=y(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Rt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function kt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function Tt(t,e){var n=e.manager;return n?n.get(t):t}function Pt(){At.apply(this,arguments)}function Ot(){Pt.apply(this,arguments),this.pX=null,this.pY=null}function Lt(){Pt.apply(this,arguments)}function Mt(){At.apply(this,arguments),this._timer=null,this._input=null}function It(){Pt.apply(this,arguments)}function Ft(){Pt.apply(this,arguments)}function Dt(){At.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Bt(t,e){return(e=e||{}).recognizers=y(e.recognizers,Bt.defaults.preset),new Ht(t,e)}At.prototype={defaults:{},set:function(t){return r(this.options,t),
this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(d(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Tt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return d(t,"dropRecognizeWith",this)||(t=Tt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(d(t,"requireFailure",this))return this;var e=this.requireFail;return-1===N(e,t=Tt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(d(t,"dropRequireFailure",this))return this;t=Tt(t,this);var e=N(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function i(n){e.manager.emit(n,t)}n<8&&i(e.options.event+Rt(n)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),n>=8&&i(e.options.event+Rt(n))},tryEmit:function(t){
if(this.canEmit())return this.emit(t);this.state=Nt},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=r({},t);if(!b(this.options.enable,[this,e]))return this.reset(),void(this.state=Nt);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},_(Pt,At,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=6&e,o=this.attrTest(t);return i&&(8&n||!o)?16|e:i||o?4&n?8|e:2&e?4|e:2:Nt}}),_(Ot,Pt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(Ct),t&D&&e.push(xt),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,o=t.direction,r=t.deltaX,s=t.deltaY;return o&e.direction||(6&e.direction?(o=0===r?1:r<0?2:4,
n=r!=this.pX,i=Math.abs(t.deltaX)):(o=0===s?1:s<0?8:16,n=s!=this.pY,i=Math.abs(t.deltaY))),t.direction=o,n&&i>e.threshold&&o&e.direction},attrTest:function(t){return Pt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=kt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),_(Lt,Pt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[wt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),_(Mt,At,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[bt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,o=t.deltaTime>e.time;if(this._input=t,
!i||!n||12&t.eventType&&!o)this.reset();else if(1&t.eventType)this.reset(),this._timer=u((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return Nt},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=h(),this.manager.emit(this.options.event,this._input)))}}),_(It,Pt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[wt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),_(Ft,Pt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Ot.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:n&D&&(e=t.overallVelocityY),
this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&c(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=kt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),_(Dt,At,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[yt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,o=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(i&&o&&n){if(4!=t.eventType)return this.failTimeout();var r=!this.pTime||t.timeStamp-this.pTime<e.interval,s=!this.pCenter||j(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,s&&r?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=u((function(){this.state=8,this.tryEmit()}),e.interval,this),
2):8}return Nt},failTimeout:function(){return this._timer=u((function(){this.state=Nt}),this.options.interval,this),Nt},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Bt.VERSION="2.0.7",Bt.defaults={domEvents:!1,touchAction:vt,enable:!0,inputTarget:null,inputClass:null,preset:[[It,{enable:!1}],[Lt,{enable:!1},["rotate"]],[Ft,{direction:6}],[Ot,{direction:6},["swipe"]],[Dt],[Dt,{event:"doubletap",taps:2},["tap"]],[Mt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ht(t,e){var n;this.options=r({},Bt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this).options.inputClass||(L?nt:M?ht:O?dt:K))(n,U),this.touchAction=new Et(this,this.options.touchAction),Vt(this,!0),
f(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Vt(t,e){var n,i=t.element;i.style&&(f(t.options.cssProps,(function(o,r){n=k(i.style,r),e?(t.oldCssProps[n]=i.style[n],i.style[n]=o):i.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}Ht.prototype={set:function(t){return r(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var i=this.recognizers,o=e.curRecognizer;(!o||o&&8&o.state)&&(o=e.curRecognizer=null);for(var r=0;r<i.length;)n=i[r],2===e.stopped||o&&n!=o&&!n.canRecognizeWith(o)?n.reset():n.recognize(t),!o&&14&n.state&&(o=e.curRecognizer=n),r++}},get:function(t){if(t instanceof At)return t
;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(d(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(d(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=N(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==o&&e!==o){var n=this.handlers;return f(E(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==o){var n=this.handlers;return f(E(t),(function(t){e?n[t]&&n[t].splice(N(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var i=n.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var o=0;o<i.length;)i[o](e),o++}},destroy:function(){
this.element&&Vt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},r(Bt,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Nt,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:D,DIRECTION_ALL:30,Manager:Ht,Input:V,TouchAction:Et,TouchInput:ht,MouseInput:K,PointerEventInput:nt,TouchMouseInput:dt,SingleTouchInput:st,Recognizer:At,AttrRecognizer:Pt,Tap:Dt,Pan:Ot,Swipe:Ft,Pinch:Lt,Rotate:It,Press:Mt,on:w,off:x,each:f,merge:g,extend:m,assign:r,inherit:_,bindFn:v,prefixed:k}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=Bt,t.exports?t.exports=Bt:e.Hammer=Bt}(window,document)}(Ho);function Vo({above:t,below:e,buckets:n,onFocusAnnotations:i,onScrollToClosestOffScreenAnchor:o,onSelectAnnotations:r}){const s=t.tags.size>0,a=e.tags.size>0;return Wt("ul",{
className:be("absolute w-[23px] left-[-22px] h-full","bg-grey-2 sidebar-collapsed:bg-black/[.08]","pointer-events-none"),children:[s&&Wt("li",{className:"absolute right-0 pointer-events-auto mt-[-11px]",style:{top:t.position},children:Wt(Te,{"data-testid":"up-navigation-button",direction:"up",onClick:()=>o([...t.tags],"up"),onBlur:()=>i([]),onFocus:()=>i([...t.tags]),onMouseEnter:()=>i([...t.tags]),onMouseOut:()=>i([]),title:`Go up to next annotations (${t.tags.size})`,children:t.tags.size})}),n.map(((t,e)=>Wt("li",{className:"absolute right-0 pointer-events-auto mt-[-8px]",style:{top:t.position},children:Wt(Te,{direction:"left",onClick:e=>r([...t.tags],e.metaKey||e.ctrlKey),onBlur:()=>i([]),onFocus:()=>i([...t.tags]),onMouseEnter:()=>i([...t.tags]),onMouseOut:()=>i([]),title:`Select nearby annotations (${t.tags.size})`,children:t.tags.size})},e))),a&&Wt("li",{className:"absolute right-0 pointer-events-auto",style:{top:e.position},children:Wt(Te,{"data-testid":"down-navigation-button",direction:"down",
onClick:()=>o([...e.tags],"down"),onBlur:()=>i([]),onFocus:()=>i([...e.tags]),onMouseEnter:()=>i([...e.tags]),onMouseOut:()=>i([]),title:`Go up to next annotations (${e.tags.size})`,children:e.tags.size})})]})}class Uo{constructor(t,{onFocusAnnotations:n,onScrollToClosestOffScreenAnchor:i,onSelectAnnotations:o}){e(this,"_bucketsContainer",void 0),e(this,"_onFocusAnnotations",void 0),e(this,"_onScrollToClosestOffScreenAnchor",void 0),e(this,"_onSelectAnnotations",void 0),this._bucketsContainer=document.createElement("div"),t.appendChild(this._bucketsContainer),this._onFocusAnnotations=n,this._onScrollToClosestOffScreenAnchor=i,this._onSelectAnnotations=o,this.update([])}destroy(){ut(null,this._bucketsContainer),this._bucketsContainer.remove()}update(t){const e=function(t){const e=new Set,n=new Set,i=[];let o=null;function r({bottom:t,tag:e,top:n}){return{bottom:t,position:n+(t-n)/2,tags:new Set([e]),top:n}}return t.forEach((t=>{if(t.top<137)return void e.add(t.tag)
;if(t.top>window.innerHeight-22)return void n.add(t.tag);if(!o)return void(o=r(t));const s=t.top>o.top&&t.bottom<o.bottom;if(t.top-o.bottom>60&&!s)i.push(o),o=r(t);else{const e=t.bottom>o.bottom?t.bottom:o.bottom,n=e-o.top;o.tags.add(t.tag),o.bottom=e,o.position=o.top+n/2}})),o&&i.push(o),{above:{tags:e,position:137},below:{tags:n,position:window.innerHeight-22},buckets:i}}(t);ut(Wt(Vo,{above:e.above,below:e.below,buckets:e.buckets,onFocusAnnotations:t=>this._onFocusAnnotations(t),onScrollToClosestOffScreenAnchor:(t,e)=>this._onScrollToClosestOffScreenAnchor(t,e),onSelectAnnotations:(t,e)=>this._onSelectAnnotations(t,e)}),this._bucketsContainer)}}function qo({message:t,onDismiss:e}){const n="notice"!==t.type?`${t.type.charAt(0).toUpperCase()+t.type.slice(1)}: `:"";let i;switch(t.type){case"success":i=ie;break;case"error":i=Xt;break;default:i=ee}return Wt(ye,{classes:be("flex",{"sr-only":t.visuallyHidden,"border-red-error":"error"===t.type,"border-yellow-notice":"notice"===t.type,
"border-green-success":"success"===t.type}),onClick:()=>e(t.id),children:[Wt("div",{className:be("flex items-center p-3 text-white",{"bg-red-error":"error"===t.type,"bg-yellow-notice":"notice"===t.type,"bg-green-success":"success"===t.type}),children:Wt(i,{className:be("mt-[2px]")})}),Wt("div",{className:"grow p-3","data-testid":"toast-message-text",children:[Wt("strong",{children:n}),t.message,t.moreInfoURL&&Wt("div",{className:"text-right",children:Wt(ke,{href:t.moreInfoURL,onClick:t=>t.stopPropagation(),target:"_new",children:"More info"})})]})]})}function Wo({messages:t,onMessageDismiss:e}){return Wt("div",{children:Wt("ul",{"aria-live":"polite","aria-relevant":"additions",className:"absolute z-2 left-0 w-full",children:t.map((t=>Wt("li",{className:be("relative w-full container hover:cursor-pointer",{"mb-2":!t.visuallyHidden,"motion-safe:animate-slide-in-from-right lg:animate-fade-in":!t.isDismissed,"motion-reduce:animate-fade-in":!t.isDismissed,"animate-fade-out":t.isDismissed}),children:Wt(qo,{
message:t,onDismiss:e})},t.id)))})})}function zo({emitter:t}){const[e,n]=Nt([]),i=Tt((t=>n((e=>[...e,t]))),[]),o=Tt((t=>n((e=>e.filter((e=>e.id!==t))))),[]);return At((()=>(t.subscribe("toastMessageAdded",i),t.subscribe("toastMessageDismissed",o),()=>{t.unsubscribe("toastMessageAdded",i),t.unsubscribe("toastMessageDismissed",o)})),[t,o,i]),Wt(Wo,{messages:e,onMessageDismiss:o})}function $o({icon:t,...e}){return Wt(xe,{classes:be("w-[30px] h-[30px]","rounded-px","flex items-center justify-center","border bg-white text-grey-6 hover:text-grey-9","shadow transition-colors"),...e,children:Wt(t,{})})}function jo({highlightsVisible:t}){return Wt("div",{className:"sr-only",role:"status","data-testid":"toolbar-status",children:t?"Highlights visible":"Highlights hidden"})}function Xo({closeSidebar:t,createAnnotation:e,isSidebarOpen:n,newAnnotationType:i,showHighlights:o,toggleHighlights:r,toggleSidebar:s,toggleSidebarRef:a,useMinimalControls:l=!1}){return Wt("div",{
className:be("absolute left-[-33px] w-[33px] z-2","text-px-base leading-none"),children:[l&&n&&Wt(xe,{classes:be("w-[27px] h-[27px] mt-[140px] ml-px-1.5","flex items-center justify-center bg-white border","text-grey-6 hover:text-grey-9 transition-colors","border-r-0","shadow-sidebar"),title:"Close annotation sidebar",onClick:t,children:Wt(Xt,{})}),!l&&Wt($,{children:[Wt(xe,{classes:be("h-[40px] w-[33px] pl-[6px]","bg-white text-grey-5 hover:text-grey-9","border-l border-b"),elementRef:a,title:"Annotation sidebar",expanded:n,pressed:n,onClick:s,children:Wt(n?Jt:Kt,{})}),Wt("div",{className:"space-y-px-1.5 mt-px-2",children:[Wt($o,{title:"Show highlights",icon:o?me:re,selected:o,onClick:r}),Wt($o,{title:"note"===i?"New page note":"New annotation",icon:"note"===i?ce:$t,onClick:e})]}),Wt(jo,{highlightsVisible:o})]})]})}class Yo{constructor(t,n){e(this,"_container",void 0),e(this,"_newAnnotationType",void 0),e(this,"_useMinimalControls",void 0),e(this,"_highlightsVisible",void 0),e(this,"_sidebarOpen",void 0),
e(this,"_closeSidebar",void 0),e(this,"_toggleSidebar",void 0),e(this,"_toggleHighlights",void 0),e(this,"_createAnnotation",void 0),e(this,"_sidebarToggleButton",void 0);const{createAnnotation:i,setSidebarOpen:o,setHighlightsVisible:r}=n;this._container=t,this._useMinimalControls=!1,this._newAnnotationType="note",this._highlightsVisible=!1,this._sidebarOpen=!1,this._closeSidebar=()=>o(!1),this._toggleSidebar=()=>o(!this._sidebarOpen),this._toggleHighlights=()=>r(!this._highlightsVisible),this._createAnnotation=()=>{i(),o(!0)},this._sidebarToggleButton={current:null},this.render()}getWidth(){return this._container.firstChild.getBoundingClientRect().width}set useMinimalControls(t){this._useMinimalControls=t,this.render()}get useMinimalControls(){return this._useMinimalControls}set sidebarOpen(t){this._sidebarOpen=t,this.render()}get sidebarOpen(){return this._sidebarOpen}set newAnnotationType(t){this._newAnnotationType=t,this.render()}get newAnnotationType(){return this._newAnnotationType}
set highlightsVisible(t){this._highlightsVisible=t,this.render()}get highlightsVisible(){return this._highlightsVisible}get sidebarToggleButton(){return this._sidebarToggleButton.current}render(){ut(Wt(Xo,{closeSidebar:this._closeSidebar,createAnnotation:this._createAnnotation,newAnnotationType:this._newAnnotationType,isSidebarOpen:this._sidebarOpen,showHighlights:this._highlightsVisible,toggleHighlights:this._toggleHighlights,toggleSidebar:this._toggleSidebar,toggleSidebarRef:this._sidebarToggleButton,useMinimalControls:this.useMinimalControls}),this._container)}}const Zo=280;class Go{constructor(t,i,o){if(e(this,"_emitter",void 0),e(this,"_config",void 0),e(this,"_listeners",void 0),e(this,"_gestureState",void 0),e(this,"_layoutState",void 0),e(this,"_hammerManager",void 0),e(this,"_hypothesisSidebar",void 0),e(this,"_messagesElement",void 0),e(this,"_toolbarWidth",void 0),e(this,"_renderFrame",void 0),e(this,"_guestWithSelection",void 0),e(this,"_sidebarRPC",void 0),e(this,"_guestRPC",void 0),
e(this,"bucketBar",void 0),e(this,"features",void 0),e(this,"externalFrame",void 0),e(this,"iframeContainer",void 0),e(this,"toolbar",void 0),e(this,"onLoginRequest",void 0),e(this,"onLogoutRequest",void 0),e(this,"onSignupRequest",void 0),e(this,"onProfileRequest",void 0),e(this,"onHelpRequest",void 0),e(this,"onLayoutChange",void 0),e(this,"iframe",void 0),this._emitter=i.createEmitter(),this._guestWithSelection=null,this._guestRPC=[],this._sidebarRPC=new w,this.iframe=function(t){const e=t.sidebarAppUrl,n=Po(e,Oo(e,t)),i=document.createElement("iframe");return i.setAttribute("allowfullscreen",""),i.src=n,i.title="Hypothesis annotation viewer",i.className="sidebar-frame",i}(o),this._config=o,this.bucketBar=null,this.features=new yn,o.externalContainerSelector){var r;this.externalFrame=null!==(r=document.querySelector(o.externalContainerSelector))&&void 0!==r?r:t,this.externalFrame.appendChild(this.iframe)}else{this.iframeContainer=document.createElement("div"),this.iframeContainer.style.display="none",
this.iframeContainer.className="sidebar-container","clean"===o.theme?this.iframeContainer.classList.add("theme-clean"):this.bucketBar=new Uo(this.iframeContainer,{onFocusAnnotations:t=>this._guestRPC.forEach((e=>e.call("hoverAnnotations",t))),onScrollToClosestOffScreenAnchor:(t,e)=>this._guestRPC.forEach((n=>n.call("scrollToClosestOffScreenAnchor",t,e))),onSelectAnnotations:(t,e)=>this._guestRPC.forEach((n=>n.call("selectAnnotations",t,e)))}),this.iframeContainer.appendChild(this.iframe),this._hypothesisSidebar=document.createElement("hypothesis-sidebar");const e=Fe(this._hypothesisSidebar);e.appendChild(this.iframeContainer),t.appendChild(this._hypothesisSidebar),this._messagesElement=document.createElement("div"),e.appendChild(this._messagesElement),ut(Wt(zo,{emitter:this._emitter}),this._messagesElement)}this.iframe.contentWindow&&m(this.iframe.contentWindow),this._listeners=new n;const s=document.createElement("div");this.toolbar=new Yo(s,{createAnnotation:()=>{var t;if(0===this._guestRPC.length)return
;(null!==(t=this._guestWithSelection)&&void 0!==t?t:this._guestRPC[0]).call("createAnnotation")},setSidebarOpen:t=>t?this.open():this.close(),setHighlightsVisible:t=>this.setHighlightsVisible(t)}),"clean"===o.theme?this.toolbar.useMinimalControls=!0:this.toolbar.useMinimalControls=!1,this.iframeContainer?(this.iframeContainer.prepend(s),this._toolbarWidth=this.toolbar.getWidth()):this._toolbarWidth=0,this._listeners.add(window,"resize",(()=>this._onResize())),this._gestureState={initial:null,final:null},this._setupGestures(),this.close();const[a]=o.services||[];a&&(this.onLoginRequest=a.onLoginRequest,this.onLogoutRequest=a.onLogoutRequest,this.onSignupRequest=a.onSignupRequest,this.onProfileRequest=a.onProfileRequest,this.onHelpRequest=a.onHelpRequest),this.onLayoutChange=o.onLayoutChange,this._layoutState={expanded:!1,width:0,height:0,toolbarWidth:0},this._updateLayoutState(!1),this._setupSidebarEvents()}destroy(){var t,e;this._guestRPC.forEach((t=>t.destroy())),this._sidebarRPC.destroy(),
null===(t=this.bucketBar)||void 0===t||t.destroy(),this._listeners.removeAll(),null===(e=this._hammerManager)||void 0===e||e.destroy(),this._hypothesisSidebar?(ut(null,this._messagesElement),this._hypothesisSidebar.remove()):this.iframe.remove(),this._emitter.destroy(),m(null)}onFrameConnected(t,e){switch(t){case"guest":this._connectGuest(e);break;case"sidebar":this._sidebarRPC.connect(e)}}_connectGuest(t){const e=new w;e.on("textSelected",(()=>{this._guestWithSelection=e,this.toolbar.newAnnotationType="annotation",this._guestRPC.filter((t=>t!==e)).forEach((t=>t.call("clearSelection")))})),e.on("textUnselected",(()=>{this._guestWithSelection=null,this.toolbar.newAnnotationType="note",this._guestRPC.filter((t=>t!==e)).forEach((t=>t.call("clearSelection")))})),e.on("highlightsVisibleChanged",(t=>{this.setHighlightsVisible(t)}));const n=this.bucketBar;n&&e.on("anchorsChanged",(t=>{0===this._guestRPC.indexOf(e)&&n.update(t)})),e.on("close",(()=>{e.destroy(),
e===this._guestWithSelection&&(this._guestWithSelection=null),this._guestRPC=this._guestRPC.filter((t=>t!==e))})),e.connect(t),this._guestRPC.push(e),e.call("sidebarLayoutChanged",this._layoutState)}_setupSidebarEvents(){var t;t=document.body,this._sidebarRPC.on("publicAnnotationCountChanged",(function(e){const n=t.querySelectorAll("[data-hypothesis-annotation-count]");Array.from(n).forEach((t=>{t.textContent=e.toString()}))})),function(t,e){const n=t.querySelectorAll("[data-hypothesis-trigger]");Array.from(n).forEach((t=>{t.addEventListener("click",(t=>{e(),t.stopPropagation()}))}))}(document.body,(()=>this.open())),this._sidebarRPC.on("featureFlagsUpdated",(t=>this.features.update(t))),this._sidebarRPC.on("connect",(()=>{this.iframeContainer&&(this.iframeContainer.style.display="");const t="always"===this._config.showHighlights;this.setHighlightsVisible(t),(this._config.openSidebar||this._config.annotations||this._config.query||this._config.group)&&this.open()})),
this._sidebarRPC.on("showHighlights",(()=>this.setHighlightsVisible(!0))),this._sidebarRPC.on("openSidebar",(()=>this.open())),this._sidebarRPC.on("closeSidebar",(()=>this.close())),this._sidebarRPC.on("openNotebook",(t=>{this.hide(),this._emitter.publish("openNotebook",t)})),this._sidebarRPC.on("openProfile",(()=>{this.hide(),this._emitter.publish("openProfile")})),this._emitter.subscribe("closeProfile",(()=>{this.show()})),this._emitter.subscribe("closeNotebook",(()=>{this.show()})),this._sidebarRPC.on("toastMessageAdded",(t=>{this._emitter.publish("toastMessageAdded",t)})),this._sidebarRPC.on("toastMessageDismissed",(t=>{this._emitter.publish("toastMessageDismissed",t)}));[["loginRequested",this.onLoginRequest],["logoutRequested",this.onLogoutRequest],["signupRequested",this.onSignupRequest],["profileRequested",this.onProfileRequest],["helpRequested",this.onHelpRequest]].forEach((([t,e])=>{e&&this._sidebarRPC.on(t,(()=>e()))}))}_resetGestureState(){this._gestureState={initial:null,final:null}}
_setupGestures(){const t=this.toolbar.sidebarToggleButton;t&&(this._hammerManager=new Bo.Manager(t),this._hammerManager.on("panstart panend panleft panright",(t=>this._onPan(t))),this._hammerManager.add(new Bo.Pan({direction:Bo.DIRECTION_HORIZONTAL})))}_updateLayout(){this._renderFrame||(this._renderFrame=requestAnimationFrame((()=>{if(this._renderFrame=void 0,this._gestureState.final!==this._gestureState.initial&&this.iframeContainer){const t=this._gestureState.final,e=-t;this.iframeContainer.style.marginLeft=`${t}px`,e>=Zo&&(this.iframeContainer.style.width=`${e}px`),this._updateLayoutState()}})))}_updateLayoutState(t){var e,n;const i=this.iframeContainer&&this.toolbar.getWidth()||0,o=null!==(e=this.iframeContainer)&&void 0!==e?e:this.externalFrame,{height:r}=o.getBoundingClientRect(),s=window.getComputedStyle(o),a=parseInt(s.width),l=parseInt(s.marginLeft);let c=i;"boolean"==typeof t?t&&(c+=a):(l<Zo?c-=l:c+=a,t=c>i);const h={expanded:t,width:t?c:i,height:r,toolbarWidth:i};this._layoutState=h,
null===(n=this.onLayoutChange)||void 0===n||n.call(this,h),this._guestRPC.forEach((t=>t.call("sidebarLayoutChanged",h)))}_onResize(){!0===this.toolbar.sidebarOpen&&(window.innerWidth<Zo?this.close():this.open())}_onPan(t){const e=this.iframeContainer;if(e)switch(t.type){case"panstart":this._resetGestureState(),e.classList.add("sidebar-no-transition"),e.style.pointerEvents="none",this._gestureState.initial=parseInt(getComputedStyle(e).marginLeft);break;case"panend":e.classList.remove("sidebar-no-transition"),e.style.pointerEvents="",null===this._gestureState.final||this._gestureState.final<=-280?this.open():this.close(),this._resetGestureState();break;case"panleft":case"panright":{if("number"!=typeof this._gestureState.initial)return;const e=this._gestureState.initial,n=t.deltaX;this._gestureState.final=Math.min(Math.round(e+n),0),this._updateLayout();break}}}open(){if(this._sidebarRPC.call("sidebarOpened"),this.iframeContainer){const t=this.iframeContainer.getBoundingClientRect().width
;this.iframeContainer.style.marginLeft=-1*t+"px",this.iframeContainer.classList.remove("sidebar-collapsed")}this.toolbar.sidebarOpen=!0,"whenSidebarOpen"===this._config.showHighlights&&this.setHighlightsVisible(!0),this._updateLayoutState(!0)}close(){this._sidebarRPC.call("sidebarClosed"),this.iframeContainer&&(this.iframeContainer.style.marginLeft="",this.iframeContainer.classList.add("sidebar-collapsed")),this.toolbar.sidebarOpen=!1,"whenSidebarOpen"===this._config.showHighlights&&this.setHighlightsVisible(!1),this._updateLayoutState(!1)}setHighlightsVisible(t){this.toolbar.highlightsVisible=t,this._sidebarRPC.call("setHighlightsVisible",t)}show(){var t;null===(t=this.iframeContainer)||void 0===t||t.classList.remove("is-hidden")}hide(){var t;null===(t=this.iframeContainer)||void 0===t||t.classList.add("is-hidden")}}class Ko{constructor(t){this._emitter=t,this._subscriptions=[]}publish(t,...e){this._emitter.emit(t,...e)}subscribe(t,e){this._emitter.on(t,e),this._subscriptions.push([t,e])}unsubscribe(t,e){
this._emitter.off(t,e),this._subscriptions=this._subscriptions.filter((([n,i])=>n!==t||i!==e))}destroy(){for(let[t,e]of this._subscriptions)this._emitter.off(t,e);this._subscriptions=[]}}class Qo{constructor(){this._emitter=new u}createEmitter(){return new Ko(this._emitter)}}const Jo=document.querySelector('link[type="application/annotator+html"][rel="sidebar"]');new Promise((t=>{"loading"!==document.readyState&&t(),document.addEventListener("readystatechange",(()=>t()))})).then((function(){const t=T("annotator");let e=()=>{};const n=new Promise((t=>{e=t}));Jo.addEventListener("destroy",e);const i=t.subFrameIdentifier?window.parent:window,o=[];if(i===window){const t=function(t=navigator.userAgent){if(!y(t))return()=>{};const e=t=>{var e;if("hypothesisPortClosed"===(null===(e=t.data)||void 0===e?void 0:e.type)&&t.ports[0]){const e=t.ports[0];b(e,"close"),e.close()}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)}();o.push({destroy:t})
;const e=T("sidebar"),n=new URL(e.sidebarAppUrl).origin,i=new g(n),r=new Qo,s=new Go(document.body,r,e),a=new Io(document.body,r,T("notebook")),l=new Do(document.body,r,T("profile"));i.on("frameConnected",((t,e)=>s.onFrameConnected(t,e))),o.push(i,s,a,l)}if("container"===bo()){const e=new yo(t);o.push(e)}else{const n=new mo(document.body,t),r=new To(document.body,t,i);r.on("hostDisconnected",e),o.push(n,r)}n.then((()=>{o.forEach((t=>t.destroy()));document.querySelectorAll("[data-hypothesis-asset]").forEach((t=>t.remove())),function(t=document){Array.from(t.querySelectorAll("script.js-hypothesis-config[data-remove-on-unload]")).forEach((t=>t.remove()))}()}))}))}();
//# sourceMappingURL=annotator.bundle.js.map
