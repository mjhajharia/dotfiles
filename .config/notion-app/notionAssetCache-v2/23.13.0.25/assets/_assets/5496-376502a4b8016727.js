"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5496],{79698:(e,t,o)=>{o.d(t,{j:()=>p});var i=o(68939),s=o(14542),n=o(96809),r=o(47307),a=o(96802),l=o(27153),d=o(39699),h=o(53471);const g=(0,i.defineMessages)({pageCover:{defaultMessage:"Page cover",id:"pageCover.title"},fileTypeCaption:{defaultMessage:"Images wider than {idealImageWidth} pixels work best.",id:"pageCover.fileType.caption"},uploadFailed:{defaultMessage:"Upload failed",id:"pageCover.errorDialogMessage.uploadFailed"},embedTitle:{defaultMessage:"Link",id:"pageCover.embedType.title"},embedPlaceholder:{defaultMessage:"Paste an image linkâ€¦",id:"pageCover.embedType.placeholder"},embedCaption:{defaultMessage:"Works with any image from the web.",id:"pageCover.embedType.caption"},embedSubmit:{defaultMessage:"Submit",id:"pageCover.embedType.buttonText"}});function p(e){let{environment:t,intl:o,store:i,rect:s}=e;l.$(t,{originGap:3,originRect:s,isSmallWidth:!1,popupWidth:540,maxHeight:485,title:o.formatMessage(g.pageCover),onDelete:()=>{!function(e){let{environment:t,store:o}=e;l.Z(),d.createAndCommit({userAction:"PageCover.handleDelete",environment:t,perform:e=>{a.MF({store:o,transaction:e})}})}({environment:t,store:i})},currentTab:"gallery",tabs:[{type:"gallery",onChange:e=>{let{url:o,position:s}=e;u({environment:t,store:i,url:o,position:s})}},{type:"file",fileUpload:!1,imageUpload:!0,videoUpload:!1,caption:o.formatMessage(g.fileTypeCaption,{idealImageWidth:1500}),onUpload:e=>{l.Z(),h.cT({environment:t,file:e,bucket:"secure",record:i.pointer,onStart:m,onProgress:v,onComplete:e=>{var o;o={environment:t,store:i,url:e},c({...o,position:.5})},onError:()=>{r.showErrorMessage(o.formatMessage(g.uploadFailed))}})}},{type:"embed",title:o.formatMessage(g.embedTitle),inputPlaceholder:o.formatMessage(g.embedPlaceholder),caption:o.formatMessage(g.embedCaption),buttonText:o.formatMessage(g.embedSubmit),onChange:e=>{var o;o={environment:t,store:i,url:e},c({...o,position:.5}),l.Z()}},{type:"unsplash",onChange:e=>{let{url:o,position:s}=e;u({environment:t,store:i,url:o,position:s})}}]})}async function c(e){const{environment:t,store:o,url:i,position:r}=e,{serverCommitResult:l}=d.createAndCommit({userAction:"PageCover.updatePageCover",environment:t,perform:e=>{a.fs({store:o,url:i,position:r||.5,transaction:e})}});await l,n.Z.state.loadingMode===s.NS&&n.Z.setState({loadingMode:s.EP,dataURL:n.Z.state.dataURL,uploadProgress:100})}function u(e){c(e),e.environment.device.isMobile&&l.Z()}function m(e){const{file:t,name:o,size:i}=e;if(l.Z(),n.Z.setState({loadingMode:s.SS,file:t,name:o,size:i}),t.type.indexOf("image")>=0){const e=new FileReader;e.onload=e=>{n.Z.state.loadingMode===s.SS&&n.Z.setState({...n.Z.state,uploadProgress:0,loadingMode:s.NS,dataURL:e.target.result})},e.readAsDataURL(t)}}function v(e){const{progressPercent:t}=e;n.Z.state.loadingMode===s.NS&&n.Z.setState({...n.Z.state,uploadProgress:t})}},87636:(e,t,o)=>{o.d(t,{Z:()=>v});var i=o(67294),s=o(13991),n=o(480),r=o(24405),a=o(22491),l=o(97880),d=o(82990),h=o(17311),g=o(23063),p=o(64921),c=o(26388),u=o(85893);function m(e){window.__c={n:"ActionMenuGroupButton"};const{button:t,isLast:o}=e,s=(0,r.yK)((e=>({button:{display:"flex",alignItems:"center",padding:"4px 6px",fontWeight:d.Z.fontWeight.medium,borderRight:`1px solid ${e.regularDividerColor}`,color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor},buttonLast:{borderRight:"none"},buttonHovered:{background:e.whiteButtonHoveredBackground},buttonPressed:{background:e.whiteButtonPressedBackground}})),[]);return i.cloneElement(t,{...(0,a.iv)(t.props.style,s.button,o&&s.buttonLast),hoveredStyle:(0,a.iv)(s.buttonHovered,o&&s.buttonLast).style,pressedStyle:s.buttonPressed})}const v=function(e){let{children:t,isVisible:o,position:v,style:S}=e;window.__c={n:"ActionMenuGroup"};const C=(0,n.O7)(),f=(0,r.yK)((e=>({container:{color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor,fontSize:12,background:e.whiteButtonBackground,boxShadow:e.lightBoxShadow,display:"flex",whiteSpace:"nowrap",borderRadius:h.Z.borderRadius,maxWidth:"calc(100% - 16px)",minHeight:24,overflow:"hidden",pointerEvents:C.device.isMobile?"auto":"none",opacity:C.device.isMobile?1:0,fontFamily:d.Z.getCompositeFontFamily(s.SP).sans,position:"absolute",right:h.Z.horizontal.small,bottom:h.Z.vertical.small,zIndex:2},containerHover:{pointerEvents:"auto",opacity:1},containerTop:{top:h.Z.vertical.small,bottom:void 0}})),[C]),M=i.Children.toArray(t).filter(l.$K),b=M.length;return(0,u.jsx)(g.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>(0,u.jsx)("div",{...(0,a.iv)(f.container,S,o&&f.containerHover,"top"===v&&f.containerTop),children:M.map(((e,t)=>{const o=t===b-1;if(e&&"object"==typeof e&&"type"in e){if(e.type===c.Z&&i.isValidElement(e))return i.cloneElement(e,{render:(t,i)=>{const s=e.props.render(t,i);return(0,u.jsx)(m,{isLast:o,button:s},e.key)}});if(e.type===p.Z&&i.isValidElement(e))return(0,u.jsx)(m,{isLast:o,button:e},e.key)}}))})})}},65496:(e,t,o)=>{o.d(t,{Z:()=>x});var i=o(67294),s=o(83355),n=o(68939),r=o(96802),a=o(79698),l=o(39699),d=o(28651),h=o(94841),g=o(14542),p=o(96809),c=o(87636),u=o(23063),m=o(64921),v=o(12981),S=o(65107),C=o(68785),f=o(32854),M=o(81865),b=o(97496),y=o(56282),w=o(85893);class R extends s.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={mouseStore:d.Z},this.handleLoadComplete=()=>{p.Z.reset()},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:i,handleRepositionClick:s,handleSavePositionClick:r}=e;if(this.props.disabled||p.Z.state.loadingMode!==g.LU)return;const{device:a}=this.environment,{isMobile:l}=a;return(0,w.jsx)(u.Z,{isVisible:!0,animationStyle:{width:P(this.props.store),opacity:t?1:0},render:()=>(0,w.jsx)("div",{style:{position:"absolute",pointerEvents:t?"auto":"none",maxWidth:"100%",top:48},children:(0,w.jsxs)(c.Z,{isVisible:t,position:"bottom",style:{marginRight:this.props.paddingRight,marginLeft:this.props.paddingLeft},children:[!o&&(0,w.jsx)(m.Z,{style:{borderRight:l?"none":void 0,...b.ar},onClick:this.handleChangeCoverClick,children:(0,w.jsx)(n.FormattedMessage,{defaultMessage:"Change cover",id:"pageCover.changeCover.text"})}),!o&&!l&&(0,w.jsx)(m.Z,{style:{...b.ar,borderRight:"none"},onClick:e=>s(e,this.lastProxiedUrl),children:(0,w.jsx)(n.FormattedMessage,{defaultMessage:"Reposition",id:"pageCover.reposition.text"})}),o&&!l&&(0,w.jsx)(m.Z,{style:b.ar,onClick:r,children:(0,w.jsx)(n.FormattedMessage,{defaultMessage:"Save position",id:"pageCover.savePosition.text"})}),o&&!l&&(0,w.jsx)(m.Z,{style:{...b.ar,borderRight:"none"},onClick:i,children:(0,w.jsx)(n.FormattedMessage,{defaultMessage:"Cancel",id:"pageCover.reposition.cancelText"})})]})})})},this.handleFlushTemporaryPosition=e=>{let{imagePosition:t,reset:o}=e;l.createAndCommit({userAction:"PageCover.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{r.Mp({store:this.props.store,coverPosition:t,transaction:e}),o()}})},this.handleChangeCoverClick=e=>{const{intl:t,store:o}=this.props;this.stores.mouseStore.reset();const i=e.target.getBoundingClientRect();a.j({environment:this.environment,intl:t,store:o,rect:i})},this.coverWithRecordStore=this.createComputedStore((()=>this.props.store.getCover()),!0),this.isPersonalHome=this.createComputedStore((()=>(0,h.WE)(this.props.store)))}renderComponent(){const e=this.coverWithRecordStore.getState();if(!e)return;const t=p.Z.state,o=t.loadingMode!==g.LU&&t.loadingMode!==g.SS;return(0,w.jsx)(y.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:this.handleFlushTemporaryPosition,renderControl:this.renderControl,source:"page",store:this.props.store,style:{display:"flex",flexDirection:"column",alignItems:"center",height:this.props.height,cursor:"default"},dragMessageContainerStyle:this.isPersonalHome.state?{top:56}:void 0,render:s=>(0,w.jsxs)(i.Fragment,{children:[(0,w.jsx)(M.Z,{url:e.cover,isAuthenticated:!0,permissionRecord:e.pointer,width:this.props.proxyWidth,render:(e,i)=>{this.lastProxiedUrl=i;const n={width:"100%",height:this.props.height,objectFit:"cover",opacity:o?.5:1,objectPosition:`center ${100*(1-(s.imagePosition||0))}%`,borderRadius:0},r={width:"100%",height:this.props.height};return(0,w.jsx)(S.B,{src:i,placeholderSrc:o?t.dataURL:void 0,placeholderBehavior:o?"force-show-placeholder":"show-placeholder-if-loading-src",containerStyle:r,imageStyle:n,onLoadComplete:this.handleLoadComplete})}}),o&&(0,w.jsxs)("div",{style:v.Z.loadingContainerStyle,children:[(0,w.jsx)(C.Z,{style:{width:16,height:16,marginRight:4}}),(0,w.jsx)("div",{style:{minWidth:30,textAlign:"right"},children:(0,w.jsx)(f.Z,{percentage:t.uploadProgress})})]})]})})}}R.displayName="PageCover";const x=(0,n.injectIntl)(R);function P(e){let t;return t=!!e.isFullWidth()?"100%":900,t}},56282:(e,t,o)=>{o.d(t,{Z:()=>R});o(67294);var i=o(73935),s=o(83355),n=o(13991),r=o(6740),a=o(49085),l=o(12137),d=o(8848),h=o(22491),g=o(72126),p=o(82990),c=o(63143),u=o(68939),m=o(24677),v=o(28651),S=o(27724);class C extends a.default{getInitialState(){return{showFadeInAnimation:!1,isRepositioning:!1}}}const f=C;var M=o(23063),b=o(6685),y=o(85893);class w extends s.Z{constructor(){super(...arguments),this.storeTypes={focusStore:a.default.createClass(!1),mouseStore:v.Z,withImageRepositioningStore:f},this.renderDraggable=()=>(0,y.jsx)(b.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disabled:!this.isRepositioning(),render:e=>(0,y.jsx)("div",{...(0,h.iv)(this.getDragContainerStyle()),...e,children:this.props.render({imagePosition:this.getRenderedCoverPosition(),isRepositioning:this.isRepositioning(),showFadeInAnimation:!1})})}),this.shouldBeActiveStore=this.createComputedStore((()=>0===S.default.state.stores.length)),this.handleFocus=e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,r.E)(t)&&this.stores.focusStore.setState(!0)},this.handleBlur=e=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=e=>{this.mouseStore.setState({...this.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=e=>{this.mouseStore.setState({...this.mouseStore.state,mouseEntered:!1})},this.handleMouseMoveThrottled=(0,g.P2)(this.handleMouseMove,100),this.handleMouseLeaveDebounced=(0,g.Ds)(this.handleMouseLeave,100),this.handleWindowMouseDown=e=>{const t=i.findDOMNode(this);t&&!t.contains(e.target)&&this.isRepositioning()&&this.props.onFlushTemporaryPosition({imagePosition:this.getRenderedCoverPosition(),reset:()=>{this.mouseStore.reset(),this.stores.withImageRepositioningStore.reset()}})},this.handleRepositionClick=(e,t)=>{m.ZH(this.environment);const o=new Image;o.onload=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,isRepositioning:!0,image:o})},t&&(o.src=t)},this.handleCancelClick=e=>{this.stores.withImageRepositioningStore.reset()},this.handleSavePositionClick=e=>{this.props.onFlushTemporaryPosition({imagePosition:this.getRenderedCoverPosition(),reset:()=>{this.stores.withImageRepositioningStore.reset()}})},this.handleDragStart=e=>{const t=this.isRepositioning(),{image:o}=this.stores.withImageRepositioningStore.state;if(o&&t){const e=i.findDOMNode(this);if(e&&e instanceof Element){const t=e.getBoundingClientRect().width/o.width*o.height,i=this.getRenderedCoverPosition();this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:t,startDragRenderedPosition:i})}}},this.handleDragMove=e=>{if(this.isRepositioning()){const{startDragRenderedPosition:t,startDragImageScreenHeight:o}=this.stores.withImageRepositioningStore.state,i=e.diffY/(o||0)+(t||0);this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,temporaryPosition:(0,g.NM)((0,l.Z)(i,0,1),4)})}},this.handleDragEnd=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})},this.handleDragCancel=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})}}didMount(){super.didMount(),window.addEventListener("mousedown",this.handleWindowMouseDown)}willUnmount(){super.willUnmount(),window.removeEventListener("mousedown",this.handleWindowMouseDown)}UNSAFE_willMountOrUpdate(){this.isRepositioning()&&!this.shouldBeActiveStore.state&&this.stores.withImageRepositioningStore.reset()}renderComponent(){const{device:e}=this.environment,{style:t}=this.props,{isMobile:o}=e,i=this.isRepositioning(),{mouseEntered:s}=this.mouseStore.state,n=this.stores.focusStore.state;return(0,y.jsxs)("div",{onFocus:this.handleFocus,onBlur:this.handleBlur,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,...(0,h.iv)({position:"relative",width:"100%"},t),children:[this.renderDraggable(),this.renderDragMessage(),this.props.renderControl({handleRepositionClick:this.handleRepositionClick,handleSavePositionClick:this.handleSavePositionClick,handleCancelClick:this.handleCancelClick,isVisible:o||s||n||i,isRepositioning:i})]})}renderDragMessage(){const{isRepositioning:e}=this.stores.withImageRepositioningStore.state;if(!this.props.small)return(0,y.jsx)(M.Z,{isVisible:!0,animationStyle:{opacity:e?1:0},render:()=>{return(0,y.jsx)("div",{...(0,h.iv)((t=this.props.dragMessageContainerStyle,{background:d.ZP.blackWithAlpha(.4),borderRadius:4,color:d.ZP.white,fontSize:12,fontFamily:p.Z.getCompositeFontFamily(n.SP).sans,width:180,left:"calc(50% - 90px)",padding:"0.3em 1.5em 0.3em",pointerEvents:"none",position:"absolute",top:"calc(50% - 10px)",textAlign:"center",...t??{}})),"aria-hidden":!e,children:(0,y.jsx)(u.FormattedMessage,{defaultMessage:"Drag image to reposition",id:"withImageRepositioning.dragImage.text"})});var t}})}isRepositioning(){return this.stores.withImageRepositioningStore.state.isRepositioning}getRenderedCoverPosition(){const{temporaryPosition:e}=this.stores.withImageRepositioningStore.state;return(0,g.hj)(e)?e:function(e,t){if("gallery"===e||"board"===e){const e=t.getFormat().card_cover_position;if((0,g.hj)(e))return e}const o=.5;if(t.isCollectionView()){const e=t.getCollectionViewCollectionStore();if(e){const t=e.getFormat().collection_cover_position;return(0,c.z4)(t)?o:t}}const i=t.getFormat().page_cover_position;if((0,g.hj)(i))return i;return o}(this.props.source,this.props.store)}get mouseStore(){return this.props.mouseStore||this.stores.mouseStore}getDragContainerStyle(){return{width:"100%",cursor:this.isRepositioning()?"move":"inherit"}}}w.displayName="WithImageRepositioning";const R=w},14542:(e,t,o)=>{o.d(t,{EP:()=>r,LU:()=>a,NS:()=>n,SS:()=>s,ZP:()=>d});var i=o(49085);const s="loadingLocalImage",n="uploading",r="downloading",a="loaded";class l extends i.default{getInitialState(){return{loadingMode:a}}}const d=l},96809:(e,t,o)=>{o.d(t,{Z:()=>i});const i=new(o(14542).ZP)}}]);