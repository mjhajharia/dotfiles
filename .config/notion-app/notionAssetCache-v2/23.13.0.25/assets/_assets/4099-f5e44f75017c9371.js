"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[4099],{10912:(e,t,r)=>{r.d(t,{Z:()=>M});r(57658),r(67294);var s=r(83355),i=r(27531),n=r(41432),o=r(80951),a=r(95538),l=r(21202),d=r(97880),c=r(12457),u=r(78316),h=r(17311),p=r(35328),m=r(26350),g=r(53827),f=r(12981),v=r(43568),y=r(81865),x=r(35541),S=r(85893);function b(e){return"number"==typeof e}class C extends s.Z{constructor(){super(...arguments),this.renderContentBlock=e=>{const{store:t,renderAdditionalBlocks:r,rendererBlockStyle:s}=this.props,n=m.G.createChildStore(t,{table:l.iU,id:e}),o=n.getType(),a=r&&void 0!==o?(0,x.u)(n):(0,g.h)(n);if(a)return(0,S.jsx)(i.D,{value:this.restrictedContentStore,children:(0,S.jsx)(a,{store:n,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,hideContent:(0,p.BX)(n),style:{fontSize:12,opacity:.8,pointerEvents:"none",...s},isQuickFind:!0,numberedListCounterStore:this.createComputedStore((()=>({depth:0,numberedListBlockIdsWithFormat:this.createNumberedListCounterStore(e)})))})},e)},this.coverStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,{ThemeStore:r}=this.environment,s=(0,u.NU)({rootStore:e,renderAdditionalBlocks:t,theme:r.state.mode});return s.image?s.image:!(this.props.showLoadingShimmer&&0===s.blockIds.length&&!s.isDefined)&&s.blockIds})),this.restrictedContentStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,r=(0,u.wK)(e,t);return r.image?void 0:r.blockIds})),this.numberedLists=this.createComputedStore((()=>{const{store:e}=this.props,t=this.coverStore.state,r=[];if(Array.isArray(t)){let s=0;for(;s<t.length;){let i=t[s],o=m.G.createChildStore(e,{table:l.iU,id:i});if(o.getType()===n.Ti.numberedList){const a=[{blockId:i,idx:1}],d=[{id:i,format:void 0,depth:a.length-1,index:a[0].idx}];for(s+=1;s<t.length&&(i=t[s],o=m.G.createChildStore(e,{table:l.iU,id:i}),o.getType()===n.Ti.numberedList);){{const e=o.getParentId();if(o.getParentId()===a[a.length-1].blockId)a.push({blockId:i,idx:1});else{let t=a[a.length-1].idx;for(;a.length>0&&a[a.length-1].blockId!==e;)t=a[a.length-1].idx,a.pop();a.push({blockId:i,idx:t+1})}d.push({id:i,format:void 0,depth:a.length-1,index:a[a.length-1].idx})}s+=1}r.push(d)}else s+=1}}return r}))}didUpdate(e){this.props.coverFormat.type!==e.coverFormat.type&&this.props.onLoadProxiedImage()}renderComponent(){const{coverFormat:e}=this.props;return"page_cover"===e.type?this.renderPageCover():"page_content"===e.type?this.renderPageContent():"property"===e.type?this.renderProperty(e.property):void 0}renderPageCover(){var e;const{store:t}=this.props,r=null===(e=t.getCover())||void 0===e?void 0:e.cover;return r?(0,S.jsxs)("div",{style:T(this.props.coverHeight,this.props.coverSizeFormat,this.props.imageCoverWrapStyle),children:[(0,S.jsx)(y.Z,{url:r,isAuthenticated:!0,permissionRecord:this.props.store.pointer,width:w(this.props.coverWidth,this.props.coverSizeFormat),onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),render:(e,t)=>{if(t)return(0,S.jsx)(f.Z,{style:{...j(this.props.style),...this.getCoverStyle(),...P(this.props.coverAspectFormat),objectPosition:`center ${100*(1-I(this.props.store,this.props.coverPosition))}%`},src:t,loading:"lazy"})}}),this.renderImageBorder()]}):this.props.showEmptyGalleryCover?(0,S.jsx)(F,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle}):void 0}renderPageContent(){const e=this.coverStore.state,t=this.restrictedContentStore.state,r=this.props.renderAdditionalBlocks&&this.props.store.isCollectionView();if(!1===e)return(0,S.jsx)(R,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,loadingShimmerStyle:this.props.loadingShimmerStyle});if(e){if(!Array.isArray(e))return r?(0,S.jsxs)("div",{style:this.getContentWrapStyle(),children:[(0,S.jsx)(y.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:w(),render:(e,t)=>{if(t)return(0,S.jsx)(f.Z,{style:{...j(),...this.getPageContentImageStyle({renderCollectionImage:!0}),...P(),objectPosition:`center ${100*(1-I(this.props.store,this.props.coverPosition))}%`},placeholderLoadedStyle:{display:"flex",justifyContent:"center",alignItems:"end"},src:t})}}),this.renderImageBorder(),(0,S.jsx)("div",{style:this.getContentFadedOverlayStyle()})]}):(0,S.jsxs)("div",{style:T(this.props.coverHeight,this.props.coverSizeFormat,this.props.imageCoverWrapStyle),children:[(0,S.jsx)(y.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:w(this.props.coverWidth,this.props.coverSizeFormat),render:(e,t)=>{if(t)return(0,S.jsx)(f.Z,{style:{...j(this.props.style),...this.getPageContentImageStyle({renderCollectionImage:!1}),...P(this.props.coverAspectFormat),objectPosition:`center ${100*(1-I(this.props.store,this.props.coverPosition))}%`},src:t,loading:"lazy"})}}),this.renderImageBorder()]});if(e.length>0)return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)("div",{style:this.getContentWrapStyle(),children:[t?e.filter((e=>t.indexOf(e)>=0)).map(this.renderContentBlock):e.map(this.renderContentBlock),this.props.coverContentFadedOverlay&&(0,S.jsx)("div",{style:this.getContentFadedOverlayStyle()})]})});if(this.props.showEmptyGalleryCover)return(0,S.jsx)(F,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle})}else if(this.props.showEmptyGalleryCover)return(0,S.jsx)(F,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle})}renderProperty(e){const{store:t}=this.props,r=(0,o.g)(t.getPropertyValue(e)).find((e=>(0,a.SR)({url:e.url})));return r?(0,S.jsxs)("div",{style:T(this.props.coverHeight,this.props.coverSizeFormat,this.props.imageCoverWrapStyle),children:[(0,S.jsx)(y.Z,{onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),url:r.url,isAuthenticated:!0,permissionRecord:this.props.store.pointer,width:w(this.props.coverWidth,this.props.coverSizeFormat),render:(e,t)=>{if(t)return(0,S.jsx)(f.Z,{style:{...j(this.props.style),...this.getCoverStyle(),...P(this.props.coverAspectFormat),objectPosition:`center ${100*(1-I(this.props.store,this.props.coverPosition))}%`},src:t,loading:"lazy"})}}),this.renderImageBorder()]}):this.props.showEmptyGalleryCover?(0,S.jsx)(F,{coverHeight:this.props.coverHeight,coverSizeFormat:this.props.coverSizeFormat,emptyGalleryCoverStyle:this.props.emptyGalleryCoverStyle}):void 0}renderImageBorder(){switch(this.props.variant){case"default":return null;case"gallery":return(0,S.jsx)("div",{style:{position:"absolute",left:0,right:0,bottom:0,borderBottom:`1px solid ${this.theme.regularDividerColor}`}});default:(0,d.t1)(this.props.variant)}}createNumberedListCounterStore(e){const t=this.numberedLists.state;for(const r of t)if(r.find((t=>t.id===e)))return r;return[]}getContentWrapVariantStyle(){const{ThemeStore:e}=this.environment,t="dark"===e.state.mode;switch(this.props.variant){case"default":return{};case"gallery":return{background:this.theme.collectionGalleryPreviewCardCover,padding:"8px 8px 0",boxShadow:t?"transparent":`inset 0 -1px 0 0 ${this.theme.regularDividerColor}`,...this.props.contentWrapStyle};default:(0,d.t1)(this.props.variant)}}getContentWrapStyle(){return{height:k(this.props.coverHeight,this.props.coverSizeFormat),pointerEvents:"none",overflow:"hidden",position:this.props.coverContentFadedOverlay?"relative":"static",...this.getContentWrapVariantStyle(),...this.props.contentWrapStyle}}getContentFadedOverlayStyle(){return{width:"100%",height:40,position:"absolute",bottom:0,left:0,background:`linear-gradient(to bottom, transparent, ${this.theme.accentColors.gray[30]} 100%)`,...this.props.coverContentFadedOverlayStyle}}getCoverVariantStyle(){switch(this.props.variant){case"default":return{border:`1px solid ${this.theme.stroke.regular}`,borderTopLeftRadius:4,borderTopRightRadius:4,borderBottomRightRadius:4,borderBottomLeftRadius:4};case"gallery":return{borderRadius:0,borderTopLeftRadius:1,borderTopRightRadius:1};default:(0,d.t1)(this.props.variant)}}getCoverStyle(){return{width:"100%",height:k(this.props.coverHeight,this.props.coverSizeFormat),...this.getCoverVariantStyle(),objectPosition:"center"}}getPageContentImageStyle(e){const{renderCollectionImage:t}=e;return{...this.getCoverStyle(),objectPosition:"center center",...t&&{height:void 0,border:`1px solid ${this.theme.lightDividerColor}`,borderBottom:"none",borderBottomLeftRadius:0,borderBottomRightRadius:0}}}}C.displayName="CollectionItemCover";const M=C;function I(e,t){if(b(t))return t;if(e.getFormatStore().isDefined()){const{page_cover_position:t,card_cover_position:r}=e.getFormat();if(b(r))return r;if(b(t))return t}return.5}function j(e){return e||{}}function k(e,t){if(e)return e;switch(t){case"large":return h.Z.card.desktop.large.height;case"small":return h.Z.card.desktop.small.height;case"medium":default:return h.Z.card.desktop.medium.height}}function w(e,t){return e||(0,u.rD)(t)}function P(e){return{objectFit:void 0===e?"cover":e}}function T(e,t,r){return{height:k(e,t),position:"relative",pointerEvents:"none",overflow:"hidden",...r}}function F(e){let{coverHeight:t,coverSizeFormat:r,emptyGalleryCoverStyle:s}=e;return(0,S.jsx)("div",{style:{height:k(t,r),...s}})}function R(e){let{coverHeight:t,coverSizeFormat:r,loadingShimmerStyle:s}=e;return(0,S.jsx)("div",{style:{height:k(t,r),...s},children:(0,S.jsx)(c.Z,{show:!0,showDelay:100,showHold:0,render:e=>e?(0,S.jsx)(v.Z,{paragraphs:[{lineHeight:12,lineMargin:6,sectionWidths:[100,100,50],repeat:1,sectionMargin:0}]}):void 0})})}},92660:(e,t,r)=>{r.d(t,{Z:()=>l});r(67294);var s=r(480),i=r(86628),n=r(50506),o=r(53437),a=r(85893);function l(e){window.__c={n:"DefaultPopupOrModal"};const t=(0,s.O7)(),{modalStore:r,render:l}=e,{device:d}=t,c=(0,i.VK)((()=>r.state.open),[r]);return d.isMobile?(0,a.jsx)(o.ZP,{ariaLabel:e.ariaLabel,open:c,popupType:o.ZP.PopupType.SlideUp,origin:e.origin,onDismiss:e.onDismiss,render:l,style:e.style}):(0,a.jsx)(n.Z,{ariaLabel:e.ariaLabel,open:c,preventHideChildrenWhileOpening:!0,render:l,onDismiss:e.onDismiss,style:e.style,innerStyle:e.innerStyle})}},30676:(e,t,r)=>{r.d(t,{F:()=>a});r(67294);var s=r(86628),i=r(74016),n=r(52275),o=r(85893);function a(e){window.__c={n:"TeamMenuItem"};const{teamStore:t}=e,{name:r}=(0,s.VK)((()=>({name:t.getName()})),[t]);return(0,o.jsx)(n.Z,{...e,icon:(0,o.jsx)(i.p,{size:14,store:t,disabled:!0}),title:r})}},93481:(e,t,r)=>{r.d(t,{Z:()=>M});r(67294);var s=r(83355),i=r(69651),n=r(97880),o=r(68939),a=r(97638),l=r(41558),d=r(33338),c=r(42922),u=r(52275),h=r(3386),p=r(89728),m=r(53437),g=r(72495),f=r(83264),v=r(255),y=r(75689),x=r(91642),S=r(8319),b=r(85893);class C extends s.Z{constructor(){super(...arguments),this.storeTypes={store:l.Z},this.renderActiveButtonOrigin=()=>{const{value:e,dateFormat:t,disabled:r,focused:s,intl:n}=this.props,o=this.styles,l=j(this.theme),d={...o.menuItem,...l.activeMenuItem},c=a._Q(e,n,t),h=(0,b.jsx)(v.Z,{onClick:this.handleClear,disabled:r});return(0,b.jsx)(u.Z,{focused:s,disabled:r,icon:(0,i.C)(o.iconActiveDesktop),title:c,right:h,isTokenTitle:!0,alignIconTop:!0,onClick:this.handleOriginActivate,desktopTitleStyle:o.menuItemTitleDesktop,desktopIconStyle:o.iconActiveDesktopWrapper,style:d})},this.renderInactiveButtonOrigin=()=>{const{title:e,icon:t,disabled:r,focused:s,mode:i}=this.props,n=this.styles,o=j(this.theme),a={...n.menuItem,...o.buttonMenuItem,...i===S.Z.Mode.Pill?{width:"fit-content",border:"solid 1px",paddingLeft:0,paddingRight:0,borderRadius:20,fontSize:12}:{}};return(0,b.jsx)(u.Z,{focused:s,disabled:r,icon:t(n.icon),title:e,onClick:this.handleOriginActivate,style:a})},this.renderPillButtonOrigin=()=>{const{value:e,title:t}=this.props;return(0,b.jsx)(d.Z,{on:Boolean(e.starting||e.ending),icon:(0,i.C)({width:16,marginRight:6,fill:"currentColor"}),title:(0,b.jsx)("span",{children:t}),onClick:this.handleOriginActivate})},this.renderPopupContents=()=>{const{title:e,showButtons:t}=this.props,{store:r}=this.stores;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Z,{title:e,value:this.getCurrentValue(),onUpdate:this.updateTemporary,store:r,onDismiss:this.handleMenuClose}),t&&(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",padding:"0px 10px"},children:[(0,b.jsx)(p.Z,{isGray:!0,style:{marginLeft:"auto",marginRight:8},onClick:this.handleMenuClose,children:(0,b.jsx)(o.FormattedMessage,{defaultMessage:"Cancel",id:"searchDateFilter.cancelButton.label"})}),(0,b.jsx)(c.Z,{onClick:()=>this.props.onChange(this.stores.store.state.temporaryDateRange),children:(0,b.jsx)(o.FormattedMessage,{defaultMessage:"Accept",id:"searchDateFilter.acceptButton.label"})})]})]})},this.renderFooter=()=>{const{store:e}=this.stores;return(0,b.jsxs)(g.Z,{topBorder:!0,style:{padding:6,justifyContent:"space-between",display:"flex"},children:[(0,b.jsx)(p.Z,{onClick:()=>{e.setState({...e.state,temporaryDateRange:{starting:void 0,ending:void 0}}),this.props.onChange({})},children:(0,b.jsx)(o.FormattedMessage,{id:"searchDateFilter.clearButton",defaultMessage:"Clear"})}),(0,b.jsx)(c.Z,{onClick:this.handleMenuClose,children:(0,b.jsx)(o.FormattedMessage,{id:"searchDateFilter.applyButton",defaultMessage:"Apply"})})]})},this.handleOriginActivate=()=>{const{disabled:e}=this.props,{store:t}=this.stores;e||t.setState({...t.state,isOpen:!0,focus:"starting"})},this.handleMenuClose=e=>{const{onChange:t,onMenuDismiss:r}=this.props,{store:s}=this.stores,{temporaryDateRange:i}=s.state;a.zD(e)||(this.props.showButtons||t(i),s.setState({...s.state,isOpen:!1,temporaryDateRange:{starting:void 0,ending:void 0}}),r&&r())},this.handleClear=()=>{const{onChange:e}=this.props;e({starting:void 0,ending:void 0})},this.handleMenuListKey=e=>{e.preventDefault&&e.preventDefault()},this.updateTemporary=e=>{const{store:t}=this.stores;if(!e.error)return t.setState({...t.state,temporaryDateRange:{...t.state.temporaryDateRange,...e.value}})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginRight:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6},popup:{paddingTop:12,paddingBottom:8},menuItemTitleDesktop:{width:"100%"},sectionMenuItem:{display:"flex"},summary:{display:"inline-flex"}}}didMount(){this.updateTemporary({value:this.props.value})}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{title:t}=this.props,{store:r}=this.stores,s=this.styles,i=e===S.z.Section,o=i?t:void 0,a=(()=>e===S.Z.Mode.Section?this.renderActiveButtonOrigin():e===S.Z.Mode.Button?this.renderInactiveButtonOrigin():e===S.Z.Mode.Pill?this.renderPillButtonOrigin():void(0,n.t1)(e))();return(0,b.jsx)(x.Z,{title:o,marginAfter:i,children:(0,b.jsx)(h.Z,{capture:r.state.isOpen,onUp:this.handleMenuListKey,onDown:this.handleMenuListKey,onEnter:this.handleMenuListKey,children:(0,b.jsx)(m.ZP,{popupType:I(this.environment),open:r.state.isOpen,origin:a,render:this.renderPopupContents,onDismiss:this.handleMenuClose,placementToOrigin:m.ZP.Placement.Bottom,alignmentToOrigin:m.ZP.Alignment.Start,keepFocus:!0,style:s.popup})})})}renderMobile(e){const{store:t}=this.stores,r=e===S.z.Section?this.renderMobileFilterSummary():this.renderMobileButtonOrigin();return(0,b.jsx)(m.ZP,{popupType:m.ZP.PopupType.SlideUp,open:t.state.isOpen,origin:r,render:this.renderPopupContents,onDismiss:this.handleMenuClose,preventScaleTransition:!0})}renderMobileButtonOrigin(){const{icon:e,title:t,disabled:r}=this.props,s=this.styles;return(0,b.jsx)(u.Z,{disabled:r,focused:!1,icon:e(s.icon),title:t,onClick:this.handleOriginActivate})}renderMobileFilterSummary(){const{title:e,value:t,dateFormat:r,disabled:s,intl:n}=this.props,o=this.styles,l=(0,b.jsxs)("div",{style:o.summary,children:[(0,i.C)(o.iconActiveMobile),a._Q(t,n,r)]});return(0,b.jsx)(y.Z,{disabled:s,onClick:this.handleOriginActivate,onClickClear:this.handleClear,label:e,title:l})}getCurrentValue(){const{value:e}=this.props,{store:t}=this.stores,{temporaryDateRange:r}=t.state;return{...e,...r}}}C.displayName="SearchDateFilter";const M=(0,o.injectIntl)(C);function I(e){const{device:t}=e;return t.isMobile?m.ZP.PopupType.SlideUp:m.ZP.PopupType.Popup}function j(e){return{buttonMenuItem:{color:e.mediumTextColor},activeMenuItem:{color:e.regularTextColor}}}},33991:(e,t,r)=>{r.r(t),r.d(t,{DEFAULT_MODAL_WIDTH_WITH_SIDE_PEEK:()=>X,INACTIVE_TIMEOUT_MS:()=>U,SearchCopyLinkSource:()=>Q,SearchStaticContext:()=>G,SearchStoresContext:()=>$,default:()=>J,getSearchResultMetadata:()=>re});r(57658);var s=r(67294),i=r(83355),n=r(18466),o=r(49085),a=r(15145),l=r(1800),d=r(12174),c=r(15157),u=r(72126),h=r(4615),p=r(45366),m=r(94804),g=(r(70203),r(97880)),f=r(63143),v=r(50906),y=r(47839),x=r(98730),S=r(75018),b=r(87531),C=r(81598),M=r(40824),I=(r(95477),r(34700)),j=r(73744),k=(r(69988),r(98165)),w=(r(65598),r(59139)),P=r(97638),T=(r(95697),r(74948)),F=r(80444),R=r(77080),B=r(32470),Z=r(55320),A=r(92338),O=r(62965),L=r(29026);class _ extends o.default{getInitialState(){return{insertedActionResultsCount:0,localResults:void 0,serverResultsLoading:!1,serverResults:void 0,serverEventProperties:void 0,serverResultsAllLoaded:!1,errorState:E,selectedQueryResultQuery:void 0}}setState(e){const t={...this.instanceState};if(!(0,O.Z)(this.instanceState,t))return;const r=function(e){const{newState:t,priorState:r}=e,{localResults:s,serverError:i,serverResultsLoading:n,serverResults:o}=t,a=Boolean(s),l=n?void 0:i;if(!a&&n)return!r.errorState.isLoading&&r.errorState.showMajorError?r.errorState:{isLoading:n};if(a)return{hasLocalResults:a,serverError:l,isLoading:!1,showMajorError:!1};if(l)return{hasLocalResults:a,serverError:l,isLoading:!1,showMajorError:!0};if(0===(null==o?void 0:o.results.length))return{hasLocalResults:a,serverError:A.Ix.NoResults,isLoading:!1,showMajorError:!0};return{hasLocalResults:a,serverError:l,isLoading:!1,showMajorError:!1}}({newState:e,priorState:t});super.setState({...e,errorState:r})}getResultCount(){const{serverResults:e,localResults:t}=this.state,r=(null==e?void 0:e.total)??(null==t?void 0:t.total)??0,s=Boolean(e&&r>=100);return{count:r,isLowerBound:Boolean(e&&t&&r<L.Xv)||s}}}const E={showMajorError:!1,isLoading:!1,hasLocalResults:!1,serverError:void 0};const D=_;var V=r(30857),q=r(87956),N=r(88893),W=r(9019),H=r(98670),z=r(86244),K=r(85893);const U=120*f.C0,G=s.createContext(null),$=s.createContext(null);let Q=function(e){return e[e.SidePeekPanel=0]="SidePeekPanel",e[e.KeyboardShortcut=1]="KeyboardShortcut",e}({});const X=700;class Y extends i.Z{constructor(){super(...arguments),this.inactiveTimer=void 0,this.spaceId=void 0,this.isOpen=!1,this.shouldClearServerResultsOnQueryChange=!1,this.queryResultsSectionRef=s.createRef(),this.searchFilterMenuRef=s.createRef(),this.modalBodyMenuRef=s.createRef(),this.searchResultStore=new D,this.secondarySearchResultStore=new D,this.focusedIndexStore=o.default.createValue(void 0),this.defaultBodyFocusedResult=o.default.createValue(void 0),this.searchActionItemsList=o.default.createValue([]),this.getStaticContext=u.HP((()=>({queryResultsSectionRef:this.queryResultsSectionRef,searchFilterMenuRef:this.searchFilterMenuRef,modalBodyMenuRef:this.modalBodyMenuRef,handleSelectSearchResult:this.handleSelectSearchResult,handleCopySearchItemLink:this.handleCopySearchItemLink,handleQueryChange:this.handleQueryChange,handlePopupOpen:this.handlePopupOpen,handlePopupClose:this.handlePopupClose,searchResultStore:this.searchResultStore,secondarySearchResultStore:this.secondarySearchResultStore,focusedIndexStore:this.focusedIndexStore,defaultBodyFocusedResult:this.defaultBodyFocusedResult,searchActionItemsStore:this.searchActionItemsList,isQuickSearch:this.props.quickSearchMode}))),this.getStoresContext=u.HP((e=>({parentStore:e}))),this.renderContent=e=>{const t=this.currentMode.state,r=this.isPopupOpen.state;return(0,K.jsx)(G.Provider,{value:this.getStaticContext(),children:(0,K.jsxs)($.Provider,{value:this.getStoresContext(this.props.parentStore),children:[this.props.quickSearchMode&&!r&&(0,K.jsx)("div",{style:{position:"absolute",height:z.$,width:"100%",...(0,I.X)({drag:!0})}}),"search"===t?(0,K.jsx)(H.$T,{renderAsPage:this.props.renderAsPage,quickSearchMode:this.props.quickSearchMode,searchContentPaneType:e,onClose:this.handleComponentClose}):(0,K.jsx)(C.yX,{renderAsPage:this.props.renderAsPage,quickSearchMode:this.props.quickSearchMode,searchContentPaneType:e,onClose:this.handleComponentClose})]})})},this.handlePopupOpen=()=>{L.ZP.setIsAnyPopupOpen(!0)},this.handlePopupClose=()=>{L.ZP.setIsAnyPopupOpen(!1)},this.handleComponentOpenClose=()=>{const e=Z.default.state.open||Z.default.state.openAsPage;this.isOpen!==e&&(this.isOpen=e,(Z.default.state.open||Z.default.state.openAsPage)&&(clearTimeout(this.inactiveTimer),L.ZP.update((e=>({...e,hasScrolled:!1})))))},this.handleComponentClose=e=>{const{device:t}=this.environment,{selectedQueryResult:r,numKeystrokes:s,numServerRequests:i,numLocalRequests:n,hadMetaClick:o}=V.default.state,{serverEventProperties:a}=this.searchResultStore.state,{query:l,hasScrolled:c,mode:u}=L.ZP.state;if(s>0&&(i>0||n>0)&&!r&&!o&&(Z.default.state.openAsPage||Z.default.state.open)){const e=Date.now(),r=Z.default.state.openedTimeMs,n=Z.default.state.sessionId,o=V.default.state.firstKeyStrokeTimeMs;v.EH8(this.environment,{...a,timeToAbandonMs:e-r,timeFromFirstKeyStrokeToAbandonMs:o?e-o:void 0,numKeystrokes:s,numResultsAboveFold:this.getNumResultsAboveFold(),searchSessionId:n,searchSessionFlowNumber:i,hasScrolled:c,numLocalResults:this.getNumLocalResults(),numTotalLocalResults:this.getNumTotalLocalResults(),numVisibleMembers:(0,N.qX)(),isMobile:t.isMobile})}"assistant"===u&&"keydown"===(null==e?void 0:e.type)?L.ZP.switchToSearchPane():this.props.quickSearchMode?(Z.default.closeAndResetMetricsState(),V.default.reset(),r&&!o&&this.resetState(),y.closeQuickSearch()):b.IB(this.environment),"assistant"===u&&M.N.setAssistantLastViewedTime(),""===l.text.trim()&&"assistant"!==u&&L.ZP.reset();const h=R.default.getEligibleGroup({experimentId:"search-shorten-inactive-timer",defaultGroup:"control"});let p=U;"control"!==h&&d.g6["search-shorten-inactive-timer"].includes(h)&&(p=parseInt(h,10)*f.C0),this.inactiveTimer&&clearTimeout(this.inactiveTimer),p>0?this.inactiveTimer=window.setTimeout(this.resetState,p):this.resetState(),!this.props.renderAsPage&&t.isMobile&&T.close(),V.default.reset()},this.handleVisibilityChange=(e,t,r)=>{if(this.props.quickSearchMode)if(t){let e;e="tray-icon"===r?"quick-search-tray-icon":"shortcut"===r?"quick-search-shortcut":"debug-menu"===r?"quick-search-debug-menu":"quick-search",b.UT({environment:this.environment,analyticsFrom:e,isQuickSearch:!0,renderAsPage:!0})}else this.handleComponentClose()},this.handleOpenFromQuickSearch=()=>{b.UT({environment:this.environment,analyticsFrom:"keyboard-shortcut-quick-search-hotkey",isQuickSearch:!1,renderAsPage:!1})},this.handlePotentialWebSearchAbandon=e=>{this.props.renderAsPage&&this.handleComponentClose()},this.constructSelectSearchItemContext=e=>{var t,r;let{index:s,actionItemCount:i,context:n,selectedResult:o,allSearchResults:a,fromSidePeekPanel:l,sessionId:d,openedTimeMs:c}=e;const{serverEventProperties:u,store:h}=o,m=Date.now(),{numKeystrokes:g,hadMetaClick:f}=V.default.state,{firstKeyStrokeTimeMs:v}=V.default.state,{numServerRequests:y}=V.default.state,{query:x}=L.ZP.state,S=(0,N.qX)(),b=(null==a?void 0:a.filter((e=>{var t;return void 0!==(null===(t=e.matchedCollectionProperties)||void 0===t?void 0:t.collectionText)})).length)??0,C=(null==a?void 0:a.filter((e=>{var t;return void 0!==(null===(t=e.highlight)||void 0===t?void 0:t.collectionText)})).length)??0,M=void 0!==(null===(t=o.matchedCollectionProperties)||void 0===t?void 0:t.collectionText),I=void 0!==(null===(r=o.highlight)||void 0===r?void 0:r.collectionText);return{...u,context:n,queryStringLength:x.text.trim().length,numQueryTokens:p.wS(x.text.trim()).length,hasFilters:P.FN(x.filters),activeFilters:x.filters,selectedItemIndex:s.global-i,selectedItemLocalIndex:{section:s.local.section,index:s.local.indexLocal},numKeystrokes:g,fromSidePeekPanel:l,isSidePeekPanelOpen:L.ZP.state.isSidePeekPanelOpen,isSidebarOpen:L.ZP.isDebugSidebarOpen(),timeToSelectMs:m-c,timeFromFirstKeyStrokeToSelectMs:v?m-v:m-c,sources:null==o?void 0:o.sources,localSources:[...(null==o?void 0:o.localSource)??[]],indexInRecentPages:null==o?void 0:o.indexInRecentPages,timeSinceLastViewedMs:null==o?void 0:o.timeSinceLastViewedMs,hadMetaClick:f,numResultsAboveFold:this.getNumResultsAboveFold(),selectedSearchResultMetadata:re(o),selectedSearchResultContent:void 0,allSearchResultMetadata:null==a?void 0:a.slice(0,50).map((e=>re(e))),totalSearchResultCount:null==a?void 0:a.length,searchSessionId:d,searchSessionFlowNumber:y,originalPosition:null==o?void 0:o.originalPosition,numLocalResults:this.getNumLocalResults(),numTotalLocalResults:this.getNumTotalLocalResults(),numVisibleMembers:S,isMobile:this.environment.device.isMobile,resultWithCollectionPropertyMatchCount:b,resultWithCollectionPropertyHighlightCount:C,isCollectionPropertyMatch:M,isCollectionPropertyHighlight:I}},this.handleSelectSearchResult=e=>{let{index:t,actionItemCount:r,event:s,context:i,selectedResult:n,allSearchResults:o,fromSidePeekPanel:d}=e;const{serverEventProperties:c,store:u}=n;if(!Z.default.state.open&&!Z.default.state.openAsPage)return;const h=j.DJ(s);"query_results"===i&&(V.default.update((e=>({...e,selectedQueryResult:!0}))),this.searchResultStore.update((e=>({...e,selectedQueryResultQuery:L.ZP.state.query}))));const{sessionId:p,openedTimeMs:f}=Z.default.state,{numServerRequests:x}=V.default.state;v.nLf(this.environment,{...this.constructSelectSearchItemContext({index:t,actionItemCount:r,context:i,selectedResult:n,allSearchResults:o,fromSidePeekPanel:d,sessionId:p,openedTimeMs:f}),isMetaClick:Boolean(h)});const b=(null==c?void 0:c["server-queryId"])??(0,m.A7)({searchSessionId:p,searchSessionFlowNumber:x});let C;"recent_pages"===i?C=a.tY.SearchRecents:"query_results"===i?C=a.tY.SearchQuery:(0,g.t1)(i);if(this.environment.device.isElectron&&this.props.quickSearchMode){const e=(0,l.Z)({pageModel:n.store.getModel(),pageId:n.store.id,scrollToBlockId:(0,P.dy)(n),pageVisitSource:C,queryId:b});y.openQuickSearchResult(e)}else S.navigateToSearchResult({searchResult:n,environment:this.environment,pageVisitSource:C,queryId:b,openInNew:h,openInSidePeek:false});q.Z.setState({queryId:b,pageId:u.id,timeEntered:new Date}),h?V.default.update((e=>({...e,hadMetaClick:!0}))):this.handleComponentClose()},this.handleCopySearchItemLink=e=>{let{index:t,actionItemCount:r,context:s,selectedResult:i,allSearchResults:n,fromSidePeekPanel:o,source:a}=e;if(!Z.default.state.open&&!Z.default.state.openAsPage)return;const{sessionId:l,openedTimeMs:d}=Z.default.state;v.sbH(this.environment,{...this.constructSelectSearchItemContext({index:t,actionItemCount:r,context:s,selectedResult:i,allSearchResults:n,fromSidePeekPanel:o,sessionId:l,openedTimeMs:d}),source:a})},this.handleQueryChange=e=>{""!==e?(V.default.update((e=>({...e,numKeystrokes:e.numKeystrokes+1}))),L.ZP.updateQueryText(e)):L.ZP.resetQuery({resetFilters:!1})},this.getNumResultsAboveFold=()=>P.MQ({environment:this.environment,searchResultsSection:this.queryResultsSectionRef.current,modalBodyMenu:this.modalBodyMenuRef.current,searchFilterMenu:this.searchFilterMenuRef.current}),this.getNumLocalResults=()=>{var e;return(null===(e=this.searchResultStore.state.localResults)||void 0===e?void 0:e.results.length)??0},this.getNumTotalLocalResults=()=>{var e;return(null===(e=this.searchResultStore.state.localResults)||void 0===e?void 0:e.total)??0},this.handleSpaceChange=()=>{const e=F.default.state.currentSpaceStore&&F.default.state.currentSpaceStore.id;this.spaceId!==e&&(this.spaceId=e,this.resetStateWhenSpaceChange(),x.S(this.environment),this.spaceId&&F.default.state.currentUserStore&&this.props.quickSearchMode&&y.quickSearchReady())},this.handleSidePeekPreferenceChange=()=>{var e;const t=null===(e=F.default.state.currentUserStore)||void 0===e?void 0:e.id;t&&c.Z.set({userId:t,key:m.Y6,value:Z.default.state.preferSidePeekOpen})},this.resetState=()=>{L.ZP.reset(),this.searchResultStore.reset(),this.secondarySearchResultStore.reset(),V.default.reset(),this.props.quickSearchMode?Z.default.closeAndResetMetricsState():Z.default.reset()},this.resetStateWhenSpaceChange=()=>{L.ZP.reset(),this.searchResultStore.reset(),this.secondarySearchResultStore.reset(),this.props.quickSearchMode||(Z.default.reset(),V.default.reset())},this.currentMode=this.createComputedStore((()=>L.ZP.state.mode)),this.isPopupOpen=this.createComputedStore((()=>L.ZP.state.isPopupOpen))}UNSAFE_willMount(e){var t;this.spaceId=null===(t=F.default.state.currentSpaceStore)||void 0===t?void 0:t.id,(0,B.lO)(),F.default.state.currentSpaceStore&&F.default.state.currentUserStore&&e.quickSearchMode&&y.quickSearchReady()}UNSAFE_willMountOrUpdate(e){if(e.renderAsPage&&!e.quickSearchMode&&!Z.default.state.sessionId){const e=(0,h.ZP)();Z.default.update((t=>({...t,open:!1,openAsPage:!0,openedTimeMs:Date.now(),sessionId:e}))),v.wFN(this.environment,{from:"nativeTab-search-direct-link",searchSessionId:e})}}didMount(){F.default.addListener(this.handleSpaceChange),Z.default.addListener(this.handleSidePeekPreferenceChange),this.props.renderAsPage&&!this.props.quickSearchMode||Z.default.addListener(this.handleComponentOpenClose),this.props.quickSearchMode?y.quickSearchVisibilityState.addListener(this.handleVisibilityChange):y.openSearchModalFromQuickSearch.addListener(this.handleOpenFromQuickSearch),S.potentialWebSearchAbandonEventEmitter.addListener(this.handlePotentialWebSearchAbandon)}willUnmount(){this.resetState(),this.props.renderAsPage&&!this.props.quickSearchMode||(Z.default.removeListener(this.handleComponentOpenClose),y.openSearchModalFromQuickSearch.removeListener(this.handleOpenFromQuickSearch)),this.props.quickSearchMode&&y.quickSearchVisibilityState.removeListener(this.handleVisibilityChange),S.potentialWebSearchAbandonEventEmitter.removeListener(this.handlePotentialWebSearchAbandon),F.default.removeListener(this.handleSpaceChange),Z.default.removeListener(this.handleSidePeekPreferenceChange),this.inactiveTimer&&(clearTimeout(this.inactiveTimer),this.inactiveTimer=void 0)}renderComponent(){const e=Boolean(L.ZP.state.query.text.trim())||P.VA(L.ZP.state.query.filters)?"search_results":"default_body";if(this.props.renderAsPage)return this.renderContent(e);const{device:t,mobileNative:r}=this.environment,s=Boolean(Z.default.state.open);return(0,K.jsx)(W.Z,{open:s,onDismiss:this.handleComponentClose,modalStyle:se(e,this.props.renderAsPage,this.environment,this.theme),disableAnimation:!t.isMobile||(null==r?void 0:r.supportsNativeHomeOnPhone())||!1,renderContent:()=>this.renderContent(e)})}}Y.displayName="Search";const J=Y;function ee(e){return P.bC(e)}function te(e){const t=(0,B.gq)({device:e.device}),r=(0,H.X1)({device:e.device,isPublicAccessPermissionForPage:ee(e).hasPublicAccessPermission});if(t)return"90vw";if((0,w.rd)(e))return X;let s=660;return r&&(s+=250),s}function re(e){const{store:t,highlight:r,sources:s,localSource:i}=e;return n.Z.withListenerIgnored((()=>{var n,o,a,l,d;return{blockId:t.id,blockType:t.getType(),lowestNavigableAncestorId:null===(n=t.getNavigableBlockStore())||void 0===n?void 0:n.id,depth:k.qA(t).length,matchesText:Boolean(null==r?void 0:r.text),matchesPathText:Boolean((null==r?void 0:r.pathText)||(null==r?void 0:r.title)),matchesTitle:Boolean(null==r?void 0:r.title),isNavigable:t.isNavigableBlock(),lastEditedTime:t.getLastEditedTime(),isTeamArchived:null===(o=(0,k.VP)(t))||void 0===o?void 0:o.isArchived(),sources:s,localSource:[...i??[]],badges:(null===(a=e.badges)||void 0===a?void 0:a.map((e=>e.type)))??[],isCollectionPropertyMatch:void 0!==(null===(l=e.matchedCollectionProperties)||void 0===l?void 0:l.collectionText),isCollectionPropertyHighlight:void 0!==(null===(d=e.highlight)||void 0===d?void 0:d.collectionText),featureGroups:e.featureGroups}}))}function se(e,t,r,s){const i=(0,H.ip)({searchContentPaneType:e,renderAsPage:t,environment:r});return{width:"100%",minHeight:i.minHeight,maxHeight:i.maxHeight,transform:"translate3d(0,0,0)",background:s.popoverBackground,maxWidth:te(r),borderRadius:12}}},98670:(e,t,r)=>{r.d(t,{$T:()=>nn,ip:()=>an,X1:()=>un});var s=r(67294),i=r(480),n=r(86628),o=r(24405),a=r(15145),l=r(72126),d=r(29477),c=r(80503),u=r(14871),h=r(98730),p=r(43250),m=r(84210),g=r(87279),f=r(59139),v=r(97638),y=r(85665),x=r(5162),S=r(80444),b=r(88632),C=r(69454),M=r(32470),I=r(55320),j=r(29026),k=r(36488),w=r(56940),P=r(3386),T=r(78140),F=r(40721),R=r(83785),B=r(22715),Z=r(33991),A=r(83355),O=r(12174),L=r(67220),_=r(69651),E=r(64275),D=r(6637),V=r(60291),q=r(37612),N=r(83303),W=r(53772),H=r(97880),z=r(82990),K=r(68939),U=r(95477),G=r(34700),$=r(95697),Q=r(61766),X=r(77080),Y=r(23063),J=r(64921),ee=r(52275),te=r(31945),re=r(60458),se=r(89728),ie=r(72495),ne=r(93481),oe=r(84619),ae=r(90028),le=r(21202),de=r(33929),ce=r(15447),ue=r(77907),he=r(26350),pe=r(31278),me=r(11470),ge=r(76798),fe=r(255),ve=r(85567),ye=r(8319),xe=r(85893);const Se={token:{display:"flex",alignItems:"center"},icon:{marginRight:4}},be=(0,K.defineMessages)({searchPages:{defaultMessage:"Search pages",id:"searchPageFilter.searchTokenFilter.tokenInput.placeholder"},selectAPage:{defaultMessage:"Select a page",id:"searchPageFilter.searchTokenFilter.resultSection.title"}});class Ce extends A.Z{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:r,onRemove:s,onClick:i}=t;const n=this.styles,o=Ie(e,this.props.parentStore),a=(0,xe.jsx)(fe.Z,{disabled:r,onClick:s});return(0,xe.jsx)(me.Z,{disabled:r,focused:!1,store:o,right:a,style:n.menuItem,desktopTitleStyle:n.menuItemTitle,onClick:i})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{fill:"currentColor"}}}renderComponent(){const{mode:e,title:t,blockIds:r,onChange:s,disabled:i,focused:n,onMenuDismiss:o,onMenuOpen:a}=this.props;return(0,xe.jsx)(ye.Z,{mode:e,hasItemsSelected:(null==r?void 0:r.length)>0,title:t,icon:ae.j,iconStyles:this.styles.recordIcon,items:r,onChange:s,focused:n,renderFilter:this.renderFilterListItem,renderToken:(e,t)=>(0,xe.jsx)(ke,{item:e,handlers:t,blockIds:this.props.blockIds,parentStore:this.props.parentStore}),renderItemForSummary:e=>(0,xe.jsx)(je,{item:e,parentStore:this.props.parentStore}),addItemLabel:(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Add another page",id:"searchPageFilter.searchTokenFilter.addAPage.button"}),labelText:{title:t,tokenInputPlaceholder:de.default.formatMessage(be.searchPages),componentDebugName:"SearchPageFilter"},performRequest:e=>async function(e,t){let{query:r,current:s}=e;const{currentSpaceStore:i}=S.default.state;if(!i)return[];const n=await ue.deps.searchActions.loader(),o=r?(await n.searchPageIds({environment:t,query:r,limit:20,spaceId:i.id,requireEditPermissions:!1,excludeTemplates:!1,source:"ancestor_filter_page_search",boostRecentlyViewedPages:!0})).results:ce.X4.state.map((e=>e.pageId)),a=new Set(s);return o.filter((e=>!a.has(e)))}(e,this.environment),renderResultMenuItem:(e,t)=>(0,xe.jsx)(we,{item:e,props:t,parentStore:this.props.parentStore}),disabled:i,onMenuDismiss:o,onMenuOpen:a})}}Ce.displayName="SearchPageFilter";const Me=Ce;function Ie(e,t){return he.G.createChildStore(t,{table:le.iU,id:e})}function je(e){let{item:t,parentStore:r}=e;window.__c={n:"ItemForSummaryComponent"};const s=(0,n.VK)((()=>Ie(t,r)),[t,r]);return(0,xe.jsx)(ge.Z,{store:s,shouldWrap:!0,maxLength:50})}function ke(e){let{item:t,handlers:r,blockIds:s,parentStore:o}=e;window.__c={n:"TokenComponent"};const a=(0,i.O7)(),l=Se,d=1===s.length,c=(0,n.VK)((()=>Ie(t,o)),[t,o]),u=(0,xe.jsxs)("div",{style:l.token,children:[(0,xe.jsx)(pe.Z,{disabled:!0,icon:c.getIcon(),isEmptyPage:!1,size:20,style:l.icon}),(0,xe.jsx)(ge.Z,{store:c})]});return(0,xe.jsx)(ve.Z,{format:a.device.isMobile?oe.lo.Large:oe.lo.Small,value:u,showRemoveButton:!0,onClickRemove:r.onRemove,isSingle:d,shouldShrink:!0,backgroundColor:"transparent",shouldWrap:!1})}function we(e){let{item:t,props:r,parentStore:s}=e;window.__c={n:"ResultMenuItemComponent"};const i=(0,n.VK)((()=>Ie(t,s)),[t,s]);return(0,xe.jsx)(me.Z,{...r,store:i})}var Pe=r(83890),Te=r(88507),Fe=r(29369),Re=r(92338),Be=r(30397),Ze=r(93044),Ae=r(30676);class Oe extends A.Z{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:r,onRemove:s,onClick:i}=t;const n=this.styles,o=_e(e,this.props.parentStore),a=(0,xe.jsx)(fe.Z,{disabled:r,onClick:s});return(0,xe.jsx)(Ae.F,{disabled:r,focused:!1,teamStore:o,right:a,style:n.menuItem,desktopTitleStyle:n.menuItemTitle,onClick:i},e)},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:6,fill:"currentColor"}}}renderComponent(){const{mode:e,title:t,teamIds:r,onChange:s,disabled:i,focused:n,onMenuDismiss:o,onMenuOpen:a,intl:l}=this.props,d=(0,Re.iY)(r);return(0,xe.jsx)(ye.Z,{mode:e,title:t,icon:Te.I,iconStyles:this.styles.recordIcon,items:d||[],onChange:s,disabled:i,focused:n,renderFilter:this.renderFilterListItem,renderToken:(e,t)=>(0,xe.jsx)(qe,{item:e,handlers:t,teamIds:this.props.teamIds,parentStore:this.props.parentStore}),renderItemForSummary:e=>(0,xe.jsx)(Ee,{item:e,parentStore:this.props.parentStore}),addItemLabel:(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Add a teamspace",id:"search.filterMenu.addATeamButton.label"}),labelText:{title:t,tokenInputPlaceholder:l.formatMessage({defaultMessage:"Search teamspaces",id:"search.filterMenu.searchTeams.placeholder"}),componentDebugName:"SearchTeamFilter"},performRequest:e=>async function(e,t){var r;let{query:s,current:i}=e;const n=new Set(i),o=S.default.state.currentSpaceViewStore,a=S.default.state.currentSpaceStore,l=null===(r=S.default.state.currentUserStore)||void 0===r?void 0:r.id;if(!o||!a||!l)return[];if(!s){const e=new Set(o.getTeamsStores().map((e=>e.id)));if(Be.Z.state.teams.map((e=>e.id)).forEach((t=>e.add(t))),e.size>0)return[...e]}const d=await(0,$.qX)({environment:t,spaceStore:a,currentUserId:l}),c=await ue.deps.searchActions.loader();return(await c.searchTeams({query:s,spaceViewStore:o,teamStores:d})).filter((e=>!n.has(e.id))).slice(0,20).map((e=>e.id))}(e,this.environment),renderResultMenuItem:(e,t)=>(0,xe.jsx)(Ve,{item:e,props:t,parentStore:this.props.parentStore}),onMenuDismiss:o,onMenuOpen:a,hasItemsSelected:Boolean(d&&(null==d?void 0:d.length)>0)})}}Oe.displayName="SearchTeamFilter";const Le=(0,K.injectIntl)(Oe);function _e(e,t){return he.zX.createChildStore(t,{table:Fe.e0,id:e})}function Ee(e){let{item:t,parentStore:r}=e;return(0,xe.jsx)(xe.Fragment,{children:_e(t,r).getName()})}function De(e){const t=e.getIcon();return e=>(0,xe.jsx)(pe.Z,{disabled:!0,icon:t,isEmptyPage:!1,size:e})}function Ve(e){let{item:t,props:r,parentStore:i}=e;const n=_e(t,i);return(0,s.createElement)(Ae.F,{...r,key:t,teamStore:n})}function qe(e){let{item:t,handlers:r,teamIds:s,parentStore:o}=e;window.__c={n:"TokenComponent"};const a=(0,i.O7)(),l=(0,Re.iY)(s),d=1===(null==l?void 0:l.length),c=(0,n.VK)((()=>_e(t,o)),[t,o]),u=(0,n.VK)((()=>c.getName()),[c]);return c?(0,xe.jsx)(Ze.ZP,{format:a.device.isMobile?Ze.lP.Large:Ze.lP.Small,showRemoveButton:!0,isSingle:d,onClickRemove:r.onRemove,renderAvatar:De(c),title:u,style:{background:"transparent"}}):null}var Ne=r(33338),We=r(86825),He=r(75689),ze=r(91642);class Ke extends A.Z{constructor(){super(...arguments),this.handleToggle=()=>{const{value:e,onChange:t}=this.props;t(!e)},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},pillIcon:{height:16,width:16,fill:"currentColor",marginRight:6},sectionMenuItem:{display:"flex"}}}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){return(0,xe.jsx)(ze.Z,{marginAfter:!1,style:this.styles.sectionMenuItem,children:this.renderSwitcherMenuItem(e)})}renderMobile(e){const{title:t,value:r,disabled:s}=this.props;return e===ye.z.Button?this.renderSwitcherMenuItem(e):(0,xe.jsx)(He.Z,{disabled:s,onClick:this.handleToggle,label:t,isToggle:!0,isToggleActive:r})}renderSwitcherMenuItem(e){const{title:t,icon:r,value:s,style:i,...n}=this.props,o=this.styles,a=this.getThemeColors(),l={...o.menuItem,...a.menuItem,...i};return e===ye.z.Pill?(0,xe.jsx)(Ne.Z,{on:s,hideChevron:!0,title:(0,xe.jsx)("span",{children:t}),onClick:this.handleToggle,icon:r(o.pillIcon)}):(0,xe.jsx)(We.Z,{title:t,icon:r(o.icon),on:s,onClick:this.handleToggle,style:l,...n})}getThemeColors(){return{menuItem:{color:this.theme.mediumTextColor}}}}Ke.displayName="SearchToggleFilter",Ke.Mode=ye.z;const Ue=Ke;var Ge=r(8848),$e=r(42853),Qe=r(32163);function Xe(e){window.__c={n:"SearchExperimentFilterPopupButton"};const t=(0,i.Fy)();return(0,xe.jsx)(te.ZP,{popupType:t.isMobile?te.Z4.SlideUp:te.Z4.Popup,renderOrigin:t=>(0,xe.jsx)(Je,{events:t,...e}),render:t=>(0,xe.jsx)(Ye,{parent:t,...e})})}function Ye(e){let{parent:t,experiment:r,searchExperimentOverrides:s,onChange:n}=e;window.__c={n:"SearchExperimentFilterMenu"};const a=(0,i.Fy)(),l=(0,o.yK)((()=>({menuOptionStyle:{color:Ge.ZP.mediumTextColor}})),[]);let d;d=a.isMobile?{menuType:g.og.Modal,title:r.experimentId,right:(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Done",id:"appearanceSettings.modal.done"}),onClickRight:t.close}:{menuType:g.og.Popup,width:250};const c=r.groups.map((e=>({key:e,action:s=>{n({experimentId:r.experimentId,group:e}),t.close()},render:(t,r)=>(0,xe.jsx)(ee.Z,{...t,title:e,style:l.menuOptionStyle})})));return(0,xe.jsx)(T.Z,{...d,children:(0,xe.jsx)(Qe.Z,{type:Qe.i.Vertical,initialFocus:void 0,sections:[{key:r.experimentId,render:e=>(0,xe.jsx)(ie.Z,{...e}),items:c}]})})}function Je(e){let{experiment:t,events:r,searchExperimentOverrides:i}=e;window.__c={n:"SearchExperimentFilterMenuButton"};const n=(0,o.yK)((e=>({experimentGroupButtonChevronStyle:{width:10,fill:e.lightIconColor},experimentGroupButtonStyle:{overflowX:"hidden",justifyContent:"left",overflow:"hidden",marginLeft:6,color:e.mediumTextColor},rowContainer:{display:"flex",overflow:"hidden",flexDirection:"row"},groupCell:{overflow:"hidden",marginRight:4}})),[]);return(0,s.createElement)(se.Z,{...r,isSmall:!0,key:t.experimentId,style:n.experimentGroupButtonStyle},(0,xe.jsxs)("div",{style:n.rowContainer,children:[(0,xe.jsx)("div",{style:n.groupCell,children:i[t.experimentId]||t.group}),(0,xe.jsx)("div",{children:(0,$e.i)(n.experimentGroupButtonChevronStyle)})]}))}const et=e=>({fontSize:14,lineHeight:1.2,color:e.mediumTextColor,marginRight:4,display:"flex",alignItems:"center",whiteSpace:"nowrap"}),tt=function(e){window.__c={n:"SearchExperimentFilter"};const{experiment:t}=e,{leftOverrides:r,rightOverrides:i,experimentDiffers:a,experimentAgreesButNondefault:l}=(0,n.VK)((()=>{const e=M.v_.state.searchExperimentOverrides,r=M.BJ.state.searchExperimentOverrides,s=(e[t.experimentId]??t.group)!==(r[t.experimentId]??t.group);return{leftOverrides:e,rightOverrides:r,experimentDiffers:s,experimentAgreesButNondefault:!s&&void 0!==r[t.experimentId]&&e[t.experimentId]!==t.group}}),[t]),d=(0,o.yK)((e=>({rowContainer:{backgroundColor:a?e.equationErrorPlaceholderBackground:l?e.accentColors.yellow[100]:void 0},titleCell:{...et(e),maxWidth:180,textOverflow:"ellipsis",overflow:"hidden"}})),[l,a]),c=(0,s.useCallback)((e=>{const{experimentId:t,group:r,store:s}=e;s.setState({...s.state,searchExperimentOverrides:{...s.state.searchExperimentOverrides,[t]:r}})}),[]);return(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)("div",{style:{...d.titleCell,...d.rowContainer},children:t.experimentId.replace("search-","")}),(0,xe.jsx)("div",{style:d.rowContainer,children:(0,xe.jsx)(Xe,{experiment:t,searchExperimentOverrides:r,onChange:e=>{c({...e,store:M.v_})}})}),(0,xe.jsx)("div",{style:d.rowContainer,children:(0,xe.jsx)(Xe,{experiment:t,searchExperimentOverrides:i,onChange:e=>{c({...e,store:M.BJ})}})})]})};var rt=r(53877),st=r(42875),it=r(22686);let nt=function(e){return e[e.Button=0]="Button",e[e.MenuItem=1]="MenuItem",e}({});class ot extends A.Z{constructor(){super(...arguments),this.handleFilterClick=e=>{const{onMenuDismiss:t}=this.props;!function(e){j.ZP.updateFilters(e)}(e),j.ZP.isDebugSidebarOpen()||j.ZP.setState({...j.ZP.state,isDebugSidebarOpen:!0}),t&&t()},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},buttonFilter:{padding:"4px 8px",display:"flex",alignItems:"center",overflow:"hidden"},buttonText:{...z.Z.textOverflowStyle},icon:{display:"inline-block",height:14,width:14,fill:"currentColor"},buttonIcon:{marginRight:6}}}renderComponent(){const{mode:e}=this.props;return e===nt.Button?this.renderAsButton():e===nt.MenuItem?this.renderAsMenuItem():void(0,H.t1)(e)}renderAsButton(){const{icon:e,title:t,filter:r}=this.props,s=this.styles,i=ct(this.props.isLastInSection,this.environment,this.theme);return(0,xe.jsxs)(J.Z,{style:{...s.buttonFilter,...i.buttonFilter},onClick:()=>this.handleFilterClick(r),children:[e&&e({...s.icon,...s.buttonIcon}),(0,xe.jsx)("span",{style:s.buttonText,children:t})]})}renderAsMenuItem(){const{icon:e,title:t,filter:r,focused:s}=this.props,i=this.styles,n=ct(this.props.isLastInSection,this.environment,this.theme),o={...i.menuItem,...n.menuItem};return(0,xe.jsx)(ee.Z,{icon:e&&e(i.icon),focused:s,title:t,onClick:()=>this.handleFilterClick(r),style:o})}}ot.displayName="SearchFilterPreset",ot.Mode=nt;class at extends A.Z{renderComponent(){const e=at.getCurrentPageFilter();if(e)return(0,xe.jsx)(ot,{icon:ae.j,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.quickFilters.inCurrentPage",defaultMessage:"In current page"}),filter:e,...this.props})}static isActive(e){const t=at.getCurrentPageFilter();if(!t)return!1;if(!t.ancestors)return!1;const r=t.ancestors[0];return-1!==e.ancestors.indexOf(r)}}at.displayName="InCurrentPagePreset",at.getCurrentPageFilter=()=>{const{mainEditorCurrentBlockStore:e}=S.default.state;if(e&&e.id)return{ancestors:[e.id]}};class lt extends A.Z{renderComponent(){const e=lt.getCurrentUserFilter(this.environment);if(e)return(0,xe.jsx)(ot,{icon:it.f,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.quickFilters.createdByMe",defaultMessage:"Created by me"}),filter:e,...this.props})}static isActive(e,t){const r=lt.getCurrentUserFilter(e);if(!r)return!1;if(!r.createdBy)return!1;const s=r.createdBy[0];return-1!==t.createdBy.indexOf(s)}}lt.displayName="CreatedByMePreset",lt.getCurrentUserFilter=e=>{const{id:t}=e.currentUser;if(t)return{createdBy:[t]}};class dt extends A.Z{renderComponent(){const e=dt.getPastWeekFilter();if(e)return(0,xe.jsx)(ot,{icon:_.C,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.quickFilters.editedLastWeek",defaultMessage:"Edited last week"}),filter:e,...this.props})}static isActive(e){const{lastEditedTime:t}=dt.getPastWeekFilter();return l.Xy(t,e.lastEditedTime)}}dt.displayName="EditedLastWeekPreset",dt.getPastWeekFilter=()=>({lastEditedTime:{starting:rt.Oo((0,st.r)()),ending:rt.Lg((0,st.r)())}});function ct(e,t,r){const{device:s}=t;return{menuItem:{color:s.isDesktop?r.mediumTextColor:void 0,...e&&{boxShadow:void 0}},buttonFilter:{color:r.mediumTextColor}}}var ut=r(1743),ht=r(74194);function pt(e){window.__c={n:"SearchStringOverrideControls"};const{leftValue:t,rightValue:r,setLeftValue:i,setRightValue:n,placeholder:a,label:l}=e,{titleCell:d,rightTitleCell:c,leftTitleCell:u}=(0,o.yK)((e=>{const s=et(e);return{titleCell:s,rightTitleCell:{...s,color:r?s.color:e.lightTextColor,width:"95%"},leftTitleCell:{...s,color:t?s.color:e.lightTextColor,width:"95%"}}}),[t,r]),[h,p]=(0,s.useState)(r),[m,g]=(0,s.useState)(t);(0,s.useEffect)((()=>{void 0===r&&p(void 0),void 0===t&&g(void 0)}),[r,t]);const f=(0,s.useCallback)((()=>{n(h)}),[n,h]),v=(0,s.useCallback)((()=>{i(m)}),[i,m]),y=(0,s.useCallback)((e=>{p(e.target.value)}),[]),x=(0,s.useCallback)((e=>{g(e.target.value)}),[]);return(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)("div",{style:d,children:l}),(0,xe.jsxs)(ut.Z,{capture:!0,allowMenuList:!1,children:[(0,xe.jsx)(ht.Z,{style:u,onBlur:v,value:m,onChange:x,placeholder:a}),(0,xe.jsx)(ht.Z,{style:c,onBlur:f,value:h,onChange:y,placeholder:a})]})]})}let mt=function(e){return e.Button="Button",e.Section="Section",e}({});class gt extends A.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:Q.Z},this.renderAddFilterOrigin=e=>{const t=this.styles;return(0,xe.jsx)(se.Z,{...e,style:t.addFilterButtonMobile,icon:D.I,isBlue:!0,children:(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Add filter",id:"search.addFilter.button.label"})})},this.renderAddFilterMenu=()=>(0,xe.jsxs)(T.Z,{menuType:g.og.ActionSheet,children:[this.renderSuggestedFilters(),(0,xe.jsxs)(ze.Z,{title:(0,xe.jsx)(It,{}),children:[this.renderCreatedByFilter(ye.Z.Mode.Button),this.renderCreatedTimeFilter(ye.Z.Mode.Button),this.renderLastEditedTimeFilter(ye.Z.Mode.Button),this.renderAncestorFilter(ye.Z.Mode.Button),this.renderInTeamFilter(ye.Z.Mode.Button)]})]}),this.searchExperimentsToToggle=this.createComputedStore((()=>Object.entries(O.g6).map((e=>{let[t,r]=e;return{experimentId:t,experimentVersion:1,group:X.default.getGroup(t),groups:["control",...r]}})))),this.closeAddFilterMenu=()=>{const{buttonPopupStore:e}=this.stores;e.setState({...e.state,open:!1})},this.styles={sidebar:{paddingTop:12,paddingBottom:24,overflowY:"auto",overflowX:"hidden",flex:"0 0 250px",minHeight:400},sidebarHidden:{display:"none"},addFilterButtonMobile:{fontSize:this.props.isMobile?z.Z.fontSize.UISmall.mobile:z.Z.fontSize.UISmall.desktop,fontWeight:z.Z.fontWeight.medium,marginRight:-8}}}renderComponent(){return this.props.isMobile?this.props.mode===mt.Button?this.renderAddButtonMobile():this.props.mode===mt.Section?this.renderActiveFiltersMobile():void(0,H.t1)(this.props.mode):this.renderSidebar()}renderActiveFiltersMobile(){const{state:e}=j.ZP,t=v.De(e.query.filters);return(0,xe.jsxs)(ie.Z,{disableMobilePadding:!0,disableMobileBorders:!0,children:[(0,xe.jsx)(wt,{mode:ye.z.Section}),(0,xe.jsx)(Mt,{mode:ye.z.Section}),this.renderActiveFilters(t,ye.Z.Mode.Section)]})}renderAddButtonMobile(){const{buttonPopupStore:e}=this.stores;return(0,xe.jsx)(te.ZP,{popupType:te.Z4.SlideUp,buttonPopupStore:e,renderOrigin:this.renderAddFilterOrigin,render:this.renderAddFilterMenu})}renderActiveFilters(e,t){return(0,xe.jsxs)(s.Fragment,{children:[e.createdBy&&this.renderCreatedByFilter(t),e.createdTime&&this.renderCreatedTimeFilter(t),e.lastEditedTime&&this.renderLastEditedTimeFilter(t),e.ancestors&&this.renderAncestorFilter(t),e.inTeams&&this.renderInTeamFilter(t)]})}renderSuggestedFilters(){const{filters:e}=j.ZP.state.query,t=lt.isActive(this.environment,e),r=dt.isActive(e),s=at.isActive(e);if(!(t&&r&&s))return(0,xe.jsxs)(ze.Z,{title:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.quickFiltersSection.title",defaultMessage:"Quick filters"}),marginAfter:!0,children:[!t&&(0,xe.jsx)(lt,{mode:nt.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!r&&(0,xe.jsx)(dt,{mode:nt.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!s&&(0,xe.jsx)(at,{mode:nt.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu,isLastInSection:!0})]})}renderSidebar(){const e=this.styles,t={sidebar:{backgroundColor:(r=this.theme).sidebarSecondaryBackground,borderLeft:`1px solid ${r.regularDividerColor}`}};var r;const s={...e.sidebar,...t.sidebar,...!j.ZP.isDebugSidebarOpen()&&e.sidebarHidden},i=(0,f.bN)(this.environment);return(0,xe.jsxs)("aside",{style:s,children:[(0,xe.jsx)(J.Z,{onClick:kt,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16,position:"absolute",top:10,right:10,...i&&(0,G.X)({noDrag:!0})},children:(0,E.D)({width:14,fill:this.theme.mediumTextColor})}),this.renderDevToolsSection()]})}renderDevToolsSection(){if((0,W.x)(U.default))return(0,xe.jsx)(ze.Z,{title:"Dev Tools",children:(0,xe.jsx)(Y.Z,{isVisible:!0,animationStyle:{height:"100%"},render:()=>(0,xe.jsxs)("div",{style:{overflow:"scroll"},children:[(0,xe.jsx)(bt,{}),(0,xe.jsx)(Ct,{}),(0,xe.jsx)(St,{}),(0,xe.jsxs)(ze.Z,{style:{marginTop:16},title:"Quick Switch",children:[(0,xe.jsx)(vt,{title:"No local at all",searchExperimentOverrides:{"search-no-local-blending":"on","search-debug-only-no-recent-boosting":"on"}}),(0,xe.jsx)(vt,{title:"No local results",searchExperimentOverrides:{"search-no-local-blending":"on"}}),(0,xe.jsx)(vt,{title:"No local boosting",searchExperimentOverrides:{"search-debug-only-no-recent-boosting":"on"}}),(0,xe.jsx)(vt,{title:"Vector only",searchExperimentOverrides:{"search-vectors":"log-norm"}})]}),(0,xe.jsx)(ze.Z,{style:{marginTop:16},title:"Dev Experiments",right:(0,xe.jsx)(se.Z,{onClick:()=>{M.v_.reset(),M.BJ.reset()},style:{paddingLeft:0,paddingRight:0,height:"unset"},children:(0,V.b)({width:12})}),children:(0,xe.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr 1fr",minWidth:"100%",maxWidth:"100%",paddingLeft:14},children:[(0,xe.jsx)("div",{}),(0,xe.jsx)("div",{}),(0,xe.jsx)(ft,{columnStore:M.BJ}),this.searchExperimentsToToggle.state.map((e=>(0,xe.jsx)(tt,{experiment:e},e.experimentId))),(0,xe.jsx)(pt,{leftValue:M.v_.state.forcedClusterPattern,rightValue:M.BJ.state.forcedClusterPattern,setLeftValue:M.v_.updateForcedClusterPattern,setRightValue:M.BJ.updateForcedClusterPattern,placeholder:"cluster-pattern",label:"forced cluster pattern"}),(0,xe.jsx)(pt,{leftValue:M.v_.state.forcedBlockIds,rightValue:M.BJ.state.forcedBlockIds,setLeftValue:M.v_.updateForcedBlockIds,setRightValue:M.BJ.updateForcedBlockIds,placeholder:"block ids",label:"forced block ids"})]})})]})})})}renderAncestorFilter(e){const{filters:t}=j.ZP.state.query;return(0,xe.jsx)(Z.SearchStoresContext.Consumer,{children:r=>{let{parentStore:s}=r;return(0,xe.jsx)(Me,{mode:e,focused:!1,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In"}),parentStore:s,blockIds:t.ancestors,onMenuDismiss:this.closeAddFilterMenu,onChange:xt("ancestors")})}})}renderCreatedByFilter(e){const{filters:t}=j.ZP.state.query;return(0,xe.jsx)(Z.SearchStoresContext.Consumer,{children:r=>{let{parentStore:s}=r;return(0,xe.jsx)(Pe.Z,{mode:e,focused:!1,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFilters.createdBy",defaultMessage:"Created by"}),parentStore:s,userIds:t.createdBy,onMenuDismiss:this.closeAddFilterMenu,onChange:xt("createdBy")})}})}renderCreatedTimeFilter(e){const{filters:t}=j.ZP.state.query;return(0,xe.jsx)(ne.Z,{mode:e,focused:!1,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"}),icon:_.C,value:t.createdTime,onMenuDismiss:this.closeAddFilterMenu,onChange:xt("createdTime")})}renderLastEditedTimeFilter(e){const{filters:t}=j.ZP.state.query;return(0,xe.jsx)(ne.Z,{mode:e,focused:!1,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),icon:_.C,value:t.lastEditedTime,onMenuDismiss:this.closeAddFilterMenu,onChange:xt("lastEditedTime")})}renderInTeamFilter(e){if(!(0,$.bq)())return;const{filters:t}=j.ZP.state.query;return(0,xe.jsx)(Z.SearchStoresContext.Consumer,{children:r=>{let{parentStore:s}=r;return(0,xe.jsx)(Le,{mode:e,focused:!1,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace"}),parentStore:s,teamIds:t.inTeams,onMenuDismiss:this.closeAddFilterMenu,onChange:xt("inTeams")})}})}}function ft(e){let{columnStore:t}=e;window.__c={n:"ExperimentColumnShowHeader"};const r=(0,n.VK)((()=>t.state.visible),[t]);return(0,xe.jsx)(ee.Z,{icon:(0,xe.jsx)(re.Z,{checked:r,size:14,onClick:()=>t.update((e=>({...e,visible:!e.visible})))}),focused:!1,title:"Show",onClick:()=>t.update((e=>({...e,visible:!e.visible})))})}function vt(e){let{title:t,searchExperimentOverrides:r}=e;return(0,xe.jsx)(ee.Z,{focused:!1,title:t,onClick:()=>{M.BJ.update((e=>({...e,visible:!1}))),M.v_.update((e=>({...e,searchExperimentOverrides:r})))}})}gt.displayName="SearchFilterMenu";const yt=gt;function xt(e){return t=>j.ZP.updateFilters({[e]:t})}function St(){return null}function bt(){window.__c={n:"ShowDebugInfoToggle"};const e=(0,n.VK)((()=>M.ZP.state.showDebugInfo),[]);return(0,xe.jsx)(Ue,{mode:ye.z.Button,focused:!1,title:"Show debug info",icon:L.S,value:e,onChange:e=>{M.ZP.setState({...M.ZP.state,showDebugInfo:Boolean(e)})}})}function Ct(){window.__c={n:"ShowDebugSearchToggle"};const e=(0,n.VK)((()=>"everything"===M.ZP.state.debug),[]);return(0,xe.jsx)(Ue,{mode:ye.z.Button,focused:!1,title:"Profile query",icon:L.S,value:e,onChange:e=>{M.ZP.setState({...M.ZP.state,debug:e?"everything":void 0})}})}function Mt(e){let{mode:t}=e;window.__c={n:"DeletedOnlyFilter"};const r=(0,n.VK)((()=>j.ZP.state.query.filters),[]);return(0,xe.jsx)(Ue,{mode:t,focused:!1,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.deletedOnlyToggle.label",defaultMessage:"Deleted only"}),icon:q.y,value:r.isDeletedOnly||!1,onChange:xt("isDeletedOnly")})}function It(){return(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFiltersSection.title",defaultMessage:"More filters"})}function jt(e){j.ZP.updateFilters({navigableBlockContentOnly:e})}function kt(){j.ZP.update((e=>({...e,isDebugSidebarOpen:!1})))}function wt(e){let{mode:t}=e;window.__c={n:"TitlesOnlyFilterComponent"};const{filters:r}=(0,n.VK)((()=>j.ZP.state.query),[]);return(0,xe.jsx)(Ue,{mode:t,focused:!1,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Title only"}),icon:N.c,value:r.navigableBlockContentOnly||!1,onChange:jt})}var Pt=r(28992),Tt=r(98519),Ft=r(4023),Rt=r(7931);const Bt=function(e){window.__c={n:"SearchSortMenu"};const t=s.useRef(),r=(0,i.Fy)(),{isMobile:n}=r,{activeOption:a,items:l}=s.useMemo((()=>function(e){const{currentSortBy:t,setSortBy:r,sortOptions:s,selectButton:i}=e;let n=s[0];const o=s.map((e=>{const s=t.field,o=`${s}.${"relevance"===s?"":t.direction}`,a=e.key===o;return a&&(n=e),{key:e.key,action:()=>{r(e.sort),i&&i.current&&i.current.closeMenu()},render:t=>(0,xe.jsx)(ee.Z,{...t,title:e.formattedName,right:a&&(0,Tt.k)({fill:Ge.ZP.regularIconColor,width:14,height:14})})}}));return{activeOption:n,items:o}}({...e,selectButton:t})),[e,t]),d=(0,o.yK)((e=>({selectedTitle:{color:e.mediumTextColor},label:{marginRight:2,fontSize:n?z.Z.fontSize.UISmall.mobile:z.Z.fontSize.UISmall.desktop,transform:"translateY(0.5px)"},innerButton:{color:e.mediumTextColor,fontWeight:z.Z.fontWeight.semibold,fontSize:n?z.Z.fontSize.UISmall.mobile:z.Z.fontSize.UISmall.desktop,height:20,padding:"2px 4px",marginRight:1,transform:"translateY(0.5px)"},menu:{minWidth:200}})),[n]),c=n?(0,xe.jsx)(K.FormattedMessage,{id:"search.sort.sortMenuTitle",defaultMessage:"Sort By"}):void 0;return(0,xe.jsx)(Rt.Z,{ref:e=>{e&&(t.current=e)},alignmentToOrigin:Ft.v.Start,selectedTitle:(0,xe.jsx)("div",{style:d.selectedTitle,children:a.formattedName}),label:void 0,renderMenuSections:()=>[{key:"searchSortOrder",render:e=>(0,xe.jsx)(ze.Z,{...e,title:c,desktopStyle:d.menu,disableDesktopPadding:!1}),items:l}],labelStyle:d.label,innerButtonStyle:d.innerButton})};class Zt extends A.Z{constructor(){super(...arguments),this.styles={menuItemMobile:{paddingBottom:0},titleWrapper:{flex:void 0,marginTop:-3,marginBottom:-1},showSidebarButton:()=>{const{device:e}=this.environment;return{padding:"0 4px",fontSize:e.isMobile?z.Z.fontSize.UISmall.mobile:z.Z.fontSize.UISmall.desktop,fontWeight:z.Z.fontWeight.medium,borderRadius:4,height:20,lineHeight:"20px"}}}}renderComponent(){const{device:e}=this.environment,t=this.styles,r={...e.isMobile&&t.menuItemMobile},s=!this.props.isPublicPageSearch&&(0,xe.jsx)(_t,{});return(0,xe.jsx)(Pt.Z,{title:(0,xe.jsx)(Lt,{}),right:s,textWrapperStyle:t.titleWrapper,style:r})}}Zt.displayName="SearchHeader";const At=[{key:"relevance.",formattedName:(0,xe.jsx)(K.FormattedMessage,{id:"search.sort.sortOrder.bestMatches",defaultMessage:"Best matches"}),sort:{field:"relevance"}},{key:"lastEdited.desc",formattedName:(0,xe.jsx)(K.FormattedMessage,{id:"search.sort.sortOrder.lastEdited.newestFirst",defaultMessage:"Last edited: Newest first"}),sort:{field:"lastEdited",direction:"desc"}},{key:"lastEdited.asc",formattedName:(0,xe.jsx)(K.FormattedMessage,{id:"search.sort.sortOrder.lastEdited.oldestFirst",defaultMessage:"Last edited: Oldest first"}),sort:{field:"lastEdited",direction:"asc"}},{key:"created.desc",formattedName:(0,xe.jsx)(K.FormattedMessage,{id:"search.sort.sortOrder.created.newestFirst",defaultMessage:"Created: Newest first"}),sort:{field:"created",direction:"desc"}},{key:"created.asc",formattedName:(0,xe.jsx)(K.FormattedMessage,{id:"search.sort.sortOrder.created.oldestFirst",defaultMessage:"Created: Oldest first"}),sort:{field:"created",direction:"asc"}}],Ot=Zt;function Lt(){window.__c={n:"SortMenu"};const e=(0,n.VK)((()=>j.ZP.state.query.sort),[]);return(0,xe.jsx)(Bt,{currentSortBy:e,setSortBy:e=>{j.ZP.setState({...j.ZP.state,query:{...j.ZP.state.query,sort:e}})},sortOptions:At})}function _t(){window.__c={n:"AddFilterButton"};const e=(0,i.O7)(),{device:t}=e;return t.isMobile?(0,xe.jsx)(yt,{isMobile:!0,mode:mt.Button}):null}var Et=r(86244),Dt=(r(57658),r(11751)),Vt=r(87531),qt=r(44458),Nt=r(16091),Wt=r(38755),Ht=r(21273),zt=r(98180),Kt=r(69327),Ut=r(29798),Gt=r(88923),$t=r(27724),Qt=r(43145),Xt=r(94184),Yt=r.n(Xt),Jt=r(8597),er=r(75e3),tr=r(63296),rr=r(64369);function sr(e,t){window.__c={n:"SearchActionMenuItem"};const{inline:r,title:s,focused:i,className:n,blueOutlineFocused:a,compact:l,shouldShowArrowUp:d}=e,{icon:c,...u}=e,h=(0,o.yK)((e=>({hoveredStyle:{background:e.buttonHoveredBackground}})),[]),p=(0,o.yK)((e=>({style:{minHeight:36,paddingTop:8,paddingBottom:8,width:l?"min-content":"100%",display:"flex",...a?{boxShadow:e.focusedShadow,borderRadius:6}:{}},textWrapper:{marginLeft:4,alignItems:void 0,flex:void 0,display:"block",textOverflow:"ellipsis",...r&&{alignItems:"baseline"}},icon:{display:"block",flexShrink:0,height:18,width:18,color:e.mediumTextColor,overflow:"visible",marginRight:6},enterIcon:{height:12,width:12,fill:e.mediumIconColor},iconContainer:{overflow:"visible"},compactButtonHover:{background:e.buttonHoveredBackground},compactButton:{borderRadius:44,marginLeft:10,marginRight:10,padding:"6px 12px",display:"inline-flex",boxShadow:a?e.focusedShadow:void 0,maxWidth:"calc(100% - 20px)"},menuItem:{overflow:"hidden"},menuItemTextWrapper:{marginLeft:0,marginRight:0},right:{marginLeft:i?8:void 0,marginRight:2}})),[r,a,i,l]),m={title:s,icon:c?ir(c,p.icon,p.iconContainer):void 0,style:p.style,textWrapperStyle:p.textWrapper,right:d?(0,Jt.Z)(p.enterIcon):nr(i,p.enterIcon),className:Yt()("notranslate",n),buttonStyle:{paddingLeft:2,width:l?"min-content":void 0},hoveredStyle:h.hoveredStyle};return l?(0,xe.jsx)(tr.Z,{style:p.compactButton,icon:e=>m.icon,...u,ref:t,hoveredStyle:p.compactButtonHover,children:(0,xe.jsx)(Pt.Z,{title:(0,xe.jsx)("div",{style:p.menuItem,children:s}),textWrapperStyle:p.menuItemTextWrapper,style:p.menuItem,allowTextSelection:void 0,right:i?m.right:void 0,rightStyle:p.right})}):(0,xe.jsx)(ee.Z,{...u,...m,disableTransition:!0,ignoreLocalHoverState:!0,ref:t})}function ir(e,t,r){return(0,xe.jsx)(rr.Z,{style:r,children:e(t)})}function nr(e,t){const r={...t,opacity:e?1:0};return(0,xe.jsx)("div",{style:{display:"flex"},children:(0,er.U)(r)})}const or=s.forwardRef(sr);var ar=r(18442),lr=r(75024);class dr extends A.Z{constructor(){super(...arguments),this.styles={footer:()=>{const{device:e}=this.environment;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:e.isMobile?z.Z.fontSize.UIRegular.mobile:z.Z.fontSize.UIRegular.desktop}},footerWrapper:{flexShrink:0},footerText:{color:this.theme.lightTextColor,fontSize:lr.yv(this.environment,"UISmall"),...z.Z.textOverflowStyle},footerDebugButton:{...cr(this.theme),marginRight:6},debugGearIcon:{color:this.theme.accentColors.gray[400]},hoveredDebugGearIcon:{color:this.theme.accentColors.gray[600]}}}renderComponent(){const e=this.styles;return(0,xe.jsx)("footer",{style:e.footerWrapper,children:(0,xe.jsxs)(ie.Z,{topBorder:!0,style:e.footer(),disableDesktopPadding:!0,children:[(0,xe.jsx)(Pt.Z,{...this.props,style:e.footerText}),(0,W.x)(U.default)&&!j.ZP.state.isDebugSidebarOpen&&(0,xe.jsx)(se.Z,{onClick:()=>j.ZP.setState({...j.ZP.state,isDebugSidebarOpen:!0}),isSmall:!0,style:e.debugGearIcon,hoveredStyle:e.hoveredDebugGearIcon,children:(0,ar.H)({width:12,height:12})})]})})}}dr.displayName="SearchFooterContainer";const cr=e=>({fontSize:12,color:e.lightTextColor,marginLeft:6,paddingRight:4,paddingLeft:4,height:24}),ur=dr;var hr=r(41892),pr=r(22109),mr=r(43039),gr=r(50906),fr=r(47839),vr=r(62134),yr=r(86706),xr=r(24042),Sr=r(58261),br=r(74420),Cr=r(26388);function Mr(){window.__c={n:"SearchFooterNavigationHints"};const e=(0,i.O7)(),t=(0,K.useIntl)(),{isQuickSearch:r}=(0,s.useContext)(Z.SearchStaticContext),a=(0,o.yK)((t=>({listStyle:{...lr.mK,...z.Z.textOverflowStyle,display:"inline-flex",fontSize:lr.yv(e,"UISmall"),color:t.lightTextColor,gap:20},upDownIcon:{marginBottom:-2,display:"inline",width:12,height:12,fill:t.mediumIconColor},enterIcon:{marginBottom:-2,display:"inline",width:11,height:11,fill:t.mediumIconColor},commandGlyph:{fontSize:.75*lr.yv(e,"UIRegular"),paddingRight:1,color:t.mediumIconColor},inlineHint:{display:"flex",gap:6,alignItems:"center"},forwardSlash:{fontSize:9,userSelect:"none",fontWeight:500,display:"flex",lineHeight:1.4},toggleSidePeekHotkey:{display:"inline-flex",marginRight:4}})),[e]),l=(0,n.VK)((()=>(0,f.rd)(e)),[e]),d=(0,n.VK)((()=>e.device.isElectron&&(l||r)),[e.device.isElectron,r,l]),[c,u]=(0,n.VK)((()=>{const t=j.ZP.state.query.text.length>0;return[l&&X.default.checkGate("search_toggle_side_peek")&&t,(0,f.Qi)(e)]}),[e,l]),h=(0,s.useCallback)((()=>{(I.default.state.open||I.default.state.openAsPage)&&gr.Snb(e,{searchSessionId:I.default.state.sessionId})}),[e]),{command:p}=vr.fg(e);return(0,xe.jsxs)("ul",{style:a.listStyle,children:[(0,xe.jsxs)("li",{style:a.inlineHint,children:[(0,pr.T)(a.upDownIcon),t.formatMessage({id:"searchFooter.helpText.selectHint",defaultMessage:"Select"})]}),(0,xe.jsxs)("li",{style:a.inlineHint,children:[(0,er.U)(a.enterIcon),t.formatMessage({id:"searchFooter.helpText.openHint",defaultMessage:"Open"})]}),r?(0,xe.jsxs)("li",{style:a.inlineHint,children:[(0,xe.jsx)(Sr.Z,{name:"copyLinkToCurrentPage"}),t.formatMessage({id:"searchFooter.helpText.copyLink",defaultMessage:"Copy link"})]}):void 0,d?(0,xe.jsx)("li",{style:a.inlineHint,onClick:()=>{h(),fr.openQuickSearchShortcutSetting()},children:(0,xe.jsx)(Ir,{environment:e,containerStyles:a.inlineHint})}):void 0,l?null:(0,xe.jsxs)("li",{style:a.inlineHint,children:[(0,xe.jsxs)("span",{children:[(0,xe.jsx)("span",{style:a.commandGlyph,children:p}),(0,er.U)(a.enterIcon)]}),t.formatMessage({id:"searchFooter.helpText.openNewTab",defaultMessage:"Open in a new tab"})]}),c?(0,xe.jsxs)("li",{style:a.inlineHint,children:[(0,xe.jsxs)("span",{style:a.toggleSidePeekHotkey,children:[(0,xe.jsx)("span",{style:a.commandGlyph,children:p}),(0,xe.jsx)("span",{style:a.forwardSlash,children:"\\"})]}),u?t.formatMessage({id:"searchFooter.helpText.closeSidePeek",defaultMessage:"Close preview"}):t.formatMessage({id:"searchFooter.helpText.openSidePeek",defaultMessage:"Preview"})]}):null]})}function Ir(e){window.__c={n:"CommandSearchFooterShortcut"};const{environment:t,containerStyles:r}=e,[i,a]=(0,s.useState)(!1),l=(0,o.yK)((e=>({container:{...r,cursor:"pointer"},commandSearchHint:{display:"flex",alignItems:"center"},commandText:{padding:"2px 4px",borderRadius:4,background:i?e.buttonHoveredBackground:void 0},hintAndBadgeContainer:{display:"flex",gap:3,alignItems:"center",width:"max-content"},tooltip:{background:"transparent",boxShadow:"none"}})),[r,i]),d=(0,n.VK)((()=>t.device.isMac),[t.device.isMac]),c=(0,K.useIntl)(),u=(0,n.VK)((()=>{var e;const t=null===(e=xr.Z.state.preferences)||void 0===e?void 0:e.quickSearchShortcut;if(!t)return;const r=(0,yr.Uy)(t);return(0,yr.K9)(r,d)}),[d]),h=(0,s.useCallback)((()=>{(I.default.state.open||I.default.state.openAsPage)&&gr.Zb6(t,{searchSessionId:I.default.state.sessionId})}),[t]);return(0,xe.jsx)(Cr.Z,{delayThreshold:400,placement:Cr.Z.Placement.Bottom,originGap:8,disableTooltip:!d,renderTooltip:()=>(h(),(0,xe.jsx)(jr,{shortcut:u})),closeDelay:0,style:l.tooltip,render:e=>(0,xe.jsxs)("div",{...e,style:l.container,onClick:()=>fr.openQuickSearchShortcutSetting(),onMouseEnter:t=>{e.onMouseEnter&&e.onMouseEnter(t),i||a(!0)},onMouseLeave:t=>{e.onMouseLeave&&e.onMouseLeave(t),i&&setTimeout((()=>{a(!1)}),200)},children:[(0,xe.jsx)("span",{style:l.commandText,children:u}),(0,xe.jsx)("div",{style:l.commandSearchHint,children:i?(0,xe.jsx)("span",{children:c.formatMessage({id:"searchFooter.commandSearch.editText",defaultMessage:"Click to edit shortcut"})}):(0,xe.jsxs)("div",{style:l.hintAndBadgeContainer,children:[c.formatMessage({id:"searchFooter.commandSearch.defaultText",defaultMessage:"Command Search"}),(0,xe.jsx)(br.Z,{style:{marginLeft:0}})]})})]})})}function jr(e){window.__c={n:"CommandSearchTooltipHelper"};const{shortcut:t}=e,r=hr.Z.images.commandSearch.tooltipPng,[i,n]=(0,s.useState)(!1);(0,s.useEffect)((()=>{const e=new Image;e.src=r,e.onload=()=>{n(!0)}}),[r]);const a=(0,o.yK)((e=>({container:{width:260,borderRadius:8,backgroundColor:"transparent"},textContainer:{whiteSpace:"break-spaces",padding:15,display:"flex",flexDirection:"column",gap:1,backgroundColor:"light"===e.mode?e.accentColors.gray[700]:e.accentColors.gray[300],borderTopRightRadius:8,borderTopLeftRadius:8},description:{fontWeight:z.Z.fontWeight.regular,color:"light"===e.mode?e.accentColors.gray[300]:e.accentColors.gray[600]},image:{width:"100%"}})),[]);return i?(0,xe.jsxs)("div",{style:a.container,children:[(0,xe.jsxs)("div",{style:a.textContainer,children:[(0,xe.jsx)("div",{children:(0,xe.jsx)(K.FormattedMessage,{id:"searchFooter.commandSearch.tooltip.header",defaultMessage:"Use search and Q&A anywhere"})}),(0,xe.jsx)("div",{style:a.description,children:(0,xe.jsx)(K.FormattedMessage,{id:"searchFooter.commandSearch.tooltip.description",defaultMessage:"Try {shortcut} or click on {menuBarIcon} in your menubar to access search and Ask AI anytime, even with Notion minimized.",values:{shortcut:t,menuBarIcon:(0,xe.jsx)(kr,{})}})})]}),(0,xe.jsx)("img",{style:a.image,src:r})]}):null}function kr(){window.__c={n:"MenuBarIcon"};const e=(0,o.yK)((e=>({container:{display:"inline-block",position:"relative"},placeholder:{width:15,height:15,display:"inline-block"},flatMenuIcon:{position:"absolute",left:0,top:3,width:15,height:15,fill:"light"===e.mode?e.accentColors.gray[300]:e.accentColors.gray[600]}})),[]);return(0,xe.jsxs)("div",{style:e.container,children:[(0,xe.jsx)("span",{style:e.placeholder}),(0,mr.m)(e.flatMenuIcon)]})}var wr=r(49085);function Pr(e){var t;let{explanation:r,simple:s=!1,filterZeros:i=!1}=e;return function e(t,r){if(!t)return[];const{value:n,description:o,details:a}=t;if(0===n&&i)return[];const l=(0===n?"0":n.toFixed(4)).padStart(8);function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return`${"  ".repeat(r+t)}${e}`}const c=`[${l}] ${o}`;if(o.startsWith("match on required clause")){return[d(`[${l}] match on required clause ${null==a?void 0:a[1].description}`)]}if(["max of:","sum of:","min of:"].includes(o)&&1===(null==a?void 0:a.length))return e(a[0],r);if(o.startsWith("tf")||o.startsWith("idf")){var u;const e=o.split(",")[0],t=null===(u=o.split(" computed as ")[1])||void 0===u?void 0:u.replace(" from:","");return[d(`[${l}] ${e}: [${(a??[]).map((e=>`${e.description.split(",")[0]}=${e.value}`)).join(" ")}] --\x3e ${t}`)]}if(o.startsWith("ConstantScore(_id:"))return[d(`[${l}] ids query`)];const h=s&&0!==r&&(o.startsWith("weight")||o.startsWith("Function"));return[d(c.replace(", result of:","").replace(" from:","").replace(" [PerFieldSimilarity]","").replace(/:$/,"").trim()),...(h?[]:a??[]).flatMap((t=>e(t,r+1)))]}(null==r||null===(t=r.details)||void 0===t?void 0:t[0],0)}r(75553),r(32240);var Tr=r(94308),Fr=r(58203);var Rr=r(75018),Br=r(97820),Zr=r(28020),Ar=r(69988),Or=r(98742),Lr=r(98165),_r=r(16402),Er=r(35057),Dr=r(24039),Vr=r(90403),qr=r(64133),Nr=r(73063),Wr=r(50506),Hr=r(86176),zr=r(3043),Kr=r(96525);function Ur(e){window.__c={n:"SearchBreadcrumbFilterPopup"};const{parent:t,store:r,onClick:n}=e,o=(0,i.O7)(),{device:a}=o;let l;l=a.isMobile?{menuType:g.og.Modal,title:(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Breadcrumb",id:"breadcrumb.mobileBreadcrumbMenu.title"}),right:(0,xe.jsx)(F.DoneMenuText,{}),onClickRight:t.close}:{menuType:g.og.Popup,width:240};const d=(0,s.useCallback)((()=>{null==n||n({store:r,action:"include"})}),[n,r]),c=(0,s.useCallback)((()=>{null==n||n({store:r,action:"exclude"})}),[n,r]),u=r instanceof he.zX?"teamspace":"parent page",h={key:"results",render:e=>(0,xe.jsx)(ie.Z,{...e}),items:[{key:"include-filter",render:e=>(0,xe.jsx)(ee.Z,{...e,title:`Add ${u} to filter`}),action:d},{key:"exclude-filter",render:e=>(0,xe.jsx)(ee.Z,{...e,title:`Exclude ${u} from results`}),action:c}]};return(0,xe.jsx)(T.Z,{...l,children:(0,xe.jsx)(Qe.Z,{type:Qe.i.Vertical,onAccept:t.close,initialFocus:void 0,sections:[h]})})}const Gr={marginRight:3};class $r extends A.Z{constructor(){super(...arguments),this.getBreadcrumbCommonProps=e=>{return{maxWidth:this.props.ancestorMaxWidth,popupRenderer:Jr(e,this.props.onClick),iconSize:this.props.iconSize,titleStyle:(t=this.props.isMobile,r=this.theme,{lineHeight:1.2,fontSize:t?z.Z.fontSize.UISmall.mobile:z.Z.fontSize.UISmall.desktop,color:r.text.tertiary}),iconStyle:Gr,highlighter:this.props.highlighter};var t,r}}renderComponent(){const{store:e}=this.props,t=e.getTitleStore();var r,s,i;if(t&&t.isReady())return(0,xe.jsx)("div",{style:(r=this.props.isMobile,s=this.theme,i=this.props.style,{display:"flex",alignItems:"center",lineHeight:1.2,fontSize:r?z.Z.fontSize.UIRegular.mobile:z.Z.fontSize.UIRegular.desktop,color:s.text.tertiary,filter:"grayscale(70%)",...i}),className:"notranslate",children:this.renderAncestors()})}renderAncestors(){const{store:e,maxAncestorCount:t}=this.props,r=Lr.uJ(e),s=e.isNavigableBlock()?r.slice(1):[...r];if(s.reverse(),r.reverse(),s.length>t){const[e,i,n]=[s[0],s.slice(1,s.length-t+1),s.slice(s.length-t+1)];if((0,$.bq)()){const t=n.length;return[this.renderButtonForStore({store:e,showDivider:!this.props.isMobile}),(0,xe.jsx)(Yr,{isMobile:this.props.isMobile,style:this.props.style,onClick:this.props.onClick,stores:this.props.isMobile?r:i},"blocks-as-popup"),...n.map(((e,r)=>{const s=!this.props.hideCurrentPage||r!==t-1;return e instanceof he.zX?(0,xe.jsx)(zr.Yo,{store:e,showDivider:s,...this.getBreadcrumbCommonProps(e)},e.id):(0,xe.jsx)(zr.Qe,{store:e,showDivider:s,...this.getBreadcrumbCommonProps(e)},e.id)}))]}{const e=s.filter((e=>e instanceof he.G)),r=s.filter((e=>e instanceof he.G)),i=e.length;return[(0,xe.jsx)(zr.Qe,{store:e[0],showDivider:!this.props.isMobile,...this.getBreadcrumbCommonProps(e[0])},e[0].id),(0,xe.jsx)(Yr,{isMobile:this.props.isMobile,style:this.props.style,onClick:this.props.onClick,stores:this.props.isMobile?r:e.slice(1,e.length-t+1)},"blocks-as-popup"),...e.slice(e.length-t+1).map(((e,t)=>(0,xe.jsx)(zr.Qe,{store:e,showDivider:!this.props.hideCurrentPage||t!==i-1,...this.getBreadcrumbCommonProps(e)},e.id)))]}}{const e=s.length;return s.map(((t,r)=>this.renderButtonForStore({store:t,showDivider:!this.props.hideCurrentPage||r!==e-1})))}}renderButtonForStore(e){const{store:t,showDivider:r}=e;return t instanceof he.zX?(0,xe.jsx)(zr.Yo,{store:t,showDivider:r,...this.getBreadcrumbCommonProps(t)}):(0,xe.jsx)(zr.Qe,{store:t,showDivider:r,...this.getBreadcrumbCommonProps(t)})}}$r.displayName="SearchPathBreadcrumb";const Qr={marginLeft:3,marginRight:3};function Xr(e,t,r){const s=t?te.Z4.SlideUp:te.Z4.Popup;return[{key:"results",render:e=>(0,xe.jsx)(ie.Z,{...e}),items:e.map(((e,t)=>({key:e.id,render:i=>(0,xe.jsx)(Kr.Z,{...i,stopClickPropagation:!0,popupType:s,renderOrigin:r=>(0,xe.jsx)(me.Z,{...r,isSubpage:0!==t,store:e,hidePath:!0,focused:!1}),render:t=>(0,xe.jsx)(Ur,{parent:t,store:e,onClick:r})}),action:()=>{}})))}]}function Yr(e){let{stores:t,isMobile:r,style:s,onClick:i}=e;const n={display:"flex",alignItems:"center",flexShrink:0};return(0,xe.jsx)(te.ZP,{popupType:r?te.Z4.SlideUp:te.Z4.Popup,renderOrigin:e=>r?(0,xe.jsxs)(J.Z,{style:n,mobileFeedback:!0,...e,children:[(0,xe.jsx)(zr.fY,{}),(0,xe.jsx)("div",{style:Qr,children:"..."}),(0,xe.jsx)(zr.fY,{})]}):(0,xe.jsxs)("div",{style:n,children:[(0,xe.jsx)(se.Z,{isSmall:!0,...e,style:{paddingLeft:2,paddingRight:2,fontSize:null==s?void 0:s.fontSize},children:"..."}),(0,xe.jsx)(zr.fY,{})]}),render:e=>{let s;return s=r?{menuType:g.og.Modal,title:(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Breadcrumb",id:"breadcrumb.mobileBreadcrumbMenu.title"}),right:(0,xe.jsx)(F.DoneMenuText,{}),onClickRight:e.close}:{menuType:g.og.Popup,width:240},(0,xe.jsx)(T.Z,{...s,children:(0,xe.jsx)(Qe.Z,{type:Qe.i.Vertical,initialFocus:void 0,sections:Xr(t,r,i)})})}},"pages-popup")}function Jr(e,t){return r=>(0,xe.jsx)(Ur,{parent:r,store:e,onClick:t})}var es=r(66897),ts=r(95341),rs=r(96895),ss=r(90683);function is(e){window.__c={n:"SearchResultToolTip"};const{store:t}=e,r=(0,n.VK)((()=>{const e=t.getCreatedByPointer();if(e)return(0,es.Hl)({pointer:e,getRecordValue:t.getRecordValue})}),[t]),s=(0,n.VK)((()=>{const e=t.getLastEditedByPointer();if(e)return(0,es.Hl)({pointer:e,getRecordValue:t.getRecordValue})}),[t]),i=(0,o.yK)((e=>({container:{backgroundColor:Ge.FN.light.gray[900],display:"flex",flexDirection:"column",borderRadius:8},preview:{fontSize:14,color:Ge.FN.light.gray[100],fontWeight:400,display:"flex",gap:10,alignItems:"center"}})),[]),a=(0,K.useIntl)();return(0,xe.jsxs)("div",{style:i.container,children:[r&&(0,xe.jsx)(ns,{store:t,activity:"created",actor:r}),s&&(0,xe.jsx)(ns,{store:t,activity:"edited",actor:s}),(0,xe.jsxs)("div",{style:{padding:10,display:"flex",justifyContent:"space-between",cursor:"pointer",alignItems:"center"},onClick:()=>I.default.update((e=>({...e,preferSidePeekOpen:!0}))),children:[(0,xe.jsxs)("div",{style:i.preview,children:[(0,xe.jsx)("span",{children:(0,rs.q)({height:14,width:14})}),(0,xe.jsx)("span",{children:a.formatMessage({id:"searchResultMenuItem.tooltip.sidePeek",defaultMessage:"Preview"})})]}),(0,xe.jsx)("div",{style:{color:"#7F7F7F"},children:(0,ts.d)({height:14,width:14})})]})]})}function ns(e){window.__c={n:"UserActivity"};const{activity:t,actor:r,store:s}=e,i=(0,o.yK)((e=>({container:{display:"flex",flexDirection:"column",padding:"8px 10px 10px 10px",gap:8,borderBottom:`1px solid ${Ge.FN.light.gray[800]}`,minWidth:195},actorAvatarAndName:{display:"flex",alignItems:"center",gap:5},actorActivityInfo:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:10,fontSize:14},description:{color:"#7F7F7F",fontSize:12,fontWeight:600},date:{color:"#7F7F7F",fontSize:12}})),[]),[a]=(0,n.VK)((()=>{const e="created"===t?s.getCreatedTime():s.getLastEditedTime();return[(0,_r.IS)(e,{useCompactFormat:!0,useLowercase:!0})]}),[t,s]),l=(0,K.useIntl)();return(0,xe.jsxs)("div",{style:i.container,children:[(0,xe.jsx)("div",{style:i.description,children:"edited"===t?l.formatMessage({id:"searchResultMenuItem.tooltip.lastEditedBy",defaultMessage:"Last edited by"}):l.formatMessage({id:"searchResultMenuItem.tooltip.createdBy",defaultMessage:"Created by"})}),(0,xe.jsxs)("div",{style:i.actorActivityInfo,children:[(0,xe.jsxs)("div",{style:i.actorAvatarAndName,children:[(0,xe.jsx)("span",{children:(0,ss.a)({actor:r,size:20,style:{}})}),(0,xe.jsx)("span",{children:(0,es.$4)(l,r)})]}),(0,xe.jsx)("div",{style:i.date,children:a})]})]})}(0,K.defineMessages)({openInSidePeekButtonLabel:{id:"search.result.openInSidePeek.button.label",defaultMessage:"Open search result in side peek"},copySearchResultLinkButtonLabel:{id:"search.result.copyLink.button.label",defaultMessage:"Copy link to search result"}});class os extends A.Z{constructor(){super(...arguments),this.storeTypes={explanationModalOpen:wr.default.createClass(!1)},this.handleSearchPathBreadcrumbClick=e=>{let{store:t,action:r}=e;"block"===t.table?"include"===r?j.ZP.updateFilters({ancestors:l.jj(j.ZP.state.query.filters.ancestors.concat(t.id))}):j.ZP.updateFilters({dev_excludedPages:l.jj((j.ZP.state.query.filters.dev_excludedPages||[]).concat(t.id))}):"team"===t.table&&("include"===r?j.ZP.updateFilters({inTeams:l.jj((Re.iY(j.ZP.state.query.filters.inTeams)||[]).concat(t.id))}):j.ZP.updateFilters({dev_excludedTeams:l.jj((j.ZP.state.query.filters.dev_excludedTeams||[]).concat(t.id))}))},this.renderVerifiedBadge=e=>(0,xe.jsx)(Vr.Z,{style:this.styles.badge,content:(0,xe.jsxs)("div",{style:this.styles.badgeContent,children:[(0,Tr.f)(this.styles.verifiedBadgeIcon),(0,xe.jsx)("div",{style:this.styles.badgeCaption,children:e})]})}),this.renderPopularThisWeekBadge=e=>(0,xe.jsx)(Vr.Z,{style:this.styles.badge,content:(0,xe.jsx)("div",{style:this.styles.badgeCaption,children:e})}),this.renderMostViewedBadge=e=>(0,xe.jsx)(Vr.Z,{style:this.styles.badge,content:(0,xe.jsx)("div",{style:this.styles.badgeCaption,children:e})}),this.renderIsTemplateBadge=e=>(0,xe.jsx)(Vr.Z,{content:(0,xe.jsx)("div",{style:this.styles.grayedOutBadgeCaption,children:e})}),this.renderIsTeamArchivedBadge=()=>(0,xe.jsx)(Vr.Z,{content:(0,xe.jsx)("div",{style:this.styles.grayedOutBadgeCaption,children:(0,xe.jsx)(K.FormattedMessage,{id:"search.result.archived.badge.text",defaultMessage:"Archived"})})}),this.renderCurrentPageBadge=()=>(0,xe.jsx)(Vr.Z,{content:(0,xe.jsx)("div",{style:this.styles.grayedOutBadgeCaption,children:(0,xe.jsx)(K.FormattedMessage,{id:"search.result.current.page.badge.text",defaultMessage:"Current Page"})})}),this.handleOpenInSidePeek=()=>{const{store:e,queryId:t,result:r}=this.props,s=vs(this.props.type);r?Rr.navigateToSearchResult({searchResult:r,openInSidePeek:!0,environment:this.environment,pageVisitSource:s,queryId:t,openInNew:void 0}):Rr.navigateToPage({store:e,queryId:t,environment:this.environment,pageVisitSource:s,openInSidePeek:!0,peekMode:"s"})},this.handleCopy=()=>{const{store:e,queryId:t}=this.props,r=(0,m.ZP)({store:e,pageVisitSource:vs(this.props.type),queryId:t});u.RD({environment:this.environment,stringValue:r,copiedMessage:u.tq.copiedLinkToClipboard})},this.styles={title:{fontWeight:z.Z.fontWeight.medium,lineHeight:"20px"},titleContent:{display:"flex",...this.props.inline?{}:{width:0,flexGrow:1}},menuItem:{minHeight:36,paddingTop:this.environment.device.isMobile?12:8,paddingBottom:this.environment.device.isMobile?12:8},textWrapper:{marginLeft:4,alignItems:"center",width:"100%"},inlineTextWrapper:{alignItems:"center"},highlight:{fontWeight:z.Z.fontWeight.medium},vectorHighlight:{fontWeight:z.Z.fontWeight.medium,whiteSpace:"pre-wrap"},rightContentWrapper:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},rightIcon:{height:12,width:12},rightIconButtonIcon:{height:12,width:12},rightIconButtonWrapper:{height:18,width:18,marginRight:6},uniqueIDBadgeWrapper:{display:"flex",gap:8,marginRight:8,alignItems:"center"},caption:{marginTop:1},debugArea:{fontFamily:"monospace"},timestamp:{fontSize:z.Z.fontSize.UISmall.desktop,fontWeight:z.Z.fontWeight.regular},tooltip:{maxWidth:300},sidePeekTooltip:{background:"transparent",boxShadow:"none"},tooltipTitle:{fontWeight:z.Z.fontWeight.medium,fontSize:z.Z.fontSize.UISmall.desktop},tooltipText:{fontWeight:z.Z.fontWeight.medium,fontSize:z.Z.fontSize.UISmall.desktop,marginLeft:0,paddingRight:20},tooltipValue:{fontSize:z.Z.fontSize.UISmall.desktop,fontWeight:z.Z.fontWeight.regular},tooltipMenuItem:{minHeight:20},badge:{background:"light"===this.theme.mode?this.theme.accentColors.blue[30]:this.theme.accentColors.blue[200]},badgeContent:{display:"flex",alignItems:"center",width:"100%"},badgeCaption:{marginLeft:2,color:this.theme.blueColor},grayedOutBadgeCaption:{marginLeft:1},vectorBadge:{background:this.theme.invoiceGreen,color:this.theme.contentBackground},verifiedBadgeIcon:{width:10,height:10,fill:this.theme.blueColor},right:{display:"flex"},collectionTextMatchingProperty:{lineHeight:2,fontSize:12}},this.debugHitCustomRenderer=e=>{let{data:t,keyPath:r}=e;if(2===r.length&&"_explanation"===r[0])return{element:(0,xe.jsx)(xe.Fragment,{children:(0,xe.jsx)("button",{onClick:e=>{this.stores.explanationModalOpen.setState(!0),e.stopPropagation()},children:"show simplified explanation"})}),expanded:!1};const s=t._ltrlog;if(s)return function(e){const t=Object.keys(e[0])[0],r=e[0][t].map(((e,t)=>{const r=t%2==0?cs:ds;return(0,xe.jsxs)("tr",{children:[(0,xe.jsx)("td",{style:r,children:`${t}`}),(0,xe.jsx)("td",{style:r,children:`${e.name}`}),(0,xe.jsx)("td",{style:r,children:`${e.value}`})]},e.name)}));return{element:(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)("div",{children:(0,xe.jsx)("b",{children:`Featureset: ${t}`})}),(0,xe.jsx)("div",{style:us,children:(0,xe.jsx)("table",{style:hs,children:r})})]}),expanded:!1}}(s);if(!["_score","matched_queries"].every((e=>t[e])))return null;const{_score:i,matched_queries:n}=t;return{element:(0,xe.jsx)(xe.Fragment,{children:`score ${i}, ${(n??[]).length} matched query clauses`}),expanded:!1}}}renderComponent(){const{focused:e,isLastInSection:t,inline:r,className:s}=this.props,i=this.styles,n=xs(this.theme),o={...i.menuItem,...!r&&!t&&!e&&n.menuItemBorder},a={...i.caption,...n.caption},l={...i.timestamp,...n.timestamp},d={...i.textWrapper,...this.props.inline&&i.inlineTextWrapper},c={title:this.renderTitle(),icon:(0,xe.jsx)(fs,{store:this.props.store}),caption:this.renderCaption(),body:this.renderPreview(),right:this.renderRight(),rightStyle:e?void 0:l,dontShrinkRight:!0,captionStyle:a,style:o,spacerStyle:(u=this.props.store,h=this.props.hidePath,h||!(0,Hr.L)(u)?ps:void 0),textWrapperStyle:d,className:Yt()("notranslate",s),buttonStyle:{paddingLeft:2},hoveredStyle:{background:this.theme.tint.regular}};var u,h;const p=X.default.checkGate("search_toggle_side_peek"),m=(0,f.rd)(this.environment)&&p,g=(0,Er.Mk)()&&!(0,f.Qi)(this.environment)&&!j.ZP.state.isDebugSidebarOpen,v=g&&m&&this.props.focused;return g?(0,xe.jsx)(Cr.Z,{delayThreshold:50,placement:Cr.Z.Placement.Right,originGap:18,renderTooltip:()=>(0,xe.jsx)(ys,{store:this.props.store}),style:v?i.sidePeekTooltip:i.tooltip,forceVisibleState:!!v||void 0,allowHover:!!v,render:e=>(0,xe.jsx)(ee.Z,{...this.props,...c,disableTransition:!0,...(0,Or.Z)(this.props,e)}),closeDelay:0}):(0,xe.jsx)(ee.Z,{...this.props,...c,disableTransition:!0,ignoreLocalHoverState:!0})}renderTitle(){var e;const{store:t,result:r,placeholder:s,index:i}=this.props,n=this.styles,o=xs(this.theme),a=void 0===r,l={...n.title,...!a&&!this.props.focused&&o.nonHighlightedTextColor},d=[];if(r&&r.highlight)if(d.push(...(0,Ar.fe)(r.highlight.pathText)),ms(this.props.result))d.push(...(0,Ar.fe)(r.highlight.title));else{he.G.createChildStore(this.props.store,{table:le.iU,id:r.id,spaceId:r.spaceId}).isNavigableBlock()&&d.push(...(0,Ar.fe)(r.highlight.text))}const c=this.props.focused?void 0:this.getWordHighlighter({words:d}),u=null===(e=(0,Lr.VP)(t))||void 0===e?void 0:e.isArchived(),h=function(e){if(e)return e.sources.includes(Re.vp.ElasticsearchUniqueID)}(r),p=(0,Zr.zj)(),m=p&&p===(null==r?void 0:r.id);const g=(0,Er.Mk)()&&!m&&!u?function(){function e(e){var t;return null==r||null===(t=r.badges)||void 0===t?void 0:t.find((t=>t.type===e))}for(const t of["is_template","popular_this_week","most_viewed","verified"]){const r=e(t);if(void 0!==r)return{type:r.type,label:r.label}}}():void 0,f={is_template:this.renderIsTemplateBadge,verified:this.renderVerifiedBadge,popular_this_week:this.renderPopularThisWeekBadge,most_viewed:this.renderMostViewedBadge};return(0,xe.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",...l},children:[(0,xe.jsxs)("div",{style:n.titleContent,children:[M.ZP.state.showDebugInfo&&void 0!==i&&`${i+1}. `,h&&this.renderUniqueIdHighlight(r),(0,xe.jsx)(ge.Z,{style:l,store:t,placeholder:s,highlighter:c}),!1,u&&this.renderIsTeamArchivedBadge(),m&&this.renderCurrentPageBadge(),g&&f[g.type](g.label)]}),M.ZP.state.showDebugInfo&&(0,xe.jsx)(gs,{result:this.props.result,index:this.props.index,originalPosition:this.props.originalPosition})]})}renderUniqueIdHighlight(e){var t;const{focused:r}=this.props,s=null==e||null===(t=e.highlight)||void 0===t?void 0:t.uniqueId;if(!s)return;const i="dark"===this.environment.ThemeStore.state.mode,n=this.styles,o=this.getWordHighlighter({words:[s]}),a=r?i?Ge.FN.dark.translucentGray[300]:Ge.se.light.darkgray.alpha(.09):i?Ge.FN.dark.translucentGray[200]:Ge.se.light.darkgray.alpha(.06);return(0,xe.jsxs)("div",{style:n.uniqueIDBadgeWrapper,children:[(0,xe.jsx)("div",{children:(0,xe.jsx)(qr.Z,{text:s,highlighter:o})}),(0,xe.jsx)("div",{style:{borderRight:`1.5px solid ${a}`,height:14,borderRadius:1}})]})}renderRight(){return(0,xe.jsx)("div",{style:this.styles.right,children:this.rightContent()})}rightContent(){const{lastViewed:e,focused:t}=this.props;if(this.environment.device.isMobile)return;if(e&&!t)return(0,_r.IS)(e,{useCompactFormat:!0});const r=this.styles,s=xs(this.theme),i={...r.rightIcon,...s.enterIcon,opacity:t?1:0};r.rightIconButtonIcon;return(0,er.U)(i)}renderCaption(){const{store:e,inline:t,result:r,debugLocal:s,debugHits:i}=this.props,{device:n}=this.environment,o=this.getWordHighlighter({words:(0,Ar.fe)(r&&r.highlight&&r.highlight.pathText),removeDuplicate:!0}),a=t||n.isMobile?0:2,l=(i??[]).find((e=>"elasticsearch"===e.type&&void 0!==e._explanation)),d="elasticsearch"===(null==l?void 0:l.type)?null==l?void 0:l._explanation:void 0,c=Boolean(M.ZP.getDebugLevel());return(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(Hr.Z,{store:e,extraLength:a,showFullPathInTooltip:!0,highlighter:o,enableHoverAncestor:!0,tooltipStyle:xs(this.theme).captionTooltip,tooltipDividerStyle:xs(this.theme).captionTooltipDivider}),(0,xe.jsxs)("div",{ref:this.props.debugAreaRef,children:[s&&(0,xe.jsx)("div",{style:this.styles.debugArea,children:(0,xe.jsx)(ue.LazyAdminReactJson,{data:{debugLocal:s},defaultCollapsed:!0,customCollapsedRenderers:[ls],showCopyButton:!1,showModalButton:!1})}),i&&(0,xe.jsx)("div",{style:this.styles.debugArea,children:(0,xe.jsx)(ue.LazyAdminReactJson,{data:{debugHits:i},defaultCollapsed:!0,customCollapsedRenderers:[this.debugHitCustomRenderer],showCopyButton:"small",showModalButton:!0})}),i&&(null==r?void 0:r.rankingSignals)&&(0,xe.jsx)("div",{style:this.styles.debugArea,children:(0,xe.jsx)(ue.LazyAdminReactJson,{data:{rankingSignals:r.rankingSignals},defaultCollapsed:!0,showCopyButton:"small",showModalButton:!1})}),c&&(null==r?void 0:r.featureGroups)&&(0,xe.jsx)("div",{style:this.styles.debugArea,children:(0,xe.jsx)(ue.LazyAdminReactJson,{data:{featureGroups:r.featureGroups},defaultCollapsed:!0,showCopyButton:"small",showModalButton:!1})}),d&&(0,xe.jsx)(Wr.Z,{open:this.stores.explanationModalOpen.state,innerStyle:{maxHeight:"90vh",maxWidth:"90vw",height:"90vh",width:"90vw",overflow:"scroll",padding:10},onDismiss:()=>{this.stores.explanationModalOpen.setState(!1)},render:()=>(0,xe.jsx)("pre",{children:Pr({explanation:d}).join("\n")})})]})]})}renderPreview(){var e,t;const{result:r}=this.props;if(!r)return;if(!r.highlight)return;if(he.G.createChildStore(this.props.store,{table:le.iU,id:r.id,spaceId:r.spaceId}).isNavigableBlock()&&!ms(this.props.result))return;let s,i;if(r.highlight.text)s=r.highlight.text;else if(r.highlight.collectionText){var n;s=r.highlight.collectionText,i=null==r||null===(n=r.matchedCollectionProperties)||void 0===n?void 0:n.collectionText}if(s=(0,Fr.$B)(s),!s)return;const o=(0,Ar.ZP)(s);let a=!1;if(ms(this.props.result)){const e=e=>e.filter(Ar.il).map((e=>e[0].toLowerCase())),t=t=>void 0===t?[]:e((0,Ar.ZP)(t)),s=[...new Set([...t(r.highlight.title),...t(r.highlight.pathText)])],i=e=>s.some((t=>t.includes(e)));a=e(o).every((e=>i(e)))}const l=null!==(e=r.sources)&&void 0!==e&&e.includes(Re.vp.VectorDBBlock)||null!==(t=r.sources)&&void 0!==t&&t.includes(Re.vp.VectorDBCollection)?this.styles.vectorHighlight:this.styles.highlight,{highlightedText:d}=xs(this.theme),c=a?{}:{...l,...d};return(0,xe.jsxs)(xe.Fragment,{children:[void 0!==i&&(0,xe.jsx)(Br.Z,{propertySchema:i,showIcon:!0,style:this.styles.collectionTextMatchingProperty}),(0,xe.jsx)(qr.Z,{text:s,highlighter:{tokenize:e=>(0,Ar.Vu)(o),style:c}})]})}getWordHighlighter(e){const{words:t,removeDuplicate:r}=e;if(0===t.length)return;const s={...this.styles.highlight,...xs(this.theme).highlightedText},i=r?new Set:void 0;return{tokenize:e=>(0,Ar.XT)({text:e,patterns:t,uniqueTokenHighlighterContext:i}),style:s}}shouldComponentUpdate(e,t,r){var s,i;const n=e.focused!==this.props.focused,o=(null===(s=e.result)||void 0===s?void 0:s.highlight)!==(null===(i=this.props.result)||void 0===i?void 0:i.highlight),a=e.isLastInSection!==this.props.isLastInSection;return n||o||a}}os.displayName="SearchResultMenuItem";const as=os,ls=e=>{let{data:t}=e;const r=t;if(!r)return null;const{localSource:s}=r;let i=s;return i||(i=new Set(["unknown"])),{element:(0,xe.jsx)(xe.Fragment,{children:`from ${[...i].join(",")}`}),expanded:!1}},ds={paddingLeft:5,paddingRight:20,paddingTop:2,paddingBottom:2,border:"1px solid black",color:Ge.FN.dark.green[900]},cs={...ds,color:Ge.FN.dark.gray[30]},us={maxHeight:200,overflowY:"scroll"},hs={border:"1px solid black"};const ps={visibility:"hidden"};function ms(e){return e&&!e.sources.includes(Re.vp.Local)}function gs(e){var t;let{result:r,index:s,originalPosition:i}=e;const n=null===(t=(null==r?void 0:r.sources)??[])||void 0===t?void 0:t.flatMap((e=>e===Re.vp.Local?["💻"]:e===Re.vp.ElasticSearch?["🌐"]:e===Re.vp.Postgres?["🐘"]:e===Re.vp.VectorDBBlock||e===Re.vp.VectorDBCollection?["🔭"]:e===Re.vp.ElasticsearchRandom?["🎲"]:e===Re.vp.ElasticsearchUniqueID?["🆔"]:e===Re.vp.ElasticsearchForcedRecentRecall?["⏰"]:void(0,H.t1)(e))).reverse(),o=[...void 0===s||void 0===i?[" "]:s>i?["⬇️"]:s<i?["⬆️"]:[],...n].join("").trim();return o?(0,xe.jsx)("span",{children:o}):null}function fs(e){let{store:t}=e;window.__c={n:"Icon"};const r=(0,n.VK)((()=>t.getIcon()),[t]),s=(0,n.VK)((()=>t.isEmptyPage()),[t]);return(0,xe.jsx)(pe.Z,{disabled:!0,icon:r,isEmptyPage:s,size:20,largeIcon:!1})}function vs(e){return"recent_pages"===e?a.tY.SearchRecents:a.tY.SearchQuery}function ys(e){let{store:t}=e;window.__c={n:"TooltipComponent"};const r=(0,i.O7)();return(0,f.rd)(r)?(0,xe.jsx)(is,{store:t}):(0,xe.jsx)(Dr.Z,{store:t})}function xs(e){return{nonHighlightedTextColor:{color:e.text.secondary},menuItemBorder:{boxShadow:`0 1px 0 ${e.lightDividerColor}`},highlightedText:{color:e.text.primary},enterIcon:{fill:e.icon.secondary},bookmarkedIcon:{fill:e.topbarFavorite},caption:{color:e.text.secondary},captionTooltip:{color:e.text.contrast},captionTooltipDivider:{color:e.text.contrast},timestamp:{color:e.text.tertiary},tooltipTitle:{color:e.text.secondary},tooltipText:{color:e.text.primary},tooltipValue:{color:e.text.tertiary}}}function Ss(e,t){return{store:e,id:e.id,score:-1,spaceId:e.getSpaceId(),sources:[Re.vp.Local],featureGroups:[],originalPosition:t,serverEventProperties:void 0}}function bs(e){switch(e){case"Today":return(0,xe.jsx)(K.FormattedMessage,{id:"search.recentPagesTimeBuckets.today.text",defaultMessage:"Today"});case"Yesterday":return(0,xe.jsx)(K.FormattedMessage,{id:"search.recentPagesTimeBuckets.yesterday.text",defaultMessage:"Yesterday"});case"Past Week":return(0,xe.jsx)(K.FormattedMessage,{id:"search.recentPagesTimeBuckets.pastWeek.text",defaultMessage:"Past Week"});case"Past 30 Days":return(0,xe.jsx)(K.FormattedMessage,{id:"search.recentPagesTimeBuckets.past30Days.text",defaultMessage:"Past 30 Days"});case"Older":return(0,xe.jsx)(K.FormattedMessage,{id:"search.recentPagesTimeBuckets.older.text",defaultMessage:"Older"})}(0,H.t1)(e)}const Cs=function(e){window.__c={n:"SearchDefaultBody"};const{onSelect:t,spaceId:r,extraTopPadding:a}=e,[d,c]=s.useState(!1),[u,h]=s.useState(!1),p=(0,n.qz)(void 0,Ut.Z),{section:m,indexLocal:g,indexGlobal:f}=(0,n.VK)((()=>p.state.focus),[p]),v=(0,i.O7)(),y=(0,i.Fy)(),x=(0,o.yK)((e=>({wrapper:{width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto"},sectionHeader:{marginBottom:8},section:{marginBottom:18},sectionBorderBottom:{paddingBottom:10,boxShadow:`0 1px 0 ${e.lightDividerColor}`},notionAiLabel:{lineHeight:"20px",fontSize:14,textOverflow:"ellipsis",overflow:"hidden",display:"block",fontWeight:z.Z.fontWeight.medium},notionAiIcon:{fill:e.aiPurpleColor,overflow:"visible"}})),[]),{defaultBodyFocusedResult:b,isQuickSearch:C}=(0,s.useContext)(Z.SearchStaticContext),M=(0,n.VK)((()=>{const e=Gt.default.state,t=Gt.default.isCenterPeekOpen()||$t.default.isInPeekRenderer();return e.open&&(t||e.isOpening)?e.target:S.default.state.mainEditorCurrentBlockStore}),[]),I=(0,n.VK)((()=>ce.X4.state.filter((e=>e.pageId!==(null==M?void 0:M.id)))),[null==M?void 0:M.id]),j=(0,n.VK)((()=>Ht.Z.shouldShowSearchMenuItemAskAI(y)),[y]),k=(0,n.VK)((()=>{const{currentUserSettingsStore:e,currentSpaceStore:t,mainEditorCurrentBlockStore:r}=S.default.state;return!!(t&&r&&r.canRead())&&Ht.Z.isQnATooltipsVisible(v.device,e)}),[v.device]);(0,s.useEffect)((()=>()=>{b.setState(void 0)}),[b]);const w=(0,s.useRef)(null),{value:P}=(0,ue.useDependency)(ue.deps.assistant),T=(0,n.VK)((()=>j?[{key:"actionMenuItem.assistant",action:()=>{const{currentUserSettingsStore:e}=S.default.state;e&&(0,qt.C)(v,{phase:"complete",transactionUserAction:"AiQnaIntroModal.debug.clickTooltipClose",userSettingsStore:e}),Vt.em({environment:v,shouldResetAssistantStore:zt.Z.wasActiveSessionLastOpenedOutsideOfHistorySavedWindow()}),null==P||P.assistantActions.updateAssistantTimestampsAfterSessionInitialization({environment:v})},render:e=>{const t=null==M?void 0:M.getSpaceStore(),r=t?(0,Wt.rn)(v,t):void 0,s=(0,xe.jsx)("div",{className:"notranslate",style:x.notionAiLabel,children:r?(0,xe.jsx)(K.FormattedMessage,{id:"searchDefaultBody.searchActionMenuItem.askAiInSpace",defaultMessage:"Ask AI anything in {spaceName}",values:{spaceName:r}}):(0,xe.jsx)(K.FormattedMessage,{id:"searchDefaultBody.searchActionMenuItem.askNotionAi",defaultMessage:"Ask Notion AI about..."})});return k?(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(Nt.gc,{origin:w}),(0,xe.jsx)(or,{type:"assistant",...e,blueOutlineFocused:!0,ref:w,title:s,icon:e=>(0,Dt.t)({...e,...x.notionAiIcon})})]}):(0,xe.jsx)(or,{type:"assistant",...e,title:s,icon:e=>(0,Dt.t)({...e,...x.notionAiIcon})})}}]:[]),[j,v,M,k,x,P]),F=(0,n.VK)((()=>{const e={};return I.forEach((t=>{let{pageId:r,visitedAt:s}=t;return e[r]=s})),e}),[I]),R=(0,n.VK)((()=>{const e=new Map;return I.map(((r,s)=>{const i=ce._5(r.visitedAt),n="Today"!==i&&"Yesterday"!==i,o={result:{key:`${r.store.id}:${s}`,action:e=>t({index:{local:e.indexLocal,global:e.index},event:e.event,selectedResult:Ss(r.store,s),fromSidePeekPanel:!1,actionItemCount:T.length,context:"recent_pages"}),render:e=>(0,xe.jsx)(as,{...e,inline:!y.isMobile,store:r.store,hidePath:!1,lastViewed:n?F[r.store.id]:void 0,buttonStyle:{paddingLeft:1},type:"recent_pages"})},store:r.store};var a;e.has(i)?null===(a=e.get(i))||void 0===a||a.push(o):e.set(i,[o])})),e}),[T.length,y.isMobile,I,t,F]),B=(0,ue.useDependency)(ue.deps.AppTemplates),A=(0,n.VK)((()=>{var e;return null===(e=S.default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.persona}),[]),O=(0,n.VK)((()=>{var e;const t=null===(e=B.value)||void 0===e?void 0:e.templatePickerItems.getSuggestedTemplatesForSearch(A).slice(0,3);return null==t?void 0:t.map(((e,t)=>({key:`${t}:${e.name}`,action:e.onClick,render:t=>(0,xe.jsx)(or,{...t,title:e.name,icon:()=>e.icon,type:"page_result"})})))}),[B,A]),L=(0,n.VK)((()=>!(!O||0===O.length)&&"on"===X.default.getEligibleGroup({experimentId:"search_modal_suggested_templates"})),[O]),_=(0,n.VK)((()=>{const e=[];T.length>0&&e.push({key:"actions",items:T,render:e=>(0,xe.jsx)(ie.Z,{title:"Actions",desktopTitleStyle:x.sectionHeader,disableDesktopPadding:!0,extraTopPadding:a,style:{...x.section},children:e.children})});for(const[t,r]of R.entries()){const s=bs(t),i={key:t,items:r.map((e=>e.result)),render:e=>(0,xe.jsx)(ie.Z,{title:s,desktopTitleStyle:x.sectionHeader,disableDesktopPadding:!0,style:x.section,children:e.children})};e.push(i)}return!C&&O&&O.length>0&&L&&e.push({key:"templates",items:O,render:e=>(0,xe.jsx)(ie.Z,{title:(0,xe.jsx)(K.FormattedMessage,{id:"search.templateSuggestions.header",defaultMessage:"Start with a template"}),desktopTitleStyle:x.sectionHeader,disableDesktopPadding:!0,extraTopPadding:a,style:{...x.section},children:e.children})}),e}),[C,T,R,a,x.section,x.sectionHeader,O,L]),E=(0,s.useCallback)((e=>{const t=()=>{const e=Kt.Z.getWithoutSubscribing(r),t=e[e.length-1];return null==t?void 0:t.visitedAt},s=l.P2((async()=>{const e=t(),s=v.currentUser.id;if(!s||!e)return;c(!0);const i=await ce.Od(e,{environment:v,userId:s,spaceId:r});c(!1),i||h(!0)}),300);t()&&e<=200&&!d&&!u&&s()}),[u,d,v,r]);(0,s.useEffect)((()=>{var e;if(void 0===m||void 0===g||void 0===f)return;const t=null===(e=_[m])||void 0===e?void 0:e.key;if(t&&"string"==typeof t)if("actions"===t)b.setState({type:"assistant"});else if(ce._k.includes(t)){var r;const e=null===(r=R.get(t))||void 0===r||null===(r=r[g])||void 0===r?void 0:r.store;e&&b.setState({type:"page_result",value:{index:{local:{indexLocal:g,section:m},global:f},selectedResult:Ss(e,f-T.length)}})}}),[T.length,b,f,m,g,R,_]);const D=(0,n.VK)((()=>T.length),[T.length]),V=!y.isMobile&&I.length>0;return(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsxs)("div",{style:x.wrapper,children:[(0,xe.jsx)(Qe.Z,{store:p,type:Qe.i.Vertical,initialFocus:D,disableKeyboardArrowWrap:!0,sections:_,unfocusOnScroll:!0}),(0,xe.jsx)(Qt.Z,{onChange:E})]}),V&&(0,xe.jsx)(ur,{title:(0,xe.jsx)(Mr,{})})]})};var Ms=r(36308),Is=r(15157),js=r(34859),ks=r(79131),ws=r(53336),Ps=r(76725),Ts=r(19889),Fs=r(7928);function Rs(e){window.__c={n:"SearchFilterBarTitle"};const{filterUIName:t}=e,{parentStore:r}=(0,s.useContext)(Z.SearchStoresContext),i=(0,n.VK)((()=>j.ZP.state.query.filters),[]),a=(0,o.yK)((e=>({title:{maxWidth:220,...z.Z.textOverflowStyle}})),[]),d=(0,n.VK)((()=>{switch(t){case"personFilter":return function(e,t){const r=e.createdBy,s=de.default.getIntl(),i=l.oA(r.map((e=>{const r=he.U6.createChildStore(t,{table:Ts.KJ,id:e});return(0,Fs.Nz)(s,r.getModel())})));return(0,Ps.Z)(i,Os)}(i,r);case"teamsFilter":case"dev_notInTeamFilter":return function(e,t){const r=(0,Re.iY)(e.inTeams);if(!r)return[];const s=l.oA(r.map((e=>he.zX.createChildStore(t,{table:Fe.e0,id:e}).getName())));return(0,Ps.Z)(s,Os)}(i,r);case"pageFilter":return Ls(i,r);case"dateFilter":return function(e){const t=de.default.getIntl(),r=Zs(e);if("createdTime"===r)return v._Q(e.createdTime,t);if("lastEditedTime"===r)return v._Q(e.lastEditedTime,t);return""}(i);case"pageFilter":case"dev_notInPageFilter":return Ls(i,r);case"titleToggle":return[];default:(0,H.t1)(t)}}),[r,t,i]);return(0,xe.jsx)("div",{style:a.title,children:(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"{filterName}{colon} {filterOperator} {filterValues}",id:"search.filterBarFilter.title",values:{filterName:Bs(t),filterOperator:0===d.length?void 0:As(t,i),filterValues:d,colon:0===d.length?void 0:":"}})})}function Bs(e){switch(e){case"personFilter":return(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFilters.person",defaultMessage:"Created by"});case"teamsFilter":return(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace"});case"pageFilter":return(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In"});case"dateFilter":return(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFilters.date",defaultMessage:"Date"});case"titleToggle":return(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Title only"});case"dev_notInPageFilter":return(0,xe.jsx)(K.FormattedMessage,{id:"[DO NOT TRANSLATE].search.filterMenu.notInPageFilter.label",defaultMessage:"[dev] Not in page"});case"dev_notInTeamFilter":return(0,xe.jsx)(K.FormattedMessage,{id:"[DO NOT TRANSLATE].search.filterMenu.notInTeamFilter.label",defaultMessage:"[dev] Not in teamspace"})}(0,H.t1)(e)}function Zs(e){const t=v.VD.createdTime(e.createdTime),r=v.VD.lastEditedTime(e.lastEditedTime);return t?"createdTime":r?"lastEditedTime":void 0}function As(e,t){switch(e){case"personFilter":case"teamsFilter":case"pageFilter":case"dev_notInPageFilter":case"dev_notInTeamFilter":case"dateFilter":case"titleToggle":return}(0,H.t1)(e)}const Os=e=>", ";function Ls(e,t){const r=e.ancestors,s=l.oA(r.map((e=>{const r=he.G.createChildStore(t,{table:le.iU,id:e});return r.isDefined()?r.getModel().getRenderTitle({getRecordModel:r.getRecordModel,userTimeZone:(0,st.r)(),intl:de.default.getIntl()}):""})));return(0,Ps.Z)(s,Os)}var _s=r(41558),Es=r(53437),Ds=r(45959),Vs=r(83264);const qs={today:(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Today",id:"searchDateFilter.quickActions.today.label"}),pastWeek:(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Last 7 days",id:"searchDateFilter.quickActions.last7Days.label"}),pastMonth:(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Last 30 days",id:"searchDateFilter.quickActions.last30Days.label"})};function Ns(e){let{date:t,onClick:r,onDismiss:s}=e;const i=(0,st.r)(),n=rt.Lg(i),o=n;let a;const l=qs[t];"today"===t?a=n:"pastWeek"===t?a=rt.Oo(i):"pastMonth"===t?a=rt.dj(i):(0,H.t1)(t);return(0,xe.jsx)(ee.Z,{focused:!1,icon:(0,_.C)({height:18,width:18}),title:l,onClick:e=>{r({value:{starting:{type:"date",start_date:a.start_date},ending:{type:"date",start_date:o.start_date}}}),s(e)}})}class Ws extends A.Z{constructor(){super(...arguments),this.storeTypes={store:_s.Z},this.renderPillButtonOrigin=()=>{const{icon:e,title:t}=this.props,{store:r}=this.stores,s=this.styles,{dateFilterType:i}=r.state,n=j.ZP.state.query.filters[i].starting;return(0,xe.jsx)(Ne.Z,{on:Boolean(n),icon:e(s.pillIcon),title:(0,xe.jsx)("span",{children:t}),onClick:this.handleOriginActivate})},this.renderPopupContents=()=>{const{title:e}=this.props,{store:t}=this.stores;return(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsxs)("div",{style:this.styles.dateFilterHeader,children:[this.renderOperatorSelect(),(0,xe.jsx)(J.Z,{style:this.styles.clearButton,onClick:this.handleClear,children:(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Clear",id:"searchDateFilter.clearButton.label"})})]}),(0,xe.jsxs)("div",{style:this.styles.quickDatesWrapper,children:[(0,xe.jsx)(Ns,{date:"today",onClick:this.updateTemporary,onDismiss:this.handleMenuClose}),(0,xe.jsx)(Ns,{date:"pastWeek",onClick:this.updateTemporary,onDismiss:this.handleMenuClose}),(0,xe.jsx)(Ns,{date:"pastMonth",onClick:this.updateTemporary,onDismiss:this.handleMenuClose})]}),(0,xe.jsx)(Vs.Z,{title:e,value:this.getCurrentValue(),onUpdate:this.updateTemporary,store:t,onDismiss:this.handleMenuClose,hideDateInputMenuItems:!0})]})},this.handleOriginActivate=()=>{const{disabled:e,onMenuOpen:t}=this.props,{store:r}=this.stores;e||(t&&t(),r.setState({...r.state,isOpen:!0,focus:"starting"}))},this.handleMenuClose=e=>{const{onMenuDismiss:t}=this.props,{store:r}=this.stores,{temporaryDateRange:s,dateFilterType:i}=r.state;v.zD(e)||(zs(i,s),r.setState({...r.state,isOpen:!1}),t&&t())},this.handleClear=()=>{const{store:e}=this.stores,{dateFilterType:t}=e.state;zs(t,{starting:void 0,ending:void 0}),e.clearTemporaryDateRange()},this.handleMenuListKey=e=>{e.preventDefault&&e.preventDefault()},this.updateTemporary=e=>{const{store:t}=this.stores;if(e.error)return;t.setState({...t.state,temporaryDateRange:{...t.state.temporaryDateRange,...e.value}});const{dateFilterType:r,temporaryDateRange:s}=t.state,{starting:i,ending:n}=s;i&&n&&zs(r,{starting:i,ending:n})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},sectionMenuItem:{display:"flex"},icon:{height:14,width:14,fill:"currentColor"},pillIcon:{height:16,width:16,fill:"currentColor",marginRight:6},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginRight:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6},popup:{paddingTop:12,paddingBottom:8},menuItemTitleDesktop:{width:"100%"},summary:{display:"inline-flex"},quickDatesWrapper:{marginTop:12,boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,paddingBottom:15,marginBottom:15},clearButton:{color:this.theme.mediumTextColor,fill:this.theme.lightIconColor,fontWeight:500,fontSize:13,paddingLeft:2,paddingRight:2,paddingBottom:2,borderRadius:4,flexShrink:0},dateFilterHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginLeft:12,marginRight:12}}}didMount(){this.updateTemporary({value:this.props.value})}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{store:t}=this.stores,r=this.styles;return(0,xe.jsx)(ze.Z,{style:r.sectionMenuItem,children:(0,xe.jsx)(P.Z,{capture:t.state.isOpen,onUp:this.handleMenuListKey,onDown:this.handleMenuListKey,onEnter:this.handleMenuListKey,children:(0,xe.jsx)(Es.ZP,{popupType:Us(this.environment),open:t.state.isOpen,origin:this.renderPillButtonOrigin(),render:this.renderPopupContents,onDismiss:this.handleMenuClose,placementToOrigin:Es.ZP.Placement.Bottom,alignmentToOrigin:Es.ZP.Alignment.Start,keepFocus:!0,style:r.popup})})})}updateFilterFromToggle(e){const{value:t}=this.props,{store:r}=this.stores,{dateFilterType:s}=r.state;zs(e,t),e!==s&&(zs(s,{starting:void 0,ending:void 0}),r.setState({...r.state,dateFilterType:e}))}renderOperatorSelect(){const{device:e}=this.environment,{store:t}=this.stores,{dateFilterType:r}=t.state,s={width:190,items:["createdTime","lastEditedTime"],selectedItem:r,getKey:e=>e,onSelect:e=>this.updateFilterFromToggle(e),renderItem:e=>(0,xe.jsx)(ee.Z,{title:Ks(e.value),...e}),renderOrigin:t=>(0,xe.jsx)(J.Z,{...t,style:{paddingLeft:2,paddingRight:2,paddingBottom:2,borderRadius:4,flexShrink:0},children:(0,xe.jsxs)("div",{style:{display:"flex",alignItems:"center",...!e.isMobile&&{color:this.theme.mediumTextColor,fill:this.theme.lightIconColor,fontWeight:500,fontSize:13}},children:[(0,xe.jsx)("span",{style:{marginRight:4},children:Ks(r)}),(0,xe.jsx)(Gs,{})]})})};return(0,xe.jsx)(Ds.Z,{...s,mobileActionSheet:!0})}renderMobile(e){const{store:t}=this.stores,r=e===ye.z.Section?this.renderMobileFilterSummary():this.renderMobileButtonOrigin();return(0,xe.jsx)(Es.ZP,{popupType:Es.ZP.PopupType.SlideUp,open:t.state.isOpen,origin:r,render:this.renderPopupContents,onDismiss:this.handleMenuClose,preventScaleTransition:!0})}renderMobileButtonOrigin(){const{icon:e,title:t,disabled:r}=this.props,s=this.styles;return(0,xe.jsx)(ee.Z,{disabled:r,focused:!1,icon:e(s.icon),title:t,onClick:this.handleOriginActivate})}renderMobileFilterSummary(){const{title:e,value:t,dateFormat:r,disabled:s,intl:i}=this.props,n=this.styles,o=(0,xe.jsxs)("div",{style:n.summary,children:[(0,_.C)(n.iconActiveMobile),v._Q(t,i,r)]});return(0,xe.jsx)(He.Z,{disabled:s,onClick:this.handleOriginActivate,onClickClear:this.handleClear,label:e,title:o})}getCurrentValue(){const{store:e}=this.stores,{dateFilterType:t,temporaryDateRange:r}=e.state;return{...j.ZP.state.query.filters[t],...r}}}Ws.displayName="SearchGenericDateFilter";const Hs=(0,K.injectIntl)(Ws);function zs(e,t){j.ZP.updateFilters({[e]:t})}function Ks(e){return{lastEditedTime:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),createdTime:(0,xe.jsx)(K.FormattedMessage,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"})}[e]}function Us(e){const{device:t}=e;return t.isMobile?Es.ZP.PopupType.SlideUp:Es.ZP.PopupType.Popup}function Gs(){window.__c={n:"OperatorChevron"};const e=(0,i.O7)(),{device:t}=e;return(0,$e.i)({width:10,height:10,...t.isMobile&&{marginTop:2}})}function $s(e){const t=j.ZP.state.query.sort,r=At.find((e=>l.Xy(e.sort,t)))??At[0],s="relevance"===r.sort.field?(0,xe.jsx)(K.FormattedMessage,{id:"search.sort.sortOrder.bestMatches.title",defaultMessage:"Sort"}):r.formattedName;return(0,xe.jsx)(Ne.Z,{disabled:!1,title:s,onClick:e.onClick,icon:(0,pr.T)({width:16,marginRight:6,fill:"currentColor"})})}function Qs(){const e=j.ZP.state.query.sort,t=At.findIndex((t=>l.Xy(t.sort,e))),r=[];for(const s of At)r.push({key:s.key,render:e=>(0,xe.jsx)(ee.Z,{...e,title:s.formattedName}),action:()=>{j.ZP.setState({...j.ZP.state,query:{...j.ZP.state.query,sort:s.sort}})}});return(0,xe.jsx)(T.Z,{menuType:g.og.Popup,children:(0,xe.jsx)(Qe.Z,{type:Qe.i.Vertical,initialFocus:t<0?0:t,sections:[{key:"sortOptions",items:r,render:e=>(0,xe.jsx)(ie.Z,{...e,disableDesktopPadding:!0})}]})})}const Xs=function(e){window.__c={n:"SearchSortButton"};const t=(0,o.yK)((()=>({popup:{paddingTop:12,paddingBottom:8}})),[]);return(0,xe.jsx)(te.ZP,{popupType:te.Z4.Popup,renderOrigin:$s,render:Qs,disabled:!1,placementToOrigin:Es.ZP.Placement.Bottom,alignmentToOrigin:Es.ZP.Alignment.Start,style:t.popup,onClick:e.onMenuOpen,onClose:e.onMenuDismiss})},Ys="SearchFilterSettings";function Js(e){window.__c={n:"SearchFilterBar"};const{isMobile:t}=e,{parentStore:r}=(0,s.useContext)(Z.SearchStoresContext),{handlePopupOpen:a,handlePopupClose:d}=(0,s.useContext)(Z.SearchStaticContext),c=(0,i.O7)(),u=(0,n.VK)((()=>c.currentUser.id),[c]),h=(0,n.VK)((()=>j.ZP),[]),p=(0,n.Kw)(h),m=p.query.filters,g=(0,n.VK)((()=>I.default.state.isPublicPageSearch),[]),f=(0,n.VK)((()=>(0,$.bq)()&&X.default.checkGate("enable_search_team_filter")&&!g),[g]),v=(0,n.VK)((()=>!g),[g]),y=!1,x=(0,o.yK)((e=>({scroller:{display:"flex",alignItems:"center",paddingTop:10,paddingRight:12,paddingBottom:10,paddingLeft:12},barContainer:{display:"flex",alignItems:"center"},scrollerContainer:{position:"relative",flexGrow:0,overflow:"hidden"},draggableList:{display:"flex",flexShrink:0,marginLeft:6},divider:{height:16,width:1,borderRadius:1,backgroundColor:e.stroke.deemphasized}})),[]),S=(0,s.useCallback)((e=>t=>h.updateFilters({[e]:t})),[h]),b=(0,s.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:s}=e;if(v)return(0,xe.jsx)(Pe.Z,{mode:ye.z.Pill,focused:!1,title:(0,xe.jsx)(Rs,{filterUIName:"personFilter"}),parentStore:r,userIds:m.createdBy,onMenuDismiss:t,onMenuOpen:s,onChange:S("createdBy")})}),[v,r,m.createdBy,S]),C=(0,s.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:s}=e;return f&&(0,xe.jsx)(Le,{mode:ye.z.Pill,focused:!1,title:(0,xe.jsx)(Rs,{filterUIName:"teamsFilter"}),parentStore:r,teamIds:m.inTeams,onMenuDismiss:t,onMenuOpen:s,onChange:S("inTeams")})}),[r,m.inTeams,S,f]),M=(0,s.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:s}=e;return(0,xe.jsx)(Me,{mode:ye.z.Pill,focused:!1,title:(0,xe.jsx)(Rs,{filterUIName:"pageFilter"}),parentStore:r,blockIds:m.ancestors,onMenuDismiss:t,onMenuOpen:s,onChange:S("ancestors")})}),[r,m.ancestors,S]),k=(0,s.useCallback)((()=>null),[r,m.dev_excludedPages,S,y]),w=(0,s.useCallback)((()=>null),[r,m.dev_excludedTeams,S,y]),P=(0,s.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:r}=e;return(0,xe.jsx)(Hs,{mode:ye.z.Pill,focused:!1,title:(0,xe.jsx)(Rs,{filterUIName:"dateFilter"}),icon:_.C,value:m.lastEditedTime,onMenuDismiss:t,onMenuOpen:r})}),[m.lastEditedTime]),T=(0,s.useCallback)((()=>!t&&(0,xe.jsx)(Ue,{mode:ye.z.Pill,focused:!1,title:(0,xe.jsx)(Rs,{filterUIName:"titleToggle"}),icon:Ms.V,value:m.navigableBlockContentOnly||!1,onChange:S("navigableBlockContentOnly")})),[m.navigableBlockContentOnly,S,t]);(0,s.useEffect)((()=>{const e=Is.Z.get({userId:u,key:Ys});e&&l.Xy(new Set(e.filterOrder),new Set(p.filterBar.order))&&!l.Xy(e.filterOrder,p.filterBar.order)&&e.filterOrder&&h.updateFilterOrder(e.filterOrder)}),[p.filterBar.order,u,h]);const F={onMenuOpen:a,onMenuDismiss:d},R={titleToggle:T(),personFilter:b(F),teamsFilter:C(F),pageFilter:M(F),dateFilter:P(F),dev_notInPageFilter:k(),dev_notInTeamFilter:w()};const B=(0,s.useCallback)((e=>{const{onMenuDismiss:t,onMenuOpen:r}=e;return(0,xe.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,xe.jsx)(Xs,{onMenuOpen:r,onMenuDismiss:t}),(0,xe.jsx)("div",{style:x.divider})]})}),[x.divider]);return(0,xe.jsx)("div",{style:x.barContainer,children:(0,xe.jsx)("div",{style:x.scrollerContainer,children:(0,xe.jsxs)(ws.Z,{type:js.Z.X,style:x.scroller,showLeftRightOverlay:!1,children:[(0,xe.jsx)(xe.Fragment,{children:B(F)}),(0,xe.jsx)(xe.Fragment,{children:(0,xe.jsx)(ks.ZP,{direction:"horizontal",keys:p.filterBar.order,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>R[e],style:x.draggableList,onDrop:e=>function(e){const t={filterOrder:e};Is.Z.set({userId:u,key:Ys,value:t}),h.updateFilterOrder(e)}(e)})})]})})})}var ei=r(12457),ti=r(68785),ri=r(25904),si=r(1800),ii=r(54642),ni=r(47307),oi=r(64964),ai=r(31194),li=r(1310),di=r(16354),ci=r(43765),ui=r(92660);const hi=(0,K.defineMessages)({additionalInformationPlaceholder:{id:"SearchBadResultsForm.additionalInformation.placeholder",defaultMessage:"Any additional comments or context (e.g. ...)"},urlPlaceholder:{id:"SearchBadResultsForm.url.placeholder",defaultMessage:"Link to page you were looking for"}}),pi=e=>{window.__c={n:"SearchResultPicker"};const t=(0,o.Fg)(),r=(0,n.qz)(void 0,Q.Z);return(0,xe.jsx)(te.ZP,{popupType:te.Z4.Popup,buttonPopupStore:r,renderOrigin:e=>(0,xe.jsx)(xe.Fragment,{children:(0,xe.jsxs)(se.Z,{style:{width:"100%"},...e,children:[(0,xe.jsx)(ci.Z,{title:"Select Result"}),(0,$e.i)({width:10,marginLeft:4,fill:t.lightIconColor})]})}),placementToOrigin:ai.Iw.Bottom,alignmentToOrigin:ai.lU.Start,render:t=>{var r;const s=[{key:"results",render:e=>(0,xe.jsx)(ie.Z,{...e,topBorder:0!==e.index}),items:(null===(r=e.results)||void 0===r?void 0:r.map((r=>({key:r.id,render:e=>(0,xe.jsx)(me.Z,{store:r.store,checkState:!1,hidePath:!0,...e}),action:()=>{e.onSelect(r),t.close()}}))))||[]}],i={menuType:g.og.Popup,width:240};return(0,xe.jsx)(T.Z,{...i,children:(0,xe.jsx)(Qe.Z,{type:Qe.i.Vertical,initialFocus:void 0,sections:s})})}})};function mi(){ri.Z.reset()}const gi=e=>{var t;let{searchStoreState:r,currentSpaceStore:s,serverResults:i,localResults:n,environment:o,experiments:a,traceLogs:l}=e;const d=ri.Z.getState(),c=v.AX(i),u=v.AX(n),h={query:r.query,limit:r.limit,debug:"everything"},{publicAccessPermissionAncestorBlockId:p}=v.bC(o),m=v.gC({input:h,spaceId:null==s?void 0:s.id,publicAccessPermissionAncestorBlockId:p,source:"report_bad_search"});if(!m)return;const g=null===(t=document.getElementsByClassName("search-results-list")[0])||void 0===t?void 0:t.outerHTML,f="on"===(null==a?void 0:a["vector-search-vanilla-ltr"])||c.some((e=>e.sources.includes(Re.vp.VectorDBBlock)||e.sources.includes(Re.vp.VectorDBCollection)));f&&c.splice(0,-20);const y={queryText:r.query.text.trim(),apiRequest:m,serverResults:JSON.stringify(c,null,2),localResults:JSON.stringify(u,null,2),desiredUrl:d.desiredUrl,additionalInformation:d.additionalInformation,renderedHtml:g,experiments:JSON.stringify(a??{},null,2),isVectorSearchEnabled:f,traceLogs:null==l?void 0:l.log};ii.reportBadSearch(o,y).then((e=>{if("failed"===e.type)ni.showErrorMessage((0,xe.jsx)("h1",{children:"Failed to submit report"}));else{const{url:t}=e.data;oi.oV({label:(0,xe.jsx)("div",{children:(0,xe.jsx)(di.Z,{href:t,children:"Your report has been submitted, thanks!"})}),durationMs:li.JY})}})),ri.Z.reset()},fi=function(e){window.__c={n:"ReportBadSearchForm"};const{serverResults:t,localResults:r,experiments:a,debugInfo:l}=e,d=null==l?void 0:l.traceLogs,c=(0,o.yK)((e=>({textArea:{width:"100%",background:e.popoverBackground,display:"block",marginTop:17,marginBottom:17},urlArea:{width:"100%",height:"50%",background:e.popoverBackground,display:"block",marginTop:17,marginBottom:17},modalWrap:{width:360,padding:24,fontSize:14},modalTitle:{fontSize:16,marginBottom:12,fontWeight:z.Z.fontWeight.medium},buttonArea:{display:"flex",justifyContent:"flex-end",marginTop:18},outlineButton:{marginRight:12}})),[]),[u]=(0,s.useState)(j.ZP),h=(0,n.VK)((()=>S.default.state.currentSpaceStore),[]),[p,m]=(0,n.AF)(ri.Z),g=(0,i.O7)(),f=(0,s.useCallback)((e=>{m({...p,desiredUrl:e?(0,si.Z)({pageId:e.store.id,pageModel:e.store.getModel(),baseUrl:U.default.domainBaseUrl,pageVisitSource:void 0}):void 0})}),[p,m]),y=(0,s.useCallback)((()=>{gi({searchStoreState:u.state,currentSpaceStore:h,serverResults:t,localResults:r,experiments:a,environment:g,traceLogs:d})}),[g,u,h,t,r,a,d]);return(0,xe.jsx)(ui.Z,{onDismiss:mi,render:()=>(0,xe.jsx)(k.Z,{capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,render:e=>(0,xe.jsxs)("div",{style:c.modalWrap,...e,children:[(0,xe.jsx)("div",{style:c.modalTitle,children:(0,xe.jsx)(K.FormattedMessage,{id:"SearchBadResultsForm.title",defaultMessage:"Report Bad Search"})}),(0,xe.jsx)(ht.Z,{textarea:!0,style:c.textArea,placeholder:de.default.formatMessage(hi.additionalInformationPlaceholder),value:p.additionalInformation,onChange:e=>{m({...p,additionalInformation:e.target.value})},focusInitial:!0}),(0,xe.jsx)(pi,{results:v.oO({localResults:r,serverResults:t}),onSelect:f}),(0,xe.jsx)(ht.Z,{textarea:!0,style:c.urlArea,placeholder:de.default.formatMessage(hi.urlPlaceholder),value:p.desiredUrl,onChange:e=>{m({...p,desiredUrl:e.target.value})}}),(0,xe.jsxs)("div",{style:c.buttonArea,children:[(0,xe.jsx)(tr.Z,{isLarge:!0,onClick:mi,style:c.outlineButton,children:(0,xe.jsx)(K.FormattedMessage,{id:"SearchBadResultsForm.cancelButton.label",defaultMessage:"Cancel"})}),(0,xe.jsx)(tr.Z,{isRed:!0,isLarge:!0,onClick:y,disabledFeedback:!0,children:(0,xe.jsx)(K.FormattedMessage,{id:"SearchBadResultsForm.reportButton.label",defaultMessage:"Submit"})})]})]})}),requireOnline:!0,modalStore:ri.Z})};function vi(e){window.__c={n:"ReportBadSearchButton"};const[t,r]=(0,n.AF)(ri.Z),s=(0,o.yK)((t=>({button:{...cr(t),...e.buttonStyles}})),[e.buttonStyles]);return(0,xe.jsxs)(tr.Z,{style:s.button,onClick:()=>{r({...t,open:!0})},children:[(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Report bad search",id:"search.header.badSearch.button.label"}),(0,xe.jsx)(fi,{...e})]})}class yi extends A.Z{constructor(){super(...arguments),this.storeTypes={requestModalOpen:wr.default.createClass(!1),responseModalOpen:wr.default.createClass(!1)},this.styles={footer:()=>{const{device:e}=this.environment;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:e.isMobile?z.Z.fontSize.UIRegular.mobile:z.Z.fontSize.UIRegular.desktop}},footerText:{fontSize:lr.yv(this.environment,"UISmall"),...z.Z.textOverflowStyle},inlineHint:{display:"inline",marginRight:16},resultCountWrapper:{display:"flex",alignItems:"center",...z.Z.textOverflowStyle},resultCount:{fontWeight:z.Z.fontWeight.medium},resultText:{verticalAlign:"middle",marginRight:6},spinner:{display:"inline",width:12,height:12,verticalAlign:"middle"},keyboardShortcut:{marginRight:4,marginBottom:1,fontVariant:"all-small-caps",fontSize:1.1*lr.yv(this.environment,"UISmall")},commandGlyph:{fontSize:.75*lr.yv(this.environment,"UIRegular")},footerDebugButton:cr(this.theme),debugModalStyle:{maxHeight:"90vh",maxWidth:"90vw",height:"90vh",width:"90vw",overflow:"scroll",padding:10},navigationHints:{marginLeft:15}}}renderComponent(){var e;const{localResults:t,serverResults:r}=this.props.searchResultStore.state,{shouldShow:s}=this.props;if(!s)return;const i=this.styles,n={footerText:{color:(o=this.theme).lightTextColor},resultCount:{color:o.mediumTextColor},keyboardShortcut:{color:o.mediumTextColor}};var o;const a={...i.resultCount,...n.resultCount},{count:l,isLowerBound:d}=this.props.searchResultStore.getResultCount(),c=(0,xe.jsx)("span",{style:i.resultText,children:d?this.props.intl.formatMessage({id:"SearchResultsFooter.helpText.resultCountApproximate",defaultMessage:"{resultCount, plural, other {<resultwrapper>{resultCount}+</resultwrapper> results}}"},{resultCount:l,resultwrapper:e=>(0,xe.jsx)("span",{style:a,children:e})}):this.props.intl.formatMessage({id:"SearchResultsFooter.helpText.resultCount",defaultMessage:"{resultCount, plural, one {<resultwrapper>{resultCount}</resultwrapper> result} other {<resultwrapper>{resultCount}</resultwrapper> results}}"},{resultCount:l,resultwrapper:e=>(0,xe.jsx)("span",{style:a,children:e})})}),u=(0,f.rd)(this.environment),h=(0,f.XP)()||u,p=h?(0,xe.jsx)(Mr,{}):(0,xe.jsxs)("div",{style:i.resultCountWrapper,children:[h?void 0:(0,xe.jsxs)("div",{children:[c,this.renderSpinner(this.props.showSpinner)]}),(0,xe.jsx)("div",{style:i.navigationHints,children:(0,xe.jsx)(Mr,{})})]}),m=!u&&!1;return(0,xe.jsx)(ur,{title:p,right:(0,xe.jsxs)(xe.Fragment,{children:[m&&(0,xe.jsx)(vi,{experiments:null==r||null===(e=r.serverEventProperties)||void 0===e?void 0:e["server-searchExperiments"],localResults:null==t?void 0:t.results,serverResults:null==r?void 0:r.results,debugInfo:null==r?void 0:r.debugInfo}),this.renderSearchDebugButtons()]})})}renderSpinner(e){const t=this.styles;return(0,xe.jsx)(ei.Z,{show:e,showDelay:500,showHold:200,render:e=>e&&(0,xe.jsx)(ti.Z,{style:t.spinner})})}renderSearchDebugButtons(){var e;if(!M.ZP.state.debug&&!M.ZP.state.showDebugInfo)return;const{rawRequests:t,rawResponses:r}=(null===(e=this.props.searchResultStore.state.serverResults)||void 0===e||null===(e=e.debugInfo)||void 0===e?void 0:e.response)||{};return(0,xe.jsxs)(xe.Fragment,{children:[t&&(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(Wr.Z,{open:this.stores.requestModalOpen.state,innerStyle:this.styles.debugModalStyle,onDismiss:()=>{this.stores.requestModalOpen.setState(!1)},render:()=>(0,xe.jsx)(ue.LazyAdminReactJson,{showCopyButton:"large",defaultCollapsed:!1,data:t})}),(0,xe.jsx)(tr.Z,{style:this.styles.footerDebugButton,onClick:()=>this.stores.requestModalOpen.setState(!0),children:"Open Request"})]}),r&&(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(Wr.Z,{open:this.stores.responseModalOpen.state,innerStyle:this.styles.debugModalStyle,onDismiss:()=>{this.stores.responseModalOpen.setState(!1)},render:()=>(0,xe.jsx)(ue.LazyAdminReactJson,{showCopyButton:"large",data:{rawResponses:r},defaultCollapsed:!1})}),(0,xe.jsx)(tr.Z,{style:this.styles.footerDebugButton,onClick:()=>this.stores.responseModalOpen.setState(!0),children:"Open Response"})]})]})}}yi.displayName="SearchResultsFooter";const xi=(0,K.injectIntl)(yi);var Si=r(73935),bi=r(36896),Ci=r(44604),Mi=r(36596),Ii=r(39634);class ji extends A.Z{constructor(){super(...arguments),this.styles={menuItem:{minHeight:void 0,...this.environment.device.isMobile&&{background:void 0,boxShadow:void 0},paddingTop:32,paddingBottom:32},text:{textAlign:"center"},title:{margin:0,fontWeight:z.Z.fontWeight.medium,fontSize:lr.yv(this.environment,"UIRegular"),lineHeight:lr.Dp(this.environment,"UIRegular")},caption:{fontSize:lr.yv(this.environment,"UIRegular")}}}renderComponent(){const{style:e,captionStyle:t,...r}=this.props,s={...this.styles.menuItem,...e},i={...this.styles.caption,...t};return(0,xe.jsx)(Pt.Z,{...r,title:this.renderTitle(),caption:(0,xe.jsx)(Pi,{caption:this.props.caption,captionStyle:i}),textWrapperStyle:this.styles.text,style:s,captionStyle:i})}renderTitle(){const{title:e}=this.props;if(!e)return;const t=this.styles,r=wi(this.theme),s={...t.title,...r.title};return(0,xe.jsx)("h4",{role:"alert",style:s,children:e})}}ji.displayName="ErrorMenuItem";const ki=ji;function wi(e){return{title:{color:e.mediumTextColor},caption:{color:e.lightTextColor}}}function Pi(e){let{captionStyle:t,caption:r}=e;window.__c={n:"CaptionComponent"};const s=(0,o.Fg)();if(!r)return null;const i={...t,...wi(s).caption};return(0,xe.jsx)("div",{style:i,children:r})}const Ti=(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"No results",id:"searchErrorMenuItem.error.noResults"});const Fi=function(e){window.__c={n:"SearchErrorMenuItem"};const t=(0,o.yK)((e=>({menuItem:{marginTop:"auto",marginBottom:"auto"},caption:{marginTop:"auto"},reportProblemButton:{display:"inline",color:e.blueColor},searchDeletedButton:{display:"inline",lineHeight:"25px",color:e.blueColor}})),[]),r=(0,i.O7)(),{isQuickSearch:a}=(0,s.useContext)(Z.SearchStaticContext),l=()=>{Ii.j({environment:r,from:"quick_find"})};function d(r){const s=function(r){if(r)return;const s=v.FN(c);if(!v.VD.isDeletedOnly(c.isDeletedOnly))return(0,xe.jsx)(K.FormattedMessage,{id:"searchErrorMenuItem.errorPrompt.searchDeleted",defaultMessage:"Some results may be in your deleted pages.{br}<searchdeleted>Search deleted pages</searchdeleted>",values:{searchdeleted:r=>(0,xe.jsx)(di.Z,{onClick:e.handleSearchDeletedOnly,style:t.searchDeletedButton,children:r}),br:(0,xe.jsx)("br",{})}});return s?(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Try different search terms or filters",id:"searchErrorMenuItem.errorPrompt.searchTermsAndFilters"}):(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Try different search terms",id:"searchErrorMenuItem.errorPrompt.searchTerms"})}(r);return{title:Ti,caption:s}}const c=(0,n.VK)((()=>j.ZP.state.query.filters),[]);return(0,xe.jsx)(ki,{...function(r){const s=e.error;switch(s.type){case Re.Ix.NoResults.type:return d(r);case Re.Ix.Offline.type:return function(){const e=(0,xe.jsx)(K.FormattedMessage,{defaultMessage:"Go online for more results.",id:"searchErrorMenuItem.errorPrompt.goOnline"});return{title:Ti,caption:e}}();case Re.Ix.RequestFailed.type:return{title:(0,xe.jsx)(K.FormattedMessage,{id:"searchErrorMenuItem.error.genericErrorMessage",defaultMessage:"Something went wrong"}),caption:(0,xe.jsx)(K.FormattedMessage,{id:"searchErrorMenuItem.errorPrompt.refreshOrReport",defaultMessage:"Try refreshing or <reportlink>report a problem</reportlink>.",values:{reportlink:e=>(0,xe.jsx)(di.Z,{onClick:l,style:t.reportProblemButton,children:e})}})};default:(0,H.t1)(s)}}(a??!1),style:t.menuItem,captionStyle:t.caption,shouldWrapCaption:!0})};const Ri=8;function Bi(e){window.__c={n:"SearchResultShimmers"};const{numberOfShimmerResults:t,assistantActionsEnabled:r}=e,s=t===Ri&&r,i=(0,o.yK)((e=>({container:{margin:(s?"0px":"8px")+" 10px 6px 10px",display:"flex",flexDirection:"column",gap:10},icon:{width:20,height:20,borderRadius:5,marginLeft:6},titleAndPath:{width:"100%",display:"flex",flexDirection:"column",gap:5},title:{height:18,borderRadius:5},path:{height:12,borderRadius:5},resultContainer:{display:"flex",gap:10,boxShadow:`0 1px 0 ${e.lightDividerColor}`,paddingBottom:10},sectionHeader:{marginBottom:7,marginTop:8}})),[s]),n=Array.from({length:t},(()=>!0));return(0,xe.jsxs)("div",{children:[s&&(0,xe.jsx)(ie.Z,{desktopTitleStyle:i.sectionHeader,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.searchResultsShimmer.bestMatches.text",defaultMessage:"Best matches"})}),(0,xe.jsx)("div",{style:i.container,children:n.map(((e,t)=>(0,xe.jsxs)("div",{style:{...i.resultContainer,...t===n.length-1&&{boxShadow:"none"}},children:[(0,xe.jsx)(Mi.Z,{style:i.icon}),(0,xe.jsxs)("div",{style:i.titleAndPath,children:[(0,xe.jsx)(Mi.Z,{style:{...i.title,width:l.UP(["30%","45%","55%","60%","70%","75%","80%","90%"])}}),(0,xe.jsx)(Mi.Z,{style:{...i.path,width:l.UP(["10%","15%","20%","25%","30%","35%","55%","70%"])}})]})]},`shimmer-item-${t}`)))})]})}const Zi=s.memo(Bi);function Ai(e,t,r){if(!t.isLoading)return t.showMajorError?(0,xe.jsx)(Fi,{error:t.serverError,handleSearchDeletedOnly:()=>{const t=j.ZP.state.query.text;Vt.IB(e),bi.Z.setState({...bi.Z.state,open:!0}),Ci.Z.setState({...Ci.Z.state,currentTab:"all_pages",filter:t,limit:Ci.Z.startLimit})}}):t.serverError&&t.serverError!==Re.Ix.NoResults?function(e,t){return(0,xe.jsx)(ie.Z,{disableMobilePadding:!0,disableMobileBorders:!0,children:(0,xe.jsx)(ci.Z,{title:e,style:t})})}(t.serverError.message,r):void 0}function Oi(e,t){return(0,xe.jsx)(ie.Z,{disableMobilePadding:!0,disableMobileBorders:!0,topBorder:!1,style:{marginTop:0,paddingTop:0},children:(0,xe.jsx)(Pt.Z,{body:e,bodyStyle:t})})}const Li=(0,K.injectIntl)((function(e){var t,r,a,d,c,u;window.__c={n:"SearchResultsMenuList"};const[h,m]=(0,s.useState)(!1),g=(0,i.Fy)().isMobile,y=(0,o.yK)((e=>({results:{flex:1,display:"flex",flexDirection:"column",overflow:"auto",height:"100%"},messageMenuItem:{...g&&{background:void 0,boxShadow:void 0}},debugMessageMenuItemTextStyle:{whiteSpace:"pre-wrap",fontFamily:"monospace",marginTop:0},actionMenuItemTitle:{fontWeight:z.Z.fontWeight.medium,lineHeight:"20px",fontSize:15,color:e.mediumTextColor,textOverflow:"ellipsis",overflow:"hidden",display:"block"},menuListContainer:{display:"flex",flexDirection:"column",gap:12,marginTop:g?13:void 0,marginBottom:4}})),[g]),{searchResultStore:x,localResults:S,serverResults:b,resultListStore:C,searchExperimentOverrides:I,intl:k,showActions:w,extraTopPadding:P}=e,T=e.errorState,F=(0,n.VK)((()=>j.ZP.state.query.text),[]),{focusedIndexStore:R}=(0,s.useContext)(Z.SearchStaticContext),B=(0,n.VK)((()=>{var e;return null===(e=R.state)||void 0===e?void 0:e.global}),[R]),A=(0,n.VK)((()=>w.length),[w]),O=A>0?{key:"actions",render:e=>(0,xe.jsx)(ie.Z,{...e,shouldShowBottomDivider:!1,disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,extraTopPadding:P,title:(0,xe.jsx)(K.FormattedMessage,{id:"search.searchActions.actions.text",defaultMessage:"Actions"})}),items:l.oA(w.map(((e,t)=>function(e){const{type:t,title:r,icon:s,action:i,shouldShowArrowUp:n}=e;return{key:`actionMenuItem.${t}`,action:i,render:e=>(0,xe.jsx)(or,{type:t,...e,title:r,icon:s,shouldShowArrowUp:n})}}({...e,title:e.renderTitle(F,k,y.actionMenuItemTitle),shouldShowArrowUp:void 0!==e.shouldShowArrowUp&&e.shouldShowArrowUp({currentGlobalFocusedIndex:B,actionItemCount:A})}))))}:void 0,L=(0,n.VK)((()=>(0,f.XP)()),[]),_=(0,v.IV)({intentBasedGrouping:L,localResults:S,serverResults:b}),{allSearchResults:E}=_,D=(0,s.useCallback)((t=>{const{results:r,sectionTitle:i,compact:n,rendersTimeSinceLastViewedMs:o}=t,{id:a,title:d}=function(e){if(!e)return{id:"allSearchResults",title:void 0};switch(e.type){case"unique-id":return{id:"uniqueIdSearchResults",title:(0,xe.jsx)(K.FormattedMessage,{id:"search.searchResultBuckets.uniqueID.text",defaultMessage:"ID matches"})};case"jump-back-in":return{id:"jumpBackInSearchResults",title:(0,xe.jsx)(K.FormattedMessage,{id:"search.searchResultBuckets.topResults.text",defaultMessage:"Top results"})};case"server":return{id:"serverOnlySearchResults",title:(0,xe.jsx)(K.FormattedMessage,{id:"search.searchResultBuckets.server.text",defaultMessage:"{count}{maybeLowerBoundSign} results",values:{count:e.values.count,maybeLowerBoundSign:e.values.isLowerBound?"+":""}})};case"main":return{id:"mainSearchResults",title:(0,xe.jsx)(K.FormattedMessage,{id:"search.searchResultBuckets.bestMatches.text",defaultMessage:"Best matches"})};default:(0,H.t1)(e)}}(i);return r.length>0?{key:a,render:e=>(0,xe.jsx)(ie.Z,{...e,shouldShowBottomDivider:!1,disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,title:d}),items:l.oA(r.map(((t,r)=>{var i,a;return function(e){var t;const{selectedResult:r,index:i,actionItemCount:n,allSearchResults:o,props:a,compact:l,timeSinceLastViewedMs:d}=e,{store:c}=r,u=c.isNavigableBlock()?c:c.getNavigableBlockStore();if(!u)return;const h=s.createRef(),m=Boolean(M.ZP.getDebugLevel()),g=m&&r.sources.includes(Re.vp.Local)?{score:r.score,frecencyScore:r.frecencyScore,localSource:r.localSource,personalizationBoost:r.personalizationBoost,id:r.id,terms:r.terms}:void 0,f=m&&(r.sources.includes(Re.vp.ElasticSearch)||r.sources.includes(Re.vp.VectorDBBlock)||r.sources.includes(Re.vp.VectorDBCollection))?null===(t=a.debugInfo)||void 0===t||null===(t=t.response)||void 0===t?void 0:t.resultsDebugMap[c.id]:void 0,v=a.clusterInfo,y=Date.now();return{key:`${c.id}:${i}`,action:e=>{const{event:t}=e;function s(e){const r=Si.findDOMNode(e.current);return Boolean(r&&"target"in t&&t.target&&(r===t.target||r.contains(t.target)))}h.current&&s(h)||a.handleSelectResult({event:e.event,index:{local:e.indexLocal,global:e.index},selectedResult:r,allSearchResults:o,fromSidePeekPanel:!1,actionItemCount:n,context:"query_results"})},render:e=>{var t;return(0,xe.jsx)(as,{...e,index:i,originalPosition:r.originalPosition,isFirstInSection:0===i,store:u,hidePath:!1,result:r,className:p.ulv,debugLocal:g,debugHits:f,debugAreaRef:h,clusterInfo:v,inline:l&&!m,inlineCaptionMinWidthPercentage:20,lastViewed:d?y-d:void 0,queryId:null===(t=r.serverEventProperties)||void 0===t?void 0:t["server-queryId"],type:"query_results"})}}}({selectedResult:t,index:r,actionItemCount:(null==O||null===(i=O.items)||void 0===i?void 0:i.length)??0,allSearchResults:E,props:e,compact:n,timeSinceLastViewedMs:o&&null!==(a=t.localSource)&&void 0!==a&&a.has("recentVisit")?t.timeSinceLastViewedMs:void 0})})))}:void 0}),[null==O||null===(t=O.items)||void 0===t?void 0:t.length,E,e]),V=(0,n.VK)((()=>D({results:"intent-based-grouping"===_.type?_.sections.jumpBackInSearchResults:[],sectionTitle:{type:"jump-back-in"},compact:!0,rendersTimeSinceLastViewedMs:!0})),[D,_.sections,_.type]),q=(0,n.VK)((()=>{const e="intent-based-grouping"===_.type?_.sections.serverOnlySearchResults:[],{count:t,isLowerBound:r}=x.getResultCount();return D({results:e,sectionTitle:{type:"server",values:{count:t,isLowerBound:r}},compact:!1})}),[D,_.sections,_.type,x]),N=(0,n.VK)((()=>D({results:"uniqueIdSearchResults"in _.sections?_.sections.uniqueIdSearchResults:[],sectionTitle:{type:"unique-id"},compact:!1})),[D,_.sections]),W=(0,n.VK)((()=>D({results:"unique-id"===_.type?_.sections.nonUniqueIdSearchResults:"all"===_.type?_.sections.allSearchResults:[],sectionTitle:"unique-id"===_.type||((null==O?void 0:O.items)??[]).length>0?{type:"main"}:void 0,compact:!1})),[null==O?void 0:O.items,D,_.sections,_.type]),U=[O,V,N,q,W].filter(H.$K),G=null===(r=e.debugInfo)||void 0===r||null===(r=r.response)||void 0===r?void 0:r.parsedQueries,$=null===(a=e.debugInfo)||void 0===a||null===(a=a.response)||void 0===a?void 0:a.detectedLanguages,Q=null===(d=e.debugInfo)||void 0===d?void 0:d.traceLogs,X=null===(c=e.debugInfo)||void 0===c||null===(c=c.response)||void 0===c?void 0:c.debugUrls,Y=(0,s.useCallback)(((t,r)=>{const{onMaybeLoadMoreResults:s}=e,i=t<=200;i&&!h&&s(),m(i),r.offsetFromTop&&j.ZP.update((e=>({...e,hasScrolled:!0})))}),[h,e]),J=(null==O||null===(u=O.items)||void 0===u?void 0:u.length)??0,ee=(0,n.VK)((()=>Ht.Z.showSearchAiFeatures()),[]),te=(0,i.O7)(),re=(0,n.VK)((()=>{const e=void 0===b;if(!(e&&(ee||(0,f.rd)(te))))return 0;const t=x.state.serverResultsLoading,r=(null==S?void 0:S.length)??0,s="serverError"in T&&void 0!==T.serverError;return(e&&!t||t)&&!s?Ri-r:0}),[te,x,null==S?void 0:S.length,b,T,ee]);return(0,xe.jsx)(Z.SearchStaticContext.Consumer,{children:e=>{let{queryResultsSectionRef:t}=e;return(0,xe.jsxs)("section",{style:y.results,ref:t,children:[!l.xb(I)&&Oi((0,xe.jsx)(xe.Fragment,{children:(0,xe.jsx)(ue.LazyAdminReactJson,{data:{searchExperimentOverrides:I},showCopyButton:!1,showModalButton:!1,defaultCollapsed:!1})}),y.debugMessageMenuItemTextStyle),G&&Oi((0,xe.jsx)(ue.LazyAdminReactJson,{data:{parsedQueries:G},customCollapsedRenderers:[Vi],showCopyButton:"small",showModalButton:!0,defaultCollapsed:!0}),y.debugMessageMenuItemTextStyle),$&&Oi((0,xe.jsx)(ue.LazyAdminReactJson,{data:{detectedLanguages:$},customCollapsedRenderers:[Di]}),y.debugMessageMenuItemTextStyle),Q&&Oi((0,xe.jsx)(ue.LazyAdminReactJson,{data:{tracer:{traceLogs:Q}},customCollapsedRenderers:[Ei],defaultCollapsed:!0}),y.debugMessageMenuItemTextStyle),X&&Oi((0,xe.jsx)(ue.LazyAdminReactJson,{data:{debugUrls:X},defaultCollapsed:!0,customCollapsedRenderers:[Ni],showCopyButton:"small",showModalButton:!0,maxLinkValueLength:40}),y.debugMessageMenuItemTextStyle),U&&(0,xe.jsx)("div",{className:"search-results-list",children:(0,xe.jsx)(Qe.Z,{type:Qe.i.Vertical,initialFocus:J,store:C,disableKeyboardArrowWrap:!0,sections:U,style:y.menuListContainer})}),Ai(te,T,y.messageMenuItem)||(0,xe.jsx)(Qt.Z,{onChange:Y}),re>0&&(0,xe.jsx)(Zi,{numberOfShimmerResults:re,assistantActionsEnabled:ee})]})}})}));function _i(e){const t=e.replaceAll(/\(MatchNoDocsQuery\("Matching no documents because no terms present"\)\)\^[0-9\.]/g,"").replaceAll(/MatchNoDocsQuery\("Matching no documents because no terms present"\)/g,"").replaceAll(/ConstantScore\(([^)]+):([^)]+)\)/g,"<i>$1</i>:<b>$2</b>").replace(/function score \(\((.*)\), functions:.*\)/,"$1").replaceAll("( ","(").replaceAll(" )",")").replaceAll("|","| <br/>").replaceAll(/([^( ]+):"([^"]+)"/g,'<i>$1</i>:<b>"$2"</b>').replaceAll(/([^( ]+):([^) ]+)/g,"<i>$1</i>:<b>$2</b>");return(0,xe.jsx)("span",{dangerouslySetInnerHTML:{__html:t}})}const Ei=e=>{let{data:t,keyPath:r}=e;if("traceLogs"===(null==r?void 0:r[0])&&l.PO(t)&&Array.isArray(t.log)&&t.log.length>0){const{log:e,startTimeMs:r}=t;return{element:(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)("div",{children:(0,xe.jsx)("b",{children:`Trace started at ${r}`})}),e.map(((e,t)=>(0,xe.jsxs)("div",{children:[(0,xe.jsx)("span",{style:qi,children:`[${e.timestamp-r}ms][${e.callerFileName.split(".")[0]}]`}),(0,xe.jsx)("span",{children:`${e.msg}`})]},t)))]}),expanded:!1}}return null},Di=e=>{let{data:t,keyPath:r}=e;return"detectedLanguages"===r.join(".")&&l.PO(t)?{element:(0,xe.jsx)(xe.Fragment,{children:Object.entries(t).filter((e=>{let[t,r]=e;return Boolean(r)})).map((e=>{let[t]=e;return t})).join(", ")||"None"}),expanded:!1}:null},Vi=e=>{var t,r;let{data:s,keyPath:i}=e;const n=s,o=Object.values(n).find((e=>void 0!==e));if(!o)return null;if(!["type","description","time_in_nanos"].every((e=>o[e])))return null;if(1===i.length)return{element:_i(o.description),expanded:!1};let a=o.description??"";return null!==(t=a)&&void 0!==t&&t.includes("permissions.teamIds")&&(a="PermissionsQuery"),null!==(r=a)&&void 0!==r&&r.includes("(_id:[")&&(a="BoostRecentPageIds"),{element:_i(a),expanded:!1}},qi={color:"blue"},Ni=e=>{let{data:t}=e;const r=t;if(!r)return null;const s=Object.values(r).find((e=>{let{clusterName:t}=e;return void 0!==t}));if(s){const{clusterName:e}=s;return{element:(0,xe.jsx)(xe.Fragment,{children:e}),expanded:!1}}return{element:(0,xe.jsx)(xe.Fragment,{children:"unknown"}),expanded:!1}};const Wi=function(e){window.__c={n:"SearchResultsBody"};const{searchResultStore:t,sxsMode:r,searchDebugColumnStore:a,extraTopPadding:l}=e,d=(0,i.O7)(),c=(0,i.Fy)(),u=(0,o.yK)((e=>({container:{display:"flex",flexDirection:"column",width:r?"50%":"100%",flex:1,overflow:"hidden"},askAiLabel:{color:e.regularTextColor,fontWeight:z.Z.fontWeight.medium,fontSize:14},askAiQuery:{fontWeight:z.Z.fontWeight.regular},askAiIcon:{fill:e.aiPurpleColor}})),[r]),h=(0,n.qz)(void 0,Ut.Z),p=(0,n.VK)((()=>h.state.focus),[h]),{handleSelectSearchResult:m,focusedIndexStore:g,searchActionItemsStore:y}=(0,s.useContext)(Z.SearchStaticContext),{localResults:x,serverResults:S,clusterInfo:b,debugInfo:C,serverResultsLoading:I,searchExperimentOverrides:k,hasPublicAccessPermission:w,errorState:P,serverResultsAllLoaded:T}=(0,n.VK)((()=>{var e,r;const{hasPublicAccessPermission:s}=v.bC(d);return{localResults:t.state.localResults,serverResults:t.state.serverResults,serverResultsLoading:t.state.serverResultsLoading,clusterInfo:null===(e=t.state.serverResults)||void 0===e?void 0:e.clusterInfo,debugInfo:null===(r=t.state.serverResults)||void 0===r?void 0:r.debugInfo,searchExperimentOverrides:a.state.searchExperimentOverrides,hasPublicAccessPermission:s,errorState:t.state.errorState,serverResultsAllLoaded:t.state.serverResultsAllLoaded}}),[t,a,d]),F=!1===P.isLoading&&P.showMajorError,R=Boolean(x||S),B=(0,s.useCallback)((()=>{!I&&!T&&void 0!==S&&j.ZP.update((e=>({...e,limit:e.limit+j.Xv,isScrolled:!0,source:"quick_find_scroll"})))}),[I,T,S]),A=(0,n.VK)((()=>v.oO({localResults:null==x?void 0:x.results,serverResults:null==S?void 0:S.results})),[x,S]),O=(0,n.VK)((()=>{if(r)return[];return[{type:"assistant",renderTitle:(e,t,r)=>function(e,t){return(0,xe.jsx)("div",{className:"notranslate",style:t,children:e})}((0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)("span",{children:(0,xe.jsx)(K.FormattedMessage,{id:"searchResultsBody.askAiMenuItem.title",defaultMessage:"Ask AI"})}),(0,xe.jsx)("span",{style:u.askAiQuery,children:e?` “${e}”`:""})]}),{...r,...u.askAiLabel}),icon:e=>(0,Dt.t)({...e,...u.askAiIcon}),action:()=>{Vt.em({environment:d,shouldResetAssistantStore:j.ZP.state.query.text.length>0||zt.Z.wasActiveSessionLastOpenedOutsideOfHistorySavedWindow()})},shouldShow:()=>Ht.Z.shouldShowSearchMenuItemAskAI(c),shouldShowArrowUp:e=>{let{currentGlobalFocusedIndex:t,actionItemCount:r}=e;return void 0!==t&&t===r}}].filter((e=>e.shouldShow(d)))}),[d,u,r,c],{useDeepEqual:!0}),L=(0,n.VK)((()=>{if(r)return 0;{const e=O.map((e=>({type:e.type})));return y.update((t=>e)),y.state.length}}),[r,O,y]);(0,n.VK)((()=>{const e=t.state.insertedActionResultsCount,r=L;e!==r&&t.update((e=>({...e,insertedActionResultsCount:r})))}),[t,L]);const _=(0,s.useCallback)((()=>h.update((e=>e.focus.isInitialized&&0===e.focus.section&&0===e.focus.indexLocal&&0===e.focus.indexGlobal?e:{...e,focus:O.length>0?{section:1,indexLocal:0,indexGlobal:O.length}:{section:0,indexLocal:0,indexGlobal:0}}))),[h,O]);(0,s.useEffect)((()=>{_()}),[A,_]),(0,s.useEffect)((()=>{void 0!==p.section&&void 0!==p.indexLocal&&void 0!==p.indexGlobal?g.setState({local:{section:p.section,indexLocal:p.indexLocal},global:p.indexGlobal}):g.setState(void 0)}),[g,p]);const E=(0,n.VK)((()=>{const e=M.ZP.state.showDebugInfo;return!F&&R&&!c.isMobile&&!(0,f.rd)(d)||e||r}),[c.isMobile,R,F,r,d]);return(0,xe.jsxs)("div",{style:u.container,children:[(0,xe.jsx)(Li,{errorState:P,handleSelectResult:m,onMaybeLoadMoreResults:B,resultListStore:h,searchResultStore:t,localResults:null==x?void 0:x.results,serverResults:null==S?void 0:S.results,debugInfo:C,clusterInfo:b,publicAccessPermission:w,searchExperimentOverrides:k,showActions:O,extraTopPadding:l}),(0,xe.jsx)(xi,{searchResultStore:t,showSpinner:I,shouldShow:E})]})};function Hi(e){window.__c={n:"SearchNavigationalView"};const{searchContentPaneType:t}=e,{searchFilterMenuRef:r,handleSelectSearchResult:a,searchResultStore:l,secondarySearchResultStore:d}=(0,s.useContext)(Z.SearchStaticContext),c=(0,i.Fy)(),{errorState:u,shouldShowSxSView:h}=(0,n.VK)((()=>({shouldShowSxSView:Boolean((0,M.gq)({device:c})&&M.BJ.state.visible),errorState:l.state.errorState})),[l,c]),p=(0,o.yK)((()=>({container:{display:"flex",flexDirection:"column",width:h?"50%":"100%"},sxsContainer:{display:"flex",flexDirection:"row",height:"100%",overflow:"hidden",maxWidth:"100%"}})),[h]),m=!1===u.isLoading&&u.showMajorError,g=(0,n.VK)((()=>j.ZP.state.filterBar.show),[]),f=!c.isMobile&&!g,v={searchResultStore:l,searchDebugColumnStore:M.v_,sxsMode:h,extraTopPadding:f},y=(0,n.VK)((()=>{var e;return null===(e=S.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]);return(0,xe.jsxs)(xe.Fragment,{children:[!c.isMobile&&g&&(0,xe.jsx)(Js,{isMobile:c.isMobile}),"search_results"===t?(0,xe.jsxs)(xe.Fragment,{children:[!m&&c.isMobile&&(0,xe.jsx)(yt,{isMobile:!0,mode:mt.Section,ref:r}),(0,xe.jsxs)("div",{style:p.sxsContainer,children:[(0,xe.jsx)(Wi,{...v}),h&&(0,xe.jsx)(Wi,{...v,searchResultStore:d,searchDebugColumnStore:M.BJ})]})]}):y?(0,xe.jsx)(Cs,{onSelect:a,spaceId:y,extraTopPadding:f}):null]})}var zi=r(97439),Ki=r(27714),Ui=r(86517),Gi=r(37034),$i=r(10912),Qi=r(84076);function Xi(e){window.__c={n:"SearchSidePeekPanelMetadataItem"};const{itemName:t,itemValue:r,associatedUser:s}=e,i=(0,o.yK)((e=>({itemName:{fontSize:12,color:e.lightTextColor},itemValue:{fontSize:12,...s&&{display:"grid",gridTemplateColumns:"1fr auto auto",gap:5,textAlign:"right"}},itemContainer:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",gap:12},metadataActorName:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}})),[s]),n=s;return(0,xe.jsxs)("div",{style:i.itemContainer,children:[(0,xe.jsx)("div",{style:i.itemName,children:t}),(0,xe.jsxs)("div",{style:i.itemValue,children:[n&&(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)(Cr.Z,{delayThreshold:50,placement:Cr.Z.Placement.Top,allowHover:!0,renderTooltip:()=>(0,xe.jsxs)("div",{style:{display:"flex",gap:5},children:[n.avatar,n.name]}),closeDelay:0,render:e=>(0,xe.jsx)("span",{...e,style:i.metadataActorName,children:n.name})}),(0,xe.jsx)("span",{children:"·"})]}),(0,xe.jsx)("span",{children:r})]})]})}const Yi={createdBy:(0,xe.jsx)(K.FormattedMessage,{id:"search.preview.metadata.createdBy",defaultMessage:"Created by"}),created:(0,xe.jsx)(K.FormattedMessage,{id:"search.preview.metadata.created",defaultMessage:"Created"}),lastEditedBy:(0,xe.jsx)(K.FormattedMessage,{id:"search.preview.metadata.lastEditedBy",defaultMessage:"Last edited by"}),lastEdited:(0,xe.jsx)(K.FormattedMessage,{id:"search.preview.metadata.lastEdited",defaultMessage:"Edited"})},Ji={type:"page_content"};function en(e){var t;window.__c={n:"SearchSidePeekPanel"};const{selectedResult:r,onClickPreview:l,handleClickCopyLink:d}=e,c="page_result"===r.type,h=(0,o.yK)((e=>({sidePeekPanel:{width:250,overflowY:"auto",overflowX:"hidden",minHeight:400,borderLeft:`1px solid ${e.lightDividerColor}`,display:"flex",flexDirection:c?"column":"row",justifyContent:c?"space-between":"center",alignItems:c?"normal":"center",zIndex:1},emoji:{width:20},sidePeekContentContainer:{margin:16},report:{fontSize:12,position:"absolute",bottom:0,right:0,margin:16,display:"flex",gap:10},sidePeekActionContainer:{margin:16},pageIconAndTitleContainer:{marginTop:12,display:"flex",gap:8,flexDirection:"column",justifyContent:"space-between"},title:{fontSize:16,fontWeight:z.Z.fontWeight.semibold,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},untitledPageColor:{color:e.text.tertiary},titleAndLinkContainer:{display:"grid",gridTemplateColumns:"1fr auto",width:"fit-content",gap:5},previewContainer:{marginTop:8,marginBottom:8,display:"flex",flexDirection:"column",position:"relative"},hoveredOrPressedPreview:{background:"unset",boxShadow:"unset"},preview:{borderRadius:6,background:"unset",boxShadow:"unset",border:`1px solid ${e.lightDividerColor}`,padding:12},contentCover:{color:e.text.primary,fontSize:11,lineHeight:1.5,marginBottom:0,width:"110%",transform:"translateX(-12px) translateY(-4px) scale(0.91)",paddingLeft:12,paddingRight:12,paddingTop:12,paddingBottom:0,borderRadius:6,border:`1px solid ${e.lightDividerColor}`,background:"transparent"},contentCoverFade:{height:48,background:`linear-gradient(to bottom, transparent, ${"light"===e.mode?e.contentBackground:e.sidebarBackground} 100%)`},metadataContainer:{marginTop:8,display:"flex",flexDirection:"column",gap:8},action:{borderRadius:4,background:"unset",fontSize:12,display:"flex"},metadataActorWrapper:{overflow:"hidden"},metadataActorAvatar:{marginRight:5},doubleChevronIcon:{color:e.accentColors.gray[400],cursor:"pointer",width:"max-content"},debugGearIcon:{color:e.accentColors.gray[400]},hoveredDebugGearIcon:{color:e.accentColors.gray[600]}})),[c]),p=(0,n.VK)((()=>h.sidePeekPanel),[h.sidePeekPanel]),g=(0,i.O7)(),f=(0,K.useIntl)(),v=(0,n.VK)((()=>"page_result"===r.type?{type:"page_result",value:r.value.selectedResult.store}:{type:"assistant",value:void 0}),[r]),y=(0,n.VK)((()=>{if("page_result"!==v.type)return;const e=(0,Gi.V)(v.value,f,g,!Ht.Z.isAssistant2Enabled(void 0));return e&&e.trim().length>0?e:void 0}),[f,g,v]),x=(0,n.VK)((()=>S.default.state.currentSpaceStore?(0,Wt.jv)(S.default.state.currentSpaceStore):[]),[]),b=(0,s.useCallback)((e=>{const{id:t,spaceStore:r,table:s,showAvatar:i}=e;if(void 0===t||void 0===s)return;const n=(0,es.Hl)({pointer:{id:t,spaceId:r.id,table:s},getRecordModel:r.getRecordModel}).asActor;return void 0!==n&&(0,Ui.GU)({spacePermissions:x,userId:n.id})?{name:(0,es.$4)(f,n),avatar:i?(0,ss.a)({actor:n,size:18,style:h.metadataActorAvatar}):void 0}:void 0}),[f,x,h.metadataActorAvatar]),C=(0,s.useCallback)((e=>(0,_r.IS)(e,{useUltraCompactFormat:!0,useWeeks:!0,useLowercase:!0})),[]),{createdBy:M,created:I,lastEditedBy:k,lastEdited:w}=(0,n.VK)((()=>{const e=S.default.state.currentSpaceStore;if(void 0===e||"page_result"!==r.type)return{createdBy:void 0,created:void 0,lastEditedBy:void 0,lastEdited:void 0};const t=r.value.selectedResult.store;return{createdBy:b({id:t.getCreatedById(),table:t.getCreatedByTable(),spaceStore:e,showAvatar:!0}),created:C(t.getCreatedTime()),lastEditedBy:b({id:t.getLastEditedById(),table:t.getLastEditedByTable(),spaceStore:e,showAvatar:!0}),lastEdited:C(t.getLastEditedTime())}}),[C,b,r]),P=[{key:"created",itemName:Yi.created,itemValue:I,associatedUser:M},{key:"lastEdited",itemName:Yi.lastEdited,itemValue:w,associatedUser:k}],{previewIcon:T,isEmptyPage:F}=(0,n.VK)((()=>{if("page_result"!==r.type)return{previewIcon:void 0,isEmptyPage:!0};const e=r.value.selectedResult.store;return{previewIcon:e.getIcon(),isEmptyPage:e.isEmptyPage()}}),[r]),R=(0,n.VK)((()=>{if("page_result"!==r.type)return;const e=r.value.selectedResult.store;return(0,m.ZP)({store:e,collectionViewId:e.id,fullyQualified:!0,pageVisitSource:a.tY.SearchQuery})}),[r]),B=(0,s.useCallback)((()=>{R&&(u.RD({environment:g,stringValue:R,copiedMessage:u.tq.copiedLinkToClipboard}),d&&d({source:Z.SearchCopyLinkSource.SidePeekPanel}))}),[d,g,R]),A=(0,n.VK)((()=>X.default.checkGate("search_toggle_side_peek")),[]),{searchResultStore:O}=(0,s.useContext)(Z.SearchStaticContext),{localResults:L,serverResults:_}=(0,n.VK)((()=>O.state),[O]),E=(0,W.x)(U.default);return(0,xe.jsxs)("aside",{style:p,children:[(0,xe.jsx)("div",{style:h.sidePeekContentContainer,children:"page_result"===r.type?(0,xe.jsxs)(xe.Fragment,{children:[A&&(0,xe.jsx)("div",{onClick:()=>Vt.bn(),style:h.doubleChevronIcon,children:(0,zi.D)({width:15,height:15})}),(0,xe.jsxs)("div",{style:h.pageIconAndTitleContainer,children:[(0,xe.jsx)(pe.Z,{disabled:!0,icon:T,isEmptyPage:F,size:26,largeIcon:!0}),(0,xe.jsxs)("span",{style:h.titleAndLinkContainer,children:[(0,xe.jsx)("span",{style:{...h.title,...!y&&h.untitledPageColor},children:y??(0,xe.jsx)(K.FormattedMessage,{id:"search.preview.untitledPage",defaultMessage:"Untitled"})}),(0,xe.jsx)(rn,{onClick:B})]})]}),(0,xe.jsx)(Qi.Z,{style:h.previewContainer,href:R,hoveredStyle:h.hoveredOrPressedPreview,pressedStyle:h.hoveredOrPressedPreview,onClick:l,children:(0,xe.jsx)($i.Z,{variant:"default",store:r.value.selectedResult.store,coverFormat:Ji,coverSizeFormat:"large",showEmptyGalleryCover:!1,coverContentFadedOverlay:!0,coverContentFadedOverlayStyle:h.contentCoverFade,contentWrapStyle:h.contentCover,coverHeight:180,onLoadProxiedImage:()=>{},renderAdditionalBlocks:!0,rendererBlockStyle:{fontSize:9}})}),(0,xe.jsx)("div",{style:h.metadataContainer,children:P.filter((e=>void 0!==e.itemValue)).map(((e,t)=>(0,xe.jsx)(Xi,{isFirstInList:0===t,itemName:e.itemName,itemValue:e.itemValue,associatedUser:e.associatedUser},e.key)))})]}):(0,xe.jsx)(tn,{query:r.value??""})}),E?(0,xe.jsxs)("div",{style:h.report,children:[(0,xe.jsx)(vi,{experiments:null==_||null===(t=_.serverEventProperties)||void 0===t?void 0:t["server-searchExperiments"],localResults:null==L?void 0:L.results,serverResults:null==_?void 0:_.results,debugInfo:null==_?void 0:_.debugInfo}),(0,xe.jsx)(Nr.Z,{ariaLabel:"Button to open search's debug side panel",onClick:()=>j.ZP.setState({...j.ZP.state,isDebugSidebarOpen:!0}),style:h.debugGearIcon,hoveredStyle:h.hoveredDebugGearIcon,icon:e=>(0,ar.H)({width:12,height:12})})]}):null]})}function tn(e){window.__c={n:"QnaPanel"};const{query:t}=e,r=(0,o.yK)((e=>({container:{display:"flex",flexDirection:"column",gap:30},chatAndAvatarContainer:{display:"flex",gap:6,alignItems:"flex-end"},chatContainer:{display:"flex",flexDirection:"column",gap:10,flexGrow:1,justifyContent:"center"},questionBubble:{backgroundColor:e.cardHoveredBackground,color:e.lightTextColor,padding:8,borderRadius:16,fontSize:12,minWidth:40,minHeight:32,width:"fit-content",maxWidth:180,alignSelf:"flex-end",userSelect:"none",overflow:"hidden",textOverflow:"ellipsis"},introBubble:{backgroundColor:e.accentColors.purple[50],color:e.accentColors.purple[500],padding:"8px 12px",borderRadius:16,fontSize:14,width:170,userSelect:"none",overflow:"hidden",display:"flex",flexDirection:"column",gap:6,textOverflow:"ellipsis"},helperDescription:{textAlign:"center",fontSize:12,color:e.lightTextColor,display:"flex",justifyContent:"center"},loadingDots:{border:`1px solid ${e.lightDividerColor}`,padding:12,borderRadius:100,width:"max-content"},writingIndicatorCircle:{height:5,width:5,opacity:.6,backgroundColor:e.lightIconColor,borderRadius:"100%"},writingButtonWrapper:{display:"flex",alignItems:"center",justifyContent:"center",gap:3,width:"inherit",height:"inherit"}})),[]);return(0,xe.jsxs)("div",{style:r.container,children:[(0,xe.jsxs)("div",{style:r.chatAndAvatarContainer,children:[(0,xe.jsx)(sn,{}),(0,xe.jsx)("div",{style:r.chatContainer,children:t?(0,xe.jsxs)(xe.Fragment,{children:[(0,xe.jsx)("div",{style:r.questionBubble,children:t}),(0,xe.jsx)("div",{style:r.loadingDots,children:(0,xe.jsxs)("div",{role:"decorative",style:r.writingButtonWrapper,children:[(0,xe.jsx)("div",{role:"decorative",style:r.writingIndicatorCircle}),(0,xe.jsx)("div",{role:"decorative",style:r.writingIndicatorCircle}),(0,xe.jsx)("div",{role:"decorative",style:r.writingIndicatorCircle})]})})]}):(0,xe.jsxs)("div",{style:r.introBubble,children:[(0,xe.jsx)("div",{children:(0,xe.jsx)(K.FormattedMessage,{id:"searchSidePeekPanel.welcomeMessage.title",defaultMessage:"Hi! I'm Notion AI."})}),(0,xe.jsx)(K.FormattedMessage,{id:"searchSidePeekPanel.welcomeMessage.caption",defaultMessage:"Let me help you find information and answer questions."})]})})]}),(0,xe.jsx)("div",{style:r.helperDescription,children:(0,xe.jsx)("div",{style:{width:"90%"},children:(0,xe.jsx)(K.FormattedMessage,{id:"SearchSidePeek.caption",defaultMessage:"Get quick answers for anything in your workspace"})})})]})}function rn(e){window.__c={n:"CopyLinkIcon"};const t=(0,i.O7)(),r=(0,o.yK)((e=>({linkIcon:{width:14,height:14,fill:"light"===e.mode?e.accentColors.gray[300]:e.accentColors.gray[500]},hoveredBackground:{backgroundColor:e.buttonHoveredBackground},shortcutLabel:{color:e.mediumInvertedTextColor},tooltipContent:{display:"flex",flexDirection:"column"}})),[]),s=(0,n.VK)((()=>(0,f.bN)(t)),[t]);return(0,xe.jsx)(Cr.Z,{delayThreshold:600,placement:Cr.Z.Placement.Top,allowHover:!0,renderTooltip:()=>(0,xe.jsxs)("div",{style:r.tooltipContent,children:[(0,xe.jsx)(K.FormattedMessage,{id:"search.preview.copyLink",defaultMessage:"Copy link"}),s&&(0,xe.jsx)(Sr.Z,{style:r.shortcutLabel,name:"copyLinkToCurrentPage"})]}),closeDelay:0,render:t=>(0,xe.jsx)(Nr.Z,{...t,icon:e=>(0,Ki.N)(r.linkIcon),ariaLabel:"Button to toggle the filter bar",hoveredStyle:r.hoveredBackground,onClick:e.onClick})})}function sn(){window.__c={n:"AssistantLogo"};const e=(0,o.yK)((e=>({faceImgWrap:{width:32,height:32,borderRadius:"100%",background:e.whiteButtonBackground,border:`1px solid ${e.lightDividerColor}`,overflow:"hidden",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"},faceImg:{width:40,pointerEvents:"none"},aiSparklesFill:{height:14,width:14,fill:e.mediumIconColor,pointerEvents:"none"}})),[]);return(0,xe.jsx)("div",{style:e.faceImgWrap,children:(0,Dt.t)(e.aiSparklesFill)})}function nn(e){window.__c={n:"SearchContentPane"};const t=(0,i.Fy)(),r=(0,i.O7)();return(0,s.useEffect)((()=>{h.S(r)}),[r]),(0,y.Z)(),(0,xe.jsx)(w.Z,{capture:!0,ignoreBlockSelection:!0,focusOffscreenInput:!1,restoreSelection:!t.isMobile,render:()=>(0,xe.jsx)(k.Z,{capture:!0,allowMenuList:!0,render:t=>(0,xe.jsx)(on,{...e,ignoreAreaEvents:t})})})}function on(e){window.__c={n:"SearchContentPaneInner"};const{ignoreAreaEvents:t,renderAsPage:r,quickSearchMode:d,onClose:c,searchContentPaneType:h}=e,{handleQueryChange:y,searchFilterMenuRef:x,modalBodyMenuRef:S,searchResultStore:k,focusedIndexStore:w,defaultBodyFocusedResult:F,searchActionItemsStore:R,handleSelectSearchResult:A,handleCopySearchItemLink:O}=(0,s.useContext)(Z.SearchStaticContext),[L,_]=(0,s.useState)(!1),[E,D]=(0,s.useState)(!1),V=(0,i.O7)(),q=(0,i.Fy)(),N=(0,n.VK)((()=>j.ZP.state.query.text),[]),{isSearchMenuOpen:W,shouldShowDebugSidebar:H,hasPublicAccessPermission:z,shouldShowSpinner:K}=(0,n.VK)((()=>{const e=Boolean(b.Z.state.online),{hasPublicAccessPermission:t}=v.bC(V);return{isSearchMenuOpen:I.default.state.open,shouldShowSpinner:e&&Boolean(N)&&k.state.serverResultsLoading&&!L,shouldShowDebugSidebar:un({device:q,isPublicAccessPermissionForPage:t}),hasPublicAccessPermission:t}}),[L,k,q,V,N]),U=(0,s.useMemo)((()=>l.Ds((()=>{const{activeElement:e}=document;e instanceof HTMLInputElement&&e.blur()}),500,{leading:!0})),[]),G=(0,s.useCallback)((()=>{E&&U()}),[U,E]),$=(0,s.useCallback)((e=>{D(e),e||q.isMobileNative&&C.Z.updateKeyboardPhase(V,C.i.willHide,0)}),[q.isMobileNative,V]),Q=(0,n.VK)((()=>v.pG({searchResultStore:k,focusedIndexStore:w,searchActionsStore:R})),[k,w,R]),X=(0,n.VK)((()=>F.state),[F]),Y=(0,s.useMemo)((()=>(0,xe.jsx)(Et.Z,{isOpen:Boolean(r||W),onTypingChange:_,onFocusChange:$,showSpinner:K,onQueryChange:y,quickSearchMode:d,selectedResult:"page_result"===(null==Q?void 0:Q.type)?Q.value.selectedResult.store:void 0})),[r,W,$,K,y,d,Q]),J=(0,n.VK)((()=>an({searchContentPaneType:h,renderAsPage:r,environment:V})),[h,r,V]),ee=(0,o.yK)((e=>({body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",zIndex:2},topbar:{height:void 0,marginTop:10,marginLeft:16,marginBottom:10,marginRight:16},topbarRightButtonWrapper:{flex:void 0,paddingLeft:16},topbarButton:{fontWeight:void 0,padding:0,color:e.mediumTextColor},scroller:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"space-between",maxHeight:J.maxHeight,minHeight:J.minHeight}})),[J.maxHeight,J.minHeight]),te=(0,s.useMemo)((()=>{if(q.isMobile){return{menuType:g.og.Modal,left:Y,shouldRenderLeftDirectly:!0,width:r?"100vw":void 0,...dn({isPhone:q.isPhone,renderAsPage:r,style:ee.topbarRightButtonWrapper,onClick:c}),header:"search_results"===h&&(0,xe.jsx)(Ot,{isPublicPageSearch:z}),disableHeaderShadow:!0,topbarStyle:ee.topbar,leftRightButtonStyle:ee.topbarButton,onScroll:cn(q)?G:void 0,bodyScrollerClassName:p.GZn,...t}}return{menuType:g.og.Popup,maxHeight:J.maxHeight,minHeight:J.minHeight,maxWidth:"100%",...d?{width:"100vw"}:{},disableScroller:!0,scrollerStyle:ee.scroller,...t}}),[q,ee,t,Y,r,c,h,z,G,J.minHeight,J.maxHeight,d]),re=X||Q;"assistant"===(null==re?void 0:re.type)&&(re.value=N);const se=(0,n.VK)((()=>R.state.length),[R]),ie=(0,n.VK)((()=>{if("page_result"===(null==re?void 0:re.type)){const{index:e,selectedResult:t,allSearchResults:r}=re.value;return s=>A({event:s,index:e,selectedResult:t,allSearchResults:r,fromSidePeekPanel:!0,actionItemCount:se,context:"search_results"===h?"query_results":"recent_pages"})}}),[se,A,h,re]),ne=(0,n.VK)((()=>{if("page_result"===(null==re?void 0:re.type)){const{index:e,selectedResult:t,allSearchResults:r}=re.value;return s=>{const{source:i}=s;O({index:e,selectedResult:t,allSearchResults:r,fromSidePeekPanel:i===Z.SearchCopyLinkSource.SidePeekPanel,actionItemCount:se,context:"search_results"===h?"query_results":"recent_pages",source:i})}}}),[se,O,h,re]),oe=(0,n.VK)((()=>!(0,f.bN)(V)&&V.WindowSizeStore.state.width<Z.DEFAULT_MODAL_WIDTH_WITH_SIDE_PEEK),[V]),ae=(0,n.VK)((()=>!((0,M.gq)({device:q})||oe||j.ZP.state.isDebugSidebarOpen||void 0===re||"default_body"===h)&&(0,f.Qi)(V)),[V,h,re,q,oe]);(0,n.VK)((()=>{j.ZP.state.isSidePeekPanelOpen!==ae&&j.ZP.update((e=>({...e,isSidePeekPanelOpen:ae})))}),[ae]);const le=(0,s.useCallback)((()=>{if(!d||!re||"page_result"!==re.type)return;const e=re.value.selectedResult.store,t=(0,m.Hu)({store:e,collectionViewId:e.id,fullyQualified:!0,pageVisitSource:a.tY.SearchQuery});t&&(u.RD({environment:V,stringValue:t,copiedMessage:u.tq.copiedLinkToClipboard}),ne&&ne({source:Z.SearchCopyLinkSource.KeyboardShortcut}))}),[V,ne,d,re]);return(0,xe.jsx)(P.Z,{capture:!0,onCopyLinkToCurrentPage:e=>{le()},onCopyLinkToPageInCommandSearch:e=>{le()},children:(0,xe.jsx)(T.Z,{...te,className:p.Oau,ref:S,children:(0,xe.jsxs)(ln,{enableLazyLoading:r,children:[(0,xe.jsxs)("div",{style:ee.body,children:[(0,xe.jsx)(B.Z,{}),!q.isMobile&&Y,(0,xe.jsx)(Hi,{searchContentPaneType:h})]}),ae&&void 0!==re?(0,xe.jsx)(en,{selectedResult:re,onClickPreview:ie,handleClickCopyLink:ne}):void 0,H&&(0,xe.jsx)(yt,{ref:x})]})})})}function an(e){const{searchContentPaneType:t,renderAsPage:r,environment:s}=e;if(r)return{maxHeight:"100vh",minHeight:"100vh"};if((0,f.rd)(s)){const e=550,r=s.WindowSizeStore.state.height>e+(0,c.u3)(s.device.isElectronMac)?e:0;return{minHeight:`max(${"search_results"===t?70:50}vh, ${r}px)`,maxHeight:`max(${"search_results"===t?70:50}vh, ${r}px)`}}return"assistant"===j.ZP.state.mode?{maxHeight:"80vh",minHeight:570}:{maxHeight:"80vh",minHeight:50}}function ln(e){window.__c={n:"SearchMenuContentsWrapper"};const{enableLazyLoading:t,children:r}=e,n=(0,i.O7)();return t?(0,xe.jsx)(R.Z,{fetch:async()=>{var e;await d.Vs(0),await S.default.waitUntil((()=>void 0!==S.default.state.currentSpaceStore)),null===(e=n.mobileNative)||void 0===e||e.markTransitionReady({type:"search"})},loading:()=>(0,xe.jsx)(s.Fragment,{}),render:()=>r}):(0,xe.jsx)(s.Fragment,{children:r})}function dn(e){let{isPhone:t,style:r,renderAsPage:s,onClick:i}=e;return t&&(0,x.Y)("supportsNativeHome")||s?{rightOuterStyle:{display:"none"}}:{right:(0,xe.jsx)(F.CancelMenuText,{}),onClickRight:i,rightOuterStyle:r}}function cn(e){return!!e.isMobile&&(!e.isIOS||e.isMobileNative)}function un(e){let{device:t,isPublicAccessPermissionForPage:r}=e;if(!r&&!t.isMobile)return j.ZP.isDebugSidebarOpen()}},86244:(e,t,r)=>{r.d(t,{$:()=>G,Z:()=>X});var s=r(67294),i=r(83355),n=r(480),o=r(86628),a=r(24405),l=r(6637),d=r(35840),c=r(94804),u=r(70203),h=r(82990),p=r(68939),m=r(12457),g=r(34700),f=r(59139),v=r(97638),y=r(38755),x=r(5162),S=r(80444),b=r(21273),C=r(25904),M=r(30857),I=r(29026),j=r(73063),k=r(74194),w=r(68785),P=r(31278),T=r(26388),F=r(72787),R=r(72126),B=r(50906),Z=r(87531),A=r(70782),O=r(81598),L=r(87279),_=r(29741),E=r(78861),D=r(69327),V=r(55320),q=r(31945),N=r(78140),W=r(53437),H=r(33991),z=r(85893);function K(e){window.__c={n:"WorkspaceIcon"};const{events:t,spaceIcon:r,spaceName:i}=e,[n,o]=(0,s.useState)(!1),l=(0,a.yK)((e=>({downIcon:{height:8,width:8,stroke:e.icon.tertiary},wrapper:{display:"flex",alignItems:"center",gap:2,paddingRight:5,...(0,g.X)({noDrag:!0}),cursor:"pointer"},recordIcon:{backgroundColor:n?e.buttonHoveredBackground:void 0,padding:4,height:void 0,width:void 0}})),[n]);return(0,z.jsxs)("span",{...t,style:l.wrapper,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[(0,z.jsx)(P.Z,{bucket:"public",disabled:!0,icon:r,isEmptyPage:!1,size:24,style:l.recordIcon,title:i}),(0,F.Y)(l.downIcon)]})}const U=function(){window.__c={n:"SearchWorkspaceSwitcher"};const e=(0,o.VK)((()=>S.default.state.currentSpaceStore),[]),t=(0,o.VK)((()=>null==e?void 0:e.id),[null==e?void 0:e.id]),r=(0,n.O7)(),i=(0,o.VK)((()=>r.currentUser.id),[r.currentUser.id]),{handlePopupOpen:a,handlePopupClose:l}=(0,s.useContext)(H.SearchStaticContext),d=(0,s.useCallback)((async e=>{const{newSpaceView:t,associatedUserId:s,closeSwitcherPopupFn:n}=e,o=t.getSpaceId();if(t&&i&&o){var a;const e=null===(a=S.default.state.currentSpaceViewStore)||void 0===a?void 0:a.id,l=V.default.state.sessionId;e&&l&&o&&B.fho(r,{currentSearchSessionId:l,currentWorkspaceId:e,newWorkspaceId:o}),n(),S.default.update((e=>({...e,currentSpaceViewStore:t,currentSpaceStore:null==t?void 0:t.getSpaceStore()}))),i!==s&&await A.x({environment:r,newCurrentUserId:s}),b.Z.isAiEnabled()&&O.L6.loader().then((e=>{let{assistantActions:t}=e;t.clearAllAssistantSessions()})),D.Z.reinitializeState(r,s,o),V.default.closeAndResetMetricsState(),M.default.reset(),Z.UT({environment:r,analyticsFrom:"quick-search-switch-workspace",isQuickSearch:!0,renderAsPage:!0})}}),[i,r]),{spaceIcon:c,spaceName:u}=(0,o.VK)((()=>e?{spaceName:e.getName(),spaceIcon:(0,y.Wd)(r,e)}:{spaceName:void 0,spaceIcon:void 0}),[e,r]),h=[...E.Z.getUserIds(r)],p=(0,o.VK)((()=>{var e;return R.mN(R.oA((null===(e=S.default.state.currentUserRootStore)||void 0===e?void 0:e.getSpaceViewStores())??[]),(e=>e.getSpaceId()))}),[]);return e?!t||!i||!e||p.length<=1&&1===h.length?null:(0,z.jsx)(q.ZP,{popupType:q.Z4.Popup,renderOrigin:e=>(0,z.jsx)(K,{events:e,spaceIcon:c,spaceName:u}),render:e=>(0,z.jsx)(N.Z,{menuType:L.og.Popup,children:h.map(((t,r)=>(0,z.jsx)(_.LP,{onSpaceClick:r=>d({newSpaceView:r.spaceViewStore,associatedUserId:t,closeSwitcherPopupFn:e.close}),userId:t,isLastUser:r===h.length-1,disableAccountActions:!0,hideShortcuts:!0},`commandSearch-userworkspaces-${r}`)))}),onClick:a,onClose:l,disabled:!1,placementToOrigin:W.ZP.Placement.Bottom,alignmentToOrigin:W.ZP.Alignment.Start,style:{...(0,g.X)({noDrag:!0}),marginRight:30}}):null},G=48;class $ extends i.Z{constructor(){super(...arguments),this.typingTimer=void 0,this.renderLeft=()=>{const{showSpinner:e,selectedResult:t,quickSearchMode:r}=this.props,{device:s}=this.environment,i=this.styles,n={...J(this.theme).searchIcon,...i.searchIcon};if(r)return(0,z.jsx)(U,{});const o=null==t?void 0:t.getIcon(),a=Boolean(I.ZP.state.query.text.trim())&&!s.isMobile;return(0,z.jsx)(m.Z,{show:e,showDelay:500,showHold:200,render:e=>(e=>(0,z.jsx)("div",{style:i.headerIcon,children:e?(0,z.jsx)(w.Z,{style:n}):a?(0,z.jsx)(P.Z,{disabled:!0,icon:o,isEmptyPage:Boolean(o),size:20}):(0,d.R)(n)}))(e)})},this.handleQueryChange=e=>{this.handleTyping();const t=String(e.target.value);this.props.onQueryChange(t)},this.handleClearButtonClick=()=>{I.ZP.resetQuery({resetFilters:!0}),I.ZP.update((e=>({...e,source:"quick_find"})))},this.handleFocus=()=>{const{onFocusChange:e}=this.props;e(!0)},this.handleBlur=()=>{const{onFocusChange:e}=this.props;e(!1)},this.isPopupOpen=this.createComputedStore((()=>I.ZP.state.isPopupOpen)),this.styles={inputDesktop:{fontSize:18,height:G,paddingLeft:12,paddingRight:16,alignItems:"center",flexGrow:0,flexShrink:0,zIndex:1},inputMobile:{fontSize:16,border:"none",boxShadow:"none",borderRadius:7,lineHeight:"1.2",padding:"6px 8px"},searchIcon:{width:16,height:16},headerIcon:{height:24,width:24,display:"flex",alignItems:"center",justifyContent:"center"},input:{minWidth:0,...h.Z.textOverflowStyle},suggestedText:{whiteSpace:"pre",color:this.theme.mediumTextColor},suggestedTextWrapper:{overflow:"hidden",textOverflow:"ellipsis"},autoCompletedText:{background:this.theme.tint.regular},clearButton:{marginLeft:8},userInputAndSuggestedTextContainer:{display:"grid",gridTemplateColumns:"auto 1fr"}}}willUnmount(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=void 0)}renderComponent(){const{device:e}=this.environment,{isOpen:t,selectedResult:r,quickSearchMode:s}=this.props,i=this.styles,n=J(this.theme),o=I.ZP.state.query.text,a=function(e,t,r){if(0===r.length||r.length>=20||e.isMobile||void 0===t)return;const s=u.Jcv(t.getTitleValue()),i=s.replaceAll("\n"," "),n=s.slice(0,r.length),o=i.substring(r.length);if(s.length>0&&n.toLocaleLowerCase()===r.toLocaleLowerCase())return`${o} — ${$.messages.open.defaultMessage}`;return` — ${$.messages.open.defaultMessage}`}(e,r,o),l=o.trim().length>0&&a?(0,z.jsxs)("div",{style:i.userInputAndSuggestedTextContainer,children:[(0,z.jsx)("span",{style:{whiteSpace:"pre-wrap"},children:o}),(0,z.jsx)("div",{style:{...i.suggestedTextWrapper,...s&&!this.isPopupOpen.state&&(0,g.X)({drag:!0})},children:(0,z.jsx)("span",{style:i.autoCompletedText,children:a})})]}):"",d=e.isMobile?k.Z.Format.ExtraLarge:k.Z.Format.Transparent,c=e.isMobile?{...i.inputMobile,...n.inputMobile}:{...i.inputDesktop,...n.inputDesktop},h=b.Z.showSearchAiFeatures()||(0,f.rd)(this.environment),p={...i.input,...s&&(0,g.X)({noDrag:!0}),width:0===o.length&&s?`min(${Y(this.props.intl,this.environment).length}ch, 100%)`:"100%"};return(0,z.jsx)("div",{style:{display:"flex",flex:1},children:(0,z.jsx)(k.Z,{format:d,placeholder:Y(this.props.intl,this.environment),left:this.renderLeft(),value:o,suggestedText:l,suggestedTextStyle:i.suggestedText,focus:e.isMobile?void 0:t&&!C.Z.state.open,focusInitial:!(0,x.Y)("supportsNativeHome")&&e.isMobile,focusAfterAnimation:!0,showClearButton:!0,right:!e.isMobile&&h&&(0,z.jsx)(Q,{quickSearchMode:s}),isRightLastElementOfInput:!0,selectAll:!0,onChange:this.handleQueryChange,onClearButtonClick:this.handleClearButtonClick,onFocus:this.handleFocus,onBlur:this.handleBlur,style:c,inputStyle:p,clearButtonStyle:{...s&&(0,g.X)({noDrag:!0})}})})}handleTyping(){void 0===M.default.state.firstKeyStrokeTimeMs&&M.default.update((e=>({...e,firstKeyStrokeTimeMs:Date.now()})));const{onTypingChange:e}=this.props;this.typingTimer&&window.clearTimeout(this.typingTimer),e(!0),this.typingTimer=window.setTimeout((()=>e(!1)),300)}}function Q(e){window.__c={n:"FilterIconButton"};const[t,r]=(0,o.VK)((()=>{const e=I.ZP.state.query.filters,t=(0,v.FN)(e);return[I.ZP.state.filterBar.show,t]}),[]),s=(0,n.O7)();(0,o.VK)((()=>{const e=s.currentUser.id;if(!e)return;!1===(0,c.fe)(e)&&!0===t&&I.ZP.collapseFilterBar()}),[s,t]);const i=(0,a.yK)((t=>({container:{padding:4,marginLeft:5,borderRadius:4,height:"fit-content",width:"fit-content",display:"flex",...e.quickSearchMode&&(0,g.X)({noDrag:!0})},hoveredContainerStyles:{background:r?t.accentColors.uiBlue[100]:t.buttonHoveredBackground},icon:{width:17,height:17,cursor:"pointer",fill:r?t.accentColors.uiBlue[600]:"light"===t.mode?t.accentColors.gray[300]:t.accentColors.gray[500]}})),[r,e.quickSearchMode]);return(0,z.jsx)(T.Z,{renderTooltip:()=>(0,z.jsx)(z.Fragment,{children:(0,z.jsx)("div",{children:t?(0,z.jsx)(p.FormattedMessage,{id:"searchInputMenuItem.filterBarToggleButtonTooltip.hide",defaultMessage:"Hide filters"}):(0,z.jsx)(p.FormattedMessage,{id:"searchInputMenuItem.filterBarToggleButtonTooltip.show",defaultMessage:"Show filters"})})}),placement:T.Z.Placement.Bottom,alignment:T.Z.Alignment.Start,disableTooltip:s.device.isMobile,delayThreshold:400,render:e=>(0,z.jsx)(j.Z,{...e,icon:e=>(0,l.I)(i.icon),ariaLabel:"Button to toggle the filter bar",style:i.container,hoveredStyle:i.hoveredContainerStyles,onClick:()=>t?I.ZP.collapseFilterBar():I.ZP.expandFilterBar()})})}$.displayName="SearchInputMenuItem",$.messages=(0,p.defineMessages)({open:{id:"search.inputMenu.suggestedText.open",defaultMessage:"Open"}});const X=(0,p.injectIntl)($);function Y(e,t){const{currentSpaceStore:r,mainEditorCurrentBlockStore:s}=S.default.state,i=r&&(0,y.rn)(t,r);if(i&&b.Z.showSearchAiFeatures())return e.formatMessage({id:"searchInputMenuItem.placeholder.SearchOrAskQuestionInSpace",defaultMessage:"Search or ask question in {spaceName}…"},{spaceName:i});if(i)return e.formatMessage({id:"searchInputMenuItem.placeholder.searchInSpace",defaultMessage:"Search {spaceName}…"},{spaceName:i});if(s){const t=u.Jcv(s.getTitleValue()).slice(0,100);return e.formatMessage({id:"searchInputMenuItem.placeholder.namedPage",defaultMessage:"Search in {pageTitle}…"},{pageTitle:t})}return e.formatMessage({id:"searchInputMenuItem.placeholder.unnamedPage",defaultMessage:"Search in page…"})}function J(e){return{inputDesktop:{boxShadow:`0 1px 0 ${e.regularDividerColor}`},inputMobile:{background:e.inputBackground},searchIcon:{fill:e.mediumIconColor}}}},57254:(e,t,r)=>{r.d(t,{A:()=>a,S:()=>l});r(21703);var s=r(94568),i=r(97880),n=r(80444),o=r(98165);function a(){const{mainEditorCurrentBlockStore:e}=n.default.state;if(!e)throw new Error("No current block store");const t=(0,o.qA)(e);return Boolean(t.find((e=>e.id===s.TM||e.id===s.y3)))}function l(e){return"assistantChat"===e.type?1===e.operations.length&&"createBlock"===e.operations[0].command&&"text"===e.operations[0].blockNode.tagName&&0===e.operations[0].blockNode.text.length:"assistantChatText"===e.type?0===e.text.length:void(0,i.t1)(e)}},85665:(e,t,r)=>{r.d(t,{Z:()=>N});var s=r(67294),i=r(480),n=r(86628),o=r(72126),a=r(33991),l=r(75822),d=r(32470),c=r(59054),u=r(21202),h=r(94804),p=r(92338),m=r(97880),g=r(63143),f=(r(21703),r(74487));const v=Symbol("JSON Schema"),y=Symbol("JSON Schema Components"),x=Symbol("No JSON Schema"),S={isNull:()=>({type:"null",[y]:{}}),boolean:()=>({type:"boolean",[y]:{}}),number:()=>({type:"number",[y]:{}}),integer:()=>({type:"integer",[y]:{}}),string:()=>({type:"string",[y]:{}}),dateString:()=>({type:"string",format:"date",[y]:{}}),literal:e=>({enum:[e],[y]:{}}),literals:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return{enum:t,[y]:{}}},uuid:()=>({type:"string",format:"uuid",[y]:{}}),uuidWithoutDashes:()=>({type:"string",format:"uuid",[y]:{}}),any:()=>C,array:e=>({type:"array",items:e[v],[y]:e[v][y]}),tuple:e=>({type:"tuple",items:!1,prefixItems:e.map((e=>e[v])).filter((e=>e!==x)),[y]:Object.assign({},...e.map((e=>e[v][y])))}),record:(e,t)=>({type:"object",additionalProperties:t[v],[y]:t[v][y]}),object:e=>{let{required:t,optional:r,exact:s}=e;return{type:"object",properties:(0,g.m8)(Object.entries({...t,...r}).filter((e=>{let[t,r]=e;return r[v]!==x})).map((e=>{let[t,r]=e;return[t,r[v]]}))),...s&&{additionalProperties:!1},...Object.keys(t).length>0&&{required:Object.keys(t)},[y]:Object.assign({},...Object.values({...t,...r}).map((e=>e[v][y])))}},union:e=>({anyOf:e.map((e=>e[v])).filter((e=>e!==x)),[y]:Object.assign({},...e.map((e=>e[v][y])))}),gte:(e,t)=>{const r=e[v];return r!==x?{...r,minimum:t}:r},lte:(e,t)=>{const r=e[v];return r!==x?{...r,maximum:t}:r},maxLength:(e,t)=>{const r=e[v];if(r===x)return r;if("type"in r){if("string"===r.type)return{...r,maxLength:t};if("array"===r.type)return{...r,maxItems:t}}throw new Error("Unknown type for max length.")},minLength:(e,t)=>{const r=e[v];if(r===x)return r;if("type"in r){if("string"===r.type)return{...r,minLength:t};if("array"===r.type)return{...r,minItems:t}}throw new Error("Unknown type for min length.")},nonEmpty:e=>{const t=e[v];if(t===x)return t;if("type"in t){if("string"===t.type)return{...t,minLength:1};if("object"===t.type)return{...t,minProperties:1};if("array"===t.type)return{...t,minItems:1}}throw new Error("Unknown non-emptyable type.")},nullable:e=>{const t=e[v];if(t===x)return t;if("type"in t)if(Array.isArray(t.type)){if("null"===t.type[1])return t;(0,m.t1)(t.type[1])}else{if("string"===t.type)return{...t,type:[t.type,"null"]};if("object"===t.type)return{...t,type:[t.type,"null"]};if("array"===t.type)return{...t,type:[t.type,"null"]};if("tuple"===t.type)return{...t,type:[t.type,"null"]};if("boolean"===t.type)return{...t,type:[t.type,"null"]};if("integer"===t.type)return{...t,type:[t.type,"null"]};if("number"===t.type)return{...t,type:[t.type,"null"]};if("null"===t.type)return t;(0,m.t1)(t.type)}else{if("const"in t)return{...t,enum:[t.const,null]};if("enum"in t)return{...t,enum:[...t.enum,null]};if("anyOf"in t)return{...t,anyOf:t.anyOf.map((e=>S.nullable({[v]:e})))};if("$ref"in t)return{anyOf:[t,{type:"null"}],[y]:t[y]};if(M(t))return t;(0,m.t1)(t)}}},b=(0,g.m8)(Object.entries(S).map((e=>{let[t,r]=e;return[t,function(){for(var e=arguments.length,s=new Array(e),i=0;i<e;i++)s[i]=arguments[i];return 1===s.length&&(0,m.Kn)(s[0])&&("id"in s[0]||"description"in s[0])?function(){const{description:e,examples:i,id:n}=s[0];let o={description:e,...i&&{examples:i},...r(...arguments)};return n&&(o={$ref:`#/components/schemas/${n}`,[y]:{...o[y],[n]:o}}),{[v]:o,...f[t](...arguments)}}:{[v]:r(...s),...f[t](...s)}}]}))),C=(Symbol("Exact empty object ({})"),b.object({id:"emptyObject"})({required:{},optional:{},exact:!0}),{});function M(e){return(0,m.Kn)(e)&&0===Object.keys(e).length}var I=r(50906),j=r(59139),k=r(97638),w=r(18245),P=r(49038),T=r(80444),F=r(88632),R=r(77080),B=r(69327),Z=r(84166),A=r(26350),O=r(55320),L=r(30857),_=r(29026);function E(e){let{dependencies:t,debugColumnStore:r,localDebounce:s=75,fetchServerResultsFn:a,searchResultStore:l,permanentFilterOverride:d,enabled:u}=e;const h=(0,i.O7)(),p=(0,n.VK)((()=>function(e){const{isOnline:t,debugColumnStore:r}=e,s=r.state.searchExperimentOverrides;function i(e){return(null==s?void 0:s[e])??R.default.getGroup(e,{disableExposureLogging:!0})}return{shouldSearchLocal:"on"!==i("search-no-local-blending")&&t,forcedClusterPattern:r.state.forcedClusterPattern,searchExperimentOverrides:r.state.searchExperimentOverrides,forcedBlockIds:r.state.forcedBlockIds}}({isOnline:t.isOnline,debugColumnStore:r})),[t.isOnline,r]);(0,c.r5)((()=>u?async function(e){var t;const{query:r,openAsPage:s,store:i,fetchServerResultsFn:n}=e;if(s&&o.Xy(r,i.state.selectedQueryResultQuery))return;"quick_find_scroll"!==_.ZP.state.source&&function(e){const{shouldSearchLocal:t,parentStore:r,environment:s,query:i,debug:n,limit:o,hasPublicAccessPermission:a,isOnline:l,store:d,permanentFilterOverride:c}=e;let u;const h={...i,filters:{...i.filters,...c}};t?(u=k.b9(function(e){const{parentStore:t,requestInput:r,isOnline:s,environment:i,hasPublicAccessPermission:n,localSearchCache:o}=e,{query:a}=r;if(!o)return;if(!a.text.trim())return;if(n)return;const l=w.default.mark("rum.local_quick_search_query"),d=void 0,c=(0,P.Y)({query:r,localCachedPages:o,parentStore:t,environment:i,isOnline:s,shouldLimitLocalResultsWhenOnline:!0,applyScoreThresholdWhenOnline:!0,maxLocalResultsOverride:d,canUseLtr:!0});return w.default.measure(l,{environment:i}),c}({parentStore:r,environment:s,requestInput:{query:h,debug:n,limit:o},hasPublicAccessPermission:a,isOnline:l,localSearchCache:Z.Z.state.localSearchableBlocksCache})),L.default.update((e=>({...e,numLocalRequests:e.numLocalRequests+1}))),d.update((e=>({...e,localResults:u})))):d.update((e=>({...e,localResults:void 0})))}(e);const a=new Set;null===(t=i.state.localResults)||void 0===t||t.results.forEach((e=>a.add(e.id))),await n({...e,excludedBlockIds:[...a]})}({...t,...p,store:l,fetchServerResultsFn:a,environment:h,permanentFilterOverride:d}):Promise.resolve()),[t,p,l,a,h,d,u],{debounce:s})}async function D(e){var t,r,s;let{parentStore:i,environment:n,query:o,debug:a,isOnline:l,publicAccessPermissionAncestorBlockId:d,currentSpaceStore:c,searchExperimentOverrides:f,forcedClusterPattern:v,store:y,forcedBlockIds:x,limit:S,permanentFilterOverride:b,excludedBlockIds:C}=e;const P={...o,filters:{...o.filters,...b}};if(!P.text.trim()&&!k.FN(P.filters))return;const T=_.ZP.state.source,F="quick_find_scroll"===T,Z="on"!==R.default.getGroup("search-clear-results-on-query-change"),E=F||0===L.default.state.numServerRequests||Z;y.update((e=>({...e,serverResultsLoading:!0,serverResults:E?e.serverResults:void 0,serverEventProperties:E?e.serverResults:void 0}))),L.default.update((e=>({...e,numServerRequests:e.numServerRequests+1})));const D=(0,h.A7)({searchSessionId:O.default.state.sessionId,searchSessionFlowNumber:L.default.state.numServerRequests}),V={query:P,debug:a,limit:S},q=await async function(e){const{parentStore:t,requestInput:r,isOnline:s,environment:i,publicAccessPermissionAncestorBlockId:n,searchSessionId:o,searchSessionFlowNumber:a,source:l,spaceId:d,searchExperimentOverrides:c,forcedClusterPattern:h,forcedBlockIds:f,excludedBlockIds:v}=e;if(!s)return{error:p.Ix.Offline};const y=w.default.mark("rum.server_quick_search_query"),x=await k.MS({environment:i,input:r,spaceId:d,publicAccessPermissionAncestorBlockId:n,searchSessionId:o,searchSessionFlowNumber:a,source:l,searchExperimentOverrides:c,forcedClusterPattern:h,recentPagesForBoosting:d&&"on"!==(null==c?void 0:c["search-debug-only-no-recent-boosting"])?B.Z.getWithoutSubscribing(d):[],forcedBlockIds:f,excludedBlockIds:v});if(!x)return;if("failed"===x.type)return x.offline?{error:p.Ix.Offline}:{error:p.Ix.RequestFailed};const S=x.data.trackEventProperties,b=M(S)?{}:(0,g.m8)((0,m.Yd)(S).map((e=>[`server-${e}`,S[e]]))),C=x.data.results.map(((e,r)=>({...e,serverEventProperties:b,originalPosition:r,store:A.G.createChildStore(t,{table:u.iU,id:e.id})})));return w.default.measure(y,{environment:i}),{value:{results:C,total:x.data.total,debugInfo:x.data.debug,serverEventProperties:b,clusterInfo:x.data.clusterInfo}}}({parentStore:i,environment:n,requestInput:V,spaceId:null==c?void 0:c.id,searchSessionId:O.default.state.sessionId,searchSessionFlowNumber:L.default.state.numServerRequests,publicAccessPermissionAncestorBlockId:d,isOnline:l,source:T,searchExperimentOverrides:f,forcedClusterPattern:v,forcedBlockIds:x,excludedBlockIds:C});if(D!==(0,h.A7)({searchSessionId:O.default.state.sessionId,searchSessionFlowNumber:L.default.state.numServerRequests}))return;if(!q||q.error)return y.update((e=>({...e,serverError:null==q?void 0:q.error,serverResultsLoading:!1,serverResults:void 0,serverEventProperties:void 0})));const N=k.b9(q),W=F?k.Nu({existingResults:y.state.serverResults,newPageResults:N}):N,H=q.value.results;y.update((e=>({...e,serverError:null==q?void 0:q.error,serverResultsLoading:!1,serverResults:W,serverResultsAllLoaded:H.length<S,serverEventProperties:q.value.serverEventProperties})));const z=(null==W?void 0:W.results.map((e=>{var t;return{id:e.id,badges:(null===(t=e.badges)||void 0===t?void 0:t.map((e=>e.type)))??[]}})))??[],K=new Map;for(const{badges:u}of z)for(const e of u){const t=K.get(e)??0;K.set(e,t+1)}const{sections:U}=k.IV({intentBasedGrouping:(0,j.XP)(),localResults:null===(t=y.state.localResults)||void 0===t?void 0:t.results,serverResults:null==W?void 0:W.results}),G={};for(const[u,h]of Object.entries(U))G[u]=h.map((e=>e.id));I.ZfC(n,{numLocalResults:(null===(r=y.state.localResults)||void 0===r?void 0:r.results.length)||0,numServerResults:(null==W?void 0:W.results.length)||0,localResultsIds:(null===(s=y.state.localResults)||void 0===s?void 0:s.results.map((e=>e.id)))||[],...q.value.serverEventProperties,badgeCounts:K,badgesByResultId:z,idsBySection:G})}const V=(0,o.Ds)(D,l.rE),q=(0,o.Ds)(D,l.rE);function N(){const e=(0,i.Fy)(),{searchResultStore:t,secondarySearchResultStore:r}=(0,s.useContext)(a.SearchStaticContext),{parentStore:o}=(0,s.useContext)(a.SearchStoresContext),l=function(e){const t=(0,i.O7)();return(0,n.VK)((()=>{const{hasPublicAccessPermission:r,publicAccessPermissionAncestorBlockId:s}=k.bC(t);return{isOnline:Boolean(F.Z.state.online),limit:_.ZP.state.limit,parentStore:e,hasPublicAccessPermission:r,publicAccessPermissionAncestorBlockId:s,currentSpaceStore:T.default.state.currentSpaceStore,debug:d.ZP.getDebugLevel(),openAsPage:O.default.state.openAsPage,currentSpaceViewStore:T.default.state.currentSpaceViewStore,query:_.ZP.state.query}}),[t,e])}(o),c=(0,n.VK)((()=>Boolean((0,d.gq)({device:e})&&d.BJ.state.visible)),[e]);E({dependencies:l,searchResultStore:t,debugColumnStore:d.v_,enabled:!0,fetchServerResultsFn:V}),E({dependencies:l,searchResultStore:r,debugColumnStore:d.BJ,enabled:c,fetchServerResultsFn:q})}},49038:(e,t,r)=>{r.d(t,{Y:()=>F,f:()=>T});var s=r(58573),i=r(72126),n=r(4615),o=r(21202),a=r(45366),l=r(92338),d=r(24215),c=r(97638),u=(r(57658),r(80444)),h=r(46735),p=r(42198);const m=e=>{var t;let{result:r,featureExtractor:s}=e;const i=null===(t=s.frecencyStore)||void 0===t?void 0:t.getFrecencyScore(r.block.blockModel.id);return{name:"FRECENCY_SCORE",value:i||0}},g=e=>{let{result:t}=e;return{name:"LEXICAL_MATCH_SCORE",value:t.score}},f={name:"CLIENT_FEATURESET_V2_RAW",features:[e=>{let{result:t}=e;return{name:"IS_EXACT_MATCH",value:t.matchMetadata&&"isExactMatch"in t.matchMetadata?1:0}},e=>{let{result:t}=e;return{name:"IS_PREFIX_MATCH",value:t.matchMetadata&&"isPrefixMatch"in t.matchMetadata?1:0}},e=>{let{result:t}=e;return{name:"IS_WORD_PREFIX_MATCH",value:t.matchMetadata&&"isWordPrefixMatch"in t.matchMetadata?1:0}},e=>{let{result:t}=e;return{name:"IS_SUBSTRING_MATCH",value:t.matchMetadata&&"isSubstringMatch"in t.matchMetadata?1:0}},e=>{let{result:t}=e;return{name:"IS_FUZZY_MATCH",value:t.matchMetadata&&"isFuzzyMatch"in t.matchMetadata?1:0}},e=>{let{result:t}=e;return{name:"IS_FRECENT_PAGE",value:t.block.source.has("frecencyStore")?1:0}},e=>{let{result:t}=e;return{name:"IS_BOOKMARKED_PAGE",value:t.block.source.has("bookmarkedPage")?1:0}},e=>{let{result:t}=e;return{name:"IS_TEAM_PAGE",value:t.block.source.has("teamPage")?1:0}},e=>{let{result:t}=e;return{name:"IS_SHARED_PAGE",value:t.block.source.has("sharedPage")?1:0}},e=>{let{result:t,featureExtractor:r}=e;const[s,i]=r.getFrecencyScoreBounds();return{name:"FRECENCY_SCORE_SCALED",value:r.minMaxScale(m({result:t,featureExtractor:r}).value,s,i)}},e=>{let{result:t}=e;return{name:"IS_RECENT_VISIT_BY_ME",value:t.block.source.has("recentVisit")?1:0}},e=>{let{result:t}=e;return{name:"TIME_SINCE_LAST_VIEWED_BY_ME",value:t.block.timeSinceLastViewedMs??-1}},e=>{let{result:t,featureExtractor:r}=e;return{name:"IS_SIMILAR_USER_1D_RECENT_PAGE",value:p.default.isSimilarUsersRecentPages({userId:r.userId,spaceId:r.spaceId,pageId:t.block.blockModel.id})?1:0}},e=>{let{result:t,featureExtractor:r}=e;return{name:"NUM_SIMILAR_USERS_VIEWED_PAGE",value:p.default.getNumSimilarUsersVisitedPage({userId:r.userId,spaceId:r.spaceId,pageId:t.block.blockModel.id})||0}},e=>{let{result:t,featureExtractor:r}=e;return{name:"PAGE_MOST_SIMILAR_VIEWER_SIMILARITY",value:p.default.getHighestViewerSimilarityScoreForPage({userId:r.userId,spaceId:r.spaceId,pageId:t.block.blockModel.id})||0}},e=>{let{result:t,featureExtractor:r}=e;const s=p.default.getSimilarUsersMostRecentVisitTimeForPage({userId:r.userId,spaceId:r.spaceId,pageId:t.block.blockModel.id});return{name:"TIME_SINCE_SIM_USER_VISIT",value:s?r.currentTimeMs-s:-1}},e=>{let{result:t,featureExtractor:r}=e;return{name:"IS_TOP_PAGES_7D_PAGE_VIEWS",value:p.default.isTopPages7dPageView({userId:r.userId,spaceId:r.spaceId,pageId:t.block.blockModel.id})?1:0}},e=>{let{result:t,featureExtractor:r}=e;return{name:"PAGE_AUTHORITY_V1",value:p.default.getPageAuthorityV1ForPage({userId:r.userId,spaceId:r.spaceId,pageId:t.block.blockModel.id})||0}},e=>{let{result:t,featureExtractor:r}=e;return{name:"TIME_SINCE_LAST_EDIT",value:r.currentTimeMs-t.block.blockModel.last_edited_time}},e=>{let{result:t,featureExtractor:r}=e;return{name:"IS_LAST_EDITED_BY_ME",value:r.userId&&t.block.blockModel.last_edited_by_id===r.userId?1:0}},e=>{let{result:t}=e;return{name:"IS_LAST_EDITED_BY_ME_WITHIN_12H",value:t.block.source.has("defaultRecordCache")?1:0}},e=>{let{result:t,featureExtractor:r}=e;return{name:"TIME_SINCE_LAST_EDITED_BY_ME",value:p.default.getUserLastEditedTimeForPage({userId:r.userId,spaceId:r.spaceId,pageId:t.block.blockModel.id})??-1}},e=>{let{result:t,featureExtractor:r}=e;return{name:"TIME_SINCE_SIM_USER_LAST_EDIT",value:p.default.getSimilarUserLastEditedTimeForPage({userId:r.userId,spaceId:r.spaceId,pageId:t.block.blockModel.id})??-1}},g,m]};function v(e){let t=0,r=0;for(const s of e)s<t&&(t=s),s>r&&(r=s);return[t,r]}class y{constructor(e,t,r){var s;this.featuresets=void 0,this.frecencyStore=void 0,this.results=void 0,this.resultsFeatureMetadata={},this.userId=void 0,this.spaceId=void 0,this.currentTimeMs=void 0,this.frecencyStore=h.Z.lazyFrecencyStore.get(t.currentUser.id),this.featuresets=e,this.results=r,this.userId=t.currentUser.id,this.spaceId=null===(s=u.default.state.currentSpaceStore)||void 0===s?void 0:s.id,this.currentTimeMs=Date.now()}minMaxScale(e,t,r){return t===r?0:(e-t)/(r-t)}getFrecencyScoreBounds(){if(!this.resultsFeatureMetadata.minFrecencyScore||!this.resultsFeatureMetadata.maxFrecencyScore){const e=this.results.map((e=>m({result:e,featureExtractor:this}).value||0)),[t,r]=v(e);this.resultsFeatureMetadata.minFrecencyScore=t,this.resultsFeatureMetadata.maxFrecencyScore=r}return[this.resultsFeatureMetadata.minFrecencyScore,this.resultsFeatureMetadata.maxFrecencyScore]}getLexicalMatchScoreBounds(){if(!this.resultsFeatureMetadata.minLexicalMatchScore||!this.resultsFeatureMetadata.maxLexicalMatchScore){const e=this.results.map((e=>g({result:e,featureExtractor:this}).value||0)),[t,r]=v(e);this.resultsFeatureMetadata.minLexicalMatchScore=t,this.resultsFeatureMetadata.maxLexicalMatchScore=r}return[this.resultsFeatureMetadata.minLexicalMatchScore,this.resultsFeatureMetadata.maxLexicalMatchScore]}extractFeatureGroup(e){const t=[];for(const r of this.featuresets){const s={groupName:r.name,features:[]};for(const t of r.features)s.features.push(t({result:e,featureExtractor:this}));t.push(s)}return t}}var x=r(29026);var S=r(77080),b=r(26842),C=r(88893);function M(e){const{results:t,featureGroups:r}=e;return t.map(((e,t)=>{const{block:s,score:i,personalizationBoost:n,rendered:o,terms:a}=e;return{sources:[l.vp.Local],id:s.blockModel.id,spaceId:s.blockModel.space_id,score:i,localSource:s.source,personalizationBoost:n,terms:a,highlight:{text:o},featureGroups:r[t]}}))}function I(e){return e.has("recentVisit")||e.has("frecencyStore")||e.has("bookmarkedPage")||e.has("defaultRecordCache")?1.25:1}function j(e,t,r){const s=e=>r.matches(e.block),i=(0,a.wS)(t);if(1===i.length)return e.search(t,{filter:s,prefix:!0,fields:["text","inits"]});const n=e.search(t,{filter:s,combineWith:"AND",fields:["text"]});if(n.length>0)return n;const o=(l=i.length,Math.round(.6*l+.5));var l;return e.search(t,{filter:e=>e.queryTerms.length>=o&&s(e)})}const k=e=>e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");function w(e){const{block:t,score:r,terms:s}=e,{source:i,text:n}=t,o=s.map(k).join("|"),a=new RegExp(o,"ig");return{block:t,rendered:s.length>0?n.replaceAll(a,`${l.Um}$&${l.dK}`):n,score:r,personalizationBoost:I(i),terms:s}}function P(e,t,r,o,a){const{blocks:d,getAllBlocks:u}=e,h=a.text.trim(),p=(0,n.nv)(h),m=p.length>0?p.join(" "):h,g=new c.uL(r),f="minisearch"===t||"minisearch-frecency"===t;return f&&m.length>0?function(e,t,r){return j(e,t,r).map(w)}(d,m,g):f?u().filter((e=>g.matches(e.block))).map(w):((e,t,r,n,o)=>i.oA(e.map((e=>{if(!t.matches(e))return;let i;if(i=n.includes(e.blockModel.id)?{rendered:"",score:s.$r,matchMetadata:{isExactIdMatch:!0}}:(0,s.C6)(r,e.text,{pre:l.Um,post:l.dK,ignoreFuzzyFallback:o}),i){const{rendered:t,score:r}=i;return{block:e,rendered:t,score:r,personalizationBoost:I(e.source),terms:[]}}}))))(u().map((e=>{let{block:t}=e;return t})),g,h,p,o)}function T(e){let{query:t,localCachedPages:r,userId:n,includeRecordMap:o,environment:a,applyRecallScoreThreshold:l,canUseLtr:u}=e;const{query:h,limit:p}=t,{filters:m,sort:g}=h,v=S.default.getEligibleGroup({experimentId:"search-client-page-match"}),b=P(r,v,m,l,h);if(0===b.length)return;const I=function(e,t){const{field:r}=e,s="relevance"===r||"desc"===e.direction?-1:1;switch(r){case"lastEdited":case"scroll":return i.MR(t,(e=>{let{block:{blockModel:t}}=e;return s*(t.last_edited_time||0)}));case"created":return i.MR(t,(e=>{let{block:{blockModel:t}}=e;return s*(t.created_time||0)}));default:return i.MR(t,(e=>{let{score:t}=e;return s*t}))}}(g,b);u&&(0,d.j)(a,"search_local_recall_results",{num_visible_members:(0,C.qX)(),results:I.map((e=>({id:e.block.blockModel.id,localSource:[...e.block.source]})))});let j;if("relevance"===g.field&&"minisearch"!==v)if(t.query.text.length>1&&u){const e=I.map((e=>({...e,matchMetadata:(0,s.EB)(t.query.text,e.block.text)}))),r=new y([f],a,e);j=function(e){const{sort:t,currentUserId:r,unsorted:s}=e;return(0,c.YB)({sort:t,currentUserId:r,unsorted:s,batchSize:x.Xv})}({sort:g,unsorted:M({results:I,featureGroups:e.map((e=>r.extractFeatureGroup(e)))}),currentUserId:n})}else j=(0,c.YB)({sort:g,currentUserId:n,unsorted:M({results:I,featureGroups:I.map((e=>[]))}),batchSize:x.Xv});else j=M({results:I,featureGroups:I.map((e=>[]))});j=j.slice(0,p);const k=o??!0;return{total:b.length,results:j,recordMap:k?r.recordMap.toJson({allowVersionDowngrade:!1}):{},trackEventProperties:{}}}function F(e){let{query:t,localCachedPages:r,parentStore:s,isOnline:i,environment:n,shouldLimitLocalResultsWhenOnline:a,applyScoreThresholdWhenOnline:d,maxLocalResultsOverride:u,canUseLtr:h}=e;const p=T({query:t,localCachedPages:r,userId:n.currentUser.id,environment:n,applyRecallScoreThreshold:i&&d,canUseLtr:h});if(!p)return;if(0===p.results.length)return{error:l.Ix.NoResults};let m=p.results.map(((e,t)=>({...e,originalPosition:t,store:b.G.createChildStore(s,{table:o.iU,id:e.id}),serverEventProperties:void 0})));const g=m.length;return i&&a&&(m=(0,c.g8)(n,m,u)),0===m.length?{error:l.Ix.NoResults}:{value:{total:g,results:m,debugInfo:void 0}}}},63334:(e,t,r)=>{r.d(t,{Z:()=>n});var s=r(49085);class i extends s.default{getInitialState(){return{}}}const n=i},25904:(e,t,r)=>{r.d(t,{Z:()=>n});var s=r(49085);class i extends s.default{getInitialState(){return{open:!1}}}const n=new i},30857:(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});var s=r(49085);class i extends s.default{getInitialState(){return{selectedQueryResult:!1,numKeystrokes:0,numServerRequests:0,numLocalRequests:0,hadMetaClick:!1,firstKeyStrokeTimeMs:void 0}}}const n=new i},54983:(e,t,r)=>{r.d(t,{Z:()=>n});var s=r(49085);class i extends s.default{getInitialState(){return{}}}const n=i},45366:(e,t,r)=>{r.d(t,{wS:()=>n});var s=r(72126);const i=/[-./\\()"'’‘”“，。、·～；,;<>~!@#$%^&*|+=[\]{}`~?:\s]/u;function n(e){return(0,s.oA)(e.split(i))}}}]);